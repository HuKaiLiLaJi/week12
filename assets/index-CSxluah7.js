(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))u(g);new MutationObserver(g=>{for(const b of g)if(b.type==="childList")for(const I of b.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&u(I)}).observe(document,{childList:!0,subtree:!0});function i(g){const b={};return g.integrity&&(b.integrity=g.integrity),g.referrerPolicy&&(b.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?b.credentials="include":g.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function u(g){if(g.ep)return;g.ep=!0;const b=i(g);fetch(g.href,b)}})();var bR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function FB(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function NB(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var i=function u(){return this instanceof u?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(n).forEach(function(u){var g=Object.getOwnPropertyDescriptor(n,u);Object.defineProperty(i,u,g.get?g:{enumerable:!0,get:function(){return n[u]}})}),i}var VB={exports:{}},Os="top",Pa="bottom",Ma="right",Bs="left",I0="auto",Xf=[Os,Pa,Ma,Bs],td="start",Pf="end",xR="clippingParents",A1="viewport",mf="popper",wR="reference",kx=Xf.reduce(function(n,e){return n.concat([e+"-"+td,e+"-"+Pf])},[]),S1=[].concat(Xf,[I0]).reduce(function(n,e){return n.concat([e,e+"-"+td,e+"-"+Pf])},[]),TR="beforeRead",ER="read",IR="afterRead",AR="beforeMain",SR="main",CR="afterMain",RR="beforeWrite",kR="write",PR="afterWrite",MR=[TR,ER,IR,AR,SR,CR,RR,kR,PR];function cc(n){return n?(n.nodeName||"").toLowerCase():null}function Da(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function rd(n){var e=Da(n).Element;return n instanceof e||n instanceof Element}function il(n){var e=Da(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function C1(n){if(typeof ShadowRoot>"u")return!1;var e=Da(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function UB(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var u=e.styles[i]||{},g=e.attributes[i]||{},b=e.elements[i];!il(b)||!cc(b)||(Object.assign(b.style,u),Object.keys(g).forEach(function(I){var L=g[I];L===!1?b.removeAttribute(I):b.setAttribute(I,L===!0?"":L)}))})}function jB(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(u){var g=e.elements[u],b=e.attributes[u]||{},I=Object.keys(e.styles.hasOwnProperty(u)?e.styles[u]:i[u]),L=I.reduce(function(s,$){return s[$]="",s},{});!il(g)||!cc(g)||(Object.assign(g.style,L),Object.keys(b).forEach(function(s){g.removeAttribute(s)}))})}}const R1={name:"applyStyles",enabled:!0,phase:"write",fn:UB,effect:jB,requires:["computeStyles"]};function nc(n){return n.split("-")[0]}var Kh=Math.max,Ky=Math.min,Mf=Math.round;function Px(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function DR(){return!/^((?!chrome|android).)*safari/i.test(Px())}function Df(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var u=n.getBoundingClientRect(),g=1,b=1;e&&il(n)&&(g=n.offsetWidth>0&&Mf(u.width)/n.offsetWidth||1,b=n.offsetHeight>0&&Mf(u.height)/n.offsetHeight||1);var I=rd(n)?Da(n):window,L=I.visualViewport,s=!DR()&&i,$=(u.left+(s&&L?L.offsetLeft:0))/g,W=(u.top+(s&&L?L.offsetTop:0))/b,Q=u.width/g,ae=u.height/b;return{width:Q,height:ae,top:W,right:$+Q,bottom:W+ae,left:$,x:$,y:W}}function k1(n){var e=Df(n),i=n.offsetWidth,u=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-u)<=1&&(u=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:u}}function LR(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&C1(i)){var u=e;do{if(u&&n.isSameNode(u))return!0;u=u.parentNode||u.host}while(u)}return!1}function Uc(n){return Da(n).getComputedStyle(n)}function $B(n){return["table","td","th"].indexOf(cc(n))>=0}function th(n){return((rd(n)?n.ownerDocument:n.document)||window.document).documentElement}function A0(n){return cc(n)==="html"?n:n.assignedSlot||n.parentNode||(C1(n)?n.host:null)||th(n)}function SA(n){return!il(n)||Uc(n).position==="fixed"?null:n.offsetParent}function qB(n){var e=/firefox/i.test(Px()),i=/Trident/i.test(Px());if(i&&il(n)){var u=Uc(n);if(u.position==="fixed")return null}var g=A0(n);for(C1(g)&&(g=g.host);il(g)&&["html","body"].indexOf(cc(g))<0;){var b=Uc(g);if(b.transform!=="none"||b.perspective!=="none"||b.contain==="paint"||["transform","perspective"].indexOf(b.willChange)!==-1||e&&b.willChange==="filter"||e&&b.filter&&b.filter!=="none")return g;g=g.parentNode}return null}function Ag(n){for(var e=Da(n),i=SA(n);i&&$B(i)&&Uc(i).position==="static";)i=SA(i);return i&&(cc(i)==="html"||cc(i)==="body"&&Uc(i).position==="static")?e:i||qB(n)||e}function P1(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function jm(n,e,i){return Kh(n,Ky(e,i))}function GB(n,e,i){var u=jm(n,e,i);return u>i?i:u}function OR(){return{top:0,right:0,bottom:0,left:0}}function BR(n){return Object.assign({},OR(),n)}function zR(n,e){return e.reduce(function(i,u){return i[u]=n,i},{})}var HB=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,BR(typeof e!="number"?e:zR(e,Xf))};function WB(n){var e,i=n.state,u=n.name,g=n.options,b=i.elements.arrow,I=i.modifiersData.popperOffsets,L=nc(i.placement),s=P1(L),$=[Bs,Ma].indexOf(L)>=0,W=$?"height":"width";if(!(!b||!I)){var Q=HB(g.padding,i),ae=k1(b),we=s==="y"?Os:Bs,He=s==="y"?Pa:Ma,$e=i.rects.reference[W]+i.rects.reference[s]-I[s]-i.rects.popper[W],Ne=I[s]-i.rects.reference[s],wt=Ag(b),mt=wt?s==="y"?wt.clientHeight||0:wt.clientWidth||0:0,vt=$e/2-Ne/2,zt=Q[we],Ct=mt-ae[W]-Q[He],qt=mt/2-ae[W]/2+vt,qe=jm(zt,qt,Ct),be=s;i.modifiersData[u]=(e={},e[be]=qe,e.centerOffset=qe-qt,e)}}function ZB(n){var e=n.state,i=n.options,u=i.element,g=u===void 0?"[data-popper-arrow]":u;g!=null&&(typeof g=="string"&&(g=e.elements.popper.querySelector(g),!g)||LR(e.elements.popper,g)&&(e.elements.arrow=g))}const FR={name:"arrow",enabled:!0,phase:"main",fn:WB,effect:ZB,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Lf(n){return n.split("-")[1]}var XB={top:"auto",right:"auto",bottom:"auto",left:"auto"};function KB(n,e){var i=n.x,u=n.y,g=e.devicePixelRatio||1;return{x:Mf(i*g)/g||0,y:Mf(u*g)/g||0}}function CA(n){var e,i=n.popper,u=n.popperRect,g=n.placement,b=n.variation,I=n.offsets,L=n.position,s=n.gpuAcceleration,$=n.adaptive,W=n.roundOffsets,Q=n.isFixed,ae=I.x,we=ae===void 0?0:ae,He=I.y,$e=He===void 0?0:He,Ne=typeof W=="function"?W({x:we,y:$e}):{x:we,y:$e};we=Ne.x,$e=Ne.y;var wt=I.hasOwnProperty("x"),mt=I.hasOwnProperty("y"),vt=Bs,zt=Os,Ct=window;if($){var qt=Ag(i),qe="clientHeight",be="clientWidth";if(qt===Da(i)&&(qt=th(i),Uc(qt).position!=="static"&&L==="absolute"&&(qe="scrollHeight",be="scrollWidth")),qt=qt,g===Os||(g===Bs||g===Ma)&&b===Pf){zt=Pa;var Fe=Q&&qt===Ct&&Ct.visualViewport?Ct.visualViewport.height:qt[qe];$e-=Fe-u.height,$e*=s?1:-1}if(g===Bs||(g===Os||g===Pa)&&b===Pf){vt=Ma;var Je=Q&&qt===Ct&&Ct.visualViewport?Ct.visualViewport.width:qt[be];we-=Je-u.width,we*=s?1:-1}}var Me=Object.assign({position:L},$&&XB),je=W===!0?KB({x:we,y:$e},Da(i)):{x:we,y:$e};if(we=je.x,$e=je.y,s){var Ve;return Object.assign({},Me,(Ve={},Ve[zt]=mt?"0":"",Ve[vt]=wt?"0":"",Ve.transform=(Ct.devicePixelRatio||1)<=1?"translate("+we+"px, "+$e+"px)":"translate3d("+we+"px, "+$e+"px, 0)",Ve))}return Object.assign({},Me,(e={},e[zt]=mt?$e+"px":"",e[vt]=wt?we+"px":"",e.transform="",e))}function YB(n){var e=n.state,i=n.options,u=i.gpuAcceleration,g=u===void 0?!0:u,b=i.adaptive,I=b===void 0?!0:b,L=i.roundOffsets,s=L===void 0?!0:L,$={placement:nc(e.placement),variation:Lf(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:g,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,CA(Object.assign({},$,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:I,roundOffsets:s})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,CA(Object.assign({},$,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:s})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const M1={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:YB,data:{}};var gy={passive:!0};function JB(n){var e=n.state,i=n.instance,u=n.options,g=u.scroll,b=g===void 0?!0:g,I=u.resize,L=I===void 0?!0:I,s=Da(e.elements.popper),$=[].concat(e.scrollParents.reference,e.scrollParents.popper);return b&&$.forEach(function(W){W.addEventListener("scroll",i.update,gy)}),L&&s.addEventListener("resize",i.update,gy),function(){b&&$.forEach(function(W){W.removeEventListener("scroll",i.update,gy)}),L&&s.removeEventListener("resize",i.update,gy)}}const D1={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:JB,data:{}};var QB={left:"right",right:"left",bottom:"top",top:"bottom"};function Ry(n){return n.replace(/left|right|bottom|top/g,function(e){return QB[e]})}var ez={start:"end",end:"start"};function RA(n){return n.replace(/start|end/g,function(e){return ez[e]})}function L1(n){var e=Da(n),i=e.pageXOffset,u=e.pageYOffset;return{scrollLeft:i,scrollTop:u}}function O1(n){return Df(th(n)).left+L1(n).scrollLeft}function tz(n,e){var i=Da(n),u=th(n),g=i.visualViewport,b=u.clientWidth,I=u.clientHeight,L=0,s=0;if(g){b=g.width,I=g.height;var $=DR();($||!$&&e==="fixed")&&(L=g.offsetLeft,s=g.offsetTop)}return{width:b,height:I,x:L+O1(n),y:s}}function rz(n){var e,i=th(n),u=L1(n),g=(e=n.ownerDocument)==null?void 0:e.body,b=Kh(i.scrollWidth,i.clientWidth,g?g.scrollWidth:0,g?g.clientWidth:0),I=Kh(i.scrollHeight,i.clientHeight,g?g.scrollHeight:0,g?g.clientHeight:0),L=-u.scrollLeft+O1(n),s=-u.scrollTop;return Uc(g||i).direction==="rtl"&&(L+=Kh(i.clientWidth,g?g.clientWidth:0)-b),{width:b,height:I,x:L,y:s}}function B1(n){var e=Uc(n),i=e.overflow,u=e.overflowX,g=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+g+u)}function NR(n){return["html","body","#document"].indexOf(cc(n))>=0?n.ownerDocument.body:il(n)&&B1(n)?n:NR(A0(n))}function $m(n,e){var i;e===void 0&&(e=[]);var u=NR(n),g=u===((i=n.ownerDocument)==null?void 0:i.body),b=Da(u),I=g?[b].concat(b.visualViewport||[],B1(u)?u:[]):u,L=e.concat(I);return g?L:L.concat($m(A0(I)))}function Mx(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function nz(n,e){var i=Df(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function kA(n,e,i){return e===A1?Mx(tz(n,i)):rd(e)?nz(e,i):Mx(rz(th(n)))}function iz(n){var e=$m(A0(n)),i=["absolute","fixed"].indexOf(Uc(n).position)>=0,u=i&&il(n)?Ag(n):n;return rd(u)?e.filter(function(g){return rd(g)&&LR(g,u)&&cc(g)!=="body"}):[]}function oz(n,e,i,u){var g=e==="clippingParents"?iz(n):[].concat(e),b=[].concat(g,[i]),I=b[0],L=b.reduce(function(s,$){var W=kA(n,$,u);return s.top=Kh(W.top,s.top),s.right=Ky(W.right,s.right),s.bottom=Ky(W.bottom,s.bottom),s.left=Kh(W.left,s.left),s},kA(n,I,u));return L.width=L.right-L.left,L.height=L.bottom-L.top,L.x=L.left,L.y=L.top,L}function VR(n){var e=n.reference,i=n.element,u=n.placement,g=u?nc(u):null,b=u?Lf(u):null,I=e.x+e.width/2-i.width/2,L=e.y+e.height/2-i.height/2,s;switch(g){case Os:s={x:I,y:e.y-i.height};break;case Pa:s={x:I,y:e.y+e.height};break;case Ma:s={x:e.x+e.width,y:L};break;case Bs:s={x:e.x-i.width,y:L};break;default:s={x:e.x,y:e.y}}var $=g?P1(g):null;if($!=null){var W=$==="y"?"height":"width";switch(b){case td:s[$]=s[$]-(e[W]/2-i[W]/2);break;case Pf:s[$]=s[$]+(e[W]/2-i[W]/2);break}}return s}function Of(n,e){e===void 0&&(e={});var i=e,u=i.placement,g=u===void 0?n.placement:u,b=i.strategy,I=b===void 0?n.strategy:b,L=i.boundary,s=L===void 0?xR:L,$=i.rootBoundary,W=$===void 0?A1:$,Q=i.elementContext,ae=Q===void 0?mf:Q,we=i.altBoundary,He=we===void 0?!1:we,$e=i.padding,Ne=$e===void 0?0:$e,wt=BR(typeof Ne!="number"?Ne:zR(Ne,Xf)),mt=ae===mf?wR:mf,vt=n.rects.popper,zt=n.elements[He?mt:ae],Ct=oz(rd(zt)?zt:zt.contextElement||th(n.elements.popper),s,W,I),qt=Df(n.elements.reference),qe=VR({reference:qt,element:vt,strategy:"absolute",placement:g}),be=Mx(Object.assign({},vt,qe)),Fe=ae===mf?be:qt,Je={top:Ct.top-Fe.top+wt.top,bottom:Fe.bottom-Ct.bottom+wt.bottom,left:Ct.left-Fe.left+wt.left,right:Fe.right-Ct.right+wt.right},Me=n.modifiersData.offset;if(ae===mf&&Me){var je=Me[g];Object.keys(Je).forEach(function(Ve){var An=[Ma,Pa].indexOf(Ve)>=0?1:-1,jn=[Os,Pa].indexOf(Ve)>=0?"y":"x";Je[Ve]+=je[jn]*An})}return Je}function sz(n,e){e===void 0&&(e={});var i=e,u=i.placement,g=i.boundary,b=i.rootBoundary,I=i.padding,L=i.flipVariations,s=i.allowedAutoPlacements,$=s===void 0?S1:s,W=Lf(u),Q=W?L?kx:kx.filter(function(He){return Lf(He)===W}):Xf,ae=Q.filter(function(He){return $.indexOf(He)>=0});ae.length===0&&(ae=Q);var we=ae.reduce(function(He,$e){return He[$e]=Of(n,{placement:$e,boundary:g,rootBoundary:b,padding:I})[nc($e)],He},{});return Object.keys(we).sort(function(He,$e){return we[He]-we[$e]})}function az(n){if(nc(n)===I0)return[];var e=Ry(n);return[RA(n),e,RA(e)]}function lz(n){var e=n.state,i=n.options,u=n.name;if(!e.modifiersData[u]._skip){for(var g=i.mainAxis,b=g===void 0?!0:g,I=i.altAxis,L=I===void 0?!0:I,s=i.fallbackPlacements,$=i.padding,W=i.boundary,Q=i.rootBoundary,ae=i.altBoundary,we=i.flipVariations,He=we===void 0?!0:we,$e=i.allowedAutoPlacements,Ne=e.options.placement,wt=nc(Ne),mt=wt===Ne,vt=s||(mt||!He?[Ry(Ne)]:az(Ne)),zt=[Ne].concat(vt).reduce(function(fr,li){return fr.concat(nc(li)===I0?sz(e,{placement:li,boundary:W,rootBoundary:Q,padding:$,flipVariations:He,allowedAutoPlacements:$e}):li)},[]),Ct=e.rects.reference,qt=e.rects.popper,qe=new Map,be=!0,Fe=zt[0],Je=0;Je<zt.length;Je++){var Me=zt[Je],je=nc(Me),Ve=Lf(Me)===td,An=[Os,Pa].indexOf(je)>=0,jn=An?"width":"height",or=Of(e,{placement:Me,boundary:W,rootBoundary:Q,altBoundary:ae,padding:$}),Cr=An?Ve?Ma:Bs:Ve?Pa:Os;Ct[jn]>qt[jn]&&(Cr=Ry(Cr));var Vr=Ry(Cr),On=[];if(b&&On.push(or[je]<=0),L&&On.push(or[Cr]<=0,or[Vr]<=0),On.every(function(fr){return fr})){Fe=Me,be=!1;break}qe.set(Me,On)}if(be)for(var dr=He?3:1,Zn=function(li){var Dn=zt.find(function(It){var lr=qe.get(It);if(lr)return lr.slice(0,li).every(function(sr){return sr})});if(Dn)return Fe=Dn,"break"},yn=dr;yn>0;yn--){var kt=Zn(yn);if(kt==="break")break}e.placement!==Fe&&(e.modifiersData[u]._skip=!0,e.placement=Fe,e.reset=!0)}}const UR={name:"flip",enabled:!0,phase:"main",fn:lz,requiresIfExists:["offset"],data:{_skip:!1}};function PA(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function MA(n){return[Os,Ma,Pa,Bs].some(function(e){return n[e]>=0})}function cz(n){var e=n.state,i=n.name,u=e.rects.reference,g=e.rects.popper,b=e.modifiersData.preventOverflow,I=Of(e,{elementContext:"reference"}),L=Of(e,{altBoundary:!0}),s=PA(I,u),$=PA(L,g,b),W=MA(s),Q=MA($);e.modifiersData[i]={referenceClippingOffsets:s,popperEscapeOffsets:$,isReferenceHidden:W,hasPopperEscaped:Q},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":W,"data-popper-escaped":Q})}const jR={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:cz};function uz(n,e,i){var u=nc(n),g=[Bs,Os].indexOf(u)>=0?-1:1,b=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,I=b[0],L=b[1];return I=I||0,L=(L||0)*g,[Bs,Ma].indexOf(u)>=0?{x:L,y:I}:{x:I,y:L}}function hz(n){var e=n.state,i=n.options,u=n.name,g=i.offset,b=g===void 0?[0,0]:g,I=S1.reduce(function(W,Q){return W[Q]=uz(Q,e.rects,b),W},{}),L=I[e.placement],s=L.x,$=L.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=s,e.modifiersData.popperOffsets.y+=$),e.modifiersData[u]=I}const $R={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:hz};function dz(n){var e=n.state,i=n.name;e.modifiersData[i]=VR({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const z1={name:"popperOffsets",enabled:!0,phase:"read",fn:dz,data:{}};function fz(n){return n==="x"?"y":"x"}function pz(n){var e=n.state,i=n.options,u=n.name,g=i.mainAxis,b=g===void 0?!0:g,I=i.altAxis,L=I===void 0?!1:I,s=i.boundary,$=i.rootBoundary,W=i.altBoundary,Q=i.padding,ae=i.tether,we=ae===void 0?!0:ae,He=i.tetherOffset,$e=He===void 0?0:He,Ne=Of(e,{boundary:s,rootBoundary:$,padding:Q,altBoundary:W}),wt=nc(e.placement),mt=Lf(e.placement),vt=!mt,zt=P1(wt),Ct=fz(zt),qt=e.modifiersData.popperOffsets,qe=e.rects.reference,be=e.rects.popper,Fe=typeof $e=="function"?$e(Object.assign({},e.rects,{placement:e.placement})):$e,Je=typeof Fe=="number"?{mainAxis:Fe,altAxis:Fe}:Object.assign({mainAxis:0,altAxis:0},Fe),Me=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,je={x:0,y:0};if(qt){if(b){var Ve,An=zt==="y"?Os:Bs,jn=zt==="y"?Pa:Ma,or=zt==="y"?"height":"width",Cr=qt[zt],Vr=Cr+Ne[An],On=Cr-Ne[jn],dr=we?-be[or]/2:0,Zn=mt===td?qe[or]:be[or],yn=mt===td?-be[or]:-qe[or],kt=e.elements.arrow,fr=we&&kt?k1(kt):{width:0,height:0},li=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:OR(),Dn=li[An],It=li[jn],lr=jm(0,qe[or],fr[or]),sr=vt?qe[or]/2-dr-lr-Dn-Je.mainAxis:Zn-lr-Dn-Je.mainAxis,wr=vt?-qe[or]/2+dr+lr+It+Je.mainAxis:yn+lr+It+Je.mainAxis,_e=e.elements.arrow&&Ag(e.elements.arrow),un=_e?zt==="y"?_e.clientTop||0:_e.clientLeft||0:0,Le=(Ve=Me==null?void 0:Me[zt])!=null?Ve:0,Ye=Cr+sr-Le-un,De=Cr+wr-Le,jt=jm(we?Ky(Vr,Ye):Vr,Cr,we?Kh(On,De):On);qt[zt]=jt,je[zt]=jt-Cr}if(L){var St,Zt=zt==="x"?Os:Bs,Dt=zt==="x"?Pa:Ma,Wt=qt[Ct],nr=Ct==="y"?"height":"width",Kt=Wt+Ne[Zt],mr=Wt-Ne[Dt],Ar=[Os,Bs].indexOf(wt)!==-1,Ft=(St=Me==null?void 0:Me[Ct])!=null?St:0,Ir=Ar?Kt:Wt-qe[nr]-be[nr]-Ft+Je.altAxis,Sr=Ar?Wt+qe[nr]+be[nr]-Ft-Je.altAxis:mr,tn=we&&Ar?GB(Ir,Wt,Sr):jm(we?Ir:Kt,Wt,we?Sr:mr);qt[Ct]=tn,je[Ct]=tn-Wt}e.modifiersData[u]=je}}const qR={name:"preventOverflow",enabled:!0,phase:"main",fn:pz,requiresIfExists:["offset"]};function mz(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function gz(n){return n===Da(n)||!il(n)?L1(n):mz(n)}function _z(n){var e=n.getBoundingClientRect(),i=Mf(e.width)/n.offsetWidth||1,u=Mf(e.height)/n.offsetHeight||1;return i!==1||u!==1}function yz(n,e,i){i===void 0&&(i=!1);var u=il(e),g=il(e)&&_z(e),b=th(e),I=Df(n,g,i),L={scrollLeft:0,scrollTop:0},s={x:0,y:0};return(u||!u&&!i)&&((cc(e)!=="body"||B1(b))&&(L=gz(e)),il(e)?(s=Df(e,!0),s.x+=e.clientLeft,s.y+=e.clientTop):b&&(s.x=O1(b))),{x:I.left+L.scrollLeft-s.x,y:I.top+L.scrollTop-s.y,width:I.width,height:I.height}}function vz(n){var e=new Map,i=new Set,u=[];n.forEach(function(b){e.set(b.name,b)});function g(b){i.add(b.name);var I=[].concat(b.requires||[],b.requiresIfExists||[]);I.forEach(function(L){if(!i.has(L)){var s=e.get(L);s&&g(s)}}),u.push(b)}return n.forEach(function(b){i.has(b.name)||g(b)}),u}function bz(n){var e=vz(n);return MR.reduce(function(i,u){return i.concat(e.filter(function(g){return g.phase===u}))},[])}function xz(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function wz(n){var e=n.reduce(function(i,u){var g=i[u.name];return i[u.name]=g?Object.assign({},g,u,{options:Object.assign({},g.options,u.options),data:Object.assign({},g.data,u.data)}):u,i},{});return Object.keys(e).map(function(i){return e[i]})}var DA={placement:"bottom",modifiers:[],strategy:"absolute"};function LA(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(u){return!(u&&typeof u.getBoundingClientRect=="function")})}function S0(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,u=i===void 0?[]:i,g=e.defaultOptions,b=g===void 0?DA:g;return function(L,s,$){$===void 0&&($=b);var W={placement:"bottom",orderedModifiers:[],options:Object.assign({},DA,b),modifiersData:{},elements:{reference:L,popper:s},attributes:{},styles:{}},Q=[],ae=!1,we={state:W,setOptions:function(wt){var mt=typeof wt=="function"?wt(W.options):wt;$e(),W.options=Object.assign({},b,W.options,mt),W.scrollParents={reference:rd(L)?$m(L):L.contextElement?$m(L.contextElement):[],popper:$m(s)};var vt=bz(wz([].concat(u,W.options.modifiers)));return W.orderedModifiers=vt.filter(function(zt){return zt.enabled}),He(),we.update()},forceUpdate:function(){if(!ae){var wt=W.elements,mt=wt.reference,vt=wt.popper;if(LA(mt,vt)){W.rects={reference:yz(mt,Ag(vt),W.options.strategy==="fixed"),popper:k1(vt)},W.reset=!1,W.placement=W.options.placement,W.orderedModifiers.forEach(function(Je){return W.modifiersData[Je.name]=Object.assign({},Je.data)});for(var zt=0;zt<W.orderedModifiers.length;zt++){if(W.reset===!0){W.reset=!1,zt=-1;continue}var Ct=W.orderedModifiers[zt],qt=Ct.fn,qe=Ct.options,be=qe===void 0?{}:qe,Fe=Ct.name;typeof qt=="function"&&(W=qt({state:W,options:be,name:Fe,instance:we})||W)}}}},update:xz(function(){return new Promise(function(Ne){we.forceUpdate(),Ne(W)})}),destroy:function(){$e(),ae=!0}};if(!LA(L,s))return we;we.setOptions($).then(function(Ne){!ae&&$.onFirstUpdate&&$.onFirstUpdate(Ne)});function He(){W.orderedModifiers.forEach(function(Ne){var wt=Ne.name,mt=Ne.options,vt=mt===void 0?{}:mt,zt=Ne.effect;if(typeof zt=="function"){var Ct=zt({state:W,name:wt,instance:we,options:vt}),qt=function(){};Q.push(Ct||qt)}})}function $e(){Q.forEach(function(Ne){return Ne()}),Q=[]}return we}}var Tz=S0(),Ez=[D1,z1,M1,R1],Iz=S0({defaultModifiers:Ez}),Az=[D1,z1,M1,R1,$R,UR,qR,FR,jR],Sz=S0({defaultModifiers:Az});const Cz=Object.freeze(Object.defineProperty({__proto__:null,afterMain:CR,afterRead:IR,afterWrite:PR,applyStyles:R1,arrow:FR,auto:I0,basePlacements:Xf,beforeMain:AR,beforeRead:TR,beforeWrite:RR,bottom:Pa,clippingParents:xR,computeStyles:M1,createPopper:Sz,createPopperBase:Tz,createPopperLite:Iz,detectOverflow:Of,end:Pf,eventListeners:D1,flip:UR,hide:jR,left:Bs,main:SR,modifierPhases:MR,offset:$R,placements:S1,popper:mf,popperGenerator:S0,popperOffsets:z1,preventOverflow:qR,read:ER,reference:wR,right:Ma,start:td,top:Os,variationPlacements:kx,viewport:A1,write:kR},Symbol.toStringTag,{value:"Module"})),Rz=NB(Cz);/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(n,e){(function(i,u){n.exports=u(Rz)})(bR,function(i){function u(et){const H=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(et){for(const se in et)if(se!=="default"){const Qe=Object.getOwnPropertyDescriptor(et,se);Object.defineProperty(H,se,Qe.get?Qe:{enumerable:!0,get:()=>et[se]})}}return H.default=et,Object.freeze(H)}const g=u(i),b=new Map,I={set(et,H,se){b.has(et)||b.set(et,new Map);const Qe=b.get(et);Qe.has(H)||Qe.size===0?Qe.set(H,se):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(Qe.keys())[0]}.`)},get:(et,H)=>b.has(et)&&b.get(et).get(H)||null,remove(et,H){if(!b.has(et))return;const se=b.get(et);se.delete(H),se.size===0&&b.delete(et)}},L="transitionend",s=et=>(et&&window.CSS&&window.CSS.escape&&(et=et.replace(/#([^\s"#']+)/g,(H,se)=>`#${CSS.escape(se)}`)),et),$=et=>{et.dispatchEvent(new Event(L))},W=et=>!(!et||typeof et!="object")&&(et.jquery!==void 0&&(et=et[0]),et.nodeType!==void 0),Q=et=>W(et)?et.jquery?et[0]:et:typeof et=="string"&&et.length>0?document.querySelector(s(et)):null,ae=et=>{if(!W(et)||et.getClientRects().length===0)return!1;const H=getComputedStyle(et).getPropertyValue("visibility")==="visible",se=et.closest("details:not([open])");if(!se)return H;if(se!==et){const Qe=et.closest("summary");if(Qe&&Qe.parentNode!==se||Qe===null)return!1}return H},we=et=>!et||et.nodeType!==Node.ELEMENT_NODE||!!et.classList.contains("disabled")||(et.disabled!==void 0?et.disabled:et.hasAttribute("disabled")&&et.getAttribute("disabled")!=="false"),He=et=>{if(!document.documentElement.attachShadow)return null;if(typeof et.getRootNode=="function"){const H=et.getRootNode();return H instanceof ShadowRoot?H:null}return et instanceof ShadowRoot?et:et.parentNode?He(et.parentNode):null},$e=()=>{},Ne=et=>{et.offsetHeight},wt=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,mt=[],vt=()=>document.documentElement.dir==="rtl",zt=et=>{var H;H=()=>{const se=wt();if(se){const Qe=et.NAME,$t=se.fn[Qe];se.fn[Qe]=et.jQueryInterface,se.fn[Qe].Constructor=et,se.fn[Qe].noConflict=()=>(se.fn[Qe]=$t,et.jQueryInterface)}},document.readyState==="loading"?(mt.length||document.addEventListener("DOMContentLoaded",()=>{for(const se of mt)se()}),mt.push(H)):H()},Ct=(et,H=[],se=et)=>typeof et=="function"?et(...H):se,qt=(et,H,se=!0)=>{if(!se)return void Ct(et);const Qe=(Pr=>{if(!Pr)return 0;let{transitionDuration:bn,transitionDelay:Nr}=window.getComputedStyle(Pr);const fo=Number.parseFloat(bn),Bo=Number.parseFloat(Nr);return fo||Bo?(bn=bn.split(",")[0],Nr=Nr.split(",")[0],1e3*(Number.parseFloat(bn)+Number.parseFloat(Nr))):0})(H)+5;let $t=!1;const gr=({target:Pr})=>{Pr===H&&($t=!0,H.removeEventListener(L,gr),Ct(et))};H.addEventListener(L,gr),setTimeout(()=>{$t||$(H)},Qe)},qe=(et,H,se,Qe)=>{const $t=et.length;let gr=et.indexOf(H);return gr===-1?!se&&Qe?et[$t-1]:et[0]:(gr+=se?1:-1,Qe&&(gr=(gr+$t)%$t),et[Math.max(0,Math.min(gr,$t-1))])},be=/[^.]*(?=\..*)\.|.*/,Fe=/\..*/,Je=/::\d+$/,Me={};let je=1;const Ve={mouseenter:"mouseover",mouseleave:"mouseout"},An=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function jn(et,H){return H&&`${H}::${je++}`||et.uidEvent||je++}function or(et){const H=jn(et);return et.uidEvent=H,Me[H]=Me[H]||{},Me[H]}function Cr(et,H,se=null){return Object.values(et).find(Qe=>Qe.callable===H&&Qe.delegationSelector===se)}function Vr(et,H,se){const Qe=typeof H=="string",$t=Qe?se:H||se;let gr=yn(et);return An.has(gr)||(gr=et),[Qe,$t,gr]}function On(et,H,se,Qe,$t){if(typeof H!="string"||!et)return;let[gr,Pr,bn]=Vr(H,se,Qe);H in Ve&&(Pr=(Za=>function(ps){if(!ps.relatedTarget||ps.relatedTarget!==ps.delegateTarget&&!ps.delegateTarget.contains(ps.relatedTarget))return Za.call(this,ps)})(Pr));const Nr=or(et),fo=Nr[bn]||(Nr[bn]={}),Bo=Cr(fo,Pr,gr?se:null);if(Bo)return void(Bo.oneOff=Bo.oneOff&&$t);const Xo=jn(Pr,H.replace(be,"")),fs=gr?function(Ko,Za,ps){return function Ul(xa){const xd=Ko.querySelectorAll(Za);for(let{target:ul}=xa;ul&&ul!==this;ul=ul.parentNode)for(const op of xd)if(op===ul)return fr(xa,{delegateTarget:ul}),Ul.oneOff&&kt.off(Ko,xa.type,Za,ps),ps.apply(ul,[xa])}}(et,se,Pr):function(Ko,Za){return function ps(Ul){return fr(Ul,{delegateTarget:Ko}),ps.oneOff&&kt.off(Ko,Ul.type,Za),Za.apply(Ko,[Ul])}}(et,Pr);fs.delegationSelector=gr?se:null,fs.callable=Pr,fs.oneOff=$t,fs.uidEvent=Xo,fo[Xo]=fs,et.addEventListener(bn,fs,gr)}function dr(et,H,se,Qe,$t){const gr=Cr(H[se],Qe,$t);gr&&(et.removeEventListener(se,gr,!!$t),delete H[se][gr.uidEvent])}function Zn(et,H,se,Qe){const $t=H[se]||{};for(const[gr,Pr]of Object.entries($t))gr.includes(Qe)&&dr(et,H,se,Pr.callable,Pr.delegationSelector)}function yn(et){return et=et.replace(Fe,""),Ve[et]||et}const kt={on(et,H,se,Qe){On(et,H,se,Qe,!1)},one(et,H,se,Qe){On(et,H,se,Qe,!0)},off(et,H,se,Qe){if(typeof H!="string"||!et)return;const[$t,gr,Pr]=Vr(H,se,Qe),bn=Pr!==H,Nr=or(et),fo=Nr[Pr]||{},Bo=H.startsWith(".");if(gr===void 0){if(Bo)for(const Xo of Object.keys(Nr))Zn(et,Nr,Xo,H.slice(1));for(const[Xo,fs]of Object.entries(fo)){const Ko=Xo.replace(Je,"");bn&&!H.includes(Ko)||dr(et,Nr,Pr,fs.callable,fs.delegationSelector)}}else{if(!Object.keys(fo).length)return;dr(et,Nr,Pr,gr,$t?se:null)}},trigger(et,H,se){if(typeof H!="string"||!et)return null;const Qe=wt();let $t=null,gr=!0,Pr=!0,bn=!1;H!==yn(H)&&Qe&&($t=Qe.Event(H,se),Qe(et).trigger($t),gr=!$t.isPropagationStopped(),Pr=!$t.isImmediatePropagationStopped(),bn=$t.isDefaultPrevented());const Nr=fr(new Event(H,{bubbles:gr,cancelable:!0}),se);return bn&&Nr.preventDefault(),Pr&&et.dispatchEvent(Nr),Nr.defaultPrevented&&$t&&$t.preventDefault(),Nr}};function fr(et,H={}){for(const[se,Qe]of Object.entries(H))try{et[se]=Qe}catch{Object.defineProperty(et,se,{configurable:!0,get:()=>Qe})}return et}function li(et){if(et==="true")return!0;if(et==="false")return!1;if(et===Number(et).toString())return Number(et);if(et===""||et==="null")return null;if(typeof et!="string")return et;try{return JSON.parse(decodeURIComponent(et))}catch{return et}}function Dn(et){return et.replace(/[A-Z]/g,H=>`-${H.toLowerCase()}`)}const It={setDataAttribute(et,H,se){et.setAttribute(`data-bs-${Dn(H)}`,se)},removeDataAttribute(et,H){et.removeAttribute(`data-bs-${Dn(H)}`)},getDataAttributes(et){if(!et)return{};const H={},se=Object.keys(et.dataset).filter(Qe=>Qe.startsWith("bs")&&!Qe.startsWith("bsConfig"));for(const Qe of se){let $t=Qe.replace(/^bs/,"");$t=$t.charAt(0).toLowerCase()+$t.slice(1,$t.length),H[$t]=li(et.dataset[Qe])}return H},getDataAttribute:(et,H)=>li(et.getAttribute(`data-bs-${Dn(H)}`))};class lr{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(H){return H=this._mergeConfigObj(H),H=this._configAfterMerge(H),this._typeCheckConfig(H),H}_configAfterMerge(H){return H}_mergeConfigObj(H,se){const Qe=W(se)?It.getDataAttribute(se,"config"):{};return{...this.constructor.Default,...typeof Qe=="object"?Qe:{},...W(se)?It.getDataAttributes(se):{},...typeof H=="object"?H:{}}}_typeCheckConfig(H,se=this.constructor.DefaultType){for(const[$t,gr]of Object.entries(se)){const Pr=H[$t],bn=W(Pr)?"element":(Qe=Pr)==null?`${Qe}`:Object.prototype.toString.call(Qe).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(gr).test(bn))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${$t}" provided type "${bn}" but expected type "${gr}".`)}var Qe}}class sr extends lr{constructor(H,se){super(),(H=Q(H))&&(this._element=H,this._config=this._getConfig(se),I.set(this._element,this.constructor.DATA_KEY,this))}dispose(){I.remove(this._element,this.constructor.DATA_KEY),kt.off(this._element,this.constructor.EVENT_KEY);for(const H of Object.getOwnPropertyNames(this))this[H]=null}_queueCallback(H,se,Qe=!0){qt(H,se,Qe)}_getConfig(H){return H=this._mergeConfigObj(H,this._element),H=this._configAfterMerge(H),this._typeCheckConfig(H),H}static getInstance(H){return I.get(Q(H),this.DATA_KEY)}static getOrCreateInstance(H,se={}){return this.getInstance(H)||new this(H,typeof se=="object"?se:null)}static get VERSION(){return"5.3.3"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(H){return`${H}${this.EVENT_KEY}`}}const wr=et=>{let H=et.getAttribute("data-bs-target");if(!H||H==="#"){let se=et.getAttribute("href");if(!se||!se.includes("#")&&!se.startsWith("."))return null;se.includes("#")&&!se.startsWith("#")&&(se=`#${se.split("#")[1]}`),H=se&&se!=="#"?se.trim():null}return H?H.split(",").map(se=>s(se)).join(","):null},_e={find:(et,H=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(H,et)),findOne:(et,H=document.documentElement)=>Element.prototype.querySelector.call(H,et),children:(et,H)=>[].concat(...et.children).filter(se=>se.matches(H)),parents(et,H){const se=[];let Qe=et.parentNode.closest(H);for(;Qe;)se.push(Qe),Qe=Qe.parentNode.closest(H);return se},prev(et,H){let se=et.previousElementSibling;for(;se;){if(se.matches(H))return[se];se=se.previousElementSibling}return[]},next(et,H){let se=et.nextElementSibling;for(;se;){if(se.matches(H))return[se];se=se.nextElementSibling}return[]},focusableChildren(et){const H=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(se=>`${se}:not([tabindex^="-"])`).join(",");return this.find(H,et).filter(se=>!we(se)&&ae(se))},getSelectorFromElement(et){const H=wr(et);return H&&_e.findOne(H)?H:null},getElementFromSelector(et){const H=wr(et);return H?_e.findOne(H):null},getMultipleElementsFromSelector(et){const H=wr(et);return H?_e.find(H):[]}},un=(et,H="hide")=>{const se=`click.dismiss${et.EVENT_KEY}`,Qe=et.NAME;kt.on(document,se,`[data-bs-dismiss="${Qe}"]`,function($t){if(["A","AREA"].includes(this.tagName)&&$t.preventDefault(),we(this))return;const gr=_e.getElementFromSelector(this)||this.closest(`.${Qe}`);et.getOrCreateInstance(gr)[H]()})},Le=".bs.alert",Ye=`close${Le}`,De=`closed${Le}`;class jt extends sr{static get NAME(){return"alert"}close(){if(kt.trigger(this._element,Ye).defaultPrevented)return;this._element.classList.remove("show");const H=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,H)}_destroyElement(){this._element.remove(),kt.trigger(this._element,De),this.dispose()}static jQueryInterface(H){return this.each(function(){const se=jt.getOrCreateInstance(this);if(typeof H=="string"){if(se[H]===void 0||H.startsWith("_")||H==="constructor")throw new TypeError(`No method named "${H}"`);se[H](this)}})}}un(jt,"close"),zt(jt);const St='[data-bs-toggle="button"]';class Zt extends sr{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(H){return this.each(function(){const se=Zt.getOrCreateInstance(this);H==="toggle"&&se[H]()})}}kt.on(document,"click.bs.button.data-api",St,et=>{et.preventDefault();const H=et.target.closest(St);Zt.getOrCreateInstance(H).toggle()}),zt(Zt);const Dt=".bs.swipe",Wt=`touchstart${Dt}`,nr=`touchmove${Dt}`,Kt=`touchend${Dt}`,mr=`pointerdown${Dt}`,Ar=`pointerup${Dt}`,Ft={endCallback:null,leftCallback:null,rightCallback:null},Ir={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Sr extends lr{constructor(H,se){super(),this._element=H,H&&Sr.isSupported()&&(this._config=this._getConfig(se),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return Ft}static get DefaultType(){return Ir}static get NAME(){return"swipe"}dispose(){kt.off(this._element,Dt)}_start(H){this._supportPointerEvents?this._eventIsPointerPenTouch(H)&&(this._deltaX=H.clientX):this._deltaX=H.touches[0].clientX}_end(H){this._eventIsPointerPenTouch(H)&&(this._deltaX=H.clientX-this._deltaX),this._handleSwipe(),Ct(this._config.endCallback)}_move(H){this._deltaX=H.touches&&H.touches.length>1?0:H.touches[0].clientX-this._deltaX}_handleSwipe(){const H=Math.abs(this._deltaX);if(H<=40)return;const se=H/this._deltaX;this._deltaX=0,se&&Ct(se>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(kt.on(this._element,mr,H=>this._start(H)),kt.on(this._element,Ar,H=>this._end(H)),this._element.classList.add("pointer-event")):(kt.on(this._element,Wt,H=>this._start(H)),kt.on(this._element,nr,H=>this._move(H)),kt.on(this._element,Kt,H=>this._end(H)))}_eventIsPointerPenTouch(H){return this._supportPointerEvents&&(H.pointerType==="pen"||H.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const tn=".bs.carousel",Xr=".data-api",vn="next",xi="prev",Ii="left",yo="right",eo=`slide${tn}`,co=`slid${tn}`,Mi=`keydown${tn}`,fi=`mouseenter${tn}`,ls=`mouseleave${tn}`,nn=`dragstart${tn}`,Vo=`load${tn}${Xr}`,Fs=`click${tn}${Xr}`,to="carousel",Co="active",Ro=".active",Ns=".carousel-item",Vs=Ro+Ns,Us={ArrowLeft:yo,ArrowRight:Ii},nt={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},ne={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class oe extends sr{constructor(H,se){super(H,se),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=_e.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===to&&this.cycle()}static get Default(){return nt}static get DefaultType(){return ne}static get NAME(){return"carousel"}next(){this._slide(vn)}nextWhenVisible(){!document.hidden&&ae(this._element)&&this.next()}prev(){this._slide(xi)}pause(){this._isSliding&&$(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?kt.one(this._element,co,()=>this.cycle()):this.cycle())}to(H){const se=this._getItems();if(H>se.length-1||H<0)return;if(this._isSliding)return void kt.one(this._element,co,()=>this.to(H));const Qe=this._getItemIndex(this._getActive());if(Qe===H)return;const $t=H>Qe?vn:xi;this._slide($t,se[H])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(H){return H.defaultInterval=H.interval,H}_addEventListeners(){this._config.keyboard&&kt.on(this._element,Mi,H=>this._keydown(H)),this._config.pause==="hover"&&(kt.on(this._element,fi,()=>this.pause()),kt.on(this._element,ls,()=>this._maybeEnableCycle())),this._config.touch&&Sr.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const se of _e.find(".carousel-item img",this._element))kt.on(se,nn,Qe=>Qe.preventDefault());const H={leftCallback:()=>this._slide(this._directionToOrder(Ii)),rightCallback:()=>this._slide(this._directionToOrder(yo)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new Sr(this._element,H)}_keydown(H){if(/input|textarea/i.test(H.target.tagName))return;const se=Us[H.key];se&&(H.preventDefault(),this._slide(this._directionToOrder(se)))}_getItemIndex(H){return this._getItems().indexOf(H)}_setActiveIndicatorElement(H){if(!this._indicatorsElement)return;const se=_e.findOne(Ro,this._indicatorsElement);se.classList.remove(Co),se.removeAttribute("aria-current");const Qe=_e.findOne(`[data-bs-slide-to="${H}"]`,this._indicatorsElement);Qe&&(Qe.classList.add(Co),Qe.setAttribute("aria-current","true"))}_updateInterval(){const H=this._activeElement||this._getActive();if(!H)return;const se=Number.parseInt(H.getAttribute("data-bs-interval"),10);this._config.interval=se||this._config.defaultInterval}_slide(H,se=null){if(this._isSliding)return;const Qe=this._getActive(),$t=H===vn,gr=se||qe(this._getItems(),Qe,$t,this._config.wrap);if(gr===Qe)return;const Pr=this._getItemIndex(gr),bn=Xo=>kt.trigger(this._element,Xo,{relatedTarget:gr,direction:this._orderToDirection(H),from:this._getItemIndex(Qe),to:Pr});if(bn(eo).defaultPrevented||!Qe||!gr)return;const Nr=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Pr),this._activeElement=gr;const fo=$t?"carousel-item-start":"carousel-item-end",Bo=$t?"carousel-item-next":"carousel-item-prev";gr.classList.add(Bo),Ne(gr),Qe.classList.add(fo),gr.classList.add(fo),this._queueCallback(()=>{gr.classList.remove(fo,Bo),gr.classList.add(Co),Qe.classList.remove(Co,Bo,fo),this._isSliding=!1,bn(co)},Qe,this._isAnimated()),Nr&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return _e.findOne(Vs,this._element)}_getItems(){return _e.find(Ns,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(H){return vt()?H===Ii?xi:vn:H===Ii?vn:xi}_orderToDirection(H){return vt()?H===xi?Ii:yo:H===xi?yo:Ii}static jQueryInterface(H){return this.each(function(){const se=oe.getOrCreateInstance(this,H);if(typeof H!="number"){if(typeof H=="string"){if(se[H]===void 0||H.startsWith("_")||H==="constructor")throw new TypeError(`No method named "${H}"`);se[H]()}}else se.to(H)})}}kt.on(document,Fs,"[data-bs-slide], [data-bs-slide-to]",function(et){const H=_e.getElementFromSelector(this);if(!H||!H.classList.contains(to))return;et.preventDefault();const se=oe.getOrCreateInstance(H),Qe=this.getAttribute("data-bs-slide-to");return Qe?(se.to(Qe),void se._maybeEnableCycle()):It.getDataAttribute(this,"slide")==="next"?(se.next(),void se._maybeEnableCycle()):(se.prev(),void se._maybeEnableCycle())}),kt.on(window,Vo,()=>{const et=_e.find('[data-bs-ride="carousel"]');for(const H of et)oe.getOrCreateInstance(H)}),zt(oe);const ve=".bs.collapse",Ce=`show${ve}`,Ie=`shown${ve}`,Ue=`hide${ve}`,ot=`hidden${ve}`,We=`click${ve}.data-api`,it="show",ut="collapse",at="collapsing",At=`:scope .${ut} .${ut}`,Gt='[data-bs-toggle="collapse"]',Ht={parent:null,toggle:!0},vr={parent:"(null|element)",toggle:"boolean"};class Er extends sr{constructor(H,se){super(H,se),this._isTransitioning=!1,this._triggerArray=[];const Qe=_e.find(Gt);for(const $t of Qe){const gr=_e.getSelectorFromElement($t),Pr=_e.find(gr).filter(bn=>bn===this._element);gr!==null&&Pr.length&&this._triggerArray.push($t)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Ht}static get DefaultType(){return vr}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let H=[];if(this._config.parent&&(H=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter($t=>$t!==this._element).map($t=>Er.getOrCreateInstance($t,{toggle:!1}))),H.length&&H[0]._isTransitioning||kt.trigger(this._element,Ce).defaultPrevented)return;for(const $t of H)$t.hide();const se=this._getDimension();this._element.classList.remove(ut),this._element.classList.add(at),this._element.style[se]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const Qe=`scroll${se[0].toUpperCase()+se.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(at),this._element.classList.add(ut,it),this._element.style[se]="",kt.trigger(this._element,Ie)},this._element,!0),this._element.style[se]=`${this._element[Qe]}px`}hide(){if(this._isTransitioning||!this._isShown()||kt.trigger(this._element,Ue).defaultPrevented)return;const H=this._getDimension();this._element.style[H]=`${this._element.getBoundingClientRect()[H]}px`,Ne(this._element),this._element.classList.add(at),this._element.classList.remove(ut,it);for(const se of this._triggerArray){const Qe=_e.getElementFromSelector(se);Qe&&!this._isShown(Qe)&&this._addAriaAndCollapsedClass([se],!1)}this._isTransitioning=!0,this._element.style[H]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(at),this._element.classList.add(ut),kt.trigger(this._element,ot)},this._element,!0)}_isShown(H=this._element){return H.classList.contains(it)}_configAfterMerge(H){return H.toggle=!!H.toggle,H.parent=Q(H.parent),H}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const H=this._getFirstLevelChildren(Gt);for(const se of H){const Qe=_e.getElementFromSelector(se);Qe&&this._addAriaAndCollapsedClass([se],this._isShown(Qe))}}_getFirstLevelChildren(H){const se=_e.find(At,this._config.parent);return _e.find(H,this._config.parent).filter(Qe=>!se.includes(Qe))}_addAriaAndCollapsedClass(H,se){if(H.length)for(const Qe of H)Qe.classList.toggle("collapsed",!se),Qe.setAttribute("aria-expanded",se)}static jQueryInterface(H){const se={};return typeof H=="string"&&/show|hide/.test(H)&&(se.toggle=!1),this.each(function(){const Qe=Er.getOrCreateInstance(this,se);if(typeof H=="string"){if(Qe[H]===void 0)throw new TypeError(`No method named "${H}"`);Qe[H]()}})}}kt.on(document,We,Gt,function(et){(et.target.tagName==="A"||et.delegateTarget&&et.delegateTarget.tagName==="A")&&et.preventDefault();for(const H of _e.getMultipleElementsFromSelector(this))Er.getOrCreateInstance(H,{toggle:!1}).toggle()}),zt(Er);const Rr="dropdown",br=".bs.dropdown",on=".data-api",pn="ArrowUp",Or="ArrowDown",mn=`hide${br}`,Bn=`hidden${br}`,pi=`show${br}`,mi=`shown${br}`,gi=`click${br}${on}`,ji=`keydown${br}${on}`,Uo=`keyup${br}${on}`,Cs="show",ko='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',pa=`${ko}.${Cs}`,js=".dropdown-menu",$s=vt()?"top-end":"top-start",ol=vt()?"top-start":"top-end",Ml=vt()?"bottom-end":"bottom-start",La=vt()?"bottom-start":"bottom-end",Oa=vt()?"left-start":"right-start",Po=vt()?"right-start":"left-start",Mo={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Do={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class ci extends sr{constructor(H,se){super(H,se),this._popper=null,this._parent=this._element.parentNode,this._menu=_e.next(this._element,js)[0]||_e.prev(this._element,js)[0]||_e.findOne(js,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Mo}static get DefaultType(){return Do}static get NAME(){return Rr}toggle(){return this._isShown()?this.hide():this.show()}show(){if(we(this._element)||this._isShown())return;const H={relatedTarget:this._element};if(!kt.trigger(this._element,pi,H).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const se of[].concat(...document.body.children))kt.on(se,"mouseover",$e);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Cs),this._element.classList.add(Cs),kt.trigger(this._element,mi,H)}}hide(){if(we(this._element)||!this._isShown())return;const H={relatedTarget:this._element};this._completeHide(H)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(H){if(!kt.trigger(this._element,mn,H).defaultPrevented){if("ontouchstart"in document.documentElement)for(const se of[].concat(...document.body.children))kt.off(se,"mouseover",$e);this._popper&&this._popper.destroy(),this._menu.classList.remove(Cs),this._element.classList.remove(Cs),this._element.setAttribute("aria-expanded","false"),It.removeDataAttribute(this._menu,"popper"),kt.trigger(this._element,Bn,H)}}_getConfig(H){if(typeof(H=super._getConfig(H)).reference=="object"&&!W(H.reference)&&typeof H.reference.getBoundingClientRect!="function")throw new TypeError(`${Rr.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return H}_createPopper(){if(g===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let H=this._element;this._config.reference==="parent"?H=this._parent:W(this._config.reference)?H=Q(this._config.reference):typeof this._config.reference=="object"&&(H=this._config.reference);const se=this._getPopperConfig();this._popper=g.createPopper(H,this._menu,se)}_isShown(){return this._menu.classList.contains(Cs)}_getPlacement(){const H=this._parent;if(H.classList.contains("dropend"))return Oa;if(H.classList.contains("dropstart"))return Po;if(H.classList.contains("dropup-center"))return"top";if(H.classList.contains("dropdown-center"))return"bottom";const se=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return H.classList.contains("dropup")?se?ol:$s:se?La:Ml}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:H}=this._config;return typeof H=="string"?H.split(",").map(se=>Number.parseInt(se,10)):typeof H=="function"?se=>H(se,this._element):H}_getPopperConfig(){const H={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(It.setDataAttribute(this._menu,"popper","static"),H.modifiers=[{name:"applyStyles",enabled:!1}]),{...H,...Ct(this._config.popperConfig,[H])}}_selectMenuItem({key:H,target:se}){const Qe=_e.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter($t=>ae($t));Qe.length&&qe(Qe,se,H===Or,!Qe.includes(se)).focus()}static jQueryInterface(H){return this.each(function(){const se=ci.getOrCreateInstance(this,H);if(typeof H=="string"){if(se[H]===void 0)throw new TypeError(`No method named "${H}"`);se[H]()}})}static clearMenus(H){if(H.button===2||H.type==="keyup"&&H.key!=="Tab")return;const se=_e.find(pa);for(const Qe of se){const $t=ci.getInstance(Qe);if(!$t||$t._config.autoClose===!1)continue;const gr=H.composedPath(),Pr=gr.includes($t._menu);if(gr.includes($t._element)||$t._config.autoClose==="inside"&&!Pr||$t._config.autoClose==="outside"&&Pr||$t._menu.contains(H.target)&&(H.type==="keyup"&&H.key==="Tab"||/input|select|option|textarea|form/i.test(H.target.tagName)))continue;const bn={relatedTarget:$t._element};H.type==="click"&&(bn.clickEvent=H),$t._completeHide(bn)}}static dataApiKeydownHandler(H){const se=/input|textarea/i.test(H.target.tagName),Qe=H.key==="Escape",$t=[pn,Or].includes(H.key);if(!$t&&!Qe||se&&!Qe)return;H.preventDefault();const gr=this.matches(ko)?this:_e.prev(this,ko)[0]||_e.next(this,ko)[0]||_e.findOne(ko,H.delegateTarget.parentNode),Pr=ci.getOrCreateInstance(gr);if($t)return H.stopPropagation(),Pr.show(),void Pr._selectMenuItem(H);Pr._isShown()&&(H.stopPropagation(),Pr.hide(),gr.focus())}}kt.on(document,ji,ko,ci.dataApiKeydownHandler),kt.on(document,ji,js,ci.dataApiKeydownHandler),kt.on(document,gi,ci.clearMenus),kt.on(document,Uo,ci.clearMenus),kt.on(document,gi,ko,function(et){et.preventDefault(),ci.getOrCreateInstance(this).toggle()}),zt(ci);const Zi="backdrop",uo="show",ma=`mousedown.bs.${Zi}`,Ba={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},jo={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class $n extends lr{constructor(H){super(),this._config=this._getConfig(H),this._isAppended=!1,this._element=null}static get Default(){return Ba}static get DefaultType(){return jo}static get NAME(){return Zi}show(H){if(!this._config.isVisible)return void Ct(H);this._append();const se=this._getElement();this._config.isAnimated&&Ne(se),se.classList.add(uo),this._emulateAnimation(()=>{Ct(H)})}hide(H){this._config.isVisible?(this._getElement().classList.remove(uo),this._emulateAnimation(()=>{this.dispose(),Ct(H)})):Ct(H)}dispose(){this._isAppended&&(kt.off(this._element,ma),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const H=document.createElement("div");H.className=this._config.className,this._config.isAnimated&&H.classList.add("fade"),this._element=H}return this._element}_configAfterMerge(H){return H.rootElement=Q(H.rootElement),H}_append(){if(this._isAppended)return;const H=this._getElement();this._config.rootElement.append(H),kt.on(H,ma,()=>{Ct(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(H){qt(H,this._getElement(),this._config.isAnimated)}}const qs=".bs.focustrap",sl=`focusin${qs}`,$i=`keydown.tab${qs}`,Rs="backward",za={autofocus:!0,trapElement:null},Fa={autofocus:"boolean",trapElement:"element"};class Dl extends lr{constructor(H){super(),this._config=this._getConfig(H),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return za}static get DefaultType(){return Fa}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),kt.off(document,qs),kt.on(document,sl,H=>this._handleFocusin(H)),kt.on(document,$i,H=>this._handleKeydown(H)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,kt.off(document,qs))}_handleFocusin(H){const{trapElement:se}=this._config;if(H.target===document||H.target===se||se.contains(H.target))return;const Qe=_e.focusableChildren(se);Qe.length===0?se.focus():this._lastTabNavDirection===Rs?Qe[Qe.length-1].focus():Qe[0].focus()}_handleKeydown(H){H.key==="Tab"&&(this._lastTabNavDirection=H.shiftKey?Rs:"forward")}}const ga=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Ll=".sticky-top",Gr="padding-right",$o="margin-right";class an{constructor(){this._element=document.body}getWidth(){const H=document.documentElement.clientWidth;return Math.abs(window.innerWidth-H)}hide(){const H=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Gr,se=>se+H),this._setElementAttributes(ga,Gr,se=>se+H),this._setElementAttributes(Ll,$o,se=>se-H)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Gr),this._resetElementAttributes(ga,Gr),this._resetElementAttributes(Ll,$o)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(H,se,Qe){const $t=this.getWidth();this._applyManipulationCallback(H,gr=>{if(gr!==this._element&&window.innerWidth>gr.clientWidth+$t)return;this._saveInitialAttribute(gr,se);const Pr=window.getComputedStyle(gr).getPropertyValue(se);gr.style.setProperty(se,`${Qe(Number.parseFloat(Pr))}px`)})}_saveInitialAttribute(H,se){const Qe=H.style.getPropertyValue(se);Qe&&It.setDataAttribute(H,se,Qe)}_resetElementAttributes(H,se){this._applyManipulationCallback(H,Qe=>{const $t=It.getDataAttribute(Qe,se);$t!==null?(It.removeDataAttribute(Qe,se),Qe.style.setProperty(se,$t)):Qe.style.removeProperty(se)})}_applyManipulationCallback(H,se){if(W(H))se(H);else for(const Qe of _e.find(H,this._element))se(Qe)}}const vo=".bs.modal",xr=`hide${vo}`,cs=`hidePrevented${vo}`,Gs=`hidden${vo}`,_a=`show${vo}`,us=`shown${vo}`,qo=`resize${vo}`,Go=`click.dismiss${vo}`,er=`mousedown.dismiss${vo}`,Wr=`keydown.dismiss${vo}`,Kr=`click${vo}.data-api`,ro="modal-open",Ai="show",Hr="modal-static",al={backdrop:!0,focus:!0,keyboard:!0},Hs={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Pn extends sr{constructor(H,se){super(H,se),this._dialog=_e.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new an,this._addEventListeners()}static get Default(){return al}static get DefaultType(){return Hs}static get NAME(){return"modal"}toggle(H){return this._isShown?this.hide():this.show(H)}show(H){this._isShown||this._isTransitioning||kt.trigger(this._element,_a,{relatedTarget:H}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(ro),this._adjustDialog(),this._backdrop.show(()=>this._showElement(H)))}hide(){this._isShown&&!this._isTransitioning&&(kt.trigger(this._element,xr).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Ai),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){kt.off(window,vo),kt.off(this._dialog,vo),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new $n({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Dl({trapElement:this._element})}_showElement(H){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const se=_e.findOne(".modal-body",this._dialog);se&&(se.scrollTop=0),Ne(this._element),this._element.classList.add(Ai),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,kt.trigger(this._element,us,{relatedTarget:H})},this._dialog,this._isAnimated())}_addEventListeners(){kt.on(this._element,Wr,H=>{H.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),kt.on(window,qo,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),kt.on(this._element,er,H=>{kt.one(this._element,Go,se=>{this._element===H.target&&this._element===se.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(ro),this._resetAdjustments(),this._scrollBar.reset(),kt.trigger(this._element,Gs)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(kt.trigger(this._element,cs).defaultPrevented)return;const H=this._element.scrollHeight>document.documentElement.clientHeight,se=this._element.style.overflowY;se==="hidden"||this._element.classList.contains(Hr)||(H||(this._element.style.overflowY="hidden"),this._element.classList.add(Hr),this._queueCallback(()=>{this._element.classList.remove(Hr),this._queueCallback(()=>{this._element.style.overflowY=se},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const H=this._element.scrollHeight>document.documentElement.clientHeight,se=this._scrollBar.getWidth(),Qe=se>0;if(Qe&&!H){const $t=vt()?"paddingLeft":"paddingRight";this._element.style[$t]=`${se}px`}if(!Qe&&H){const $t=vt()?"paddingRight":"paddingLeft";this._element.style[$t]=`${se}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(H,se){return this.each(function(){const Qe=Pn.getOrCreateInstance(this,H);if(typeof H=="string"){if(Qe[H]===void 0)throw new TypeError(`No method named "${H}"`);Qe[H](se)}})}}kt.on(document,Kr,'[data-bs-toggle="modal"]',function(et){const H=_e.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&et.preventDefault(),kt.one(H,_a,Qe=>{Qe.defaultPrevented||kt.one(H,Gs,()=>{ae(this)&&this.focus()})});const se=_e.findOne(".modal.show");se&&Pn.getInstance(se).hide(),Pn.getOrCreateInstance(H).toggle(this)}),un(Pn),zt(Pn);const _i=".bs.offcanvas",ei=".data-api",dc=`load${_i}${ei}`,Ws="show",Zs="showing",ho="hiding",Na=".offcanvas.show",Si=`show${_i}`,Xi=`shown${_i}`,io=`hide${_i}`,ya=`hidePrevented${_i}`,hs=`hidden${_i}`,ii=`resize${_i}`,qi=`click${_i}${ei}`,Lo=`keydown.dismiss${_i}`,yi={backdrop:!0,keyboard:!0,scroll:!1},fc={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Di extends sr{constructor(H,se){super(H,se),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return yi}static get DefaultType(){return fc}static get NAME(){return"offcanvas"}toggle(H){return this._isShown?this.hide():this.show(H)}show(H){this._isShown||kt.trigger(this._element,Si,{relatedTarget:H}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new an().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Zs),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Ws),this._element.classList.remove(Zs),kt.trigger(this._element,Xi,{relatedTarget:H})},this._element,!0))}hide(){this._isShown&&(kt.trigger(this._element,io).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(ho),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(Ws,ho),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new an().reset(),kt.trigger(this._element,hs)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const H=!!this._config.backdrop;return new $n({className:"offcanvas-backdrop",isVisible:H,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:H?()=>{this._config.backdrop!=="static"?this.hide():kt.trigger(this._element,ya)}:null})}_initializeFocusTrap(){return new Dl({trapElement:this._element})}_addEventListeners(){kt.on(this._element,Lo,H=>{H.key==="Escape"&&(this._config.keyboard?this.hide():kt.trigger(this._element,ya))})}static jQueryInterface(H){return this.each(function(){const se=Di.getOrCreateInstance(this,H);if(typeof H=="string"){if(se[H]===void 0||H.startsWith("_")||H==="constructor")throw new TypeError(`No method named "${H}"`);se[H](this)}})}}kt.on(document,qi,'[data-bs-toggle="offcanvas"]',function(et){const H=_e.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&et.preventDefault(),we(this))return;kt.one(H,hs,()=>{ae(this)&&this.focus()});const se=_e.findOne(Na);se&&se!==H&&Di.getInstance(se).hide(),Di.getOrCreateInstance(H).toggle(this)}),kt.on(window,dc,()=>{for(const et of _e.find(Na))Di.getOrCreateInstance(et).show()}),kt.on(window,ii,()=>{for(const et of _e.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(et).position!=="fixed"&&Di.getOrCreateInstance(et).hide()}),un(Di),zt(Di);const Ho={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Xs=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Ks=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,Va=(et,H)=>{const se=et.nodeName.toLowerCase();return H.includes(se)?!Xs.has(se)||!!Ks.test(et.nodeValue):H.filter(Qe=>Qe instanceof RegExp).some(Qe=>Qe.test(se))},Wo={allowList:Ho,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Kc={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},ll={entry:"(string|element|function|null)",selector:"(string|element)"};class oo extends lr{constructor(H){super(),this._config=this._getConfig(H)}static get Default(){return Wo}static get DefaultType(){return Kc}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(H=>this._resolvePossibleFunction(H)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(H){return this._checkContent(H),this._config.content={...this._config.content,...H},this}toHtml(){const H=document.createElement("div");H.innerHTML=this._maybeSanitize(this._config.template);for(const[$t,gr]of Object.entries(this._config.content))this._setContent(H,gr,$t);const se=H.children[0],Qe=this._resolvePossibleFunction(this._config.extraClass);return Qe&&se.classList.add(...Qe.split(" ")),se}_typeCheckConfig(H){super._typeCheckConfig(H),this._checkContent(H.content)}_checkContent(H){for(const[se,Qe]of Object.entries(H))super._typeCheckConfig({selector:se,entry:Qe},ll)}_setContent(H,se,Qe){const $t=_e.findOne(Qe,H);$t&&((se=this._resolvePossibleFunction(se))?W(se)?this._putElementInTemplate(Q(se),$t):this._config.html?$t.innerHTML=this._maybeSanitize(se):$t.textContent=se:$t.remove())}_maybeSanitize(H){return this._config.sanitize?function(se,Qe,$t){if(!se.length)return se;if($t&&typeof $t=="function")return $t(se);const gr=new window.DOMParser().parseFromString(se,"text/html"),Pr=[].concat(...gr.body.querySelectorAll("*"));for(const bn of Pr){const Nr=bn.nodeName.toLowerCase();if(!Object.keys(Qe).includes(Nr)){bn.remove();continue}const fo=[].concat(...bn.attributes),Bo=[].concat(Qe["*"]||[],Qe[Nr]||[]);for(const Xo of fo)Va(Xo,Bo)||bn.removeAttribute(Xo.nodeName)}return gr.body.innerHTML}(H,this._config.allowList,this._config.sanitizeFn):H}_resolvePossibleFunction(H){return Ct(H,[this])}_putElementInTemplate(H,se){if(this._config.html)return se.innerHTML="",void se.append(H);se.textContent=H.textContent}}const Yc=new Set(["sanitize","allowList","sanitizeFn"]),Oo="fade",Ua="show",Ys=".modal",Js="hide.bs.modal",ja="hover",ds="focus",zi={AUTO:"auto",TOP:"top",RIGHT:vt()?"left":"right",BOTTOM:"bottom",LEFT:vt()?"right":"left"},Jc={allowList:Ho,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},va={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class bo extends sr{constructor(H,se){if(g===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(H,se),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Jc}static get DefaultType(){return va}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),kt.off(this._element.closest(Ys),Js,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const H=kt.trigger(this._element,this.constructor.eventName("show")),se=(He(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(H.defaultPrevented||!se)return;this._disposePopper();const Qe=this._getTipElement();this._element.setAttribute("aria-describedby",Qe.getAttribute("id"));const{container:$t}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||($t.append(Qe),kt.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(Qe),Qe.classList.add(Ua),"ontouchstart"in document.documentElement)for(const gr of[].concat(...document.body.children))kt.on(gr,"mouseover",$e);this._queueCallback(()=>{kt.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!kt.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Ua),"ontouchstart"in document.documentElement)for(const H of[].concat(...document.body.children))kt.off(H,"mouseover",$e);this._activeTrigger.click=!1,this._activeTrigger[ds]=!1,this._activeTrigger[ja]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),kt.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(H){const se=this._getTemplateFactory(H).toHtml();if(!se)return null;se.classList.remove(Oo,Ua),se.classList.add(`bs-${this.constructor.NAME}-auto`);const Qe=($t=>{do $t+=Math.floor(1e6*Math.random());while(document.getElementById($t));return $t})(this.constructor.NAME).toString();return se.setAttribute("id",Qe),this._isAnimated()&&se.classList.add(Oo),se}setContent(H){this._newContent=H,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(H){return this._templateFactory?this._templateFactory.changeContent(H):this._templateFactory=new oo({...this._config,content:H,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(H){return this.constructor.getOrCreateInstance(H.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Oo)}_isShown(){return this.tip&&this.tip.classList.contains(Ua)}_createPopper(H){const se=Ct(this._config.placement,[this,H,this._element]),Qe=zi[se.toUpperCase()];return g.createPopper(this._element,H,this._getPopperConfig(Qe))}_getOffset(){const{offset:H}=this._config;return typeof H=="string"?H.split(",").map(se=>Number.parseInt(se,10)):typeof H=="function"?se=>H(se,this._element):H}_resolvePossibleFunction(H){return Ct(H,[this._element])}_getPopperConfig(H){const se={placement:H,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:Qe=>{this._getTipElement().setAttribute("data-popper-placement",Qe.state.placement)}}]};return{...se,...Ct(this._config.popperConfig,[se])}}_setListeners(){const H=this._config.trigger.split(" ");for(const se of H)if(se==="click")kt.on(this._element,this.constructor.eventName("click"),this._config.selector,Qe=>{this._initializeOnDelegatedTarget(Qe).toggle()});else if(se!=="manual"){const Qe=se===ja?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),$t=se===ja?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");kt.on(this._element,Qe,this._config.selector,gr=>{const Pr=this._initializeOnDelegatedTarget(gr);Pr._activeTrigger[gr.type==="focusin"?ds:ja]=!0,Pr._enter()}),kt.on(this._element,$t,this._config.selector,gr=>{const Pr=this._initializeOnDelegatedTarget(gr);Pr._activeTrigger[gr.type==="focusout"?ds:ja]=Pr._element.contains(gr.relatedTarget),Pr._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},kt.on(this._element.closest(Ys),Js,this._hideModalHandler)}_fixTitle(){const H=this._element.getAttribute("title");H&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",H),this._element.setAttribute("data-bs-original-title",H),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(H,se){clearTimeout(this._timeout),this._timeout=setTimeout(H,se)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(H){const se=It.getDataAttributes(this._element);for(const Qe of Object.keys(se))Yc.has(Qe)&&delete se[Qe];return H={...se,...typeof H=="object"&&H?H:{}},H=this._mergeConfigObj(H),H=this._configAfterMerge(H),this._typeCheckConfig(H),H}_configAfterMerge(H){return H.container=H.container===!1?document.body:Q(H.container),typeof H.delay=="number"&&(H.delay={show:H.delay,hide:H.delay}),typeof H.title=="number"&&(H.title=H.title.toString()),typeof H.content=="number"&&(H.content=H.content.toString()),H}_getDelegateConfig(){const H={};for(const[se,Qe]of Object.entries(this._config))this.constructor.Default[se]!==Qe&&(H[se]=Qe);return H.selector=!1,H.trigger="manual",H}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(H){return this.each(function(){const se=bo.getOrCreateInstance(this,H);if(typeof H=="string"){if(se[H]===void 0)throw new TypeError(`No method named "${H}"`);se[H]()}})}}zt(bo);const D={...bo.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},X={...bo.DefaultType,content:"(null|string|element|function)"};class te extends bo{static get Default(){return D}static get DefaultType(){return X}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(H){return this.each(function(){const se=te.getOrCreateInstance(this,H);if(typeof H=="string"){if(se[H]===void 0)throw new TypeError(`No method named "${H}"`);se[H]()}})}}zt(te);const fe=".bs.scrollspy",_t=`activate${fe}`,st=`click${fe}`,ur=`load${fe}.data-api`,Tn="active",cr="[href]",Sn=".nav-link",Fi=`${Sn}, .nav-item > ${Sn}, .list-group-item`,Gi={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},xo={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Ci extends sr{constructor(H,se){super(H,se),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Gi}static get DefaultType(){return xo}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const H of this._observableSections.values())this._observer.observe(H)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(H){return H.target=Q(H.target)||document.body,H.rootMargin=H.offset?`${H.offset}px 0px -30%`:H.rootMargin,typeof H.threshold=="string"&&(H.threshold=H.threshold.split(",").map(se=>Number.parseFloat(se))),H}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(kt.off(this._config.target,st),kt.on(this._config.target,st,cr,H=>{const se=this._observableSections.get(H.target.hash);if(se){H.preventDefault();const Qe=this._rootElement||window,$t=se.offsetTop-this._element.offsetTop;if(Qe.scrollTo)return void Qe.scrollTo({top:$t,behavior:"smooth"});Qe.scrollTop=$t}}))}_getNewObserver(){const H={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(se=>this._observerCallback(se),H)}_observerCallback(H){const se=Pr=>this._targetLinks.get(`#${Pr.target.id}`),Qe=Pr=>{this._previousScrollData.visibleEntryTop=Pr.target.offsetTop,this._process(se(Pr))},$t=(this._rootElement||document.documentElement).scrollTop,gr=$t>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=$t;for(const Pr of H){if(!Pr.isIntersecting){this._activeTarget=null,this._clearActiveClass(se(Pr));continue}const bn=Pr.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(gr&&bn){if(Qe(Pr),!$t)return}else gr||bn||Qe(Pr)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const H=_e.find(cr,this._config.target);for(const se of H){if(!se.hash||we(se))continue;const Qe=_e.findOne(decodeURI(se.hash),this._element);ae(Qe)&&(this._targetLinks.set(decodeURI(se.hash),se),this._observableSections.set(se.hash,Qe))}}_process(H){this._activeTarget!==H&&(this._clearActiveClass(this._config.target),this._activeTarget=H,H.classList.add(Tn),this._activateParents(H),kt.trigger(this._element,_t,{relatedTarget:H}))}_activateParents(H){if(H.classList.contains("dropdown-item"))_e.findOne(".dropdown-toggle",H.closest(".dropdown")).classList.add(Tn);else for(const se of _e.parents(H,".nav, .list-group"))for(const Qe of _e.prev(se,Fi))Qe.classList.add(Tn)}_clearActiveClass(H){H.classList.remove(Tn);const se=_e.find(`${cr}.${Tn}`,H);for(const Qe of se)Qe.classList.remove(Tn)}static jQueryInterface(H){return this.each(function(){const se=Ci.getOrCreateInstance(this,H);if(typeof H=="string"){if(se[H]===void 0||H.startsWith("_")||H==="constructor")throw new TypeError(`No method named "${H}"`);se[H]()}})}}kt.on(window,ur,()=>{for(const et of _e.find('[data-bs-spy="scroll"]'))Ci.getOrCreateInstance(et)}),zt(Ci);const ti=".bs.tab",$a=`hide${ti}`,Ol=`hidden${ti}`,Bl=`show${ti}`,Qc=`shown${ti}`,ba=`click${ti}`,oi=`keydown${ti}`,ch=`load${ti}`,Ut="ArrowLeft",uh="ArrowRight",zl="ArrowUp",pc="ArrowDown",Fl="Home",mc="End",wo="active",eu="fade",To="show",gc=".dropdown-toggle",qa=`:not(${gc})`,hh='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',tu=`.nav-link${qa}, .list-group-item${qa}, [role="tab"]${qa}, ${hh}`,Zo=`.${wo}[data-bs-toggle="tab"], .${wo}[data-bs-toggle="pill"], .${wo}[data-bs-toggle="list"]`;class Ga extends sr{constructor(H){super(H),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),kt.on(this._element,oi,se=>this._keydown(se)))}static get NAME(){return"tab"}show(){const H=this._element;if(this._elemIsActive(H))return;const se=this._getActiveElem(),Qe=se?kt.trigger(se,$a,{relatedTarget:H}):null;kt.trigger(H,Bl,{relatedTarget:se}).defaultPrevented||Qe&&Qe.defaultPrevented||(this._deactivate(se,H),this._activate(H,se))}_activate(H,se){H&&(H.classList.add(wo),this._activate(_e.getElementFromSelector(H)),this._queueCallback(()=>{H.getAttribute("role")==="tab"?(H.removeAttribute("tabindex"),H.setAttribute("aria-selected",!0),this._toggleDropDown(H,!0),kt.trigger(H,Qc,{relatedTarget:se})):H.classList.add(To)},H,H.classList.contains(eu)))}_deactivate(H,se){H&&(H.classList.remove(wo),H.blur(),this._deactivate(_e.getElementFromSelector(H)),this._queueCallback(()=>{H.getAttribute("role")==="tab"?(H.setAttribute("aria-selected",!1),H.setAttribute("tabindex","-1"),this._toggleDropDown(H,!1),kt.trigger(H,Ol,{relatedTarget:se})):H.classList.remove(To)},H,H.classList.contains(eu)))}_keydown(H){if(![Ut,uh,zl,pc,Fl,mc].includes(H.key))return;H.stopPropagation(),H.preventDefault();const se=this._getChildren().filter($t=>!we($t));let Qe;if([Fl,mc].includes(H.key))Qe=se[H.key===Fl?0:se.length-1];else{const $t=[uh,pc].includes(H.key);Qe=qe(se,H.target,$t,!0)}Qe&&(Qe.focus({preventScroll:!0}),Ga.getOrCreateInstance(Qe).show())}_getChildren(){return _e.find(tu,this._parent)}_getActiveElem(){return this._getChildren().find(H=>this._elemIsActive(H))||null}_setInitialAttributes(H,se){this._setAttributeIfNotExists(H,"role","tablist");for(const Qe of se)this._setInitialAttributesOnChild(Qe)}_setInitialAttributesOnChild(H){H=this._getInnerElement(H);const se=this._elemIsActive(H),Qe=this._getOuterElement(H);H.setAttribute("aria-selected",se),Qe!==H&&this._setAttributeIfNotExists(Qe,"role","presentation"),se||H.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(H,"role","tab"),this._setInitialAttributesOnTargetPanel(H)}_setInitialAttributesOnTargetPanel(H){const se=_e.getElementFromSelector(H);se&&(this._setAttributeIfNotExists(se,"role","tabpanel"),H.id&&this._setAttributeIfNotExists(se,"aria-labelledby",`${H.id}`))}_toggleDropDown(H,se){const Qe=this._getOuterElement(H);if(!Qe.classList.contains("dropdown"))return;const $t=(gr,Pr)=>{const bn=_e.findOne(gr,Qe);bn&&bn.classList.toggle(Pr,se)};$t(gc,wo),$t(".dropdown-menu",To),Qe.setAttribute("aria-expanded",se)}_setAttributeIfNotExists(H,se,Qe){H.hasAttribute(se)||H.setAttribute(se,Qe)}_elemIsActive(H){return H.classList.contains(wo)}_getInnerElement(H){return H.matches(tu)?H:_e.findOne(tu,H)}_getOuterElement(H){return H.closest(".nav-item, .list-group-item")||H}static jQueryInterface(H){return this.each(function(){const se=Ga.getOrCreateInstance(this);if(typeof H=="string"){if(se[H]===void 0||H.startsWith("_")||H==="constructor")throw new TypeError(`No method named "${H}"`);se[H]()}})}}kt.on(document,ba,hh,function(et){["A","AREA"].includes(this.tagName)&&et.preventDefault(),we(this)||Ga.getOrCreateInstance(this).show()}),kt.on(window,ch,()=>{for(const et of _e.find(Zo))Ga.getOrCreateInstance(et)}),zt(Ga);const Qs=".bs.toast",dh=`mouseover${Qs}`,ru=`mouseout${Qs}`,gd=`focusin${Qs}`,_d=`focusout${Qs}`,yd=`hide${Qs}`,vd=`hidden${Qs}`,fh=`show${Qs}`,bd=`shown${Qs}`,Nl="hide",cl="show",Ha="showing",Vl={animation:"boolean",autohide:"boolean",delay:"number"},_c={animation:!0,autohide:!0,delay:5e3};class Wa extends sr{constructor(H,se){super(H,se),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return _c}static get DefaultType(){return Vl}static get NAME(){return"toast"}show(){kt.trigger(this._element,fh).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(Nl),Ne(this._element),this._element.classList.add(cl,Ha),this._queueCallback(()=>{this._element.classList.remove(Ha),kt.trigger(this._element,bd),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(kt.trigger(this._element,yd).defaultPrevented||(this._element.classList.add(Ha),this._queueCallback(()=>{this._element.classList.add(Nl),this._element.classList.remove(Ha,cl),kt.trigger(this._element,vd)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(cl),super.dispose()}isShown(){return this._element.classList.contains(cl)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(H,se){switch(H.type){case"mouseover":case"mouseout":this._hasMouseInteraction=se;break;case"focusin":case"focusout":this._hasKeyboardInteraction=se}if(se)return void this._clearTimeout();const Qe=H.relatedTarget;this._element===Qe||this._element.contains(Qe)||this._maybeScheduleHide()}_setListeners(){kt.on(this._element,dh,H=>this._onInteraction(H,!0)),kt.on(this._element,ru,H=>this._onInteraction(H,!1)),kt.on(this._element,gd,H=>this._onInteraction(H,!0)),kt.on(this._element,_d,H=>this._onInteraction(H,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(H){return this.each(function(){const se=Wa.getOrCreateInstance(this,H);if(typeof H=="string"){if(se[H]===void 0)throw new TypeError(`No method named "${H}"`);se[H](this)}})}}return un(Wa),zt(Wa),{Alert:jt,Button:Zt,Carousel:oe,Collapse:Er,Dropdown:ci,Modal:Pn,Offcanvas:Di,Popover:te,ScrollSpy:Ci,Tab:Ga,Toast:Wa,Tooltip:bo}})})(VB);/**
* @vue/shared v3.4.37
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function F1(n,e){const i=new Set(n.split(","));return u=>i.has(u)}const Wi={},wf=[],nl=()=>{},kz=()=>!1,C0=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),N1=n=>n.startsWith("onUpdate:"),As=Object.assign,V1=(n,e)=>{const i=n.indexOf(e);i>-1&&n.splice(i,1)},Pz=Object.prototype.hasOwnProperty,Qn=(n,e)=>Pz.call(n,e),sn=Array.isArray,Tf=n=>Sg(n)==="[object Map]",R0=n=>Sg(n)==="[object Set]",OA=n=>Sg(n)==="[object Date]",wn=n=>typeof n=="function",So=n=>typeof n=="string",uc=n=>typeof n=="symbol",Bi=n=>n!==null&&typeof n=="object",GR=n=>(Bi(n)||wn(n))&&wn(n.then)&&wn(n.catch),HR=Object.prototype.toString,Sg=n=>HR.call(n),Mz=n=>Sg(n).slice(8,-1),WR=n=>Sg(n)==="[object Object]",U1=n=>So(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,qm=F1(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),k0=n=>{const e=Object.create(null);return i=>e[i]||(e[i]=n(i))},Dz=/-(\w)/g,Sl=k0(n=>n.replace(Dz,(e,i)=>i?i.toUpperCase():"")),Lz=/\B([A-Z])/g,rh=k0(n=>n.replace(Lz,"-$1").toLowerCase()),P0=k0(n=>n.charAt(0).toUpperCase()+n.slice(1)),tx=k0(n=>n?`on${P0(n)}`:""),Yu=(n,e)=>!Object.is(n,e),ky=(n,...e)=>{for(let i=0;i<n.length;i++)n[i](...e)},ZR=(n,e,i,u=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:u,value:i})},Yy=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let BA;const XR=()=>BA||(BA=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function j1(n){if(sn(n)){const e={};for(let i=0;i<n.length;i++){const u=n[i],g=So(u)?Fz(u):j1(u);if(g)for(const b in g)e[b]=g[b]}return e}else if(So(n)||Bi(n))return n}const Oz=/;(?![^(]*\))/g,Bz=/:([^]+)/,zz=/\/\*[^]*?\*\//g;function Fz(n){const e={};return n.replace(zz,"").split(Oz).forEach(i=>{if(i){const u=i.split(Bz);u.length>1&&(e[u[0].trim()]=u[1].trim())}}),e}function Cg(n){let e="";if(So(n))e=n;else if(sn(n))for(let i=0;i<n.length;i++){const u=Cg(n[i]);u&&(e+=u+" ")}else if(Bi(n))for(const i in n)n[i]&&(e+=i+" ");return e.trim()}const Nz="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Vz=F1(Nz);function KR(n){return!!n||n===""}function Uz(n,e){if(n.length!==e.length)return!1;let i=!0;for(let u=0;i&&u<n.length;u++)i=M0(n[u],e[u]);return i}function M0(n,e){if(n===e)return!0;let i=OA(n),u=OA(e);if(i||u)return i&&u?n.getTime()===e.getTime():!1;if(i=uc(n),u=uc(e),i||u)return n===e;if(i=sn(n),u=sn(e),i||u)return i&&u?Uz(n,e):!1;if(i=Bi(n),u=Bi(e),i||u){if(!i||!u)return!1;const g=Object.keys(n).length,b=Object.keys(e).length;if(g!==b)return!1;for(const I in n){const L=n.hasOwnProperty(I),s=e.hasOwnProperty(I);if(L&&!s||!L&&s||!M0(n[I],e[I]))return!1}}return String(n)===String(e)}function jz(n,e){return n.findIndex(i=>M0(i,e))}const YR=n=>!!(n&&n.__v_isRef===!0),Vn=n=>So(n)?n:n==null?"":sn(n)||Bi(n)&&(n.toString===HR||!wn(n.toString))?YR(n)?Vn(n.value):JSON.stringify(n,JR,2):String(n),JR=(n,e)=>YR(e)?JR(n,e.value):Tf(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((i,[u,g],b)=>(i[rx(u,b)+" =>"]=g,i),{})}:R0(e)?{[`Set(${e.size})`]:[...e.values()].map(i=>rx(i))}:uc(e)?rx(e):Bi(e)&&!sn(e)&&!WR(e)?String(e):e,rx=(n,e="")=>{var i;return uc(n)?`Symbol(${(i=n.description)!=null?i:e})`:n};/**
* @vue/reactivity v3.4.37
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Tl;class $z{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Tl,!e&&Tl&&(this.index=(Tl.scopes||(Tl.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const i=Tl;try{return Tl=this,e()}finally{Tl=i}}}on(){Tl=this}off(){Tl=this.parent}stop(e){if(this._active){let i,u;for(i=0,u=this.effects.length;i<u;i++)this.effects[i].stop();for(i=0,u=this.cleanups.length;i<u;i++)this.cleanups[i]();if(this.scopes)for(i=0,u=this.scopes.length;i<u;i++)this.scopes[i].stop(!0);if(!this.detached&&this.parent&&!e){const g=this.parent.scopes.pop();g&&g!==this&&(this.parent.scopes[this.index]=g,g.index=this.index)}this.parent=void 0,this._active=!1}}}function qz(n,e=Tl){e&&e.active&&e.effects.push(n)}function Gz(){return Tl}let Yh;class $1{constructor(e,i,u,g){this.fn=e,this.trigger=i,this.scheduler=u,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,qz(this,g)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,nh();for(let e=0;e<this._depsLength;e++){const i=this.deps[e];if(i.computed&&(Hz(i.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),ih()}return this._dirtyLevel>=4}set dirty(e){this._dirtyLevel=e?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let e=Gu,i=Yh;try{return Gu=!0,Yh=this,this._runnings++,zA(this),this.fn()}finally{FA(this),this._runnings--,Yh=i,Gu=e}}stop(){this.active&&(zA(this),FA(this),this.onStop&&this.onStop(),this.active=!1)}}function Hz(n){return n.value}function zA(n){n._trackId++,n._depsLength=0}function FA(n){if(n.deps.length>n._depsLength){for(let e=n._depsLength;e<n.deps.length;e++)QR(n.deps[e],n);n.deps.length=n._depsLength}}function QR(n,e){const i=n.get(e);i!==void 0&&e._trackId!==i&&(n.delete(e),n.size===0&&n.cleanup())}let Gu=!0,Dx=0;const ek=[];function nh(){ek.push(Gu),Gu=!1}function ih(){const n=ek.pop();Gu=n===void 0?!0:n}function q1(){Dx++}function G1(){for(Dx--;!Dx&&Lx.length;)Lx.shift()()}function tk(n,e,i){if(e.get(n)!==n._trackId){e.set(n,n._trackId);const u=n.deps[n._depsLength];u!==e?(u&&QR(u,n),n.deps[n._depsLength++]=e):n._depsLength++}}const Lx=[];function rk(n,e,i){q1();for(const u of n.keys()){let g;u._dirtyLevel<e&&(g??(g=n.get(u)===u._trackId))&&(u._shouldSchedule||(u._shouldSchedule=u._dirtyLevel===0),u._dirtyLevel=e),u._shouldSchedule&&(g??(g=n.get(u)===u._trackId))&&(u.trigger(),(!u._runnings||u.allowRecurse)&&u._dirtyLevel!==2&&(u._shouldSchedule=!1,u.scheduler&&Lx.push(u.scheduler)))}G1()}const nk=(n,e)=>{const i=new Map;return i.cleanup=n,i.computed=e,i},Ox=new WeakMap,Jh=Symbol(""),Bx=Symbol("");function da(n,e,i){if(Gu&&Yh){let u=Ox.get(n);u||Ox.set(n,u=new Map);let g=u.get(i);g||u.set(i,g=nk(()=>u.delete(i))),tk(Yh,g)}}function zc(n,e,i,u,g,b){const I=Ox.get(n);if(!I)return;let L=[];if(e==="clear")L=[...I.values()];else if(i==="length"&&sn(n)){const s=Number(u);I.forEach(($,W)=>{(W==="length"||!uc(W)&&W>=s)&&L.push($)})}else switch(i!==void 0&&L.push(I.get(i)),e){case"add":sn(n)?U1(i)&&L.push(I.get("length")):(L.push(I.get(Jh)),Tf(n)&&L.push(I.get(Bx)));break;case"delete":sn(n)||(L.push(I.get(Jh)),Tf(n)&&L.push(I.get(Bx)));break;case"set":Tf(n)&&L.push(I.get(Jh));break}q1();for(const s of L)s&&rk(s,4);G1()}const Wz=F1("__proto__,__v_isRef,__isVue"),ik=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(uc)),NA=Zz();function Zz(){const n={};return["includes","indexOf","lastIndexOf"].forEach(e=>{n[e]=function(...i){const u=di(this);for(let b=0,I=this.length;b<I;b++)da(u,"get",b+"");const g=u[e](...i);return g===-1||g===!1?u[e](...i.map(di)):g}}),["push","pop","shift","unshift","splice"].forEach(e=>{n[e]=function(...i){nh(),q1();const u=di(this)[e].apply(this,i);return G1(),ih(),u}}),n}function Xz(n){uc(n)||(n=String(n));const e=di(this);return da(e,"has",n),e.hasOwnProperty(n)}class ok{constructor(e=!1,i=!1){this._isReadonly=e,this._isShallow=i}get(e,i,u){const g=this._isReadonly,b=this._isShallow;if(i==="__v_isReactive")return!g;if(i==="__v_isReadonly")return g;if(i==="__v_isShallow")return b;if(i==="__v_raw")return u===(g?b?l4:ck:b?lk:ak).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(u)?e:void 0;const I=sn(e);if(!g){if(I&&Qn(NA,i))return Reflect.get(NA,i,u);if(i==="hasOwnProperty")return Xz}const L=Reflect.get(e,i,u);return(uc(i)?ik.has(i):Wz(i))||(g||da(e,"get",i),b)?L:fa(L)?I&&U1(i)?L:L.value:Bi(L)?g?Z1(L):Rg(L):L}}class sk extends ok{constructor(e=!1){super(!1,e)}set(e,i,u,g){let b=e[i];if(!this._isShallow){const s=nd(b);if(!Bf(u)&&!nd(u)&&(b=di(b),u=di(u)),!sn(e)&&fa(b)&&!fa(u))return s?!1:(b.value=u,!0)}const I=sn(e)&&U1(i)?Number(i)<e.length:Qn(e,i),L=Reflect.set(e,i,u,g);return e===di(g)&&(I?Yu(u,b)&&zc(e,"set",i,u):zc(e,"add",i,u)),L}deleteProperty(e,i){const u=Qn(e,i);e[i];const g=Reflect.deleteProperty(e,i);return g&&u&&zc(e,"delete",i,void 0),g}has(e,i){const u=Reflect.has(e,i);return(!uc(i)||!ik.has(i))&&da(e,"has",i),u}ownKeys(e){return da(e,"iterate",sn(e)?"length":Jh),Reflect.ownKeys(e)}}class Kz extends ok{constructor(e=!1){super(!0,e)}set(e,i){return!0}deleteProperty(e,i){return!0}}const Yz=new sk,Jz=new Kz,Qz=new sk(!0);const H1=n=>n,D0=n=>Reflect.getPrototypeOf(n);function _y(n,e,i=!1,u=!1){n=n.__v_raw;const g=di(n),b=di(e);i||(Yu(e,b)&&da(g,"get",e),da(g,"get",b));const{has:I}=D0(g),L=u?H1:i?K1:ig;if(I.call(g,e))return L(n.get(e));if(I.call(g,b))return L(n.get(b));n!==g&&n.get(e)}function yy(n,e=!1){const i=this.__v_raw,u=di(i),g=di(n);return e||(Yu(n,g)&&da(u,"has",n),da(u,"has",g)),n===g?i.has(n):i.has(n)||i.has(g)}function vy(n,e=!1){return n=n.__v_raw,!e&&da(di(n),"iterate",Jh),Reflect.get(n,"size",n)}function VA(n,e=!1){!e&&!Bf(n)&&!nd(n)&&(n=di(n));const i=di(this);return D0(i).has.call(i,n)||(i.add(n),zc(i,"add",n,n)),this}function UA(n,e,i=!1){!i&&!Bf(e)&&!nd(e)&&(e=di(e));const u=di(this),{has:g,get:b}=D0(u);let I=g.call(u,n);I||(n=di(n),I=g.call(u,n));const L=b.call(u,n);return u.set(n,e),I?Yu(e,L)&&zc(u,"set",n,e):zc(u,"add",n,e),this}function jA(n){const e=di(this),{has:i,get:u}=D0(e);let g=i.call(e,n);g||(n=di(n),g=i.call(e,n)),u&&u.call(e,n);const b=e.delete(n);return g&&zc(e,"delete",n,void 0),b}function $A(){const n=di(this),e=n.size!==0,i=n.clear();return e&&zc(n,"clear",void 0,void 0),i}function by(n,e){return function(u,g){const b=this,I=b.__v_raw,L=di(I),s=e?H1:n?K1:ig;return!n&&da(L,"iterate",Jh),I.forEach(($,W)=>u.call(g,s($),s(W),b))}}function xy(n,e,i){return function(...u){const g=this.__v_raw,b=di(g),I=Tf(b),L=n==="entries"||n===Symbol.iterator&&I,s=n==="keys"&&I,$=g[n](...u),W=i?H1:e?K1:ig;return!e&&da(b,"iterate",s?Bx:Jh),{next(){const{value:Q,done:ae}=$.next();return ae?{value:Q,done:ae}:{value:L?[W(Q[0]),W(Q[1])]:W(Q),done:ae}},[Symbol.iterator](){return this}}}}function ku(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function e4(){const n={get(b){return _y(this,b)},get size(){return vy(this)},has:yy,add:VA,set:UA,delete:jA,clear:$A,forEach:by(!1,!1)},e={get(b){return _y(this,b,!1,!0)},get size(){return vy(this)},has:yy,add(b){return VA.call(this,b,!0)},set(b,I){return UA.call(this,b,I,!0)},delete:jA,clear:$A,forEach:by(!1,!0)},i={get(b){return _y(this,b,!0)},get size(){return vy(this,!0)},has(b){return yy.call(this,b,!0)},add:ku("add"),set:ku("set"),delete:ku("delete"),clear:ku("clear"),forEach:by(!0,!1)},u={get(b){return _y(this,b,!0,!0)},get size(){return vy(this,!0)},has(b){return yy.call(this,b,!0)},add:ku("add"),set:ku("set"),delete:ku("delete"),clear:ku("clear"),forEach:by(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(b=>{n[b]=xy(b,!1,!1),i[b]=xy(b,!0,!1),e[b]=xy(b,!1,!0),u[b]=xy(b,!0,!0)}),[n,i,e,u]}const[t4,r4,n4,i4]=e4();function W1(n,e){const i=e?n?i4:n4:n?r4:t4;return(u,g,b)=>g==="__v_isReactive"?!n:g==="__v_isReadonly"?n:g==="__v_raw"?u:Reflect.get(Qn(i,g)&&g in u?i:u,g,b)}const o4={get:W1(!1,!1)},s4={get:W1(!1,!0)},a4={get:W1(!0,!1)};const ak=new WeakMap,lk=new WeakMap,ck=new WeakMap,l4=new WeakMap;function c4(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function u4(n){return n.__v_skip||!Object.isExtensible(n)?0:c4(Mz(n))}function Rg(n){return nd(n)?n:X1(n,!1,Yz,o4,ak)}function uk(n){return X1(n,!1,Qz,s4,lk)}function Z1(n){return X1(n,!0,Jz,a4,ck)}function X1(n,e,i,u,g){if(!Bi(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const b=g.get(n);if(b)return b;const I=u4(n);if(I===0)return n;const L=new Proxy(n,I===2?u:i);return g.set(n,L),L}function Gm(n){return nd(n)?Gm(n.__v_raw):!!(n&&n.__v_isReactive)}function nd(n){return!!(n&&n.__v_isReadonly)}function Bf(n){return!!(n&&n.__v_isShallow)}function hk(n){return n?!!n.__v_raw:!1}function di(n){const e=n&&n.__v_raw;return e?di(e):n}function h4(n){return Object.isExtensible(n)&&ZR(n,"__v_skip",!0),n}const ig=n=>Bi(n)?Rg(n):n,K1=n=>Bi(n)?Z1(n):n;class dk{constructor(e,i,u,g){this.getter=e,this._setter=i,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new $1(()=>e(this._value),()=>Py(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!g,this.__v_isReadonly=u}get value(){const e=di(this);return(!e._cacheable||e.effect.dirty)&&Yu(e._value,e._value=e.effect.run())&&Py(e,4),fk(e),e.effect._dirtyLevel>=2&&Py(e,2),e._value}set value(e){this._setter(e)}get _dirty(){return this.effect.dirty}set _dirty(e){this.effect.dirty=e}}function d4(n,e,i=!1){let u,g;const b=wn(n);return b?(u=n,g=nl):(u=n.get,g=n.set),new dk(u,g,b||!g,i)}function fk(n){var e;Gu&&Yh&&(n=di(n),tk(Yh,(e=n.dep)!=null?e:n.dep=nk(()=>n.dep=void 0,n instanceof dk?n:void 0)))}function Py(n,e=4,i,u){n=di(n);const g=n.dep;g&&rk(g,e)}function fa(n){return!!(n&&n.__v_isRef===!0)}function Fc(n){return pk(n,!1)}function f4(n){return pk(n,!0)}function pk(n,e){return fa(n)?n:new p4(n,e)}class p4{constructor(e,i){this.__v_isShallow=i,this.dep=void 0,this.__v_isRef=!0,this._rawValue=i?e:di(e),this._value=i?e:ig(e)}get value(){return fk(this),this._value}set value(e){const i=this.__v_isShallow||Bf(e)||nd(e);e=i?e:di(e),Yu(e,this._rawValue)&&(this._rawValue,this._rawValue=e,this._value=i?e:ig(e),Py(this,4))}}function Nn(n){return fa(n)?n.value:n}const m4={get:(n,e,i)=>Nn(Reflect.get(n,e,i)),set:(n,e,i,u)=>{const g=n[e];return fa(g)&&!fa(i)?(g.value=i,!0):Reflect.set(n,e,i,u)}};function mk(n){return Gm(n)?n:new Proxy(n,m4)}/**
* @vue/runtime-core v3.4.37
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Hu(n,e,i,u){try{return u?n(...u):n()}catch(g){L0(g,e,i)}}function Il(n,e,i,u){if(wn(n)){const g=Hu(n,e,i,u);return g&&GR(g)&&g.catch(b=>{L0(b,e,i)}),g}if(sn(n)){const g=[];for(let b=0;b<n.length;b++)g.push(Il(n[b],e,i,u));return g}}function L0(n,e,i,u=!0){const g=e?e.vnode:null;if(e){let b=e.parent;const I=e.proxy,L=`https://vuejs.org/error-reference/#runtime-${i}`;for(;b;){const $=b.ec;if($){for(let W=0;W<$.length;W++)if($[W](n,I,L)===!1)return}b=b.parent}const s=e.appContext.config.errorHandler;if(s){nh(),Hu(s,null,10,[n,I,L]),ih();return}}g4(n,i,g,u)}function g4(n,e,i,u=!0){console.error(n)}let og=!1,zx=!1;const Es=[];let tc=0;const Ef=[];let Lu=null,Hh=0;const gk=Promise.resolve();let Y1=null;function O0(n){const e=Y1||gk;return n?e.then(this?n.bind(this):n):e}function _4(n){let e=tc+1,i=Es.length;for(;e<i;){const u=e+i>>>1,g=Es[u],b=sg(g);b<n||b===n&&g.pre?e=u+1:i=u}return e}function J1(n){(!Es.length||!Es.includes(n,og&&n.allowRecurse?tc+1:tc))&&(n.id==null?Es.push(n):Es.splice(_4(n.id),0,n),_k())}function _k(){!og&&!zx&&(zx=!0,Y1=gk.then(vk))}function y4(n){const e=Es.indexOf(n);e>tc&&Es.splice(e,1)}function v4(n){sn(n)?Ef.push(...n):(!Lu||!Lu.includes(n,n.allowRecurse?Hh+1:Hh))&&Ef.push(n),_k()}function qA(n,e,i=og?tc+1:0){for(;i<Es.length;i++){const u=Es[i];if(u&&u.pre){if(n&&u.id!==n.uid)continue;Es.splice(i,1),i--,u()}}}function yk(n){if(Ef.length){const e=[...new Set(Ef)].sort((i,u)=>sg(i)-sg(u));if(Ef.length=0,Lu){Lu.push(...e);return}for(Lu=e,Hh=0;Hh<Lu.length;Hh++){const i=Lu[Hh];i.active!==!1&&i()}Lu=null,Hh=0}}const sg=n=>n.id==null?1/0:n.id,b4=(n,e)=>{const i=sg(n)-sg(e);if(i===0){if(n.pre&&!e.pre)return-1;if(e.pre&&!n.pre)return 1}return i};function vk(n){zx=!1,og=!0,Es.sort(b4);try{for(tc=0;tc<Es.length;tc++){const e=Es[tc];e&&e.active!==!1&&Hu(e,e.i,e.i?15:14)}}finally{tc=0,Es.length=0,yk(),og=!1,Y1=null,(Es.length||Ef.length)&&vk()}}let la=null,B0=null;function Jy(n){const e=la;return la=n,B0=n&&n.type.__scopeId||null,e}function z0(n){B0=n}function F0(){B0=null}function oa(n,e=la,i){if(!e||n._n)return n;const u=(...g)=>{u._d&&QA(-1);const b=Jy(e);let I;try{I=n(...g)}finally{Jy(b),u._d&&QA(1)}return I};return u._n=!0,u._c=!0,u._d=!0,u}function _o(n,e){if(la===null)return n;const i=q0(la),u=n.dirs||(n.dirs=[]);for(let g=0;g<e.length;g++){let[b,I,L,s=Wi]=e[g];b&&(wn(b)&&(b={mounted:b,updated:b}),b.deep&&zu(I),u.push({dir:b,instance:i,value:I,oldValue:void 0,arg:L,modifiers:s}))}return n}function $h(n,e,i,u){const g=n.dirs,b=e&&e.dirs;for(let I=0;I<g.length;I++){const L=g[I];b&&(L.oldValue=b[I].value);let s=L.dir[u];s&&(nh(),Il(s,i,8,[n.el,L,n,e]),ih())}}function bk(n,e){n.shapeFlag&6&&n.component?bk(n.component.subTree,e):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function xk(n,e){return wn(n)?As({name:n.name},e,{setup:n}):n}const My=n=>!!n.type.__asyncLoader,wk=n=>n.type.__isKeepAlive;function x4(n,e){Tk(n,"a",e)}function w4(n,e){Tk(n,"da",e)}function Tk(n,e,i=ns){const u=n.__wdc||(n.__wdc=()=>{let g=i;for(;g;){if(g.isDeactivated)return;g=g.parent}return n()});if(N0(e,u,i),i){let g=i.parent;for(;g&&g.parent;)wk(g.parent.vnode)&&T4(u,e,i,g),g=g.parent}}function T4(n,e,i,u){const g=N0(e,n,u,!0);Ik(()=>{V1(u[e],g)},i)}function N0(n,e,i=ns,u=!1){if(i){const g=i[n]||(i[n]=[]),b=e.__weh||(e.__weh=(...I)=>{nh();const L=kg(i),s=Il(e,i,n,I);return L(),ih(),s});return u?g.unshift(b):g.push(b),b}}const Wc=n=>(e,i=ns)=>{(!$0||n==="sp")&&N0(n,(...u)=>e(...u),i)},E4=Wc("bm"),Ek=Wc("m"),I4=Wc("bu"),A4=Wc("u"),S4=Wc("bum"),Ik=Wc("um"),C4=Wc("sp"),R4=Wc("rtg"),k4=Wc("rtc");function P4(n,e=ns){N0("ec",n,e)}const Ak="components";function Dy(n,e){return D4(Ak,n,!0,e)||n}const M4=Symbol.for("v-ndc");function D4(n,e,i=!0,u=!1){const g=la||ns;if(g){const b=g.type;if(n===Ak){const L=E5(b,!1);if(L&&(L===e||L===Sl(e)||L===P0(Sl(e))))return b}const I=GA(g[n]||b[n],e)||GA(g.appContext[n],e);return!I&&u?b:I}}function GA(n,e){return n&&(n[e]||n[Sl(e)]||n[P0(Sl(e))])}function Qy(n,e,i,u){let g;const b=i;if(sn(n)||So(n)){g=new Array(n.length);for(let I=0,L=n.length;I<L;I++)g[I]=e(n[I],I,void 0,b)}else if(typeof n=="number"){g=new Array(n);for(let I=0;I<n;I++)g[I]=e(I+1,I,void 0,b)}else if(Bi(n))if(n[Symbol.iterator])g=Array.from(n,(I,L)=>e(I,L,void 0,b));else{const I=Object.keys(n);g=new Array(I.length);for(let L=0,s=I.length;L<s;L++){const $=I[L];g[L]=e(n[$],$,L,b)}}else g=[];return g}const Fx=n=>n?Gk(n)?q0(n):Fx(n.parent):null,Hm=As(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Fx(n.parent),$root:n=>Fx(n.root),$emit:n=>n.emit,$options:n=>Q1(n),$forceUpdate:n=>n.f||(n.f=()=>{n.effect.dirty=!0,J1(n.update)}),$nextTick:n=>n.n||(n.n=O0.bind(n.proxy)),$watch:n=>r5.bind(n)}),nx=(n,e)=>n!==Wi&&!n.__isScriptSetup&&Qn(n,e),L4={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:i,setupState:u,data:g,props:b,accessCache:I,type:L,appContext:s}=n;let $;if(e[0]!=="$"){const we=I[e];if(we!==void 0)switch(we){case 1:return u[e];case 2:return g[e];case 4:return i[e];case 3:return b[e]}else{if(nx(u,e))return I[e]=1,u[e];if(g!==Wi&&Qn(g,e))return I[e]=2,g[e];if(($=n.propsOptions[0])&&Qn($,e))return I[e]=3,b[e];if(i!==Wi&&Qn(i,e))return I[e]=4,i[e];Nx&&(I[e]=0)}}const W=Hm[e];let Q,ae;if(W)return e==="$attrs"&&da(n.attrs,"get",""),W(n);if((Q=L.__cssModules)&&(Q=Q[e]))return Q;if(i!==Wi&&Qn(i,e))return I[e]=4,i[e];if(ae=s.config.globalProperties,Qn(ae,e))return ae[e]},set({_:n},e,i){const{data:u,setupState:g,ctx:b}=n;return nx(g,e)?(g[e]=i,!0):u!==Wi&&Qn(u,e)?(u[e]=i,!0):Qn(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(b[e]=i,!0)},has({_:{data:n,setupState:e,accessCache:i,ctx:u,appContext:g,propsOptions:b}},I){let L;return!!i[I]||n!==Wi&&Qn(n,I)||nx(e,I)||(L=b[0])&&Qn(L,I)||Qn(u,I)||Qn(Hm,I)||Qn(g.config.globalProperties,I)},defineProperty(n,e,i){return i.get!=null?n._.accessCache[e]=0:Qn(i,"value")&&this.set(n,e,i.value,null),Reflect.defineProperty(n,e,i)}};function HA(n){return sn(n)?n.reduce((e,i)=>(e[i]=null,e),{}):n}let Nx=!0;function O4(n){const e=Q1(n),i=n.proxy,u=n.ctx;Nx=!1,e.beforeCreate&&WA(e.beforeCreate,n,"bc");const{data:g,computed:b,methods:I,watch:L,provide:s,inject:$,created:W,beforeMount:Q,mounted:ae,beforeUpdate:we,updated:He,activated:$e,deactivated:Ne,beforeDestroy:wt,beforeUnmount:mt,destroyed:vt,unmounted:zt,render:Ct,renderTracked:qt,renderTriggered:qe,errorCaptured:be,serverPrefetch:Fe,expose:Je,inheritAttrs:Me,components:je,directives:Ve,filters:An}=e;if($&&B4($,u,null),I)for(const Cr in I){const Vr=I[Cr];wn(Vr)&&(u[Cr]=Vr.bind(i))}if(g){const Cr=g.call(i,i);Bi(Cr)&&(n.data=Rg(Cr))}if(Nx=!0,b)for(const Cr in b){const Vr=b[Cr],On=wn(Vr)?Vr.bind(i,i):wn(Vr.get)?Vr.get.bind(i,i):nl,dr=!wn(Vr)&&wn(Vr.set)?Vr.set.bind(i):nl,Zn=El({get:On,set:dr});Object.defineProperty(u,Cr,{enumerable:!0,configurable:!0,get:()=>Zn.value,set:yn=>Zn.value=yn})}if(L)for(const Cr in L)Sk(L[Cr],u,i,Cr);if(s){const Cr=wn(s)?s.call(i):s;Reflect.ownKeys(Cr).forEach(Vr=>{Ly(Vr,Cr[Vr])})}W&&WA(W,n,"c");function or(Cr,Vr){sn(Vr)?Vr.forEach(On=>Cr(On.bind(i))):Vr&&Cr(Vr.bind(i))}if(or(E4,Q),or(Ek,ae),or(I4,we),or(A4,He),or(x4,$e),or(w4,Ne),or(P4,be),or(k4,qt),or(R4,qe),or(S4,mt),or(Ik,zt),or(C4,Fe),sn(Je))if(Je.length){const Cr=n.exposed||(n.exposed={});Je.forEach(Vr=>{Object.defineProperty(Cr,Vr,{get:()=>i[Vr],set:On=>i[Vr]=On})})}else n.exposed||(n.exposed={});Ct&&n.render===nl&&(n.render=Ct),Me!=null&&(n.inheritAttrs=Me),je&&(n.components=je),Ve&&(n.directives=Ve)}function B4(n,e,i=nl){sn(n)&&(n=Vx(n));for(const u in n){const g=n[u];let b;Bi(g)?"default"in g?b=ic(g.from||u,g.default,!0):b=ic(g.from||u):b=ic(g),fa(b)?Object.defineProperty(e,u,{enumerable:!0,configurable:!0,get:()=>b.value,set:I=>b.value=I}):e[u]=b}}function WA(n,e,i){Il(sn(n)?n.map(u=>u.bind(e.proxy)):n.bind(e.proxy),e,i)}function Sk(n,e,i,u){const g=u.includes(".")?Uk(i,u):()=>i[u];if(So(n)){const b=e[n];wn(b)&&Mc(g,b)}else if(wn(n))Mc(g,n.bind(i));else if(Bi(n))if(sn(n))n.forEach(b=>Sk(b,e,i,u));else{const b=wn(n.handler)?n.handler.bind(i):e[n.handler];wn(b)&&Mc(g,b,n)}}function Q1(n){const e=n.type,{mixins:i,extends:u}=e,{mixins:g,optionsCache:b,config:{optionMergeStrategies:I}}=n.appContext,L=b.get(e);let s;return L?s=L:!g.length&&!i&&!u?s=e:(s={},g.length&&g.forEach($=>e0(s,$,I,!0)),e0(s,e,I)),Bi(e)&&b.set(e,s),s}function e0(n,e,i,u=!1){const{mixins:g,extends:b}=e;b&&e0(n,b,i,!0),g&&g.forEach(I=>e0(n,I,i,!0));for(const I in e)if(!(u&&I==="expose")){const L=z4[I]||i&&i[I];n[I]=L?L(n[I],e[I]):e[I]}return n}const z4={data:ZA,props:XA,emits:XA,methods:Lm,computed:Lm,beforeCreate:Ls,created:Ls,beforeMount:Ls,mounted:Ls,beforeUpdate:Ls,updated:Ls,beforeDestroy:Ls,beforeUnmount:Ls,destroyed:Ls,unmounted:Ls,activated:Ls,deactivated:Ls,errorCaptured:Ls,serverPrefetch:Ls,components:Lm,directives:Lm,watch:N4,provide:ZA,inject:F4};function ZA(n,e){return e?n?function(){return As(wn(n)?n.call(this,this):n,wn(e)?e.call(this,this):e)}:e:n}function F4(n,e){return Lm(Vx(n),Vx(e))}function Vx(n){if(sn(n)){const e={};for(let i=0;i<n.length;i++)e[n[i]]=n[i];return e}return n}function Ls(n,e){return n?[...new Set([].concat(n,e))]:e}function Lm(n,e){return n?As(Object.create(null),n,e):e}function XA(n,e){return n?sn(n)&&sn(e)?[...new Set([...n,...e])]:As(Object.create(null),HA(n),HA(e??{})):e}function N4(n,e){if(!n)return e;if(!e)return n;const i=As(Object.create(null),n);for(const u in e)i[u]=Ls(n[u],e[u]);return i}function Ck(){return{app:null,config:{isNativeTag:kz,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let V4=0;function U4(n,e){return function(u,g=null){wn(u)||(u=As({},u)),g!=null&&!Bi(g)&&(g=null);const b=Ck(),I=new WeakSet;let L=!1;const s=b.app={_uid:V4++,_component:u,_props:g,_container:null,_context:b,_instance:null,version:A5,get config(){return b.config},set config($){},use($,...W){return I.has($)||($&&wn($.install)?(I.add($),$.install(s,...W)):wn($)&&(I.add($),$(s,...W))),s},mixin($){return b.mixins.includes($)||b.mixins.push($),s},component($,W){return W?(b.components[$]=W,s):b.components[$]},directive($,W){return W?(b.directives[$]=W,s):b.directives[$]},mount($,W,Q){if(!L){const ae=ui(u,g);return ae.appContext=b,Q===!0?Q="svg":Q===!1&&(Q=void 0),W&&e?e(ae,$):n(ae,$,Q),L=!0,s._container=$,$.__vue_app__=s,q0(ae.component)}},unmount(){L&&(n(null,s._container),delete s._container.__vue_app__)},provide($,W){return b.provides[$]=W,s},runWithContext($){const W=If;If=s;try{return $()}finally{If=W}}};return s}}let If=null;function Ly(n,e){if(ns){let i=ns.provides;const u=ns.parent&&ns.parent.provides;u===i&&(i=ns.provides=Object.create(u)),i[n]=e}}function ic(n,e,i=!1){const u=ns||la;if(u||If){const g=If?If._context.provides:u?u.parent==null?u.vnode.appContext&&u.vnode.appContext.provides:u.parent.provides:void 0;if(g&&n in g)return g[n];if(arguments.length>1)return i&&wn(e)?e.call(u&&u.proxy):e}}const Rk={},kk=()=>Object.create(Rk),Pk=n=>Object.getPrototypeOf(n)===Rk;function j4(n,e,i,u=!1){const g={},b=kk();n.propsDefaults=Object.create(null),Mk(n,e,g,b);for(const I in n.propsOptions[0])I in g||(g[I]=void 0);i?n.props=u?g:uk(g):n.type.props?n.props=g:n.props=b,n.attrs=b}function $4(n,e,i,u){const{props:g,attrs:b,vnode:{patchFlag:I}}=n,L=di(g),[s]=n.propsOptions;let $=!1;if((u||I>0)&&!(I&16)){if(I&8){const W=n.vnode.dynamicProps;for(let Q=0;Q<W.length;Q++){let ae=W[Q];if(V0(n.emitsOptions,ae))continue;const we=e[ae];if(s)if(Qn(b,ae))we!==b[ae]&&(b[ae]=we,$=!0);else{const He=Sl(ae);g[He]=Ux(s,L,He,we,n,!1)}else we!==b[ae]&&(b[ae]=we,$=!0)}}}else{Mk(n,e,g,b)&&($=!0);let W;for(const Q in L)(!e||!Qn(e,Q)&&((W=rh(Q))===Q||!Qn(e,W)))&&(s?i&&(i[Q]!==void 0||i[W]!==void 0)&&(g[Q]=Ux(s,L,Q,void 0,n,!0)):delete g[Q]);if(b!==L)for(const Q in b)(!e||!Qn(e,Q))&&(delete b[Q],$=!0)}$&&zc(n.attrs,"set","")}function Mk(n,e,i,u){const[g,b]=n.propsOptions;let I=!1,L;if(e)for(let s in e){if(qm(s))continue;const $=e[s];let W;g&&Qn(g,W=Sl(s))?!b||!b.includes(W)?i[W]=$:(L||(L={}))[W]=$:V0(n.emitsOptions,s)||(!(s in u)||$!==u[s])&&(u[s]=$,I=!0)}if(b){const s=di(i),$=L||Wi;for(let W=0;W<b.length;W++){const Q=b[W];i[Q]=Ux(g,s,Q,$[Q],n,!Qn($,Q))}}return I}function Ux(n,e,i,u,g,b){const I=n[i];if(I!=null){const L=Qn(I,"default");if(L&&u===void 0){const s=I.default;if(I.type!==Function&&!I.skipFactory&&wn(s)){const{propsDefaults:$}=g;if(i in $)u=$[i];else{const W=kg(g);u=$[i]=s.call(null,e),W()}}else u=s}I[0]&&(b&&!L?u=!1:I[1]&&(u===""||u===rh(i))&&(u=!0))}return u}const q4=new WeakMap;function Dk(n,e,i=!1){const u=i?q4:e.propsCache,g=u.get(n);if(g)return g;const b=n.props,I={},L=[];let s=!1;if(!wn(n)){const W=Q=>{s=!0;const[ae,we]=Dk(Q,e,!0);As(I,ae),we&&L.push(...we)};!i&&e.mixins.length&&e.mixins.forEach(W),n.extends&&W(n.extends),n.mixins&&n.mixins.forEach(W)}if(!b&&!s)return Bi(n)&&u.set(n,wf),wf;if(sn(b))for(let W=0;W<b.length;W++){const Q=Sl(b[W]);KA(Q)&&(I[Q]=Wi)}else if(b)for(const W in b){const Q=Sl(W);if(KA(Q)){const ae=b[W],we=I[Q]=sn(ae)||wn(ae)?{type:ae}:As({},ae),He=we.type;let $e=!1,Ne=!0;if(sn(He))for(let wt=0;wt<He.length;++wt){const mt=He[wt],vt=wn(mt)&&mt.name;if(vt==="Boolean"){$e=!0;break}else vt==="String"&&(Ne=!1)}else $e=wn(He)&&He.name==="Boolean";we[0]=$e,we[1]=Ne,($e||Qn(we,"default"))&&L.push(Q)}}const $=[I,L];return Bi(n)&&u.set(n,$),$}function KA(n){return n[0]!=="$"&&!qm(n)}const Lk=n=>n[0]==="_"||n==="$stable",ew=n=>sn(n)?n.map(ec):[ec(n)],G4=(n,e,i)=>{if(e._n)return e;const u=oa((...g)=>ew(e(...g)),i);return u._c=!1,u},Ok=(n,e,i)=>{const u=n._ctx;for(const g in n){if(Lk(g))continue;const b=n[g];if(wn(b))e[g]=G4(g,b,u);else if(b!=null){const I=ew(b);e[g]=()=>I}}},Bk=(n,e)=>{const i=ew(e);n.slots.default=()=>i},zk=(n,e,i)=>{for(const u in e)(i||u!=="_")&&(n[u]=e[u])},H4=(n,e,i)=>{const u=n.slots=kk();if(n.vnode.shapeFlag&32){const g=e._;g?(zk(u,e,i),i&&ZR(u,"_",g,!0)):Ok(e,u)}else e&&Bk(n,e)},W4=(n,e,i)=>{const{vnode:u,slots:g}=n;let b=!0,I=Wi;if(u.shapeFlag&32){const L=e._;L?i&&L===1?b=!1:zk(g,e,i):(b=!e.$stable,Ok(e,g)),I=e}else e&&(Bk(n,e),I={default:1});if(b)for(const L in g)!Lk(L)&&I[L]==null&&delete g[L]};function jx(n,e,i,u,g=!1){if(sn(n)){n.forEach((ae,we)=>jx(ae,e&&(sn(e)?e[we]:e),i,u,g));return}if(My(u)&&!g)return;const b=u.shapeFlag&4?q0(u.component):u.el,I=g?null:b,{i:L,r:s}=n,$=e&&e.r,W=L.refs===Wi?L.refs={}:L.refs,Q=L.setupState;if($!=null&&$!==s&&(So($)?(W[$]=null,Qn(Q,$)&&(Q[$]=null)):fa($)&&($.value=null)),wn(s))Hu(s,L,12,[I,W]);else{const ae=So(s),we=fa(s);if(ae||we){const He=()=>{if(n.f){const $e=ae?Qn(Q,s)?Q[s]:W[s]:s.value;g?sn($e)&&V1($e,b):sn($e)?$e.includes(b)||$e.push(b):ae?(W[s]=[b],Qn(Q,s)&&(Q[s]=W[s])):(s.value=[b],n.k&&(W[n.k]=s.value))}else ae?(W[s]=I,Qn(Q,s)&&(Q[s]=I)):we&&(s.value=I,n.k&&(W[n.k]=I))};I?(He.id=-1,sa(He,i)):He()}}}const Z4=Symbol("_vte"),X4=n=>n.__isTeleport,sa=u5;function K4(n){return Y4(n)}function Y4(n,e){const i=XR();i.__VUE__=!0;const{insert:u,remove:g,patchProp:b,createElement:I,createText:L,createComment:s,setText:$,setElementText:W,parentNode:Q,nextSibling:ae,setScopeId:we=nl,insertStaticContent:He}=n,$e=(Le,Ye,De,jt=null,St=null,Zt=null,Dt=void 0,Wt=null,nr=!!Ye.dynamicChildren)=>{if(Le===Ye)return;Le&&!Sm(Le,Ye)&&(jt=It(Le),yn(Le,St,Zt,!0),Le=null),Ye.patchFlag===-2&&(nr=!1,Ye.dynamicChildren=null);const{type:Kt,ref:mr,shapeFlag:Ar}=Ye;switch(Kt){case U0:Ne(Le,Ye,De,jt);break;case id:wt(Le,Ye,De,jt);break;case Oy:Le==null&&mt(Ye,De,jt,Dt);break;case ws:je(Le,Ye,De,jt,St,Zt,Dt,Wt,nr);break;default:Ar&1?Ct(Le,Ye,De,jt,St,Zt,Dt,Wt,nr):Ar&6?Ve(Le,Ye,De,jt,St,Zt,Dt,Wt,nr):(Ar&64||Ar&128)&&Kt.process(Le,Ye,De,jt,St,Zt,Dt,Wt,nr,wr)}mr!=null&&St&&jx(mr,Le&&Le.ref,Zt,Ye||Le,!Ye)},Ne=(Le,Ye,De,jt)=>{if(Le==null)u(Ye.el=L(Ye.children),De,jt);else{const St=Ye.el=Le.el;Ye.children!==Le.children&&$(St,Ye.children)}},wt=(Le,Ye,De,jt)=>{Le==null?u(Ye.el=s(Ye.children||""),De,jt):Ye.el=Le.el},mt=(Le,Ye,De,jt)=>{[Le.el,Le.anchor]=He(Le.children,Ye,De,jt,Le.el,Le.anchor)},vt=({el:Le,anchor:Ye},De,jt)=>{let St;for(;Le&&Le!==Ye;)St=ae(Le),u(Le,De,jt),Le=St;u(Ye,De,jt)},zt=({el:Le,anchor:Ye})=>{let De;for(;Le&&Le!==Ye;)De=ae(Le),g(Le),Le=De;g(Ye)},Ct=(Le,Ye,De,jt,St,Zt,Dt,Wt,nr)=>{Ye.type==="svg"?Dt="svg":Ye.type==="math"&&(Dt="mathml"),Le==null?qt(Ye,De,jt,St,Zt,Dt,Wt,nr):Fe(Le,Ye,St,Zt,Dt,Wt,nr)},qt=(Le,Ye,De,jt,St,Zt,Dt,Wt)=>{let nr,Kt;const{props:mr,shapeFlag:Ar,transition:Ft,dirs:Ir}=Le;if(nr=Le.el=I(Le.type,Zt,mr&&mr.is,mr),Ar&8?W(nr,Le.children):Ar&16&&be(Le.children,nr,null,jt,St,ix(Le,Zt),Dt,Wt),Ir&&$h(Le,null,jt,"created"),qe(nr,Le,Le.scopeId,Dt,jt),mr){for(const tn in mr)tn!=="value"&&!qm(tn)&&b(nr,tn,null,mr[tn],Zt,jt);"value"in mr&&b(nr,"value",null,mr.value,Zt),(Kt=mr.onVnodeBeforeMount)&&Ql(Kt,jt,Le)}Ir&&$h(Le,null,jt,"beforeMount");const Sr=J4(St,Ft);Sr&&Ft.beforeEnter(nr),u(nr,Ye,De),((Kt=mr&&mr.onVnodeMounted)||Sr||Ir)&&sa(()=>{Kt&&Ql(Kt,jt,Le),Sr&&Ft.enter(nr),Ir&&$h(Le,null,jt,"mounted")},St)},qe=(Le,Ye,De,jt,St)=>{if(De&&we(Le,De),jt)for(let Zt=0;Zt<jt.length;Zt++)we(Le,jt[Zt]);if(St){let Zt=St.subTree;if(Ye===Zt){const Dt=St.vnode;qe(Le,Dt,Dt.scopeId,Dt.slotScopeIds,St.parent)}}},be=(Le,Ye,De,jt,St,Zt,Dt,Wt,nr=0)=>{for(let Kt=nr;Kt<Le.length;Kt++){const mr=Le[Kt]=Wt?Ou(Le[Kt]):ec(Le[Kt]);$e(null,mr,Ye,De,jt,St,Zt,Dt,Wt)}},Fe=(Le,Ye,De,jt,St,Zt,Dt)=>{const Wt=Ye.el=Le.el;let{patchFlag:nr,dynamicChildren:Kt,dirs:mr}=Ye;nr|=Le.patchFlag&16;const Ar=Le.props||Wi,Ft=Ye.props||Wi;let Ir;if(De&&qh(De,!1),(Ir=Ft.onVnodeBeforeUpdate)&&Ql(Ir,De,Ye,Le),mr&&$h(Ye,Le,De,"beforeUpdate"),De&&qh(De,!0),(Ar.innerHTML&&Ft.innerHTML==null||Ar.textContent&&Ft.textContent==null)&&W(Wt,""),Kt?Je(Le.dynamicChildren,Kt,Wt,De,jt,ix(Ye,St),Zt):Dt||Vr(Le,Ye,Wt,null,De,jt,ix(Ye,St),Zt,!1),nr>0){if(nr&16)Me(Wt,Ar,Ft,De,St);else if(nr&2&&Ar.class!==Ft.class&&b(Wt,"class",null,Ft.class,St),nr&4&&b(Wt,"style",Ar.style,Ft.style,St),nr&8){const Sr=Ye.dynamicProps;for(let tn=0;tn<Sr.length;tn++){const Xr=Sr[tn],vn=Ar[Xr],xi=Ft[Xr];(xi!==vn||Xr==="value")&&b(Wt,Xr,vn,xi,St,De)}}nr&1&&Le.children!==Ye.children&&W(Wt,Ye.children)}else!Dt&&Kt==null&&Me(Wt,Ar,Ft,De,St);((Ir=Ft.onVnodeUpdated)||mr)&&sa(()=>{Ir&&Ql(Ir,De,Ye,Le),mr&&$h(Ye,Le,De,"updated")},jt)},Je=(Le,Ye,De,jt,St,Zt,Dt)=>{for(let Wt=0;Wt<Ye.length;Wt++){const nr=Le[Wt],Kt=Ye[Wt],mr=nr.el&&(nr.type===ws||!Sm(nr,Kt)||nr.shapeFlag&70)?Q(nr.el):De;$e(nr,Kt,mr,null,jt,St,Zt,Dt,!0)}},Me=(Le,Ye,De,jt,St)=>{if(Ye!==De){if(Ye!==Wi)for(const Zt in Ye)!qm(Zt)&&!(Zt in De)&&b(Le,Zt,Ye[Zt],null,St,jt);for(const Zt in De){if(qm(Zt))continue;const Dt=De[Zt],Wt=Ye[Zt];Dt!==Wt&&Zt!=="value"&&b(Le,Zt,Wt,Dt,St,jt)}"value"in De&&b(Le,"value",Ye.value,De.value,St)}},je=(Le,Ye,De,jt,St,Zt,Dt,Wt,nr)=>{const Kt=Ye.el=Le?Le.el:L(""),mr=Ye.anchor=Le?Le.anchor:L("");let{patchFlag:Ar,dynamicChildren:Ft,slotScopeIds:Ir}=Ye;Ir&&(Wt=Wt?Wt.concat(Ir):Ir),Le==null?(u(Kt,De,jt),u(mr,De,jt),be(Ye.children||[],De,mr,St,Zt,Dt,Wt,nr)):Ar>0&&Ar&64&&Ft&&Le.dynamicChildren?(Je(Le.dynamicChildren,Ft,De,St,Zt,Dt,Wt),(Ye.key!=null||St&&Ye===St.subTree)&&Fk(Le,Ye,!0)):Vr(Le,Ye,De,mr,St,Zt,Dt,Wt,nr)},Ve=(Le,Ye,De,jt,St,Zt,Dt,Wt,nr)=>{Ye.slotScopeIds=Wt,Le==null?Ye.shapeFlag&512?St.ctx.activate(Ye,De,jt,Dt,nr):An(Ye,De,jt,St,Zt,Dt,nr):jn(Le,Ye,nr)},An=(Le,Ye,De,jt,St,Zt,Dt)=>{const Wt=Le.component=y5(Le,jt,St);if(wk(Le)&&(Wt.ctx.renderer=wr),b5(Wt,!1,Dt),Wt.asyncDep){if(St&&St.registerDep(Wt,or,Dt),!Le.el){const nr=Wt.subTree=ui(id);wt(null,nr,Ye,De)}}else or(Wt,Le,Ye,De,St,Zt,Dt)},jn=(Le,Ye,De)=>{const jt=Ye.component=Le.component;if(a5(Le,Ye,De))if(jt.asyncDep&&!jt.asyncResolved){Cr(jt,Ye,De);return}else jt.next=Ye,y4(jt.update),jt.effect.dirty=!0,jt.update();else Ye.el=Le.el,jt.vnode=Ye},or=(Le,Ye,De,jt,St,Zt,Dt)=>{const Wt=()=>{if(Le.isMounted){let{next:mr,bu:Ar,u:Ft,parent:Ir,vnode:Sr}=Le;{const Ii=Nk(Le);if(Ii){mr&&(mr.el=Sr.el,Cr(Le,mr,Dt)),Ii.asyncDep.then(()=>{Le.isUnmounted||Wt()});return}}let tn=mr,Xr;qh(Le,!1),mr?(mr.el=Sr.el,Cr(Le,mr,Dt)):mr=Sr,Ar&&ky(Ar),(Xr=mr.props&&mr.props.onVnodeBeforeUpdate)&&Ql(Xr,Ir,mr,Sr),qh(Le,!0);const vn=ox(Le),xi=Le.subTree;Le.subTree=vn,$e(xi,vn,Q(xi.el),It(xi),Le,St,Zt),mr.el=vn.el,tn===null&&l5(Le,vn.el),Ft&&sa(Ft,St),(Xr=mr.props&&mr.props.onVnodeUpdated)&&sa(()=>Ql(Xr,Ir,mr,Sr),St)}else{let mr;const{el:Ar,props:Ft}=Ye,{bm:Ir,m:Sr,parent:tn}=Le,Xr=My(Ye);if(qh(Le,!1),Ir&&ky(Ir),!Xr&&(mr=Ft&&Ft.onVnodeBeforeMount)&&Ql(mr,tn,Ye),qh(Le,!0),Ar&&un){const vn=()=>{Le.subTree=ox(Le),un(Ar,Le.subTree,Le,St,null)};Xr?Ye.type.__asyncLoader().then(()=>!Le.isUnmounted&&vn()):vn()}else{const vn=Le.subTree=ox(Le);$e(null,vn,De,jt,Le,St,Zt),Ye.el=vn.el}if(Sr&&sa(Sr,St),!Xr&&(mr=Ft&&Ft.onVnodeMounted)){const vn=Ye;sa(()=>Ql(mr,tn,vn),St)}(Ye.shapeFlag&256||tn&&My(tn.vnode)&&tn.vnode.shapeFlag&256)&&Le.a&&sa(Le.a,St),Le.isMounted=!0,Ye=De=jt=null}},nr=Le.effect=new $1(Wt,nl,()=>J1(Kt),Le.scope),Kt=Le.update=()=>{nr.dirty&&nr.run()};Kt.i=Le,Kt.id=Le.uid,qh(Le,!0),Kt()},Cr=(Le,Ye,De)=>{Ye.component=Le;const jt=Le.vnode.props;Le.vnode=Ye,Le.next=null,$4(Le,Ye.props,jt,De),W4(Le,Ye.children,De),nh(),qA(Le),ih()},Vr=(Le,Ye,De,jt,St,Zt,Dt,Wt,nr=!1)=>{const Kt=Le&&Le.children,mr=Le?Le.shapeFlag:0,Ar=Ye.children,{patchFlag:Ft,shapeFlag:Ir}=Ye;if(Ft>0){if(Ft&128){dr(Kt,Ar,De,jt,St,Zt,Dt,Wt,nr);return}else if(Ft&256){On(Kt,Ar,De,jt,St,Zt,Dt,Wt,nr);return}}Ir&8?(mr&16&&Dn(Kt,St,Zt),Ar!==Kt&&W(De,Ar)):mr&16?Ir&16?dr(Kt,Ar,De,jt,St,Zt,Dt,Wt,nr):Dn(Kt,St,Zt,!0):(mr&8&&W(De,""),Ir&16&&be(Ar,De,jt,St,Zt,Dt,Wt,nr))},On=(Le,Ye,De,jt,St,Zt,Dt,Wt,nr)=>{Le=Le||wf,Ye=Ye||wf;const Kt=Le.length,mr=Ye.length,Ar=Math.min(Kt,mr);let Ft;for(Ft=0;Ft<Ar;Ft++){const Ir=Ye[Ft]=nr?Ou(Ye[Ft]):ec(Ye[Ft]);$e(Le[Ft],Ir,De,null,St,Zt,Dt,Wt,nr)}Kt>mr?Dn(Le,St,Zt,!0,!1,Ar):be(Ye,De,jt,St,Zt,Dt,Wt,nr,Ar)},dr=(Le,Ye,De,jt,St,Zt,Dt,Wt,nr)=>{let Kt=0;const mr=Ye.length;let Ar=Le.length-1,Ft=mr-1;for(;Kt<=Ar&&Kt<=Ft;){const Ir=Le[Kt],Sr=Ye[Kt]=nr?Ou(Ye[Kt]):ec(Ye[Kt]);if(Sm(Ir,Sr))$e(Ir,Sr,De,null,St,Zt,Dt,Wt,nr);else break;Kt++}for(;Kt<=Ar&&Kt<=Ft;){const Ir=Le[Ar],Sr=Ye[Ft]=nr?Ou(Ye[Ft]):ec(Ye[Ft]);if(Sm(Ir,Sr))$e(Ir,Sr,De,null,St,Zt,Dt,Wt,nr);else break;Ar--,Ft--}if(Kt>Ar){if(Kt<=Ft){const Ir=Ft+1,Sr=Ir<mr?Ye[Ir].el:jt;for(;Kt<=Ft;)$e(null,Ye[Kt]=nr?Ou(Ye[Kt]):ec(Ye[Kt]),De,Sr,St,Zt,Dt,Wt,nr),Kt++}}else if(Kt>Ft)for(;Kt<=Ar;)yn(Le[Kt],St,Zt,!0),Kt++;else{const Ir=Kt,Sr=Kt,tn=new Map;for(Kt=Sr;Kt<=Ft;Kt++){const Mi=Ye[Kt]=nr?Ou(Ye[Kt]):ec(Ye[Kt]);Mi.key!=null&&tn.set(Mi.key,Kt)}let Xr,vn=0;const xi=Ft-Sr+1;let Ii=!1,yo=0;const eo=new Array(xi);for(Kt=0;Kt<xi;Kt++)eo[Kt]=0;for(Kt=Ir;Kt<=Ar;Kt++){const Mi=Le[Kt];if(vn>=xi){yn(Mi,St,Zt,!0);continue}let fi;if(Mi.key!=null)fi=tn.get(Mi.key);else for(Xr=Sr;Xr<=Ft;Xr++)if(eo[Xr-Sr]===0&&Sm(Mi,Ye[Xr])){fi=Xr;break}fi===void 0?yn(Mi,St,Zt,!0):(eo[fi-Sr]=Kt+1,fi>=yo?yo=fi:Ii=!0,$e(Mi,Ye[fi],De,null,St,Zt,Dt,Wt,nr),vn++)}const co=Ii?Q4(eo):wf;for(Xr=co.length-1,Kt=xi-1;Kt>=0;Kt--){const Mi=Sr+Kt,fi=Ye[Mi],ls=Mi+1<mr?Ye[Mi+1].el:jt;eo[Kt]===0?$e(null,fi,De,ls,St,Zt,Dt,Wt,nr):Ii&&(Xr<0||Kt!==co[Xr]?Zn(fi,De,ls,2):Xr--)}}},Zn=(Le,Ye,De,jt,St=null)=>{const{el:Zt,type:Dt,transition:Wt,children:nr,shapeFlag:Kt}=Le;if(Kt&6){Zn(Le.component.subTree,Ye,De,jt);return}if(Kt&128){Le.suspense.move(Ye,De,jt);return}if(Kt&64){Dt.move(Le,Ye,De,wr);return}if(Dt===ws){u(Zt,Ye,De);for(let Ar=0;Ar<nr.length;Ar++)Zn(nr[Ar],Ye,De,jt);u(Le.anchor,Ye,De);return}if(Dt===Oy){vt(Le,Ye,De);return}if(jt!==2&&Kt&1&&Wt)if(jt===0)Wt.beforeEnter(Zt),u(Zt,Ye,De),sa(()=>Wt.enter(Zt),St);else{const{leave:Ar,delayLeave:Ft,afterLeave:Ir}=Wt,Sr=()=>u(Zt,Ye,De),tn=()=>{Ar(Zt,()=>{Sr(),Ir&&Ir()})};Ft?Ft(Zt,Sr,tn):tn()}else u(Zt,Ye,De)},yn=(Le,Ye,De,jt=!1,St=!1)=>{const{type:Zt,props:Dt,ref:Wt,children:nr,dynamicChildren:Kt,shapeFlag:mr,patchFlag:Ar,dirs:Ft,cacheIndex:Ir}=Le;if(Ar===-2&&(St=!1),Wt!=null&&jx(Wt,null,De,Le,!0),Ir!=null&&(Ye.renderCache[Ir]=void 0),mr&256){Ye.ctx.deactivate(Le);return}const Sr=mr&1&&Ft,tn=!My(Le);let Xr;if(tn&&(Xr=Dt&&Dt.onVnodeBeforeUnmount)&&Ql(Xr,Ye,Le),mr&6)li(Le.component,De,jt);else{if(mr&128){Le.suspense.unmount(De,jt);return}Sr&&$h(Le,null,Ye,"beforeUnmount"),mr&64?Le.type.remove(Le,Ye,De,wr,jt):Kt&&!Kt.hasOnce&&(Zt!==ws||Ar>0&&Ar&64)?Dn(Kt,Ye,De,!1,!0):(Zt===ws&&Ar&384||!St&&mr&16)&&Dn(nr,Ye,De),jt&&kt(Le)}(tn&&(Xr=Dt&&Dt.onVnodeUnmounted)||Sr)&&sa(()=>{Xr&&Ql(Xr,Ye,Le),Sr&&$h(Le,null,Ye,"unmounted")},De)},kt=Le=>{const{type:Ye,el:De,anchor:jt,transition:St}=Le;if(Ye===ws){fr(De,jt);return}if(Ye===Oy){zt(Le);return}const Zt=()=>{g(De),St&&!St.persisted&&St.afterLeave&&St.afterLeave()};if(Le.shapeFlag&1&&St&&!St.persisted){const{leave:Dt,delayLeave:Wt}=St,nr=()=>Dt(De,Zt);Wt?Wt(Le.el,Zt,nr):nr()}else Zt()},fr=(Le,Ye)=>{let De;for(;Le!==Ye;)De=ae(Le),g(Le),Le=De;g(Ye)},li=(Le,Ye,De)=>{const{bum:jt,scope:St,update:Zt,subTree:Dt,um:Wt,m:nr,a:Kt}=Le;YA(nr),YA(Kt),jt&&ky(jt),St.stop(),Zt&&(Zt.active=!1,yn(Dt,Le,Ye,De)),Wt&&sa(Wt,Ye),sa(()=>{Le.isUnmounted=!0},Ye),Ye&&Ye.pendingBranch&&!Ye.isUnmounted&&Le.asyncDep&&!Le.asyncResolved&&Le.suspenseId===Ye.pendingId&&(Ye.deps--,Ye.deps===0&&Ye.resolve())},Dn=(Le,Ye,De,jt=!1,St=!1,Zt=0)=>{for(let Dt=Zt;Dt<Le.length;Dt++)yn(Le[Dt],Ye,De,jt,St)},It=Le=>{if(Le.shapeFlag&6)return It(Le.component.subTree);if(Le.shapeFlag&128)return Le.suspense.next();const Ye=ae(Le.anchor||Le.el),De=Ye&&Ye[Z4];return De?ae(De):Ye};let lr=!1;const sr=(Le,Ye,De)=>{Le==null?Ye._vnode&&yn(Ye._vnode,null,null,!0):$e(Ye._vnode||null,Le,Ye,null,null,null,De),Ye._vnode=Le,lr||(lr=!0,qA(),yk(),lr=!1)},wr={p:$e,um:yn,m:Zn,r:kt,mt:An,mc:be,pc:Vr,pbc:Je,n:It,o:n};let _e,un;return{render:sr,hydrate:_e,createApp:U4(sr,_e)}}function ix({type:n,props:e},i){return i==="svg"&&n==="foreignObject"||i==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:i}function qh({effect:n,update:e},i){n.allowRecurse=e.allowRecurse=i}function J4(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Fk(n,e,i=!1){const u=n.children,g=e.children;if(sn(u)&&sn(g))for(let b=0;b<u.length;b++){const I=u[b];let L=g[b];L.shapeFlag&1&&!L.dynamicChildren&&((L.patchFlag<=0||L.patchFlag===32)&&(L=g[b]=Ou(g[b]),L.el=I.el),!i&&L.patchFlag!==-2&&Fk(I,L)),L.type===U0&&(L.el=I.el)}}function Q4(n){const e=n.slice(),i=[0];let u,g,b,I,L;const s=n.length;for(u=0;u<s;u++){const $=n[u];if($!==0){if(g=i[i.length-1],n[g]<$){e[u]=g,i.push(u);continue}for(b=0,I=i.length-1;b<I;)L=b+I>>1,n[i[L]]<$?b=L+1:I=L;$<n[i[b]]&&(b>0&&(e[u]=i[b-1]),i[b]=u)}}for(b=i.length,I=i[b-1];b-- >0;)i[b]=I,I=e[I];return i}function Nk(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Nk(e)}function YA(n){if(n)for(let e=0;e<n.length;e++)n[e].active=!1}const e5=Symbol.for("v-scx"),t5=()=>ic(e5),wy={};function Mc(n,e,i){return Vk(n,e,i)}function Vk(n,e,{immediate:i,deep:u,flush:g,once:b,onTrack:I,onTrigger:L}=Wi){if(e&&b){const qt=e;e=(...qe)=>{qt(...qe),Ct()}}const s=ns,$=qt=>u===!0?qt:zu(qt,u===!1?1:void 0);let W,Q=!1,ae=!1;if(fa(n)?(W=()=>n.value,Q=Bf(n)):Gm(n)?(W=()=>$(n),Q=!0):sn(n)?(ae=!0,Q=n.some(qt=>Gm(qt)||Bf(qt)),W=()=>n.map(qt=>{if(fa(qt))return qt.value;if(Gm(qt))return $(qt);if(wn(qt))return Hu(qt,s,2)})):wn(n)?e?W=()=>Hu(n,s,2):W=()=>(we&&we(),Il(n,s,3,[He])):W=nl,e&&u){const qt=W;W=()=>zu(qt())}let we,He=qt=>{we=vt.onStop=()=>{Hu(qt,s,4),we=vt.onStop=void 0}},$e;if($0)if(He=nl,e?i&&Il(e,s,3,[W(),ae?[]:void 0,He]):W(),g==="sync"){const qt=t5();$e=qt.__watcherHandles||(qt.__watcherHandles=[])}else return nl;let Ne=ae?new Array(n.length).fill(wy):wy;const wt=()=>{if(!(!vt.active||!vt.dirty))if(e){const qt=vt.run();(u||Q||(ae?qt.some((qe,be)=>Yu(qe,Ne[be])):Yu(qt,Ne)))&&(we&&we(),Il(e,s,3,[qt,Ne===wy?void 0:ae&&Ne[0]===wy?[]:Ne,He]),Ne=qt)}else vt.run()};wt.allowRecurse=!!e;let mt;g==="sync"?mt=wt:g==="post"?mt=()=>sa(wt,s&&s.suspense):(wt.pre=!0,s&&(wt.id=s.uid),mt=()=>J1(wt));const vt=new $1(W,nl,mt),zt=Gz(),Ct=()=>{vt.stop(),zt&&V1(zt.effects,vt)};return e?i?wt():Ne=vt.run():g==="post"?sa(vt.run.bind(vt),s&&s.suspense):vt.run(),$e&&$e.push(Ct),Ct}function r5(n,e,i){const u=this.proxy,g=So(n)?n.includes(".")?Uk(u,n):()=>u[n]:n.bind(u,u);let b;wn(e)?b=e:(b=e.handler,i=e);const I=kg(this),L=Vk(g,b.bind(u),i);return I(),L}function Uk(n,e){const i=e.split(".");return()=>{let u=n;for(let g=0;g<i.length&&u;g++)u=u[i[g]];return u}}function zu(n,e=1/0,i){if(e<=0||!Bi(n)||n.__v_skip||(i=i||new Set,i.has(n)))return n;if(i.add(n),e--,fa(n))zu(n.value,e,i);else if(sn(n))for(let u=0;u<n.length;u++)zu(n[u],e,i);else if(R0(n)||Tf(n))n.forEach(u=>{zu(u,e,i)});else if(WR(n)){for(const u in n)zu(n[u],e,i);for(const u of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,u)&&zu(n[u],e,i)}return n}const n5=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Sl(e)}Modifiers`]||n[`${rh(e)}Modifiers`];function i5(n,e,...i){if(n.isUnmounted)return;const u=n.vnode.props||Wi;let g=i;const b=e.startsWith("update:"),I=b&&n5(u,e.slice(7));I&&(I.trim&&(g=i.map(W=>So(W)?W.trim():W)),I.number&&(g=i.map(Yy)));let L,s=u[L=tx(e)]||u[L=tx(Sl(e))];!s&&b&&(s=u[L=tx(rh(e))]),s&&Il(s,n,6,g);const $=u[L+"Once"];if($){if(!n.emitted)n.emitted={};else if(n.emitted[L])return;n.emitted[L]=!0,Il($,n,6,g)}}function jk(n,e,i=!1){const u=e.emitsCache,g=u.get(n);if(g!==void 0)return g;const b=n.emits;let I={},L=!1;if(!wn(n)){const s=$=>{const W=jk($,e,!0);W&&(L=!0,As(I,W))};!i&&e.mixins.length&&e.mixins.forEach(s),n.extends&&s(n.extends),n.mixins&&n.mixins.forEach(s)}return!b&&!L?(Bi(n)&&u.set(n,null),null):(sn(b)?b.forEach(s=>I[s]=null):As(I,b),Bi(n)&&u.set(n,I),I)}function V0(n,e){return!n||!C0(e)?!1:(e=e.slice(2).replace(/Once$/,""),Qn(n,e[0].toLowerCase()+e.slice(1))||Qn(n,rh(e))||Qn(n,e))}function ox(n){const{type:e,vnode:i,proxy:u,withProxy:g,propsOptions:[b],slots:I,attrs:L,emit:s,render:$,renderCache:W,props:Q,data:ae,setupState:we,ctx:He,inheritAttrs:$e}=n,Ne=Jy(n);let wt,mt;try{if(i.shapeFlag&4){const zt=g||u,Ct=zt;wt=ec($.call(Ct,zt,W,Q,we,ae,He)),mt=L}else{const zt=e;wt=ec(zt.length>1?zt(Q,{attrs:L,slots:I,emit:s}):zt(Q,null)),mt=e.props?L:o5(L)}}catch(zt){Wm.length=0,L0(zt,n,1),wt=ui(id)}let vt=wt;if(mt&&$e!==!1){const zt=Object.keys(mt),{shapeFlag:Ct}=vt;zt.length&&Ct&7&&(b&&zt.some(N1)&&(mt=s5(mt,b)),vt=zf(vt,mt,!1,!0))}return i.dirs&&(vt=zf(vt,null,!1,!0),vt.dirs=vt.dirs?vt.dirs.concat(i.dirs):i.dirs),i.transition&&(vt.transition=i.transition),wt=vt,Jy(Ne),wt}const o5=n=>{let e;for(const i in n)(i==="class"||i==="style"||C0(i))&&((e||(e={}))[i]=n[i]);return e},s5=(n,e)=>{const i={};for(const u in n)(!N1(u)||!(u.slice(9)in e))&&(i[u]=n[u]);return i};function a5(n,e,i){const{props:u,children:g,component:b}=n,{props:I,children:L,patchFlag:s}=e,$=b.emitsOptions;if(e.dirs||e.transition)return!0;if(i&&s>=0){if(s&1024)return!0;if(s&16)return u?JA(u,I,$):!!I;if(s&8){const W=e.dynamicProps;for(let Q=0;Q<W.length;Q++){const ae=W[Q];if(I[ae]!==u[ae]&&!V0($,ae))return!0}}}else return(g||L)&&(!L||!L.$stable)?!0:u===I?!1:u?I?JA(u,I,$):!0:!!I;return!1}function JA(n,e,i){const u=Object.keys(e);if(u.length!==Object.keys(n).length)return!0;for(let g=0;g<u.length;g++){const b=u[g];if(e[b]!==n[b]&&!V0(i,b))return!0}return!1}function l5({vnode:n,parent:e},i){for(;e;){const u=e.subTree;if(u.suspense&&u.suspense.activeBranch===n&&(u.el=n.el),u===n)(n=e.vnode).el=i,e=e.parent;else break}}const c5=n=>n.__isSuspense;function u5(n,e){e&&e.pendingBranch?sn(n)?e.effects.push(...n):e.effects.push(n):v4(n)}const ws=Symbol.for("v-fgt"),U0=Symbol.for("v-txt"),id=Symbol.for("v-cmt"),Oy=Symbol.for("v-stc"),Wm=[];let Ca=null;function en(n=!1){Wm.push(Ca=n?null:[])}function h5(){Wm.pop(),Ca=Wm[Wm.length-1]||null}let ag=1;function QA(n){ag+=n,n<0&&Ca&&(Ca.hasOnce=!0)}function $k(n){return n.dynamicChildren=ag>0?Ca||wf:null,h5(),ag>0&&Ca&&Ca.push(n),n}function rn(n,e,i,u,g,b){return $k(dt(n,e,i,u,g,b,!0))}function d5(n,e,i,u,g){return $k(ui(n,e,i,u,g,!0))}function $x(n){return n?n.__v_isVNode===!0:!1}function Sm(n,e){return n.type===e.type&&n.key===e.key}const qk=({key:n})=>n??null,By=({ref:n,ref_key:e,ref_for:i})=>(typeof n=="number"&&(n=""+n),n!=null?So(n)||fa(n)||wn(n)?{i:la,r:n,k:e,f:!!i}:n:null);function dt(n,e=null,i=null,u=0,g=null,b=n===ws?0:1,I=!1,L=!1){const s={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&qk(e),ref:e&&By(e),scopeId:B0,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:b,patchFlag:u,dynamicProps:g,dynamicChildren:null,appContext:null,ctx:la};return L?(tw(s,i),b&128&&n.normalize(s)):i&&(s.shapeFlag|=So(i)?8:16),ag>0&&!I&&Ca&&(s.patchFlag>0||b&6)&&s.patchFlag!==32&&Ca.push(s),s}const ui=f5;function f5(n,e=null,i=null,u=0,g=null,b=!1){if((!n||n===M4)&&(n=id),$x(n)){const L=zf(n,e,!0);return i&&tw(L,i),ag>0&&!b&&Ca&&(L.shapeFlag&6?Ca[Ca.indexOf(n)]=L:Ca.push(L)),L.patchFlag=-2,L}if(I5(n)&&(n=n.__vccOpts),e){e=p5(e);let{class:L,style:s}=e;L&&!So(L)&&(e.class=Cg(L)),Bi(s)&&(hk(s)&&!sn(s)&&(s=As({},s)),e.style=j1(s))}const I=So(n)?1:c5(n)?128:X4(n)?64:Bi(n)?4:wn(n)?2:0;return dt(n,e,i,u,g,I,b,!0)}function p5(n){return n?hk(n)||Pk(n)?As({},n):n:null}function zf(n,e,i=!1,u=!1){const{props:g,ref:b,patchFlag:I,children:L,transition:s}=n,$=e?m5(g||{},e):g,W={__v_isVNode:!0,__v_skip:!0,type:n.type,props:$,key:$&&qk($),ref:e&&e.ref?i&&b?sn(b)?b.concat(By(e)):[b,By(e)]:By(e):b,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:L,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==ws?I===-1?16:I|16:I,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:s,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&zf(n.ssContent),ssFallback:n.ssFallback&&zf(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return s&&u&&bk(W,s.clone(W)),W}function ts(n=" ",e=0){return ui(U0,null,n,e)}function j0(n,e){const i=ui(Oy,null,n);return i.staticCount=e,i}function hi(n="",e=!1){return e?(en(),d5(id,null,n)):ui(id,null,n)}function ec(n){return n==null||typeof n=="boolean"?ui(id):sn(n)?ui(ws,null,n.slice()):typeof n=="object"?Ou(n):ui(U0,null,String(n))}function Ou(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:zf(n)}function tw(n,e){let i=0;const{shapeFlag:u}=n;if(e==null)e=null;else if(sn(e))i=16;else if(typeof e=="object")if(u&65){const g=e.default;g&&(g._c&&(g._d=!1),tw(n,g()),g._c&&(g._d=!0));return}else{i=32;const g=e._;!g&&!Pk(e)?e._ctx=la:g===3&&la&&(la.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else wn(e)?(e={default:e,_ctx:la},i=32):(e=String(e),u&64?(i=16,e=[ts(e)]):i=8);n.children=e,n.shapeFlag|=i}function m5(...n){const e={};for(let i=0;i<n.length;i++){const u=n[i];for(const g in u)if(g==="class")e.class!==u.class&&(e.class=Cg([e.class,u.class]));else if(g==="style")e.style=j1([e.style,u.style]);else if(C0(g)){const b=e[g],I=u[g];I&&b!==I&&!(sn(b)&&b.includes(I))&&(e[g]=b?[].concat(b,I):I)}else g!==""&&(e[g]=u[g])}return e}function Ql(n,e,i,u=null){Il(n,e,7,[i,u])}const g5=Ck();let _5=0;function y5(n,e,i){const u=n.type,g=(e?e.appContext:n.appContext)||g5,b={uid:_5++,vnode:n,type:u,parent:e,appContext:g,root:null,next:null,subTree:null,effect:null,update:null,scope:new $z(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(g.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Dk(u,g),emitsOptions:jk(u,g),emit:null,emitted:null,propsDefaults:Wi,inheritAttrs:u.inheritAttrs,ctx:Wi,data:Wi,props:Wi,attrs:Wi,slots:Wi,refs:Wi,setupState:Wi,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return b.ctx={_:b},b.root=e?e.root:b,b.emit=i5.bind(null,b),n.ce&&n.ce(b),b}let ns=null;const v5=()=>ns||la;let t0,qx;{const n=XR(),e=(i,u)=>{let g;return(g=n[i])||(g=n[i]=[]),g.push(u),b=>{g.length>1?g.forEach(I=>I(b)):g[0](b)}};t0=e("__VUE_INSTANCE_SETTERS__",i=>ns=i),qx=e("__VUE_SSR_SETTERS__",i=>$0=i)}const kg=n=>{const e=ns;return t0(n),n.scope.on(),()=>{n.scope.off(),t0(e)}},eS=()=>{ns&&ns.scope.off(),t0(null)};function Gk(n){return n.vnode.shapeFlag&4}let $0=!1;function b5(n,e=!1,i=!1){e&&qx(e);const{props:u,children:g}=n.vnode,b=Gk(n);j4(n,u,b,e),H4(n,g,i);const I=b?x5(n,e):void 0;return e&&qx(!1),I}function x5(n,e){const i=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,L4);const{setup:u}=i;if(u){const g=n.setupContext=u.length>1?T5(n):null,b=kg(n);nh();const I=Hu(u,n,0,[n.props,g]);if(ih(),b(),GR(I)){if(I.then(eS,eS),e)return I.then(L=>{tS(n,L,e)}).catch(L=>{L0(L,n,0)});n.asyncDep=I}else tS(n,I,e)}else Hk(n,e)}function tS(n,e,i){wn(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Bi(e)&&(n.setupState=mk(e)),Hk(n,i)}let rS;function Hk(n,e,i){const u=n.type;if(!n.render){if(!e&&rS&&!u.render){const g=u.template||Q1(n).template;if(g){const{isCustomElement:b,compilerOptions:I}=n.appContext.config,{delimiters:L,compilerOptions:s}=u,$=As(As({isCustomElement:b,delimiters:L},I),s);u.render=rS(g,$)}}n.render=u.render||nl}{const g=kg(n);nh();try{O4(n)}finally{ih(),g()}}}const w5={get(n,e){return da(n,"get",""),n[e]}};function T5(n){const e=i=>{n.exposed=i||{}};return{attrs:new Proxy(n.attrs,w5),slots:n.slots,emit:n.emit,expose:e}}function q0(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(mk(h4(n.exposed)),{get(e,i){if(i in e)return e[i];if(i in Hm)return Hm[i](n)},has(e,i){return i in e||i in Hm}})):n.proxy}function E5(n,e=!0){return wn(n)?n.displayName||n.name:n.name||e&&n.__name}function I5(n){return wn(n)&&"__vccOpts"in n}const El=(n,e)=>d4(n,e,$0);function Wk(n,e,i){const u=arguments.length;return u===2?Bi(e)&&!sn(e)?$x(e)?ui(n,null,[e]):ui(n,e):ui(n,null,e):(u>3?i=Array.prototype.slice.call(arguments,2):u===3&&$x(i)&&(i=[i]),ui(n,e,i))}const A5="3.4.37";/**
* @vue/runtime-dom v3.4.37
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const S5="http://www.w3.org/2000/svg",C5="http://www.w3.org/1998/Math/MathML",kc=typeof document<"u"?document:null,nS=kc&&kc.createElement("template"),R5={insert:(n,e,i)=>{e.insertBefore(n,i||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,i,u)=>{const g=e==="svg"?kc.createElementNS(S5,n):e==="mathml"?kc.createElementNS(C5,n):i?kc.createElement(n,{is:i}):kc.createElement(n);return n==="select"&&u&&u.multiple!=null&&g.setAttribute("multiple",u.multiple),g},createText:n=>kc.createTextNode(n),createComment:n=>kc.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>kc.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,i,u,g,b){const I=i?i.previousSibling:e.lastChild;if(g&&(g===b||g.nextSibling))for(;e.insertBefore(g.cloneNode(!0),i),!(g===b||!(g=g.nextSibling)););else{nS.innerHTML=u==="svg"?`<svg>${n}</svg>`:u==="mathml"?`<math>${n}</math>`:n;const L=nS.content;if(u==="svg"||u==="mathml"){const s=L.firstChild;for(;s.firstChild;)L.appendChild(s.firstChild);L.removeChild(s)}e.insertBefore(L,i)}return[I?I.nextSibling:e.firstChild,i?i.previousSibling:e.lastChild]}},k5=Symbol("_vtc");function P5(n,e,i){const u=n[k5];u&&(e=(e?[e,...u]:[...u]).join(" ")),e==null?n.removeAttribute("class"):i?n.setAttribute("class",e):n.className=e}const iS=Symbol("_vod"),M5=Symbol("_vsh"),D5=Symbol(""),L5=/(^|;)\s*display\s*:/;function O5(n,e,i){const u=n.style,g=So(i);let b=!1;if(i&&!g){if(e)if(So(e))for(const I of e.split(";")){const L=I.slice(0,I.indexOf(":")).trim();i[L]==null&&zy(u,L,"")}else for(const I in e)i[I]==null&&zy(u,I,"");for(const I in i)I==="display"&&(b=!0),zy(u,I,i[I])}else if(g){if(e!==i){const I=u[D5];I&&(i+=";"+I),u.cssText=i,b=L5.test(i)}}else e&&n.removeAttribute("style");iS in n&&(n[iS]=b?u.display:"",n[M5]&&(u.display="none"))}const oS=/\s*!important$/;function zy(n,e,i){if(sn(i))i.forEach(u=>zy(n,e,u));else if(i==null&&(i=""),e.startsWith("--"))n.setProperty(e,i);else{const u=B5(n,e);oS.test(i)?n.setProperty(rh(u),i.replace(oS,""),"important"):n[u]=i}}const sS=["Webkit","Moz","ms"],sx={};function B5(n,e){const i=sx[e];if(i)return i;let u=Sl(e);if(u!=="filter"&&u in n)return sx[e]=u;u=P0(u);for(let g=0;g<sS.length;g++){const b=sS[g]+u;if(b in n)return sx[e]=b}return e}const aS="http://www.w3.org/1999/xlink";function lS(n,e,i,u,g,b=Vz(e)){u&&e.startsWith("xlink:")?i==null?n.removeAttributeNS(aS,e.slice(6,e.length)):n.setAttributeNS(aS,e,i):i==null||b&&!KR(i)?n.removeAttribute(e):n.setAttribute(e,b?"":uc(i)?String(i):i)}function z5(n,e,i,u){if(e==="innerHTML"||e==="textContent"){if(i==null)return;n[e]=i;return}const g=n.tagName;if(e==="value"&&g!=="PROGRESS"&&!g.includes("-")){const I=g==="OPTION"?n.getAttribute("value")||"":n.value,L=i==null?"":String(i);(I!==L||!("_value"in n))&&(n.value=L),i==null&&n.removeAttribute(e),n._value=i;return}let b=!1;if(i===""||i==null){const I=typeof n[e];I==="boolean"?i=KR(i):i==null&&I==="string"?(i="",b=!0):I==="number"&&(i=0,b=!0)}try{n[e]=i}catch{}b&&n.removeAttribute(e)}function Wh(n,e,i,u){n.addEventListener(e,i,u)}function F5(n,e,i,u){n.removeEventListener(e,i,u)}const cS=Symbol("_vei");function N5(n,e,i,u,g=null){const b=n[cS]||(n[cS]={}),I=b[e];if(u&&I)I.value=u;else{const[L,s]=V5(e);if(u){const $=b[e]=$5(u,g);Wh(n,L,$,s)}else I&&(F5(n,L,I,s),b[e]=void 0)}}const uS=/(?:Once|Passive|Capture)$/;function V5(n){let e;if(uS.test(n)){e={};let u;for(;u=n.match(uS);)n=n.slice(0,n.length-u[0].length),e[u[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):rh(n.slice(2)),e]}let ax=0;const U5=Promise.resolve(),j5=()=>ax||(U5.then(()=>ax=0),ax=Date.now());function $5(n,e){const i=u=>{if(!u._vts)u._vts=Date.now();else if(u._vts<=i.attached)return;Il(q5(u,i.value),e,5,[u])};return i.value=n,i.attached=j5(),i}function q5(n,e){if(sn(e)){const i=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{i.call(n),n._stopped=!0},e.map(u=>g=>!g._stopped&&u&&u(g))}else return e}const hS=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,G5=(n,e,i,u,g,b)=>{const I=g==="svg";e==="class"?P5(n,u,I):e==="style"?O5(n,i,u):C0(e)?N1(e)||N5(n,e,i,u,b):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):H5(n,e,u,I))?(z5(n,e,u),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&lS(n,e,u,I,b,e!=="value")):(e==="true-value"?n._trueValue=u:e==="false-value"&&(n._falseValue=u),lS(n,e,u,I))};function H5(n,e,i,u){if(u)return!!(e==="innerHTML"||e==="textContent"||e in n&&hS(e)&&wn(i));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const g=n.tagName;if(g==="IMG"||g==="VIDEO"||g==="CANVAS"||g==="SOURCE")return!1}return hS(e)&&So(i)?!1:e in n}const r0=n=>{const e=n.props["onUpdate:modelValue"]||!1;return sn(e)?i=>ky(e,i):e};function W5(n){n.target.composing=!0}function dS(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Af=Symbol("_assign"),Is={created(n,{modifiers:{lazy:e,trim:i,number:u}},g){n[Af]=r0(g);const b=u||g.props&&g.props.type==="number";Wh(n,e?"change":"input",I=>{if(I.target.composing)return;let L=n.value;i&&(L=L.trim()),b&&(L=Yy(L)),n[Af](L)}),i&&Wh(n,"change",()=>{n.value=n.value.trim()}),e||(Wh(n,"compositionstart",W5),Wh(n,"compositionend",dS),Wh(n,"change",dS))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:i,modifiers:{lazy:u,trim:g,number:b}},I){if(n[Af]=r0(I),n.composing)return;const L=(b||n.type==="number")&&!/^0\d/.test(n.value)?Yy(n.value):n.value,s=e??"";L!==s&&(document.activeElement===n&&n.type!=="range"&&(u&&e===i||g&&n.value.trim()===s)||(n.value=s))}},G0={deep:!0,created(n,{value:e,modifiers:{number:i}},u){const g=R0(e);Wh(n,"change",()=>{const b=Array.prototype.filter.call(n.options,I=>I.selected).map(I=>i?Yy(n0(I)):n0(I));n[Af](n.multiple?g?new Set(b):b:b[0]),n._assigning=!0,O0(()=>{n._assigning=!1})}),n[Af]=r0(u)},mounted(n,{value:e,modifiers:{number:i}}){fS(n,e)},beforeUpdate(n,e,i){n[Af]=r0(i)},updated(n,{value:e,modifiers:{number:i}}){n._assigning||fS(n,e)}};function fS(n,e,i){const u=n.multiple,g=sn(e);if(!(u&&!g&&!R0(e))){for(let b=0,I=n.options.length;b<I;b++){const L=n.options[b],s=n0(L);if(u)if(g){const $=typeof s;$==="string"||$==="number"?L.selected=e.some(W=>String(W)===String(s)):L.selected=jz(e,s)>-1}else L.selected=e.has(s);else if(M0(n0(L),e)){n.selectedIndex!==b&&(n.selectedIndex=b);return}}!u&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function n0(n){return"_value"in n?n._value:n.value}const Z5=["ctrl","shift","alt","meta"],X5={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>Z5.some(i=>n[`${i}Key`]&&!e.includes(i))},H0=(n,e)=>{const i=n._withMods||(n._withMods={}),u=e.join(".");return i[u]||(i[u]=(g,...b)=>{for(let I=0;I<e.length;I++){const L=X5[e[I]];if(L&&L(g,e))return}return n(g,...b)})},K5={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},i0=(n,e)=>{const i=n._withKeys||(n._withKeys={}),u=e.join(".");return i[u]||(i[u]=g=>{if(!("key"in g))return;const b=rh(g.key);if(e.some(I=>I===b||K5[I]===b))return n(g)})},Y5=As({patchProp:G5},R5);let pS;function J5(){return pS||(pS=K4(Y5))}const Q5=(...n)=>{const e=J5().createApp(...n),{mount:i}=e;return e.mount=u=>{const g=tF(u);if(!g)return;const b=e._component;!wn(b)&&!b.render&&!b.template&&(b.template=g.innerHTML),g.innerHTML="";const I=i(g,!1,eF(g));return g instanceof Element&&(g.removeAttribute("v-cloak"),g.setAttribute("data-v-app","")),I},e};function eF(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function tF(n){return So(n)?document.querySelector(n):n}const Zk=""+new URL("../Tools.png",import.meta.url).href,zs=(n,e)=>{const i=n.__vccOpts||n;for(const[u,g]of e)i[u]=g;return i},Xk=n=>(z0("data-v-8853acf0"),n=n(),F0(),n),rF=Xk(()=>dt("link",{rel:"icon",href:"/favicon.ico"},null,-1)),nF={class:"container"},iF={class:"d-flex justify-content-center py-2 border-bottom"},oF=Xk(()=>dt("a",{href:"/home",class:"d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none"},[dt("img",{class:"d-block mx-auto",src:Zk,alt:"Tools",width:"40",height:"32"}),dt("span",{class:"fs-4"},"Tools")],-1)),sF={class:"nav nav-pills"},aF={key:0,class:"nav-item"},lF={key:1,class:"nav-item"},cF={key:2,class:"nav-item"},uF={key:3,class:"nav-item"},hF={key:4,class:"nav-item"},dF={key:5,class:"nav-item"},fF={key:6,class:"nav-item"},pF={key:7,class:"nav-item"},mF={key:8,class:"nav-item"},gF={key:9,class:"nav-item"},_F={class:"col-md-3 text-end"},yF={key:0,type:"button",class:"btn btn-outline-primary me-2"},vF={key:1,type:"button",class:"btn btn-outline-success me-2"},bF={key:2,type:"button",class:"btn btn-outline-secondary me-2"},xF={__name:"BHeader",setup(n){const e=sessionStorage.getItem("user"),i=sessionStorage.getItem("role");return(u,g)=>{const b=Dy("router-link");return en(),rn(ws,null,[rF,dt("div",nF,[dt("header",iF,[oF,dt("ul",sF,[Nn(e)!=null&&Nn(e)!==""&&Nn(i)=="admin"?(en(),rn("li",aF,[ui(b,{to:"/dashboard",class:"nav-link","active-class":"active","aria-current":"page"},{default:oa(()=>[ts("Dash")]),_:1})])):hi("",!0),Nn(e)==null||Nn(e)==""?(en(),rn("li",lF,[ui(b,{to:"/GetAllBookAPI",class:"nav-link","active-class":"active"},{default:oa(()=>[ts("Books API")]),_:1})])):hi("",!0),Nn(e)==null||Nn(e)==""?(en(),rn("li",cF,[ui(b,{to:"/UserAPI",class:"nav-link","active-class":"active"},{default:oa(()=>[ts("Users API")]),_:1})])):hi("",!0),Nn(e)!=null&&Nn(e)!==""?(en(),rn("li",uF,[ui(b,{to:"/week12/admin",class:"nav-link","active-class":"active","aria-current":"page"},{default:oa(()=>[ts("Admin")]),_:1})])):hi("",!0),Nn(e)!=null&&Nn(e)!==""?(en(),rn("li",hF,[ui(b,{to:"/addBook",class:"nav-link","active-class":"active"},{default:oa(()=>[ts("Add Book")]),_:1})])):hi("",!0),Nn(e)!=null&&Nn(e)!==""?(en(),rn("li",dF,[ui(b,{to:"/sendMail",class:"nav-link","active-class":"active","aria-current":"page"},{default:oa(()=>[ts("Mail")]),_:1})])):hi("",!0),Nn(e)!=null&&Nn(e)!==""?(en(),rn("li",fF,[ui(b,{to:"/WeatherCheck",class:"nav-link","active-class":"active"},{default:oa(()=>[ts("Weather")]),_:1})])):hi("",!0),Nn(e)!=null&&Nn(e)!==""?(en(),rn("li",pF,[ui(b,{to:"/map",class:"nav-link","active-class":"active"},{default:oa(()=>[ts("Map")]),_:1})])):hi("",!0),Nn(e)!=null&&Nn(e)!==""?(en(),rn("li",mF,[ui(b,{to:"/pathNav",class:"nav-link","active-class":"active"},{default:oa(()=>[ts("Path")]),_:1})])):hi("",!0),Nn(e)!=null&&Nn(e)!==""?(en(),rn("li",gF,[ui(b,{to:"/ai",class:"nav-link","active-class":"active"},{default:oa(()=>[ts("GenAI")]),_:1})])):hi("",!0)]),dt("div",_F,[Nn(e)==null||Nn(e)==""?(en(),rn("button",yF,[ui(b,{to:"/login",class:"nav-link"},{default:oa(()=>[ts("Login")]),_:1})])):hi("",!0),Nn(e)==null||Nn(e)==""?(en(),rn("button",vF,[ui(b,{to:"/register",class:"nav-link"},{default:oa(()=>[ts("Sign-up")]),_:1})])):hi("",!0),Nn(e)!=null&&Nn(e)!=""?(en(),rn("button",bF,[ui(b,{to:"/logout",class:"nav-link"},{default:oa(()=>[ts(Vn(Nn(e)),1)]),_:1})])):hi("",!0)])])])],64)}}},wF=zs(xF,[["__scopeId","data-v-8853acf0"]]),TF=""+new URL("../twitter.png",import.meta.url).href,EF=""+new URL("../instagram.png",import.meta.url).href,IF=""+new URL("../email.png",import.meta.url).href,AF={name:"FooterCopyright"},SF={class:"container mt-5"},CF=j0('<footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top"><div class="col-md-4 d-flex align-items-center"><a href="/" class="mb-3 me-2 mb-md-0 text-muted text-decoration-none lh-1"><svg class="bi" width="30" height="24"><use xlink:href="#bootstrap"></use></svg></a><span class="mb-3 mb-md-0 text-muted"> 2024 <strong>Yupeng Liu</strong>. All rights reserved.</span></div><ul class="nav col-md-4 justify-content-end list-unstyled d-flex"><li class="ms-3"><a class="text-muted" href="#"><img src="'+TF+'" alt="twitter" width="30" height="30"></a></li><li class="ms-3"><a class="text-muted" href="#"><img src="'+EF+'" alt="instagram" width="30" height="30"></a></li><li class="ms-3"><a class="text-muted" href="mailto:yupengliu92@gmail.com"><img src="'+IF+'" alt="email" width="30" height="30"></a></li></ul></footer>',1),RF=[CF];function kF(n,e,i,u,g,b){return en(),rn("div",SF,RF)}const PF=zs(AF,[["render",kF]]),MF={name:"APP",components:{BHeader:wF,BFooter:PF},computed:{showHeader(){return this.$route.name!=="UserAPI"&&this.$route.name!=="GetAllBookAPI"}}},DF={key:0},LF={key:1};function OF(n,e,i,u,g,b){const I=Dy("BHeader"),L=Dy("router-view"),s=Dy("BFooter");return en(),rn(ws,null,[b.showHeader?(en(),rn("header",DF,[ui(I)])):hi("",!0),dt("main",null,[ui(L)]),b.showHeader?(en(),rn("footer",LF,[ui(s)])):hi("",!0)],64)}const BF=zs(MF,[["render",OF],["__scopeId","data-v-44a52223"]]);/*!
  * vue-router v4.4.3
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const gf=typeof document<"u";function zF(n){return n.__esModule||n[Symbol.toStringTag]==="Module"}const bi=Object.assign;function lx(n,e){const i={};for(const u in e){const g=e[u];i[u]=Cl(g)?g.map(n):n(g)}return i}const Zm=()=>{},Cl=Array.isArray,Kk=/#/g,FF=/&/g,NF=/\//g,VF=/=/g,UF=/\?/g,Yk=/\+/g,jF=/%5B/g,$F=/%5D/g,Jk=/%5E/g,qF=/%60/g,Qk=/%7B/g,GF=/%7C/g,eP=/%7D/g,HF=/%20/g;function rw(n){return encodeURI(""+n).replace(GF,"|").replace(jF,"[").replace($F,"]")}function WF(n){return rw(n).replace(Qk,"{").replace(eP,"}").replace(Jk,"^")}function Gx(n){return rw(n).replace(Yk,"%2B").replace(HF,"+").replace(Kk,"%23").replace(FF,"%26").replace(qF,"`").replace(Qk,"{").replace(eP,"}").replace(Jk,"^")}function ZF(n){return Gx(n).replace(VF,"%3D")}function XF(n){return rw(n).replace(Kk,"%23").replace(UF,"%3F")}function KF(n){return n==null?"":XF(n).replace(NF,"%2F")}function lg(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const YF=/\/$/,JF=n=>n.replace(YF,"");function cx(n,e,i="/"){let u,g={},b="",I="";const L=e.indexOf("#");let s=e.indexOf("?");return L<s&&L>=0&&(s=-1),s>-1&&(u=e.slice(0,s),b=e.slice(s+1,L>-1?L:e.length),g=n(b)),L>-1&&(u=u||e.slice(0,L),I=e.slice(L,e.length)),u=rN(u??e,i),{fullPath:u+(b&&"?")+b+I,path:u,query:g,hash:lg(I)}}function QF(n,e){const i=e.query?n(e.query):"";return e.path+(i&&"?")+i+(e.hash||"")}function mS(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function eN(n,e,i){const u=e.matched.length-1,g=i.matched.length-1;return u>-1&&u===g&&Ff(e.matched[u],i.matched[g])&&tP(e.params,i.params)&&n(e.query)===n(i.query)&&e.hash===i.hash}function Ff(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function tP(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!tN(n[i],e[i]))return!1;return!0}function tN(n,e){return Cl(n)?gS(n,e):Cl(e)?gS(e,n):n===e}function gS(n,e){return Cl(e)?n.length===e.length&&n.every((i,u)=>i===e[u]):n.length===1&&n[0]===e}function rN(n,e){if(n.startsWith("/"))return n;if(!n)return e;const i=e.split("/"),u=n.split("/"),g=u[u.length-1];(g===".."||g===".")&&u.push("");let b=i.length-1,I,L;for(I=0;I<u.length;I++)if(L=u[I],L!==".")if(L==="..")b>1&&b--;else break;return i.slice(0,b).join("/")+"/"+u.slice(I).join("/")}const Pu={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var cg;(function(n){n.pop="pop",n.push="push"})(cg||(cg={}));var Xm;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Xm||(Xm={}));function nN(n){if(!n)if(gf){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),JF(n)}const iN=/^[^#]+#/;function oN(n,e){return n.replace(iN,"#")+e}function sN(n,e){const i=document.documentElement.getBoundingClientRect(),u=n.getBoundingClientRect();return{behavior:e.behavior,left:u.left-i.left-(e.left||0),top:u.top-i.top-(e.top||0)}}const W0=()=>({left:window.scrollX,top:window.scrollY});function aN(n){let e;if("el"in n){const i=n.el,u=typeof i=="string"&&i.startsWith("#"),g=typeof i=="string"?u?document.getElementById(i.slice(1)):document.querySelector(i):i;if(!g)return;e=sN(g,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function _S(n,e){return(history.state?history.state.position-e:-1)+n}const Hx=new Map;function lN(n,e){Hx.set(n,e)}function cN(n){const e=Hx.get(n);return Hx.delete(n),e}let uN=()=>location.protocol+"//"+location.host;function rP(n,e){const{pathname:i,search:u,hash:g}=e,b=n.indexOf("#");if(b>-1){let L=g.includes(n.slice(b))?n.slice(b).length:1,s=g.slice(L);return s[0]!=="/"&&(s="/"+s),mS(s,"")}return mS(i,n)+u+g}function hN(n,e,i,u){let g=[],b=[],I=null;const L=({state:ae})=>{const we=rP(n,location),He=i.value,$e=e.value;let Ne=0;if(ae){if(i.value=we,e.value=ae,I&&I===He){I=null;return}Ne=$e?ae.position-$e.position:0}else u(we);g.forEach(wt=>{wt(i.value,He,{delta:Ne,type:cg.pop,direction:Ne?Ne>0?Xm.forward:Xm.back:Xm.unknown})})};function s(){I=i.value}function $(ae){g.push(ae);const we=()=>{const He=g.indexOf(ae);He>-1&&g.splice(He,1)};return b.push(we),we}function W(){const{history:ae}=window;ae.state&&ae.replaceState(bi({},ae.state,{scroll:W0()}),"")}function Q(){for(const ae of b)ae();b=[],window.removeEventListener("popstate",L),window.removeEventListener("beforeunload",W)}return window.addEventListener("popstate",L),window.addEventListener("beforeunload",W,{passive:!0}),{pauseListeners:s,listen:$,destroy:Q}}function yS(n,e,i,u=!1,g=!1){return{back:n,current:e,forward:i,replaced:u,position:window.history.length,scroll:g?W0():null}}function dN(n){const{history:e,location:i}=window,u={value:rP(n,i)},g={value:e.state};g.value||b(u.value,{back:null,current:u.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function b(s,$,W){const Q=n.indexOf("#"),ae=Q>-1?(i.host&&document.querySelector("base")?n:n.slice(Q))+s:uN()+n+s;try{e[W?"replaceState":"pushState"]($,"",ae),g.value=$}catch(we){console.error(we),i[W?"replace":"assign"](ae)}}function I(s,$){const W=bi({},e.state,yS(g.value.back,s,g.value.forward,!0),$,{position:g.value.position});b(s,W,!0),u.value=s}function L(s,$){const W=bi({},g.value,e.state,{forward:s,scroll:W0()});b(W.current,W,!0);const Q=bi({},yS(u.value,s,null),{position:W.position+1},$);b(s,Q,!1),u.value=s}return{location:u,state:g,push:L,replace:I}}function fN(n){n=nN(n);const e=dN(n),i=hN(n,e.state,e.location,e.replace);function u(b,I=!0){I||i.pauseListeners(),history.go(b)}const g=bi({location:"",base:n,go:u,createHref:oN.bind(null,n)},e,i);return Object.defineProperty(g,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(g,"state",{enumerable:!0,get:()=>e.state.value}),g}function pN(n){return typeof n=="string"||n&&typeof n=="object"}function nP(n){return typeof n=="string"||typeof n=="symbol"}const iP=Symbol("");var vS;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(vS||(vS={}));function Nf(n,e){return bi(new Error,{type:n,[iP]:!0},e)}function Rc(n,e){return n instanceof Error&&iP in n&&(e==null||!!(n.type&e))}const bS="[^/]+?",mN={sensitive:!1,strict:!1,start:!0,end:!0},gN=/[.+*?^${}()[\]/\\]/g;function _N(n,e){const i=bi({},mN,e),u=[];let g=i.start?"^":"";const b=[];for(const $ of n){const W=$.length?[]:[90];i.strict&&!$.length&&(g+="/");for(let Q=0;Q<$.length;Q++){const ae=$[Q];let we=40+(i.sensitive?.25:0);if(ae.type===0)Q||(g+="/"),g+=ae.value.replace(gN,"\\$&"),we+=40;else if(ae.type===1){const{value:He,repeatable:$e,optional:Ne,regexp:wt}=ae;b.push({name:He,repeatable:$e,optional:Ne});const mt=wt||bS;if(mt!==bS){we+=10;try{new RegExp(`(${mt})`)}catch(zt){throw new Error(`Invalid custom RegExp for param "${He}" (${mt}): `+zt.message)}}let vt=$e?`((?:${mt})(?:/(?:${mt}))*)`:`(${mt})`;Q||(vt=Ne&&$.length<2?`(?:/${vt})`:"/"+vt),Ne&&(vt+="?"),g+=vt,we+=20,Ne&&(we+=-8),$e&&(we+=-20),mt===".*"&&(we+=-50)}W.push(we)}u.push(W)}if(i.strict&&i.end){const $=u.length-1;u[$][u[$].length-1]+=.7000000000000001}i.strict||(g+="/?"),i.end?g+="$":i.strict&&(g+="(?:/|$)");const I=new RegExp(g,i.sensitive?"":"i");function L($){const W=$.match(I),Q={};if(!W)return null;for(let ae=1;ae<W.length;ae++){const we=W[ae]||"",He=b[ae-1];Q[He.name]=we&&He.repeatable?we.split("/"):we}return Q}function s($){let W="",Q=!1;for(const ae of n){(!Q||!W.endsWith("/"))&&(W+="/"),Q=!1;for(const we of ae)if(we.type===0)W+=we.value;else if(we.type===1){const{value:He,repeatable:$e,optional:Ne}=we,wt=He in $?$[He]:"";if(Cl(wt)&&!$e)throw new Error(`Provided param "${He}" is an array but it is not repeatable (* or + modifiers)`);const mt=Cl(wt)?wt.join("/"):wt;if(!mt)if(Ne)ae.length<2&&(W.endsWith("/")?W=W.slice(0,-1):Q=!0);else throw new Error(`Missing required param "${He}"`);W+=mt}}return W||"/"}return{re:I,score:u,keys:b,parse:L,stringify:s}}function yN(n,e){let i=0;for(;i<n.length&&i<e.length;){const u=e[i]-n[i];if(u)return u;i++}return n.length<e.length?n.length===1&&n[0]===80?-1:1:n.length>e.length?e.length===1&&e[0]===80?1:-1:0}function oP(n,e){let i=0;const u=n.score,g=e.score;for(;i<u.length&&i<g.length;){const b=yN(u[i],g[i]);if(b)return b;i++}if(Math.abs(g.length-u.length)===1){if(xS(u))return 1;if(xS(g))return-1}return g.length-u.length}function xS(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const vN={type:0,value:""},bN=/[a-zA-Z0-9_]/;function xN(n){if(!n)return[[]];if(n==="/")return[[vN]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(we){throw new Error(`ERR (${i})/"${$}": ${we}`)}let i=0,u=i;const g=[];let b;function I(){b&&g.push(b),b=[]}let L=0,s,$="",W="";function Q(){$&&(i===0?b.push({type:0,value:$}):i===1||i===2||i===3?(b.length>1&&(s==="*"||s==="+")&&e(`A repeatable param (${$}) must be alone in its segment. eg: '/:ids+.`),b.push({type:1,value:$,regexp:W,repeatable:s==="*"||s==="+",optional:s==="*"||s==="?"})):e("Invalid state to consume buffer"),$="")}function ae(){$+=s}for(;L<n.length;){if(s=n[L++],s==="\\"&&i!==2){u=i,i=4;continue}switch(i){case 0:s==="/"?($&&Q(),I()):s===":"?(Q(),i=1):ae();break;case 4:ae(),i=u;break;case 1:s==="("?i=2:bN.test(s)?ae():(Q(),i=0,s!=="*"&&s!=="?"&&s!=="+"&&L--);break;case 2:s===")"?W[W.length-1]=="\\"?W=W.slice(0,-1)+s:i=3:W+=s;break;case 3:Q(),i=0,s!=="*"&&s!=="?"&&s!=="+"&&L--,W="";break;default:e("Unknown state");break}}return i===2&&e(`Unfinished custom RegExp for param "${$}"`),Q(),I(),g}function wN(n,e,i){const u=_N(xN(n.path),i),g=bi(u,{record:n,parent:e,children:[],alias:[]});return e&&!g.record.aliasOf==!e.record.aliasOf&&e.children.push(g),g}function TN(n,e){const i=[],u=new Map;e=ES({strict:!1,end:!0,sensitive:!1},e);function g(Q){return u.get(Q)}function b(Q,ae,we){const He=!we,$e=EN(Q);$e.aliasOf=we&&we.record;const Ne=ES(e,Q),wt=[$e];if("alias"in Q){const zt=typeof Q.alias=="string"?[Q.alias]:Q.alias;for(const Ct of zt)wt.push(bi({},$e,{components:we?we.record.components:$e.components,path:Ct,aliasOf:we?we.record:$e}))}let mt,vt;for(const zt of wt){const{path:Ct}=zt;if(ae&&Ct[0]!=="/"){const qt=ae.record.path,qe=qt[qt.length-1]==="/"?"":"/";zt.path=ae.record.path+(Ct&&qe+Ct)}if(mt=wN(zt,ae,Ne),we?we.alias.push(mt):(vt=vt||mt,vt!==mt&&vt.alias.push(mt),He&&Q.name&&!TS(mt)&&I(Q.name)),sP(mt)&&s(mt),$e.children){const qt=$e.children;for(let qe=0;qe<qt.length;qe++)b(qt[qe],mt,we&&we.children[qe])}we=we||mt}return vt?()=>{I(vt)}:Zm}function I(Q){if(nP(Q)){const ae=u.get(Q);ae&&(u.delete(Q),i.splice(i.indexOf(ae),1),ae.children.forEach(I),ae.alias.forEach(I))}else{const ae=i.indexOf(Q);ae>-1&&(i.splice(ae,1),Q.record.name&&u.delete(Q.record.name),Q.children.forEach(I),Q.alias.forEach(I))}}function L(){return i}function s(Q){const ae=SN(Q,i);i.splice(ae,0,Q),Q.record.name&&!TS(Q)&&u.set(Q.record.name,Q)}function $(Q,ae){let we,He={},$e,Ne;if("name"in Q&&Q.name){if(we=u.get(Q.name),!we)throw Nf(1,{location:Q});Ne=we.record.name,He=bi(wS(ae.params,we.keys.filter(vt=>!vt.optional).concat(we.parent?we.parent.keys.filter(vt=>vt.optional):[]).map(vt=>vt.name)),Q.params&&wS(Q.params,we.keys.map(vt=>vt.name))),$e=we.stringify(He)}else if(Q.path!=null)$e=Q.path,we=i.find(vt=>vt.re.test($e)),we&&(He=we.parse($e),Ne=we.record.name);else{if(we=ae.name?u.get(ae.name):i.find(vt=>vt.re.test(ae.path)),!we)throw Nf(1,{location:Q,currentLocation:ae});Ne=we.record.name,He=bi({},ae.params,Q.params),$e=we.stringify(He)}const wt=[];let mt=we;for(;mt;)wt.unshift(mt.record),mt=mt.parent;return{name:Ne,path:$e,params:He,matched:wt,meta:AN(wt)}}n.forEach(Q=>b(Q));function W(){i.length=0,u.clear()}return{addRoute:b,resolve:$,removeRoute:I,clearRoutes:W,getRoutes:L,getRecordMatcher:g}}function wS(n,e){const i={};for(const u of e)u in n&&(i[u]=n[u]);return i}function EN(n){return{path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:void 0,beforeEnter:n.beforeEnter,props:IN(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}}}function IN(n){const e={},i=n.props||!1;if("component"in n)e.default=i;else for(const u in n.components)e[u]=typeof i=="object"?i[u]:i;return e}function TS(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function AN(n){return n.reduce((e,i)=>bi(e,i.meta),{})}function ES(n,e){const i={};for(const u in n)i[u]=u in e?e[u]:n[u];return i}function SN(n,e){let i=0,u=e.length;for(;i!==u;){const b=i+u>>1;oP(n,e[b])<0?u=b:i=b+1}const g=CN(n);return g&&(u=e.lastIndexOf(g,u-1)),u}function CN(n){let e=n;for(;e=e.parent;)if(sP(e)&&oP(n,e)===0)return e}function sP({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function RN(n){const e={};if(n===""||n==="?")return e;const u=(n[0]==="?"?n.slice(1):n).split("&");for(let g=0;g<u.length;++g){const b=u[g].replace(Yk," "),I=b.indexOf("="),L=lg(I<0?b:b.slice(0,I)),s=I<0?null:lg(b.slice(I+1));if(L in e){let $=e[L];Cl($)||($=e[L]=[$]),$.push(s)}else e[L]=s}return e}function IS(n){let e="";for(let i in n){const u=n[i];if(i=ZF(i),u==null){u!==void 0&&(e+=(e.length?"&":"")+i);continue}(Cl(u)?u.map(b=>b&&Gx(b)):[u&&Gx(u)]).forEach(b=>{b!==void 0&&(e+=(e.length?"&":"")+i,b!=null&&(e+="="+b))})}return e}function kN(n){const e={};for(const i in n){const u=n[i];u!==void 0&&(e[i]=Cl(u)?u.map(g=>g==null?null:""+g):u==null?u:""+u)}return e}const PN=Symbol(""),AS=Symbol(""),Z0=Symbol(""),aP=Symbol(""),Wx=Symbol("");function Cm(){let n=[];function e(u){return n.push(u),()=>{const g=n.indexOf(u);g>-1&&n.splice(g,1)}}function i(){n=[]}return{add:e,list:()=>n.slice(),reset:i}}function Bu(n,e,i,u,g,b=I=>I()){const I=u&&(u.enterCallbacks[g]=u.enterCallbacks[g]||[]);return()=>new Promise((L,s)=>{const $=ae=>{ae===!1?s(Nf(4,{from:i,to:e})):ae instanceof Error?s(ae):pN(ae)?s(Nf(2,{from:e,to:ae})):(I&&u.enterCallbacks[g]===I&&typeof ae=="function"&&I.push(ae),L())},W=b(()=>n.call(u&&u.instances[g],e,i,$));let Q=Promise.resolve(W);n.length<3&&(Q=Q.then($)),Q.catch(ae=>s(ae))})}function ux(n,e,i,u,g=b=>b()){const b=[];for(const I of n)for(const L in I.components){let s=I.components[L];if(!(e!=="beforeRouteEnter"&&!I.instances[L]))if(MN(s)){const W=(s.__vccOpts||s)[e];W&&b.push(Bu(W,i,u,I,L,g))}else{let $=s();b.push(()=>$.then(W=>{if(!W)return Promise.reject(new Error(`Couldn't resolve component "${L}" at "${I.path}"`));const Q=zF(W)?W.default:W;I.components[L]=Q;const we=(Q.__vccOpts||Q)[e];return we&&Bu(we,i,u,I,L,g)()}))}}return b}function MN(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function SS(n){const e=ic(Z0),i=ic(aP),u=El(()=>{const s=Nn(n.to);return e.resolve(s)}),g=El(()=>{const{matched:s}=u.value,{length:$}=s,W=s[$-1],Q=i.matched;if(!W||!Q.length)return-1;const ae=Q.findIndex(Ff.bind(null,W));if(ae>-1)return ae;const we=CS(s[$-2]);return $>1&&CS(W)===we&&Q[Q.length-1].path!==we?Q.findIndex(Ff.bind(null,s[$-2])):ae}),b=El(()=>g.value>-1&&BN(i.params,u.value.params)),I=El(()=>g.value>-1&&g.value===i.matched.length-1&&tP(i.params,u.value.params));function L(s={}){return ON(s)?e[Nn(n.replace)?"replace":"push"](Nn(n.to)).catch(Zm):Promise.resolve()}return{route:u,href:El(()=>u.value.href),isActive:b,isExactActive:I,navigate:L}}const DN=xk({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:SS,setup(n,{slots:e}){const i=Rg(SS(n)),{options:u}=ic(Z0),g=El(()=>({[RS(n.activeClass,u.linkActiveClass,"router-link-active")]:i.isActive,[RS(n.exactActiveClass,u.linkExactActiveClass,"router-link-exact-active")]:i.isExactActive}));return()=>{const b=e.default&&e.default(i);return n.custom?b:Wk("a",{"aria-current":i.isExactActive?n.ariaCurrentValue:null,href:i.href,onClick:i.navigate,class:g.value},b)}}}),LN=DN;function ON(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function BN(n,e){for(const i in e){const u=e[i],g=n[i];if(typeof u=="string"){if(u!==g)return!1}else if(!Cl(g)||g.length!==u.length||u.some((b,I)=>b!==g[I]))return!1}return!0}function CS(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const RS=(n,e,i)=>n??e??i,zN=xk({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:i}){const u=ic(Wx),g=El(()=>n.route||u.value),b=ic(AS,0),I=El(()=>{let $=Nn(b);const{matched:W}=g.value;let Q;for(;(Q=W[$])&&!Q.components;)$++;return $}),L=El(()=>g.value.matched[I.value]);Ly(AS,El(()=>I.value+1)),Ly(PN,L),Ly(Wx,g);const s=Fc();return Mc(()=>[s.value,L.value,n.name],([$,W,Q],[ae,we,He])=>{W&&(W.instances[Q]=$,we&&we!==W&&$&&$===ae&&(W.leaveGuards.size||(W.leaveGuards=we.leaveGuards),W.updateGuards.size||(W.updateGuards=we.updateGuards))),$&&W&&(!we||!Ff(W,we)||!ae)&&(W.enterCallbacks[Q]||[]).forEach($e=>$e($))},{flush:"post"}),()=>{const $=g.value,W=n.name,Q=L.value,ae=Q&&Q.components[W];if(!ae)return kS(i.default,{Component:ae,route:$});const we=Q.props[W],He=we?we===!0?$.params:typeof we=="function"?we($):we:null,Ne=Wk(ae,bi({},He,e,{onVnodeUnmounted:wt=>{wt.component.isUnmounted&&(Q.instances[W]=null)},ref:s}));return kS(i.default,{Component:Ne,route:$})||Ne}}});function kS(n,e){if(!n)return null;const i=n(e);return i.length===1?i[0]:i}const FN=zN;function NN(n){const e=TN(n.routes,n),i=n.parseQuery||RN,u=n.stringifyQuery||IS,g=n.history,b=Cm(),I=Cm(),L=Cm(),s=f4(Pu);let $=Pu;gf&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const W=lx.bind(null,It=>""+It),Q=lx.bind(null,KF),ae=lx.bind(null,lg);function we(It,lr){let sr,wr;return nP(It)?(sr=e.getRecordMatcher(It),wr=lr):wr=It,e.addRoute(wr,sr)}function He(It){const lr=e.getRecordMatcher(It);lr&&e.removeRoute(lr)}function $e(){return e.getRoutes().map(It=>It.record)}function Ne(It){return!!e.getRecordMatcher(It)}function wt(It,lr){if(lr=bi({},lr||s.value),typeof It=="string"){const Ye=cx(i,It,lr.path),De=e.resolve({path:Ye.path},lr),jt=g.createHref(Ye.fullPath);return bi(Ye,De,{params:ae(De.params),hash:lg(Ye.hash),redirectedFrom:void 0,href:jt})}let sr;if(It.path!=null)sr=bi({},It,{path:cx(i,It.path,lr.path).path});else{const Ye=bi({},It.params);for(const De in Ye)Ye[De]==null&&delete Ye[De];sr=bi({},It,{params:Q(Ye)}),lr.params=Q(lr.params)}const wr=e.resolve(sr,lr),_e=It.hash||"";wr.params=W(ae(wr.params));const un=QF(u,bi({},It,{hash:WF(_e),path:wr.path})),Le=g.createHref(un);return bi({fullPath:un,hash:_e,query:u===IS?kN(It.query):It.query||{}},wr,{redirectedFrom:void 0,href:Le})}function mt(It){return typeof It=="string"?cx(i,It,s.value.path):bi({},It)}function vt(It,lr){if($!==It)return Nf(8,{from:lr,to:It})}function zt(It){return qe(It)}function Ct(It){return zt(bi(mt(It),{replace:!0}))}function qt(It){const lr=It.matched[It.matched.length-1];if(lr&&lr.redirect){const{redirect:sr}=lr;let wr=typeof sr=="function"?sr(It):sr;return typeof wr=="string"&&(wr=wr.includes("?")||wr.includes("#")?wr=mt(wr):{path:wr},wr.params={}),bi({query:It.query,hash:It.hash,params:wr.path!=null?{}:It.params},wr)}}function qe(It,lr){const sr=$=wt(It),wr=s.value,_e=It.state,un=It.force,Le=It.replace===!0,Ye=qt(sr);if(Ye)return qe(bi(mt(Ye),{state:typeof Ye=="object"?bi({},_e,Ye.state):_e,force:un,replace:Le}),lr||sr);const De=sr;De.redirectedFrom=lr;let jt;return!un&&eN(u,wr,sr)&&(jt=Nf(16,{to:De,from:wr}),Zn(wr,wr,!0,!1)),(jt?Promise.resolve(jt):Je(De,wr)).catch(St=>Rc(St)?Rc(St,2)?St:dr(St):Vr(St,De,wr)).then(St=>{if(St){if(Rc(St,2))return qe(bi({replace:Le},mt(St.to),{state:typeof St.to=="object"?bi({},_e,St.to.state):_e,force:un}),lr||De)}else St=je(De,wr,!0,Le,_e);return Me(De,wr,St),St})}function be(It,lr){const sr=vt(It,lr);return sr?Promise.reject(sr):Promise.resolve()}function Fe(It){const lr=fr.values().next().value;return lr&&typeof lr.runWithContext=="function"?lr.runWithContext(It):It()}function Je(It,lr){let sr;const[wr,_e,un]=VN(It,lr);sr=ux(wr.reverse(),"beforeRouteLeave",It,lr);for(const Ye of wr)Ye.leaveGuards.forEach(De=>{sr.push(Bu(De,It,lr))});const Le=be.bind(null,It,lr);return sr.push(Le),Dn(sr).then(()=>{sr=[];for(const Ye of b.list())sr.push(Bu(Ye,It,lr));return sr.push(Le),Dn(sr)}).then(()=>{sr=ux(_e,"beforeRouteUpdate",It,lr);for(const Ye of _e)Ye.updateGuards.forEach(De=>{sr.push(Bu(De,It,lr))});return sr.push(Le),Dn(sr)}).then(()=>{sr=[];for(const Ye of un)if(Ye.beforeEnter)if(Cl(Ye.beforeEnter))for(const De of Ye.beforeEnter)sr.push(Bu(De,It,lr));else sr.push(Bu(Ye.beforeEnter,It,lr));return sr.push(Le),Dn(sr)}).then(()=>(It.matched.forEach(Ye=>Ye.enterCallbacks={}),sr=ux(un,"beforeRouteEnter",It,lr,Fe),sr.push(Le),Dn(sr))).then(()=>{sr=[];for(const Ye of I.list())sr.push(Bu(Ye,It,lr));return sr.push(Le),Dn(sr)}).catch(Ye=>Rc(Ye,8)?Ye:Promise.reject(Ye))}function Me(It,lr,sr){L.list().forEach(wr=>Fe(()=>wr(It,lr,sr)))}function je(It,lr,sr,wr,_e){const un=vt(It,lr);if(un)return un;const Le=lr===Pu,Ye=gf?history.state:{};sr&&(wr||Le?g.replace(It.fullPath,bi({scroll:Le&&Ye&&Ye.scroll},_e)):g.push(It.fullPath,_e)),s.value=It,Zn(It,lr,sr,Le),dr()}let Ve;function An(){Ve||(Ve=g.listen((It,lr,sr)=>{if(!li.listening)return;const wr=wt(It),_e=qt(wr);if(_e){qe(bi(_e,{replace:!0}),wr).catch(Zm);return}$=wr;const un=s.value;gf&&lN(_S(un.fullPath,sr.delta),W0()),Je(wr,un).catch(Le=>Rc(Le,12)?Le:Rc(Le,2)?(qe(Le.to,wr).then(Ye=>{Rc(Ye,20)&&!sr.delta&&sr.type===cg.pop&&g.go(-1,!1)}).catch(Zm),Promise.reject()):(sr.delta&&g.go(-sr.delta,!1),Vr(Le,wr,un))).then(Le=>{Le=Le||je(wr,un,!1),Le&&(sr.delta&&!Rc(Le,8)?g.go(-sr.delta,!1):sr.type===cg.pop&&Rc(Le,20)&&g.go(-1,!1)),Me(wr,un,Le)}).catch(Zm)}))}let jn=Cm(),or=Cm(),Cr;function Vr(It,lr,sr){dr(It);const wr=or.list();return wr.length?wr.forEach(_e=>_e(It,lr,sr)):console.error(It),Promise.reject(It)}function On(){return Cr&&s.value!==Pu?Promise.resolve():new Promise((It,lr)=>{jn.add([It,lr])})}function dr(It){return Cr||(Cr=!It,An(),jn.list().forEach(([lr,sr])=>It?sr(It):lr()),jn.reset()),It}function Zn(It,lr,sr,wr){const{scrollBehavior:_e}=n;if(!gf||!_e)return Promise.resolve();const un=!sr&&cN(_S(It.fullPath,0))||(wr||!sr)&&history.state&&history.state.scroll||null;return O0().then(()=>_e(It,lr,un)).then(Le=>Le&&aN(Le)).catch(Le=>Vr(Le,It,lr))}const yn=It=>g.go(It);let kt;const fr=new Set,li={currentRoute:s,listening:!0,addRoute:we,removeRoute:He,clearRoutes:e.clearRoutes,hasRoute:Ne,getRoutes:$e,resolve:wt,options:n,push:zt,replace:Ct,go:yn,back:()=>yn(-1),forward:()=>yn(1),beforeEach:b.add,beforeResolve:I.add,afterEach:L.add,onError:or.add,isReady:On,install(It){const lr=this;It.component("RouterLink",LN),It.component("RouterView",FN),It.config.globalProperties.$router=lr,Object.defineProperty(It.config.globalProperties,"$route",{enumerable:!0,get:()=>Nn(s)}),gf&&!kt&&s.value===Pu&&(kt=!0,zt(g.location).catch(_e=>{}));const sr={};for(const _e in Pu)Object.defineProperty(sr,_e,{get:()=>s.value[_e],enumerable:!0});It.provide(Z0,lr),It.provide(aP,uk(sr)),It.provide(Wx,s);const wr=It.unmount;fr.add(It),It.unmount=function(){fr.delete(It),fr.size<1&&($=Pu,Ve&&Ve(),Ve=null,s.value=Pu,kt=!1,Cr=!1),wr()}}};function Dn(It){return It.reduce((lr,sr)=>lr.then(()=>Fe(sr)),Promise.resolve())}return li}function VN(n,e){const i=[],u=[],g=[],b=Math.max(e.matched.length,n.matched.length);for(let I=0;I<b;I++){const L=e.matched[I];L&&(n.matched.find($=>Ff($,L))?u.push(L):i.push(L));const s=n.matched[I];s&&(e.matched.find($=>Ff($,s))||g.push(s))}return[i,u,g]}function nw(){return ic(Z0)}const UN=""+new URL("../book.svg",import.meta.url).href,jN=""+new URL("../email.svg",import.meta.url).href,$N=""+new URL("../weather.svg",import.meta.url).href,qN=""+new URL("../Location.svg",import.meta.url).href,GN=""+new URL("../navigation.svg",import.meta.url).href,HN=""+new URL("../chat.svg",import.meta.url).href,WN={data(){return{books:[]}},created(){this.fetchBooks()},methods:{async fetchBooks(){}}},ZN=j0('<div class="px-4 py-2 my-2 text-center" data-v-f2aa3987><img class="d-block mx-auto mb-4" src="'+Zk+'" alt="" data-v-f2aa3987><h1 class="display-5 fw-bold" data-v-f2aa3987>Welcome to Tools  Your One-Stop Life Assistant</h1><div class="col-lg-6 mx-auto" data-v-f2aa3987><h3 data-v-f2aa3987>Simplifying and Enhancing Your Daily Life</h3><p class="lead mb-4" data-v-f2aa3987>In today&#39;s fast-paced world, we understand the need for a reliable companion to help manage your daily tasks. Tools is a multi-functional platform designed to simplify your life by providing one-stop solutions for various needs.</p><div class="d-grid gap-2 d-sm-flex justify-content-sm-center" data-v-f2aa3987><button type="button" class="btn btn-primary btn-lg px-4 gap-3" data-v-f2aa3987>Click Login to Join Tools</button><button type="button" class="btn btn-outline-secondary btn-lg px-4" data-v-f2aa3987>Click Sign Up to Learn More</button></div></div></div><div class="album py-5 bg-light" data-v-f2aa3987><div class="container" data-v-f2aa3987><div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" data-v-f2aa3987><div class="col" data-v-f2aa3987><div class="card shadow-sm" data-v-f2aa3987><img src="'+UN+'" alt="book" width="420px" height="225px" data-v-f2aa3987><div class="card-body" data-v-f2aa3987><h2 data-v-f2aa3987>Book Collection</h2><p class="card-text" data-v-f2aa3987>Our book collection feature allows you to easily manage your reading list.</p><div class="d-flex justify-content-between align-items-center" data-v-f2aa3987></div></div></div></div><div class="col" data-v-f2aa3987><div class="card shadow-sm" data-v-f2aa3987><img src="'+jN+'" alt="email" width="420px" height="225px" data-v-f2aa3987><div class="card-body" data-v-f2aa3987><h2 data-v-f2aa3987>Email Sending</h2><p class="card-text" data-v-f2aa3987>Send emails quickly and securely, keeping you connected with ease.</p><div class="d-flex justify-content-between align-items-center" data-v-f2aa3987></div></div></div></div><div class="col" data-v-f2aa3987><div class="card shadow-sm" data-v-f2aa3987><img src="'+$N+'" alt="weather" width="420px" height="225px" data-v-f2aa3987><div class="card-body" data-v-f2aa3987><h2 data-v-f2aa3987>Weather Forecast</h2><p class="card-text" data-v-f2aa3987>We provide accurate local weather forecasts to ensure you are always in the know.</p><div class="d-flex justify-content-between align-items-center" data-v-f2aa3987></div></div></div></div><div class="col" data-v-f2aa3987><div class="card shadow-sm" data-v-f2aa3987><img src="'+qN+'" alt="Location" width="420px" height="225px" data-v-f2aa3987><div class="card-body" data-v-f2aa3987><h2 data-v-f2aa3987>Search Places</h2><p class="card-text" data-v-f2aa3987>You can easily search for specific locations using a dynamic search bar powered by geolocation data.</p><div class="d-flex justify-content-between align-items-center" data-v-f2aa3987></div></div></div></div><div class="col" data-v-f2aa3987><div class="card shadow-sm" data-v-f2aa3987><img src="'+GN+'" alt="navigation" width="420px" height="225px" data-v-f2aa3987><div class="card-body" data-v-f2aa3987><h2 data-v-f2aa3987>Navigation</h2><p class="card-text" data-v-f2aa3987>You can get turn-by-turn directions from one location to another with for various travel modes.</p><div class="d-flex justify-content-between align-items-center" data-v-f2aa3987></div></div></div></div><div class="col" data-v-f2aa3987><div class="card shadow-sm" data-v-f2aa3987><img src="'+HN+'" alt="" width="420px" height="225px" data-v-f2aa3987><div class="card-body" data-v-f2aa3987><h2 data-v-f2aa3987>GenAI Chat</h2><p class="card-text" data-v-f2aa3987>You can ask questions or get help navigating the site with real-time, AI-driven responses.</p><div class="d-flex justify-content-between align-items-center" data-v-f2aa3987></div></div></div></div></div></div></div>',2);function XN(n,e,i,u,g,b){return ZN}const KN=zs(WN,[["render",XN],["__scopeId","data-v-f2aa3987"]]);var PS={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lP=function(n){const e=[];let i=0;for(let u=0;u<n.length;u++){let g=n.charCodeAt(u);g<128?e[i++]=g:g<2048?(e[i++]=g>>6|192,e[i++]=g&63|128):(g&64512)===55296&&u+1<n.length&&(n.charCodeAt(u+1)&64512)===56320?(g=65536+((g&1023)<<10)+(n.charCodeAt(++u)&1023),e[i++]=g>>18|240,e[i++]=g>>12&63|128,e[i++]=g>>6&63|128,e[i++]=g&63|128):(e[i++]=g>>12|224,e[i++]=g>>6&63|128,e[i++]=g&63|128)}return e},YN=function(n){const e=[];let i=0,u=0;for(;i<n.length;){const g=n[i++];if(g<128)e[u++]=String.fromCharCode(g);else if(g>191&&g<224){const b=n[i++];e[u++]=String.fromCharCode((g&31)<<6|b&63)}else if(g>239&&g<365){const b=n[i++],I=n[i++],L=n[i++],s=((g&7)<<18|(b&63)<<12|(I&63)<<6|L&63)-65536;e[u++]=String.fromCharCode(55296+(s>>10)),e[u++]=String.fromCharCode(56320+(s&1023))}else{const b=n[i++],I=n[i++];e[u++]=String.fromCharCode((g&15)<<12|(b&63)<<6|I&63)}}return e.join("")},cP={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,u=[];for(let g=0;g<n.length;g+=3){const b=n[g],I=g+1<n.length,L=I?n[g+1]:0,s=g+2<n.length,$=s?n[g+2]:0,W=b>>2,Q=(b&3)<<4|L>>4;let ae=(L&15)<<2|$>>6,we=$&63;s||(we=64,I||(ae=64)),u.push(i[W],i[Q],i[ae],i[we])}return u.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(lP(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):YN(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,u=[];for(let g=0;g<n.length;){const b=i[n.charAt(g++)],L=g<n.length?i[n.charAt(g)]:0;++g;const $=g<n.length?i[n.charAt(g)]:64;++g;const Q=g<n.length?i[n.charAt(g)]:64;if(++g,b==null||L==null||$==null||Q==null)throw new JN;const ae=b<<2|L>>4;if(u.push(ae),$!==64){const we=L<<4&240|$>>2;if(u.push(we),Q!==64){const He=$<<6&192|Q;u.push(He)}}}return u},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class JN extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const QN=function(n){const e=lP(n);return cP.encodeByteArray(e,!0)},o0=function(n){return QN(n).replace(/\./g,"")},uP=function(n){try{return cP.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eV(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tV=()=>eV().__FIREBASE_DEFAULTS__,rV=()=>{if(typeof process>"u"||typeof PS>"u")return;const n=PS.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},nV=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&uP(n[1]);return e&&JSON.parse(e)},X0=()=>{try{return tV()||rV()||nV()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},hP=n=>{var e,i;return(i=(e=X0())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},iV=n=>{const e=hP(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const u=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),u]:[e.substring(0,i),u]},dP=()=>{var n;return(n=X0())===null||n===void 0?void 0:n.config},fP=n=>{var e;return(e=X0())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oV{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,u)=>{i?this.reject(i):this.resolve(u),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,u))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sV(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},u=e||"demo-project",g=n.iat||0,b=n.sub||n.user_id;if(!b)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const I=Object.assign({iss:`https://securetoken.google.com/${u}`,aud:u,iat:g,exp:g+3600,auth_time:g,sub:b,user_id:b,firebase:{sign_in_provider:"custom",identities:{}}},n);return[o0(JSON.stringify(i)),o0(JSON.stringify(I)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ss(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function aV(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ss())}function lV(){var n;const e=(n=X0())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function cV(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function uV(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function hV(){const n=Ss();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function dV(){return!lV()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function fV(){try{return typeof indexedDB=="object"}catch{return!1}}function pV(){return new Promise((n,e)=>{try{let i=!0;const u="validate-browser-context-for-indexeddb-analytics-module",g=self.indexedDB.open(u);g.onsuccess=()=>{g.result.close(),i||self.indexedDB.deleteDatabase(u),n(!0)},g.onupgradeneeded=()=>{i=!1},g.onerror=()=>{var b;e(((b=g.error)===null||b===void 0?void 0:b.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mV="FirebaseError";class Zc extends Error{constructor(e,i,u){super(i),this.code=e,this.customData=u,this.name=mV,Object.setPrototypeOf(this,Zc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Pg.prototype.create)}}class Pg{constructor(e,i,u){this.service=e,this.serviceName=i,this.errors=u}create(e,...i){const u=i[0]||{},g=`${this.service}/${e}`,b=this.errors[e],I=b?gV(b,u):"Error",L=`${this.serviceName}: ${I} (${g}).`;return new Zc(g,L,u)}}function gV(n,e){return n.replace(_V,(i,u)=>{const g=e[u];return g!=null?String(g):`<${u}?>`})}const _V=/\{\$([^}]+)}/g;function yV(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function s0(n,e){if(n===e)return!0;const i=Object.keys(n),u=Object.keys(e);for(const g of i){if(!u.includes(g))return!1;const b=n[g],I=e[g];if(MS(b)&&MS(I)){if(!s0(b,I))return!1}else if(b!==I)return!1}for(const g of u)if(!i.includes(g))return!1;return!0}function MS(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mg(n){const e=[];for(const[i,u]of Object.entries(n))Array.isArray(u)?u.forEach(g=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(g))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(u));return e.length?"&"+e.join("&"):""}function Om(n){const e={};return n.replace(/^\?/,"").split("&").forEach(u=>{if(u){const[g,b]=u.split("=");e[decodeURIComponent(g)]=decodeURIComponent(b)}}),e}function Bm(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function vV(n,e){const i=new bV(n,e);return i.subscribe.bind(i)}class bV{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(u=>{this.error(u)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,u){let g;if(e===void 0&&i===void 0&&u===void 0)throw new Error("Missing Observer.");xV(e,["next","error","complete"])?g=e:g={next:e,error:i,complete:u},g.next===void 0&&(g.next=hx),g.error===void 0&&(g.error=hx),g.complete===void 0&&(g.complete=hx);const b=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?g.error(this.finalError):g.complete()}catch{}}),this.observers.push(g),b}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(u){typeof console<"u"&&console.error&&console.error(u)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function xV(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function hx(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ss(n){return n&&n._delegate?n._delegate:n}class od{constructor(e,i,u){this.name=e,this.instanceFactory=i,this.type=u,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gh="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wV{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const u=new oV;if(this.instancesDeferred.set(i,u),this.isInitialized(i)||this.shouldAutoInitialize())try{const g=this.getOrInitializeService({instanceIdentifier:i});g&&u.resolve(g)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const u=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),g=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(u)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:u})}catch(b){if(g)return null;throw b}else{if(g)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(EV(e))try{this.getOrInitializeService({instanceIdentifier:Gh})}catch{}for(const[i,u]of this.instancesDeferred.entries()){const g=this.normalizeInstanceIdentifier(i);try{const b=this.getOrInitializeService({instanceIdentifier:g});u.resolve(b)}catch{}}}}clearInstance(e=Gh){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Gh){return this.instances.has(e)}getOptions(e=Gh){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,u=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(u))throw Error(`${this.name}(${u}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const g=this.getOrInitializeService({instanceIdentifier:u,options:i});for(const[b,I]of this.instancesDeferred.entries()){const L=this.normalizeInstanceIdentifier(b);u===L&&I.resolve(g)}return g}onInit(e,i){var u;const g=this.normalizeInstanceIdentifier(i),b=(u=this.onInitCallbacks.get(g))!==null&&u!==void 0?u:new Set;b.add(e),this.onInitCallbacks.set(g,b);const I=this.instances.get(g);return I&&e(I,g),()=>{b.delete(e)}}invokeOnInitCallbacks(e,i){const u=this.onInitCallbacks.get(i);if(u)for(const g of u)try{g(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let u=this.instances.get(e);if(!u&&this.component&&(u=this.component.instanceFactory(this.container,{instanceIdentifier:TV(e),options:i}),this.instances.set(e,u),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(u,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,u)}catch{}return u||null}normalizeInstanceIdentifier(e=Gh){return this.component?this.component.multipleInstances?e:Gh:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function TV(n){return n===Gh?void 0:n}function EV(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IV{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new wV(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wn;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Wn||(Wn={}));const AV={debug:Wn.DEBUG,verbose:Wn.VERBOSE,info:Wn.INFO,warn:Wn.WARN,error:Wn.ERROR,silent:Wn.SILENT},SV=Wn.INFO,CV={[Wn.DEBUG]:"log",[Wn.VERBOSE]:"log",[Wn.INFO]:"info",[Wn.WARN]:"warn",[Wn.ERROR]:"error"},RV=(n,e,...i)=>{if(e<n.logLevel)return;const u=new Date().toISOString(),g=CV[e];if(g)console[g](`[${u}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class iw{constructor(e){this.name=e,this._logLevel=SV,this._logHandler=RV,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Wn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?AV[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Wn.DEBUG,...e),this._logHandler(this,Wn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Wn.VERBOSE,...e),this._logHandler(this,Wn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Wn.INFO,...e),this._logHandler(this,Wn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Wn.WARN,...e),this._logHandler(this,Wn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Wn.ERROR,...e),this._logHandler(this,Wn.ERROR,...e)}}const kV=(n,e)=>e.some(i=>n instanceof i);let DS,LS;function PV(){return DS||(DS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function MV(){return LS||(LS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pP=new WeakMap,Zx=new WeakMap,mP=new WeakMap,dx=new WeakMap,ow=new WeakMap;function DV(n){const e=new Promise((i,u)=>{const g=()=>{n.removeEventListener("success",b),n.removeEventListener("error",I)},b=()=>{i(Wu(n.result)),g()},I=()=>{u(n.error),g()};n.addEventListener("success",b),n.addEventListener("error",I)});return e.then(i=>{i instanceof IDBCursor&&pP.set(i,n)}).catch(()=>{}),ow.set(e,n),e}function LV(n){if(Zx.has(n))return;const e=new Promise((i,u)=>{const g=()=>{n.removeEventListener("complete",b),n.removeEventListener("error",I),n.removeEventListener("abort",I)},b=()=>{i(),g()},I=()=>{u(n.error||new DOMException("AbortError","AbortError")),g()};n.addEventListener("complete",b),n.addEventListener("error",I),n.addEventListener("abort",I)});Zx.set(n,e)}let Xx={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return Zx.get(n);if(e==="objectStoreNames")return n.objectStoreNames||mP.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Wu(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function OV(n){Xx=n(Xx)}function BV(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const u=n.call(fx(this),e,...i);return mP.set(u,e.sort?e.sort():[e]),Wu(u)}:MV().includes(n)?function(...e){return n.apply(fx(this),e),Wu(pP.get(this))}:function(...e){return Wu(n.apply(fx(this),e))}}function zV(n){return typeof n=="function"?BV(n):(n instanceof IDBTransaction&&LV(n),kV(n,PV())?new Proxy(n,Xx):n)}function Wu(n){if(n instanceof IDBRequest)return DV(n);if(dx.has(n))return dx.get(n);const e=zV(n);return e!==n&&(dx.set(n,e),ow.set(e,n)),e}const fx=n=>ow.get(n);function FV(n,e,{blocked:i,upgrade:u,blocking:g,terminated:b}={}){const I=indexedDB.open(n,e),L=Wu(I);return u&&I.addEventListener("upgradeneeded",s=>{u(Wu(I.result),s.oldVersion,s.newVersion,Wu(I.transaction),s)}),i&&I.addEventListener("blocked",s=>i(s.oldVersion,s.newVersion,s)),L.then(s=>{b&&s.addEventListener("close",()=>b()),g&&s.addEventListener("versionchange",$=>g($.oldVersion,$.newVersion,$))}).catch(()=>{}),L}const NV=["get","getKey","getAll","getAllKeys","count"],VV=["put","add","delete","clear"],px=new Map;function OS(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(px.get(e))return px.get(e);const i=e.replace(/FromIndex$/,""),u=e!==i,g=VV.includes(i);if(!(i in(u?IDBIndex:IDBObjectStore).prototype)||!(g||NV.includes(i)))return;const b=async function(I,...L){const s=this.transaction(I,g?"readwrite":"readonly");let $=s.store;return u&&($=$.index(L.shift())),(await Promise.all([$[i](...L),g&&s.done]))[0]};return px.set(e,b),b}OV(n=>({...n,get:(e,i,u)=>OS(e,i)||n.get(e,i,u),has:(e,i)=>!!OS(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UV{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(jV(i)){const u=i.getImmediate();return`${u.library}/${u.version}`}else return null}).filter(i=>i).join(" ")}}function jV(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Kx="@firebase/app",BS="0.10.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jc=new iw("@firebase/app"),$V="@firebase/app-compat",qV="@firebase/analytics-compat",GV="@firebase/analytics",HV="@firebase/app-check-compat",WV="@firebase/app-check",ZV="@firebase/auth",XV="@firebase/auth-compat",KV="@firebase/database",YV="@firebase/database-compat",JV="@firebase/functions",QV="@firebase/functions-compat",e6="@firebase/installations",t6="@firebase/installations-compat",r6="@firebase/messaging",n6="@firebase/messaging-compat",i6="@firebase/performance",o6="@firebase/performance-compat",s6="@firebase/remote-config",a6="@firebase/remote-config-compat",l6="@firebase/storage",c6="@firebase/storage-compat",u6="@firebase/firestore",h6="@firebase/vertexai-preview",d6="@firebase/firestore-compat",f6="firebase",p6="10.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yx="[DEFAULT]",m6={[Kx]:"fire-core",[$V]:"fire-core-compat",[GV]:"fire-analytics",[qV]:"fire-analytics-compat",[WV]:"fire-app-check",[HV]:"fire-app-check-compat",[ZV]:"fire-auth",[XV]:"fire-auth-compat",[KV]:"fire-rtdb",[YV]:"fire-rtdb-compat",[JV]:"fire-fn",[QV]:"fire-fn-compat",[e6]:"fire-iid",[t6]:"fire-iid-compat",[r6]:"fire-fcm",[n6]:"fire-fcm-compat",[i6]:"fire-perf",[o6]:"fire-perf-compat",[s6]:"fire-rc",[a6]:"fire-rc-compat",[l6]:"fire-gcs",[c6]:"fire-gcs-compat",[u6]:"fire-fst",[d6]:"fire-fst-compat",[h6]:"fire-vertex","fire-js":"fire-js",[f6]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a0=new Map,g6=new Map,Jx=new Map;function zS(n,e){try{n.container.addComponent(e)}catch(i){jc.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function Vf(n){const e=n.name;if(Jx.has(e))return jc.debug(`There were multiple attempts to register component ${e}.`),!1;Jx.set(e,n);for(const i of a0.values())zS(i,n);for(const i of g6.values())zS(i,n);return!0}function sw(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function rc(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _6={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Zu=new Pg("app","Firebase",_6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y6{constructor(e,i,u){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=u,this.container.addComponent(new od("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Zu.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kf=p6;function aw(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const u=Object.assign({name:Yx,automaticDataCollectionEnabled:!1},e),g=u.name;if(typeof g!="string"||!g)throw Zu.create("bad-app-name",{appName:String(g)});if(i||(i=dP()),!i)throw Zu.create("no-options");const b=a0.get(g);if(b){if(s0(i,b.options)&&s0(u,b.config))return b;throw Zu.create("duplicate-app",{appName:g})}const I=new IV(g);for(const s of Jx.values())I.addComponent(s);const L=new y6(i,u,I);return a0.set(g,L),L}function gP(n=Yx){const e=a0.get(n);if(!e&&n===Yx&&dP())return aw();if(!e)throw Zu.create("no-app",{appName:n});return e}function Xu(n,e,i){var u;let g=(u=m6[n])!==null&&u!==void 0?u:n;i&&(g+=`-${i}`);const b=g.match(/\s|\//),I=e.match(/\s|\//);if(b||I){const L=[`Unable to register library "${g}" with version "${e}":`];b&&L.push(`library name "${g}" contains illegal characters (whitespace or "/")`),b&&I&&L.push("and"),I&&L.push(`version name "${e}" contains illegal characters (whitespace or "/")`),jc.warn(L.join(" "));return}Vf(new od(`${g}-version`,()=>({library:g,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v6="firebase-heartbeat-database",b6=1,ug="firebase-heartbeat-store";let mx=null;function _P(){return mx||(mx=FV(v6,b6,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ug)}catch(i){console.warn(i)}}}}).catch(n=>{throw Zu.create("idb-open",{originalErrorMessage:n.message})})),mx}async function x6(n){try{const i=(await _P()).transaction(ug),u=await i.objectStore(ug).get(yP(n));return await i.done,u}catch(e){if(e instanceof Zc)jc.warn(e.message);else{const i=Zu.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});jc.warn(i.message)}}}async function FS(n,e){try{const u=(await _P()).transaction(ug,"readwrite");await u.objectStore(ug).put(e,yP(n)),await u.done}catch(i){if(i instanceof Zc)jc.warn(i.message);else{const u=Zu.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});jc.warn(u.message)}}}function yP(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w6=1024,T6=30*24*60*60*1e3;class E6{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new A6(i),this._heartbeatsCachePromise=this._storage.read().then(u=>(this._heartbeatsCache=u,u))}async triggerHeartbeat(){var e,i;try{const g=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),b=NS();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===b||this._heartbeatsCache.heartbeats.some(I=>I.date===b)?void 0:(this._heartbeatsCache.heartbeats.push({date:b,agent:g}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(I=>{const L=new Date(I.date).valueOf();return Date.now()-L<=T6}),this._storage.overwrite(this._heartbeatsCache))}catch(u){jc.warn(u)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=NS(),{heartbeatsToSend:u,unsentEntries:g}=I6(this._heartbeatsCache.heartbeats),b=o0(JSON.stringify({version:2,heartbeats:u}));return this._heartbeatsCache.lastSentHeartbeatDate=i,g.length>0?(this._heartbeatsCache.heartbeats=g,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),b}catch(i){return jc.warn(i),""}}}function NS(){return new Date().toISOString().substring(0,10)}function I6(n,e=w6){const i=[];let u=n.slice();for(const g of n){const b=i.find(I=>I.agent===g.agent);if(b){if(b.dates.push(g.date),VS(i)>e){b.dates.pop();break}}else if(i.push({agent:g.agent,dates:[g.date]}),VS(i)>e){i.pop();break}u=u.slice(1)}return{heartbeatsToSend:i,unsentEntries:u}}class A6{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return fV()?pV().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await x6(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const g=await this.read();return FS(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:g.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const g=await this.read();return FS(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:g.lastSentHeartbeatDate,heartbeats:[...g.heartbeats,...e.heartbeats]})}else return}}function VS(n){return o0(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S6(n){Vf(new od("platform-logger",e=>new UV(e),"PRIVATE")),Vf(new od("heartbeat",e=>new E6(e),"PRIVATE")),Xu(Kx,BS,n),Xu(Kx,BS,"esm2017"),Xu("fire-js","")}S6("");function lw(n,e){var i={};for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&e.indexOf(u)<0&&(i[u]=n[u]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var g=0,u=Object.getOwnPropertySymbols(n);g<u.length;g++)e.indexOf(u[g])<0&&Object.prototype.propertyIsEnumerable.call(n,u[g])&&(i[u[g]]=n[u[g]]);return i}function vP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const C6=vP,bP=new Pg("auth","Firebase",vP());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l0=new iw("@firebase/auth");function R6(n,...e){l0.logLevel<=Wn.WARN&&l0.warn(`Auth (${Kf}): ${n}`,...e)}function Fy(n,...e){l0.logLevel<=Wn.ERROR&&l0.error(`Auth (${Kf}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rl(n,...e){throw cw(n,...e)}function oc(n,...e){return cw(n,...e)}function xP(n,e,i){const u=Object.assign(Object.assign({},C6()),{[e]:i});return new Pg("auth","Firebase",u).create(e,{appName:n.name})}function Nc(n){return xP(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function cw(n,...e){if(typeof n!="string"){const i=e[0],u=[...e.slice(1)];return u[0]&&(u[0].appName=n.name),n._errorFactory.create(i,...u)}return bP.create(n,...e)}function cn(n,e,...i){if(!n)throw cw(e,...i)}function Dc(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Fy(e),new Error(e)}function $c(n,e){n||Dc(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qx(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function k6(){return US()==="http:"||US()==="https:"}function US(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P6(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(k6()||cV()||"connection"in navigator)?navigator.onLine:!0}function M6(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(e,i){this.shortDelay=e,this.longDelay=i,$c(i>e,"Short delay should be less than long delay!"),this.isMobile=aV()||uV()}get(){return P6()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uw(n,e){$c(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wP{static initialize(e,i,u){this.fetchImpl=e,i&&(this.headersImpl=i),u&&(this.responseImpl=u)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Dc("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Dc("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Dc("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D6={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L6=new Dg(3e4,6e4);function oh(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function sh(n,e,i,u,g={}){return TP(n,g,async()=>{let b={},I={};u&&(e==="GET"?I=u:b={body:JSON.stringify(u)});const L=Mg(Object.assign({key:n.config.apiKey},I)).slice(1),s=await n._getAdditionalHeaders();return s["Content-Type"]="application/json",n.languageCode&&(s["X-Firebase-Locale"]=n.languageCode),wP.fetch()(EP(n,n.config.apiHost,i,L),Object.assign({method:e,headers:s,referrerPolicy:"no-referrer"},b))})}async function TP(n,e,i){n._canInitEmulator=!1;const u=Object.assign(Object.assign({},D6),e);try{const g=new B6(n),b=await Promise.race([i(),g.promise]);g.clearNetworkTimeout();const I=await b.json();if("needConfirmation"in I)throw Ty(n,"account-exists-with-different-credential",I);if(b.ok&&!("errorMessage"in I))return I;{const L=b.ok?I.errorMessage:I.error.message,[s,$]=L.split(" : ");if(s==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ty(n,"credential-already-in-use",I);if(s==="EMAIL_EXISTS")throw Ty(n,"email-already-in-use",I);if(s==="USER_DISABLED")throw Ty(n,"user-disabled",I);const W=u[s]||s.toLowerCase().replace(/[_\s]+/g,"-");if($)throw xP(n,W,$);Rl(n,W)}}catch(g){if(g instanceof Zc)throw g;Rl(n,"network-request-failed",{message:String(g)})}}async function Lg(n,e,i,u,g={}){const b=await sh(n,e,i,u,g);return"mfaPendingCredential"in b&&Rl(n,"multi-factor-auth-required",{_serverResponse:b}),b}function EP(n,e,i,u){const g=`${e}${i}?${u}`;return n.config.emulator?uw(n.config,g):`${n.config.apiScheme}://${g}`}function O6(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class B6{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,u)=>{this.timer=setTimeout(()=>u(oc(this.auth,"network-request-failed")),L6.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ty(n,e,i){const u={appName:n.name};i.email&&(u.email=i.email),i.phoneNumber&&(u.phoneNumber=i.phoneNumber);const g=oc(n,e,u);return g.customData._tokenResponse=i,g}function jS(n){return n!==void 0&&n.enterprise!==void 0}class z6{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return O6(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function F6(n,e){return sh(n,"GET","/v2/recaptchaConfig",oh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N6(n,e){return sh(n,"POST","/v1/accounts:delete",e)}async function IP(n,e){return sh(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Km(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function V6(n,e=!1){const i=ss(n),u=await i.getIdToken(e),g=hw(u);cn(g&&g.exp&&g.auth_time&&g.iat,i.auth,"internal-error");const b=typeof g.firebase=="object"?g.firebase:void 0,I=b==null?void 0:b.sign_in_provider;return{claims:g,token:u,authTime:Km(gx(g.auth_time)),issuedAtTime:Km(gx(g.iat)),expirationTime:Km(gx(g.exp)),signInProvider:I||null,signInSecondFactor:(b==null?void 0:b.sign_in_second_factor)||null}}function gx(n){return Number(n)*1e3}function hw(n){const[e,i,u]=n.split(".");if(e===void 0||i===void 0||u===void 0)return Fy("JWT malformed, contained fewer than 3 sections"),null;try{const g=uP(i);return g?JSON.parse(g):(Fy("Failed to decode base64 JWT payload"),null)}catch(g){return Fy("Caught error parsing JWT payload as JSON",g==null?void 0:g.toString()),null}}function $S(n){const e=hw(n);return cn(e,"internal-error"),cn(typeof e.exp<"u","internal-error"),cn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hg(n,e,i=!1){if(i)return e;try{return await e}catch(u){throw u instanceof Zc&&U6(u)&&n.auth.currentUser===n&&await n.auth.signOut(),u}}function U6({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j6{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const u=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),u}else{this.errorBackoff=3e4;const g=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,g)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=Km(this.lastLoginAt),this.creationTime=Km(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c0(n){var e;const i=n.auth,u=await n.getIdToken(),g=await hg(n,IP(i,{idToken:u}));cn(g==null?void 0:g.users.length,i,"internal-error");const b=g.users[0];n._notifyReloadListener(b);const I=!((e=b.providerUserInfo)===null||e===void 0)&&e.length?AP(b.providerUserInfo):[],L=q6(n.providerData,I),s=n.isAnonymous,$=!(n.email&&b.passwordHash)&&!(L!=null&&L.length),W=s?$:!1,Q={uid:b.localId,displayName:b.displayName||null,photoURL:b.photoUrl||null,email:b.email||null,emailVerified:b.emailVerified||!1,phoneNumber:b.phoneNumber||null,tenantId:b.tenantId||null,providerData:L,metadata:new e1(b.createdAt,b.lastLoginAt),isAnonymous:W};Object.assign(n,Q)}async function $6(n){const e=ss(n);await c0(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function q6(n,e){return[...n.filter(u=>!e.some(g=>g.providerId===u.providerId)),...e]}function AP(n){return n.map(e=>{var{providerId:i}=e,u=lw(e,["providerId"]);return{providerId:i,uid:u.rawId||"",displayName:u.displayName||null,email:u.email||null,phoneNumber:u.phoneNumber||null,photoURL:u.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G6(n,e){const i=await TP(n,{},async()=>{const u=Mg({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:g,apiKey:b}=n.config,I=EP(n,g,"/v1/token",`key=${b}`),L=await n._getAdditionalHeaders();return L["Content-Type"]="application/x-www-form-urlencoded",wP.fetch()(I,{method:"POST",headers:L,body:u})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function H6(n,e){return sh(n,"POST","/v2/accounts:revokeToken",oh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){cn(e.idToken,"internal-error"),cn(typeof e.idToken<"u","internal-error"),cn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):$S(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){cn(e.length!==0,"internal-error");const i=$S(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(cn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:u,refreshToken:g,expiresIn:b}=await G6(e,i);this.updateTokensAndExpiration(u,g,Number(b))}updateTokensAndExpiration(e,i,u){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+u*1e3}static fromJSON(e,i){const{refreshToken:u,accessToken:g,expirationTime:b}=i,I=new Sf;return u&&(cn(typeof u=="string","internal-error",{appName:e}),I.refreshToken=u),g&&(cn(typeof g=="string","internal-error",{appName:e}),I.accessToken=g),b&&(cn(typeof b=="number","internal-error",{appName:e}),I.expirationTime=b),I}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Sf,this.toJSON())}_performRefresh(){return Dc("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mu(n,e){cn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Lc{constructor(e){var{uid:i,auth:u,stsTokenManager:g}=e,b=lw(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new j6(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=u,this.stsTokenManager=g,this.accessToken=g.accessToken,this.displayName=b.displayName||null,this.email=b.email||null,this.emailVerified=b.emailVerified||!1,this.phoneNumber=b.phoneNumber||null,this.photoURL=b.photoURL||null,this.isAnonymous=b.isAnonymous||!1,this.tenantId=b.tenantId||null,this.providerData=b.providerData?[...b.providerData]:[],this.metadata=new e1(b.createdAt||void 0,b.lastLoginAt||void 0)}async getIdToken(e){const i=await hg(this,this.stsTokenManager.getToken(this.auth,e));return cn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return V6(this,e)}reload(){return $6(this)}_assign(e){this!==e&&(cn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new Lc(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){cn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let u=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),u=!0),i&&await c0(this),await this.auth._persistUserIfCurrent(this),u&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(rc(this.auth.app))return Promise.reject(Nc(this.auth));const e=await this.getIdToken();return await hg(this,N6(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var u,g,b,I,L,s,$,W;const Q=(u=i.displayName)!==null&&u!==void 0?u:void 0,ae=(g=i.email)!==null&&g!==void 0?g:void 0,we=(b=i.phoneNumber)!==null&&b!==void 0?b:void 0,He=(I=i.photoURL)!==null&&I!==void 0?I:void 0,$e=(L=i.tenantId)!==null&&L!==void 0?L:void 0,Ne=(s=i._redirectEventId)!==null&&s!==void 0?s:void 0,wt=($=i.createdAt)!==null&&$!==void 0?$:void 0,mt=(W=i.lastLoginAt)!==null&&W!==void 0?W:void 0,{uid:vt,emailVerified:zt,isAnonymous:Ct,providerData:qt,stsTokenManager:qe}=i;cn(vt&&qe,e,"internal-error");const be=Sf.fromJSON(this.name,qe);cn(typeof vt=="string",e,"internal-error"),Mu(Q,e.name),Mu(ae,e.name),cn(typeof zt=="boolean",e,"internal-error"),cn(typeof Ct=="boolean",e,"internal-error"),Mu(we,e.name),Mu(He,e.name),Mu($e,e.name),Mu(Ne,e.name),Mu(wt,e.name),Mu(mt,e.name);const Fe=new Lc({uid:vt,auth:e,email:ae,emailVerified:zt,displayName:Q,isAnonymous:Ct,photoURL:He,phoneNumber:we,tenantId:$e,stsTokenManager:be,createdAt:wt,lastLoginAt:mt});return qt&&Array.isArray(qt)&&(Fe.providerData=qt.map(Je=>Object.assign({},Je))),Ne&&(Fe._redirectEventId=Ne),Fe}static async _fromIdTokenResponse(e,i,u=!1){const g=new Sf;g.updateFromServerResponse(i);const b=new Lc({uid:i.localId,auth:e,stsTokenManager:g,isAnonymous:u});return await c0(b),b}static async _fromGetAccountInfoResponse(e,i,u){const g=i.users[0];cn(g.localId!==void 0,"internal-error");const b=g.providerUserInfo!==void 0?AP(g.providerUserInfo):[],I=!(g.email&&g.passwordHash)&&!(b!=null&&b.length),L=new Sf;L.updateFromIdToken(u);const s=new Lc({uid:g.localId,auth:e,stsTokenManager:L,isAnonymous:I}),$={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:b,metadata:new e1(g.createdAt,g.lastLoginAt),isAnonymous:!(g.email&&g.passwordHash)&&!(b!=null&&b.length)};return Object.assign(s,$),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qS=new Map;function Oc(n){$c(n instanceof Function,"Expected a class definition");let e=qS.get(n);return e?($c(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,qS.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}SP.type="NONE";const GS=SP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ny(n,e,i){return`firebase:${n}:${e}:${i}`}class Cf{constructor(e,i,u){this.persistence=e,this.auth=i,this.userKey=u;const{config:g,name:b}=this.auth;this.fullUserKey=Ny(this.userKey,g.apiKey,b),this.fullPersistenceKey=Ny("persistence",g.apiKey,b),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Lc._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,u="authUser"){if(!i.length)return new Cf(Oc(GS),e,u);const g=(await Promise.all(i.map(async $=>{if(await $._isAvailable())return $}))).filter($=>$);let b=g[0]||Oc(GS);const I=Ny(u,e.config.apiKey,e.name);let L=null;for(const $ of i)try{const W=await $._get(I);if(W){const Q=Lc._fromJSON(e,W);$!==b&&(L=Q),b=$;break}}catch{}const s=g.filter($=>$._shouldAllowMigration);return!b._shouldAllowMigration||!s.length?new Cf(b,e,u):(b=s[0],L&&await b._set(I,L.toJSON()),await Promise.all(i.map(async $=>{if($!==b)try{await $._remove(I)}catch{}})),new Cf(b,e,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HS(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(PP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(CP(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(DP(e))return"Blackberry";if(LP(e))return"Webos";if(RP(e))return"Safari";if((e.includes("chrome/")||kP(e))&&!e.includes("edge/"))return"Chrome";if(MP(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,u=n.match(i);if((u==null?void 0:u.length)===2)return u[1]}return"Other"}function CP(n=Ss()){return/firefox\//i.test(n)}function RP(n=Ss()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function kP(n=Ss()){return/crios\//i.test(n)}function PP(n=Ss()){return/iemobile/i.test(n)}function MP(n=Ss()){return/android/i.test(n)}function DP(n=Ss()){return/blackberry/i.test(n)}function LP(n=Ss()){return/webos/i.test(n)}function dw(n=Ss()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function W6(n=Ss()){var e;return dw(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Z6(){return hV()&&document.documentMode===10}function OP(n=Ss()){return dw(n)||MP(n)||LP(n)||DP(n)||/windows phone/i.test(n)||PP(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BP(n,e=[]){let i;switch(n){case"Browser":i=HS(Ss());break;case"Worker":i=`${HS(Ss())}-${n}`;break;default:i=n}const u=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${Kf}/${u}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X6{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const u=b=>new Promise((I,L)=>{try{const s=e(b);I(s)}catch(s){L(s)}});u.onAbort=i,this.queue.push(u);const g=this.queue.length-1;return()=>{this.queue[g]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const u of this.queue)await u(e),u.onAbort&&i.push(u.onAbort)}catch(u){i.reverse();for(const g of i)try{g()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:u==null?void 0:u.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K6(n,e={}){return sh(n,"GET","/v2/passwordPolicy",oh(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y6=6;class J6{constructor(e){var i,u,g,b;const I=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=I.minPasswordLength)!==null&&i!==void 0?i:Y6,I.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=I.maxPasswordLength),I.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=I.containsLowercaseCharacter),I.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=I.containsUppercaseCharacter),I.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=I.containsNumericCharacter),I.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=I.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(g=(u=e.allowedNonAlphanumericCharacters)===null||u===void 0?void 0:u.join(""))!==null&&g!==void 0?g:"",this.forceUpgradeOnSignin=(b=e.forceUpgradeOnSignin)!==null&&b!==void 0?b:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,u,g,b,I,L;const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=(i=s.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),s.isValid&&(s.isValid=(u=s.meetsMaxPasswordLength)!==null&&u!==void 0?u:!0),s.isValid&&(s.isValid=(g=s.containsLowercaseLetter)!==null&&g!==void 0?g:!0),s.isValid&&(s.isValid=(b=s.containsUppercaseLetter)!==null&&b!==void 0?b:!0),s.isValid&&(s.isValid=(I=s.containsNumericCharacter)!==null&&I!==void 0?I:!0),s.isValid&&(s.isValid=(L=s.containsNonAlphanumericCharacter)!==null&&L!==void 0?L:!0),s}validatePasswordLengthOptions(e,i){const u=this.customStrengthOptions.minPasswordLength,g=this.customStrengthOptions.maxPasswordLength;u&&(i.meetsMinPasswordLength=e.length>=u),g&&(i.meetsMaxPasswordLength=e.length<=g)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let u;for(let g=0;g<e.length;g++)u=e.charAt(g),this.updatePasswordCharacterOptionsStatuses(i,u>="a"&&u<="z",u>="A"&&u<="Z",u>="0"&&u<="9",this.allowedNonAlphanumericCharacters.includes(u))}updatePasswordCharacterOptionsStatuses(e,i,u,g,b){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=u)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=g)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=b))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q6{constructor(e,i,u,g){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=u,this.config=g,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new WS(this),this.idTokenSubscription=new WS(this),this.beforeStateQueue=new X6(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=g.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Oc(i)),this._initializationPromise=this.queue(async()=>{var u,g;if(!this._deleted&&(this.persistenceManager=await Cf.create(this,e),!this._deleted)){if(!((u=this._popupRedirectResolver)===null||u===void 0)&&u._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((g=this.currentUser)===null||g===void 0?void 0:g.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await IP(this,{idToken:e}),u=await Lc._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(u)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(rc(this.app)){const I=this.app.settings.authIdToken;return I?new Promise(L=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(I).then(L,L))}):this.directlySetCurrentUser(null)}const u=await this.assertedPersistence.getCurrentUser();let g=u,b=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const I=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,L=g==null?void 0:g._redirectEventId,s=await this.tryRedirectSignIn(e);(!I||I===L)&&(s!=null&&s.user)&&(g=s.user,b=!0)}if(!g)return this.directlySetCurrentUser(null);if(!g._redirectEventId){if(b)try{await this.beforeStateQueue.runMiddleware(g)}catch(I){g=u,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(I))}return g?this.reloadAndSetCurrentUserOrClear(g):this.directlySetCurrentUser(null)}return cn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===g._redirectEventId?this.directlySetCurrentUser(g):this.reloadAndSetCurrentUserOrClear(g)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await c0(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=M6()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(rc(this.app))return Promise.reject(Nc(this));const i=e?ss(e):null;return i&&cn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&cn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return rc(this.app)?Promise.reject(Nc(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return rc(this.app)?Promise.reject(Nc(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Oc(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await K6(this),i=new J6(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Pg("auth","Firebase",e())}onAuthStateChanged(e,i,u){return this.registerStateListener(this.authStateSubscription,e,i,u)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,u){return this.registerStateListener(this.idTokenSubscription,e,i,u)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const u=this.onAuthStateChanged(()=>{u(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),u={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(u.tenantId=this.tenantId),await H6(this,u)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const u=await this.getOrInitRedirectPersistenceManager(i);return e===null?u.removeCurrentUser():u.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Oc(e)||this._popupRedirectResolver;cn(i,this,"argument-error"),this.redirectPersistenceManager=await Cf.create(this,[Oc(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,u;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((u=this.redirectUser)===null||u===void 0?void 0:u._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const u=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==u&&(this.lastNotifiedUid=u,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,u,g){if(this._deleted)return()=>{};const b=typeof i=="function"?i:i.next.bind(i);let I=!1;const L=this._isInitialized?Promise.resolve():this._initializationPromise;if(cn(L,this,"internal-error"),L.then(()=>{I||b(this.currentUser)}),typeof i=="function"){const s=e.addObserver(i,u,g);return()=>{I=!0,s()}}else{const s=e.addObserver(i);return()=>{I=!0,s()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return cn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=BP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const u=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());u&&(i["X-Firebase-Client"]=u);const g=await this._getAppCheckToken();return g&&(i["X-Firebase-AppCheck"]=g),i}async _getAppCheckToken(){var e;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&R6(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function fd(n){return ss(n)}class WS{constructor(e){this.auth=e,this.observer=null,this.addObserver=vV(i=>this.observer=i)}get next(){return cn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let K0={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function e2(n){K0=n}function zP(n){return K0.loadJS(n)}function t2(){return K0.recaptchaEnterpriseScript}function r2(){return K0.gapiScript}function n2(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const i2="recaptcha-enterprise",o2="NO_RECAPTCHA";class s2{constructor(e){this.type=i2,this.auth=fd(e)}async verify(e="verify",i=!1){async function u(b){if(!i){if(b.tenantId==null&&b._agentRecaptchaConfig!=null)return b._agentRecaptchaConfig.siteKey;if(b.tenantId!=null&&b._tenantRecaptchaConfigs[b.tenantId]!==void 0)return b._tenantRecaptchaConfigs[b.tenantId].siteKey}return new Promise(async(I,L)=>{F6(b,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(s=>{if(s.recaptchaKey===void 0)L(new Error("recaptcha Enterprise site key undefined"));else{const $=new z6(s);return b.tenantId==null?b._agentRecaptchaConfig=$:b._tenantRecaptchaConfigs[b.tenantId]=$,I($.siteKey)}}).catch(s=>{L(s)})})}function g(b,I,L){const s=window.grecaptcha;jS(s)?s.enterprise.ready(()=>{s.enterprise.execute(b,{action:e}).then($=>{I($)}).catch(()=>{I(o2)})}):L(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((b,I)=>{u(this.auth).then(L=>{if(!i&&jS(window.grecaptcha))g(L,b,I);else{if(typeof window>"u"){I(new Error("RecaptchaVerifier is only supported in browser"));return}let s=t2();s.length!==0&&(s+=L),zP(s).then(()=>{g(L,b,I)}).catch($=>{I($)})}}).catch(L=>{I(L)})})}}async function ZS(n,e,i,u=!1){const g=new s2(n);let b;try{b=await g.verify(i)}catch{b=await g.verify(i,!0)}const I=Object.assign({},e);return u?Object.assign(I,{captchaResp:b}):Object.assign(I,{captchaResponse:b}),Object.assign(I,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(I,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),I}async function t1(n,e,i,u){var g;if(!((g=n._getRecaptchaConfig())===null||g===void 0)&&g.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const b=await ZS(n,e,i,i==="getOobCode");return u(n,b)}else return u(n,e).catch(async b=>{if(b.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const I=await ZS(n,e,i,i==="getOobCode");return u(n,I)}else return Promise.reject(b)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a2(n,e){const i=sw(n,"auth");if(i.isInitialized()){const g=i.getImmediate(),b=i.getOptions();if(s0(b,e??{}))return g;Rl(g,"already-initialized")}return i.initialize({options:e})}function l2(n,e){const i=(e==null?void 0:e.persistence)||[],u=(Array.isArray(i)?i:[i]).map(Oc);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(u,e==null?void 0:e.popupRedirectResolver)}function c2(n,e,i){const u=fd(n);cn(u._canInitEmulator,u,"emulator-config-failed"),cn(/^https?:\/\//.test(e),u,"invalid-emulator-scheme");const g=!1,b=FP(e),{host:I,port:L}=u2(e),s=L===null?"":`:${L}`;u.config.emulator={url:`${b}//${I}${s}/`},u.settings.appVerificationDisabledForTesting=!0,u.emulatorConfig=Object.freeze({host:I,port:L,protocol:b.replace(":",""),options:Object.freeze({disableWarnings:g})}),h2()}function FP(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function u2(n){const e=FP(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const u=i[2].split("@").pop()||"",g=/^(\[[^\]]+\])(:|$)/.exec(u);if(g){const b=g[1];return{host:b,port:XS(u.substr(b.length+1))}}else{const[b,I]=u.split(":");return{host:b,port:XS(I)}}}function XS(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function h2(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fw{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return Dc("not implemented")}_getIdTokenResponse(e){return Dc("not implemented")}_linkToIdToken(e,i){return Dc("not implemented")}_getReauthenticationResolver(e){return Dc("not implemented")}}async function d2(n,e){return sh(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f2(n,e){return Lg(n,"POST","/v1/accounts:signInWithPassword",oh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p2(n,e){return Lg(n,"POST","/v1/accounts:signInWithEmailLink",oh(n,e))}async function m2(n,e){return Lg(n,"POST","/v1/accounts:signInWithEmailLink",oh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg extends fw{constructor(e,i,u,g=null){super("password",u),this._email=e,this._password=i,this._tenantId=g}static _fromEmailAndPassword(e,i){return new dg(e,i,"password")}static _fromEmailAndCode(e,i,u=null){return new dg(e,i,"emailLink",u)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return t1(e,i,"signInWithPassword",f2);case"emailLink":return p2(e,{email:this._email,oobCode:this._password});default:Rl(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const u={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return t1(e,u,"signUpPassword",d2);case"emailLink":return m2(e,{idToken:i,email:this._email,oobCode:this._password});default:Rl(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rf(n,e){return Lg(n,"POST","/v1/accounts:signInWithIdp",oh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g2="http://localhost";class sd extends fw{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new sd(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):Rl("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:u,signInMethod:g}=i,b=lw(i,["providerId","signInMethod"]);if(!u||!g)return null;const I=new sd(u,g);return I.idToken=b.idToken||void 0,I.accessToken=b.accessToken||void 0,I.secret=b.secret,I.nonce=b.nonce,I.pendingToken=b.pendingToken||null,I}_getIdTokenResponse(e){const i=this.buildRequest();return Rf(e,i)}_linkToIdToken(e,i){const u=this.buildRequest();return u.idToken=i,Rf(e,u)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,Rf(e,i)}buildRequest(){const e={requestUri:g2,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=Mg(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _2(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function y2(n){const e=Om(Bm(n)).link,i=e?Om(Bm(e)).deep_link_id:null,u=Om(Bm(n)).deep_link_id;return(u?Om(Bm(u)).link:null)||u||i||e||n}class pw{constructor(e){var i,u,g,b,I,L;const s=Om(Bm(e)),$=(i=s.apiKey)!==null&&i!==void 0?i:null,W=(u=s.oobCode)!==null&&u!==void 0?u:null,Q=_2((g=s.mode)!==null&&g!==void 0?g:null);cn($&&W&&Q,"argument-error"),this.apiKey=$,this.operation=Q,this.code=W,this.continueUrl=(b=s.continueUrl)!==null&&b!==void 0?b:null,this.languageCode=(I=s.languageCode)!==null&&I!==void 0?I:null,this.tenantId=(L=s.tenantId)!==null&&L!==void 0?L:null}static parseLink(e){const i=y2(e);try{return new pw(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(){this.providerId=Yf.PROVIDER_ID}static credential(e,i){return dg._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const u=pw.parseLink(i);return cn(u,"argument-error"),dg._fromEmailAndCode(e,u.code,u.tenantId)}}Yf.PROVIDER_ID="password";Yf.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Yf.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og extends NP{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu extends Og{constructor(){super("facebook.com")}static credential(e){return sd._fromParams({providerId:Fu.PROVIDER_ID,signInMethod:Fu.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Fu.credentialFromTaggedObject(e)}static credentialFromError(e){return Fu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Fu.credential(e.oauthAccessToken)}catch{return null}}}Fu.FACEBOOK_SIGN_IN_METHOD="facebook.com";Fu.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nu extends Og{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return sd._fromParams({providerId:Nu.PROVIDER_ID,signInMethod:Nu.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return Nu.credentialFromTaggedObject(e)}static credentialFromError(e){return Nu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:u}=e;if(!i&&!u)return null;try{return Nu.credential(i,u)}catch{return null}}}Nu.GOOGLE_SIGN_IN_METHOD="google.com";Nu.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vu extends Og{constructor(){super("github.com")}static credential(e){return sd._fromParams({providerId:Vu.PROVIDER_ID,signInMethod:Vu.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vu.credentialFromTaggedObject(e)}static credentialFromError(e){return Vu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Vu.credential(e.oauthAccessToken)}catch{return null}}}Vu.GITHUB_SIGN_IN_METHOD="github.com";Vu.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu extends Og{constructor(){super("twitter.com")}static credential(e,i){return sd._fromParams({providerId:Uu.PROVIDER_ID,signInMethod:Uu.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return Uu.credentialFromTaggedObject(e)}static credentialFromError(e){return Uu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:u}=e;if(!i||!u)return null;try{return Uu.credential(i,u)}catch{return null}}}Uu.TWITTER_SIGN_IN_METHOD="twitter.com";Uu.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v2(n,e){return Lg(n,"POST","/v1/accounts:signUp",oh(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ad{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,u,g=!1){const b=await Lc._fromIdTokenResponse(e,u,g),I=KS(u);return new ad({user:b,providerId:I,_tokenResponse:u,operationType:i})}static async _forOperation(e,i,u){await e._updateTokensIfNecessary(u,!0);const g=KS(u);return new ad({user:e,providerId:g,_tokenResponse:u,operationType:i})}}function KS(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0 extends Zc{constructor(e,i,u,g){var b;super(i.code,i.message),this.operationType=u,this.user=g,Object.setPrototypeOf(this,u0.prototype),this.customData={appName:e.name,tenantId:(b=e.tenantId)!==null&&b!==void 0?b:void 0,_serverResponse:i.customData._serverResponse,operationType:u}}static _fromErrorAndOperation(e,i,u,g){return new u0(e,i,u,g)}}function VP(n,e,i,u){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(b=>{throw b.code==="auth/multi-factor-auth-required"?u0._fromErrorAndOperation(n,b,e,u):b})}async function b2(n,e,i=!1){const u=await hg(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return ad._forOperation(n,"link",u)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x2(n,e,i=!1){const{auth:u}=n;if(rc(u.app))return Promise.reject(Nc(u));const g="reauthenticate";try{const b=await hg(n,VP(u,g,e,n),i);cn(b.idToken,u,"internal-error");const I=hw(b.idToken);cn(I,u,"internal-error");const{sub:L}=I;return cn(n.uid===L,u,"user-mismatch"),ad._forOperation(n,g,b)}catch(b){throw(b==null?void 0:b.code)==="auth/user-not-found"&&Rl(u,"user-mismatch"),b}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UP(n,e,i=!1){if(rc(n.app))return Promise.reject(Nc(n));const u="signIn",g=await VP(n,u,e),b=await ad._fromIdTokenResponse(n,u,g);return i||await n._updateCurrentUser(b.user),b}async function w2(n,e){return UP(fd(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jP(n){const e=fd(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function T2(n,e,i){if(rc(n.app))return Promise.reject(Nc(n));const u=fd(n),I=await t1(u,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",v2).catch(s=>{throw s.code==="auth/password-does-not-meet-requirements"&&jP(n),s}),L=await ad._fromIdTokenResponse(u,"signIn",I);return await u._updateCurrentUser(L.user),L}function E2(n,e,i){return rc(n.app)?Promise.reject(Nc(n)):w2(ss(n),Yf.credential(e,i)).catch(async u=>{throw u.code==="auth/password-does-not-meet-requirements"&&jP(n),u})}function I2(n,e,i,u){return ss(n).onIdTokenChanged(e,i,u)}function A2(n,e,i){return ss(n).beforeAuthStateChanged(e,i)}function S2(n){return ss(n).signOut()}const h0="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $P{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(h0,"1"),this.storage.removeItem(h0),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C2=1e3,R2=10;class qP extends $P{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=OP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const u=this.storage.getItem(i),g=this.localCache[i];u!==g&&e(i,g,u)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((I,L,s)=>{this.notifyListeners(I,s)});return}const u=e.key;i?this.detachListener():this.stopPolling();const g=()=>{const I=this.storage.getItem(u);!i&&this.localCache[u]===I||this.notifyListeners(u,I)},b=this.storage.getItem(u);Z6()&&b!==e.newValue&&e.newValue!==e.oldValue?setTimeout(g,R2):g()}notifyListeners(e,i){this.localCache[e]=i;const u=this.listeners[e];if(u)for(const g of Array.from(u))g(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,u)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:u}),!0)})},C2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}qP.type="LOCAL";const k2=qP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GP extends $P{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}GP.type="SESSION";const HP=GP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P2(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y0{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(g=>g.isListeningto(e));if(i)return i;const u=new Y0(e);return this.receivers.push(u),u}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:u,eventType:g,data:b}=i.data,I=this.handlersMap[g];if(!(I!=null&&I.size))return;i.ports[0].postMessage({status:"ack",eventId:u,eventType:g});const L=Array.from(I).map(async $=>$(i.origin,b)),s=await P2(L);i.ports[0].postMessage({status:"done",eventId:u,eventType:g,response:s})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Y0.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mw(n="",e=10){let i="";for(let u=0;u<e;u++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,u=50){const g=typeof MessageChannel<"u"?new MessageChannel:null;if(!g)throw new Error("connection_unavailable");let b,I;return new Promise((L,s)=>{const $=mw("",20);g.port1.start();const W=setTimeout(()=>{s(new Error("unsupported_event"))},u);I={messageChannel:g,onMessage(Q){const ae=Q;if(ae.data.eventId===$)switch(ae.data.status){case"ack":clearTimeout(W),b=setTimeout(()=>{s(new Error("timeout"))},3e3);break;case"done":clearTimeout(b),L(ae.data.response);break;default:clearTimeout(W),clearTimeout(b),s(new Error("invalid_response"));break}}},this.handlers.add(I),g.port1.addEventListener("message",I.onMessage),this.target.postMessage({eventType:e,eventId:$,data:i},[g.port2])}).finally(()=>{I&&this.removeMessageHandler(I)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sc(){return window}function D2(n){sc().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WP(){return typeof sc().WorkerGlobalScope<"u"&&typeof sc().importScripts=="function"}async function L2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function O2(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function B2(){return WP()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZP="firebaseLocalStorageDb",z2=1,d0="firebaseLocalStorage",XP="fbase_key";class Bg{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function J0(n,e){return n.transaction([d0],e?"readwrite":"readonly").objectStore(d0)}function F2(){const n=indexedDB.deleteDatabase(ZP);return new Bg(n).toPromise()}function r1(){const n=indexedDB.open(ZP,z2);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const u=n.result;try{u.createObjectStore(d0,{keyPath:XP})}catch(g){i(g)}}),n.addEventListener("success",async()=>{const u=n.result;u.objectStoreNames.contains(d0)?e(u):(u.close(),await F2(),e(await r1()))})})}async function YS(n,e,i){const u=J0(n,!0).put({[XP]:e,value:i});return new Bg(u).toPromise()}async function N2(n,e){const i=J0(n,!1).get(e),u=await new Bg(i).toPromise();return u===void 0?null:u.value}function JS(n,e){const i=J0(n,!0).delete(e);return new Bg(i).toPromise()}const V2=800,U2=3;class KP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await r1(),this.db)}async _withRetries(e){let i=0;for(;;)try{const u=await this._openDb();return await e(u)}catch(u){if(i++>U2)throw u;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return WP()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Y0._getInstance(B2()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await L2(),!this.activeServiceWorker)return;this.sender=new M2(this.activeServiceWorker);const u=await this.sender._send("ping",{},800);u&&!((e=u[0])===null||e===void 0)&&e.fulfilled&&!((i=u[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||O2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await r1();return await YS(e,h0,"1"),await JS(e,h0),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(u=>YS(u,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(u=>N2(u,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>JS(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(g=>{const b=J0(g,!1).getAll();return new Bg(b).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],u=new Set;if(e.length!==0)for(const{fbase_key:g,value:b}of e)u.add(g),JSON.stringify(this.localCache[g])!==JSON.stringify(b)&&(this.notifyListeners(g,b),i.push(g));for(const g of Object.keys(this.localCache))this.localCache[g]&&!u.has(g)&&(this.notifyListeners(g,null),i.push(g));return i}notifyListeners(e,i){this.localCache[e]=i;const u=this.listeners[e];if(u)for(const g of Array.from(u))g(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),V2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}KP.type="LOCAL";const j2=KP;new Dg(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $2(n,e){return e?Oc(e):(cn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw extends fw{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Rf(e,this._buildIdpRequest())}_linkToIdToken(e,i){return Rf(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return Rf(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function q2(n){return UP(n.auth,new gw(n),n.bypassAuthState)}function G2(n){const{auth:e,user:i}=n;return cn(i,e,"internal-error"),x2(i,new gw(n),n.bypassAuthState)}async function H2(n){const{auth:e,user:i}=n;return cn(i,e,"internal-error"),b2(i,new gw(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YP{constructor(e,i,u,g,b=!1){this.auth=e,this.resolver=u,this.user=g,this.bypassAuthState=b,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(u){this.reject(u)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:u,postBody:g,tenantId:b,error:I,type:L}=e;if(I){this.reject(I);return}const s={auth:this.auth,requestUri:i,sessionId:u,tenantId:b||void 0,postBody:g||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(L)(s))}catch($){this.reject($)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return q2;case"linkViaPopup":case"linkViaRedirect":return H2;case"reauthViaPopup":case"reauthViaRedirect":return G2;default:Rl(this.auth,"internal-error")}}resolve(e){$c(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){$c(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W2=new Dg(2e3,1e4);class bf extends YP{constructor(e,i,u,g,b){super(e,i,g,b),this.provider=u,this.authWindow=null,this.pollId=null,bf.currentPopupAction&&bf.currentPopupAction.cancel(),bf.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return cn(e,this.auth,"internal-error"),e}async onExecution(){$c(this.filter.length===1,"Popup operations only handle one event");const e=mw();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(oc(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(oc(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,bf.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,u;if(!((u=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||u===void 0)&&u.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(oc(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,W2.get())};e()}}bf.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z2="pendingRedirect",Vy=new Map;class X2 extends YP{constructor(e,i,u=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,u),this.eventId=null}async execute(){let e=Vy.get(this.auth._key());if(!e){try{const u=await K2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(u)}catch(i){e=()=>Promise.reject(i)}Vy.set(this.auth._key(),e)}return this.bypassAuthState||Vy.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function K2(n,e){const i=Q2(e),u=J2(n);if(!await u._isAvailable())return!1;const g=await u._get(i)==="true";return await u._remove(i),g}function Y2(n,e){Vy.set(n._key(),e)}function J2(n){return Oc(n._redirectPersistence)}function Q2(n){return Ny(Z2,n.config.apiKey,n.name)}async function eU(n,e,i=!1){if(rc(n.app))return Promise.reject(Nc(n));const u=fd(n),g=$2(u,e),I=await new X2(u,g,i).execute();return I&&!i&&(delete I.user._redirectEventId,await u._persistUserIfCurrent(I.user),await u._setRedirectUser(null,e)),I}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tU=10*60*1e3;class rU{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(u=>{this.isEventForConsumer(e,u)&&(i=!0,this.sendToConsumer(e,u),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!nU(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var u;if(e.error&&!JP(e)){const g=((u=e.error.code)===null||u===void 0?void 0:u.split("auth/")[1])||"internal-error";i.onError(oc(this.auth,g))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const u=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&u}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=tU&&this.cachedEventUids.clear(),this.cachedEventUids.has(QS(e))}saveEventToCache(e){this.cachedEventUids.add(QS(e)),this.lastProcessedEventTime=Date.now()}}function QS(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function JP({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function nU(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return JP(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iU(n,e={}){return sh(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oU=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,sU=/^https?/;async function aU(n){if(n.config.emulator)return;const{authorizedDomains:e}=await iU(n);for(const i of e)try{if(lU(i))return}catch{}Rl(n,"unauthorized-domain")}function lU(n){const e=Qx(),{protocol:i,hostname:u}=new URL(e);if(n.startsWith("chrome-extension://")){const I=new URL(n);return I.hostname===""&&u===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&I.hostname===u}if(!sU.test(i))return!1;if(oU.test(n))return u===n;const g=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+g+"|"+g+")$","i").test(u)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cU=new Dg(3e4,6e4);function eC(){const n=sc().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function uU(n){return new Promise((e,i)=>{var u,g,b;function I(){eC(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{eC(),i(oc(n,"network-request-failed"))},timeout:cU.get()})}if(!((g=(u=sc().gapi)===null||u===void 0?void 0:u.iframes)===null||g===void 0)&&g.Iframe)e(gapi.iframes.getContext());else if(!((b=sc().gapi)===null||b===void 0)&&b.load)I();else{const L=n2("iframefcb");return sc()[L]=()=>{gapi.load?I():i(oc(n,"network-request-failed"))},zP(`${r2()}?onload=${L}`).catch(s=>i(s))}}).catch(e=>{throw Uy=null,e})}let Uy=null;function hU(n){return Uy=Uy||uU(n),Uy}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dU=new Dg(5e3,15e3),fU="__/auth/iframe",pU="emulator/auth/iframe",mU={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},gU=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function _U(n){const e=n.config;cn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?uw(e,pU):`https://${n.config.authDomain}/${fU}`,u={apiKey:e.apiKey,appName:n.name,v:Kf},g=gU.get(n.config.apiHost);g&&(u.eid=g);const b=n._getFrameworks();return b.length&&(u.fw=b.join(",")),`${i}?${Mg(u).slice(1)}`}async function yU(n){const e=await hU(n),i=sc().gapi;return cn(i,n,"internal-error"),e.open({where:document.body,url:_U(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mU,dontclear:!0},u=>new Promise(async(g,b)=>{await u.restyle({setHideOnLeave:!1});const I=oc(n,"network-request-failed"),L=sc().setTimeout(()=>{b(I)},dU.get());function s(){sc().clearTimeout(L),g(u)}u.ping(s).then(s,()=>{b(I)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vU={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},bU=500,xU=600,wU="_blank",TU="http://localhost";class tC{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function EU(n,e,i,u=bU,g=xU){const b=Math.max((window.screen.availHeight-g)/2,0).toString(),I=Math.max((window.screen.availWidth-u)/2,0).toString();let L="";const s=Object.assign(Object.assign({},vU),{width:u.toString(),height:g.toString(),top:b,left:I}),$=Ss().toLowerCase();i&&(L=kP($)?wU:i),CP($)&&(e=e||TU,s.scrollbars="yes");const W=Object.entries(s).reduce((ae,[we,He])=>`${ae}${we}=${He},`,"");if(W6($)&&L!=="_self")return IU(e||"",L),new tC(null);const Q=window.open(e||"",L,W);cn(Q,n,"popup-blocked");try{Q.focus()}catch{}return new tC(Q)}function IU(n,e){const i=document.createElement("a");i.href=n,i.target=e;const u=document.createEvent("MouseEvent");u.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(u)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AU="__/auth/handler",SU="emulator/auth/handler",CU=encodeURIComponent("fac");async function rC(n,e,i,u,g,b){cn(n.config.authDomain,n,"auth-domain-config-required"),cn(n.config.apiKey,n,"invalid-api-key");const I={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:u,v:Kf,eventId:g};if(e instanceof NP){e.setDefaultLanguage(n.languageCode),I.providerId=e.providerId||"",yV(e.getCustomParameters())||(I.customParameters=JSON.stringify(e.getCustomParameters()));for(const[W,Q]of Object.entries({}))I[W]=Q}if(e instanceof Og){const W=e.getScopes().filter(Q=>Q!=="");W.length>0&&(I.scopes=W.join(","))}n.tenantId&&(I.tid=n.tenantId);const L=I;for(const W of Object.keys(L))L[W]===void 0&&delete L[W];const s=await n._getAppCheckToken(),$=s?`#${CU}=${encodeURIComponent(s)}`:"";return`${RU(n)}?${Mg(L).slice(1)}${$}`}function RU({config:n}){return n.emulator?uw(n,SU):`https://${n.authDomain}/${AU}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _x="webStorageSupport";class kU{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=HP,this._completeRedirectFn=eU,this._overrideRedirectResult=Y2}async _openPopup(e,i,u,g){var b;$c((b=this.eventManagers[e._key()])===null||b===void 0?void 0:b.manager,"_initialize() not called before _openPopup()");const I=await rC(e,i,u,Qx(),g);return EU(e,I,mw())}async _openRedirect(e,i,u,g){await this._originValidation(e);const b=await rC(e,i,u,Qx(),g);return D2(b),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:g,promise:b}=this.eventManagers[i];return g?Promise.resolve(g):($c(b,"If manager is not set, promise should be"),b)}const u=this.initAndGetManager(e);return this.eventManagers[i]={promise:u},u.catch(()=>{delete this.eventManagers[i]}),u}async initAndGetManager(e){const i=await yU(e),u=new rU(e);return i.register("authEvent",g=>(cn(g==null?void 0:g.authEvent,e,"invalid-auth-event"),{status:u.onEvent(g.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:u},this.iframes[e._key()]=i,u}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(_x,{type:_x},g=>{var b;const I=(b=g==null?void 0:g[0])===null||b===void 0?void 0:b[_x];I!==void 0&&i(!!I),Rl(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=aU(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return OP()||RP()||dw()}}const PU=kU;var nC="@firebase/auth",iC="1.7.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MU{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(u=>{e((u==null?void 0:u.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){cn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DU(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function LU(n){Vf(new od("auth",(e,{options:i})=>{const u=e.getProvider("app").getImmediate(),g=e.getProvider("heartbeat"),b=e.getProvider("app-check-internal"),{apiKey:I,authDomain:L}=u.options;cn(I&&!I.includes(":"),"invalid-api-key",{appName:u.name});const s={apiKey:I,authDomain:L,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:BP(n)},$=new Q6(u,g,b,s);return l2($,i),$},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,u)=>{e.getProvider("auth-internal").initialize()})),Vf(new od("auth-internal",e=>{const i=fd(e.getProvider("auth").getImmediate());return(u=>new MU(u))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),Xu(nC,iC,DU(n)),Xu(nC,iC,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OU=5*60,BU=fP("authIdTokenMaxAge")||OU;let oC=null;const zU=n=>async e=>{const i=e&&await e.getIdTokenResult(),u=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(u&&u>BU)return;const g=i==null?void 0:i.token;oC!==g&&(oC=g,await fetch(n,{method:g?"POST":"DELETE",headers:g?{Authorization:`Bearer ${g}`}:{}}))};function _w(n=gP()){const e=sw(n,"auth");if(e.isInitialized())return e.getImmediate();const i=a2(n,{popupRedirectResolver:PU,persistence:[j2,k2,HP]}),u=fP("authTokenSyncURL");if(u&&typeof isSecureContext=="boolean"&&isSecureContext){const b=new URL(u,location.origin);if(location.origin===b.origin){const I=zU(b.toString());A2(i,I,()=>I(i.currentUser)),I2(i,L=>I(L))}}const g=hP("auth");return g&&c2(i,`http://${g}`),i}function FU(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}e2({loadJS(n){return new Promise((e,i)=>{const u=document.createElement("script");u.setAttribute("src",n),u.onload=e,u.onerror=g=>{const b=oc("internal-error");b.customData=g,i(b)},u.type="text/javascript",u.charset="UTF-8",FU().appendChild(u)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});LU("Browser");var NU="firebase",VU="10.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Xu(NU,VU,"app");var sC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Qh,QP;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(qe,be){function Fe(){}Fe.prototype=be.prototype,qe.D=be.prototype,qe.prototype=new Fe,qe.prototype.constructor=qe,qe.C=function(Je,Me,je){for(var Ve=Array(arguments.length-2),An=2;An<arguments.length;An++)Ve[An-2]=arguments[An];return be.prototype[Me].apply(Je,Ve)}}function i(){this.blockSize=-1}function u(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(u,i),u.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function g(qe,be,Fe){Fe||(Fe=0);var Je=Array(16);if(typeof be=="string")for(var Me=0;16>Me;++Me)Je[Me]=be.charCodeAt(Fe++)|be.charCodeAt(Fe++)<<8|be.charCodeAt(Fe++)<<16|be.charCodeAt(Fe++)<<24;else for(Me=0;16>Me;++Me)Je[Me]=be[Fe++]|be[Fe++]<<8|be[Fe++]<<16|be[Fe++]<<24;be=qe.g[0],Fe=qe.g[1],Me=qe.g[2];var je=qe.g[3],Ve=be+(je^Fe&(Me^je))+Je[0]+3614090360&4294967295;be=Fe+(Ve<<7&4294967295|Ve>>>25),Ve=je+(Me^be&(Fe^Me))+Je[1]+3905402710&4294967295,je=be+(Ve<<12&4294967295|Ve>>>20),Ve=Me+(Fe^je&(be^Fe))+Je[2]+606105819&4294967295,Me=je+(Ve<<17&4294967295|Ve>>>15),Ve=Fe+(be^Me&(je^be))+Je[3]+3250441966&4294967295,Fe=Me+(Ve<<22&4294967295|Ve>>>10),Ve=be+(je^Fe&(Me^je))+Je[4]+4118548399&4294967295,be=Fe+(Ve<<7&4294967295|Ve>>>25),Ve=je+(Me^be&(Fe^Me))+Je[5]+1200080426&4294967295,je=be+(Ve<<12&4294967295|Ve>>>20),Ve=Me+(Fe^je&(be^Fe))+Je[6]+2821735955&4294967295,Me=je+(Ve<<17&4294967295|Ve>>>15),Ve=Fe+(be^Me&(je^be))+Je[7]+4249261313&4294967295,Fe=Me+(Ve<<22&4294967295|Ve>>>10),Ve=be+(je^Fe&(Me^je))+Je[8]+1770035416&4294967295,be=Fe+(Ve<<7&4294967295|Ve>>>25),Ve=je+(Me^be&(Fe^Me))+Je[9]+2336552879&4294967295,je=be+(Ve<<12&4294967295|Ve>>>20),Ve=Me+(Fe^je&(be^Fe))+Je[10]+4294925233&4294967295,Me=je+(Ve<<17&4294967295|Ve>>>15),Ve=Fe+(be^Me&(je^be))+Je[11]+2304563134&4294967295,Fe=Me+(Ve<<22&4294967295|Ve>>>10),Ve=be+(je^Fe&(Me^je))+Je[12]+1804603682&4294967295,be=Fe+(Ve<<7&4294967295|Ve>>>25),Ve=je+(Me^be&(Fe^Me))+Je[13]+4254626195&4294967295,je=be+(Ve<<12&4294967295|Ve>>>20),Ve=Me+(Fe^je&(be^Fe))+Je[14]+2792965006&4294967295,Me=je+(Ve<<17&4294967295|Ve>>>15),Ve=Fe+(be^Me&(je^be))+Je[15]+1236535329&4294967295,Fe=Me+(Ve<<22&4294967295|Ve>>>10),Ve=be+(Me^je&(Fe^Me))+Je[1]+4129170786&4294967295,be=Fe+(Ve<<5&4294967295|Ve>>>27),Ve=je+(Fe^Me&(be^Fe))+Je[6]+3225465664&4294967295,je=be+(Ve<<9&4294967295|Ve>>>23),Ve=Me+(be^Fe&(je^be))+Je[11]+643717713&4294967295,Me=je+(Ve<<14&4294967295|Ve>>>18),Ve=Fe+(je^be&(Me^je))+Je[0]+3921069994&4294967295,Fe=Me+(Ve<<20&4294967295|Ve>>>12),Ve=be+(Me^je&(Fe^Me))+Je[5]+3593408605&4294967295,be=Fe+(Ve<<5&4294967295|Ve>>>27),Ve=je+(Fe^Me&(be^Fe))+Je[10]+38016083&4294967295,je=be+(Ve<<9&4294967295|Ve>>>23),Ve=Me+(be^Fe&(je^be))+Je[15]+3634488961&4294967295,Me=je+(Ve<<14&4294967295|Ve>>>18),Ve=Fe+(je^be&(Me^je))+Je[4]+3889429448&4294967295,Fe=Me+(Ve<<20&4294967295|Ve>>>12),Ve=be+(Me^je&(Fe^Me))+Je[9]+568446438&4294967295,be=Fe+(Ve<<5&4294967295|Ve>>>27),Ve=je+(Fe^Me&(be^Fe))+Je[14]+3275163606&4294967295,je=be+(Ve<<9&4294967295|Ve>>>23),Ve=Me+(be^Fe&(je^be))+Je[3]+4107603335&4294967295,Me=je+(Ve<<14&4294967295|Ve>>>18),Ve=Fe+(je^be&(Me^je))+Je[8]+1163531501&4294967295,Fe=Me+(Ve<<20&4294967295|Ve>>>12),Ve=be+(Me^je&(Fe^Me))+Je[13]+2850285829&4294967295,be=Fe+(Ve<<5&4294967295|Ve>>>27),Ve=je+(Fe^Me&(be^Fe))+Je[2]+4243563512&4294967295,je=be+(Ve<<9&4294967295|Ve>>>23),Ve=Me+(be^Fe&(je^be))+Je[7]+1735328473&4294967295,Me=je+(Ve<<14&4294967295|Ve>>>18),Ve=Fe+(je^be&(Me^je))+Je[12]+2368359562&4294967295,Fe=Me+(Ve<<20&4294967295|Ve>>>12),Ve=be+(Fe^Me^je)+Je[5]+4294588738&4294967295,be=Fe+(Ve<<4&4294967295|Ve>>>28),Ve=je+(be^Fe^Me)+Je[8]+2272392833&4294967295,je=be+(Ve<<11&4294967295|Ve>>>21),Ve=Me+(je^be^Fe)+Je[11]+1839030562&4294967295,Me=je+(Ve<<16&4294967295|Ve>>>16),Ve=Fe+(Me^je^be)+Je[14]+4259657740&4294967295,Fe=Me+(Ve<<23&4294967295|Ve>>>9),Ve=be+(Fe^Me^je)+Je[1]+2763975236&4294967295,be=Fe+(Ve<<4&4294967295|Ve>>>28),Ve=je+(be^Fe^Me)+Je[4]+1272893353&4294967295,je=be+(Ve<<11&4294967295|Ve>>>21),Ve=Me+(je^be^Fe)+Je[7]+4139469664&4294967295,Me=je+(Ve<<16&4294967295|Ve>>>16),Ve=Fe+(Me^je^be)+Je[10]+3200236656&4294967295,Fe=Me+(Ve<<23&4294967295|Ve>>>9),Ve=be+(Fe^Me^je)+Je[13]+681279174&4294967295,be=Fe+(Ve<<4&4294967295|Ve>>>28),Ve=je+(be^Fe^Me)+Je[0]+3936430074&4294967295,je=be+(Ve<<11&4294967295|Ve>>>21),Ve=Me+(je^be^Fe)+Je[3]+3572445317&4294967295,Me=je+(Ve<<16&4294967295|Ve>>>16),Ve=Fe+(Me^je^be)+Je[6]+76029189&4294967295,Fe=Me+(Ve<<23&4294967295|Ve>>>9),Ve=be+(Fe^Me^je)+Je[9]+3654602809&4294967295,be=Fe+(Ve<<4&4294967295|Ve>>>28),Ve=je+(be^Fe^Me)+Je[12]+3873151461&4294967295,je=be+(Ve<<11&4294967295|Ve>>>21),Ve=Me+(je^be^Fe)+Je[15]+530742520&4294967295,Me=je+(Ve<<16&4294967295|Ve>>>16),Ve=Fe+(Me^je^be)+Je[2]+3299628645&4294967295,Fe=Me+(Ve<<23&4294967295|Ve>>>9),Ve=be+(Me^(Fe|~je))+Je[0]+4096336452&4294967295,be=Fe+(Ve<<6&4294967295|Ve>>>26),Ve=je+(Fe^(be|~Me))+Je[7]+1126891415&4294967295,je=be+(Ve<<10&4294967295|Ve>>>22),Ve=Me+(be^(je|~Fe))+Je[14]+2878612391&4294967295,Me=je+(Ve<<15&4294967295|Ve>>>17),Ve=Fe+(je^(Me|~be))+Je[5]+4237533241&4294967295,Fe=Me+(Ve<<21&4294967295|Ve>>>11),Ve=be+(Me^(Fe|~je))+Je[12]+1700485571&4294967295,be=Fe+(Ve<<6&4294967295|Ve>>>26),Ve=je+(Fe^(be|~Me))+Je[3]+2399980690&4294967295,je=be+(Ve<<10&4294967295|Ve>>>22),Ve=Me+(be^(je|~Fe))+Je[10]+4293915773&4294967295,Me=je+(Ve<<15&4294967295|Ve>>>17),Ve=Fe+(je^(Me|~be))+Je[1]+2240044497&4294967295,Fe=Me+(Ve<<21&4294967295|Ve>>>11),Ve=be+(Me^(Fe|~je))+Je[8]+1873313359&4294967295,be=Fe+(Ve<<6&4294967295|Ve>>>26),Ve=je+(Fe^(be|~Me))+Je[15]+4264355552&4294967295,je=be+(Ve<<10&4294967295|Ve>>>22),Ve=Me+(be^(je|~Fe))+Je[6]+2734768916&4294967295,Me=je+(Ve<<15&4294967295|Ve>>>17),Ve=Fe+(je^(Me|~be))+Je[13]+1309151649&4294967295,Fe=Me+(Ve<<21&4294967295|Ve>>>11),Ve=be+(Me^(Fe|~je))+Je[4]+4149444226&4294967295,be=Fe+(Ve<<6&4294967295|Ve>>>26),Ve=je+(Fe^(be|~Me))+Je[11]+3174756917&4294967295,je=be+(Ve<<10&4294967295|Ve>>>22),Ve=Me+(be^(je|~Fe))+Je[2]+718787259&4294967295,Me=je+(Ve<<15&4294967295|Ve>>>17),Ve=Fe+(je^(Me|~be))+Je[9]+3951481745&4294967295,qe.g[0]=qe.g[0]+be&4294967295,qe.g[1]=qe.g[1]+(Me+(Ve<<21&4294967295|Ve>>>11))&4294967295,qe.g[2]=qe.g[2]+Me&4294967295,qe.g[3]=qe.g[3]+je&4294967295}u.prototype.u=function(qe,be){be===void 0&&(be=qe.length);for(var Fe=be-this.blockSize,Je=this.B,Me=this.h,je=0;je<be;){if(Me==0)for(;je<=Fe;)g(this,qe,je),je+=this.blockSize;if(typeof qe=="string"){for(;je<be;)if(Je[Me++]=qe.charCodeAt(je++),Me==this.blockSize){g(this,Je),Me=0;break}}else for(;je<be;)if(Je[Me++]=qe[je++],Me==this.blockSize){g(this,Je),Me=0;break}}this.h=Me,this.o+=be},u.prototype.v=function(){var qe=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);qe[0]=128;for(var be=1;be<qe.length-8;++be)qe[be]=0;var Fe=8*this.o;for(be=qe.length-8;be<qe.length;++be)qe[be]=Fe&255,Fe/=256;for(this.u(qe),qe=Array(16),be=Fe=0;4>be;++be)for(var Je=0;32>Je;Je+=8)qe[Fe++]=this.g[be]>>>Je&255;return qe};function b(qe,be){var Fe=L;return Object.prototype.hasOwnProperty.call(Fe,qe)?Fe[qe]:Fe[qe]=be(qe)}function I(qe,be){this.h=be;for(var Fe=[],Je=!0,Me=qe.length-1;0<=Me;Me--){var je=qe[Me]|0;Je&&je==be||(Fe[Me]=je,Je=!1)}this.g=Fe}var L={};function s(qe){return-128<=qe&&128>qe?b(qe,function(be){return new I([be|0],0>be?-1:0)}):new I([qe|0],0>qe?-1:0)}function $(qe){if(isNaN(qe)||!isFinite(qe))return Q;if(0>qe)return Ne($(-qe));for(var be=[],Fe=1,Je=0;qe>=Fe;Je++)be[Je]=qe/Fe|0,Fe*=4294967296;return new I(be,0)}function W(qe,be){if(qe.length==0)throw Error("number format error: empty string");if(be=be||10,2>be||36<be)throw Error("radix out of range: "+be);if(qe.charAt(0)=="-")return Ne(W(qe.substring(1),be));if(0<=qe.indexOf("-"))throw Error('number format error: interior "-" character');for(var Fe=$(Math.pow(be,8)),Je=Q,Me=0;Me<qe.length;Me+=8){var je=Math.min(8,qe.length-Me),Ve=parseInt(qe.substring(Me,Me+je),be);8>je?(je=$(Math.pow(be,je)),Je=Je.j(je).add($(Ve))):(Je=Je.j(Fe),Je=Je.add($(Ve)))}return Je}var Q=s(0),ae=s(1),we=s(16777216);n=I.prototype,n.m=function(){if($e(this))return-Ne(this).m();for(var qe=0,be=1,Fe=0;Fe<this.g.length;Fe++){var Je=this.i(Fe);qe+=(0<=Je?Je:4294967296+Je)*be,be*=4294967296}return qe},n.toString=function(qe){if(qe=qe||10,2>qe||36<qe)throw Error("radix out of range: "+qe);if(He(this))return"0";if($e(this))return"-"+Ne(this).toString(qe);for(var be=$(Math.pow(qe,6)),Fe=this,Je="";;){var Me=zt(Fe,be).g;Fe=wt(Fe,Me.j(be));var je=((0<Fe.g.length?Fe.g[0]:Fe.h)>>>0).toString(qe);if(Fe=Me,He(Fe))return je+Je;for(;6>je.length;)je="0"+je;Je=je+Je}},n.i=function(qe){return 0>qe?0:qe<this.g.length?this.g[qe]:this.h};function He(qe){if(qe.h!=0)return!1;for(var be=0;be<qe.g.length;be++)if(qe.g[be]!=0)return!1;return!0}function $e(qe){return qe.h==-1}n.l=function(qe){return qe=wt(this,qe),$e(qe)?-1:He(qe)?0:1};function Ne(qe){for(var be=qe.g.length,Fe=[],Je=0;Je<be;Je++)Fe[Je]=~qe.g[Je];return new I(Fe,~qe.h).add(ae)}n.abs=function(){return $e(this)?Ne(this):this},n.add=function(qe){for(var be=Math.max(this.g.length,qe.g.length),Fe=[],Je=0,Me=0;Me<=be;Me++){var je=Je+(this.i(Me)&65535)+(qe.i(Me)&65535),Ve=(je>>>16)+(this.i(Me)>>>16)+(qe.i(Me)>>>16);Je=Ve>>>16,je&=65535,Ve&=65535,Fe[Me]=Ve<<16|je}return new I(Fe,Fe[Fe.length-1]&-2147483648?-1:0)};function wt(qe,be){return qe.add(Ne(be))}n.j=function(qe){if(He(this)||He(qe))return Q;if($e(this))return $e(qe)?Ne(this).j(Ne(qe)):Ne(Ne(this).j(qe));if($e(qe))return Ne(this.j(Ne(qe)));if(0>this.l(we)&&0>qe.l(we))return $(this.m()*qe.m());for(var be=this.g.length+qe.g.length,Fe=[],Je=0;Je<2*be;Je++)Fe[Je]=0;for(Je=0;Je<this.g.length;Je++)for(var Me=0;Me<qe.g.length;Me++){var je=this.i(Je)>>>16,Ve=this.i(Je)&65535,An=qe.i(Me)>>>16,jn=qe.i(Me)&65535;Fe[2*Je+2*Me]+=Ve*jn,mt(Fe,2*Je+2*Me),Fe[2*Je+2*Me+1]+=je*jn,mt(Fe,2*Je+2*Me+1),Fe[2*Je+2*Me+1]+=Ve*An,mt(Fe,2*Je+2*Me+1),Fe[2*Je+2*Me+2]+=je*An,mt(Fe,2*Je+2*Me+2)}for(Je=0;Je<be;Je++)Fe[Je]=Fe[2*Je+1]<<16|Fe[2*Je];for(Je=be;Je<2*be;Je++)Fe[Je]=0;return new I(Fe,0)};function mt(qe,be){for(;(qe[be]&65535)!=qe[be];)qe[be+1]+=qe[be]>>>16,qe[be]&=65535,be++}function vt(qe,be){this.g=qe,this.h=be}function zt(qe,be){if(He(be))throw Error("division by zero");if(He(qe))return new vt(Q,Q);if($e(qe))return be=zt(Ne(qe),be),new vt(Ne(be.g),Ne(be.h));if($e(be))return be=zt(qe,Ne(be)),new vt(Ne(be.g),be.h);if(30<qe.g.length){if($e(qe)||$e(be))throw Error("slowDivide_ only works with positive integers.");for(var Fe=ae,Je=be;0>=Je.l(qe);)Fe=Ct(Fe),Je=Ct(Je);var Me=qt(Fe,1),je=qt(Je,1);for(Je=qt(Je,2),Fe=qt(Fe,2);!He(Je);){var Ve=je.add(Je);0>=Ve.l(qe)&&(Me=Me.add(Fe),je=Ve),Je=qt(Je,1),Fe=qt(Fe,1)}return be=wt(qe,Me.j(be)),new vt(Me,be)}for(Me=Q;0<=qe.l(be);){for(Fe=Math.max(1,Math.floor(qe.m()/be.m())),Je=Math.ceil(Math.log(Fe)/Math.LN2),Je=48>=Je?1:Math.pow(2,Je-48),je=$(Fe),Ve=je.j(be);$e(Ve)||0<Ve.l(qe);)Fe-=Je,je=$(Fe),Ve=je.j(be);He(je)&&(je=ae),Me=Me.add(je),qe=wt(qe,Ve)}return new vt(Me,qe)}n.A=function(qe){return zt(this,qe).h},n.and=function(qe){for(var be=Math.max(this.g.length,qe.g.length),Fe=[],Je=0;Je<be;Je++)Fe[Je]=this.i(Je)&qe.i(Je);return new I(Fe,this.h&qe.h)},n.or=function(qe){for(var be=Math.max(this.g.length,qe.g.length),Fe=[],Je=0;Je<be;Je++)Fe[Je]=this.i(Je)|qe.i(Je);return new I(Fe,this.h|qe.h)},n.xor=function(qe){for(var be=Math.max(this.g.length,qe.g.length),Fe=[],Je=0;Je<be;Je++)Fe[Je]=this.i(Je)^qe.i(Je);return new I(Fe,this.h^qe.h)};function Ct(qe){for(var be=qe.g.length+1,Fe=[],Je=0;Je<be;Je++)Fe[Je]=qe.i(Je)<<1|qe.i(Je-1)>>>31;return new I(Fe,qe.h)}function qt(qe,be){var Fe=be>>5;be%=32;for(var Je=qe.g.length-Fe,Me=[],je=0;je<Je;je++)Me[je]=0<be?qe.i(je+Fe)>>>be|qe.i(je+Fe+1)<<32-be:qe.i(je+Fe);return new I(Me,qe.h)}u.prototype.digest=u.prototype.v,u.prototype.reset=u.prototype.s,u.prototype.update=u.prototype.u,QP=u,I.prototype.add=I.prototype.add,I.prototype.multiply=I.prototype.j,I.prototype.modulo=I.prototype.A,I.prototype.compare=I.prototype.l,I.prototype.toNumber=I.prototype.m,I.prototype.toString=I.prototype.toString,I.prototype.getBits=I.prototype.i,I.fromNumber=$,I.fromString=W,Qh=I}).apply(typeof sC<"u"?sC:typeof self<"u"?self:typeof window<"u"?window:{});var Ey=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var eM,tM,zm,rM,jy,n1,nM,iM,oM;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(D,X,te){return D==Array.prototype||D==Object.prototype||(D[X]=te.value),D};function i(D){D=[typeof globalThis=="object"&&globalThis,D,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ey=="object"&&Ey];for(var X=0;X<D.length;++X){var te=D[X];if(te&&te.Math==Math)return te}throw Error("Cannot find global object")}var u=i(this);function g(D,X){if(X)e:{var te=u;D=D.split(".");for(var fe=0;fe<D.length-1;fe++){var _t=D[fe];if(!(_t in te))break e;te=te[_t]}D=D[D.length-1],fe=te[D],X=X(fe),X!=fe&&X!=null&&e(te,D,{configurable:!0,writable:!0,value:X})}}function b(D,X){D instanceof String&&(D+="");var te=0,fe=!1,_t={next:function(){if(!fe&&te<D.length){var st=te++;return{value:X(st,D[st]),done:!1}}return fe=!0,{done:!0,value:void 0}}};return _t[Symbol.iterator]=function(){return _t},_t}g("Array.prototype.values",function(D){return D||function(){return b(this,function(X,te){return te})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var I=I||{},L=this||self;function s(D){var X=typeof D;return X=X!="object"?X:D?Array.isArray(D)?"array":X:"null",X=="array"||X=="object"&&typeof D.length=="number"}function $(D){var X=typeof D;return X=="object"&&D!=null||X=="function"}function W(D,X,te){return D.call.apply(D.bind,arguments)}function Q(D,X,te){if(!D)throw Error();if(2<arguments.length){var fe=Array.prototype.slice.call(arguments,2);return function(){var _t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(_t,fe),D.apply(X,_t)}}return function(){return D.apply(X,arguments)}}function ae(D,X,te){return ae=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?W:Q,ae.apply(null,arguments)}function we(D,X){var te=Array.prototype.slice.call(arguments,1);return function(){var fe=te.slice();return fe.push.apply(fe,arguments),D.apply(this,fe)}}function He(D,X){function te(){}te.prototype=X.prototype,D.aa=X.prototype,D.prototype=new te,D.prototype.constructor=D,D.Qb=function(fe,_t,st){for(var ur=Array(arguments.length-2),Tn=2;Tn<arguments.length;Tn++)ur[Tn-2]=arguments[Tn];return X.prototype[_t].apply(fe,ur)}}function $e(D){const X=D.length;if(0<X){const te=Array(X);for(let fe=0;fe<X;fe++)te[fe]=D[fe];return te}return[]}function Ne(D,X){for(let te=1;te<arguments.length;te++){const fe=arguments[te];if(s(fe)){const _t=D.length||0,st=fe.length||0;D.length=_t+st;for(let ur=0;ur<st;ur++)D[_t+ur]=fe[ur]}else D.push(fe)}}class wt{constructor(X,te){this.i=X,this.j=te,this.h=0,this.g=null}get(){let X;return 0<this.h?(this.h--,X=this.g,this.g=X.next,X.next=null):X=this.i(),X}}function mt(D){return/^[\s\xa0]*$/.test(D)}function vt(){var D=L.navigator;return D&&(D=D.userAgent)?D:""}function zt(D){return zt[" "](D),D}zt[" "]=function(){};var Ct=vt().indexOf("Gecko")!=-1&&!(vt().toLowerCase().indexOf("webkit")!=-1&&vt().indexOf("Edge")==-1)&&!(vt().indexOf("Trident")!=-1||vt().indexOf("MSIE")!=-1)&&vt().indexOf("Edge")==-1;function qt(D,X,te){for(const fe in D)X.call(te,D[fe],fe,D)}function qe(D,X){for(const te in D)X.call(void 0,D[te],te,D)}function be(D){const X={};for(const te in D)X[te]=D[te];return X}const Fe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Je(D,X){let te,fe;for(let _t=1;_t<arguments.length;_t++){fe=arguments[_t];for(te in fe)D[te]=fe[te];for(let st=0;st<Fe.length;st++)te=Fe[st],Object.prototype.hasOwnProperty.call(fe,te)&&(D[te]=fe[te])}}function Me(D){var X=1;D=D.split(":");const te=[];for(;0<X&&D.length;)te.push(D.shift()),X--;return D.length&&te.push(D.join(":")),te}function je(D){L.setTimeout(()=>{throw D},0)}function Ve(){var D=On;let X=null;return D.g&&(X=D.g,D.g=D.g.next,D.g||(D.h=null),X.next=null),X}class An{constructor(){this.h=this.g=null}add(X,te){const fe=jn.get();fe.set(X,te),this.h?this.h.next=fe:this.g=fe,this.h=fe}}var jn=new wt(()=>new or,D=>D.reset());class or{constructor(){this.next=this.g=this.h=null}set(X,te){this.h=X,this.g=te,this.next=null}reset(){this.next=this.g=this.h=null}}let Cr,Vr=!1,On=new An,dr=()=>{const D=L.Promise.resolve(void 0);Cr=()=>{D.then(Zn)}};var Zn=()=>{for(var D;D=Ve();){try{D.h.call(D.g)}catch(te){je(te)}var X=jn;X.j(D),100>X.h&&(X.h++,D.next=X.g,X.g=D)}Vr=!1};function yn(){this.s=this.s,this.C=this.C}yn.prototype.s=!1,yn.prototype.ma=function(){this.s||(this.s=!0,this.N())},yn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function kt(D,X){this.type=D,this.g=this.target=X,this.defaultPrevented=!1}kt.prototype.h=function(){this.defaultPrevented=!0};var fr=function(){if(!L.addEventListener||!Object.defineProperty)return!1;var D=!1,X=Object.defineProperty({},"passive",{get:function(){D=!0}});try{const te=()=>{};L.addEventListener("test",te,X),L.removeEventListener("test",te,X)}catch{}return D}();function li(D,X){if(kt.call(this,D?D.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,D){var te=this.type=D.type,fe=D.changedTouches&&D.changedTouches.length?D.changedTouches[0]:null;if(this.target=D.target||D.srcElement,this.g=X,X=D.relatedTarget){if(Ct){e:{try{zt(X.nodeName);var _t=!0;break e}catch{}_t=!1}_t||(X=null)}}else te=="mouseover"?X=D.fromElement:te=="mouseout"&&(X=D.toElement);this.relatedTarget=X,fe?(this.clientX=fe.clientX!==void 0?fe.clientX:fe.pageX,this.clientY=fe.clientY!==void 0?fe.clientY:fe.pageY,this.screenX=fe.screenX||0,this.screenY=fe.screenY||0):(this.clientX=D.clientX!==void 0?D.clientX:D.pageX,this.clientY=D.clientY!==void 0?D.clientY:D.pageY,this.screenX=D.screenX||0,this.screenY=D.screenY||0),this.button=D.button,this.key=D.key||"",this.ctrlKey=D.ctrlKey,this.altKey=D.altKey,this.shiftKey=D.shiftKey,this.metaKey=D.metaKey,this.pointerId=D.pointerId||0,this.pointerType=typeof D.pointerType=="string"?D.pointerType:Dn[D.pointerType]||"",this.state=D.state,this.i=D,D.defaultPrevented&&li.aa.h.call(this)}}He(li,kt);var Dn={2:"touch",3:"pen",4:"mouse"};li.prototype.h=function(){li.aa.h.call(this);var D=this.i;D.preventDefault?D.preventDefault():D.returnValue=!1};var It="closure_listenable_"+(1e6*Math.random()|0),lr=0;function sr(D,X,te,fe,_t){this.listener=D,this.proxy=null,this.src=X,this.type=te,this.capture=!!fe,this.ha=_t,this.key=++lr,this.da=this.fa=!1}function wr(D){D.da=!0,D.listener=null,D.proxy=null,D.src=null,D.ha=null}function _e(D){this.src=D,this.g={},this.h=0}_e.prototype.add=function(D,X,te,fe,_t){var st=D.toString();D=this.g[st],D||(D=this.g[st]=[],this.h++);var ur=Le(D,X,fe,_t);return-1<ur?(X=D[ur],te||(X.fa=!1)):(X=new sr(X,this.src,st,!!fe,_t),X.fa=te,D.push(X)),X};function un(D,X){var te=X.type;if(te in D.g){var fe=D.g[te],_t=Array.prototype.indexOf.call(fe,X,void 0),st;(st=0<=_t)&&Array.prototype.splice.call(fe,_t,1),st&&(wr(X),D.g[te].length==0&&(delete D.g[te],D.h--))}}function Le(D,X,te,fe){for(var _t=0;_t<D.length;++_t){var st=D[_t];if(!st.da&&st.listener==X&&st.capture==!!te&&st.ha==fe)return _t}return-1}var Ye="closure_lm_"+(1e6*Math.random()|0),De={};function jt(D,X,te,fe,_t){if(Array.isArray(X)){for(var st=0;st<X.length;st++)jt(D,X[st],te,fe,_t);return null}return te=Ft(te),D&&D[It]?D.K(X,te,$(fe)?!!fe.capture:!!fe,_t):St(D,X,te,!1,fe,_t)}function St(D,X,te,fe,_t,st){if(!X)throw Error("Invalid event type");var ur=$(_t)?!!_t.capture:!!_t,Tn=mr(D);if(Tn||(D[Ye]=Tn=new _e(D)),te=Tn.add(X,te,fe,ur,st),te.proxy)return te;if(fe=Zt(),te.proxy=fe,fe.src=D,fe.listener=te,D.addEventListener)fr||(_t=ur),_t===void 0&&(_t=!1),D.addEventListener(X.toString(),fe,_t);else if(D.attachEvent)D.attachEvent(nr(X.toString()),fe);else if(D.addListener&&D.removeListener)D.addListener(fe);else throw Error("addEventListener and attachEvent are unavailable.");return te}function Zt(){function D(te){return X.call(D.src,D.listener,te)}const X=Kt;return D}function Dt(D,X,te,fe,_t){if(Array.isArray(X))for(var st=0;st<X.length;st++)Dt(D,X[st],te,fe,_t);else fe=$(fe)?!!fe.capture:!!fe,te=Ft(te),D&&D[It]?(D=D.i,X=String(X).toString(),X in D.g&&(st=D.g[X],te=Le(st,te,fe,_t),-1<te&&(wr(st[te]),Array.prototype.splice.call(st,te,1),st.length==0&&(delete D.g[X],D.h--)))):D&&(D=mr(D))&&(X=D.g[X.toString()],D=-1,X&&(D=Le(X,te,fe,_t)),(te=-1<D?X[D]:null)&&Wt(te))}function Wt(D){if(typeof D!="number"&&D&&!D.da){var X=D.src;if(X&&X[It])un(X.i,D);else{var te=D.type,fe=D.proxy;X.removeEventListener?X.removeEventListener(te,fe,D.capture):X.detachEvent?X.detachEvent(nr(te),fe):X.addListener&&X.removeListener&&X.removeListener(fe),(te=mr(X))?(un(te,D),te.h==0&&(te.src=null,X[Ye]=null)):wr(D)}}}function nr(D){return D in De?De[D]:De[D]="on"+D}function Kt(D,X){if(D.da)D=!0;else{X=new li(X,this);var te=D.listener,fe=D.ha||D.src;D.fa&&Wt(D),D=te.call(fe,X)}return D}function mr(D){return D=D[Ye],D instanceof _e?D:null}var Ar="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ft(D){return typeof D=="function"?D:(D[Ar]||(D[Ar]=function(X){return D.handleEvent(X)}),D[Ar])}function Ir(){yn.call(this),this.i=new _e(this),this.M=this,this.F=null}He(Ir,yn),Ir.prototype[It]=!0,Ir.prototype.removeEventListener=function(D,X,te,fe){Dt(this,D,X,te,fe)};function Sr(D,X){var te,fe=D.F;if(fe)for(te=[];fe;fe=fe.F)te.push(fe);if(D=D.M,fe=X.type||X,typeof X=="string")X=new kt(X,D);else if(X instanceof kt)X.target=X.target||D;else{var _t=X;X=new kt(fe,D),Je(X,_t)}if(_t=!0,te)for(var st=te.length-1;0<=st;st--){var ur=X.g=te[st];_t=tn(ur,fe,!0,X)&&_t}if(ur=X.g=D,_t=tn(ur,fe,!0,X)&&_t,_t=tn(ur,fe,!1,X)&&_t,te)for(st=0;st<te.length;st++)ur=X.g=te[st],_t=tn(ur,fe,!1,X)&&_t}Ir.prototype.N=function(){if(Ir.aa.N.call(this),this.i){var D=this.i,X;for(X in D.g){for(var te=D.g[X],fe=0;fe<te.length;fe++)wr(te[fe]);delete D.g[X],D.h--}}this.F=null},Ir.prototype.K=function(D,X,te,fe){return this.i.add(String(D),X,!1,te,fe)},Ir.prototype.L=function(D,X,te,fe){return this.i.add(String(D),X,!0,te,fe)};function tn(D,X,te,fe){if(X=D.i.g[String(X)],!X)return!0;X=X.concat();for(var _t=!0,st=0;st<X.length;++st){var ur=X[st];if(ur&&!ur.da&&ur.capture==te){var Tn=ur.listener,cr=ur.ha||ur.src;ur.fa&&un(D.i,ur),_t=Tn.call(cr,fe)!==!1&&_t}}return _t&&!fe.defaultPrevented}function Xr(D,X,te){if(typeof D=="function")te&&(D=ae(D,te));else if(D&&typeof D.handleEvent=="function")D=ae(D.handleEvent,D);else throw Error("Invalid listener argument");return 2147483647<Number(X)?-1:L.setTimeout(D,X||0)}function vn(D){D.g=Xr(()=>{D.g=null,D.i&&(D.i=!1,vn(D))},D.l);const X=D.h;D.h=null,D.m.apply(null,X)}class xi extends yn{constructor(X,te){super(),this.m=X,this.l=te,this.h=null,this.i=!1,this.g=null}j(X){this.h=arguments,this.g?this.i=!0:vn(this)}N(){super.N(),this.g&&(L.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ii(D){yn.call(this),this.h=D,this.g={}}He(Ii,yn);var yo=[];function eo(D){qt(D.g,function(X,te){this.g.hasOwnProperty(te)&&Wt(X)},D),D.g={}}Ii.prototype.N=function(){Ii.aa.N.call(this),eo(this)},Ii.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var co=L.JSON.stringify,Mi=L.JSON.parse,fi=class{stringify(D){return L.JSON.stringify(D,void 0)}parse(D){return L.JSON.parse(D,void 0)}};function ls(){}ls.prototype.h=null;function nn(D){return D.h||(D.h=D.i())}function Vo(){}var Fs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function to(){kt.call(this,"d")}He(to,kt);function Co(){kt.call(this,"c")}He(Co,kt);var Ro={},Ns=null;function Vs(){return Ns=Ns||new Ir}Ro.La="serverreachability";function Us(D){kt.call(this,Ro.La,D)}He(Us,kt);function nt(D){const X=Vs();Sr(X,new Us(X))}Ro.STAT_EVENT="statevent";function ne(D,X){kt.call(this,Ro.STAT_EVENT,D),this.stat=X}He(ne,kt);function oe(D){const X=Vs();Sr(X,new ne(X,D))}Ro.Ma="timingevent";function ve(D,X){kt.call(this,Ro.Ma,D),this.size=X}He(ve,kt);function Ce(D,X){if(typeof D!="function")throw Error("Fn must not be null and must be a function");return L.setTimeout(function(){D()},X)}function Ie(){this.g=!0}Ie.prototype.xa=function(){this.g=!1};function Ue(D,X,te,fe,_t,st){D.info(function(){if(D.g)if(st)for(var ur="",Tn=st.split("&"),cr=0;cr<Tn.length;cr++){var Sn=Tn[cr].split("=");if(1<Sn.length){var Fi=Sn[0];Sn=Sn[1];var Gi=Fi.split("_");ur=2<=Gi.length&&Gi[1]=="type"?ur+(Fi+"="+Sn+"&"):ur+(Fi+"=redacted&")}}else ur=null;else ur=st;return"XMLHTTP REQ ("+fe+") [attempt "+_t+"]: "+X+`
`+te+`
`+ur})}function ot(D,X,te,fe,_t,st,ur){D.info(function(){return"XMLHTTP RESP ("+fe+") [ attempt "+_t+"]: "+X+`
`+te+`
`+st+" "+ur})}function We(D,X,te,fe){D.info(function(){return"XMLHTTP TEXT ("+X+"): "+ut(D,te)+(fe?" "+fe:"")})}function it(D,X){D.info(function(){return"TIMEOUT: "+X})}Ie.prototype.info=function(){};function ut(D,X){if(!D.g)return X;if(!X)return null;try{var te=JSON.parse(X);if(te){for(D=0;D<te.length;D++)if(Array.isArray(te[D])){var fe=te[D];if(!(2>fe.length)){var _t=fe[1];if(Array.isArray(_t)&&!(1>_t.length)){var st=_t[0];if(st!="noop"&&st!="stop"&&st!="close")for(var ur=1;ur<_t.length;ur++)_t[ur]=""}}}}return co(te)}catch{return X}}var at={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},At={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Gt;function Ht(){}He(Ht,ls),Ht.prototype.g=function(){return new XMLHttpRequest},Ht.prototype.i=function(){return{}},Gt=new Ht;function vr(D,X,te,fe){this.j=D,this.i=X,this.l=te,this.R=fe||1,this.U=new Ii(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Er}function Er(){this.i=null,this.g="",this.h=!1}var Rr={},br={};function on(D,X,te){D.L=1,D.v=qs(uo(X)),D.m=te,D.P=!0,pn(D,null)}function pn(D,X){D.F=Date.now(),Bn(D),D.A=uo(D.v);var te=D.A,fe=D.R;Array.isArray(fe)||(fe=[String(fe)]),xr(te.i,"t",fe),D.C=0,te=D.j.J,D.h=new Er,D.g=Js(D.j,te?X:null,!D.m),0<D.O&&(D.M=new xi(ae(D.Y,D,D.g),D.O)),X=D.U,te=D.g,fe=D.ca;var _t="readystatechange";Array.isArray(_t)||(_t&&(yo[0]=_t.toString()),_t=yo);for(var st=0;st<_t.length;st++){var ur=jt(te,_t[st],fe||X.handleEvent,!1,X.h||X);if(!ur)break;X.g[ur.key]=ur}X=D.H?be(D.H):{},D.m?(D.u||(D.u="POST"),X["Content-Type"]="application/x-www-form-urlencoded",D.g.ea(D.A,D.u,D.m,X)):(D.u="GET",D.g.ea(D.A,D.u,null,X)),nt(),Ue(D.i,D.u,D.A,D.l,D.R,D.m)}vr.prototype.ca=function(D){D=D.target;const X=this.M;X&&Si(D)==3?X.j():this.Y(D)},vr.prototype.Y=function(D){try{if(D==this.g)e:{const Gi=Si(this.g);var X=this.g.Ba();const xo=this.g.Z();if(!(3>Gi)&&(Gi!=3||this.g&&(this.h.h||this.g.oa()||Xi(this.g)))){this.J||Gi!=4||X==7||(X==8||0>=xo?nt(3):nt(2)),mi(this);var te=this.g.Z();this.X=te;t:if(Or(this)){var fe=Xi(this.g);D="";var _t=fe.length,st=Si(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ji(this),gi(this);var ur="";break t}this.h.i=new L.TextDecoder}for(X=0;X<_t;X++)this.h.h=!0,D+=this.h.i.decode(fe[X],{stream:!(st&&X==_t-1)});fe.length=0,this.h.g+=D,this.C=0,ur=this.h.g}else ur=this.g.oa();if(this.o=te==200,ot(this.i,this.u,this.A,this.l,this.R,Gi,te),this.o){if(this.T&&!this.K){t:{if(this.g){var Tn,cr=this.g;if((Tn=cr.g?cr.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!mt(Tn)){var Sn=Tn;break t}}Sn=null}if(te=Sn)We(this.i,this.l,te,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Uo(this,te);else{this.o=!1,this.s=3,oe(12),ji(this),gi(this);break e}}if(this.P){te=!0;let Ci;for(;!this.J&&this.C<ur.length;)if(Ci=mn(this,ur),Ci==br){Gi==4&&(this.s=4,oe(14),te=!1),We(this.i,this.l,null,"[Incomplete Response]");break}else if(Ci==Rr){this.s=4,oe(15),We(this.i,this.l,ur,"[Invalid Chunk]"),te=!1;break}else We(this.i,this.l,Ci,null),Uo(this,Ci);if(Or(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Gi!=4||ur.length!=0||this.h.h||(this.s=1,oe(16),te=!1),this.o=this.o&&te,!te)We(this.i,this.l,ur,"[Invalid Chunked Response]"),ji(this),gi(this);else if(0<ur.length&&!this.W){this.W=!0;var Fi=this.j;Fi.g==this&&Fi.ba&&!Fi.M&&(Fi.j.info("Great, no buffering proxy detected. Bytes received: "+ur.length),Wo(Fi),Fi.M=!0,oe(11))}}else We(this.i,this.l,ur,null),Uo(this,ur);Gi==4&&ji(this),this.o&&!this.J&&(Gi==4?oo(this.j,this):(this.o=!1,Bn(this)))}else io(this.g),te==400&&0<ur.indexOf("Unknown SID")?(this.s=3,oe(12)):(this.s=0,oe(13)),ji(this),gi(this)}}}catch{}finally{}};function Or(D){return D.g?D.u=="GET"&&D.L!=2&&D.j.Ca:!1}function mn(D,X){var te=D.C,fe=X.indexOf(`
`,te);return fe==-1?br:(te=Number(X.substring(te,fe)),isNaN(te)?Rr:(fe+=1,fe+te>X.length?br:(X=X.slice(fe,fe+te),D.C=fe+te,X)))}vr.prototype.cancel=function(){this.J=!0,ji(this)};function Bn(D){D.S=Date.now()+D.I,pi(D,D.I)}function pi(D,X){if(D.B!=null)throw Error("WatchDog timer not null");D.B=Ce(ae(D.ba,D),X)}function mi(D){D.B&&(L.clearTimeout(D.B),D.B=null)}vr.prototype.ba=function(){this.B=null;const D=Date.now();0<=D-this.S?(it(this.i,this.A),this.L!=2&&(nt(),oe(17)),ji(this),this.s=2,gi(this)):pi(this,this.S-D)};function gi(D){D.j.G==0||D.J||oo(D.j,D)}function ji(D){mi(D);var X=D.M;X&&typeof X.ma=="function"&&X.ma(),D.M=null,eo(D.U),D.g&&(X=D.g,D.g=null,X.abort(),X.ma())}function Uo(D,X){try{var te=D.j;if(te.G!=0&&(te.g==D||$s(te.h,D))){if(!D.K&&$s(te.h,D)&&te.G==3){try{var fe=te.Da.g.parse(X)}catch{fe=null}if(Array.isArray(fe)&&fe.length==3){var _t=fe;if(_t[0]==0){e:if(!te.u){if(te.g)if(te.g.F+3e3<D.F)ll(te),qi(te);else break e;Va(te),oe(18)}}else te.za=_t[1],0<te.za-te.T&&37500>_t[2]&&te.F&&te.v==0&&!te.C&&(te.C=Ce(ae(te.Za,te),6e3));if(1>=js(te.h)&&te.ca){try{te.ca()}catch{}te.ca=void 0}}else Oo(te,11)}else if((D.K||te.g==D)&&ll(te),!mt(X))for(_t=te.Da.g.parse(X),X=0;X<_t.length;X++){let Sn=_t[X];if(te.T=Sn[0],Sn=Sn[1],te.G==2)if(Sn[0]=="c"){te.K=Sn[1],te.ia=Sn[2];const Fi=Sn[3];Fi!=null&&(te.la=Fi,te.j.info("VER="+te.la));const Gi=Sn[4];Gi!=null&&(te.Aa=Gi,te.j.info("SVER="+te.Aa));const xo=Sn[5];xo!=null&&typeof xo=="number"&&0<xo&&(fe=1.5*xo,te.L=fe,te.j.info("backChannelRequestTimeoutMs_="+fe)),fe=te;const Ci=D.g;if(Ci){const ti=Ci.g?Ci.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ti){var st=fe.h;st.g||ti.indexOf("spdy")==-1&&ti.indexOf("quic")==-1&&ti.indexOf("h2")==-1||(st.j=st.l,st.g=new Set,st.h&&(ol(st,st.h),st.h=null))}if(fe.D){const $a=Ci.g?Ci.g.getResponseHeader("X-HTTP-Session-Id"):null;$a&&(fe.ya=$a,$n(fe.I,fe.D,$a))}}te.G=3,te.l&&te.l.ua(),te.ba&&(te.R=Date.now()-D.F,te.j.info("Handshake RTT: "+te.R+"ms")),fe=te;var ur=D;if(fe.qa=Ys(fe,fe.J?fe.ia:null,fe.W),ur.K){Ml(fe.h,ur);var Tn=ur,cr=fe.L;cr&&(Tn.I=cr),Tn.B&&(mi(Tn),Bn(Tn)),fe.g=ur}else Ks(fe);0<te.i.length&&yi(te)}else Sn[0]!="stop"&&Sn[0]!="close"||Oo(te,7);else te.G==3&&(Sn[0]=="stop"||Sn[0]=="close"?Sn[0]=="stop"?Oo(te,7):ii(te):Sn[0]!="noop"&&te.l&&te.l.ta(Sn),te.v=0)}}nt(4)}catch{}}var Cs=class{constructor(D,X){this.g=D,this.map=X}};function ko(D){this.l=D||10,L.PerformanceNavigationTiming?(D=L.performance.getEntriesByType("navigation"),D=0<D.length&&(D[0].nextHopProtocol=="hq"||D[0].nextHopProtocol=="h2")):D=!!(L.chrome&&L.chrome.loadTimes&&L.chrome.loadTimes()&&L.chrome.loadTimes().wasFetchedViaSpdy),this.j=D?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function pa(D){return D.h?!0:D.g?D.g.size>=D.j:!1}function js(D){return D.h?1:D.g?D.g.size:0}function $s(D,X){return D.h?D.h==X:D.g?D.g.has(X):!1}function ol(D,X){D.g?D.g.add(X):D.h=X}function Ml(D,X){D.h&&D.h==X?D.h=null:D.g&&D.g.has(X)&&D.g.delete(X)}ko.prototype.cancel=function(){if(this.i=La(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const D of this.g.values())D.cancel();this.g.clear()}};function La(D){if(D.h!=null)return D.i.concat(D.h.D);if(D.g!=null&&D.g.size!==0){let X=D.i;for(const te of D.g.values())X=X.concat(te.D);return X}return $e(D.i)}function Oa(D){if(D.V&&typeof D.V=="function")return D.V();if(typeof Map<"u"&&D instanceof Map||typeof Set<"u"&&D instanceof Set)return Array.from(D.values());if(typeof D=="string")return D.split("");if(s(D)){for(var X=[],te=D.length,fe=0;fe<te;fe++)X.push(D[fe]);return X}X=[],te=0;for(fe in D)X[te++]=D[fe];return X}function Po(D){if(D.na&&typeof D.na=="function")return D.na();if(!D.V||typeof D.V!="function"){if(typeof Map<"u"&&D instanceof Map)return Array.from(D.keys());if(!(typeof Set<"u"&&D instanceof Set)){if(s(D)||typeof D=="string"){var X=[];D=D.length;for(var te=0;te<D;te++)X.push(te);return X}X=[],te=0;for(const fe in D)X[te++]=fe;return X}}}function Mo(D,X){if(D.forEach&&typeof D.forEach=="function")D.forEach(X,void 0);else if(s(D)||typeof D=="string")Array.prototype.forEach.call(D,X,void 0);else for(var te=Po(D),fe=Oa(D),_t=fe.length,st=0;st<_t;st++)X.call(void 0,fe[st],te&&te[st],D)}var Do=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ci(D,X){if(D){D=D.split("&");for(var te=0;te<D.length;te++){var fe=D[te].indexOf("="),_t=null;if(0<=fe){var st=D[te].substring(0,fe);_t=D[te].substring(fe+1)}else st=D[te];X(st,_t?decodeURIComponent(_t.replace(/\+/g," ")):"")}}}function Zi(D){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,D instanceof Zi){this.h=D.h,ma(this,D.j),this.o=D.o,this.g=D.g,Ba(this,D.s),this.l=D.l;var X=D.i,te=new Gr;te.i=X.i,X.g&&(te.g=new Map(X.g),te.h=X.h),jo(this,te),this.m=D.m}else D&&(X=String(D).match(Do))?(this.h=!1,ma(this,X[1]||"",!0),this.o=sl(X[2]||""),this.g=sl(X[3]||"",!0),Ba(this,X[4]),this.l=sl(X[5]||"",!0),jo(this,X[6]||"",!0),this.m=sl(X[7]||"")):(this.h=!1,this.i=new Gr(null,this.h))}Zi.prototype.toString=function(){var D=[],X=this.j;X&&D.push($i(X,za,!0),":");var te=this.g;return(te||X=="file")&&(D.push("//"),(X=this.o)&&D.push($i(X,za,!0),"@"),D.push(encodeURIComponent(String(te)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),te=this.s,te!=null&&D.push(":",String(te))),(te=this.l)&&(this.g&&te.charAt(0)!="/"&&D.push("/"),D.push($i(te,te.charAt(0)=="/"?Dl:Fa,!0))),(te=this.i.toString())&&D.push("?",te),(te=this.m)&&D.push("#",$i(te,Ll)),D.join("")};function uo(D){return new Zi(D)}function ma(D,X,te){D.j=te?sl(X,!0):X,D.j&&(D.j=D.j.replace(/:$/,""))}function Ba(D,X){if(X){if(X=Number(X),isNaN(X)||0>X)throw Error("Bad port number "+X);D.s=X}else D.s=null}function jo(D,X,te){X instanceof Gr?(D.i=X,Gs(D.i,D.h)):(te||(X=$i(X,ga)),D.i=new Gr(X,D.h))}function $n(D,X,te){D.i.set(X,te)}function qs(D){return $n(D,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),D}function sl(D,X){return D?X?decodeURI(D.replace(/%25/g,"%2525")):decodeURIComponent(D):""}function $i(D,X,te){return typeof D=="string"?(D=encodeURI(D).replace(X,Rs),te&&(D=D.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),D):null}function Rs(D){return D=D.charCodeAt(0),"%"+(D>>4&15).toString(16)+(D&15).toString(16)}var za=/[#\/\?@]/g,Fa=/[#\?:]/g,Dl=/[#\?]/g,ga=/[#\?@]/g,Ll=/#/g;function Gr(D,X){this.h=this.g=null,this.i=D||null,this.j=!!X}function $o(D){D.g||(D.g=new Map,D.h=0,D.i&&ci(D.i,function(X,te){D.add(decodeURIComponent(X.replace(/\+/g," ")),te)}))}n=Gr.prototype,n.add=function(D,X){$o(this),this.i=null,D=cs(this,D);var te=this.g.get(D);return te||this.g.set(D,te=[]),te.push(X),this.h+=1,this};function an(D,X){$o(D),X=cs(D,X),D.g.has(X)&&(D.i=null,D.h-=D.g.get(X).length,D.g.delete(X))}function vo(D,X){return $o(D),X=cs(D,X),D.g.has(X)}n.forEach=function(D,X){$o(this),this.g.forEach(function(te,fe){te.forEach(function(_t){D.call(X,_t,fe,this)},this)},this)},n.na=function(){$o(this);const D=Array.from(this.g.values()),X=Array.from(this.g.keys()),te=[];for(let fe=0;fe<X.length;fe++){const _t=D[fe];for(let st=0;st<_t.length;st++)te.push(X[fe])}return te},n.V=function(D){$o(this);let X=[];if(typeof D=="string")vo(this,D)&&(X=X.concat(this.g.get(cs(this,D))));else{D=Array.from(this.g.values());for(let te=0;te<D.length;te++)X=X.concat(D[te])}return X},n.set=function(D,X){return $o(this),this.i=null,D=cs(this,D),vo(this,D)&&(this.h-=this.g.get(D).length),this.g.set(D,[X]),this.h+=1,this},n.get=function(D,X){return D?(D=this.V(D),0<D.length?String(D[0]):X):X};function xr(D,X,te){an(D,X),0<te.length&&(D.i=null,D.g.set(cs(D,X),$e(te)),D.h+=te.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const D=[],X=Array.from(this.g.keys());for(var te=0;te<X.length;te++){var fe=X[te];const st=encodeURIComponent(String(fe)),ur=this.V(fe);for(fe=0;fe<ur.length;fe++){var _t=st;ur[fe]!==""&&(_t+="="+encodeURIComponent(String(ur[fe]))),D.push(_t)}}return this.i=D.join("&")};function cs(D,X){return X=String(X),D.j&&(X=X.toLowerCase()),X}function Gs(D,X){X&&!D.j&&($o(D),D.i=null,D.g.forEach(function(te,fe){var _t=fe.toLowerCase();fe!=_t&&(an(this,fe),xr(this,_t,te))},D)),D.j=X}function _a(D,X){const te=new Ie;if(L.Image){const fe=new Image;fe.onload=we(qo,te,"TestLoadImage: loaded",!0,X,fe),fe.onerror=we(qo,te,"TestLoadImage: error",!1,X,fe),fe.onabort=we(qo,te,"TestLoadImage: abort",!1,X,fe),fe.ontimeout=we(qo,te,"TestLoadImage: timeout",!1,X,fe),L.setTimeout(function(){fe.ontimeout&&fe.ontimeout()},1e4),fe.src=D}else X(!1)}function us(D,X){const te=new Ie,fe=new AbortController,_t=setTimeout(()=>{fe.abort(),qo(te,"TestPingServer: timeout",!1,X)},1e4);fetch(D,{signal:fe.signal}).then(st=>{clearTimeout(_t),st.ok?qo(te,"TestPingServer: ok",!0,X):qo(te,"TestPingServer: server error",!1,X)}).catch(()=>{clearTimeout(_t),qo(te,"TestPingServer: error",!1,X)})}function qo(D,X,te,fe,_t){try{_t&&(_t.onload=null,_t.onerror=null,_t.onabort=null,_t.ontimeout=null),fe(te)}catch{}}function Go(){this.g=new fi}function er(D,X,te){const fe=te||"";try{Mo(D,function(_t,st){let ur=_t;$(_t)&&(ur=co(_t)),X.push(fe+st+"="+encodeURIComponent(ur))})}catch(_t){throw X.push(fe+"type="+encodeURIComponent("_badmap")),_t}}function Wr(D){this.l=D.Ub||null,this.j=D.eb||!1}He(Wr,ls),Wr.prototype.g=function(){return new Kr(this.l,this.j)},Wr.prototype.i=function(D){return function(){return D}}({});function Kr(D,X){Ir.call(this),this.D=D,this.o=X,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}He(Kr,Ir),n=Kr.prototype,n.open=function(D,X){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=D,this.A=X,this.readyState=1,Hr(this)},n.send=function(D){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const X={headers:this.u,method:this.B,credentials:this.m,cache:void 0};D&&(X.body=D),(this.D||L).fetch(new Request(this.A,X)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ai(this)),this.readyState=0},n.Sa=function(D){if(this.g&&(this.l=D,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=D.headers,this.readyState=2,Hr(this)),this.g&&(this.readyState=3,Hr(this),this.g)))if(this.responseType==="arraybuffer")D.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof L.ReadableStream<"u"&&"body"in D){if(this.j=D.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ro(this)}else D.text().then(this.Ra.bind(this),this.ga.bind(this))};function ro(D){D.j.read().then(D.Pa.bind(D)).catch(D.ga.bind(D))}n.Pa=function(D){if(this.g){if(this.o&&D.value)this.response.push(D.value);else if(!this.o){var X=D.value?D.value:new Uint8Array(0);(X=this.v.decode(X,{stream:!D.done}))&&(this.response=this.responseText+=X)}D.done?Ai(this):Hr(this),this.readyState==3&&ro(this)}},n.Ra=function(D){this.g&&(this.response=this.responseText=D,Ai(this))},n.Qa=function(D){this.g&&(this.response=D,Ai(this))},n.ga=function(){this.g&&Ai(this)};function Ai(D){D.readyState=4,D.l=null,D.j=null,D.v=null,Hr(D)}n.setRequestHeader=function(D,X){this.u.append(D,X)},n.getResponseHeader=function(D){return this.h&&this.h.get(D.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const D=[],X=this.h.entries();for(var te=X.next();!te.done;)te=te.value,D.push(te[0]+": "+te[1]),te=X.next();return D.join(`\r
`)};function Hr(D){D.onreadystatechange&&D.onreadystatechange.call(D)}Object.defineProperty(Kr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(D){this.m=D?"include":"same-origin"}});function al(D){let X="";return qt(D,function(te,fe){X+=fe,X+=":",X+=te,X+=`\r
`}),X}function Hs(D,X,te){e:{for(fe in te){var fe=!1;break e}fe=!0}fe||(te=al(te),typeof D=="string"?te!=null&&encodeURIComponent(String(te)):$n(D,X,te))}function Pn(D){Ir.call(this),this.headers=new Map,this.o=D||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}He(Pn,Ir);var _i=/^https?$/i,ei=["POST","PUT"];n=Pn.prototype,n.Ha=function(D){this.J=D},n.ea=function(D,X,te,fe){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+D);X=X?X.toUpperCase():"GET",this.D=D,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Gt.g(),this.v=this.o?nn(this.o):nn(Gt),this.g.onreadystatechange=ae(this.Ea,this);try{this.B=!0,this.g.open(X,String(D),!0),this.B=!1}catch(st){dc(this,st);return}if(D=te||"",te=new Map(this.headers),fe)if(Object.getPrototypeOf(fe)===Object.prototype)for(var _t in fe)te.set(_t,fe[_t]);else if(typeof fe.keys=="function"&&typeof fe.get=="function")for(const st of fe.keys())te.set(st,fe.get(st));else throw Error("Unknown input type for opt_headers: "+String(fe));fe=Array.from(te.keys()).find(st=>st.toLowerCase()=="content-type"),_t=L.FormData&&D instanceof L.FormData,!(0<=Array.prototype.indexOf.call(ei,X,void 0))||fe||_t||te.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[st,ur]of te)this.g.setRequestHeader(st,ur);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Na(this),this.u=!0,this.g.send(D),this.u=!1}catch(st){dc(this,st)}};function dc(D,X){D.h=!1,D.g&&(D.j=!0,D.g.abort(),D.j=!1),D.l=X,D.m=5,Ws(D),ho(D)}function Ws(D){D.A||(D.A=!0,Sr(D,"complete"),Sr(D,"error"))}n.abort=function(D){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=D||7,Sr(this,"complete"),Sr(this,"abort"),ho(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ho(this,!0)),Pn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Zs(this):this.bb())},n.bb=function(){Zs(this)};function Zs(D){if(D.h&&typeof I<"u"&&(!D.v[1]||Si(D)!=4||D.Z()!=2)){if(D.u&&Si(D)==4)Xr(D.Ea,0,D);else if(Sr(D,"readystatechange"),Si(D)==4){D.h=!1;try{const ur=D.Z();e:switch(ur){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var X=!0;break e;default:X=!1}var te;if(!(te=X)){var fe;if(fe=ur===0){var _t=String(D.D).match(Do)[1]||null;!_t&&L.self&&L.self.location&&(_t=L.self.location.protocol.slice(0,-1)),fe=!_i.test(_t?_t.toLowerCase():"")}te=fe}if(te)Sr(D,"complete"),Sr(D,"success");else{D.m=6;try{var st=2<Si(D)?D.g.statusText:""}catch{st=""}D.l=st+" ["+D.Z()+"]",Ws(D)}}finally{ho(D)}}}}function ho(D,X){if(D.g){Na(D);const te=D.g,fe=D.v[0]?()=>{}:null;D.g=null,D.v=null,X||Sr(D,"ready");try{te.onreadystatechange=fe}catch{}}}function Na(D){D.I&&(L.clearTimeout(D.I),D.I=null)}n.isActive=function(){return!!this.g};function Si(D){return D.g?D.g.readyState:0}n.Z=function(){try{return 2<Si(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(D){if(this.g){var X=this.g.responseText;return D&&X.indexOf(D)==0&&(X=X.substring(D.length)),Mi(X)}};function Xi(D){try{if(!D.g)return null;if("response"in D.g)return D.g.response;switch(D.H){case"":case"text":return D.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in D.g)return D.g.mozResponseArrayBuffer}return null}catch{return null}}function io(D){const X={};D=(D.g&&2<=Si(D)&&D.g.getAllResponseHeaders()||"").split(`\r
`);for(let fe=0;fe<D.length;fe++){if(mt(D[fe]))continue;var te=Me(D[fe]);const _t=te[0];if(te=te[1],typeof te!="string")continue;te=te.trim();const st=X[_t]||[];X[_t]=st,st.push(te)}qe(X,function(fe){return fe.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ya(D,X,te){return te&&te.internalChannelParams&&te.internalChannelParams[D]||X}function hs(D){this.Aa=0,this.i=[],this.j=new Ie,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ya("failFast",!1,D),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ya("baseRetryDelayMs",5e3,D),this.cb=ya("retryDelaySeedMs",1e4,D),this.Wa=ya("forwardChannelMaxRetries",2,D),this.wa=ya("forwardChannelRequestTimeoutMs",2e4,D),this.pa=D&&D.xmlHttpFactory||void 0,this.Xa=D&&D.Tb||void 0,this.Ca=D&&D.useFetchStreams||!1,this.L=void 0,this.J=D&&D.supportsCrossDomainXhr||!1,this.K="",this.h=new ko(D&&D.concurrentRequestLimit),this.Da=new Go,this.P=D&&D.fastHandshake||!1,this.O=D&&D.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=D&&D.Rb||!1,D&&D.xa&&this.j.xa(),D&&D.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&D&&D.detectBufferingProxy||!1,this.ja=void 0,D&&D.longPollingTimeout&&0<D.longPollingTimeout&&(this.ja=D.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=hs.prototype,n.la=8,n.G=1,n.connect=function(D,X,te,fe){oe(0),this.W=D,this.H=X||{},te&&fe!==void 0&&(this.H.OSID=te,this.H.OAID=fe),this.F=this.X,this.I=Ys(this,null,this.W),yi(this)};function ii(D){if(Lo(D),D.G==3){var X=D.U++,te=uo(D.I);if($n(te,"SID",D.K),$n(te,"RID",X),$n(te,"TYPE","terminate"),Ho(D,te),X=new vr(D,D.j,X),X.L=2,X.v=qs(uo(te)),te=!1,L.navigator&&L.navigator.sendBeacon)try{te=L.navigator.sendBeacon(X.v.toString(),"")}catch{}!te&&L.Image&&(new Image().src=X.v,te=!0),te||(X.g=Js(X.j,null),X.g.ea(X.v)),X.F=Date.now(),Bn(X)}Ua(D)}function qi(D){D.g&&(Wo(D),D.g.cancel(),D.g=null)}function Lo(D){qi(D),D.u&&(L.clearTimeout(D.u),D.u=null),ll(D),D.h.cancel(),D.s&&(typeof D.s=="number"&&L.clearTimeout(D.s),D.s=null)}function yi(D){if(!pa(D.h)&&!D.s){D.s=!0;var X=D.Ga;Cr||dr(),Vr||(Cr(),Vr=!0),On.add(X,D),D.B=0}}function fc(D,X){return js(D.h)>=D.h.j-(D.s?1:0)?!1:D.s?(D.i=X.D.concat(D.i),!0):D.G==1||D.G==2||D.B>=(D.Va?0:D.Wa)?!1:(D.s=Ce(ae(D.Ga,D,X),Yc(D,D.B)),D.B++,!0)}n.Ga=function(D){if(this.s)if(this.s=null,this.G==1){if(!D){this.U=Math.floor(1e5*Math.random()),D=this.U++;const _t=new vr(this,this.j,D);let st=this.o;if(this.S&&(st?(st=be(st),Je(st,this.S)):st=this.S),this.m!==null||this.O||(_t.H=st,st=null),this.P)e:{for(var X=0,te=0;te<this.i.length;te++){t:{var fe=this.i[te];if("__data__"in fe.map&&(fe=fe.map.__data__,typeof fe=="string")){fe=fe.length;break t}fe=void 0}if(fe===void 0)break;if(X+=fe,4096<X){X=te;break e}if(X===4096||te===this.i.length-1){X=te+1;break e}}X=1e3}else X=1e3;X=Xs(this,_t,X),te=uo(this.I),$n(te,"RID",D),$n(te,"CVER",22),this.D&&$n(te,"X-HTTP-Session-Id",this.D),Ho(this,te),st&&(this.O?X="headers="+encodeURIComponent(String(al(st)))+"&"+X:this.m&&Hs(te,this.m,st)),ol(this.h,_t),this.Ua&&$n(te,"TYPE","init"),this.P?($n(te,"$req",X),$n(te,"SID","null"),_t.T=!0,on(_t,te,null)):on(_t,te,X),this.G=2}}else this.G==3&&(D?Di(this,D):this.i.length==0||pa(this.h)||Di(this))};function Di(D,X){var te;X?te=X.l:te=D.U++;const fe=uo(D.I);$n(fe,"SID",D.K),$n(fe,"RID",te),$n(fe,"AID",D.T),Ho(D,fe),D.m&&D.o&&Hs(fe,D.m,D.o),te=new vr(D,D.j,te,D.B+1),D.m===null&&(te.H=D.o),X&&(D.i=X.D.concat(D.i)),X=Xs(D,te,1e3),te.I=Math.round(.5*D.wa)+Math.round(.5*D.wa*Math.random()),ol(D.h,te),on(te,fe,X)}function Ho(D,X){D.H&&qt(D.H,function(te,fe){$n(X,fe,te)}),D.l&&Mo({},function(te,fe){$n(X,fe,te)})}function Xs(D,X,te){te=Math.min(D.i.length,te);var fe=D.l?ae(D.l.Na,D.l,D):null;e:{var _t=D.i;let st=-1;for(;;){const ur=["count="+te];st==-1?0<te?(st=_t[0].g,ur.push("ofs="+st)):st=0:ur.push("ofs="+st);let Tn=!0;for(let cr=0;cr<te;cr++){let Sn=_t[cr].g;const Fi=_t[cr].map;if(Sn-=st,0>Sn)st=Math.max(0,_t[cr].g-100),Tn=!1;else try{er(Fi,ur,"req"+Sn+"_")}catch{fe&&fe(Fi)}}if(Tn){fe=ur.join("&");break e}}}return D=D.i.splice(0,te),X.D=D,fe}function Ks(D){if(!D.g&&!D.u){D.Y=1;var X=D.Fa;Cr||dr(),Vr||(Cr(),Vr=!0),On.add(X,D),D.v=0}}function Va(D){return D.g||D.u||3<=D.v?!1:(D.Y++,D.u=Ce(ae(D.Fa,D),Yc(D,D.v)),D.v++,!0)}n.Fa=function(){if(this.u=null,Kc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var D=2*this.R;this.j.info("BP detection timer enabled: "+D),this.A=Ce(ae(this.ab,this),D)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,oe(10),qi(this),Kc(this))};function Wo(D){D.A!=null&&(L.clearTimeout(D.A),D.A=null)}function Kc(D){D.g=new vr(D,D.j,"rpc",D.Y),D.m===null&&(D.g.H=D.o),D.g.O=0;var X=uo(D.qa);$n(X,"RID","rpc"),$n(X,"SID",D.K),$n(X,"AID",D.T),$n(X,"CI",D.F?"0":"1"),!D.F&&D.ja&&$n(X,"TO",D.ja),$n(X,"TYPE","xmlhttp"),Ho(D,X),D.m&&D.o&&Hs(X,D.m,D.o),D.L&&(D.g.I=D.L);var te=D.g;D=D.ia,te.L=1,te.v=qs(uo(X)),te.m=null,te.P=!0,pn(te,D)}n.Za=function(){this.C!=null&&(this.C=null,qi(this),Va(this),oe(19))};function ll(D){D.C!=null&&(L.clearTimeout(D.C),D.C=null)}function oo(D,X){var te=null;if(D.g==X){ll(D),Wo(D),D.g=null;var fe=2}else if($s(D.h,X))te=X.D,Ml(D.h,X),fe=1;else return;if(D.G!=0){if(X.o)if(fe==1){te=X.m?X.m.length:0,X=Date.now()-X.F;var _t=D.B;fe=Vs(),Sr(fe,new ve(fe,te)),yi(D)}else Ks(D);else if(_t=X.s,_t==3||_t==0&&0<X.X||!(fe==1&&fc(D,X)||fe==2&&Va(D)))switch(te&&0<te.length&&(X=D.h,X.i=X.i.concat(te)),_t){case 1:Oo(D,5);break;case 4:Oo(D,10);break;case 3:Oo(D,6);break;default:Oo(D,2)}}}function Yc(D,X){let te=D.Ta+Math.floor(Math.random()*D.cb);return D.isActive()||(te*=2),te*X}function Oo(D,X){if(D.j.info("Error code "+X),X==2){var te=ae(D.fb,D),fe=D.Xa;const _t=!fe;fe=new Zi(fe||"//www.google.com/images/cleardot.gif"),L.location&&L.location.protocol=="http"||ma(fe,"https"),qs(fe),_t?_a(fe.toString(),te):us(fe.toString(),te)}else oe(2);D.G=0,D.l&&D.l.sa(X),Ua(D),Lo(D)}n.fb=function(D){D?(this.j.info("Successfully pinged google.com"),oe(2)):(this.j.info("Failed to ping google.com"),oe(1))};function Ua(D){if(D.G=0,D.ka=[],D.l){const X=La(D.h);(X.length!=0||D.i.length!=0)&&(Ne(D.ka,X),Ne(D.ka,D.i),D.h.i.length=0,$e(D.i),D.i.length=0),D.l.ra()}}function Ys(D,X,te){var fe=te instanceof Zi?uo(te):new Zi(te);if(fe.g!="")X&&(fe.g=X+"."+fe.g),Ba(fe,fe.s);else{var _t=L.location;fe=_t.protocol,X=X?X+"."+_t.hostname:_t.hostname,_t=+_t.port;var st=new Zi(null);fe&&ma(st,fe),X&&(st.g=X),_t&&Ba(st,_t),te&&(st.l=te),fe=st}return te=D.D,X=D.ya,te&&X&&$n(fe,te,X),$n(fe,"VER",D.la),Ho(D,fe),fe}function Js(D,X,te){if(X&&!D.J)throw Error("Can't create secondary domain capable XhrIo object.");return X=D.Ca&&!D.pa?new Pn(new Wr({eb:te})):new Pn(D.pa),X.Ha(D.J),X}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ja(){}n=ja.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ds(){}ds.prototype.g=function(D,X){return new zi(D,X)};function zi(D,X){Ir.call(this),this.g=new hs(X),this.l=D,this.h=X&&X.messageUrlParams||null,D=X&&X.messageHeaders||null,X&&X.clientProtocolHeaderRequired&&(D?D["X-Client-Protocol"]="webchannel":D={"X-Client-Protocol":"webchannel"}),this.g.o=D,D=X&&X.initMessageHeaders||null,X&&X.messageContentType&&(D?D["X-WebChannel-Content-Type"]=X.messageContentType:D={"X-WebChannel-Content-Type":X.messageContentType}),X&&X.va&&(D?D["X-WebChannel-Client-Profile"]=X.va:D={"X-WebChannel-Client-Profile":X.va}),this.g.S=D,(D=X&&X.Sb)&&!mt(D)&&(this.g.m=D),this.v=X&&X.supportsCrossDomainXhr||!1,this.u=X&&X.sendRawJson||!1,(X=X&&X.httpSessionIdParam)&&!mt(X)&&(this.g.D=X,D=this.h,D!==null&&X in D&&(D=this.h,X in D&&delete D[X])),this.j=new bo(this)}He(zi,Ir),zi.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},zi.prototype.close=function(){ii(this.g)},zi.prototype.o=function(D){var X=this.g;if(typeof D=="string"){var te={};te.__data__=D,D=te}else this.u&&(te={},te.__data__=co(D),D=te);X.i.push(new Cs(X.Ya++,D)),X.G==3&&yi(X)},zi.prototype.N=function(){this.g.l=null,delete this.j,ii(this.g),delete this.g,zi.aa.N.call(this)};function Jc(D){to.call(this),D.__headers__&&(this.headers=D.__headers__,this.statusCode=D.__status__,delete D.__headers__,delete D.__status__);var X=D.__sm__;if(X){e:{for(const te in X){D=te;break e}D=void 0}(this.i=D)&&(D=this.i,X=X!==null&&D in X?X[D]:void 0),this.data=X}else this.data=D}He(Jc,to);function va(){Co.call(this),this.status=1}He(va,Co);function bo(D){this.g=D}He(bo,ja),bo.prototype.ua=function(){Sr(this.g,"a")},bo.prototype.ta=function(D){Sr(this.g,new Jc(D))},bo.prototype.sa=function(D){Sr(this.g,new va)},bo.prototype.ra=function(){Sr(this.g,"b")},ds.prototype.createWebChannel=ds.prototype.g,zi.prototype.send=zi.prototype.o,zi.prototype.open=zi.prototype.m,zi.prototype.close=zi.prototype.close,oM=function(){return new ds},iM=function(){return Vs()},nM=Ro,n1={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},at.NO_ERROR=0,at.TIMEOUT=8,at.HTTP_ERROR=6,jy=at,At.COMPLETE="complete",rM=At,Vo.EventType=Fs,Fs.OPEN="a",Fs.CLOSE="b",Fs.ERROR="c",Fs.MESSAGE="d",Ir.prototype.listen=Ir.prototype.K,zm=Vo,tM=Wr,Pn.prototype.listenOnce=Pn.prototype.L,Pn.prototype.getLastError=Pn.prototype.Ka,Pn.prototype.getLastErrorCode=Pn.prototype.Ba,Pn.prototype.getStatus=Pn.prototype.Z,Pn.prototype.getResponseJson=Pn.prototype.Oa,Pn.prototype.getResponseText=Pn.prototype.oa,Pn.prototype.send=Pn.prototype.ea,Pn.prototype.setWithCredentials=Pn.prototype.Ha,eM=Pn}).apply(typeof Ey<"u"?Ey:typeof self<"u"?self:typeof window<"u"?window:{});const aC="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}xs.UNAUTHENTICATED=new xs(null),xs.GOOGLE_CREDENTIALS=new xs("google-credentials-uid"),xs.FIRST_PARTY=new xs("first-party-uid"),xs.MOCK_USER=new xs("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jf="10.13.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ld=new iw("@firebase/firestore");function Rm(){return ld.logLevel}function Fr(n,...e){if(ld.logLevel<=Wn.DEBUG){const i=e.map(yw);ld.debug(`Firestore (${Jf}): ${n}`,...i)}}function qc(n,...e){if(ld.logLevel<=Wn.ERROR){const i=e.map(yw);ld.error(`Firestore (${Jf}): ${n}`,...i)}}function Uf(n,...e){if(ld.logLevel<=Wn.WARN){const i=e.map(yw);ld.warn(`Firestore (${Jf}): ${n}`,...i)}}function yw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hn(n="Unexpected state"){const e=`FIRESTORE (${Jf}) INTERNAL ASSERTION FAILED: `+n;throw qc(e),new Error(e)}function Pi(n,e){n||hn()}function _n(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Dr extends Zc{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vc{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sM{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class UU{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(xs.UNAUTHENTICATED))}shutdown(){}}class jU{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class $U{constructor(e){this.t=e,this.currentUser=xs.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){let u=this.i;const g=s=>this.i!==u?(u=this.i,i(s)):Promise.resolve();let b=new Vc;this.o=()=>{this.i++,this.currentUser=this.u(),b.resolve(),b=new Vc,e.enqueueRetryable(()=>g(this.currentUser))};const I=()=>{const s=b;e.enqueueRetryable(async()=>{await s.promise,await g(this.currentUser)})},L=s=>{Fr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=s,this.auth.addAuthTokenListener(this.o),I()};this.t.onInit(s=>L(s)),setTimeout(()=>{if(!this.auth){const s=this.t.getImmediate({optional:!0});s?L(s):(Fr("FirebaseAuthCredentialsProvider","Auth not yet detected"),b.resolve(),b=new Vc)}},0),I()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(u=>this.i!==e?(Fr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):u?(Pi(typeof u.accessToken=="string"),new sM(u.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Pi(e===null||typeof e=="string"),new xs(e)}}class qU{constructor(e,i,u){this.l=e,this.h=i,this.P=u,this.type="FirstParty",this.user=xs.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class GU{constructor(e,i,u){this.l=e,this.h=i,this.P=u}getToken(){return Promise.resolve(new qU(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(xs.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class HU{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class WU{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,i){const u=b=>{b.error!=null&&Fr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${b.error.message}`);const I=b.token!==this.R;return this.R=b.token,Fr("FirebaseAppCheckTokenProvider",`Received ${I?"new":"existing"} token.`),I?i(b.token):Promise.resolve()};this.o=b=>{e.enqueueRetryable(()=>u(b))};const g=b=>{Fr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=b,this.appCheck.addTokenListener(this.o)};this.A.onInit(b=>g(b)),setTimeout(()=>{if(!this.appCheck){const b=this.A.getImmediate({optional:!0});b?g(b):Fr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(Pi(typeof i.token=="string"),this.R=i.token,new HU(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZU(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let u=0;u<n;u++)i[u]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=Math.floor(256/e.length)*e.length;let u="";for(;u.length<20;){const g=ZU(40);for(let b=0;b<g.length;++b)u.length<20&&g[b]<i&&(u+=e.charAt(g[b]%e.length))}return u}}function ri(n,e){return n<e?-1:n>e?1:0}function jf(n,e,i){return n.length===e.length&&n.every((u,g)=>i(u,e[g]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new Dr(Jt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Dr(Jt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<-62135596800)throw new Dr(Jt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Dr(Jt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ao.fromMillis(Date.now())}static fromDate(e){return Ao.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),u=Math.floor(1e6*(e-1e3*i));return new Ao(i,u)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ri(this.nanoseconds,e.nanoseconds):ri(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e){this.timestamp=e}static fromTimestamp(e){return new gn(e)}static min(){return new gn(new Ao(0,0))}static max(){return new gn(new Ao(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg{constructor(e,i,u){i===void 0?i=0:i>e.length&&hn(),u===void 0?u=e.length-i:u>e.length-i&&hn(),this.segments=e,this.offset=i,this.len=u}get length(){return this.len}isEqual(e){return fg.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof fg?e.forEach(u=>{i.push(u)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,u=this.limit();i<u;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const u=Math.min(e.length,i.length);for(let g=0;g<u;g++){const b=e.get(g),I=i.get(g);if(b<I)return-1;if(b>I)return 1}return e.length<i.length?-1:e.length>i.length?1:0}}class Ui extends fg{construct(e,i,u){return new Ui(e,i,u)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const u of e){if(u.indexOf("//")>=0)throw new Dr(Jt.INVALID_ARGUMENT,`Invalid segment (${u}). Paths must not contain // in them.`);i.push(...u.split("/").filter(g=>g.length>0))}return new Ui(i)}static emptyPath(){return new Ui([])}}const XU=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class is extends fg{construct(e,i,u){return new is(e,i,u)}static isValidIdentifier(e){return XU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),is.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new is(["__name__"])}static fromServerFormat(e){const i=[];let u="",g=0;const b=()=>{if(u.length===0)throw new Dr(Jt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(u),u=""};let I=!1;for(;g<e.length;){const L=e[g];if(L==="\\"){if(g+1===e.length)throw new Dr(Jt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const s=e[g+1];if(s!=="\\"&&s!=="."&&s!=="`")throw new Dr(Jt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);u+=s,g+=2}else L==="`"?(I=!I,g++):L!=="."||I?(u+=L,g++):(b(),g++)}if(b(),I)throw new Dr(Jt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new is(i)}static emptyPath(){return new is([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e){this.path=e}static fromPath(e){return new Jr(Ui.fromString(e))}static fromName(e){return new Jr(Ui.fromString(e).popFirst(5))}static empty(){return new Jr(Ui.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ui.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return Ui.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Jr(new Ui(e.slice()))}}function KU(n,e){const i=n.toTimestamp().seconds,u=n.toTimestamp().nanoseconds+1,g=gn.fromTimestamp(u===1e9?new Ao(i+1,0):new Ao(i,u));return new Ju(g,Jr.empty(),e)}function YU(n){return new Ju(n.readTime,n.key,-1)}class Ju{constructor(e,i,u){this.readTime=e,this.documentKey=i,this.largestBatchId=u}static min(){return new Ju(gn.min(),Jr.empty(),-1)}static max(){return new Ju(gn.max(),Jr.empty(),-1)}}function JU(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=Jr.comparator(n.documentKey,e.documentKey),i!==0?i:ri(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QU="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ej{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zg(n){if(n.code!==Jt.FAILED_PRECONDITION||n.message!==QU)throw n;Fr("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&hn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new ir((u,g)=>{this.nextCallback=b=>{this.wrapSuccess(e,b).next(u,g)},this.catchCallback=b=>{this.wrapFailure(i,b).next(u,g)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof ir?i:ir.resolve(i)}catch(i){return ir.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):ir.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):ir.reject(i)}static resolve(e){return new ir((i,u)=>{i(e)})}static reject(e){return new ir((i,u)=>{u(e)})}static waitFor(e){return new ir((i,u)=>{let g=0,b=0,I=!1;e.forEach(L=>{++g,L.next(()=>{++b,I&&b===g&&i()},s=>u(s))}),I=!0,b===g&&i()})}static or(e){let i=ir.resolve(!1);for(const u of e)i=i.next(g=>g?ir.resolve(g):u());return i}static forEach(e,i){const u=[];return e.forEach((g,b)=>{u.push(i.call(this,g,b))}),this.waitFor(u)}static mapArray(e,i){return new ir((u,g)=>{const b=e.length,I=new Array(b);let L=0;for(let s=0;s<b;s++){const $=s;i(e[$]).next(W=>{I[$]=W,++L,L===b&&u(I)},W=>g(W))}})}static doWhile(e,i){return new ir((u,g)=>{const b=()=>{e()===!0?i().next(()=>{b()},g):u()};b()})}}function tj(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function Fg(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=u=>this.ie(u),this.se=u=>i.writeSequenceNumber(u))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}vw.oe=-1;function Q0(n){return n==null}function f0(n){return n===0&&1/n==-1/0}function rj(n){return typeof n=="number"&&Number.isInteger(n)&&!f0(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lC(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function pd(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function lM(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi{constructor(e,i){this.comparator=e,this.root=i||rs.EMPTY}insert(e,i){return new Qi(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,rs.BLACK,null,null))}remove(e){return new Qi(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rs.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const u=this.comparator(e,i.key);if(u===0)return i.value;u<0?i=i.left:u>0&&(i=i.right)}return null}indexOf(e){let i=0,u=this.root;for(;!u.isEmpty();){const g=this.comparator(e,u.key);if(g===0)return i+u.left.size;g<0?u=u.left:(i+=u.left.size+1,u=u.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,u)=>(e(i,u),!1))}toString(){const e=[];return this.inorderTraversal((i,u)=>(e.push(`${i}:${u}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Iy(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Iy(this.root,e,this.comparator,!1)}getReverseIterator(){return new Iy(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Iy(this.root,e,this.comparator,!0)}}class Iy{constructor(e,i,u,g){this.isReverse=g,this.nodeStack=[];let b=1;for(;!e.isEmpty();)if(b=i?u(e.key,i):1,i&&g&&(b*=-1),b<0)e=this.isReverse?e.left:e.right;else{if(b===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class rs{constructor(e,i,u,g,b){this.key=e,this.value=i,this.color=u??rs.RED,this.left=g??rs.EMPTY,this.right=b??rs.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,u,g,b){return new rs(e??this.key,i??this.value,u??this.color,g??this.left,b??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,u){let g=this;const b=u(e,g.key);return g=b<0?g.copy(null,null,null,g.left.insert(e,i,u),null):b===0?g.copy(null,i,null,null,null):g.copy(null,null,null,null,g.right.insert(e,i,u)),g.fixUp()}removeMin(){if(this.left.isEmpty())return rs.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let u,g=this;if(i(e,g.key)<0)g.left.isEmpty()||g.left.isRed()||g.left.left.isRed()||(g=g.moveRedLeft()),g=g.copy(null,null,null,g.left.remove(e,i),null);else{if(g.left.isRed()&&(g=g.rotateRight()),g.right.isEmpty()||g.right.isRed()||g.right.left.isRed()||(g=g.moveRedRight()),i(e,g.key)===0){if(g.right.isEmpty())return rs.EMPTY;u=g.right.min(),g=g.copy(u.key,u.value,null,null,g.right.removeMin())}g=g.copy(null,null,null,null,g.right.remove(e,i))}return g.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,rs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,rs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw hn();const e=this.left.check();if(e!==this.right.check())throw hn();return e+(this.isRed()?0:1)}}rs.EMPTY=null,rs.RED=!0,rs.BLACK=!1;rs.EMPTY=new class{constructor(){this.size=0}get key(){throw hn()}get value(){throw hn()}get color(){throw hn()}get left(){throw hn()}get right(){throw hn()}copy(e,i,u,g,b){return this}insert(e,i,u){return new rs(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(e){this.comparator=e,this.data=new Qi(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,u)=>(e(i),!1))}forEachInRange(e,i){const u=this.data.getIteratorFrom(e[0]);for(;u.hasNext();){const g=u.getNext();if(this.comparator(g.key,e[1])>=0)return;i(g.key)}}forEachWhile(e,i){let u;for(u=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();u.hasNext();)if(!e(u.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new cC(this.data.getIterator())}getIteratorFrom(e){return new cC(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(u=>{i=i.add(u)}),i}isEqual(e){if(!(e instanceof os)||this.size!==e.size)return!1;const i=this.data.getIterator(),u=e.data.getIterator();for(;i.hasNext();){const g=i.getNext().key,b=u.getNext().key;if(this.comparator(g,b)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new os(this.comparator);return i.data=e,i}}class cC{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{constructor(e){this.fields=e,e.sort(is.comparator)}static empty(){return new Ra([])}unionWith(e){let i=new os(is.comparator);for(const u of this.fields)i=i.add(u);for(const u of e)i=i.add(u);return new Ra(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return jf(this.fields,e.fields,(i,u)=>i.isEqual(u))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cM extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(g){try{return atob(g)}catch(b){throw typeof DOMException<"u"&&b instanceof DOMException?new cM("Invalid base64 string: "+b):b}}(e);return new as(i)}static fromUint8Array(e){const i=function(g){let b="";for(let I=0;I<g.length;++I)b+=String.fromCharCode(g[I]);return b}(e);return new as(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const u=new Uint8Array(i.length);for(let g=0;g<i.length;g++)u[g]=i.charCodeAt(g);return u}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ri(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}as.EMPTY_BYTE_STRING=new as("");const nj=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qu(n){if(Pi(!!n),typeof n=="string"){let e=0;const i=nj.exec(n);if(Pi(!!i),i[1]){let g=i[1];g=(g+"000000000").substr(0,9),e=Number(g)}const u=new Date(n);return{seconds:Math.floor(u.getTime()/1e3),nanos:e}}return{seconds:lo(n.seconds),nanos:lo(n.nanos)}}function lo(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function cd(n){return typeof n=="string"?as.fromBase64String(n):as.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bw(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||i===void 0?void 0:i.stringValue)==="server_timestamp"}function xw(n){const e=n.mapValue.fields.__previous_value__;return bw(e)?xw(e):e}function pg(n){const e=Qu(n.mapValue.fields.__local_write_time__.timestampValue);return new Ao(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ij{constructor(e,i,u,g,b,I,L,s,$){this.databaseId=e,this.appId=i,this.persistenceKey=u,this.host=g,this.ssl=b,this.forceLongPolling=I,this.autoDetectLongPolling=L,this.longPollingOptions=s,this.useFetchStreams=$}}class mg{constructor(e,i){this.projectId=e,this.database=i||"(default)"}static empty(){return new mg("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof mg&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ay={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function ud(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?bw(n)?4:sj(n)?9007199254740991:oj(n)?10:11:hn()}function hc(n,e){if(n===e)return!0;const i=ud(n);if(i!==ud(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return pg(n).isEqual(pg(e));case 3:return function(g,b){if(typeof g.timestampValue=="string"&&typeof b.timestampValue=="string"&&g.timestampValue.length===b.timestampValue.length)return g.timestampValue===b.timestampValue;const I=Qu(g.timestampValue),L=Qu(b.timestampValue);return I.seconds===L.seconds&&I.nanos===L.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(g,b){return cd(g.bytesValue).isEqual(cd(b.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(g,b){return lo(g.geoPointValue.latitude)===lo(b.geoPointValue.latitude)&&lo(g.geoPointValue.longitude)===lo(b.geoPointValue.longitude)}(n,e);case 2:return function(g,b){if("integerValue"in g&&"integerValue"in b)return lo(g.integerValue)===lo(b.integerValue);if("doubleValue"in g&&"doubleValue"in b){const I=lo(g.doubleValue),L=lo(b.doubleValue);return I===L?f0(I)===f0(L):isNaN(I)&&isNaN(L)}return!1}(n,e);case 9:return jf(n.arrayValue.values||[],e.arrayValue.values||[],hc);case 10:case 11:return function(g,b){const I=g.mapValue.fields||{},L=b.mapValue.fields||{};if(lC(I)!==lC(L))return!1;for(const s in I)if(I.hasOwnProperty(s)&&(L[s]===void 0||!hc(I[s],L[s])))return!1;return!0}(n,e);default:return hn()}}function gg(n,e){return(n.values||[]).find(i=>hc(i,e))!==void 0}function $f(n,e){if(n===e)return 0;const i=ud(n),u=ud(e);if(i!==u)return ri(i,u);switch(i){case 0:case 9007199254740991:return 0;case 1:return ri(n.booleanValue,e.booleanValue);case 2:return function(b,I){const L=lo(b.integerValue||b.doubleValue),s=lo(I.integerValue||I.doubleValue);return L<s?-1:L>s?1:L===s?0:isNaN(L)?isNaN(s)?0:-1:1}(n,e);case 3:return uC(n.timestampValue,e.timestampValue);case 4:return uC(pg(n),pg(e));case 5:return ri(n.stringValue,e.stringValue);case 6:return function(b,I){const L=cd(b),s=cd(I);return L.compareTo(s)}(n.bytesValue,e.bytesValue);case 7:return function(b,I){const L=b.split("/"),s=I.split("/");for(let $=0;$<L.length&&$<s.length;$++){const W=ri(L[$],s[$]);if(W!==0)return W}return ri(L.length,s.length)}(n.referenceValue,e.referenceValue);case 8:return function(b,I){const L=ri(lo(b.latitude),lo(I.latitude));return L!==0?L:ri(lo(b.longitude),lo(I.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return hC(n.arrayValue,e.arrayValue);case 10:return function(b,I){var L,s,$,W;const Q=b.fields||{},ae=I.fields||{},we=(L=Q.value)===null||L===void 0?void 0:L.arrayValue,He=(s=ae.value)===null||s===void 0?void 0:s.arrayValue,$e=ri((($=we==null?void 0:we.values)===null||$===void 0?void 0:$.length)||0,((W=He==null?void 0:He.values)===null||W===void 0?void 0:W.length)||0);return $e!==0?$e:hC(we,He)}(n.mapValue,e.mapValue);case 11:return function(b,I){if(b===Ay.mapValue&&I===Ay.mapValue)return 0;if(b===Ay.mapValue)return 1;if(I===Ay.mapValue)return-1;const L=b.fields||{},s=Object.keys(L),$=I.fields||{},W=Object.keys($);s.sort(),W.sort();for(let Q=0;Q<s.length&&Q<W.length;++Q){const ae=ri(s[Q],W[Q]);if(ae!==0)return ae;const we=$f(L[s[Q]],$[W[Q]]);if(we!==0)return we}return ri(s.length,W.length)}(n.mapValue,e.mapValue);default:throw hn()}}function uC(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ri(n,e);const i=Qu(n),u=Qu(e),g=ri(i.seconds,u.seconds);return g!==0?g:ri(i.nanos,u.nanos)}function hC(n,e){const i=n.values||[],u=e.values||[];for(let g=0;g<i.length&&g<u.length;++g){const b=$f(i[g],u[g]);if(b)return b}return ri(i.length,u.length)}function qf(n){return i1(n)}function i1(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const u=Qu(i);return`time(${u.seconds},${u.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return cd(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return Jr.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let u="[",g=!0;for(const b of i.values||[])g?g=!1:u+=",",u+=i1(b);return u+"]"}(n.arrayValue):"mapValue"in n?function(i){const u=Object.keys(i.fields||{}).sort();let g="{",b=!0;for(const I of u)b?b=!1:g+=",",g+=`${I}:${i1(i.fields[I])}`;return g+"}"}(n.mapValue):hn()}function dC(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function o1(n){return!!n&&"integerValue"in n}function ww(n){return!!n&&"arrayValue"in n}function fC(n){return!!n&&"nullValue"in n}function pC(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function $y(n){return!!n&&"mapValue"in n}function oj(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||i===void 0?void 0:i.stringValue)==="__vector__"}function Ym(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return pd(n.mapValue.fields,(i,u)=>e.mapValue.fields[i]=Ym(u)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=Ym(n.arrayValue.values[i]);return e}return Object.assign({},n)}function sj(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e){this.value=e}static empty(){return new aa({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let u=0;u<e.length-1;++u)if(i=(i.mapValue.fields||{})[e.get(u)],!$y(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ym(i)}setAll(e){let i=is.emptyPath(),u={},g=[];e.forEach((I,L)=>{if(!i.isImmediateParentOf(L)){const s=this.getFieldsMap(i);this.applyChanges(s,u,g),u={},g=[],i=L.popLast()}I?u[L.lastSegment()]=Ym(I):g.push(L.lastSegment())});const b=this.getFieldsMap(i);this.applyChanges(b,u,g)}delete(e){const i=this.field(e.popLast());$y(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return hc(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let u=0;u<e.length;++u){let g=i.mapValue.fields[e.get(u)];$y(g)&&g.mapValue.fields||(g={mapValue:{fields:{}}},i.mapValue.fields[e.get(u)]=g),i=g}return i.mapValue.fields}applyChanges(e,i,u){pd(i,(g,b)=>e[g]=b);for(const g of u)delete e[g]}clone(){return new aa(Ym(this.value))}}function uM(n){const e=[];return pd(n.fields,(i,u)=>{const g=new is([i]);if($y(u)){const b=uM(u.mapValue).fields;if(b.length===0)e.push(g);else for(const I of b)e.push(g.child(I))}else e.push(g)}),new Ra(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(e,i,u,g,b,I,L){this.key=e,this.documentType=i,this.version=u,this.readTime=g,this.createTime=b,this.data=I,this.documentState=L}static newInvalidDocument(e){return new Ts(e,0,gn.min(),gn.min(),gn.min(),aa.empty(),0)}static newFoundDocument(e,i,u,g){return new Ts(e,1,i,gn.min(),u,g,0)}static newNoDocument(e,i){return new Ts(e,2,i,gn.min(),gn.min(),aa.empty(),0)}static newUnknownDocument(e,i){return new Ts(e,3,i,gn.min(),gn.min(),aa.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(gn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=aa.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=aa.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=gn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ts&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ts(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p0{constructor(e,i){this.position=e,this.inclusive=i}}function mC(n,e,i){let u=0;for(let g=0;g<n.position.length;g++){const b=e[g],I=n.position[g];if(b.field.isKeyField()?u=Jr.comparator(Jr.fromName(I.referenceValue),i.key):u=$f(I,i.data.field(b.field)),b.dir==="desc"&&(u*=-1),u!==0)break}return u}function gC(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!hc(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g{constructor(e,i="asc"){this.field=e,this.dir=i}}function aj(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hM{}class go extends hM{constructor(e,i,u){super(),this.field=e,this.op=i,this.value=u}static create(e,i,u){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,u):new cj(e,i,u):i==="array-contains"?new dj(e,u):i==="in"?new fj(e,u):i==="not-in"?new pj(e,u):i==="array-contains-any"?new mj(e,u):new go(e,i,u)}static createKeyFieldInFilter(e,i,u){return i==="in"?new uj(e,u):new hj(e,u)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison($f(i,this.value)):i!==null&&ud(this.value)===ud(i)&&this.matchesComparison($f(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return hn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class kl extends hM{constructor(e,i){super(),this.filters=e,this.op=i,this.ae=null}static create(e,i){return new kl(e,i)}matches(e){return dM(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function dM(n){return n.op==="and"}function fM(n){return lj(n)&&dM(n)}function lj(n){for(const e of n.filters)if(e instanceof kl)return!1;return!0}function s1(n){if(n instanceof go)return n.field.canonicalString()+n.op.toString()+qf(n.value);if(fM(n))return n.filters.map(e=>s1(e)).join(",");{const e=n.filters.map(i=>s1(i)).join(",");return`${n.op}(${e})`}}function pM(n,e){return n instanceof go?function(u,g){return g instanceof go&&u.op===g.op&&u.field.isEqual(g.field)&&hc(u.value,g.value)}(n,e):n instanceof kl?function(u,g){return g instanceof kl&&u.op===g.op&&u.filters.length===g.filters.length?u.filters.reduce((b,I,L)=>b&&pM(I,g.filters[L]),!0):!1}(n,e):void hn()}function mM(n){return n instanceof go?function(i){return`${i.field.canonicalString()} ${i.op} ${qf(i.value)}`}(n):n instanceof kl?function(i){return i.op.toString()+" {"+i.getFilters().map(mM).join(" ,")+"}"}(n):"Filter"}class cj extends go{constructor(e,i,u){super(e,i,u),this.key=Jr.fromName(u.referenceValue)}matches(e){const i=Jr.comparator(e.key,this.key);return this.matchesComparison(i)}}class uj extends go{constructor(e,i){super(e,"in",i),this.keys=gM("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class hj extends go{constructor(e,i){super(e,"not-in",i),this.keys=gM("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function gM(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(u=>Jr.fromName(u.referenceValue))}class dj extends go{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return ww(i)&&gg(i.arrayValue,this.value)}}class fj extends go{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&gg(this.value.arrayValue,i)}}class pj extends go{constructor(e,i){super(e,"not-in",i)}matches(e){if(gg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!gg(this.value.arrayValue,i)}}class mj extends go{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!ww(i)||!i.arrayValue.values)&&i.arrayValue.values.some(u=>gg(this.value.arrayValue,u))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gj{constructor(e,i=null,u=[],g=[],b=null,I=null,L=null){this.path=e,this.collectionGroup=i,this.orderBy=u,this.filters=g,this.limit=b,this.startAt=I,this.endAt=L,this.ue=null}}function _C(n,e=null,i=[],u=[],g=null,b=null,I=null){return new gj(n,e,i,u,g,b,I)}function Tw(n){const e=_n(n);if(e.ue===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(u=>s1(u)).join(","),i+="|ob:",i+=e.orderBy.map(u=>function(b){return b.field.canonicalString()+b.dir}(u)).join(","),Q0(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(u=>qf(u)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(u=>qf(u)).join(",")),e.ue=i}return e.ue}function Ew(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!aj(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!pM(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!gC(n.startAt,e.startAt)&&gC(n.endAt,e.endAt)}function a1(n){return Jr.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(e,i=null,u=[],g=[],b=null,I="F",L=null,s=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=u,this.filters=g,this.limit=b,this.limitType=I,this.startAt=L,this.endAt=s,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function _j(n,e,i,u,g,b,I,L){return new Qf(n,e,i,u,g,b,I,L)}function Iw(n){return new Qf(n)}function yC(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function _M(n){return n.collectionGroup!==null}function Jm(n){const e=_n(n);if(e.ce===null){e.ce=[];const i=new Set;for(const b of e.explicitOrderBy)e.ce.push(b),i.add(b.field.canonicalString());const u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(I){let L=new os(is.comparator);return I.filters.forEach(s=>{s.getFlattenedFilters().forEach($=>{$.isInequality()&&(L=L.add($.field))})}),L})(e).forEach(b=>{i.has(b.canonicalString())||b.isKeyField()||e.ce.push(new _g(b,u))}),i.has(is.keyField().canonicalString())||e.ce.push(new _g(is.keyField(),u))}return e.ce}function ac(n){const e=_n(n);return e.le||(e.le=yj(e,Jm(n))),e.le}function yj(n,e){if(n.limitType==="F")return _C(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(g=>{const b=g.dir==="desc"?"asc":"desc";return new _g(g.field,b)});const i=n.endAt?new p0(n.endAt.position,n.endAt.inclusive):null,u=n.startAt?new p0(n.startAt.position,n.startAt.inclusive):null;return _C(n.path,n.collectionGroup,e,n.filters,n.limit,i,u)}}function l1(n,e){const i=n.filters.concat([e]);return new Qf(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function m0(n,e,i){return new Qf(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function ev(n,e){return Ew(ac(n),ac(e))&&n.limitType===e.limitType}function yM(n){return`${Tw(ac(n))}|lt:${n.limitType}`}function _f(n){return`Query(target=${function(i){let u=i.path.canonicalString();return i.collectionGroup!==null&&(u+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(u+=`, filters: [${i.filters.map(g=>mM(g)).join(", ")}]`),Q0(i.limit)||(u+=", limit: "+i.limit),i.orderBy.length>0&&(u+=`, orderBy: [${i.orderBy.map(g=>function(I){return`${I.field.canonicalString()} (${I.dir})`}(g)).join(", ")}]`),i.startAt&&(u+=", startAt: ",u+=i.startAt.inclusive?"b:":"a:",u+=i.startAt.position.map(g=>qf(g)).join(",")),i.endAt&&(u+=", endAt: ",u+=i.endAt.inclusive?"a:":"b:",u+=i.endAt.position.map(g=>qf(g)).join(",")),`Target(${u})`}(ac(n))}; limitType=${n.limitType})`}function tv(n,e){return e.isFoundDocument()&&function(u,g){const b=g.key.path;return u.collectionGroup!==null?g.key.hasCollectionId(u.collectionGroup)&&u.path.isPrefixOf(b):Jr.isDocumentKey(u.path)?u.path.isEqual(b):u.path.isImmediateParentOf(b)}(n,e)&&function(u,g){for(const b of Jm(u))if(!b.field.isKeyField()&&g.data.field(b.field)===null)return!1;return!0}(n,e)&&function(u,g){for(const b of u.filters)if(!b.matches(g))return!1;return!0}(n,e)&&function(u,g){return!(u.startAt&&!function(I,L,s){const $=mC(I,L,s);return I.inclusive?$<=0:$<0}(u.startAt,Jm(u),g)||u.endAt&&!function(I,L,s){const $=mC(I,L,s);return I.inclusive?$>=0:$>0}(u.endAt,Jm(u),g))}(n,e)}function vj(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function vM(n){return(e,i)=>{let u=!1;for(const g of Jm(n)){const b=bj(g,e,i);if(b!==0)return b;u=u||g.field.isKeyField()}return 0}}function bj(n,e,i){const u=n.field.isKeyField()?Jr.comparator(e.key,i.key):function(b,I,L){const s=I.data.field(b),$=L.data.field(b);return s!==null&&$!==null?$f(s,$):hn()}(n.field,e,i);switch(n.dir){case"asc":return u;case"desc":return-1*u;default:return hn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),u=this.inner[i];if(u!==void 0){for(const[g,b]of u)if(this.equalsFn(g,e))return b}}has(e){return this.get(e)!==void 0}set(e,i){const u=this.mapKeyFn(e),g=this.inner[u];if(g===void 0)return this.inner[u]=[[e,i]],void this.innerSize++;for(let b=0;b<g.length;b++)if(this.equalsFn(g[b][0],e))return void(g[b]=[e,i]);g.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),u=this.inner[i];if(u===void 0)return!1;for(let g=0;g<u.length;g++)if(this.equalsFn(u[g][0],e))return u.length===1?delete this.inner[i]:u.splice(g,1),this.innerSize--,!0;return!1}forEach(e){pd(this.inner,(i,u)=>{for(const[g,b]of u)e(g,b)})}isEmpty(){return lM(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xj=new Qi(Jr.comparator);function Gc(){return xj}const bM=new Qi(Jr.comparator);function Fm(...n){let e=bM;for(const i of n)e=e.insert(i.key,i);return e}function xM(n){let e=bM;return n.forEach((i,u)=>e=e.insert(i,u.overlayedDocument)),e}function Zh(){return Qm()}function wM(){return Qm()}function Qm(){return new ep(n=>n.toString(),(n,e)=>n.isEqual(e))}const wj=new Qi(Jr.comparator),Tj=new os(Jr.comparator);function Un(...n){let e=Tj;for(const i of n)e=e.add(i);return e}const Ej=new os(ri);function Ij(){return Ej}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:f0(e)?"-0":e}}function TM(n){return{integerValue:""+n}}function Aj(n,e){return rj(e)?TM(e):Aw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rv{constructor(){this._=void 0}}function Sj(n,e,i){return n instanceof yg?function(g,b){const I={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:g.seconds,nanos:g.nanoseconds}}}};return b&&bw(b)&&(b=xw(b)),b&&(I.fields.__previous_value__=b),{mapValue:I}}(i,e):n instanceof vg?IM(n,e):n instanceof bg?AM(n,e):function(g,b){const I=EM(g,b),L=vC(I)+vC(g.Pe);return o1(I)&&o1(g.Pe)?TM(L):Aw(g.serializer,L)}(n,e)}function Cj(n,e,i){return n instanceof vg?IM(n,e):n instanceof bg?AM(n,e):i}function EM(n,e){return n instanceof g0?function(u){return o1(u)||function(b){return!!b&&"doubleValue"in b}(u)}(e)?e:{integerValue:0}:null}class yg extends rv{}class vg extends rv{constructor(e){super(),this.elements=e}}function IM(n,e){const i=SM(e);for(const u of n.elements)i.some(g=>hc(g,u))||i.push(u);return{arrayValue:{values:i}}}class bg extends rv{constructor(e){super(),this.elements=e}}function AM(n,e){let i=SM(e);for(const u of n.elements)i=i.filter(g=>!hc(g,u));return{arrayValue:{values:i}}}class g0 extends rv{constructor(e,i){super(),this.serializer=e,this.Pe=i}}function vC(n){return lo(n.integerValue||n.doubleValue)}function SM(n){return ww(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rj{constructor(e,i){this.field=e,this.transform=i}}function kj(n,e){return n.field.isEqual(e.field)&&function(u,g){return u instanceof vg&&g instanceof vg||u instanceof bg&&g instanceof bg?jf(u.elements,g.elements,hc):u instanceof g0&&g instanceof g0?hc(u.Pe,g.Pe):u instanceof yg&&g instanceof yg}(n.transform,e.transform)}class Pj{constructor(e,i){this.version=e,this.transformResults=i}}class Al{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new Al}static exists(e){return new Al(void 0,e)}static updateTime(e){return new Al(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function qy(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class nv{}function CM(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Sw(n.key,Al.none()):new Ng(n.key,n.data,Al.none());{const i=n.data,u=aa.empty();let g=new os(is.comparator);for(let b of e.fields)if(!g.has(b)){let I=i.field(b);I===null&&b.length>1&&(b=b.popLast(),I=i.field(b)),I===null?u.delete(b):u.set(b,I),g=g.add(b)}return new ah(n.key,u,new Ra(g.toArray()),Al.none())}}function Mj(n,e,i){n instanceof Ng?function(g,b,I){const L=g.value.clone(),s=xC(g.fieldTransforms,b,I.transformResults);L.setAll(s),b.convertToFoundDocument(I.version,L).setHasCommittedMutations()}(n,e,i):n instanceof ah?function(g,b,I){if(!qy(g.precondition,b))return void b.convertToUnknownDocument(I.version);const L=xC(g.fieldTransforms,b,I.transformResults),s=b.data;s.setAll(RM(g)),s.setAll(L),b.convertToFoundDocument(I.version,s).setHasCommittedMutations()}(n,e,i):function(g,b,I){b.convertToNoDocument(I.version).setHasCommittedMutations()}(0,e,i)}function eg(n,e,i,u){return n instanceof Ng?function(b,I,L,s){if(!qy(b.precondition,I))return L;const $=b.value.clone(),W=wC(b.fieldTransforms,s,I);return $.setAll(W),I.convertToFoundDocument(I.version,$).setHasLocalMutations(),null}(n,e,i,u):n instanceof ah?function(b,I,L,s){if(!qy(b.precondition,I))return L;const $=wC(b.fieldTransforms,s,I),W=I.data;return W.setAll(RM(b)),W.setAll($),I.convertToFoundDocument(I.version,W).setHasLocalMutations(),L===null?null:L.unionWith(b.fieldMask.fields).unionWith(b.fieldTransforms.map(Q=>Q.field))}(n,e,i,u):function(b,I,L){return qy(b.precondition,I)?(I.convertToNoDocument(I.version).setHasLocalMutations(),null):L}(n,e,i)}function Dj(n,e){let i=null;for(const u of n.fieldTransforms){const g=e.data.field(u.field),b=EM(u.transform,g||null);b!=null&&(i===null&&(i=aa.empty()),i.set(u.field,b))}return i||null}function bC(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(u,g){return u===void 0&&g===void 0||!(!u||!g)&&jf(u,g,(b,I)=>kj(b,I))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ng extends nv{constructor(e,i,u,g=[]){super(),this.key=e,this.value=i,this.precondition=u,this.fieldTransforms=g,this.type=0}getFieldMask(){return null}}class ah extends nv{constructor(e,i,u,g,b=[]){super(),this.key=e,this.data=i,this.fieldMask=u,this.precondition=g,this.fieldTransforms=b,this.type=1}getFieldMask(){return this.fieldMask}}function RM(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const u=n.data.field(i);e.set(i,u)}}),e}function xC(n,e,i){const u=new Map;Pi(n.length===i.length);for(let g=0;g<i.length;g++){const b=n[g],I=b.transform,L=e.data.field(b.field);u.set(b.field,Cj(I,L,i[g]))}return u}function wC(n,e,i){const u=new Map;for(const g of n){const b=g.transform,I=i.data.field(g.field);u.set(g.field,Sj(b,I,e))}return u}class Sw extends nv{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Lj extends nv{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oj{constructor(e,i,u,g){this.batchId=e,this.localWriteTime=i,this.baseMutations=u,this.mutations=g}applyToRemoteDocument(e,i){const u=i.mutationResults;for(let g=0;g<this.mutations.length;g++){const b=this.mutations[g];b.key.isEqual(e.key)&&Mj(b,e,u[g])}}applyToLocalView(e,i){for(const u of this.baseMutations)u.key.isEqual(e.key)&&(i=eg(u,e,i,this.localWriteTime));for(const u of this.mutations)u.key.isEqual(e.key)&&(i=eg(u,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const u=wM();return this.mutations.forEach(g=>{const b=e.get(g.key),I=b.overlayedDocument;let L=this.applyToLocalView(I,b.mutatedFields);L=i.has(g.key)?null:L;const s=CM(I,L);s!==null&&u.set(g.key,s),I.isValidDocument()||I.convertToNoDocument(gn.min())}),u}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Un())}isEqual(e){return this.batchId===e.batchId&&jf(this.mutations,e.mutations,(i,u)=>bC(i,u))&&jf(this.baseMutations,e.baseMutations,(i,u)=>bC(i,u))}}class Cw{constructor(e,i,u,g){this.batch=e,this.commitVersion=i,this.mutationResults=u,this.docVersions=g}static from(e,i,u){Pi(e.mutations.length===u.length);let g=function(){return wj}();const b=e.mutations;for(let I=0;I<b.length;I++)g=g.insert(b[I].key,u[I].version);return new Cw(e,i,u,g)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bj{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zj{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var mo,Yn;function Fj(n){switch(n){default:return hn();case Jt.CANCELLED:case Jt.UNKNOWN:case Jt.DEADLINE_EXCEEDED:case Jt.RESOURCE_EXHAUSTED:case Jt.INTERNAL:case Jt.UNAVAILABLE:case Jt.UNAUTHENTICATED:return!1;case Jt.INVALID_ARGUMENT:case Jt.NOT_FOUND:case Jt.ALREADY_EXISTS:case Jt.PERMISSION_DENIED:case Jt.FAILED_PRECONDITION:case Jt.ABORTED:case Jt.OUT_OF_RANGE:case Jt.UNIMPLEMENTED:case Jt.DATA_LOSS:return!0}}function kM(n){if(n===void 0)return qc("GRPC error has no .code"),Jt.UNKNOWN;switch(n){case mo.OK:return Jt.OK;case mo.CANCELLED:return Jt.CANCELLED;case mo.UNKNOWN:return Jt.UNKNOWN;case mo.DEADLINE_EXCEEDED:return Jt.DEADLINE_EXCEEDED;case mo.RESOURCE_EXHAUSTED:return Jt.RESOURCE_EXHAUSTED;case mo.INTERNAL:return Jt.INTERNAL;case mo.UNAVAILABLE:return Jt.UNAVAILABLE;case mo.UNAUTHENTICATED:return Jt.UNAUTHENTICATED;case mo.INVALID_ARGUMENT:return Jt.INVALID_ARGUMENT;case mo.NOT_FOUND:return Jt.NOT_FOUND;case mo.ALREADY_EXISTS:return Jt.ALREADY_EXISTS;case mo.PERMISSION_DENIED:return Jt.PERMISSION_DENIED;case mo.FAILED_PRECONDITION:return Jt.FAILED_PRECONDITION;case mo.ABORTED:return Jt.ABORTED;case mo.OUT_OF_RANGE:return Jt.OUT_OF_RANGE;case mo.UNIMPLEMENTED:return Jt.UNIMPLEMENTED;case mo.DATA_LOSS:return Jt.DATA_LOSS;default:return hn()}}(Yn=mo||(mo={}))[Yn.OK=0]="OK",Yn[Yn.CANCELLED=1]="CANCELLED",Yn[Yn.UNKNOWN=2]="UNKNOWN",Yn[Yn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Yn[Yn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Yn[Yn.NOT_FOUND=5]="NOT_FOUND",Yn[Yn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Yn[Yn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Yn[Yn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Yn[Yn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Yn[Yn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Yn[Yn.ABORTED=10]="ABORTED",Yn[Yn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Yn[Yn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Yn[Yn.INTERNAL=13]="INTERNAL",Yn[Yn.UNAVAILABLE=14]="UNAVAILABLE",Yn[Yn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nj(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vj=new Qh([4294967295,4294967295],0);function TC(n){const e=Nj().encode(n),i=new QP;return i.update(e),new Uint8Array(i.digest())}function EC(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),u=e.getUint32(4,!0),g=e.getUint32(8,!0),b=e.getUint32(12,!0);return[new Qh([i,u],0),new Qh([g,b],0)]}class Rw{constructor(e,i,u){if(this.bitmap=e,this.padding=i,this.hashCount=u,i<0||i>=8)throw new Nm(`Invalid padding: ${i}`);if(u<0)throw new Nm(`Invalid hash count: ${u}`);if(e.length>0&&this.hashCount===0)throw new Nm(`Invalid hash count: ${u}`);if(e.length===0&&i!==0)throw new Nm(`Invalid padding when bitmap length is 0: ${i}`);this.Ie=8*e.length-i,this.Te=Qh.fromNumber(this.Ie)}Ee(e,i,u){let g=e.add(i.multiply(Qh.fromNumber(u)));return g.compare(Vj)===1&&(g=new Qh([g.getBits(0),g.getBits(1)],0)),g.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const i=TC(e),[u,g]=EC(i);for(let b=0;b<this.hashCount;b++){const I=this.Ee(u,g,b);if(!this.de(I))return!1}return!0}static create(e,i,u){const g=e%8==0?0:8-e%8,b=new Uint8Array(Math.ceil(e/8)),I=new Rw(b,g,i);return u.forEach(L=>I.insert(L)),I}insert(e){if(this.Ie===0)return;const i=TC(e),[u,g]=EC(i);for(let b=0;b<this.hashCount;b++){const I=this.Ee(u,g,b);this.Ae(I)}}Ae(e){const i=Math.floor(e/8),u=e%8;this.bitmap[i]|=1<<u}}class Nm extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv{constructor(e,i,u,g,b){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=u,this.documentUpdates=g,this.resolvedLimboDocuments=b}static createSynthesizedRemoteEventForCurrentChange(e,i,u){const g=new Map;return g.set(e,Vg.createSynthesizedTargetChangeForCurrentChange(e,i,u)),new iv(gn.min(),g,new Qi(ri),Gc(),Un())}}class Vg{constructor(e,i,u,g,b){this.resumeToken=e,this.current=i,this.addedDocuments=u,this.modifiedDocuments=g,this.removedDocuments=b}static createSynthesizedTargetChangeForCurrentChange(e,i,u){return new Vg(u,i,Un(),Un(),Un())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gy{constructor(e,i,u,g){this.Re=e,this.removedTargetIds=i,this.key=u,this.Ve=g}}class PM{constructor(e,i){this.targetId=e,this.me=i}}class MM{constructor(e,i,u=as.EMPTY_BYTE_STRING,g=null){this.state=e,this.targetIds=i,this.resumeToken=u,this.cause=g}}class IC{constructor(){this.fe=0,this.ge=SC(),this.pe=as.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Un(),i=Un(),u=Un();return this.ge.forEach((g,b)=>{switch(b){case 0:e=e.add(g);break;case 2:i=i.add(g);break;case 1:u=u.add(g);break;default:hn()}}),new Vg(this.pe,this.ye,e,i,u)}Ce(){this.we=!1,this.ge=SC()}Fe(e,i){this.we=!0,this.ge=this.ge.insert(e,i)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Pi(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Uj{constructor(e){this.Le=e,this.Be=new Map,this.ke=Gc(),this.qe=AC(),this.Qe=new Qi(ri)}Ke(e){for(const i of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(i,e.Ve):this.Ue(i,e.key,e.Ve);for(const i of e.removedTargetIds)this.Ue(i,e.key,e.Ve)}We(e){this.forEachTarget(e,i=>{const u=this.Ge(i);switch(e.state){case 0:this.ze(i)&&u.De(e.resumeToken);break;case 1:u.Oe(),u.Se||u.Ce(),u.De(e.resumeToken);break;case 2:u.Oe(),u.Se||this.removeTarget(i);break;case 3:this.ze(i)&&(u.Ne(),u.De(e.resumeToken));break;case 4:this.ze(i)&&(this.je(i),u.De(e.resumeToken));break;default:hn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.Be.forEach((u,g)=>{this.ze(g)&&i(g)})}He(e){const i=e.targetId,u=e.me.count,g=this.Je(i);if(g){const b=g.target;if(a1(b))if(u===0){const I=new Jr(b.path);this.Ue(i,I,Ts.newNoDocument(I,gn.min()))}else Pi(u===1);else{const I=this.Ye(i);if(I!==u){const L=this.Ze(e),s=L?this.Xe(L,e,I):1;if(s!==0){this.je(i);const $=s===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(i,$)}}}}}Ze(e){const i=e.me.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:u="",padding:g=0},hashCount:b=0}=i;let I,L;try{I=cd(u).toUint8Array()}catch(s){if(s instanceof cM)return Uf("Decoding the base64 bloom filter in existence filter failed ("+s.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw s}try{L=new Rw(I,g,b)}catch(s){return Uf(s instanceof Nm?"BloomFilter error: ":"Applying bloom filter failed: ",s),null}return L.Ie===0?null:L}Xe(e,i,u){return i.me.count===u-this.nt(e,i.targetId)?0:2}nt(e,i){const u=this.Le.getRemoteKeysForTarget(i);let g=0;return u.forEach(b=>{const I=this.Le.tt(),L=`projects/${I.projectId}/databases/${I.database}/documents/${b.path.canonicalString()}`;e.mightContain(L)||(this.Ue(i,b,null),g++)}),g}rt(e){const i=new Map;this.Be.forEach((b,I)=>{const L=this.Je(I);if(L){if(b.current&&a1(L.target)){const s=new Jr(L.target.path);this.ke.get(s)!==null||this.it(I,s)||this.Ue(I,s,Ts.newNoDocument(s,e))}b.be&&(i.set(I,b.ve()),b.Ce())}});let u=Un();this.qe.forEach((b,I)=>{let L=!0;I.forEachWhile(s=>{const $=this.Je(s);return!$||$.purpose==="TargetPurposeLimboResolution"||(L=!1,!1)}),L&&(u=u.add(b))}),this.ke.forEach((b,I)=>I.setReadTime(e));const g=new iv(e,i,this.Qe,this.ke,u);return this.ke=Gc(),this.qe=AC(),this.Qe=new Qi(ri),g}$e(e,i){if(!this.ze(e))return;const u=this.it(e,i.key)?2:0;this.Ge(e).Fe(i.key,u),this.ke=this.ke.insert(i.key,i),this.qe=this.qe.insert(i.key,this.st(i.key).add(e))}Ue(e,i,u){if(!this.ze(e))return;const g=this.Ge(e);this.it(e,i)?g.Fe(i,1):g.Me(i),this.qe=this.qe.insert(i,this.st(i).delete(e)),u&&(this.ke=this.ke.insert(i,u))}removeTarget(e){this.Be.delete(e)}Ye(e){const i=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let i=this.Be.get(e);return i||(i=new IC,this.Be.set(e,i)),i}st(e){let i=this.qe.get(e);return i||(i=new os(ri),this.qe=this.qe.insert(e,i)),i}ze(e){const i=this.Je(e)!==null;return i||Fr("WatchChangeAggregator","Detected inactive target",e),i}Je(e){const i=this.Be.get(e);return i&&i.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new IC),this.Le.getRemoteKeysForTarget(e).forEach(i=>{this.Ue(e,i,null)})}it(e,i){return this.Le.getRemoteKeysForTarget(e).has(i)}}function AC(){return new Qi(Jr.comparator)}function SC(){return new Qi(Jr.comparator)}const jj={asc:"ASCENDING",desc:"DESCENDING"},$j={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qj={and:"AND",or:"OR"};class Gj{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function c1(n,e){return n.useProto3Json||Q0(e)?e:{value:e}}function _0(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function DM(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Hj(n,e){return _0(n,e.toTimestamp())}function lc(n){return Pi(!!n),gn.fromTimestamp(function(i){const u=Qu(i);return new Ao(u.seconds,u.nanos)}(n))}function kw(n,e){return u1(n,e).canonicalString()}function u1(n,e){const i=function(g){return new Ui(["projects",g.projectId,"databases",g.database])}(n).child("documents");return e===void 0?i:i.child(e)}function LM(n){const e=Ui.fromString(n);return Pi(NM(e)),e}function h1(n,e){return kw(n.databaseId,e.path)}function yx(n,e){const i=LM(e);if(i.get(1)!==n.databaseId.projectId)throw new Dr(Jt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new Dr(Jt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new Jr(BM(i))}function OM(n,e){return kw(n.databaseId,e)}function Wj(n){const e=LM(n);return e.length===4?Ui.emptyPath():BM(e)}function d1(n){return new Ui(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function BM(n){return Pi(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function CC(n,e,i){return{name:h1(n,e),fields:i.value.mapValue.fields}}function Zj(n,e){let i;if("targetChange"in e){e.targetChange;const u=function($){return $==="NO_CHANGE"?0:$==="ADD"?1:$==="REMOVE"?2:$==="CURRENT"?3:$==="RESET"?4:hn()}(e.targetChange.targetChangeType||"NO_CHANGE"),g=e.targetChange.targetIds||[],b=function($,W){return $.useProto3Json?(Pi(W===void 0||typeof W=="string"),as.fromBase64String(W||"")):(Pi(W===void 0||W instanceof Buffer||W instanceof Uint8Array),as.fromUint8Array(W||new Uint8Array))}(n,e.targetChange.resumeToken),I=e.targetChange.cause,L=I&&function($){const W=$.code===void 0?Jt.UNKNOWN:kM($.code);return new Dr(W,$.message||"")}(I);i=new MM(u,g,b,L||null)}else if("documentChange"in e){e.documentChange;const u=e.documentChange;u.document,u.document.name,u.document.updateTime;const g=yx(n,u.document.name),b=lc(u.document.updateTime),I=u.document.createTime?lc(u.document.createTime):gn.min(),L=new aa({mapValue:{fields:u.document.fields}}),s=Ts.newFoundDocument(g,b,I,L),$=u.targetIds||[],W=u.removedTargetIds||[];i=new Gy($,W,s.key,s)}else if("documentDelete"in e){e.documentDelete;const u=e.documentDelete;u.document;const g=yx(n,u.document),b=u.readTime?lc(u.readTime):gn.min(),I=Ts.newNoDocument(g,b),L=u.removedTargetIds||[];i=new Gy([],L,I.key,I)}else if("documentRemove"in e){e.documentRemove;const u=e.documentRemove;u.document;const g=yx(n,u.document),b=u.removedTargetIds||[];i=new Gy([],b,g,null)}else{if(!("filter"in e))return hn();{e.filter;const u=e.filter;u.targetId;const{count:g=0,unchangedNames:b}=u,I=new zj(g,b),L=u.targetId;i=new PM(L,I)}}return i}function Xj(n,e){let i;if(e instanceof Ng)i={update:CC(n,e.key,e.value)};else if(e instanceof Sw)i={delete:h1(n,e.key)};else if(e instanceof ah)i={update:CC(n,e.key,e.data),updateMask:i$(e.fieldMask)};else{if(!(e instanceof Lj))return hn();i={verify:h1(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(u=>function(b,I){const L=I.transform;if(L instanceof yg)return{fieldPath:I.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(L instanceof vg)return{fieldPath:I.field.canonicalString(),appendMissingElements:{values:L.elements}};if(L instanceof bg)return{fieldPath:I.field.canonicalString(),removeAllFromArray:{values:L.elements}};if(L instanceof g0)return{fieldPath:I.field.canonicalString(),increment:L.Pe};throw hn()}(0,u))),e.precondition.isNone||(i.currentDocument=function(g,b){return b.updateTime!==void 0?{updateTime:Hj(g,b.updateTime)}:b.exists!==void 0?{exists:b.exists}:hn()}(n,e.precondition)),i}function Kj(n,e){return n&&n.length>0?(Pi(e!==void 0),n.map(i=>function(g,b){let I=g.updateTime?lc(g.updateTime):lc(b);return I.isEqual(gn.min())&&(I=lc(b)),new Pj(I,g.transformResults||[])}(i,e))):[]}function Yj(n,e){return{documents:[OM(n,e.path)]}}function Jj(n,e){const i={structuredQuery:{}},u=e.path;let g;e.collectionGroup!==null?(g=u,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(g=u.popLast(),i.structuredQuery.from=[{collectionId:u.lastSegment()}]),i.parent=OM(n,g);const b=function($){if($.length!==0)return FM(kl.create($,"and"))}(e.filters);b&&(i.structuredQuery.where=b);const I=function($){if($.length!==0)return $.map(W=>function(ae){return{field:yf(ae.field),direction:t$(ae.dir)}}(W))}(e.orderBy);I&&(i.structuredQuery.orderBy=I);const L=c1(n,e.limit);return L!==null&&(i.structuredQuery.limit=L),e.startAt&&(i.structuredQuery.startAt=function($){return{before:$.inclusive,values:$.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function($){return{before:!$.inclusive,values:$.position}}(e.endAt)),{_t:i,parent:g}}function Qj(n){let e=Wj(n.parent);const i=n.structuredQuery,u=i.from?i.from.length:0;let g=null;if(u>0){Pi(u===1);const W=i.from[0];W.allDescendants?g=W.collectionId:e=e.child(W.collectionId)}let b=[];i.where&&(b=function(Q){const ae=zM(Q);return ae instanceof kl&&fM(ae)?ae.getFilters():[ae]}(i.where));let I=[];i.orderBy&&(I=function(Q){return Q.map(ae=>function(He){return new _g(vf(He.field),function(Ne){switch(Ne){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(He.direction))}(ae))}(i.orderBy));let L=null;i.limit&&(L=function(Q){let ae;return ae=typeof Q=="object"?Q.value:Q,Q0(ae)?null:ae}(i.limit));let s=null;i.startAt&&(s=function(Q){const ae=!!Q.before,we=Q.values||[];return new p0(we,ae)}(i.startAt));let $=null;return i.endAt&&($=function(Q){const ae=!Q.before,we=Q.values||[];return new p0(we,ae)}(i.endAt)),_j(e,g,I,b,L,"F",s,$)}function e$(n,e){const i=function(g){switch(g){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return hn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function zM(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const u=vf(i.unaryFilter.field);return go.create(u,"==",{doubleValue:NaN});case"IS_NULL":const g=vf(i.unaryFilter.field);return go.create(g,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const b=vf(i.unaryFilter.field);return go.create(b,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const I=vf(i.unaryFilter.field);return go.create(I,"!=",{nullValue:"NULL_VALUE"});default:return hn()}}(n):n.fieldFilter!==void 0?function(i){return go.create(vf(i.fieldFilter.field),function(g){switch(g){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return hn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return kl.create(i.compositeFilter.filters.map(u=>zM(u)),function(g){switch(g){case"AND":return"and";case"OR":return"or";default:return hn()}}(i.compositeFilter.op))}(n):hn()}function t$(n){return jj[n]}function r$(n){return $j[n]}function n$(n){return qj[n]}function yf(n){return{fieldPath:n.canonicalString()}}function vf(n){return is.fromServerFormat(n.fieldPath)}function FM(n){return n instanceof go?function(i){if(i.op==="=="){if(pC(i.value))return{unaryFilter:{field:yf(i.field),op:"IS_NAN"}};if(fC(i.value))return{unaryFilter:{field:yf(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(pC(i.value))return{unaryFilter:{field:yf(i.field),op:"IS_NOT_NAN"}};if(fC(i.value))return{unaryFilter:{field:yf(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:yf(i.field),op:r$(i.op),value:i.value}}}(n):n instanceof kl?function(i){const u=i.getFilters().map(g=>FM(g));return u.length===1?u[0]:{compositeFilter:{op:n$(i.op),filters:u}}}(n):hn()}function i$(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function NM(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $u{constructor(e,i,u,g,b=gn.min(),I=gn.min(),L=as.EMPTY_BYTE_STRING,s=null){this.target=e,this.targetId=i,this.purpose=u,this.sequenceNumber=g,this.snapshotVersion=b,this.lastLimboFreeSnapshotVersion=I,this.resumeToken=L,this.expectedCount=s}withSequenceNumber(e){return new $u(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new $u(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new $u(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new $u(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o${constructor(e){this.ct=e}}function s$(n){const e=Qj({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?m0(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a${constructor(){this.un=new l$}addToCollectionParentIndex(e,i){return this.un.add(i),ir.resolve()}getCollectionParents(e,i){return ir.resolve(this.un.getEntries(i))}addFieldIndex(e,i){return ir.resolve()}deleteFieldIndex(e,i){return ir.resolve()}deleteAllFieldIndexes(e){return ir.resolve()}createTargetIndexes(e,i){return ir.resolve()}getDocumentsMatchingTarget(e,i){return ir.resolve(null)}getIndexType(e,i){return ir.resolve(0)}getFieldIndexes(e,i){return ir.resolve([])}getNextCollectionGroupToUpdate(e){return ir.resolve(null)}getMinOffset(e,i){return ir.resolve(Ju.min())}getMinOffsetFromCollectionGroup(e,i){return ir.resolve(Ju.min())}updateCollectionGroup(e,i,u){return ir.resolve()}updateIndexEntries(e,i){return ir.resolve()}}class l${constructor(){this.index={}}add(e){const i=e.lastSegment(),u=e.popLast(),g=this.index[i]||new os(Ui.comparator),b=!g.has(u);return this.index[i]=g.add(u),b}has(e){const i=e.lastSegment(),u=e.popLast(),g=this.index[i];return g&&g.has(u)}getEntries(e){return(this.index[e]||new os(Ui.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Gf(0)}static kn(){return new Gf(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c${constructor(){this.changes=new ep(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,Ts.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const u=this.changes.get(i);return u!==void 0?ir.resolve(u):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u${constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h${constructor(e,i,u,g){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=u,this.indexManager=g}getDocument(e,i){let u=null;return this.documentOverlayCache.getOverlay(e,i).next(g=>(u=g,this.remoteDocumentCache.getEntry(e,i))).next(g=>(u!==null&&eg(u.mutation,g,Ra.empty(),Ao.now()),g))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(u=>this.getLocalViewOfDocuments(e,u,Un()).next(()=>u))}getLocalViewOfDocuments(e,i,u=Un()){const g=Zh();return this.populateOverlays(e,g,i).next(()=>this.computeViews(e,i,g,u).next(b=>{let I=Fm();return b.forEach((L,s)=>{I=I.insert(L,s.overlayedDocument)}),I}))}getOverlayedDocuments(e,i){const u=Zh();return this.populateOverlays(e,u,i).next(()=>this.computeViews(e,i,u,Un()))}populateOverlays(e,i,u){const g=[];return u.forEach(b=>{i.has(b)||g.push(b)}),this.documentOverlayCache.getOverlays(e,g).next(b=>{b.forEach((I,L)=>{i.set(I,L)})})}computeViews(e,i,u,g){let b=Gc();const I=Qm(),L=function(){return Qm()}();return i.forEach((s,$)=>{const W=u.get($.key);g.has($.key)&&(W===void 0||W.mutation instanceof ah)?b=b.insert($.key,$):W!==void 0?(I.set($.key,W.mutation.getFieldMask()),eg(W.mutation,$,W.mutation.getFieldMask(),Ao.now())):I.set($.key,Ra.empty())}),this.recalculateAndSaveOverlays(e,b).next(s=>(s.forEach(($,W)=>I.set($,W)),i.forEach(($,W)=>{var Q;return L.set($,new u$(W,(Q=I.get($))!==null&&Q!==void 0?Q:null))}),L))}recalculateAndSaveOverlays(e,i){const u=Qm();let g=new Qi((I,L)=>I-L),b=Un();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(I=>{for(const L of I)L.keys().forEach(s=>{const $=i.get(s);if($===null)return;let W=u.get(s)||Ra.empty();W=L.applyToLocalView($,W),u.set(s,W);const Q=(g.get(L.batchId)||Un()).add(s);g=g.insert(L.batchId,Q)})}).next(()=>{const I=[],L=g.getReverseIterator();for(;L.hasNext();){const s=L.getNext(),$=s.key,W=s.value,Q=wM();W.forEach(ae=>{if(!b.has(ae)){const we=CM(i.get(ae),u.get(ae));we!==null&&Q.set(ae,we),b=b.add(ae)}}),I.push(this.documentOverlayCache.saveOverlays(e,$,Q))}return ir.waitFor(I)}).next(()=>u)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(u=>this.recalculateAndSaveOverlays(e,u))}getDocumentsMatchingQuery(e,i,u,g){return function(I){return Jr.isDocumentKey(I.path)&&I.collectionGroup===null&&I.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):_M(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,u,g):this.getDocumentsMatchingCollectionQuery(e,i,u,g)}getNextDocuments(e,i,u,g){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,u,g).next(b=>{const I=g-b.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,u.largestBatchId,g-b.size):ir.resolve(Zh());let L=-1,s=b;return I.next($=>ir.forEach($,(W,Q)=>(L<Q.largestBatchId&&(L=Q.largestBatchId),b.get(W)?ir.resolve():this.remoteDocumentCache.getEntry(e,W).next(ae=>{s=s.insert(W,ae)}))).next(()=>this.populateOverlays(e,$,b)).next(()=>this.computeViews(e,s,$,Un())).next(W=>({batchId:L,changes:xM(W)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new Jr(i)).next(u=>{let g=Fm();return u.isFoundDocument()&&(g=g.insert(u.key,u)),g})}getDocumentsMatchingCollectionGroupQuery(e,i,u,g){const b=i.collectionGroup;let I=Fm();return this.indexManager.getCollectionParents(e,b).next(L=>ir.forEach(L,s=>{const $=function(Q,ae){return new Qf(ae,null,Q.explicitOrderBy.slice(),Q.filters.slice(),Q.limit,Q.limitType,Q.startAt,Q.endAt)}(i,s.child(b));return this.getDocumentsMatchingCollectionQuery(e,$,u,g).next(W=>{W.forEach((Q,ae)=>{I=I.insert(Q,ae)})})}).next(()=>I))}getDocumentsMatchingCollectionQuery(e,i,u,g){let b;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,u.largestBatchId).next(I=>(b=I,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,u,b,g))).next(I=>{b.forEach((s,$)=>{const W=$.getKey();I.get(W)===null&&(I=I.insert(W,Ts.newInvalidDocument(W)))});let L=Fm();return I.forEach((s,$)=>{const W=b.get(s);W!==void 0&&eg(W.mutation,$,Ra.empty(),Ao.now()),tv(i,$)&&(L=L.insert(s,$))}),L})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d${constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,i){return ir.resolve(this.hr.get(i))}saveBundleMetadata(e,i){return this.hr.set(i.id,function(g){return{id:g.id,version:g.version,createTime:lc(g.createTime)}}(i)),ir.resolve()}getNamedQuery(e,i){return ir.resolve(this.Pr.get(i))}saveNamedQuery(e,i){return this.Pr.set(i.name,function(g){return{name:g.name,query:s$(g.bundledQuery),readTime:lc(g.readTime)}}(i)),ir.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f${constructor(){this.overlays=new Qi(Jr.comparator),this.Ir=new Map}getOverlay(e,i){return ir.resolve(this.overlays.get(i))}getOverlays(e,i){const u=Zh();return ir.forEach(i,g=>this.getOverlay(e,g).next(b=>{b!==null&&u.set(g,b)})).next(()=>u)}saveOverlays(e,i,u){return u.forEach((g,b)=>{this.ht(e,i,b)}),ir.resolve()}removeOverlaysForBatchId(e,i,u){const g=this.Ir.get(u);return g!==void 0&&(g.forEach(b=>this.overlays=this.overlays.remove(b)),this.Ir.delete(u)),ir.resolve()}getOverlaysForCollection(e,i,u){const g=Zh(),b=i.length+1,I=new Jr(i.child("")),L=this.overlays.getIteratorFrom(I);for(;L.hasNext();){const s=L.getNext().value,$=s.getKey();if(!i.isPrefixOf($.path))break;$.path.length===b&&s.largestBatchId>u&&g.set(s.getKey(),s)}return ir.resolve(g)}getOverlaysForCollectionGroup(e,i,u,g){let b=new Qi(($,W)=>$-W);const I=this.overlays.getIterator();for(;I.hasNext();){const $=I.getNext().value;if($.getKey().getCollectionGroup()===i&&$.largestBatchId>u){let W=b.get($.largestBatchId);W===null&&(W=Zh(),b=b.insert($.largestBatchId,W)),W.set($.getKey(),$)}}const L=Zh(),s=b.getIterator();for(;s.hasNext()&&(s.getNext().value.forEach(($,W)=>L.set($,W)),!(L.size()>=g)););return ir.resolve(L)}ht(e,i,u){const g=this.overlays.get(u.key);if(g!==null){const I=this.Ir.get(g.largestBatchId).delete(u.key);this.Ir.set(g.largestBatchId,I)}this.overlays=this.overlays.insert(u.key,new Bj(i,u));let b=this.Ir.get(i);b===void 0&&(b=Un(),this.Ir.set(i,b)),this.Ir.set(i,b.add(u.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p${constructor(){this.sessionToken=as.EMPTY_BYTE_STRING}getSessionToken(e){return ir.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,ir.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pw{constructor(){this.Tr=new os(No.Er),this.dr=new os(No.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,i){const u=new No(e,i);this.Tr=this.Tr.add(u),this.dr=this.dr.add(u)}Rr(e,i){e.forEach(u=>this.addReference(u,i))}removeReference(e,i){this.Vr(new No(e,i))}mr(e,i){e.forEach(u=>this.removeReference(u,i))}gr(e){const i=new Jr(new Ui([])),u=new No(i,e),g=new No(i,e+1),b=[];return this.dr.forEachInRange([u,g],I=>{this.Vr(I),b.push(I.key)}),b}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const i=new Jr(new Ui([])),u=new No(i,e),g=new No(i,e+1);let b=Un();return this.dr.forEachInRange([u,g],I=>{b=b.add(I.key)}),b}containsKey(e){const i=new No(e,0),u=this.Tr.firstAfterOrEqual(i);return u!==null&&e.isEqual(u.key)}}class No{constructor(e,i){this.key=e,this.wr=i}static Er(e,i){return Jr.comparator(e.key,i.key)||ri(e.wr,i.wr)}static Ar(e,i){return ri(e.wr,i.wr)||Jr.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m${constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Sr=1,this.br=new os(No.Er)}checkEmpty(e){return ir.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,u,g){const b=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const I=new Oj(b,i,u,g);this.mutationQueue.push(I);for(const L of g)this.br=this.br.add(new No(L.key,b)),this.indexManager.addToCollectionParentIndex(e,L.key.path.popLast());return ir.resolve(I)}lookupMutationBatch(e,i){return ir.resolve(this.Dr(i))}getNextMutationBatchAfterBatchId(e,i){const u=i+1,g=this.vr(u),b=g<0?0:g;return ir.resolve(this.mutationQueue.length>b?this.mutationQueue[b]:null)}getHighestUnacknowledgedBatchId(){return ir.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ir.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const u=new No(i,0),g=new No(i,Number.POSITIVE_INFINITY),b=[];return this.br.forEachInRange([u,g],I=>{const L=this.Dr(I.wr);b.push(L)}),ir.resolve(b)}getAllMutationBatchesAffectingDocumentKeys(e,i){let u=new os(ri);return i.forEach(g=>{const b=new No(g,0),I=new No(g,Number.POSITIVE_INFINITY);this.br.forEachInRange([b,I],L=>{u=u.add(L.wr)})}),ir.resolve(this.Cr(u))}getAllMutationBatchesAffectingQuery(e,i){const u=i.path,g=u.length+1;let b=u;Jr.isDocumentKey(b)||(b=b.child(""));const I=new No(new Jr(b),0);let L=new os(ri);return this.br.forEachWhile(s=>{const $=s.key.path;return!!u.isPrefixOf($)&&($.length===g&&(L=L.add(s.wr)),!0)},I),ir.resolve(this.Cr(L))}Cr(e){const i=[];return e.forEach(u=>{const g=this.Dr(u);g!==null&&i.push(g)}),i}removeMutationBatch(e,i){Pi(this.Fr(i.batchId,"removed")===0),this.mutationQueue.shift();let u=this.br;return ir.forEach(i.mutations,g=>{const b=new No(g.key,i.batchId);return u=u.delete(b),this.referenceDelegate.markPotentiallyOrphaned(e,g.key)}).next(()=>{this.br=u})}On(e){}containsKey(e,i){const u=new No(i,0),g=this.br.firstAfterOrEqual(u);return ir.resolve(i.isEqual(g&&g.key))}performConsistencyCheck(e){return this.mutationQueue.length,ir.resolve()}Fr(e,i){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const i=this.vr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g${constructor(e){this.Mr=e,this.docs=function(){return new Qi(Jr.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const u=i.key,g=this.docs.get(u),b=g?g.size:0,I=this.Mr(i);return this.docs=this.docs.insert(u,{document:i.mutableCopy(),size:I}),this.size+=I-b,this.indexManager.addToCollectionParentIndex(e,u.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const u=this.docs.get(i);return ir.resolve(u?u.document.mutableCopy():Ts.newInvalidDocument(i))}getEntries(e,i){let u=Gc();return i.forEach(g=>{const b=this.docs.get(g);u=u.insert(g,b?b.document.mutableCopy():Ts.newInvalidDocument(g))}),ir.resolve(u)}getDocumentsMatchingQuery(e,i,u,g){let b=Gc();const I=i.path,L=new Jr(I.child("")),s=this.docs.getIteratorFrom(L);for(;s.hasNext();){const{key:$,value:{document:W}}=s.getNext();if(!I.isPrefixOf($.path))break;$.path.length>I.length+1||JU(YU(W),u)<=0||(g.has(W.key)||tv(i,W))&&(b=b.insert(W.key,W.mutableCopy()))}return ir.resolve(b)}getAllFromCollectionGroup(e,i,u,g){hn()}Or(e,i){return ir.forEach(this.docs,u=>i(u))}newChangeBuffer(e){return new _$(this)}getSize(e){return ir.resolve(this.size)}}class _$ extends c${constructor(e){super(),this.cr=e}applyChanges(e){const i=[];return this.changes.forEach((u,g)=>{g.isValidDocument()?i.push(this.cr.addEntry(e,g)):this.cr.removeEntry(u)}),ir.waitFor(i)}getFromCache(e,i){return this.cr.getEntry(e,i)}getAllFromCache(e,i){return this.cr.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y${constructor(e){this.persistence=e,this.Nr=new ep(i=>Tw(i),Ew),this.lastRemoteSnapshotVersion=gn.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Pw,this.targetCount=0,this.kr=Gf.Bn()}forEachTarget(e,i){return this.Nr.forEach((u,g)=>i(g)),ir.resolve()}getLastRemoteSnapshotVersion(e){return ir.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ir.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ir.resolve(this.highestTargetId)}setTargetsMetadata(e,i,u){return u&&(this.lastRemoteSnapshotVersion=u),i>this.Lr&&(this.Lr=i),ir.resolve()}Kn(e){this.Nr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.kr=new Gf(i),this.highestTargetId=i),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,i){return this.Kn(i),this.targetCount+=1,ir.resolve()}updateTargetData(e,i){return this.Kn(i),ir.resolve()}removeTargetData(e,i){return this.Nr.delete(i.target),this.Br.gr(i.targetId),this.targetCount-=1,ir.resolve()}removeTargets(e,i,u){let g=0;const b=[];return this.Nr.forEach((I,L)=>{L.sequenceNumber<=i&&u.get(L.targetId)===null&&(this.Nr.delete(I),b.push(this.removeMatchingKeysForTargetId(e,L.targetId)),g++)}),ir.waitFor(b).next(()=>g)}getTargetCount(e){return ir.resolve(this.targetCount)}getTargetData(e,i){const u=this.Nr.get(i)||null;return ir.resolve(u)}addMatchingKeys(e,i,u){return this.Br.Rr(i,u),ir.resolve()}removeMatchingKeys(e,i,u){this.Br.mr(i,u);const g=this.persistence.referenceDelegate,b=[];return g&&i.forEach(I=>{b.push(g.markPotentiallyOrphaned(e,I))}),ir.waitFor(b)}removeMatchingKeysForTargetId(e,i){return this.Br.gr(i),ir.resolve()}getMatchingKeysForTargetId(e,i){const u=this.Br.yr(i);return ir.resolve(u)}containsKey(e,i){return ir.resolve(this.Br.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v${constructor(e,i){this.qr={},this.overlays={},this.Qr=new vw(0),this.Kr=!1,this.Kr=!0,this.$r=new p$,this.referenceDelegate=e(this),this.Ur=new y$(this),this.indexManager=new a$,this.remoteDocumentCache=function(g){return new g$(g)}(u=>this.referenceDelegate.Wr(u)),this.serializer=new o$(i),this.Gr=new d$(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new f$,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let u=this.qr[e.toKey()];return u||(u=new m$(i,this.referenceDelegate),this.qr[e.toKey()]=u),u}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,i,u){Fr("MemoryPersistence","Starting transaction:",e);const g=new b$(this.Qr.next());return this.referenceDelegate.zr(),u(g).next(b=>this.referenceDelegate.jr(g).next(()=>b)).toPromise().then(b=>(g.raiseOnCommittedEvent(),b))}Hr(e,i){return ir.or(Object.values(this.qr).map(u=>()=>u.containsKey(e,i)))}}class b$ extends ej{constructor(e){super(),this.currentSequenceNumber=e}}class Mw{constructor(e){this.persistence=e,this.Jr=new Pw,this.Yr=null}static Zr(e){return new Mw(e)}get Xr(){if(this.Yr)return this.Yr;throw hn()}addReference(e,i,u){return this.Jr.addReference(u,i),this.Xr.delete(u.toString()),ir.resolve()}removeReference(e,i,u){return this.Jr.removeReference(u,i),this.Xr.add(u.toString()),ir.resolve()}markPotentiallyOrphaned(e,i){return this.Xr.add(i.toString()),ir.resolve()}removeTarget(e,i){this.Jr.gr(i.targetId).forEach(g=>this.Xr.add(g.toString()));const u=this.persistence.getTargetCache();return u.getMatchingKeysForTargetId(e,i.targetId).next(g=>{g.forEach(b=>this.Xr.add(b.toString()))}).next(()=>u.removeTargetData(e,i))}zr(){this.Yr=new Set}jr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ir.forEach(this.Xr,u=>{const g=Jr.fromPath(u);return this.ei(e,g).next(b=>{b||i.removeEntry(g,gn.min())})}).next(()=>(this.Yr=null,i.apply(e)))}updateLimboDocument(e,i){return this.ei(e,i).next(u=>{u?this.Xr.delete(i.toString()):this.Xr.add(i.toString())})}Wr(e){return 0}ei(e,i){return ir.or([()=>ir.resolve(this.Jr.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.Hr(e,i)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dw{constructor(e,i,u,g){this.targetId=e,this.fromCache=i,this.$i=u,this.Ui=g}static Wi(e,i){let u=Un(),g=Un();for(const b of i.docChanges)switch(b.type){case 0:u=u.add(b.doc.key);break;case 1:g=g.add(b.doc.key)}return new Dw(e,i.fromCache,u,g)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x${constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w${constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return dV()?8:tj(Ss())>0?6:4}()}initialize(e,i){this.Ji=e,this.indexManager=i,this.Gi=!0}getDocumentsMatchingQuery(e,i,u,g){const b={result:null};return this.Yi(e,i).next(I=>{b.result=I}).next(()=>{if(!b.result)return this.Zi(e,i,g,u).next(I=>{b.result=I})}).next(()=>{if(b.result)return;const I=new x$;return this.Xi(e,i,I).next(L=>{if(b.result=L,this.zi)return this.es(e,i,I,L.size)})}).next(()=>b.result)}es(e,i,u,g){return u.documentReadCount<this.ji?(Rm()<=Wn.DEBUG&&Fr("QueryEngine","SDK will not create cache indexes for query:",_f(i),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ir.resolve()):(Rm()<=Wn.DEBUG&&Fr("QueryEngine","Query:",_f(i),"scans",u.documentReadCount,"local documents and returns",g,"documents as results."),u.documentReadCount>this.Hi*g?(Rm()<=Wn.DEBUG&&Fr("QueryEngine","The SDK decides to create cache indexes for query:",_f(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ac(i))):ir.resolve())}Yi(e,i){if(yC(i))return ir.resolve(null);let u=ac(i);return this.indexManager.getIndexType(e,u).next(g=>g===0?null:(i.limit!==null&&g===1&&(i=m0(i,null,"F"),u=ac(i)),this.indexManager.getDocumentsMatchingTarget(e,u).next(b=>{const I=Un(...b);return this.Ji.getDocuments(e,I).next(L=>this.indexManager.getMinOffset(e,u).next(s=>{const $=this.ts(i,L);return this.ns(i,$,I,s.readTime)?this.Yi(e,m0(i,null,"F")):this.rs(e,$,i,s)}))})))}Zi(e,i,u,g){return yC(i)||g.isEqual(gn.min())?ir.resolve(null):this.Ji.getDocuments(e,u).next(b=>{const I=this.ts(i,b);return this.ns(i,I,u,g)?ir.resolve(null):(Rm()<=Wn.DEBUG&&Fr("QueryEngine","Re-using previous result from %s to execute query: %s",g.toString(),_f(i)),this.rs(e,I,i,KU(g,-1)).next(L=>L))})}ts(e,i){let u=new os(vM(e));return i.forEach((g,b)=>{tv(e,b)&&(u=u.add(b))}),u}ns(e,i,u,g){if(e.limit===null)return!1;if(u.size!==i.size)return!0;const b=e.limitType==="F"?i.last():i.first();return!!b&&(b.hasPendingWrites||b.version.compareTo(g)>0)}Xi(e,i,u){return Rm()<=Wn.DEBUG&&Fr("QueryEngine","Using full collection scan to execute query:",_f(i)),this.Ji.getDocumentsMatchingQuery(e,i,Ju.min(),u)}rs(e,i,u,g){return this.Ji.getDocumentsMatchingQuery(e,u,g).next(b=>(i.forEach(I=>{b=b.insert(I.key,I)}),b))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T${constructor(e,i,u,g){this.persistence=e,this.ss=i,this.serializer=g,this.os=new Qi(ri),this._s=new ep(b=>Tw(b),Ew),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(u)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new h$(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.os))}}function E$(n,e,i,u){return new T$(n,e,i,u)}async function VM(n,e){const i=_n(n);return await i.persistence.runTransaction("Handle user change","readonly",u=>{let g;return i.mutationQueue.getAllMutationBatches(u).next(b=>(g=b,i.ls(e),i.mutationQueue.getAllMutationBatches(u))).next(b=>{const I=[],L=[];let s=Un();for(const $ of g){I.push($.batchId);for(const W of $.mutations)s=s.add(W.key)}for(const $ of b){L.push($.batchId);for(const W of $.mutations)s=s.add(W.key)}return i.localDocuments.getDocuments(u,s).next($=>({hs:$,removedBatchIds:I,addedBatchIds:L}))})})}function I$(n,e){const i=_n(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",u=>{const g=e.batch.keys(),b=i.cs.newChangeBuffer({trackRemovals:!0});return function(L,s,$,W){const Q=$.batch,ae=Q.keys();let we=ir.resolve();return ae.forEach(He=>{we=we.next(()=>W.getEntry(s,He)).next($e=>{const Ne=$.docVersions.get(He);Pi(Ne!==null),$e.version.compareTo(Ne)<0&&(Q.applyToRemoteDocument($e,$),$e.isValidDocument()&&($e.setReadTime($.commitVersion),W.addEntry($e)))})}),we.next(()=>L.mutationQueue.removeMutationBatch(s,Q))}(i,u,e,b).next(()=>b.apply(u)).next(()=>i.mutationQueue.performConsistencyCheck(u)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(u,g,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,function(L){let s=Un();for(let $=0;$<L.mutationResults.length;++$)L.mutationResults[$].transformResults.length>0&&(s=s.add(L.batch.mutations[$].key));return s}(e))).next(()=>i.localDocuments.getDocuments(u,g))})}function UM(n){const e=_n(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Ur.getLastRemoteSnapshotVersion(i))}function A$(n,e){const i=_n(n),u=e.snapshotVersion;let g=i.os;return i.persistence.runTransaction("Apply remote event","readwrite-primary",b=>{const I=i.cs.newChangeBuffer({trackRemovals:!0});g=i.os;const L=[];e.targetChanges.forEach((W,Q)=>{const ae=g.get(Q);if(!ae)return;L.push(i.Ur.removeMatchingKeys(b,W.removedDocuments,Q).next(()=>i.Ur.addMatchingKeys(b,W.addedDocuments,Q)));let we=ae.withSequenceNumber(b.currentSequenceNumber);e.targetMismatches.get(Q)!==null?we=we.withResumeToken(as.EMPTY_BYTE_STRING,gn.min()).withLastLimboFreeSnapshotVersion(gn.min()):W.resumeToken.approximateByteSize()>0&&(we=we.withResumeToken(W.resumeToken,u)),g=g.insert(Q,we),function($e,Ne,wt){return $e.resumeToken.approximateByteSize()===0||Ne.snapshotVersion.toMicroseconds()-$e.snapshotVersion.toMicroseconds()>=3e8?!0:wt.addedDocuments.size+wt.modifiedDocuments.size+wt.removedDocuments.size>0}(ae,we,W)&&L.push(i.Ur.updateTargetData(b,we))});let s=Gc(),$=Un();if(e.documentUpdates.forEach(W=>{e.resolvedLimboDocuments.has(W)&&L.push(i.persistence.referenceDelegate.updateLimboDocument(b,W))}),L.push(S$(b,I,e.documentUpdates).next(W=>{s=W.Ps,$=W.Is})),!u.isEqual(gn.min())){const W=i.Ur.getLastRemoteSnapshotVersion(b).next(Q=>i.Ur.setTargetsMetadata(b,b.currentSequenceNumber,u));L.push(W)}return ir.waitFor(L).next(()=>I.apply(b)).next(()=>i.localDocuments.getLocalViewOfDocuments(b,s,$)).next(()=>s)}).then(b=>(i.os=g,b))}function S$(n,e,i){let u=Un(),g=Un();return i.forEach(b=>u=u.add(b)),e.getEntries(n,u).next(b=>{let I=Gc();return i.forEach((L,s)=>{const $=b.get(L);s.isFoundDocument()!==$.isFoundDocument()&&(g=g.add(L)),s.isNoDocument()&&s.version.isEqual(gn.min())?(e.removeEntry(L,s.readTime),I=I.insert(L,s)):!$.isValidDocument()||s.version.compareTo($.version)>0||s.version.compareTo($.version)===0&&$.hasPendingWrites?(e.addEntry(s),I=I.insert(L,s)):Fr("LocalStore","Ignoring outdated watch update for ",L,". Current version:",$.version," Watch version:",s.version)}),{Ps:I,Is:g}})}function C$(n,e){const i=_n(n);return i.persistence.runTransaction("Get next mutation batch","readonly",u=>(e===void 0&&(e=-1),i.mutationQueue.getNextMutationBatchAfterBatchId(u,e)))}function R$(n,e){const i=_n(n);return i.persistence.runTransaction("Allocate target","readwrite",u=>{let g;return i.Ur.getTargetData(u,e).next(b=>b?(g=b,ir.resolve(g)):i.Ur.allocateTargetId(u).next(I=>(g=new $u(e,I,"TargetPurposeListen",u.currentSequenceNumber),i.Ur.addTargetData(u,g).next(()=>g))))}).then(u=>{const g=i.os.get(u.targetId);return(g===null||u.snapshotVersion.compareTo(g.snapshotVersion)>0)&&(i.os=i.os.insert(u.targetId,u),i._s.set(e,u.targetId)),u})}async function f1(n,e,i){const u=_n(n),g=u.os.get(e),b=i?"readwrite":"readwrite-primary";try{i||await u.persistence.runTransaction("Release target",b,I=>u.persistence.referenceDelegate.removeTarget(I,g))}catch(I){if(!Fg(I))throw I;Fr("LocalStore",`Failed to update sequence numbers for target ${e}: ${I}`)}u.os=u.os.remove(e),u._s.delete(g.target)}function RC(n,e,i){const u=_n(n);let g=gn.min(),b=Un();return u.persistence.runTransaction("Execute query","readwrite",I=>function(s,$,W){const Q=_n(s),ae=Q._s.get(W);return ae!==void 0?ir.resolve(Q.os.get(ae)):Q.Ur.getTargetData($,W)}(u,I,ac(e)).next(L=>{if(L)return g=L.lastLimboFreeSnapshotVersion,u.Ur.getMatchingKeysForTargetId(I,L.targetId).next(s=>{b=s})}).next(()=>u.ss.getDocumentsMatchingQuery(I,e,i?g:gn.min(),i?b:Un())).next(L=>(k$(u,vj(e),L),{documents:L,Ts:b})))}function k$(n,e,i){let u=n.us.get(e)||gn.min();i.forEach((g,b)=>{b.readTime.compareTo(u)>0&&(u=b.readTime)}),n.us.set(e,u)}class kC{constructor(){this.activeTargetIds=Ij()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class P${constructor(){this.so=new kC,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,u){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,i,u){this.oo[e]=i}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new kC,Promise.resolve()}handleUserChange(e,i,u){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M${_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Fr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Fr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sy=null;function vx(){return Sy===null?Sy=function(){return 268435456+Math.round(2147483648*Math.random())}():Sy++,"0x"+Sy.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D$={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L${constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ys="WebChannelConnection";class O$ extends class{constructor(i){this.databaseInfo=i,this.databaseId=i.databaseId;const u=i.ssl?"https":"http",g=encodeURIComponent(this.databaseId.projectId),b=encodeURIComponent(this.databaseId.database);this.Do=u+"://"+i.host,this.vo=`projects/${g}/databases/${b}`,this.Co=this.databaseId.database==="(default)"?`project_id=${g}`:`project_id=${g}&database_id=${b}`}get Fo(){return!1}Mo(i,u,g,b,I){const L=vx(),s=this.xo(i,u.toUriEncodedString());Fr("RestConnection",`Sending RPC '${i}' ${L}:`,s,g);const $={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo($,b,I),this.No(i,s,$,g).then(W=>(Fr("RestConnection",`Received RPC '${i}' ${L}: `,W),W),W=>{throw Uf("RestConnection",`RPC '${i}' ${L} failed with error: `,W,"url: ",s,"request:",g),W})}Lo(i,u,g,b,I,L){return this.Mo(i,u,g,b,I)}Oo(i,u,g){i["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Jf}(),i["Content-Type"]="text/plain",this.databaseInfo.appId&&(i["X-Firebase-GMPID"]=this.databaseInfo.appId),u&&u.headers.forEach((b,I)=>i[I]=b),g&&g.headers.forEach((b,I)=>i[I]=b)}xo(i,u){const g=D$[i];return`${this.Do}/v1/${u}:${g}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,i,u,g){const b=vx();return new Promise((I,L)=>{const s=new eM;s.setWithCredentials(!0),s.listenOnce(rM.COMPLETE,()=>{try{switch(s.getLastErrorCode()){case jy.NO_ERROR:const W=s.getResponseJson();Fr(ys,`XHR for RPC '${e}' ${b} received:`,JSON.stringify(W)),I(W);break;case jy.TIMEOUT:Fr(ys,`RPC '${e}' ${b} timed out`),L(new Dr(Jt.DEADLINE_EXCEEDED,"Request time out"));break;case jy.HTTP_ERROR:const Q=s.getStatus();if(Fr(ys,`RPC '${e}' ${b} failed with status:`,Q,"response text:",s.getResponseText()),Q>0){let ae=s.getResponseJson();Array.isArray(ae)&&(ae=ae[0]);const we=ae==null?void 0:ae.error;if(we&&we.status&&we.message){const He=function(Ne){const wt=Ne.toLowerCase().replace(/_/g,"-");return Object.values(Jt).indexOf(wt)>=0?wt:Jt.UNKNOWN}(we.status);L(new Dr(He,we.message))}else L(new Dr(Jt.UNKNOWN,"Server responded with status "+s.getStatus()))}else L(new Dr(Jt.UNAVAILABLE,"Connection failed."));break;default:hn()}}finally{Fr(ys,`RPC '${e}' ${b} completed.`)}});const $=JSON.stringify(g);Fr(ys,`RPC '${e}' ${b} sending request:`,g),s.send(i,"POST",$,u,15)})}Bo(e,i,u){const g=vx(),b=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],I=oM(),L=iM(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},$=this.longPollingOptions.timeoutSeconds;$!==void 0&&(s.longPollingTimeout=Math.round(1e3*$)),this.useFetchStreams&&(s.xmlHttpFactory=new tM({})),this.Oo(s.initMessageHeaders,i,u),s.encodeInitMessageHeaders=!0;const W=b.join("");Fr(ys,`Creating RPC '${e}' stream ${g}: ${W}`,s);const Q=I.createWebChannel(W,s);let ae=!1,we=!1;const He=new L$({Io:Ne=>{we?Fr(ys,`Not sending because RPC '${e}' stream ${g} is closed:`,Ne):(ae||(Fr(ys,`Opening RPC '${e}' stream ${g} transport.`),Q.open(),ae=!0),Fr(ys,`RPC '${e}' stream ${g} sending:`,Ne),Q.send(Ne))},To:()=>Q.close()}),$e=(Ne,wt,mt)=>{Ne.listen(wt,vt=>{try{mt(vt)}catch(zt){setTimeout(()=>{throw zt},0)}})};return $e(Q,zm.EventType.OPEN,()=>{we||(Fr(ys,`RPC '${e}' stream ${g} transport opened.`),He.yo())}),$e(Q,zm.EventType.CLOSE,()=>{we||(we=!0,Fr(ys,`RPC '${e}' stream ${g} transport closed`),He.So())}),$e(Q,zm.EventType.ERROR,Ne=>{we||(we=!0,Uf(ys,`RPC '${e}' stream ${g} transport errored:`,Ne),He.So(new Dr(Jt.UNAVAILABLE,"The operation could not be completed")))}),$e(Q,zm.EventType.MESSAGE,Ne=>{var wt;if(!we){const mt=Ne.data[0];Pi(!!mt);const vt=mt,zt=vt.error||((wt=vt[0])===null||wt===void 0?void 0:wt.error);if(zt){Fr(ys,`RPC '${e}' stream ${g} received error:`,zt);const Ct=zt.status;let qt=function(Fe){const Je=mo[Fe];if(Je!==void 0)return kM(Je)}(Ct),qe=zt.message;qt===void 0&&(qt=Jt.INTERNAL,qe="Unknown error status: "+Ct+" with message "+zt.message),we=!0,He.So(new Dr(qt,qe)),Q.close()}else Fr(ys,`RPC '${e}' stream ${g} received:`,mt),He.bo(mt)}}),$e(L,nM.STAT_EVENT,Ne=>{Ne.stat===n1.PROXY?Fr(ys,`RPC '${e}' stream ${g} detected buffering proxy`):Ne.stat===n1.NOPROXY&&Fr(ys,`RPC '${e}' stream ${g} detected no buffering proxy`)}),setTimeout(()=>{He.wo()},0),He}}function bx(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ov(n){return new Gj(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jM{constructor(e,i,u=1e3,g=1.5,b=6e4){this.ui=e,this.timerId=i,this.ko=u,this.qo=g,this.Qo=b,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const i=Math.floor(this.Ko+this.zo()),u=Math.max(0,Date.now()-this.Uo),g=Math.max(0,i-u);g>0&&Fr("ExponentialBackoff",`Backing off for ${g} ms (base delay: ${this.Ko} ms, delay with jitter: ${i} ms, last attempt: ${u} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,g,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $M{constructor(e,i,u,g,b,I,L,s){this.ui=e,this.Ho=u,this.Jo=g,this.connection=b,this.authCredentialsProvider=I,this.appCheckCredentialsProvider=L,this.listener=s,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new jM(e,i)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,i){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():i&&i.code===Jt.RESOURCE_EXHAUSTED?(qc(i.toString()),qc("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):i&&i.code===Jt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(i)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),i=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([u,g])=>{this.Yo===i&&this.P_(u,g)},u=>{e(()=>{const g=new Dr(Jt.UNKNOWN,"Fetching auth token failed: "+u.message);return this.I_(g)})})}P_(e,i){const u=this.h_(this.Yo);this.stream=this.T_(e,i),this.stream.Eo(()=>{u(()=>this.listener.Eo())}),this.stream.Ro(()=>{u(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(g=>{u(()=>this.I_(g))}),this.stream.onMessage(g=>{u(()=>++this.e_==1?this.E_(g):this.onNext(g))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return Fr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return i=>{this.ui.enqueueAndForget(()=>this.Yo===e?i():(Fr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class B$ extends $M{constructor(e,i,u,g,b,I){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,u,g,I),this.serializer=b}T_(e,i){return this.connection.Bo("Listen",e,i)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const i=Zj(this.serializer,e),u=function(b){if(!("targetChange"in b))return gn.min();const I=b.targetChange;return I.targetIds&&I.targetIds.length?gn.min():I.readTime?lc(I.readTime):gn.min()}(e);return this.listener.d_(i,u)}A_(e){const i={};i.database=d1(this.serializer),i.addTarget=function(b,I){let L;const s=I.target;if(L=a1(s)?{documents:Yj(b,s)}:{query:Jj(b,s)._t},L.targetId=I.targetId,I.resumeToken.approximateByteSize()>0){L.resumeToken=DM(b,I.resumeToken);const $=c1(b,I.expectedCount);$!==null&&(L.expectedCount=$)}else if(I.snapshotVersion.compareTo(gn.min())>0){L.readTime=_0(b,I.snapshotVersion.toTimestamp());const $=c1(b,I.expectedCount);$!==null&&(L.expectedCount=$)}return L}(this.serializer,e);const u=e$(this.serializer,e);u&&(i.labels=u),this.a_(i)}R_(e){const i={};i.database=d1(this.serializer),i.removeTarget=e,this.a_(i)}}class z$ extends $M{constructor(e,i,u,g,b,I){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,u,g,I),this.serializer=b}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,i){return this.connection.Bo("Write",e,i)}E_(e){return Pi(!!e.streamToken),this.lastStreamToken=e.streamToken,Pi(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Pi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const i=Kj(e.writeResults,e.commitTime),u=lc(e.commitTime);return this.listener.g_(u,i)}p_(){const e={};e.database=d1(this.serializer),this.a_(e)}m_(e){const i={streamToken:this.lastStreamToken,writes:e.map(u=>Xj(this.serializer,u))};this.a_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F$ extends class{}{constructor(e,i,u,g){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=u,this.serializer=g,this.y_=!1}w_(){if(this.y_)throw new Dr(Jt.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,i,u,g){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([b,I])=>this.connection.Mo(e,u1(i,u),g,b,I)).catch(b=>{throw b.name==="FirebaseError"?(b.code===Jt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),b):new Dr(Jt.UNKNOWN,b.toString())})}Lo(e,i,u,g,b){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([I,L])=>this.connection.Lo(e,u1(i,u),g,I,L,b)).catch(I=>{throw I.name==="FirebaseError"?(I.code===Jt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),I):new Dr(Jt.UNKNOWN,I.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class N${constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(qc(i),this.D_=!1):Fr("OnlineStateTracker",i)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V${constructor(e,i,u,g,b){this.localStore=e,this.datastore=i,this.asyncQueue=u,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=b,this.k_._o(I=>{u.enqueueAndForget(async()=>{md(this)&&(Fr("RemoteStore","Restarting streams for network reachability change."),await async function(s){const $=_n(s);$.L_.add(4),await Ug($),$.q_.set("Unknown"),$.L_.delete(4),await sv($)}(this))})}),this.q_=new N$(u,g)}}async function sv(n){if(md(n))for(const e of n.B_)await e(!0)}async function Ug(n){for(const e of n.B_)await e(!1)}function qM(n,e){const i=_n(n);i.N_.has(e.targetId)||(i.N_.set(e.targetId,e),zw(i)?Bw(i):tp(i).r_()&&Ow(i,e))}function Lw(n,e){const i=_n(n),u=tp(i);i.N_.delete(e),u.r_()&&GM(i,e),i.N_.size===0&&(u.r_()?u.o_():md(i)&&i.q_.set("Unknown"))}function Ow(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(gn.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}tp(n).A_(e)}function GM(n,e){n.Q_.xe(e),tp(n).R_(e)}function Bw(n){n.Q_=new Uj({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),tp(n).start(),n.q_.v_()}function zw(n){return md(n)&&!tp(n).n_()&&n.N_.size>0}function md(n){return _n(n).L_.size===0}function HM(n){n.Q_=void 0}async function U$(n){n.q_.set("Online")}async function j$(n){n.N_.forEach((e,i)=>{Ow(n,e)})}async function $$(n,e){HM(n),zw(n)?(n.q_.M_(e),Bw(n)):n.q_.set("Unknown")}async function q$(n,e,i){if(n.q_.set("Online"),e instanceof MM&&e.state===2&&e.cause)try{await async function(g,b){const I=b.cause;for(const L of b.targetIds)g.N_.has(L)&&(await g.remoteSyncer.rejectListen(L,I),g.N_.delete(L),g.Q_.removeTarget(L))}(n,e)}catch(u){Fr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),u),await y0(n,u)}else if(e instanceof Gy?n.Q_.Ke(e):e instanceof PM?n.Q_.He(e):n.Q_.We(e),!i.isEqual(gn.min()))try{const u=await UM(n.localStore);i.compareTo(u)>=0&&await function(b,I){const L=b.Q_.rt(I);return L.targetChanges.forEach((s,$)=>{if(s.resumeToken.approximateByteSize()>0){const W=b.N_.get($);W&&b.N_.set($,W.withResumeToken(s.resumeToken,I))}}),L.targetMismatches.forEach((s,$)=>{const W=b.N_.get(s);if(!W)return;b.N_.set(s,W.withResumeToken(as.EMPTY_BYTE_STRING,W.snapshotVersion)),GM(b,s);const Q=new $u(W.target,s,$,W.sequenceNumber);Ow(b,Q)}),b.remoteSyncer.applyRemoteEvent(L)}(n,i)}catch(u){Fr("RemoteStore","Failed to raise snapshot:",u),await y0(n,u)}}async function y0(n,e,i){if(!Fg(e))throw e;n.L_.add(1),await Ug(n),n.q_.set("Offline"),i||(i=()=>UM(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Fr("RemoteStore","Retrying IndexedDB access"),await i(),n.L_.delete(1),await sv(n)})}function WM(n,e){return e().catch(i=>y0(n,i,e))}async function av(n){const e=_n(n),i=eh(e);let u=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;G$(e);)try{const g=await C$(e.localStore,u);if(g===null){e.O_.length===0&&i.o_();break}u=g.batchId,H$(e,g)}catch(g){await y0(e,g)}ZM(e)&&XM(e)}function G$(n){return md(n)&&n.O_.length<10}function H$(n,e){n.O_.push(e);const i=eh(n);i.r_()&&i.V_&&i.m_(e.mutations)}function ZM(n){return md(n)&&!eh(n).n_()&&n.O_.length>0}function XM(n){eh(n).start()}async function W$(n){eh(n).p_()}async function Z$(n){const e=eh(n);for(const i of n.O_)e.m_(i.mutations)}async function X$(n,e,i){const u=n.O_.shift(),g=Cw.from(u,e,i);await WM(n,()=>n.remoteSyncer.applySuccessfulWrite(g)),await av(n)}async function K$(n,e){e&&eh(n).V_&&await async function(u,g){if(function(I){return Fj(I)&&I!==Jt.ABORTED}(g.code)){const b=u.O_.shift();eh(u).s_(),await WM(u,()=>u.remoteSyncer.rejectFailedWrite(b.batchId,g)),await av(u)}}(n,e),ZM(n)&&XM(n)}async function MC(n,e){const i=_n(n);i.asyncQueue.verifyOperationInProgress(),Fr("RemoteStore","RemoteStore received new credentials");const u=md(i);i.L_.add(3),await Ug(i),u&&i.q_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.L_.delete(3),await sv(i)}async function Y$(n,e){const i=_n(n);e?(i.L_.delete(2),await sv(i)):e||(i.L_.add(2),await Ug(i),i.q_.set("Unknown"))}function tp(n){return n.K_||(n.K_=function(i,u,g){const b=_n(i);return b.w_(),new B$(u,b.connection,b.authCredentials,b.appCheckCredentials,b.serializer,g)}(n.datastore,n.asyncQueue,{Eo:U$.bind(null,n),Ro:j$.bind(null,n),mo:$$.bind(null,n),d_:q$.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),zw(n)?Bw(n):n.q_.set("Unknown")):(await n.K_.stop(),HM(n))})),n.K_}function eh(n){return n.U_||(n.U_=function(i,u,g){const b=_n(i);return b.w_(),new z$(u,b.connection,b.authCredentials,b.appCheckCredentials,b.serializer,g)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:W$.bind(null,n),mo:K$.bind(null,n),f_:Z$.bind(null,n),g_:X$.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await av(n)):(await n.U_.stop(),n.O_.length>0&&(Fr("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e,i,u,g,b){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=u,this.op=g,this.removalCallback=b,this.deferred=new Vc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(I=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,u,g,b){const I=Date.now()+u,L=new Fw(e,i,I,g,b);return L.start(u),L}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Dr(Jt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Nw(n,e){if(qc("AsyncQueue",`${e}: ${n}`),Fg(n))return new Dr(Jt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(e){this.comparator=e?(i,u)=>e(i,u)||Jr.comparator(i.key,u.key):(i,u)=>Jr.comparator(i.key,u.key),this.keyedMap=Fm(),this.sortedSet=new Qi(this.comparator)}static emptySet(e){return new kf(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,u)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof kf)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),u=e.sortedSet.getIterator();for(;i.hasNext();){const g=i.getNext().key,b=u.getNext().key;if(!g.isEqual(b))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const u=new kf;return u.comparator=this.comparator,u.keyedMap=e,u.sortedSet=i,u}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DC{constructor(){this.W_=new Qi(Jr.comparator)}track(e){const i=e.doc.key,u=this.W_.get(i);u?e.type!==0&&u.type===3?this.W_=this.W_.insert(i,e):e.type===3&&u.type!==1?this.W_=this.W_.insert(i,{type:u.type,doc:e.doc}):e.type===2&&u.type===2?this.W_=this.W_.insert(i,{type:2,doc:e.doc}):e.type===2&&u.type===0?this.W_=this.W_.insert(i,{type:0,doc:e.doc}):e.type===1&&u.type===0?this.W_=this.W_.remove(i):e.type===1&&u.type===2?this.W_=this.W_.insert(i,{type:1,doc:u.doc}):e.type===0&&u.type===1?this.W_=this.W_.insert(i,{type:2,doc:e.doc}):hn():this.W_=this.W_.insert(i,e)}G_(){const e=[];return this.W_.inorderTraversal((i,u)=>{e.push(u)}),e}}class Hf{constructor(e,i,u,g,b,I,L,s,$){this.query=e,this.docs=i,this.oldDocs=u,this.docChanges=g,this.mutatedKeys=b,this.fromCache=I,this.syncStateChanged=L,this.excludesMetadataChanges=s,this.hasCachedResults=$}static fromInitialDocuments(e,i,u,g,b){const I=[];return i.forEach(L=>{I.push({type:0,doc:L})}),new Hf(e,i,kf.emptySet(i),I,u,g,!0,!1,b)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ev(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,u=e.docChanges;if(i.length!==u.length)return!1;for(let g=0;g<i.length;g++)if(i[g].type!==u[g].type||!i[g].doc.isEqual(u[g].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J${constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Q${constructor(){this.queries=LC(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(i,u){const g=_n(i),b=g.queries;g.queries=LC(),b.forEach((I,L)=>{for(const s of L.j_)s.onError(u)})})(this,new Dr(Jt.ABORTED,"Firestore shutting down"))}}function LC(){return new ep(n=>yM(n),ev)}async function KM(n,e){const i=_n(n);let u=3;const g=e.query;let b=i.queries.get(g);b?!b.H_()&&e.J_()&&(u=2):(b=new J$,u=e.J_()?0:1);try{switch(u){case 0:b.z_=await i.onListen(g,!0);break;case 1:b.z_=await i.onListen(g,!1);break;case 2:await i.onFirstRemoteStoreListen(g)}}catch(I){const L=Nw(I,`Initialization of query '${_f(e.query)}' failed`);return void e.onError(L)}i.queries.set(g,b),b.j_.push(e),e.Z_(i.onlineState),b.z_&&e.X_(b.z_)&&Vw(i)}async function YM(n,e){const i=_n(n),u=e.query;let g=3;const b=i.queries.get(u);if(b){const I=b.j_.indexOf(e);I>=0&&(b.j_.splice(I,1),b.j_.length===0?g=e.J_()?0:1:!b.H_()&&e.J_()&&(g=2))}switch(g){case 0:return i.queries.delete(u),i.onUnlisten(u,!0);case 1:return i.queries.delete(u),i.onUnlisten(u,!1);case 2:return i.onLastRemoteStoreUnlisten(u);default:return}}function e3(n,e){const i=_n(n);let u=!1;for(const g of e){const b=g.query,I=i.queries.get(b);if(I){for(const L of I.j_)L.X_(g)&&(u=!0);I.z_=g}}u&&Vw(i)}function t3(n,e,i){const u=_n(n),g=u.queries.get(e);if(g)for(const b of g.j_)b.onError(i);u.queries.delete(e)}function Vw(n){n.Y_.forEach(e=>{e.next()})}var p1,OC;(OC=p1||(p1={})).ea="default",OC.Cache="cache";class JM{constructor(e,i,u){this.query=e,this.ta=i,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=u||{}}X_(e){if(!this.options.includeMetadataChanges){const u=[];for(const g of e.docChanges)g.type!==3&&u.push(g);e=new Hf(e.query,e.docs,e.oldDocs,u,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.na?this.ia(e)&&(this.ta.next(e),i=!0):this.sa(e,this.onlineState)&&(this.oa(e),i=!0),this.ra=e,i}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let i=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),i=!0),i}sa(e,i){if(!e.fromCache||!this.J_())return!0;const u=i!=="Offline";return(!this.options._a||!u)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const i=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}oa(e){e=Hf.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==p1.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QM{constructor(e){this.key=e}}class eD{constructor(e){this.key=e}}class r3{constructor(e,i){this.query=e,this.Ta=i,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Un(),this.mutatedKeys=Un(),this.Aa=vM(e),this.Ra=new kf(this.Aa)}get Va(){return this.Ta}ma(e,i){const u=i?i.fa:new DC,g=i?i.Ra:this.Ra;let b=i?i.mutatedKeys:this.mutatedKeys,I=g,L=!1;const s=this.query.limitType==="F"&&g.size===this.query.limit?g.last():null,$=this.query.limitType==="L"&&g.size===this.query.limit?g.first():null;if(e.inorderTraversal((W,Q)=>{const ae=g.get(W),we=tv(this.query,Q)?Q:null,He=!!ae&&this.mutatedKeys.has(ae.key),$e=!!we&&(we.hasLocalMutations||this.mutatedKeys.has(we.key)&&we.hasCommittedMutations);let Ne=!1;ae&&we?ae.data.isEqual(we.data)?He!==$e&&(u.track({type:3,doc:we}),Ne=!0):this.ga(ae,we)||(u.track({type:2,doc:we}),Ne=!0,(s&&this.Aa(we,s)>0||$&&this.Aa(we,$)<0)&&(L=!0)):!ae&&we?(u.track({type:0,doc:we}),Ne=!0):ae&&!we&&(u.track({type:1,doc:ae}),Ne=!0,(s||$)&&(L=!0)),Ne&&(we?(I=I.add(we),b=$e?b.add(W):b.delete(W)):(I=I.delete(W),b=b.delete(W)))}),this.query.limit!==null)for(;I.size>this.query.limit;){const W=this.query.limitType==="F"?I.last():I.first();I=I.delete(W.key),b=b.delete(W.key),u.track({type:1,doc:W})}return{Ra:I,fa:u,ns:L,mutatedKeys:b}}ga(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,u,g){const b=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const I=e.fa.G_();I.sort((W,Q)=>function(we,He){const $e=Ne=>{switch(Ne){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return hn()}};return $e(we)-$e(He)}(W.type,Q.type)||this.Aa(W.doc,Q.doc)),this.pa(u),g=g!=null&&g;const L=i&&!g?this.ya():[],s=this.da.size===0&&this.current&&!g?1:0,$=s!==this.Ea;return this.Ea=s,I.length!==0||$?{snapshot:new Hf(this.query,e.Ra,b,I,e.mutatedKeys,s===0,$,!1,!!u&&u.resumeToken.approximateByteSize()>0),wa:L}:{wa:L}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new DC,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(i=>this.Ta=this.Ta.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.Ta=this.Ta.delete(i)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Un(),this.Ra.forEach(u=>{this.Sa(u.key)&&(this.da=this.da.add(u.key))});const i=[];return e.forEach(u=>{this.da.has(u)||i.push(new eD(u))}),this.da.forEach(u=>{e.has(u)||i.push(new QM(u))}),i}ba(e){this.Ta=e.Ts,this.da=Un();const i=this.ma(e.documents);return this.applyChanges(i,!0)}Da(){return Hf.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class n3{constructor(e,i,u){this.query=e,this.targetId=i,this.view=u}}class i3{constructor(e){this.key=e,this.va=!1}}class o3{constructor(e,i,u,g,b,I){this.localStore=e,this.remoteStore=i,this.eventManager=u,this.sharedClientState=g,this.currentUser=b,this.maxConcurrentLimboResolutions=I,this.Ca={},this.Fa=new ep(L=>yM(L),ev),this.Ma=new Map,this.xa=new Set,this.Oa=new Qi(Jr.comparator),this.Na=new Map,this.La=new Pw,this.Ba={},this.ka=new Map,this.qa=Gf.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function s3(n,e,i=!0){const u=sD(n);let g;const b=u.Fa.get(e);return b?(u.sharedClientState.addLocalQueryTarget(b.targetId),g=b.view.Da()):g=await tD(u,e,i,!0),g}async function a3(n,e){const i=sD(n);await tD(i,e,!0,!1)}async function tD(n,e,i,u){const g=await R$(n.localStore,ac(e)),b=g.targetId,I=i?n.sharedClientState.addLocalQueryTarget(b):"not-current";let L;return u&&(L=await l3(n,e,b,I==="current",g.resumeToken)),n.isPrimaryClient&&i&&qM(n.remoteStore,g),L}async function l3(n,e,i,u,g){n.Ka=(Q,ae,we)=>async function($e,Ne,wt,mt){let vt=Ne.view.ma(wt);vt.ns&&(vt=await RC($e.localStore,Ne.query,!1).then(({documents:qe})=>Ne.view.ma(qe,vt)));const zt=mt&&mt.targetChanges.get(Ne.targetId),Ct=mt&&mt.targetMismatches.get(Ne.targetId)!=null,qt=Ne.view.applyChanges(vt,$e.isPrimaryClient,zt,Ct);return zC($e,Ne.targetId,qt.wa),qt.snapshot}(n,Q,ae,we);const b=await RC(n.localStore,e,!0),I=new r3(e,b.Ts),L=I.ma(b.documents),s=Vg.createSynthesizedTargetChangeForCurrentChange(i,u&&n.onlineState!=="Offline",g),$=I.applyChanges(L,n.isPrimaryClient,s);zC(n,i,$.wa);const W=new n3(e,i,I);return n.Fa.set(e,W),n.Ma.has(i)?n.Ma.get(i).push(e):n.Ma.set(i,[e]),$.snapshot}async function c3(n,e,i){const u=_n(n),g=u.Fa.get(e),b=u.Ma.get(g.targetId);if(b.length>1)return u.Ma.set(g.targetId,b.filter(I=>!ev(I,e))),void u.Fa.delete(e);u.isPrimaryClient?(u.sharedClientState.removeLocalQueryTarget(g.targetId),u.sharedClientState.isActiveQueryTarget(g.targetId)||await f1(u.localStore,g.targetId,!1).then(()=>{u.sharedClientState.clearQueryState(g.targetId),i&&Lw(u.remoteStore,g.targetId),m1(u,g.targetId)}).catch(zg)):(m1(u,g.targetId),await f1(u.localStore,g.targetId,!0))}async function u3(n,e){const i=_n(n),u=i.Fa.get(e),g=i.Ma.get(u.targetId);i.isPrimaryClient&&g.length===1&&(i.sharedClientState.removeLocalQueryTarget(u.targetId),Lw(i.remoteStore,u.targetId))}async function h3(n,e,i){const u=y3(n);try{const g=await function(I,L){const s=_n(I),$=Ao.now(),W=L.reduce((we,He)=>we.add(He.key),Un());let Q,ae;return s.persistence.runTransaction("Locally write mutations","readwrite",we=>{let He=Gc(),$e=Un();return s.cs.getEntries(we,W).next(Ne=>{He=Ne,He.forEach((wt,mt)=>{mt.isValidDocument()||($e=$e.add(wt))})}).next(()=>s.localDocuments.getOverlayedDocuments(we,He)).next(Ne=>{Q=Ne;const wt=[];for(const mt of L){const vt=Dj(mt,Q.get(mt.key).overlayedDocument);vt!=null&&wt.push(new ah(mt.key,vt,uM(vt.value.mapValue),Al.exists(!0)))}return s.mutationQueue.addMutationBatch(we,$,wt,L)}).next(Ne=>{ae=Ne;const wt=Ne.applyToLocalDocumentSet(Q,$e);return s.documentOverlayCache.saveOverlays(we,Ne.batchId,wt)})}).then(()=>({batchId:ae.batchId,changes:xM(Q)}))}(u.localStore,e);u.sharedClientState.addPendingMutation(g.batchId),function(I,L,s){let $=I.Ba[I.currentUser.toKey()];$||($=new Qi(ri)),$=$.insert(L,s),I.Ba[I.currentUser.toKey()]=$}(u,g.batchId,i),await jg(u,g.changes),await av(u.remoteStore)}catch(g){const b=Nw(g,"Failed to persist write");i.reject(b)}}async function rD(n,e){const i=_n(n);try{const u=await A$(i.localStore,e);e.targetChanges.forEach((g,b)=>{const I=i.Na.get(b);I&&(Pi(g.addedDocuments.size+g.modifiedDocuments.size+g.removedDocuments.size<=1),g.addedDocuments.size>0?I.va=!0:g.modifiedDocuments.size>0?Pi(I.va):g.removedDocuments.size>0&&(Pi(I.va),I.va=!1))}),await jg(i,u,e)}catch(u){await zg(u)}}function BC(n,e,i){const u=_n(n);if(u.isPrimaryClient&&i===0||!u.isPrimaryClient&&i===1){const g=[];u.Fa.forEach((b,I)=>{const L=I.view.Z_(e);L.snapshot&&g.push(L.snapshot)}),function(I,L){const s=_n(I);s.onlineState=L;let $=!1;s.queries.forEach((W,Q)=>{for(const ae of Q.j_)ae.Z_(L)&&($=!0)}),$&&Vw(s)}(u.eventManager,e),g.length&&u.Ca.d_(g),u.onlineState=e,u.isPrimaryClient&&u.sharedClientState.setOnlineState(e)}}async function d3(n,e,i){const u=_n(n);u.sharedClientState.updateQueryState(e,"rejected",i);const g=u.Na.get(e),b=g&&g.key;if(b){let I=new Qi(Jr.comparator);I=I.insert(b,Ts.newNoDocument(b,gn.min()));const L=Un().add(b),s=new iv(gn.min(),new Map,new Qi(ri),I,L);await rD(u,s),u.Oa=u.Oa.remove(b),u.Na.delete(e),Uw(u)}else await f1(u.localStore,e,!1).then(()=>m1(u,e,i)).catch(zg)}async function f3(n,e){const i=_n(n),u=e.batch.batchId;try{const g=await I$(i.localStore,e);iD(i,u,null),nD(i,u),i.sharedClientState.updateMutationState(u,"acknowledged"),await jg(i,g)}catch(g){await zg(g)}}async function p3(n,e,i){const u=_n(n);try{const g=await function(I,L){const s=_n(I);return s.persistence.runTransaction("Reject batch","readwrite-primary",$=>{let W;return s.mutationQueue.lookupMutationBatch($,L).next(Q=>(Pi(Q!==null),W=Q.keys(),s.mutationQueue.removeMutationBatch($,Q))).next(()=>s.mutationQueue.performConsistencyCheck($)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId($,W,L)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys($,W)).next(()=>s.localDocuments.getDocuments($,W))})}(u.localStore,e);iD(u,e,i),nD(u,e),u.sharedClientState.updateMutationState(e,"rejected",i),await jg(u,g)}catch(g){await zg(g)}}function nD(n,e){(n.ka.get(e)||[]).forEach(i=>{i.resolve()}),n.ka.delete(e)}function iD(n,e,i){const u=_n(n);let g=u.Ba[u.currentUser.toKey()];if(g){const b=g.get(e);b&&(i?b.reject(i):b.resolve(),g=g.remove(e)),u.Ba[u.currentUser.toKey()]=g}}function m1(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const u of n.Ma.get(e))n.Fa.delete(u),i&&n.Ca.$a(u,i);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(u=>{n.La.containsKey(u)||oD(n,u)})}function oD(n,e){n.xa.delete(e.path.canonicalString());const i=n.Oa.get(e);i!==null&&(Lw(n.remoteStore,i),n.Oa=n.Oa.remove(e),n.Na.delete(i),Uw(n))}function zC(n,e,i){for(const u of i)u instanceof QM?(n.La.addReference(u.key,e),m3(n,u)):u instanceof eD?(Fr("SyncEngine","Document no longer in limbo: "+u.key),n.La.removeReference(u.key,e),n.La.containsKey(u.key)||oD(n,u.key)):hn()}function m3(n,e){const i=e.key,u=i.path.canonicalString();n.Oa.get(i)||n.xa.has(u)||(Fr("SyncEngine","New document in limbo: "+i),n.xa.add(u),Uw(n))}function Uw(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const i=new Jr(Ui.fromString(e)),u=n.qa.next();n.Na.set(u,new i3(i)),n.Oa=n.Oa.insert(i,u),qM(n.remoteStore,new $u(ac(Iw(i.path)),u,"TargetPurposeLimboResolution",vw.oe))}}async function jg(n,e,i){const u=_n(n),g=[],b=[],I=[];u.Fa.isEmpty()||(u.Fa.forEach((L,s)=>{I.push(u.Ka(s,e,i).then($=>{var W;if(($||i)&&u.isPrimaryClient){const Q=$?!$.fromCache:(W=i==null?void 0:i.targetChanges.get(s.targetId))===null||W===void 0?void 0:W.current;u.sharedClientState.updateQueryState(s.targetId,Q?"current":"not-current")}if($){g.push($);const Q=Dw.Wi(s.targetId,$);b.push(Q)}}))}),await Promise.all(I),u.Ca.d_(g),await async function(s,$){const W=_n(s);try{await W.persistence.runTransaction("notifyLocalViewChanges","readwrite",Q=>ir.forEach($,ae=>ir.forEach(ae.$i,we=>W.persistence.referenceDelegate.addReference(Q,ae.targetId,we)).next(()=>ir.forEach(ae.Ui,we=>W.persistence.referenceDelegate.removeReference(Q,ae.targetId,we)))))}catch(Q){if(!Fg(Q))throw Q;Fr("LocalStore","Failed to update sequence numbers: "+Q)}for(const Q of $){const ae=Q.targetId;if(!Q.fromCache){const we=W.os.get(ae),He=we.snapshotVersion,$e=we.withLastLimboFreeSnapshotVersion(He);W.os=W.os.insert(ae,$e)}}}(u.localStore,b))}async function g3(n,e){const i=_n(n);if(!i.currentUser.isEqual(e)){Fr("SyncEngine","User change. New user:",e.toKey());const u=await VM(i.localStore,e);i.currentUser=e,function(b,I){b.ka.forEach(L=>{L.forEach(s=>{s.reject(new Dr(Jt.CANCELLED,I))})}),b.ka.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,u.removedBatchIds,u.addedBatchIds),await jg(i,u.hs)}}function _3(n,e){const i=_n(n),u=i.Na.get(e);if(u&&u.va)return Un().add(u.key);{let g=Un();const b=i.Ma.get(e);if(!b)return g;for(const I of b){const L=i.Fa.get(I);g=g.unionWith(L.view.Va)}return g}}function sD(n){const e=_n(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=rD.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=_3.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=d3.bind(null,e),e.Ca.d_=e3.bind(null,e.eventManager),e.Ca.$a=t3.bind(null,e.eventManager),e}function y3(n){const e=_n(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=f3.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=p3.bind(null,e),e}class FC{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=ov(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,i){return null}createIndexBackfillerScheduler(e,i){return null}createLocalStore(e){return E$(this.persistence,new w$,e.initialUser,this.serializer)}createPersistence(e){return new v$(Mw.Zr,this.serializer)}createSharedClientState(e){return new P$}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class v3{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=u=>BC(this.syncEngine,u,1),this.remoteStore.remoteSyncer.handleCredentialChange=g3.bind(null,this.syncEngine),await Y$(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Q$}()}createDatastore(e){const i=ov(e.databaseInfo.databaseId),u=function(b){return new O$(b)}(e.databaseInfo);return function(b,I,L,s){return new F$(b,I,L,s)}(e.authCredentials,e.appCheckCredentials,u,i)}createRemoteStore(e){return function(u,g,b,I,L){return new V$(u,g,b,I,L)}(this.localStore,this.datastore,e.asyncQueue,i=>BC(this.syncEngine,i,0),function(){return PC.D()?new PC:new M$}())}createSyncEngine(e,i){return function(g,b,I,L,s,$,W){const Q=new o3(g,b,I,L,s,$);return W&&(Q.Qa=!0),Q}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(g){const b=_n(g);Fr("RemoteStore","RemoteStore shutting down."),b.L_.add(5),await Ug(b),b.k_.shutdown(),b.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aD{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):qc("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,i){this.muted||setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b3{constructor(e,i,u,g){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=u,this.databaseInfo=g,this.user=xs.UNAUTHENTICATED,this.clientId=aM.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(u,async b=>{Fr("FirestoreClient","Received user=",b.uid),await this.authCredentialListener(b),this.user=b}),this.appCheckCredentials.start(u,b=>(Fr("FirestoreClient","Received new app check token=",b),this.appCheckCredentialListener(b,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Dr(Jt.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Vc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const u=Nw(i,"Failed to shutdown persistence");e.reject(u)}}),e.promise}}async function xx(n,e){n.asyncQueue.verifyOperationInProgress(),Fr("FirestoreClient","Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let u=i.initialUser;n.setCredentialChangeListener(async g=>{u.isEqual(g)||(await VM(e.localStore,g),u=g)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function NC(n,e){n.asyncQueue.verifyOperationInProgress();const i=await w3(n);Fr("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(u=>MC(e.remoteStore,u)),n.setAppCheckTokenChangeListener((u,g)=>MC(e.remoteStore,g)),n._onlineComponents=e}function x3(n){return n.name==="FirebaseError"?n.code===Jt.FAILED_PRECONDITION||n.code===Jt.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}async function w3(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Fr("FirestoreClient","Using user provided OfflineComponentProvider");try{await xx(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!x3(i))throw i;Uf("Error using user provided cache. Falling back to memory cache: "+i),await xx(n,new FC)}}else Fr("FirestoreClient","Using default OfflineComponentProvider"),await xx(n,new FC);return n._offlineComponents}async function lD(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Fr("FirestoreClient","Using user provided OnlineComponentProvider"),await NC(n,n._uninitializedComponentsProvider._online)):(Fr("FirestoreClient","Using default OnlineComponentProvider"),await NC(n,new v3))),n._onlineComponents}function T3(n){return lD(n).then(e=>e.syncEngine)}async function cD(n){const e=await lD(n),i=e.eventManager;return i.onListen=s3.bind(null,e.syncEngine),i.onUnlisten=c3.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=a3.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=u3.bind(null,e.syncEngine),i}function E3(n,e,i={}){const u=new Vc;return n.asyncQueue.enqueueAndForget(async()=>function(b,I,L,s,$){const W=new aD({next:ae=>{I.enqueueAndForget(()=>YM(b,Q));const we=ae.docs.has(L);!we&&ae.fromCache?$.reject(new Dr(Jt.UNAVAILABLE,"Failed to get document because the client is offline.")):we&&ae.fromCache&&s&&s.source==="server"?$.reject(new Dr(Jt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):$.resolve(ae)},error:ae=>$.reject(ae)}),Q=new JM(Iw(L.path),W,{includeMetadataChanges:!0,_a:!0});return KM(b,Q)}(await cD(n),n.asyncQueue,e,i,u)),u.promise}function I3(n,e,i={}){const u=new Vc;return n.asyncQueue.enqueueAndForget(async()=>function(b,I,L,s,$){const W=new aD({next:ae=>{I.enqueueAndForget(()=>YM(b,Q)),ae.fromCache&&s.source==="server"?$.reject(new Dr(Jt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):$.resolve(ae)},error:ae=>$.reject(ae)}),Q=new JM(L,W,{includeMetadataChanges:!0,_a:!0});return KM(b,Q)}(await cD(n),n.asyncQueue,e,i,u)),u.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uD(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VC=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hD(n,e,i){if(!i)throw new Dr(Jt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function A3(n,e,i,u){if(e===!0&&u===!0)throw new Dr(Jt.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function UC(n){if(!Jr.isDocumentKey(n))throw new Dr(Jt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function jC(n){if(Jr.isDocumentKey(n))throw new Dr(Jt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function lv(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(u){return u.constructor?u.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":hn()}function Hc(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Dr(Jt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=lv(n);throw new Dr(Jt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}function S3(n,e){if(e<=0)throw new Dr(Jt.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $C{constructor(e){var i,u;if(e.host===void 0){if(e.ssl!==void 0)throw new Dr(Jt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(i=e.ssl)===null||i===void 0||i;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Dr(Jt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}A3("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=uD((u=e.experimentalLongPollingOptions)!==null&&u!==void 0?u:{}),function(b){if(b.timeoutSeconds!==void 0){if(isNaN(b.timeoutSeconds))throw new Dr(Jt.INVALID_ARGUMENT,`invalid long polling timeout: ${b.timeoutSeconds} (must not be NaN)`);if(b.timeoutSeconds<5)throw new Dr(Jt.INVALID_ARGUMENT,`invalid long polling timeout: ${b.timeoutSeconds} (minimum allowed value is 5)`);if(b.timeoutSeconds>30)throw new Dr(Jt.INVALID_ARGUMENT,`invalid long polling timeout: ${b.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(u,g){return u.timeoutSeconds===g.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class cv{constructor(e,i,u,g){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=u,this._app=g,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $C({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Dr(Jt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new Dr(Jt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $C(e),e.credentials!==void 0&&(this._authCredentials=function(u){if(!u)return new UU;switch(u.type){case"firstParty":return new GU(u.sessionIndex||"0",u.iamToken||null,u.authTokenFactory||null);case"provider":return u.client;default:throw new Dr(Jt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const u=VC.get(i);u&&(Fr("ComponentProvider","Removing Datastore"),VC.delete(i),u.terminate())}(this),Promise.resolve()}}function C3(n,e,i,u={}){var g;const b=(n=Hc(n,cv))._getSettings(),I=`${e}:${i}`;if(b.host!=="firestore.googleapis.com"&&b.host!==I&&Uf("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},b),{host:I,ssl:!1})),u.mockUserToken){let L,s;if(typeof u.mockUserToken=="string")L=u.mockUserToken,s=xs.MOCK_USER;else{L=sV(u.mockUserToken,(g=n._app)===null||g===void 0?void 0:g.options.projectId);const $=u.mockUserToken.sub||u.mockUserToken.user_id;if(!$)throw new Dr(Jt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new xs($)}n._authCredentials=new jU(new sM(L,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lh{constructor(e,i,u){this.converter=i,this._query=u,this.type="query",this.firestore=e}withConverter(e){return new lh(this.firestore,e,this._query)}}class ca{constructor(e,i,u){this.converter=i,this._key=u,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ku(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ca(this.firestore,e,this._key)}}class Ku extends lh{constructor(e,i,u){super(e,i,Iw(u)),this._path=u,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ca(this.firestore,null,new Jr(e))}withConverter(e){return new Ku(this.firestore,e,this._path)}}function xg(n,e,...i){if(n=ss(n),hD("collection","path",e),n instanceof cv){const u=Ui.fromString(e,...i);return jC(u),new Ku(n,null,u)}{if(!(n instanceof ca||n instanceof Ku))throw new Dr(Jt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const u=n._path.child(Ui.fromString(e,...i));return jC(u),new Ku(n.firestore,null,u)}}function Hy(n,e,...i){if(n=ss(n),arguments.length===1&&(e=aM.newId()),hD("doc","path",e),n instanceof cv){const u=Ui.fromString(e,...i);return UC(u),new ca(n,null,new Jr(u))}{if(!(n instanceof ca||n instanceof Ku))throw new Dr(Jt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const u=n._path.child(Ui.fromString(e,...i));return UC(u),new ca(n.firestore,n instanceof Ku?n.converter:null,new Jr(u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R3{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new jM(this,"async_queue_retry"),this.Eu=()=>{const i=bx();i&&Fr("AsyncQueue","Visibility state changed to "+i.visibilityState),this.t_.jo()};const e=bx();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const i=bx();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const i=new Vc;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}async Ru(){if(this.uu.length!==0){try{await this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!Fg(e))throw e;Fr("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}}Au(e){const i=this.au.then(()=>(this.Pu=!0,e().catch(u=>{this.hu=u,this.Pu=!1;const g=function(I){let L=I.message||"";return I.stack&&(L=I.stack.includes(I.message)?I.stack:I.message+`
`+I.stack),L}(u);throw qc("INTERNAL UNHANDLED ERROR: ",g),u}).then(u=>(this.Pu=!1,u))));return this.au=i,i}enqueueAfterDelay(e,i,u){this.du(),this.Tu.indexOf(e)>-1&&(i=0);const g=Fw.createAndSchedule(this,e,i,u,b=>this.Vu(b));return this.lu.push(g),g}du(){this.hu&&hn()}verifyOperationInProgress(){}async mu(){let e;do e=this.au,await e;while(e!==this.au)}fu(e){for(const i of this.lu)if(i.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((i,u)=>i.targetTimeMs-u.targetTimeMs);for(const i of this.lu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const i=this.lu.indexOf(e);this.lu.splice(i,1)}}class rp extends cv{constructor(e,i,u,g){super(e,i,u,g),this.type="firestore",this._queue=function(){return new R3}(),this._persistenceKey=(g==null?void 0:g.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||dD(this),this._firestoreClient.terminate()}}function k3(n,e){const i=gP(),u="(default)",g=sw(i,"firestore").getImmediate({identifier:u});if(!g._initialized){const b=iV("firestore");b&&C3(g,...b)}return g}function jw(n){return n._firestoreClient||dD(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function dD(n){var e,i,u;const g=n._freezeSettings(),b=function(L,s,$,W){return new ij(L,s,$,W.host,W.ssl,W.experimentalForceLongPolling,W.experimentalAutoDetectLongPolling,uD(W.experimentalLongPollingOptions),W.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,g);n._firestoreClient=new b3(n._authCredentials,n._appCheckCredentials,n._queue,b),!((i=g.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((u=g.localCache)===null||u===void 0)&&u._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:g.localCache.kind,_offline:g.localCache._offlineComponentProvider,_online:g.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wf{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wf(as.fromBase64String(e))}catch(i){throw new Dr(Jt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new Wf(as.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new Dr(Jt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new is(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hv{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new Dr(Jt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new Dr(Jt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ri(this._lat,e._lat)||ri(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qw{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(u,g){if(u.length!==g.length)return!1;for(let b=0;b<u.length;++b)if(u[b]!==g[b])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P3=/^__.*__$/;class M3{constructor(e,i,u){this.data=e,this.fieldMask=i,this.fieldTransforms=u}toMutation(e,i){return this.fieldMask!==null?new ah(e,this.data,this.fieldMask,i,this.fieldTransforms):new Ng(e,this.data,i,this.fieldTransforms)}}class fD{constructor(e,i,u){this.data=e,this.fieldMask=i,this.fieldTransforms=u}toMutation(e,i){return new ah(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function pD(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw hn()}}class Gw{constructor(e,i,u,g,b,I){this.settings=e,this.databaseId=i,this.serializer=u,this.ignoreUndefinedProperties=g,b===void 0&&this.yu(),this.fieldTransforms=b||[],this.fieldMask=I||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new Gw(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var i;const u=(i=this.path)===null||i===void 0?void 0:i.child(e),g=this.Su({path:u,Du:!1});return g.vu(e),g}Cu(e){var i;const u=(i=this.path)===null||i===void 0?void 0:i.child(e),g=this.Su({path:u,Du:!1});return g.yu(),g}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return v0(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(pD(this.wu)&&P3.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class D3{constructor(e,i,u){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=u||ov(e)}Nu(e,i,u,g=!1){return new Gw({wu:e,methodName:i,Ou:u,path:is.emptyPath(),Du:!1,xu:g},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Hw(n){const e=n._freezeSettings(),i=ov(n._databaseId);return new D3(n._databaseId,!!e.ignoreUndefinedProperties,i)}function L3(n,e,i,u,g,b={}){const I=n.Nu(b.merge||b.mergeFields?2:0,e,i,g);Zw("Data must be an object, but it was:",I,u);const L=mD(u,I);let s,$;if(b.merge)s=new Ra(I.fieldMask),$=I.fieldTransforms;else if(b.mergeFields){const W=[];for(const Q of b.mergeFields){const ae=g1(e,Q,i);if(!I.contains(ae))throw new Dr(Jt.INVALID_ARGUMENT,`Field '${ae}' is specified in your field mask but missing from your input data.`);_D(W,ae)||W.push(ae)}s=new Ra(W),$=I.fieldTransforms.filter(Q=>s.covers(Q.field))}else s=null,$=I.fieldTransforms;return new M3(new aa(L),s,$)}class dv extends hv{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof dv}}class Ww extends hv{_toFieldTransform(e){return new Rj(e.path,new yg)}isEqual(e){return e instanceof Ww}}function O3(n,e,i,u){const g=n.Nu(1,e,i);Zw("Data must be an object, but it was:",g,u);const b=[],I=aa.empty();pd(u,(s,$)=>{const W=Xw(e,s,i);$=ss($);const Q=g.Cu(W);if($ instanceof dv)b.push(W);else{const ae=$g($,Q);ae!=null&&(b.push(W),I.set(W,ae))}});const L=new Ra(b);return new fD(I,L,g.fieldTransforms)}function B3(n,e,i,u,g,b){const I=n.Nu(1,e,i),L=[g1(e,u,i)],s=[g];if(b.length%2!=0)throw new Dr(Jt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let ae=0;ae<b.length;ae+=2)L.push(g1(e,b[ae])),s.push(b[ae+1]);const $=[],W=aa.empty();for(let ae=L.length-1;ae>=0;--ae)if(!_D($,L[ae])){const we=L[ae];let He=s[ae];He=ss(He);const $e=I.Cu(we);if(He instanceof dv)$.push(we);else{const Ne=$g(He,$e);Ne!=null&&($.push(we),W.set(we,Ne))}}const Q=new Ra($);return new fD(W,Q,I.fieldTransforms)}function z3(n,e,i,u=!1){return $g(i,n.Nu(u?4:3,e))}function $g(n,e){if(gD(n=ss(n)))return Zw("Unsupported field value:",e,n),mD(n,e);if(n instanceof hv)return function(u,g){if(!pD(g.wu))throw g.Mu(`${u._methodName}() can only be used with update() and set()`);if(!g.path)throw g.Mu(`${u._methodName}() is not currently supported inside arrays`);const b=u._toFieldTransform(g);b&&g.fieldTransforms.push(b)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(u,g){const b=[];let I=0;for(const L of u){let s=$g(L,g.Fu(I));s==null&&(s={nullValue:"NULL_VALUE"}),b.push(s),I++}return{arrayValue:{values:b}}}(n,e)}return function(u,g){if((u=ss(u))===null)return{nullValue:"NULL_VALUE"};if(typeof u=="number")return Aj(g.serializer,u);if(typeof u=="boolean")return{booleanValue:u};if(typeof u=="string")return{stringValue:u};if(u instanceof Date){const b=Ao.fromDate(u);return{timestampValue:_0(g.serializer,b)}}if(u instanceof Ao){const b=new Ao(u.seconds,1e3*Math.floor(u.nanoseconds/1e3));return{timestampValue:_0(g.serializer,b)}}if(u instanceof $w)return{geoPointValue:{latitude:u.latitude,longitude:u.longitude}};if(u instanceof Wf)return{bytesValue:DM(g.serializer,u._byteString)};if(u instanceof ca){const b=g.databaseId,I=u.firestore._databaseId;if(!I.isEqual(b))throw g.Mu(`Document reference is for database ${I.projectId}/${I.database} but should be for database ${b.projectId}/${b.database}`);return{referenceValue:kw(u.firestore._databaseId||g.databaseId,u._key.path)}}if(u instanceof qw)return function(I,L){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:I.toArray().map(s=>{if(typeof s!="number")throw L.Mu("VectorValues must only contain numeric values.");return Aw(L.serializer,s)})}}}}}}(u,g);throw g.Mu(`Unsupported field value: ${lv(u)}`)}(n,e)}function mD(n,e){const i={};return lM(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):pd(n,(u,g)=>{const b=$g(g,e.bu(u));b!=null&&(i[u]=b)}),{mapValue:{fields:i}}}function gD(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ao||n instanceof $w||n instanceof Wf||n instanceof ca||n instanceof hv||n instanceof qw)}function Zw(n,e,i){if(!gD(i)||!function(g){return typeof g=="object"&&g!==null&&(Object.getPrototypeOf(g)===Object.prototype||Object.getPrototypeOf(g)===null)}(i)){const u=lv(i);throw u==="an object"?e.Mu(n+" a custom object"):e.Mu(n+" "+u)}}function g1(n,e,i){if((e=ss(e))instanceof uv)return e._internalPath;if(typeof e=="string")return Xw(n,e);throw v0("Field path arguments must be of type string or ",n,!1,void 0,i)}const F3=new RegExp("[~\\*/\\[\\]]");function Xw(n,e,i){if(e.search(F3)>=0)throw v0(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new uv(...e.split("."))._internalPath}catch{throw v0(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function v0(n,e,i,u,g){const b=u&&!u.isEmpty(),I=g!==void 0;let L=`Function ${e}() called with invalid data`;i&&(L+=" (via `toFirestore()`)"),L+=". ";let s="";return(b||I)&&(s+=" (found",b&&(s+=` in field ${u}`),I&&(s+=` in document ${g}`),s+=")"),new Dr(Jt.INVALID_ARGUMENT,L+n+s)}function _D(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yD{constructor(e,i,u,g,b){this._firestore=e,this._userDataWriter=i,this._key=u,this._document=g,this._converter=b}get id(){return this._key.path.lastSegment()}get ref(){return new ca(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new N3(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(fv("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class N3 extends yD{data(){return super.data()}}function fv(n,e){return typeof e=="string"?Xw(n,e):e instanceof uv?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V3(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Dr(Jt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Kw{}class Yw extends Kw{}function b0(n,e,...i){let u=[];e instanceof Kw&&u.push(e),u=u.concat(i),function(b){const I=b.filter(s=>s instanceof Jw).length,L=b.filter(s=>s instanceof pv).length;if(I>1||I>0&&L>0)throw new Dr(Jt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(u);for(const g of u)n=g._apply(n);return n}class pv extends Yw{constructor(e,i,u){super(),this._field=e,this._op=i,this._value=u,this.type="where"}static _create(e,i,u){return new pv(e,i,u)}_apply(e){const i=this._parse(e);return bD(e._query,i),new lh(e.firestore,e.converter,l1(e._query,i))}_parse(e){const i=Hw(e.firestore);return function(b,I,L,s,$,W,Q){let ae;if($.isKeyField()){if(W==="array-contains"||W==="array-contains-any")throw new Dr(Jt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${W}' queries on documentId().`);if(W==="in"||W==="not-in"){HC(Q,W);const we=[];for(const He of Q)we.push(GC(s,b,He));ae={arrayValue:{values:we}}}else ae=GC(s,b,Q)}else W!=="in"&&W!=="not-in"&&W!=="array-contains-any"||HC(Q,W),ae=z3(L,I,Q,W==="in"||W==="not-in");return go.create($,W,ae)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function tg(n,e,i){const u=e,g=fv("where",n);return pv._create(g,u,i)}class Jw extends Kw{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new Jw(e,i)}_parse(e){const i=this._queryConstraints.map(u=>u._parse(e)).filter(u=>u.getFilters().length>0);return i.length===1?i[0]:kl.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(g,b){let I=g;const L=b.getFlattenedFilters();for(const s of L)bD(I,s),I=l1(I,s)}(e._query,i),new lh(e.firestore,e.converter,l1(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Qw extends Yw{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new Qw(e,i)}_apply(e){const i=function(g,b,I){if(g.startAt!==null)throw new Dr(Jt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(g.endAt!==null)throw new Dr(Jt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new _g(b,I)}(e._query,this._field,this._direction);return new lh(e.firestore,e.converter,function(g,b){const I=g.explicitOrderBy.concat([b]);return new Qf(g.path,g.collectionGroup,I,g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(e._query,i))}}function qC(n,e="asc"){const i=e,u=fv("orderBy",n);return Qw._create(u,i)}class eT extends Yw{constructor(e,i,u){super(),this.type=e,this._limit=i,this._limitType=u}static _create(e,i,u){return new eT(e,i,u)}_apply(e){return new lh(e.firestore,e.converter,m0(e._query,this._limit,this._limitType))}}function vD(n){return S3("limit",n),eT._create("limit",n,"F")}function GC(n,e,i){if(typeof(i=ss(i))=="string"){if(i==="")throw new Dr(Jt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!_M(e)&&i.indexOf("/")!==-1)throw new Dr(Jt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const u=e.path.child(Ui.fromString(i));if(!Jr.isDocumentKey(u))throw new Dr(Jt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${u}' is not because it has an odd number of segments (${u.length}).`);return dC(n,new Jr(u))}if(i instanceof ca)return dC(n,i._key);throw new Dr(Jt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${lv(i)}.`)}function HC(n,e){if(!Array.isArray(n)||n.length===0)throw new Dr(Jt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function bD(n,e){const i=function(g,b){for(const I of g)for(const L of I.getFlattenedFilters())if(b.indexOf(L.op)>=0)return L.op;return null}(n.filters,function(g){switch(g){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new Dr(Jt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Dr(Jt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class U3{convertValue(e,i="none"){switch(ud(e)){case 0:return null;case 1:return e.booleanValue;case 2:return lo(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(cd(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw hn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const u={};return pd(e,(g,b)=>{u[g]=this.convertValue(b,i)}),u}convertVectorValue(e){var i,u,g;const b=(g=(u=(i=e.fields)===null||i===void 0?void 0:i.value.arrayValue)===null||u===void 0?void 0:u.values)===null||g===void 0?void 0:g.map(I=>lo(I.doubleValue));return new qw(b)}convertGeoPoint(e){return new $w(lo(e.latitude),lo(e.longitude))}convertArray(e,i){return(e.values||[]).map(u=>this.convertValue(u,i))}convertServerTimestamp(e,i){switch(i){case"previous":const u=xw(e);return u==null?null:this.convertValue(u,i);case"estimate":return this.convertTimestamp(pg(e));default:return null}}convertTimestamp(e){const i=Qu(e);return new Ao(i.seconds,i.nanos)}convertDocumentKey(e,i){const u=Ui.fromString(e);Pi(NM(u));const g=new mg(u.get(1),u.get(3)),b=new Jr(u.popFirst(5));return g.isEqual(i)||qc(`Document ${b} contains a document reference within a different database (${g.projectId}/${g.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),b}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j3(n,e,i){let u;return u=n?n.toFirestore(e):e,u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class xD extends yD{constructor(e,i,u,g,b,I){super(e,i,u,g,I),this._firestore=e,this._firestoreImpl=e,this.metadata=b}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new Wy(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const u=this._document.data.field(fv("DocumentSnapshot.get",e));if(u!==null)return this._userDataWriter.convertValue(u,i.serverTimestamps)}}}class Wy extends xD{data(e={}){return super.data(e)}}class $3{constructor(e,i,u,g){this._firestore=e,this._userDataWriter=i,this._snapshot=g,this.metadata=new Vm(g.hasPendingWrites,g.fromCache),this.query=u}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(u=>{e.call(i,new Wy(this._firestore,this._userDataWriter,u.key,u,new Vm(this._snapshot.mutatedKeys.has(u.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Dr(Jt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(g,b){if(g._snapshot.oldDocs.isEmpty()){let I=0;return g._snapshot.docChanges.map(L=>{const s=new Wy(g._firestore,g._userDataWriter,L.doc.key,L.doc,new Vm(g._snapshot.mutatedKeys.has(L.doc.key),g._snapshot.fromCache),g.query.converter);return L.doc,{type:"added",doc:s,oldIndex:-1,newIndex:I++}})}{let I=g._snapshot.oldDocs;return g._snapshot.docChanges.filter(L=>b||L.type!==3).map(L=>{const s=new Wy(g._firestore,g._userDataWriter,L.doc.key,L.doc,new Vm(g._snapshot.mutatedKeys.has(L.doc.key),g._snapshot.fromCache),g.query.converter);let $=-1,W=-1;return L.type!==0&&($=I.indexOf(L.doc.key),I=I.delete(L.doc.key)),L.type!==1&&(I=I.add(L.doc),W=I.indexOf(L.doc.key)),{type:q3(L.type),doc:s,oldIndex:$,newIndex:W}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function q3(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return hn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G3(n){n=Hc(n,ca);const e=Hc(n.firestore,rp);return E3(jw(e),n._key).then(i=>X3(e,n,i))}class wD extends U3{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wf(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new ca(this.firestore,null,i)}}function x0(n){n=Hc(n,lh);const e=Hc(n.firestore,rp),i=jw(e),u=new wD(e);return V3(n._query),I3(i,n._query).then(g=>new $3(e,u,n,g))}function H3(n,e,i,...u){n=Hc(n,ca);const g=Hc(n.firestore,rp),b=Hw(g);let I;return I=typeof(e=ss(e))=="string"||e instanceof uv?B3(b,"updateDoc",n._key,e,i,u):O3(b,"updateDoc",n._key,e),tT(g,[I.toMutation(n._key,Al.exists(!0))])}function W3(n){return tT(Hc(n.firestore,rp),[new Sw(n._key,Al.none())])}function Z3(n,e){const i=Hc(n.firestore,rp),u=Hy(n),g=j3(n.converter,e);return tT(i,[L3(Hw(n.firestore),"addDoc",u._key,g,n.converter!==null,{}).toMutation(u._key,Al.exists(!1))]).then(()=>u)}function tT(n,e){return function(u,g){const b=new Vc;return u.asyncQueue.enqueueAndForget(async()=>h3(await T3(u),g,b)),b.promise}(jw(n),e)}function X3(n,e,i){const u=i.docs.get(e._key),g=new wD(n);return new xD(n,g,e._key,u,new Vm(i.hasPendingWrites,i.fromCache),e.converter)}function K3(){return new Ww("serverTimestamp")}(function(e,i=!0){(function(g){Jf=g})(Kf),Vf(new od("firestore",(u,{instanceIdentifier:g,options:b})=>{const I=u.getProvider("app").getImmediate(),L=new rp(new $U(u.getProvider("auth-internal")),new WU(u.getProvider("app-check-internal")),function($,W){if(!Object.prototype.hasOwnProperty.apply($.options,["projectId"]))throw new Dr(Jt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new mg($.options.projectId,W)}(I,g),I);return b=Object.assign({useFetchStreams:i},b),L._setSettings(b),L},"PUBLIC").setMultipleInstances(!0)),Xu(aC,"4.7.1",e),Xu(aC,"4.7.1","esm2017")})();const Y3={apiKey:"AIzaSyAqyLCGo__iRXwuP_G9UUrCCKgZ8ebBHA0",authDomain:"week7-yupeng.firebaseapp.com",projectId:"week7-yupeng",storageBucket:"week7-yupeng.appspot.com",messagingSenderId:"54988424660",appId:"1:54988424660:web:cd87bf59030c04c6a58241",measurementId:"G-W73JGXXZSZ"};aw(Y3);const ju=k3(),J3={class:"container mt-5"},Q3={class:"row"},e8=dt("h1",{class:"text-center"},"User Login",-1),t8={class:"mb-3"},r8=dt("label",{for:"username",class:"form-label"},"Username",-1),n8={key:0,class:"text-danger"},i8={class:"mb-3"},o8=dt("label",{for:"password",class:"form-label"},"Password",-1),s8={key:0,class:"text-danger"},a8=dt("button",{type:"submit",class:"btn btn-primary me-2"},"Submit",-1),l8={__name:"LoginView",setup(n){const e=nw(),i=_w(),u=Fc({username:"",password:""}),g=async()=>{if(L(!0),s(!0),!I.value.username&&!I.value.password&&!I.value.confirmPassword&&!I.value.reason&&!I.value.validateFriend){E2(i,u.value.username,u.value.password).catch(Q=>{console.log(Q)}),sessionStorage.setItem("user",u.value.username);const $=b0(xg(ju,"users"),tg("email","==",u.value.username)),W=await x0($);console.log($),console.log(W),W.empty?(sessionStorage.setItem("role","customer"),sessionStorage.setItem("gender","Unkonwn"),console.log("No matching documents found.")):W.forEach(Q=>{console.log(Q.data().role),sessionStorage.setItem("role",Q.data().role),sessionStorage.setItem("gender",Q.data().gender)}),e.push("/week12/admin").then(()=>{location.reload()}),b()}},b=()=>{u.value={username:"",password:""}},I=Fc({username:null,password:null}),L=$=>{u.value.username.length<3?$&&(I.value.username="Name must be at least 3 characters"):I.value.username=null},s=$=>{const W=u.value.password,Q=8,ae=/[A-Z]/.test(W),we=/[a-z]/.test(W),He=/\d/.test(W),$e=/[!@#$%^&*(),.?":{}|<>]/.test(W);W.length<Q?$&&(I.value.password=`Password must be at least ${Q} characters long.`):ae?we?He?$e?I.value.password=null:$&&(I.value.password="Password must contain at least one special character."):$&&(I.value.password="Password must contain at least one number."):$&&(I.value.password="Password must contain at least one lowercase letter."):$&&(I.value.password="Password must contain at least one uppercase letter.")};return($,W)=>(en(),rn("div",J3,[dt("div",Q3,[e8,dt("form",{onSubmit:H0(g,["prevent"])},[dt("div",t8,[r8,_o(dt("input",{type:"email",class:"form-control",id:"username",onBlur:W[0]||(W[0]=()=>L(!0)),onInput:W[1]||(W[1]=()=>L(!1)),"onUpdate:modelValue":W[2]||(W[2]=Q=>u.value.username=Q)},null,544),[[Is,u.value.username]]),I.value.username?(en(),rn("div",n8,Vn(I.value.username),1)):hi("",!0)]),dt("div",i8,[o8,_o(dt("input",{type:"password",class:"form-control",id:"password",onBlur:W[3]||(W[3]=()=>s(!0)),onInput:W[4]||(W[4]=()=>s(!1)),"onUpdate:modelValue":W[5]||(W[5]=Q=>u.value.password=Q)},null,544),[[Is,u.value.password]]),I.value.password?(en(),rn("div",s8,Vn(I.value.password),1)):hi("",!0)]),dt("div",{class:"text-center"},[a8,dt("button",{type:"button",class:"btn btn-secondary",onClick:b},"Clear")])],32)])]))}},Xc=n=>(z0("data-v-0c7b4fbe"),n=n(),F0(),n),c8={class:"container mt-5"},u8={class:"row"},h8={class:"col-md-10 offset-md-2"},d8=Xc(()=>dt("h1",{class:"text-center"},"Create an Account",-1)),f8={class:"row mb-3"},p8={class:"col-md-6 col-sm-6"},m8=Xc(()=>dt("label",{for:"username",class:"form-label"},"Username",-1)),g8={key:0,class:"text-danger"},_8={class:"col-md-6 col-sm-6"},y8=Xc(()=>dt("label",{for:"gender",class:"form-label"},"Gender",-1)),v8=Xc(()=>dt("option",{value:"male"},"Male",-1)),b8=Xc(()=>dt("option",{value:"female"},"Female",-1)),x8=Xc(()=>dt("option",{value:"other"},"Other",-1)),w8=[v8,b8,x8],T8={class:"row mb-3"},E8={class:"col-md-6 col-sm-6"},I8=Xc(()=>dt("label",{for:"password",class:"form-label"},"Password",-1)),A8={key:0,class:"text-danger"},S8={class:"col-md-6 col-sm-6"},C8=Xc(()=>dt("label",{for:"confirm-password",class:"form-label"},"Confirm password",-1)),R8={key:0,class:"text-danger"},k8=Xc(()=>dt("button",{type:"submit",class:"btn btn-primary me-2"},"Submit",-1)),P8={__name:"RegisterView",setup(n){const e=nw(),i=_w(),u=Fc({username:"",password:"",gender:""}),g=async()=>{if(L(!0),s(!0),$(!0),!I.value.username&&!I.value.password&&!I.value.confirmPassword&&!I.value.reason&&!I.value.validateFriend){await T2(i,u.value.username,u.value.password).catch(ae=>{console.error(ae.code),alert("Register error:"+ae.code)});const W=await b0(xg(ju,"users"),tg("email","==",u.value.username),vD(1)),Q=await x0(W);console.log(Q.empty),Q.empty?await Z3(xg(ju,"users"),{email:u.value.username,gender:u.value.gender,role:"customer",createdAt:K3()}).then(()=>{alert("Register success!"),b(),e.push("/login").then(()=>{location.reload()})}).catch(ae=>{console.error("Error adding document:",ae.code),alert(ae.code)}):alert("This email has already been registered")}},b=()=>{u.value={username:"",password:"",confirmPassword:"",gender:""}},I=Fc({username:null,password:null,confirmPassword:null,gender:null}),L=W=>{u.value.username.length<3?W&&(I.value.username="Name must be at least 3 characters"):I.value.username=null},s=W=>{const Q=u.value.password,ae=8,we=/[A-Z]/.test(Q),He=/[a-z]/.test(Q),$e=/\d/.test(Q),Ne=/[!@#$%^&*(),.?":{}|<>]/.test(Q);Q.length<ae?W&&(I.value.password=`Password must be at least ${ae} characters long.`):we?He?$e?Ne?I.value.password=null:W&&(I.value.password="Password must contain at least one special character."):W&&(I.value.password="Password must contain at least one number."):W&&(I.value.password="Password must contain at least one lowercase letter."):W&&(I.value.password="Password must contain at least one uppercase letter.")},$=W=>{u.value.password!==u.value.confirmPassword?W&&(I.value.confirmPassword="Passwords do not match."):I.value.confirmPassword=null};return(W,Q)=>(en(),rn("div",c8,[dt("div",u8,[dt("div",h8,[d8,dt("form",{onSubmit:H0(g,["prevent"])},[dt("div",f8,[dt("div",p8,[m8,_o(dt("input",{type:"email",class:"form-control",id:"username",onBlur:Q[0]||(Q[0]=()=>L(!0)),onInput:Q[1]||(Q[1]=()=>L(!1)),"onUpdate:modelValue":Q[2]||(Q[2]=ae=>u.value.username=ae)},null,544),[[Is,u.value.username]]),I.value.username?(en(),rn("div",g8,Vn(I.value.username),1)):hi("",!0)]),dt("div",_8,[y8,_o(dt("select",{class:"form-select",id:"gender","onUpdate:modelValue":Q[3]||(Q[3]=ae=>u.value.gender=ae),required:""},w8,512),[[G0,u.value.gender]])])]),dt("div",T8,[dt("div",E8,[I8,_o(dt("input",{type:"password",class:"form-control",id:"password",onBlur:Q[4]||(Q[4]=()=>s(!0)),onInput:Q[5]||(Q[5]=()=>s(!1)),"onUpdate:modelValue":Q[6]||(Q[6]=ae=>u.value.password=ae)},null,544),[[Is,u.value.password]]),I.value.password?(en(),rn("div",A8,Vn(I.value.password),1)):hi("",!0)]),dt("div",S8,[C8,_o(dt("input",{type:"password",class:"form-control",id:"confirm-password",onBlur:Q[7]||(Q[7]=()=>$(!0)),onInput:Q[8]||(Q[8]=()=>$(!1)),"onUpdate:modelValue":Q[9]||(Q[9]=ae=>u.value.confirmPassword=ae)},null,544),[[Is,u.value.confirmPassword]]),I.value.confirmPassword?(en(),rn("div",R8,Vn(I.value.confirmPassword),1)):hi("",!0)])]),dt("div",{class:"text-center"},[k8,dt("button",{type:"button",class:"btn btn-secondary",onClick:b}," Clear ")])],32)])])]))}},M8=zs(P8,[["__scopeId","data-v-0c7b4fbe"]]),D8={data(){return{title:"",books:[],search_category:"",isEdit:!1,user:sessionStorage.getItem("user")}},created(){this.fetchBooks()},methods:{async exportBooks(){const n=["ISBN","Name","Category","CreatedAt"],e=this.books.map(L=>[L.isbn,L.name,L.category,L.createdAt]);let i=n.join(",")+`
`;e.forEach(L=>{i+=L.join(",")+`
`});const u=new Blob([i],{type:"text/csv;charset=utf-8;"}),b=`${new Date().getTime()}.csv`,I=document.createElement("a");if(I.download!==void 0){const L=URL.createObjectURL(u);I.setAttribute("href",L),I.setAttribute("download",b),document.body.appendChild(I),I.click(),document.body.removeChild(I)}},async fetchBooks(){try{const n=b0(xg(ju,"books"),tg("creator","==",this.user),qC("createdAt"),vD(20)),e=await x0(n),i=[];e.forEach(u=>{i.push({id:u.id,...u.data()})}),this.books=i,this.title="My Book Collection"}catch(n){console.log("Error fetching books: ",n)}},async searchBook(){console.log(this.search_category);try{if(this.search_category!=""){const n=b0(xg(ju,"books"),tg("category","==",this.search_category),tg("creator","==",this.user),qC("createdAt")),e=await x0(n),i=[];e.forEach(u=>{i.push({id:u.id,...u.data()})}),this.books=i,this.title="My Books With Category: "+this.search_category}else this.fetchBooks()}catch(n){console.log("Error fetching books: ",n)}},openEdit(){this.isEdit=!0},closeEdit(){this.isEdit=!1},async editBook(n){const e=Hy(ju,"books",n.id);e.name=n.name;try{await H3(e,{name:n.name}),alert("Update book name successfully!"),this.isEdit=!1}catch(i){console.log("Edit book error:",i)}},async deleteBook(n){try{(await G3(Hy(ju,"books",n))).exists()?(W3(Hy(ju,"books",n)),alert("Delete book successfully!"),this.fetchBooks()):console.log("The book to be deleted does not exist")}catch(e){console.error("Error deleting book:",e)}}}},L8={class:"container"},O8={class:"row"},B8={class:"text-center"},z8={class:"row row-cols-lg-auto align-items-center justify-content-center",action:"#",style:{"margin-bottom":"20px"}},F8={class:"col-12"},N8=dt("label",{class:"visually-hidden",for:"search_category"},"Category",-1),V8=j0('<option value="" selected>Choose Category...</option><option value="Fiction">Fiction</option><option value="Science">Science</option><option value="Fantasy">Fantasy</option><option value="Horror">Horror</option><option value="Mystery">Mystery</option><option value="Romance">Romance</option>',7),U8=[V8],j8={class:"col-12"},$8={class:"table table-striped table-bordered table-hover",style:{"margin-top":"20px"}},q8=dt("thead",null,[dt("tr",null,[dt("th",{scope:"col"},"#"),dt("th",{scope:"col"},"ISBN"),dt("th",{scope:"col"},"Book Name"),dt("th",{scope:"col"},"Category"),dt("th",{scope:"col"},"Operation")])],-1),G8={scope:"row"},H8=["onUpdate:modelValue","disabled"],W8=["onClick"],Z8=["onClick"];function X8(n,e,i,u,g,b){return en(),rn("div",L8,[dt("div",O8,[dt("h1",B8,Vn(g.title),1),dt("form",z8,[dt("div",F8,[N8,_o(dt("select",{class:"form-select",id:"search_category","onUpdate:modelValue":e[0]||(e[0]=I=>g.search_category=I)},U8,512),[[G0,g.search_category]])]),dt("div",j8,[dt("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=I=>b.searchBook())},"Search")])]),g.isEdit?hi("",!0):(en(),rn("button",{key:0,class:"btn btn-info",onClick:e[2]||(e[2]=I=>b.openEdit())},"Open Book Name Edit")),g.isEdit?(en(),rn("button",{key:1,class:"btn btn-info",onClick:e[3]||(e[3]=I=>b.closeEdit())},"Close Book Name Edit")):hi("",!0),dt("table",$8,[q8,dt("tbody",null,[(en(!0),rn(ws,null,Qy(g.books,(I,L)=>(en(),rn("tr",{key:I.id},[dt("th",G8,Vn(L+1),1),dt("td",null,Vn(I.isbn),1),dt("td",null,[_o(dt("input",{type:"text","onUpdate:modelValue":s=>I.name=s,disabled:!g.isEdit},null,8,H8),[[Is,I.name]])]),dt("td",null,Vn(I.category),1),dt("td",null,[dt("button",{class:"btn btn-primary mx-2",onClick:s=>b.editBook(I)},"Edit",8,W8),dt("button",{class:"btn btn-danger mx-2",onClick:s=>b.deleteBook(I.id)},"Delete",8,Z8)])]))),128))])])]),dt("button",{type:"button",class:"btn btn-secondary",onClick:e[4]||(e[4]=I=>b.exportBooks())},"Export My Book Collection")])}const K8=zs(D8,[["render",X8]]);function TD(n,e){return function(){return n.apply(e,arguments)}}const{toString:Y8}=Object.prototype,{getPrototypeOf:rT}=Object,mv=(n=>e=>{const i=Y8.call(e);return n[i]||(n[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Pl=n=>(n=n.toLowerCase(),e=>mv(e)===n),gv=n=>e=>typeof e===n,{isArray:np}=Array,wg=gv("undefined");function J8(n){return n!==null&&!wg(n)&&n.constructor!==null&&!wg(n.constructor)&&ka(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const ED=Pl("ArrayBuffer");function Q8(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&ED(n.buffer),e}const e9=gv("string"),ka=gv("function"),ID=gv("number"),_v=n=>n!==null&&typeof n=="object",t9=n=>n===!0||n===!1,Zy=n=>{if(mv(n)!=="object")return!1;const e=rT(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},r9=Pl("Date"),n9=Pl("File"),i9=Pl("Blob"),o9=Pl("FileList"),s9=n=>_v(n)&&ka(n.pipe),a9=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||ka(n.append)&&((e=mv(n))==="formdata"||e==="object"&&ka(n.toString)&&n.toString()==="[object FormData]"))},l9=Pl("URLSearchParams"),[c9,u9,h9,d9]=["ReadableStream","Request","Response","Headers"].map(Pl),f9=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function qg(n,e,{allOwnKeys:i=!1}={}){if(n===null||typeof n>"u")return;let u,g;if(typeof n!="object"&&(n=[n]),np(n))for(u=0,g=n.length;u<g;u++)e.call(null,n[u],u,n);else{const b=i?Object.getOwnPropertyNames(n):Object.keys(n),I=b.length;let L;for(u=0;u<I;u++)L=b[u],e.call(null,n[L],L,n)}}function AD(n,e){e=e.toLowerCase();const i=Object.keys(n);let u=i.length,g;for(;u-- >0;)if(g=i[u],e===g.toLowerCase())return g;return null}const Xh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,SD=n=>!wg(n)&&n!==Xh;function _1(){const{caseless:n}=SD(this)&&this||{},e={},i=(u,g)=>{const b=n&&AD(e,g)||g;Zy(e[b])&&Zy(u)?e[b]=_1(e[b],u):Zy(u)?e[b]=_1({},u):np(u)?e[b]=u.slice():e[b]=u};for(let u=0,g=arguments.length;u<g;u++)arguments[u]&&qg(arguments[u],i);return e}const p9=(n,e,i,{allOwnKeys:u}={})=>(qg(e,(g,b)=>{i&&ka(g)?n[b]=TD(g,i):n[b]=g},{allOwnKeys:u}),n),m9=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),g9=(n,e,i,u)=>{n.prototype=Object.create(e.prototype,u),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),i&&Object.assign(n.prototype,i)},_9=(n,e,i,u)=>{let g,b,I;const L={};if(e=e||{},n==null)return e;do{for(g=Object.getOwnPropertyNames(n),b=g.length;b-- >0;)I=g[b],(!u||u(I,n,e))&&!L[I]&&(e[I]=n[I],L[I]=!0);n=i!==!1&&rT(n)}while(n&&(!i||i(n,e))&&n!==Object.prototype);return e},y9=(n,e,i)=>{n=String(n),(i===void 0||i>n.length)&&(i=n.length),i-=e.length;const u=n.indexOf(e,i);return u!==-1&&u===i},v9=n=>{if(!n)return null;if(np(n))return n;let e=n.length;if(!ID(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=n[e];return i},b9=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&rT(Uint8Array)),x9=(n,e)=>{const u=(n&&n[Symbol.iterator]).call(n);let g;for(;(g=u.next())&&!g.done;){const b=g.value;e.call(n,b[0],b[1])}},w9=(n,e)=>{let i;const u=[];for(;(i=n.exec(e))!==null;)u.push(i);return u},T9=Pl("HTMLFormElement"),E9=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,u,g){return u.toUpperCase()+g}),WC=(({hasOwnProperty:n})=>(e,i)=>n.call(e,i))(Object.prototype),I9=Pl("RegExp"),CD=(n,e)=>{const i=Object.getOwnPropertyDescriptors(n),u={};qg(i,(g,b)=>{let I;(I=e(g,b,n))!==!1&&(u[b]=I||g)}),Object.defineProperties(n,u)},A9=n=>{CD(n,(e,i)=>{if(ka(n)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const u=n[i];if(ka(u)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},S9=(n,e)=>{const i={},u=g=>{g.forEach(b=>{i[b]=!0})};return np(n)?u(n):u(String(n).split(e)),i},C9=()=>{},R9=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,wx="abcdefghijklmnopqrstuvwxyz",ZC="0123456789",RD={DIGIT:ZC,ALPHA:wx,ALPHA_DIGIT:wx+wx.toUpperCase()+ZC},k9=(n=16,e=RD.ALPHA_DIGIT)=>{let i="";const{length:u}=e;for(;n--;)i+=e[Math.random()*u|0];return i};function P9(n){return!!(n&&ka(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const M9=n=>{const e=new Array(10),i=(u,g)=>{if(_v(u)){if(e.indexOf(u)>=0)return;if(!("toJSON"in u)){e[g]=u;const b=np(u)?[]:{};return qg(u,(I,L)=>{const s=i(I,g+1);!wg(s)&&(b[L]=s)}),e[g]=void 0,b}}return u};return i(n,0)},D9=Pl("AsyncFunction"),L9=n=>n&&(_v(n)||ka(n))&&ka(n.then)&&ka(n.catch),kD=((n,e)=>n?setImmediate:e?((i,u)=>(Xh.addEventListener("message",({source:g,data:b})=>{g===Xh&&b===i&&u.length&&u.shift()()},!1),g=>{u.push(g),Xh.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",ka(Xh.postMessage)),O9=typeof queueMicrotask<"u"?queueMicrotask.bind(Xh):typeof process<"u"&&process.nextTick||kD,Bt={isArray:np,isArrayBuffer:ED,isBuffer:J8,isFormData:a9,isArrayBufferView:Q8,isString:e9,isNumber:ID,isBoolean:t9,isObject:_v,isPlainObject:Zy,isReadableStream:c9,isRequest:u9,isResponse:h9,isHeaders:d9,isUndefined:wg,isDate:r9,isFile:n9,isBlob:i9,isRegExp:I9,isFunction:ka,isStream:s9,isURLSearchParams:l9,isTypedArray:b9,isFileList:o9,forEach:qg,merge:_1,extend:p9,trim:f9,stripBOM:m9,inherits:g9,toFlatObject:_9,kindOf:mv,kindOfTest:Pl,endsWith:y9,toArray:v9,forEachEntry:x9,matchAll:w9,isHTMLForm:T9,hasOwnProperty:WC,hasOwnProp:WC,reduceDescriptors:CD,freezeMethods:A9,toObjectSet:S9,toCamelCase:E9,noop:C9,toFiniteNumber:R9,findKey:AD,global:Xh,isContextDefined:SD,ALPHABET:RD,generateString:k9,isSpecCompliantForm:P9,toJSONObject:M9,isAsyncFn:D9,isThenable:L9,setImmediate:kD,asap:O9};function In(n,e,i,u,g){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),u&&(this.request=u),g&&(this.response=g,this.status=g.status?g.status:null)}Bt.inherits(In,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Bt.toJSONObject(this.config),code:this.code,status:this.status}}});const PD=In.prototype,MD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{MD[n]={value:n}});Object.defineProperties(In,MD);Object.defineProperty(PD,"isAxiosError",{value:!0});In.from=(n,e,i,u,g,b)=>{const I=Object.create(PD);return Bt.toFlatObject(n,I,function(s){return s!==Error.prototype},L=>L!=="isAxiosError"),In.call(I,n.message,e,i,u,g),I.cause=n,I.name=n.name,b&&Object.assign(I,b),I};const B9=null;function y1(n){return Bt.isPlainObject(n)||Bt.isArray(n)}function DD(n){return Bt.endsWith(n,"[]")?n.slice(0,-2):n}function XC(n,e,i){return n?n.concat(e).map(function(g,b){return g=DD(g),!i&&b?"["+g+"]":g}).join(i?".":""):e}function z9(n){return Bt.isArray(n)&&!n.some(y1)}const F9=Bt.toFlatObject(Bt,{},null,function(e){return/^is[A-Z]/.test(e)});function yv(n,e,i){if(!Bt.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,i=Bt.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function($e,Ne){return!Bt.isUndefined(Ne[$e])});const u=i.metaTokens,g=i.visitor||W,b=i.dots,I=i.indexes,s=(i.Blob||typeof Blob<"u"&&Blob)&&Bt.isSpecCompliantForm(e);if(!Bt.isFunction(g))throw new TypeError("visitor must be a function");function $(He){if(He===null)return"";if(Bt.isDate(He))return He.toISOString();if(!s&&Bt.isBlob(He))throw new In("Blob is not supported. Use a Buffer instead.");return Bt.isArrayBuffer(He)||Bt.isTypedArray(He)?s&&typeof Blob=="function"?new Blob([He]):Buffer.from(He):He}function W(He,$e,Ne){let wt=He;if(He&&!Ne&&typeof He=="object"){if(Bt.endsWith($e,"{}"))$e=u?$e:$e.slice(0,-2),He=JSON.stringify(He);else if(Bt.isArray(He)&&z9(He)||(Bt.isFileList(He)||Bt.endsWith($e,"[]"))&&(wt=Bt.toArray(He)))return $e=DD($e),wt.forEach(function(vt,zt){!(Bt.isUndefined(vt)||vt===null)&&e.append(I===!0?XC([$e],zt,b):I===null?$e:$e+"[]",$(vt))}),!1}return y1(He)?!0:(e.append(XC(Ne,$e,b),$(He)),!1)}const Q=[],ae=Object.assign(F9,{defaultVisitor:W,convertValue:$,isVisitable:y1});function we(He,$e){if(!Bt.isUndefined(He)){if(Q.indexOf(He)!==-1)throw Error("Circular reference detected in "+$e.join("."));Q.push(He),Bt.forEach(He,function(wt,mt){(!(Bt.isUndefined(wt)||wt===null)&&g.call(e,wt,Bt.isString(mt)?mt.trim():mt,$e,ae))===!0&&we(wt,$e?$e.concat(mt):[mt])}),Q.pop()}}if(!Bt.isObject(n))throw new TypeError("data must be an object");return we(n),e}function KC(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(u){return e[u]})}function nT(n,e){this._pairs=[],n&&yv(n,this,e)}const LD=nT.prototype;LD.append=function(e,i){this._pairs.push([e,i])};LD.toString=function(e){const i=e?function(u){return e.call(this,u,KC)}:KC;return this._pairs.map(function(g){return i(g[0])+"="+i(g[1])},"").join("&")};function N9(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function OD(n,e,i){if(!e)return n;const u=i&&i.encode||N9,g=i&&i.serialize;let b;if(g?b=g(e,i):b=Bt.isURLSearchParams(e)?e.toString():new nT(e,i).toString(u),b){const I=n.indexOf("#");I!==-1&&(n=n.slice(0,I)),n+=(n.indexOf("?")===-1?"?":"&")+b}return n}class YC{constructor(){this.handlers=[]}use(e,i,u){return this.handlers.push({fulfilled:e,rejected:i,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Bt.forEach(this.handlers,function(u){u!==null&&e(u)})}}const BD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},V9=typeof URLSearchParams<"u"?URLSearchParams:nT,U9=typeof FormData<"u"?FormData:null,j9=typeof Blob<"u"?Blob:null,$9={isBrowser:!0,classes:{URLSearchParams:V9,FormData:U9,Blob:j9},protocols:["http","https","file","blob","url","data"]},iT=typeof window<"u"&&typeof document<"u",v1=typeof navigator=="object"&&navigator||void 0,q9=iT&&(!v1||["ReactNative","NativeScript","NS"].indexOf(v1.product)<0),G9=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",H9=iT&&window.location.href||"http://localhost",W9=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:iT,hasStandardBrowserEnv:q9,hasStandardBrowserWebWorkerEnv:G9,navigator:v1,origin:H9},Symbol.toStringTag,{value:"Module"})),ua={...W9,...$9};function Z9(n,e){return yv(n,new ua.classes.URLSearchParams,Object.assign({visitor:function(i,u,g,b){return ua.isNode&&Bt.isBuffer(i)?(this.append(u,i.toString("base64")),!1):b.defaultVisitor.apply(this,arguments)}},e))}function X9(n){return Bt.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function K9(n){const e={},i=Object.keys(n);let u;const g=i.length;let b;for(u=0;u<g;u++)b=i[u],e[b]=n[b];return e}function zD(n){function e(i,u,g,b){let I=i[b++];if(I==="__proto__")return!0;const L=Number.isFinite(+I),s=b>=i.length;return I=!I&&Bt.isArray(g)?g.length:I,s?(Bt.hasOwnProp(g,I)?g[I]=[g[I],u]:g[I]=u,!L):((!g[I]||!Bt.isObject(g[I]))&&(g[I]=[]),e(i,u,g[I],b)&&Bt.isArray(g[I])&&(g[I]=K9(g[I])),!L)}if(Bt.isFormData(n)&&Bt.isFunction(n.entries)){const i={};return Bt.forEachEntry(n,(u,g)=>{e(X9(u),g,i,0)}),i}return null}function Y9(n,e,i){if(Bt.isString(n))try{return(e||JSON.parse)(n),Bt.trim(n)}catch(u){if(u.name!=="SyntaxError")throw u}return(i||JSON.stringify)(n)}const Gg={transitional:BD,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const u=i.getContentType()||"",g=u.indexOf("application/json")>-1,b=Bt.isObject(e);if(b&&Bt.isHTMLForm(e)&&(e=new FormData(e)),Bt.isFormData(e))return g?JSON.stringify(zD(e)):e;if(Bt.isArrayBuffer(e)||Bt.isBuffer(e)||Bt.isStream(e)||Bt.isFile(e)||Bt.isBlob(e)||Bt.isReadableStream(e))return e;if(Bt.isArrayBufferView(e))return e.buffer;if(Bt.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let L;if(b){if(u.indexOf("application/x-www-form-urlencoded")>-1)return Z9(e,this.formSerializer).toString();if((L=Bt.isFileList(e))||u.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return yv(L?{"files[]":e}:e,s&&new s,this.formSerializer)}}return b||g?(i.setContentType("application/json",!1),Y9(e)):e}],transformResponse:[function(e){const i=this.transitional||Gg.transitional,u=i&&i.forcedJSONParsing,g=this.responseType==="json";if(Bt.isResponse(e)||Bt.isReadableStream(e))return e;if(e&&Bt.isString(e)&&(u&&!this.responseType||g)){const I=!(i&&i.silentJSONParsing)&&g;try{return JSON.parse(e)}catch(L){if(I)throw L.name==="SyntaxError"?In.from(L,In.ERR_BAD_RESPONSE,this,null,this.response):L}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ua.classes.FormData,Blob:ua.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Bt.forEach(["delete","get","head","post","put","patch"],n=>{Gg.headers[n]={}});const J9=Bt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Q9=n=>{const e={};let i,u,g;return n&&n.split(`
`).forEach(function(I){g=I.indexOf(":"),i=I.substring(0,g).trim().toLowerCase(),u=I.substring(g+1).trim(),!(!i||e[i]&&J9[i])&&(i==="set-cookie"?e[i]?e[i].push(u):e[i]=[u]:e[i]=e[i]?e[i]+", "+u:u)}),e},JC=Symbol("internals");function km(n){return n&&String(n).trim().toLowerCase()}function Xy(n){return n===!1||n==null?n:Bt.isArray(n)?n.map(Xy):String(n)}function eq(n){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=i.exec(n);)e[u[1]]=u[2];return e}const tq=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Tx(n,e,i,u,g){if(Bt.isFunction(u))return u.call(this,e,i);if(g&&(e=i),!!Bt.isString(e)){if(Bt.isString(u))return e.indexOf(u)!==-1;if(Bt.isRegExp(u))return u.test(e)}}function rq(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,u)=>i.toUpperCase()+u)}function nq(n,e){const i=Bt.toCamelCase(" "+e);["get","set","has"].forEach(u=>{Object.defineProperty(n,u+i,{value:function(g,b,I){return this[u].call(this,e,g,b,I)},configurable:!0})})}class ha{constructor(e){e&&this.set(e)}set(e,i,u){const g=this;function b(L,s,$){const W=km(s);if(!W)throw new Error("header name must be a non-empty string");const Q=Bt.findKey(g,W);(!Q||g[Q]===void 0||$===!0||$===void 0&&g[Q]!==!1)&&(g[Q||s]=Xy(L))}const I=(L,s)=>Bt.forEach(L,($,W)=>b($,W,s));if(Bt.isPlainObject(e)||e instanceof this.constructor)I(e,i);else if(Bt.isString(e)&&(e=e.trim())&&!tq(e))I(Q9(e),i);else if(Bt.isHeaders(e))for(const[L,s]of e.entries())b(s,L,u);else e!=null&&b(i,e,u);return this}get(e,i){if(e=km(e),e){const u=Bt.findKey(this,e);if(u){const g=this[u];if(!i)return g;if(i===!0)return eq(g);if(Bt.isFunction(i))return i.call(this,g,u);if(Bt.isRegExp(i))return i.exec(g);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=km(e),e){const u=Bt.findKey(this,e);return!!(u&&this[u]!==void 0&&(!i||Tx(this,this[u],u,i)))}return!1}delete(e,i){const u=this;let g=!1;function b(I){if(I=km(I),I){const L=Bt.findKey(u,I);L&&(!i||Tx(u,u[L],L,i))&&(delete u[L],g=!0)}}return Bt.isArray(e)?e.forEach(b):b(e),g}clear(e){const i=Object.keys(this);let u=i.length,g=!1;for(;u--;){const b=i[u];(!e||Tx(this,this[b],b,e,!0))&&(delete this[b],g=!0)}return g}normalize(e){const i=this,u={};return Bt.forEach(this,(g,b)=>{const I=Bt.findKey(u,b);if(I){i[I]=Xy(g),delete i[b];return}const L=e?rq(b):String(b).trim();L!==b&&delete i[b],i[L]=Xy(g),u[L]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return Bt.forEach(this,(u,g)=>{u!=null&&u!==!1&&(i[g]=e&&Bt.isArray(u)?u.join(", "):u)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const u=new this(e);return i.forEach(g=>u.set(g)),u}static accessor(e){const u=(this[JC]=this[JC]={accessors:{}}).accessors,g=this.prototype;function b(I){const L=km(I);u[L]||(nq(g,I),u[L]=!0)}return Bt.isArray(e)?e.forEach(b):b(e),this}}ha.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Bt.reduceDescriptors(ha.prototype,({value:n},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(u){this[i]=u}}});Bt.freezeMethods(ha);function Ex(n,e){const i=this||Gg,u=e||i,g=ha.from(u.headers);let b=u.data;return Bt.forEach(n,function(L){b=L.call(i,b,g.normalize(),e?e.status:void 0)}),g.normalize(),b}function FD(n){return!!(n&&n.__CANCEL__)}function ip(n,e,i){In.call(this,n??"canceled",In.ERR_CANCELED,e,i),this.name="CanceledError"}Bt.inherits(ip,In,{__CANCEL__:!0});function ND(n,e,i){const u=i.config.validateStatus;!i.status||!u||u(i.status)?n(i):e(new In("Request failed with status code "+i.status,[In.ERR_BAD_REQUEST,In.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function iq(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function oq(n,e){n=n||10;const i=new Array(n),u=new Array(n);let g=0,b=0,I;return e=e!==void 0?e:1e3,function(s){const $=Date.now(),W=u[b];I||(I=$),i[g]=s,u[g]=$;let Q=b,ae=0;for(;Q!==g;)ae+=i[Q++],Q=Q%n;if(g=(g+1)%n,g===b&&(b=(b+1)%n),$-I<e)return;const we=W&&$-W;return we?Math.round(ae*1e3/we):void 0}}function sq(n,e){let i=0,u=1e3/e,g,b;const I=($,W=Date.now())=>{i=W,g=null,b&&(clearTimeout(b),b=null),n.apply(null,$)};return[(...$)=>{const W=Date.now(),Q=W-i;Q>=u?I($,W):(g=$,b||(b=setTimeout(()=>{b=null,I(g)},u-Q)))},()=>g&&I(g)]}const w0=(n,e,i=3)=>{let u=0;const g=oq(50,250);return sq(b=>{const I=b.loaded,L=b.lengthComputable?b.total:void 0,s=I-u,$=g(s),W=I<=L;u=I;const Q={loaded:I,total:L,progress:L?I/L:void 0,bytes:s,rate:$||void 0,estimated:$&&L&&W?(L-I)/$:void 0,event:b,lengthComputable:L!=null,[e?"download":"upload"]:!0};n(Q)},i)},QC=(n,e)=>{const i=n!=null;return[u=>e[0]({lengthComputable:i,total:n,loaded:u}),e[1]]},eR=n=>(...e)=>Bt.asap(()=>n(...e)),aq=ua.hasStandardBrowserEnv?function(){const e=ua.navigator&&/(msie|trident)/i.test(ua.navigator.userAgent),i=document.createElement("a");let u;function g(b){let I=b;return e&&(i.setAttribute("href",I),I=i.href),i.setAttribute("href",I),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return u=g(window.location.href),function(I){const L=Bt.isString(I)?g(I):I;return L.protocol===u.protocol&&L.host===u.host}}():function(){return function(){return!0}}(),lq=ua.hasStandardBrowserEnv?{write(n,e,i,u,g,b){const I=[n+"="+encodeURIComponent(e)];Bt.isNumber(i)&&I.push("expires="+new Date(i).toGMTString()),Bt.isString(u)&&I.push("path="+u),Bt.isString(g)&&I.push("domain="+g),b===!0&&I.push("secure"),document.cookie=I.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function cq(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function uq(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function VD(n,e){return n&&!cq(e)?uq(n,e):e}const tR=n=>n instanceof ha?{...n}:n;function hd(n,e){e=e||{};const i={};function u($,W,Q){return Bt.isPlainObject($)&&Bt.isPlainObject(W)?Bt.merge.call({caseless:Q},$,W):Bt.isPlainObject(W)?Bt.merge({},W):Bt.isArray(W)?W.slice():W}function g($,W,Q){if(Bt.isUndefined(W)){if(!Bt.isUndefined($))return u(void 0,$,Q)}else return u($,W,Q)}function b($,W){if(!Bt.isUndefined(W))return u(void 0,W)}function I($,W){if(Bt.isUndefined(W)){if(!Bt.isUndefined($))return u(void 0,$)}else return u(void 0,W)}function L($,W,Q){if(Q in e)return u($,W);if(Q in n)return u(void 0,$)}const s={url:b,method:b,data:b,baseURL:I,transformRequest:I,transformResponse:I,paramsSerializer:I,timeout:I,timeoutMessage:I,withCredentials:I,withXSRFToken:I,adapter:I,responseType:I,xsrfCookieName:I,xsrfHeaderName:I,onUploadProgress:I,onDownloadProgress:I,decompress:I,maxContentLength:I,maxBodyLength:I,beforeRedirect:I,transport:I,httpAgent:I,httpsAgent:I,cancelToken:I,socketPath:I,responseEncoding:I,validateStatus:L,headers:($,W)=>g(tR($),tR(W),!0)};return Bt.forEach(Object.keys(Object.assign({},n,e)),function(W){const Q=s[W]||g,ae=Q(n[W],e[W],W);Bt.isUndefined(ae)&&Q!==L||(i[W]=ae)}),i}const UD=n=>{const e=hd({},n);let{data:i,withXSRFToken:u,xsrfHeaderName:g,xsrfCookieName:b,headers:I,auth:L}=e;e.headers=I=ha.from(I),e.url=OD(VD(e.baseURL,e.url),n.params,n.paramsSerializer),L&&I.set("Authorization","Basic "+btoa((L.username||"")+":"+(L.password?unescape(encodeURIComponent(L.password)):"")));let s;if(Bt.isFormData(i)){if(ua.hasStandardBrowserEnv||ua.hasStandardBrowserWebWorkerEnv)I.setContentType(void 0);else if((s=I.getContentType())!==!1){const[$,...W]=s?s.split(";").map(Q=>Q.trim()).filter(Boolean):[];I.setContentType([$||"multipart/form-data",...W].join("; "))}}if(ua.hasStandardBrowserEnv&&(u&&Bt.isFunction(u)&&(u=u(e)),u||u!==!1&&aq(e.url))){const $=g&&b&&lq.read(b);$&&I.set(g,$)}return e},hq=typeof XMLHttpRequest<"u",dq=hq&&function(n){return new Promise(function(i,u){const g=UD(n);let b=g.data;const I=ha.from(g.headers).normalize();let{responseType:L,onUploadProgress:s,onDownloadProgress:$}=g,W,Q,ae,we,He;function $e(){we&&we(),He&&He(),g.cancelToken&&g.cancelToken.unsubscribe(W),g.signal&&g.signal.removeEventListener("abort",W)}let Ne=new XMLHttpRequest;Ne.open(g.method.toUpperCase(),g.url,!0),Ne.timeout=g.timeout;function wt(){if(!Ne)return;const vt=ha.from("getAllResponseHeaders"in Ne&&Ne.getAllResponseHeaders()),Ct={data:!L||L==="text"||L==="json"?Ne.responseText:Ne.response,status:Ne.status,statusText:Ne.statusText,headers:vt,config:n,request:Ne};ND(function(qe){i(qe),$e()},function(qe){u(qe),$e()},Ct),Ne=null}"onloadend"in Ne?Ne.onloadend=wt:Ne.onreadystatechange=function(){!Ne||Ne.readyState!==4||Ne.status===0&&!(Ne.responseURL&&Ne.responseURL.indexOf("file:")===0)||setTimeout(wt)},Ne.onabort=function(){Ne&&(u(new In("Request aborted",In.ECONNABORTED,n,Ne)),Ne=null)},Ne.onerror=function(){u(new In("Network Error",In.ERR_NETWORK,n,Ne)),Ne=null},Ne.ontimeout=function(){let zt=g.timeout?"timeout of "+g.timeout+"ms exceeded":"timeout exceeded";const Ct=g.transitional||BD;g.timeoutErrorMessage&&(zt=g.timeoutErrorMessage),u(new In(zt,Ct.clarifyTimeoutError?In.ETIMEDOUT:In.ECONNABORTED,n,Ne)),Ne=null},b===void 0&&I.setContentType(null),"setRequestHeader"in Ne&&Bt.forEach(I.toJSON(),function(zt,Ct){Ne.setRequestHeader(Ct,zt)}),Bt.isUndefined(g.withCredentials)||(Ne.withCredentials=!!g.withCredentials),L&&L!=="json"&&(Ne.responseType=g.responseType),$&&([ae,He]=w0($,!0),Ne.addEventListener("progress",ae)),s&&Ne.upload&&([Q,we]=w0(s),Ne.upload.addEventListener("progress",Q),Ne.upload.addEventListener("loadend",we)),(g.cancelToken||g.signal)&&(W=vt=>{Ne&&(u(!vt||vt.type?new ip(null,n,Ne):vt),Ne.abort(),Ne=null)},g.cancelToken&&g.cancelToken.subscribe(W),g.signal&&(g.signal.aborted?W():g.signal.addEventListener("abort",W)));const mt=iq(g.url);if(mt&&ua.protocols.indexOf(mt)===-1){u(new In("Unsupported protocol "+mt+":",In.ERR_BAD_REQUEST,n));return}Ne.send(b||null)})},fq=(n,e)=>{const{length:i}=n=n?n.filter(Boolean):[];if(e||i){let u=new AbortController,g;const b=function($){if(!g){g=!0,L();const W=$ instanceof Error?$:this.reason;u.abort(W instanceof In?W:new ip(W instanceof Error?W.message:W))}};let I=e&&setTimeout(()=>{I=null,b(new In(`timeout ${e} of ms exceeded`,In.ETIMEDOUT))},e);const L=()=>{n&&(I&&clearTimeout(I),I=null,n.forEach($=>{$.unsubscribe?$.unsubscribe(b):$.removeEventListener("abort",b)}),n=null)};n.forEach($=>$.addEventListener("abort",b));const{signal:s}=u;return s.unsubscribe=()=>Bt.asap(L),s}},pq=function*(n,e){let i=n.byteLength;if(!e||i<e){yield n;return}let u=0,g;for(;u<i;)g=u+e,yield n.slice(u,g),u=g},mq=async function*(n,e){for await(const i of gq(n))yield*pq(i,e)},gq=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:i,value:u}=await e.read();if(i)break;yield u}}finally{await e.cancel()}},rR=(n,e,i,u)=>{const g=mq(n,e);let b=0,I,L=s=>{I||(I=!0,u&&u(s))};return new ReadableStream({async pull(s){try{const{done:$,value:W}=await g.next();if($){L(),s.close();return}let Q=W.byteLength;if(i){let ae=b+=Q;i(ae)}s.enqueue(new Uint8Array(W))}catch($){throw L($),$}},cancel(s){return L(s),g.return()}},{highWaterMark:2})},vv=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",jD=vv&&typeof ReadableStream=="function",_q=vv&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),$D=(n,...e)=>{try{return!!n(...e)}catch{return!1}},yq=jD&&$D(()=>{let n=!1;const e=new Request(ua.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),nR=64*1024,b1=jD&&$D(()=>Bt.isReadableStream(new Response("").body)),T0={stream:b1&&(n=>n.body)};vv&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!T0[e]&&(T0[e]=Bt.isFunction(n[e])?i=>i[e]():(i,u)=>{throw new In(`Response type '${e}' is not supported`,In.ERR_NOT_SUPPORT,u)})})})(new Response);const vq=async n=>{if(n==null)return 0;if(Bt.isBlob(n))return n.size;if(Bt.isSpecCompliantForm(n))return(await new Request(ua.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(Bt.isArrayBufferView(n)||Bt.isArrayBuffer(n))return n.byteLength;if(Bt.isURLSearchParams(n)&&(n=n+""),Bt.isString(n))return(await _q(n)).byteLength},bq=async(n,e)=>{const i=Bt.toFiniteNumber(n.getContentLength());return i??vq(e)},xq=vv&&(async n=>{let{url:e,method:i,data:u,signal:g,cancelToken:b,timeout:I,onDownloadProgress:L,onUploadProgress:s,responseType:$,headers:W,withCredentials:Q="same-origin",fetchOptions:ae}=UD(n);$=$?($+"").toLowerCase():"text";let we=fq([g,b&&b.toAbortSignal()],I),He;const $e=we&&we.unsubscribe&&(()=>{we.unsubscribe()});let Ne;try{if(s&&yq&&i!=="get"&&i!=="head"&&(Ne=await bq(W,u))!==0){let Ct=new Request(e,{method:"POST",body:u,duplex:"half"}),qt;if(Bt.isFormData(u)&&(qt=Ct.headers.get("content-type"))&&W.setContentType(qt),Ct.body){const[qe,be]=QC(Ne,w0(eR(s)));u=rR(Ct.body,nR,qe,be)}}Bt.isString(Q)||(Q=Q?"include":"omit");const wt="credentials"in Request.prototype;He=new Request(e,{...ae,signal:we,method:i.toUpperCase(),headers:W.normalize().toJSON(),body:u,duplex:"half",credentials:wt?Q:void 0});let mt=await fetch(He);const vt=b1&&($==="stream"||$==="response");if(b1&&(L||vt&&$e)){const Ct={};["status","statusText","headers"].forEach(Fe=>{Ct[Fe]=mt[Fe]});const qt=Bt.toFiniteNumber(mt.headers.get("content-length")),[qe,be]=L&&QC(qt,w0(eR(L),!0))||[];mt=new Response(rR(mt.body,nR,qe,()=>{be&&be(),$e&&$e()}),Ct)}$=$||"text";let zt=await T0[Bt.findKey(T0,$)||"text"](mt,n);return!vt&&$e&&$e(),await new Promise((Ct,qt)=>{ND(Ct,qt,{data:zt,headers:ha.from(mt.headers),status:mt.status,statusText:mt.statusText,config:n,request:He})})}catch(wt){throw $e&&$e(),wt&&wt.name==="TypeError"&&/fetch/i.test(wt.message)?Object.assign(new In("Network Error",In.ERR_NETWORK,n,He),{cause:wt.cause||wt}):In.from(wt,wt&&wt.code,n,He)}}),x1={http:B9,xhr:dq,fetch:xq};Bt.forEach(x1,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const iR=n=>`- ${n}`,wq=n=>Bt.isFunction(n)||n===null||n===!1,qD={getAdapter:n=>{n=Bt.isArray(n)?n:[n];const{length:e}=n;let i,u;const g={};for(let b=0;b<e;b++){i=n[b];let I;if(u=i,!wq(i)&&(u=x1[(I=String(i)).toLowerCase()],u===void 0))throw new In(`Unknown adapter '${I}'`);if(u)break;g[I||"#"+b]=u}if(!u){const b=Object.entries(g).map(([L,s])=>`adapter ${L} `+(s===!1?"is not supported by the environment":"is not available in the build"));let I=e?b.length>1?`since :
`+b.map(iR).join(`
`):" "+iR(b[0]):"as no adapter specified";throw new In("There is no suitable adapter to dispatch the request "+I,"ERR_NOT_SUPPORT")}return u},adapters:x1};function Ix(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new ip(null,n)}function oR(n){return Ix(n),n.headers=ha.from(n.headers),n.data=Ex.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),qD.getAdapter(n.adapter||Gg.adapter)(n).then(function(u){return Ix(n),u.data=Ex.call(n,n.transformResponse,u),u.headers=ha.from(u.headers),u},function(u){return FD(u)||(Ix(n),u&&u.response&&(u.response.data=Ex.call(n,n.transformResponse,u.response),u.response.headers=ha.from(u.response.headers))),Promise.reject(u)})}const GD="1.7.7",oT={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{oT[n]=function(u){return typeof u===n||"a"+(e<1?"n ":" ")+n}});const sR={};oT.transitional=function(e,i,u){function g(b,I){return"[Axios v"+GD+"] Transitional option '"+b+"'"+I+(u?". "+u:"")}return(b,I,L)=>{if(e===!1)throw new In(g(I," has been removed"+(i?" in "+i:"")),In.ERR_DEPRECATED);return i&&!sR[I]&&(sR[I]=!0,console.warn(g(I," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(b,I,L):!0}};function Tq(n,e,i){if(typeof n!="object")throw new In("options must be an object",In.ERR_BAD_OPTION_VALUE);const u=Object.keys(n);let g=u.length;for(;g-- >0;){const b=u[g],I=e[b];if(I){const L=n[b],s=L===void 0||I(L,b,n);if(s!==!0)throw new In("option "+b+" must be "+s,In.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new In("Unknown option "+b,In.ERR_BAD_OPTION)}}const w1={assertOptions:Tq,validators:oT},Du=w1.validators;class ed{constructor(e){this.defaults=e,this.interceptors={request:new YC,response:new YC}}async request(e,i){try{return await this._request(e,i)}catch(u){if(u instanceof Error){let g;Error.captureStackTrace?Error.captureStackTrace(g={}):g=new Error;const b=g.stack?g.stack.replace(/^.+\n/,""):"";try{u.stack?b&&!String(u.stack).endsWith(b.replace(/^.+\n.+\n/,""))&&(u.stack+=`
`+b):u.stack=b}catch{}}throw u}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=hd(this.defaults,i);const{transitional:u,paramsSerializer:g,headers:b}=i;u!==void 0&&w1.assertOptions(u,{silentJSONParsing:Du.transitional(Du.boolean),forcedJSONParsing:Du.transitional(Du.boolean),clarifyTimeoutError:Du.transitional(Du.boolean)},!1),g!=null&&(Bt.isFunction(g)?i.paramsSerializer={serialize:g}:w1.assertOptions(g,{encode:Du.function,serialize:Du.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let I=b&&Bt.merge(b.common,b[i.method]);b&&Bt.forEach(["delete","get","head","post","put","patch","common"],He=>{delete b[He]}),i.headers=ha.concat(I,b);const L=[];let s=!0;this.interceptors.request.forEach(function($e){typeof $e.runWhen=="function"&&$e.runWhen(i)===!1||(s=s&&$e.synchronous,L.unshift($e.fulfilled,$e.rejected))});const $=[];this.interceptors.response.forEach(function($e){$.push($e.fulfilled,$e.rejected)});let W,Q=0,ae;if(!s){const He=[oR.bind(this),void 0];for(He.unshift.apply(He,L),He.push.apply(He,$),ae=He.length,W=Promise.resolve(i);Q<ae;)W=W.then(He[Q++],He[Q++]);return W}ae=L.length;let we=i;for(Q=0;Q<ae;){const He=L[Q++],$e=L[Q++];try{we=He(we)}catch(Ne){$e.call(this,Ne);break}}try{W=oR.call(this,we)}catch(He){return Promise.reject(He)}for(Q=0,ae=$.length;Q<ae;)W=W.then($[Q++],$[Q++]);return W}getUri(e){e=hd(this.defaults,e);const i=VD(e.baseURL,e.url);return OD(i,e.params,e.paramsSerializer)}}Bt.forEach(["delete","get","head","options"],function(e){ed.prototype[e]=function(i,u){return this.request(hd(u||{},{method:e,url:i,data:(u||{}).data}))}});Bt.forEach(["post","put","patch"],function(e){function i(u){return function(b,I,L){return this.request(hd(L||{},{method:e,headers:u?{"Content-Type":"multipart/form-data"}:{},url:b,data:I}))}}ed.prototype[e]=i(),ed.prototype[e+"Form"]=i(!0)});class sT{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(b){i=b});const u=this;this.promise.then(g=>{if(!u._listeners)return;let b=u._listeners.length;for(;b-- >0;)u._listeners[b](g);u._listeners=null}),this.promise.then=g=>{let b;const I=new Promise(L=>{u.subscribe(L),b=L}).then(g);return I.cancel=function(){u.unsubscribe(b)},I},e(function(b,I,L){u.reason||(u.reason=new ip(b,I,L),i(u.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=u=>{e.abort(u)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new sT(function(g){e=g}),cancel:e}}}function Eq(n){return function(i){return n.apply(null,i)}}function Iq(n){return Bt.isObject(n)&&n.isAxiosError===!0}const T1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(T1).forEach(([n,e])=>{T1[e]=n});function HD(n){const e=new ed(n),i=TD(ed.prototype.request,e);return Bt.extend(i,ed.prototype,e,{allOwnKeys:!0}),Bt.extend(i,e,null,{allOwnKeys:!0}),i.create=function(g){return HD(hd(n,g))},i}const ni=HD(Gg);ni.Axios=ed;ni.CanceledError=ip;ni.CancelToken=sT;ni.isCancel=FD;ni.VERSION=GD;ni.toFormData=yv;ni.AxiosError=In;ni.Cancel=ni.CanceledError;ni.all=function(e){return Promise.all(e)};ni.spread=Eq;ni.isAxiosError=Iq;ni.mergeConfig=hd;ni.AxiosHeaders=ha;ni.formToJSON=n=>zD(Bt.isHTMLForm(n)?new FormData(n):n);ni.getAdapter=qD.getAdapter;ni.HttpStatusCode=T1;ni.default=ni;const Aq={data(){return{emailData:{to:"",subject:"",message:""},errors:{to:"",subject:"",message:""},status:""}},methods:{close(){this.status=""},validateEmail(n){return/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(String(n).toLowerCase())},validateFields(){let n=!0;const e=this.emailData.to.split(",").map(i=>i.trim());if(!this.emailData.to)this.errors.to="Recipient emails are required",n=!1;else{for(let i of e)if(!this.validateEmail(i)){this.errors.to=`Invalid email format: ${i}`,n=!1;break}n&&(this.errors.to="")}return this.emailData.subject?this.errors.subject="":(this.errors.subject="Subject is required",n=!1),this.emailData.message?this.errors.message="":(this.errors.message="Message cannot be empty",n=!1),n},async sendEmail(){if(!this.validateFields())return;const n=this.emailData.to.split(",").map(e=>e.trim());try{const e=await ni.post("https://sendmail-fqquxhhbva-uc.a.run.app",{to:n,subject:this.emailData.subject,text:this.emailData.message,html:`<p>${this.emailData.message}</p>`});console.log(e),this.status="Y"}catch(e){console.error("Error sending email:",e),this.status="F"}}}},Hg=n=>(z0("data-v-84ae51e8"),n=n(),F0(),n),Sq={class:"container mt-5"},Cq={class:"row"},Rq=Hg(()=>dt("h1",{class:"text-center"},"Send Mail",-1)),kq={class:"mb-3"},Pq=Hg(()=>dt("label",{for:"to",class:"form-label"},"To: (If you need to send multiple users, separate them with comma)",-1)),Mq={key:0,class:"text-danger"},Dq={class:"mb-3"},Lq=Hg(()=>dt("label",{for:"subject",class:"form-label"},"subject:",-1)),Oq={key:0,class:"text-danger"},Bq={class:"mb-3"},zq=Hg(()=>dt("label",{for:"message",class:"form-label"},"Message:",-1)),Fq={key:0,class:"text-danger"},Nq=Hg(()=>dt("div",{class:"text-center"},[dt("button",{type:"submit",class:"btn btn-primary me-2"},"Send Mail")],-1)),Vq={key:0,class:"alert alert-primary status",role:"alert"},Uq={key:1,class:"alert alert-danger status",role:"alert"};function jq(n,e,i,u,g,b){return en(),rn("div",Sq,[dt("div",Cq,[Rq,dt("form",{onSubmit:e[3]||(e[3]=H0((...I)=>b.sendEmail&&b.sendEmail(...I),["prevent"]))},[dt("div",kq,[Pq,_o(dt("input",{type:"text",class:"form-control",id:"to","onUpdate:modelValue":e[0]||(e[0]=I=>g.emailData.to=I),required:""},null,512),[[Is,g.emailData.to]]),g.errors.to?(en(),rn("div",Mq,Vn(g.errors.to),1)):hi("",!0)]),dt("div",Dq,[Lq,_o(dt("input",{type:"text",class:"form-control",id:"subject","onUpdate:modelValue":e[1]||(e[1]=I=>g.emailData.subject=I),required:""},null,512),[[Is,g.emailData.subject]]),g.errors.subject?(en(),rn("div",Oq,Vn(g.errors.subject),1)):hi("",!0)]),dt("div",Bq,[zq,_o(dt("textarea",{class:"form-control",name:"message","onUpdate:modelValue":e[2]||(e[2]=I=>g.emailData.message=I),rows:"3"},null,512),[[Is,g.emailData.message]]),g.errors.message?(en(),rn("div",Fq,Vn(g.errors.message),1)):hi("",!0)]),Nq],32),g.status=="Y"?(en(),rn("div",Vq,[ts(" Email sent to "+Vn(n.to)+" successfully! ",1),dt("button",{type:"button",style:{float:"right"},class:"btn-close","data-bs-dismiss":"alert","aria-label":"Close",onClick:e[4]||(e[4]=(...I)=>b.close&&b.close(...I))})])):hi("",!0),g.status=="F"?(en(),rn("div",Uq,[ts(" Failed to send email "),dt("button",{type:"button",style:{float:"right"},class:"btn-close","data-bs-dismiss":"alert","aria-label":"Close",onClick:e[5]||(e[5]=(...I)=>b.close&&b.close(...I))})])):hi("",!0)])])}const $q=zs(Aq,[["render",jq],["__scopeId","data-v-84ae51e8"]]),qq={data(){return{user:sessionStorage.getItem("user"),book:{isbn:"",name:"",category:"",creator:this.user,createdAt:new Date}}},methods:{toUpperCaseBook(n){return{isbn:n.isbn.toUpperCase(),name:n.name.toUpperCase(),category:n.category,creator:this.user,createdAt:new Date}},async addBook(){try{const n=this.toUpperCaseBook(this.book);await ni.post("https://createbook-fqquxhhbva-uc.a.run.app",n),alert("Add Book Successfully"),this.book.isbn="",this.book.name="",this.book.category=""}catch(n){console.error("Error add book:",n)}}}},Gq={class:"container mt-5"},Hq={class:"row"},Wq=dt("h1",{class:"text-center"},"Add Book to My Collection",-1),Zq={class:"mb-3"},Xq=dt("label",{for:"isbn",class:"form-label"},"ISBN:",-1),Kq={class:"mb-3"},Yq=dt("label",{for:"name",class:"form-label"},"Name:",-1),Jq={class:"mb-3"},Qq=dt("label",{for:"category",class:"form-label"},"Category:",-1),eG=j0('<option value="Fiction">Fiction</option><option value="Science">Science</option><option value="Fantasy">Fantasy</option><option value="Horror">Horror</option><option value="Mystery">Mystery</option><option value="Romance">Romance</option>',6),tG=[eG],rG=dt("div",{class:"text-center"},[dt("button",{type:"submit",class:"btn btn-primary me-2"},"Add Book")],-1);function nG(n,e,i,u,g,b){return en(),rn("div",Gq,[dt("div",Hq,[Wq,dt("form",{onSubmit:e[3]||(e[3]=H0((...I)=>b.addBook&&b.addBook(...I),["prevent"]))},[dt("div",Zq,[Xq,_o(dt("input",{type:"text",class:"form-control",id:"isbn","onUpdate:modelValue":e[0]||(e[0]=I=>g.book.isbn=I),required:""},null,512),[[Is,g.book.isbn]])]),dt("div",Kq,[Yq,_o(dt("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":e[1]||(e[1]=I=>g.book.name=I),required:""},null,512),[[Is,g.book.name]])]),dt("div",Jq,[Qq,_o(dt("select",{class:"form-select",id:"category","onUpdate:modelValue":e[2]||(e[2]=I=>g.book.category=I),required:""},tG,512),[[G0,g.book.category]])]),rG],32)])])}const iG=zs(qq,[["render",nG]]),oG={data(){return{jsondata:null}},mounted(){this.getBookCountAPI()},methods:{async getBookCountAPI(){try{const e=(await ni.get("https://getbooks-fqquxhhbva-uc.a.run.app")).data.map(i=>({isbn:i.isbn,name:i.name,category:i.category,creator:i.creator}));this.jsondata={code:200,status:"success",message:"get all books successful",data:e}}catch(n){console.error("Error fetching books:",n),this.jsondata={code:400,status:"failed",message:"get all books failed",data:null}}}}},sG={key:0};function aG(n,e,i,u,g,b){return g.jsondata?(en(),rn("pre",sG,Vn(g.jsondata),1)):hi("",!0)}const lG=zs(oG,[["render",aG]]),cG={data(){return{jsondata:null}},mounted(){this.getBookCountAPI()},methods:{async getBookCountAPI(){try{const e=(await ni.get("https://getusers-fqquxhhbva-uc.a.run.app")).data.map(i=>({email:i.email,gender:i.gender}));this.jsondata={code:200,status:"success",message:"get all users successful",data:e}}catch(n){console.error("Error fetching book count:",n),this.jsondata={code:400,status:"failed",message:"get all users failed",data:null}}}}},uG={key:0};function hG(n,e,i,u,g,b){return g.jsondata?(en(),rn("pre",uG,Vn(g.jsondata),1)):hi("",!0)}const dG=zs(cG,[["render",hG]]),aR="7c500bc13b4c633eda39bf7ecaa21455",fG={name:"App",data(){return{city:"",weatherData:null,hourlyForecast:[],dailyForecast:[]}},computed:{temperature(){return this.weatherData?Math.floor(this.weatherData.main.temp-273):null},iconUrl(){return this.weatherData?`https://api.openweathermap.org/img/w/${this.weatherData.weather[0].icon}.png`:null}},mounted(){this.fetchCurrentLocationWeather()},methods:{async fetchCurrentLocationWeather(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(async n=>{const{latitude:e,longitude:i}=n.coords,u=`https://api.openweathermap.org/data/2.5/weather?lat=${e}&lon=${i}&appid=${aR}`;await this.fetchWeatherData(u)})},async fetchWeatherData(n){try{const e=await ni.get(n);this.weatherData=e.data}catch(e){console.error("Error fetching weather data:",e)}},async searchByCity(){const n=await ni.get("https://api.openweathermap.org/data/2.5/weather",{params:{q:this.city,appid:aR}});this.weatherData=n.data}}},pG={class:"container"},mG={class:"row"},gG=dt("h1",{class:"text-center"},"WEATHER APP",-1),_G={class:"row row-cols-lg-auto align-items-center justify-content-center",action:"#",style:{"margin-bottom":"20px"}},yG=dt("div",{class:"col-2"}," City Name ",-1),vG={class:"col-10"},bG={class:"col-12"},xG={class:"text-center"},wG={key:0},TG=["src"];function EG(n,e,i,u,g,b){return en(),rn(ws,null,[dt("div",pG,[dt("div",mG,[gG,dt("form",_G,[yG,dt("div",vG,[_o(dt("input",{type:"text",class:"form-control",id:"inlineFormInputGroupUsername","onUpdate:modelValue":e[0]||(e[0]=I=>g.city=I),placeholder:"Enter City Name"},null,512),[[Is,g.city]])]),dt("div",bG,[dt("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=(...I)=>b.searchByCity&&b.searchByCity(...I))},"Search")])])])]),dt("main",xG,[g.weatherData?(en(),rn("div",wG,[dt("h2",null,Vn(g.weatherData.name)+", "+Vn(g.weatherData.sys.country),1),dt("div",null,[dt("img",{src:b.iconUrl,alt:"Weather Icon"},null,8,TG),dt("p",null,Vn(b.temperature)+" C",1)]),dt("span",null,Vn(g.weatherData.weather[0].description),1)])):hi("",!0)])],64)}const IG=zs(fG,[["render",EG]]);var WD={exports:{}};(function(n,e){var i={};(function(u,g){n.exports=g()})(bR,function(){var u,g,b;function I(s,$){if(!u)u=$;else if(!g)g=$;else{var W="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+g+")(sharedChunk); self.onerror = null;",Q={};u(Q),b=$(Q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(b.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}I(["exports"],function(s){function $(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var W,Q={},ae={};function we(){if(W)return ae;W=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.setMatrixArrayType=function(p){ae.ARRAY_TYPE=t=p},ae.toRadian=function(p){return p*c},ae.equals=function(p,h){return Math.abs(p-h)<=l*Math.max(1,Math.abs(p),Math.abs(h))},ae.RANDOM=ae.ARRAY_TYPE=ae.EPSILON=void 0;var l=1e-6;ae.EPSILON=l;var t=typeof Float32Array<"u"?Float32Array:Array;ae.ARRAY_TYPE=t;var o=Math.random;ae.RANDOM=o;var c=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var p=0,h=arguments.length;h--;)p+=arguments[h]*arguments[h];return Math.sqrt(p)}),ae}var He,$e={};function Ne(){if(He)return $e;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(h)}He=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.create=function(){var h=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},$e.clone=function(h){var m=new t.ARRAY_TYPE(4);return m[0]=h[0],m[1]=h[1],m[2]=h[2],m[3]=h[3],m},$e.copy=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[3],h},$e.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},$e.fromValues=function(h,m,x,A){var R=new t.ARRAY_TYPE(4);return R[0]=h,R[1]=m,R[2]=x,R[3]=A,R},$e.set=function(h,m,x,A,R){return h[0]=m,h[1]=x,h[2]=A,h[3]=R,h},$e.transpose=function(h,m){if(h===m){var x=m[1];h[1]=m[2],h[2]=x}else h[0]=m[0],h[1]=m[2],h[2]=m[1],h[3]=m[3];return h},$e.invert=function(h,m){var x=m[0],A=m[1],R=m[2],y=m[3],T=x*y-R*A;return T?(h[0]=y*(T=1/T),h[1]=-A*T,h[2]=-R*T,h[3]=x*T,h):null},$e.adjoint=function(h,m){var x=m[0];return h[0]=m[3],h[1]=-m[1],h[2]=-m[2],h[3]=x,h},$e.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},$e.multiply=c,$e.rotate=function(h,m,x){var A=m[0],R=m[1],y=m[2],T=m[3],C=Math.sin(x),E=Math.cos(x);return h[0]=A*E+y*C,h[1]=R*E+T*C,h[2]=A*-C+y*E,h[3]=R*-C+T*E,h},$e.scale=function(h,m,x){var A=m[1],R=m[2],y=m[3],T=x[0],C=x[1];return h[0]=m[0]*T,h[1]=A*T,h[2]=R*C,h[3]=y*C,h},$e.fromRotation=function(h,m){var x=Math.sin(m),A=Math.cos(m);return h[0]=A,h[1]=x,h[2]=-x,h[3]=A,h},$e.fromScaling=function(h,m){return h[0]=m[0],h[1]=0,h[2]=0,h[3]=m[1],h},$e.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},$e.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},$e.LDU=function(h,m,x,A){return h[2]=A[2]/A[0],x[0]=A[0],x[1]=A[1],x[3]=A[3]-h[2]*x[1],[h,m,x]},$e.add=function(h,m,x){return h[0]=m[0]+x[0],h[1]=m[1]+x[1],h[2]=m[2]+x[2],h[3]=m[3]+x[3],h},$e.subtract=p,$e.exactEquals=function(h,m){return h[0]===m[0]&&h[1]===m[1]&&h[2]===m[2]&&h[3]===m[3]},$e.equals=function(h,m){var x=h[0],A=h[1],R=h[2],y=h[3],T=m[0],C=m[1],E=m[2],S=m[3];return Math.abs(x-T)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(T))&&Math.abs(A-C)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(C))&&Math.abs(R-E)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(E))&&Math.abs(y-S)<=t.EPSILON*Math.max(1,Math.abs(y),Math.abs(S))},$e.multiplyScalar=function(h,m,x){return h[0]=m[0]*x,h[1]=m[1]*x,h[2]=m[2]*x,h[3]=m[3]*x,h},$e.multiplyScalarAndAdd=function(h,m,x,A){return h[0]=m[0]+x[0]*A,h[1]=m[1]+x[1]*A,h[2]=m[2]+x[2]*A,h[3]=m[3]+x[3]*A,h},$e.sub=$e.mul=void 0;var t=function(h,m){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var x=o(void 0);if(x&&x.has(h))return x.get(h);var A={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in h)if(y!=="default"&&Object.prototype.hasOwnProperty.call(h,y)){var T=R?Object.getOwnPropertyDescriptor(h,y):null;T&&(T.get||T.set)?Object.defineProperty(A,y,T):A[y]=h[y]}return A.default=h,x&&x.set(h,A),A}(we());function o(h){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(o=function(A){return A?x:m})(h)}function c(h,m,x){var A=m[0],R=m[1],y=m[2],T=m[3],C=x[0],E=x[1],S=x[2],P=x[3];return h[0]=A*C+y*E,h[1]=R*C+T*E,h[2]=A*S+y*P,h[3]=R*S+T*P,h}function p(h,m,x){return h[0]=m[0]-x[0],h[1]=m[1]-x[1],h[2]=m[2]-x[2],h[3]=m[3]-x[3],h}return $e.mul=c,$e.sub=p,$e}var wt,mt={};function vt(){if(wt)return mt;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(h)}wt=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.create=function(){var h=new t.ARRAY_TYPE(6);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},mt.clone=function(h){var m=new t.ARRAY_TYPE(6);return m[0]=h[0],m[1]=h[1],m[2]=h[2],m[3]=h[3],m[4]=h[4],m[5]=h[5],m},mt.copy=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[3],h[4]=m[4],h[5]=m[5],h},mt.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},mt.fromValues=function(h,m,x,A,R,y){var T=new t.ARRAY_TYPE(6);return T[0]=h,T[1]=m,T[2]=x,T[3]=A,T[4]=R,T[5]=y,T},mt.set=function(h,m,x,A,R,y,T){return h[0]=m,h[1]=x,h[2]=A,h[3]=R,h[4]=y,h[5]=T,h},mt.invert=function(h,m){var x=m[0],A=m[1],R=m[2],y=m[3],T=m[4],C=m[5],E=x*y-A*R;return E?(h[0]=y*(E=1/E),h[1]=-A*E,h[2]=-R*E,h[3]=x*E,h[4]=(R*C-y*T)*E,h[5]=(A*T-x*C)*E,h):null},mt.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},mt.multiply=c,mt.rotate=function(h,m,x){var A=m[0],R=m[1],y=m[2],T=m[3],C=m[4],E=m[5],S=Math.sin(x),P=Math.cos(x);return h[0]=A*P+y*S,h[1]=R*P+T*S,h[2]=A*-S+y*P,h[3]=R*-S+T*P,h[4]=C,h[5]=E,h},mt.scale=function(h,m,x){var A=m[1],R=m[2],y=m[3],T=m[4],C=m[5],E=x[0],S=x[1];return h[0]=m[0]*E,h[1]=A*E,h[2]=R*S,h[3]=y*S,h[4]=T,h[5]=C,h},mt.translate=function(h,m,x){var A=m[0],R=m[1],y=m[2],T=m[3],C=m[4],E=m[5],S=x[0],P=x[1];return h[0]=A,h[1]=R,h[2]=y,h[3]=T,h[4]=A*S+y*P+C,h[5]=R*S+T*P+E,h},mt.fromRotation=function(h,m){var x=Math.sin(m),A=Math.cos(m);return h[0]=A,h[1]=x,h[2]=-x,h[3]=A,h[4]=0,h[5]=0,h},mt.fromScaling=function(h,m){return h[0]=m[0],h[1]=0,h[2]=0,h[3]=m[1],h[4]=0,h[5]=0,h},mt.fromTranslation=function(h,m){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=m[0],h[5]=m[1],h},mt.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},mt.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},mt.add=function(h,m,x){return h[0]=m[0]+x[0],h[1]=m[1]+x[1],h[2]=m[2]+x[2],h[3]=m[3]+x[3],h[4]=m[4]+x[4],h[5]=m[5]+x[5],h},mt.subtract=p,mt.multiplyScalar=function(h,m,x){return h[0]=m[0]*x,h[1]=m[1]*x,h[2]=m[2]*x,h[3]=m[3]*x,h[4]=m[4]*x,h[5]=m[5]*x,h},mt.multiplyScalarAndAdd=function(h,m,x,A){return h[0]=m[0]+x[0]*A,h[1]=m[1]+x[1]*A,h[2]=m[2]+x[2]*A,h[3]=m[3]+x[3]*A,h[4]=m[4]+x[4]*A,h[5]=m[5]+x[5]*A,h},mt.exactEquals=function(h,m){return h[0]===m[0]&&h[1]===m[1]&&h[2]===m[2]&&h[3]===m[3]&&h[4]===m[4]&&h[5]===m[5]},mt.equals=function(h,m){var x=h[0],A=h[1],R=h[2],y=h[3],T=h[4],C=h[5],E=m[0],S=m[1],P=m[2],O=m[3],F=m[4],j=m[5];return Math.abs(x-E)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(E))&&Math.abs(A-S)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(S))&&Math.abs(R-P)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(P))&&Math.abs(y-O)<=t.EPSILON*Math.max(1,Math.abs(y),Math.abs(O))&&Math.abs(T-F)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(F))&&Math.abs(C-j)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(j))},mt.sub=mt.mul=void 0;var t=function(h,m){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var x=o(void 0);if(x&&x.has(h))return x.get(h);var A={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in h)if(y!=="default"&&Object.prototype.hasOwnProperty.call(h,y)){var T=R?Object.getOwnPropertyDescriptor(h,y):null;T&&(T.get||T.set)?Object.defineProperty(A,y,T):A[y]=h[y]}return A.default=h,x&&x.set(h,A),A}(we());function o(h){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(o=function(A){return A?x:m})(h)}function c(h,m,x){var A=m[0],R=m[1],y=m[2],T=m[3],C=m[4],E=m[5],S=x[0],P=x[1],O=x[2],F=x[3],j=x[4],G=x[5];return h[0]=A*S+y*P,h[1]=R*S+T*P,h[2]=A*O+y*F,h[3]=R*O+T*F,h[4]=A*j+y*G+C,h[5]=R*j+T*G+E,h}function p(h,m,x){return h[0]=m[0]-x[0],h[1]=m[1]-x[1],h[2]=m[2]-x[2],h[3]=m[3]-x[3],h[4]=m[4]-x[4],h[5]=m[5]-x[5],h}return mt.mul=c,mt.sub=p,mt}var zt,Ct={};function qt(){if(zt)return Ct;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(h)}zt=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.create=function(){var h=new t.ARRAY_TYPE(9);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},Ct.fromMat4=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[4],h[4]=m[5],h[5]=m[6],h[6]=m[8],h[7]=m[9],h[8]=m[10],h},Ct.clone=function(h){var m=new t.ARRAY_TYPE(9);return m[0]=h[0],m[1]=h[1],m[2]=h[2],m[3]=h[3],m[4]=h[4],m[5]=h[5],m[6]=h[6],m[7]=h[7],m[8]=h[8],m},Ct.copy=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[3],h[4]=m[4],h[5]=m[5],h[6]=m[6],h[7]=m[7],h[8]=m[8],h},Ct.fromValues=function(h,m,x,A,R,y,T,C,E){var S=new t.ARRAY_TYPE(9);return S[0]=h,S[1]=m,S[2]=x,S[3]=A,S[4]=R,S[5]=y,S[6]=T,S[7]=C,S[8]=E,S},Ct.set=function(h,m,x,A,R,y,T,C,E,S){return h[0]=m,h[1]=x,h[2]=A,h[3]=R,h[4]=y,h[5]=T,h[6]=C,h[7]=E,h[8]=S,h},Ct.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Ct.transpose=function(h,m){if(h===m){var x=m[1],A=m[2],R=m[5];h[1]=m[3],h[2]=m[6],h[3]=x,h[5]=m[7],h[6]=A,h[7]=R}else h[0]=m[0],h[1]=m[3],h[2]=m[6],h[3]=m[1],h[4]=m[4],h[5]=m[7],h[6]=m[2],h[7]=m[5],h[8]=m[8];return h},Ct.invert=function(h,m){var x=m[0],A=m[1],R=m[2],y=m[3],T=m[4],C=m[5],E=m[6],S=m[7],P=m[8],O=P*T-C*S,F=-P*y+C*E,j=S*y-T*E,G=x*O+A*F+R*j;return G?(h[0]=O*(G=1/G),h[1]=(-P*A+R*S)*G,h[2]=(C*A-R*T)*G,h[3]=F*G,h[4]=(P*x-R*E)*G,h[5]=(-C*x+R*y)*G,h[6]=j*G,h[7]=(-S*x+A*E)*G,h[8]=(T*x-A*y)*G,h):null},Ct.adjoint=function(h,m){var x=m[0],A=m[1],R=m[2],y=m[3],T=m[4],C=m[5],E=m[6],S=m[7],P=m[8];return h[0]=T*P-C*S,h[1]=R*S-A*P,h[2]=A*C-R*T,h[3]=C*E-y*P,h[4]=x*P-R*E,h[5]=R*y-x*C,h[6]=y*S-T*E,h[7]=A*E-x*S,h[8]=x*T-A*y,h},Ct.determinant=function(h){var m=h[3],x=h[4],A=h[5],R=h[6],y=h[7],T=h[8];return h[0]*(T*x-A*y)+h[1]*(-T*m+A*R)+h[2]*(y*m-x*R)},Ct.multiply=c,Ct.translate=function(h,m,x){var A=m[0],R=m[1],y=m[2],T=m[3],C=m[4],E=m[5],S=m[6],P=m[7],O=m[8],F=x[0],j=x[1];return h[0]=A,h[1]=R,h[2]=y,h[3]=T,h[4]=C,h[5]=E,h[6]=F*A+j*T+S,h[7]=F*R+j*C+P,h[8]=F*y+j*E+O,h},Ct.rotate=function(h,m,x){var A=m[0],R=m[1],y=m[2],T=m[3],C=m[4],E=m[5],S=m[6],P=m[7],O=m[8],F=Math.sin(x),j=Math.cos(x);return h[0]=j*A+F*T,h[1]=j*R+F*C,h[2]=j*y+F*E,h[3]=j*T-F*A,h[4]=j*C-F*R,h[5]=j*E-F*y,h[6]=S,h[7]=P,h[8]=O,h},Ct.scale=function(h,m,x){var A=x[0],R=x[1];return h[0]=A*m[0],h[1]=A*m[1],h[2]=A*m[2],h[3]=R*m[3],h[4]=R*m[4],h[5]=R*m[5],h[6]=m[6],h[7]=m[7],h[8]=m[8],h},Ct.fromTranslation=function(h,m){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=m[0],h[7]=m[1],h[8]=1,h},Ct.fromRotation=function(h,m){var x=Math.sin(m),A=Math.cos(m);return h[0]=A,h[1]=x,h[2]=0,h[3]=-x,h[4]=A,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Ct.fromScaling=function(h,m){return h[0]=m[0],h[1]=0,h[2]=0,h[3]=0,h[4]=m[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Ct.fromMat2d=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=0,h[3]=m[2],h[4]=m[3],h[5]=0,h[6]=m[4],h[7]=m[5],h[8]=1,h},Ct.fromQuat=function(h,m){var x=m[0],A=m[1],R=m[2],y=m[3],T=x+x,C=A+A,E=R+R,S=x*T,P=A*T,O=A*C,F=R*T,j=R*C,G=R*E,N=y*T,Z=y*C,K=y*E;return h[0]=1-O-G,h[3]=P-K,h[6]=F+Z,h[1]=P+K,h[4]=1-S-G,h[7]=j-N,h[2]=F-Z,h[5]=j+N,h[8]=1-S-O,h},Ct.normalFromMat4=function(h,m){var x=m[0],A=m[1],R=m[2],y=m[3],T=m[4],C=m[5],E=m[6],S=m[7],P=m[8],O=m[9],F=m[10],j=m[11],G=m[12],N=m[13],Z=m[14],K=m[15],ie=x*C-A*T,ue=x*E-R*T,de=x*S-y*T,le=A*E-R*C,xe=A*S-y*C,me=R*S-y*E,Ee=P*N-O*G,Pe=P*Z-F*G,Be=P*K-j*G,ze=O*Z-F*N,Ge=O*K-j*N,rt=F*K-j*Z,Ze=ie*rt-ue*Ge+de*ze+le*Be-xe*Pe+me*Ee;return Ze?(h[0]=(C*rt-E*Ge+S*ze)*(Ze=1/Ze),h[1]=(E*Be-T*rt-S*Pe)*Ze,h[2]=(T*Ge-C*Be+S*Ee)*Ze,h[3]=(R*Ge-A*rt-y*ze)*Ze,h[4]=(x*rt-R*Be+y*Pe)*Ze,h[5]=(A*Be-x*Ge-y*Ee)*Ze,h[6]=(N*me-Z*xe+K*le)*Ze,h[7]=(Z*de-G*me-K*ue)*Ze,h[8]=(G*xe-N*de+K*ie)*Ze,h):null},Ct.projection=function(h,m,x){return h[0]=2/m,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/x,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},Ct.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},Ct.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},Ct.add=function(h,m,x){return h[0]=m[0]+x[0],h[1]=m[1]+x[1],h[2]=m[2]+x[2],h[3]=m[3]+x[3],h[4]=m[4]+x[4],h[5]=m[5]+x[5],h[6]=m[6]+x[6],h[7]=m[7]+x[7],h[8]=m[8]+x[8],h},Ct.subtract=p,Ct.multiplyScalar=function(h,m,x){return h[0]=m[0]*x,h[1]=m[1]*x,h[2]=m[2]*x,h[3]=m[3]*x,h[4]=m[4]*x,h[5]=m[5]*x,h[6]=m[6]*x,h[7]=m[7]*x,h[8]=m[8]*x,h},Ct.multiplyScalarAndAdd=function(h,m,x,A){return h[0]=m[0]+x[0]*A,h[1]=m[1]+x[1]*A,h[2]=m[2]+x[2]*A,h[3]=m[3]+x[3]*A,h[4]=m[4]+x[4]*A,h[5]=m[5]+x[5]*A,h[6]=m[6]+x[6]*A,h[7]=m[7]+x[7]*A,h[8]=m[8]+x[8]*A,h},Ct.exactEquals=function(h,m){return h[0]===m[0]&&h[1]===m[1]&&h[2]===m[2]&&h[3]===m[3]&&h[4]===m[4]&&h[5]===m[5]&&h[6]===m[6]&&h[7]===m[7]&&h[8]===m[8]},Ct.equals=function(h,m){var x=h[0],A=h[1],R=h[2],y=h[3],T=h[4],C=h[5],E=h[6],S=h[7],P=h[8],O=m[0],F=m[1],j=m[2],G=m[3],N=m[4],Z=m[5],K=m[6],ie=m[7],ue=m[8];return Math.abs(x-O)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(O))&&Math.abs(A-F)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(F))&&Math.abs(R-j)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(j))&&Math.abs(y-G)<=t.EPSILON*Math.max(1,Math.abs(y),Math.abs(G))&&Math.abs(T-N)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(N))&&Math.abs(C-Z)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(Z))&&Math.abs(E-K)<=t.EPSILON*Math.max(1,Math.abs(E),Math.abs(K))&&Math.abs(S-ie)<=t.EPSILON*Math.max(1,Math.abs(S),Math.abs(ie))&&Math.abs(P-ue)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(ue))},Ct.sub=Ct.mul=void 0;var t=function(h,m){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var x=o(void 0);if(x&&x.has(h))return x.get(h);var A={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in h)if(y!=="default"&&Object.prototype.hasOwnProperty.call(h,y)){var T=R?Object.getOwnPropertyDescriptor(h,y):null;T&&(T.get||T.set)?Object.defineProperty(A,y,T):A[y]=h[y]}return A.default=h,x&&x.set(h,A),A}(we());function o(h){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(o=function(A){return A?x:m})(h)}function c(h,m,x){var A=m[0],R=m[1],y=m[2],T=m[3],C=m[4],E=m[5],S=m[6],P=m[7],O=m[8],F=x[0],j=x[1],G=x[2],N=x[3],Z=x[4],K=x[5],ie=x[6],ue=x[7],de=x[8];return h[0]=F*A+j*T+G*S,h[1]=F*R+j*C+G*P,h[2]=F*y+j*E+G*O,h[3]=N*A+Z*T+K*S,h[4]=N*R+Z*C+K*P,h[5]=N*y+Z*E+K*O,h[6]=ie*A+ue*T+de*S,h[7]=ie*R+ue*C+de*P,h[8]=ie*y+ue*E+de*O,h}function p(h,m,x){return h[0]=m[0]-x[0],h[1]=m[1]-x[1],h[2]=m[2]-x[2],h[3]=m[3]-x[3],h[4]=m[4]-x[4],h[5]=m[5]-x[5],h[6]=m[6]-x[6],h[7]=m[7]-x[7],h[8]=m[8]-x[8],h}return Ct.mul=c,Ct.sub=p,Ct}var qe,be={};function Fe(){if(qe)return be;function l(y){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},l(y)}qe=1,Object.defineProperty(be,"__esModule",{value:!0}),be.create=function(){var y=new t.ARRAY_TYPE(16);return t.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=0,y[12]=0,y[13]=0,y[14]=0),y[0]=1,y[5]=1,y[10]=1,y[15]=1,y},be.clone=function(y){var T=new t.ARRAY_TYPE(16);return T[0]=y[0],T[1]=y[1],T[2]=y[2],T[3]=y[3],T[4]=y[4],T[5]=y[5],T[6]=y[6],T[7]=y[7],T[8]=y[8],T[9]=y[9],T[10]=y[10],T[11]=y[11],T[12]=y[12],T[13]=y[13],T[14]=y[14],T[15]=y[15],T},be.copy=function(y,T){return y[0]=T[0],y[1]=T[1],y[2]=T[2],y[3]=T[3],y[4]=T[4],y[5]=T[5],y[6]=T[6],y[7]=T[7],y[8]=T[8],y[9]=T[9],y[10]=T[10],y[11]=T[11],y[12]=T[12],y[13]=T[13],y[14]=T[14],y[15]=T[15],y},be.fromValues=function(y,T,C,E,S,P,O,F,j,G,N,Z,K,ie,ue,de){var le=new t.ARRAY_TYPE(16);return le[0]=y,le[1]=T,le[2]=C,le[3]=E,le[4]=S,le[5]=P,le[6]=O,le[7]=F,le[8]=j,le[9]=G,le[10]=N,le[11]=Z,le[12]=K,le[13]=ie,le[14]=ue,le[15]=de,le},be.set=function(y,T,C,E,S,P,O,F,j,G,N,Z,K,ie,ue,de,le){return y[0]=T,y[1]=C,y[2]=E,y[3]=S,y[4]=P,y[5]=O,y[6]=F,y[7]=j,y[8]=G,y[9]=N,y[10]=Z,y[11]=K,y[12]=ie,y[13]=ue,y[14]=de,y[15]=le,y},be.identity=c,be.transpose=function(y,T){if(y===T){var C=T[1],E=T[2],S=T[3],P=T[6],O=T[7],F=T[11];y[1]=T[4],y[2]=T[8],y[3]=T[12],y[4]=C,y[6]=T[9],y[7]=T[13],y[8]=E,y[9]=P,y[11]=T[14],y[12]=S,y[13]=O,y[14]=F}else y[0]=T[0],y[1]=T[4],y[2]=T[8],y[3]=T[12],y[4]=T[1],y[5]=T[5],y[6]=T[9],y[7]=T[13],y[8]=T[2],y[9]=T[6],y[10]=T[10],y[11]=T[14],y[12]=T[3],y[13]=T[7],y[14]=T[11],y[15]=T[15];return y},be.invert=function(y,T){var C=T[0],E=T[1],S=T[2],P=T[3],O=T[4],F=T[5],j=T[6],G=T[7],N=T[8],Z=T[9],K=T[10],ie=T[11],ue=T[12],de=T[13],le=T[14],xe=T[15],me=C*F-E*O,Ee=C*j-S*O,Pe=C*G-P*O,Be=E*j-S*F,ze=E*G-P*F,Ge=S*G-P*j,rt=N*de-Z*ue,Ze=N*le-K*ue,ft=N*xe-ie*ue,xt=Z*le-K*de,lt=Z*xe-ie*de,Yt=K*xe-ie*le,Vt=me*Yt-Ee*lt+Pe*xt+Be*ft-ze*Ze+Ge*rt;return Vt?(y[0]=(F*Yt-j*lt+G*xt)*(Vt=1/Vt),y[1]=(S*lt-E*Yt-P*xt)*Vt,y[2]=(de*Ge-le*ze+xe*Be)*Vt,y[3]=(K*ze-Z*Ge-ie*Be)*Vt,y[4]=(j*ft-O*Yt-G*Ze)*Vt,y[5]=(C*Yt-S*ft+P*Ze)*Vt,y[6]=(le*Pe-ue*Ge-xe*Ee)*Vt,y[7]=(N*Ge-K*Pe+ie*Ee)*Vt,y[8]=(O*lt-F*ft+G*rt)*Vt,y[9]=(E*ft-C*lt-P*rt)*Vt,y[10]=(ue*ze-de*Pe+xe*me)*Vt,y[11]=(Z*Pe-N*ze-ie*me)*Vt,y[12]=(F*Ze-O*xt-j*rt)*Vt,y[13]=(C*xt-E*Ze+S*rt)*Vt,y[14]=(de*Ee-ue*Be-le*me)*Vt,y[15]=(N*Be-Z*Ee+K*me)*Vt,y):null},be.adjoint=function(y,T){var C=T[0],E=T[1],S=T[2],P=T[3],O=T[4],F=T[5],j=T[6],G=T[7],N=T[8],Z=T[9],K=T[10],ie=T[11],ue=T[12],de=T[13],le=T[14],xe=T[15];return y[0]=F*(K*xe-ie*le)-Z*(j*xe-G*le)+de*(j*ie-G*K),y[1]=-(E*(K*xe-ie*le)-Z*(S*xe-P*le)+de*(S*ie-P*K)),y[2]=E*(j*xe-G*le)-F*(S*xe-P*le)+de*(S*G-P*j),y[3]=-(E*(j*ie-G*K)-F*(S*ie-P*K)+Z*(S*G-P*j)),y[4]=-(O*(K*xe-ie*le)-N*(j*xe-G*le)+ue*(j*ie-G*K)),y[5]=C*(K*xe-ie*le)-N*(S*xe-P*le)+ue*(S*ie-P*K),y[6]=-(C*(j*xe-G*le)-O*(S*xe-P*le)+ue*(S*G-P*j)),y[7]=C*(j*ie-G*K)-O*(S*ie-P*K)+N*(S*G-P*j),y[8]=O*(Z*xe-ie*de)-N*(F*xe-G*de)+ue*(F*ie-G*Z),y[9]=-(C*(Z*xe-ie*de)-N*(E*xe-P*de)+ue*(E*ie-P*Z)),y[10]=C*(F*xe-G*de)-O*(E*xe-P*de)+ue*(E*G-P*F),y[11]=-(C*(F*ie-G*Z)-O*(E*ie-P*Z)+N*(E*G-P*F)),y[12]=-(O*(Z*le-K*de)-N*(F*le-j*de)+ue*(F*K-j*Z)),y[13]=C*(Z*le-K*de)-N*(E*le-S*de)+ue*(E*K-S*Z),y[14]=-(C*(F*le-j*de)-O*(E*le-S*de)+ue*(E*j-S*F)),y[15]=C*(F*K-j*Z)-O*(E*K-S*Z)+N*(E*j-S*F),y},be.determinant=function(y){var T=y[0],C=y[1],E=y[2],S=y[3],P=y[4],O=y[5],F=y[6],j=y[7],G=y[8],N=y[9],Z=y[10],K=y[11],ie=y[12],ue=y[13],de=y[14],le=y[15];return(T*O-C*P)*(Z*le-K*de)-(T*F-E*P)*(N*le-K*ue)+(T*j-S*P)*(N*de-Z*ue)+(C*F-E*O)*(G*le-K*ie)-(C*j-S*O)*(G*de-Z*ie)+(E*j-S*F)*(G*ue-N*ie)},be.multiply=p,be.translate=function(y,T,C){var E,S,P,O,F,j,G,N,Z,K,ie,ue,de=C[0],le=C[1],xe=C[2];return T===y?(y[12]=T[0]*de+T[4]*le+T[8]*xe+T[12],y[13]=T[1]*de+T[5]*le+T[9]*xe+T[13],y[14]=T[2]*de+T[6]*le+T[10]*xe+T[14],y[15]=T[3]*de+T[7]*le+T[11]*xe+T[15]):(S=T[1],P=T[2],O=T[3],F=T[4],j=T[5],G=T[6],N=T[7],Z=T[8],K=T[9],ie=T[10],ue=T[11],y[0]=E=T[0],y[1]=S,y[2]=P,y[3]=O,y[4]=F,y[5]=j,y[6]=G,y[7]=N,y[8]=Z,y[9]=K,y[10]=ie,y[11]=ue,y[12]=E*de+F*le+Z*xe+T[12],y[13]=S*de+j*le+K*xe+T[13],y[14]=P*de+G*le+ie*xe+T[14],y[15]=O*de+N*le+ue*xe+T[15]),y},be.scale=function(y,T,C){var E=C[0],S=C[1],P=C[2];return y[0]=T[0]*E,y[1]=T[1]*E,y[2]=T[2]*E,y[3]=T[3]*E,y[4]=T[4]*S,y[5]=T[5]*S,y[6]=T[6]*S,y[7]=T[7]*S,y[8]=T[8]*P,y[9]=T[9]*P,y[10]=T[10]*P,y[11]=T[11]*P,y[12]=T[12],y[13]=T[13],y[14]=T[14],y[15]=T[15],y},be.rotate=function(y,T,C,E){var S,P,O,F,j,G,N,Z,K,ie,ue,de,le,xe,me,Ee,Pe,Be,ze,Ge,rt,Ze,ft,xt,lt=E[0],Yt=E[1],Vt=E[2],Mt=Math.hypot(lt,Yt,Vt);return Mt<t.EPSILON?null:(lt*=Mt=1/Mt,Yt*=Mt,Vt*=Mt,S=Math.sin(C),P=Math.cos(C),j=T[1],G=T[2],N=T[3],K=T[5],ie=T[6],ue=T[7],le=T[9],xe=T[10],me=T[11],Ee=lt*lt*(O=1-P)+P,ze=lt*Yt*O-Vt*S,Ge=Yt*Yt*O+P,rt=Vt*Yt*O+lt*S,Ze=lt*Vt*O+Yt*S,ft=Yt*Vt*O-lt*S,xt=Vt*Vt*O+P,y[0]=(F=T[0])*Ee+(Z=T[4])*(Pe=Yt*lt*O+Vt*S)+(de=T[8])*(Be=Vt*lt*O-Yt*S),y[1]=j*Ee+K*Pe+le*Be,y[2]=G*Ee+ie*Pe+xe*Be,y[3]=N*Ee+ue*Pe+me*Be,y[4]=F*ze+Z*Ge+de*rt,y[5]=j*ze+K*Ge+le*rt,y[6]=G*ze+ie*Ge+xe*rt,y[7]=N*ze+ue*Ge+me*rt,y[8]=F*Ze+Z*ft+de*xt,y[9]=j*Ze+K*ft+le*xt,y[10]=G*Ze+ie*ft+xe*xt,y[11]=N*Ze+ue*ft+me*xt,T!==y&&(y[12]=T[12],y[13]=T[13],y[14]=T[14],y[15]=T[15]),y)},be.rotateX=function(y,T,C){var E=Math.sin(C),S=Math.cos(C),P=T[4],O=T[5],F=T[6],j=T[7],G=T[8],N=T[9],Z=T[10],K=T[11];return T!==y&&(y[0]=T[0],y[1]=T[1],y[2]=T[2],y[3]=T[3],y[12]=T[12],y[13]=T[13],y[14]=T[14],y[15]=T[15]),y[4]=P*S+G*E,y[5]=O*S+N*E,y[6]=F*S+Z*E,y[7]=j*S+K*E,y[8]=G*S-P*E,y[9]=N*S-O*E,y[10]=Z*S-F*E,y[11]=K*S-j*E,y},be.rotateY=function(y,T,C){var E=Math.sin(C),S=Math.cos(C),P=T[0],O=T[1],F=T[2],j=T[3],G=T[8],N=T[9],Z=T[10],K=T[11];return T!==y&&(y[4]=T[4],y[5]=T[5],y[6]=T[6],y[7]=T[7],y[12]=T[12],y[13]=T[13],y[14]=T[14],y[15]=T[15]),y[0]=P*S-G*E,y[1]=O*S-N*E,y[2]=F*S-Z*E,y[3]=j*S-K*E,y[8]=P*E+G*S,y[9]=O*E+N*S,y[10]=F*E+Z*S,y[11]=j*E+K*S,y},be.rotateZ=function(y,T,C){var E=Math.sin(C),S=Math.cos(C),P=T[0],O=T[1],F=T[2],j=T[3],G=T[4],N=T[5],Z=T[6],K=T[7];return T!==y&&(y[8]=T[8],y[9]=T[9],y[10]=T[10],y[11]=T[11],y[12]=T[12],y[13]=T[13],y[14]=T[14],y[15]=T[15]),y[0]=P*S+G*E,y[1]=O*S+N*E,y[2]=F*S+Z*E,y[3]=j*S+K*E,y[4]=G*S-P*E,y[5]=N*S-O*E,y[6]=Z*S-F*E,y[7]=K*S-j*E,y},be.fromTranslation=function(y,T){return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=T[0],y[13]=T[1],y[14]=T[2],y[15]=1,y},be.fromScaling=function(y,T){return y[0]=T[0],y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=T[1],y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=T[2],y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},be.fromRotation=function(y,T,C){var E,S,P,O=C[0],F=C[1],j=C[2],G=Math.hypot(O,F,j);return G<t.EPSILON?null:(O*=G=1/G,F*=G,j*=G,E=Math.sin(T),S=Math.cos(T),y[0]=O*O*(P=1-S)+S,y[1]=F*O*P+j*E,y[2]=j*O*P-F*E,y[3]=0,y[4]=O*F*P-j*E,y[5]=F*F*P+S,y[6]=j*F*P+O*E,y[7]=0,y[8]=O*j*P+F*E,y[9]=F*j*P-O*E,y[10]=j*j*P+S,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y)},be.fromXRotation=function(y,T){var C=Math.sin(T),E=Math.cos(T);return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=E,y[6]=C,y[7]=0,y[8]=0,y[9]=-C,y[10]=E,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},be.fromYRotation=function(y,T){var C=Math.sin(T),E=Math.cos(T);return y[0]=E,y[1]=0,y[2]=-C,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=C,y[9]=0,y[10]=E,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},be.fromZRotation=function(y,T){var C=Math.sin(T),E=Math.cos(T);return y[0]=E,y[1]=C,y[2]=0,y[3]=0,y[4]=-C,y[5]=E,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},be.fromRotationTranslation=h,be.fromQuat2=function(y,T){var C=new t.ARRAY_TYPE(3),E=-T[0],S=-T[1],P=-T[2],O=T[3],F=T[4],j=T[5],G=T[6],N=T[7],Z=E*E+S*S+P*P+O*O;return Z>0?(C[0]=2*(F*O+N*E+j*P-G*S)/Z,C[1]=2*(j*O+N*S+G*E-F*P)/Z,C[2]=2*(G*O+N*P+F*S-j*E)/Z):(C[0]=2*(F*O+N*E+j*P-G*S),C[1]=2*(j*O+N*S+G*E-F*P),C[2]=2*(G*O+N*P+F*S-j*E)),h(y,T,C),y},be.getTranslation=function(y,T){return y[0]=T[12],y[1]=T[13],y[2]=T[14],y},be.getScaling=m,be.getRotation=function(y,T){var C=new t.ARRAY_TYPE(3);m(C,T);var E=1/C[0],S=1/C[1],P=1/C[2],O=T[0]*E,F=T[1]*S,j=T[2]*P,G=T[4]*E,N=T[5]*S,Z=T[6]*P,K=T[8]*E,ie=T[9]*S,ue=T[10]*P,de=O+N+ue,le=0;return de>0?(le=2*Math.sqrt(de+1),y[3]=.25*le,y[0]=(Z-ie)/le,y[1]=(K-j)/le,y[2]=(F-G)/le):O>N&&O>ue?(le=2*Math.sqrt(1+O-N-ue),y[3]=(Z-ie)/le,y[0]=.25*le,y[1]=(F+G)/le,y[2]=(K+j)/le):N>ue?(le=2*Math.sqrt(1+N-O-ue),y[3]=(K-j)/le,y[0]=(F+G)/le,y[1]=.25*le,y[2]=(Z+ie)/le):(le=2*Math.sqrt(1+ue-O-N),y[3]=(F-G)/le,y[0]=(K+j)/le,y[1]=(Z+ie)/le,y[2]=.25*le),y},be.fromRotationTranslationScale=function(y,T,C,E){var S=T[0],P=T[1],O=T[2],F=T[3],j=S+S,G=P+P,N=O+O,Z=S*j,K=S*G,ie=S*N,ue=P*G,de=P*N,le=O*N,xe=F*j,me=F*G,Ee=F*N,Pe=E[0],Be=E[1],ze=E[2];return y[0]=(1-(ue+le))*Pe,y[1]=(K+Ee)*Pe,y[2]=(ie-me)*Pe,y[3]=0,y[4]=(K-Ee)*Be,y[5]=(1-(Z+le))*Be,y[6]=(de+xe)*Be,y[7]=0,y[8]=(ie+me)*ze,y[9]=(de-xe)*ze,y[10]=(1-(Z+ue))*ze,y[11]=0,y[12]=C[0],y[13]=C[1],y[14]=C[2],y[15]=1,y},be.fromRotationTranslationScaleOrigin=function(y,T,C,E,S){var P=T[0],O=T[1],F=T[2],j=T[3],G=P+P,N=O+O,Z=F+F,K=P*G,ie=P*N,ue=P*Z,de=O*N,le=O*Z,xe=F*Z,me=j*G,Ee=j*N,Pe=j*Z,Be=E[0],ze=E[1],Ge=E[2],rt=S[0],Ze=S[1],ft=S[2],xt=(1-(de+xe))*Be,lt=(ie+Pe)*Be,Yt=(ue-Ee)*Be,Vt=(ie-Pe)*ze,Mt=(1-(K+xe))*ze,Et=(le+me)*ze,yr=(ue+Ee)*Ge,Xt=(le-me)*Ge,tr=(1-(K+de))*Ge;return y[0]=xt,y[1]=lt,y[2]=Yt,y[3]=0,y[4]=Vt,y[5]=Mt,y[6]=Et,y[7]=0,y[8]=yr,y[9]=Xt,y[10]=tr,y[11]=0,y[12]=C[0]+rt-(xt*rt+Vt*Ze+yr*ft),y[13]=C[1]+Ze-(lt*rt+Mt*Ze+Xt*ft),y[14]=C[2]+ft-(Yt*rt+Et*Ze+tr*ft),y[15]=1,y},be.fromQuat=function(y,T){var C=T[0],E=T[1],S=T[2],P=T[3],O=C+C,F=E+E,j=S+S,G=C*O,N=E*O,Z=E*F,K=S*O,ie=S*F,ue=S*j,de=P*O,le=P*F,xe=P*j;return y[0]=1-Z-ue,y[1]=N+xe,y[2]=K-le,y[3]=0,y[4]=N-xe,y[5]=1-G-ue,y[6]=ie+de,y[7]=0,y[8]=K+le,y[9]=ie-de,y[10]=1-G-Z,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},be.frustum=function(y,T,C,E,S,P,O){var F=1/(C-T),j=1/(S-E),G=1/(P-O);return y[0]=2*P*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=2*P*j,y[6]=0,y[7]=0,y[8]=(C+T)*F,y[9]=(S+E)*j,y[10]=(O+P)*G,y[11]=-1,y[12]=0,y[13]=0,y[14]=O*P*2*G,y[15]=0,y},be.perspectiveNO=x,be.perspectiveZO=function(y,T,C,E,S){var P,O=1/Math.tan(T/2);return y[0]=O/C,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=O,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,S!=null&&S!==1/0?(y[10]=S*(P=1/(E-S)),y[14]=S*E*P):(y[10]=-1,y[14]=-E),y},be.perspectiveFromFieldOfView=function(y,T,C,E){var S=Math.tan(T.upDegrees*Math.PI/180),P=Math.tan(T.downDegrees*Math.PI/180),O=Math.tan(T.leftDegrees*Math.PI/180),F=Math.tan(T.rightDegrees*Math.PI/180),j=2/(O+F),G=2/(S+P);return y[0]=j,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=G,y[6]=0,y[7]=0,y[8]=-(O-F)*j*.5,y[9]=(S-P)*G*.5,y[10]=E/(C-E),y[11]=-1,y[12]=0,y[13]=0,y[14]=E*C/(C-E),y[15]=0,y},be.orthoNO=A,be.orthoZO=function(y,T,C,E,S,P,O){var F=1/(T-C),j=1/(E-S),G=1/(P-O);return y[0]=-2*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=-2*j,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=G,y[11]=0,y[12]=(T+C)*F,y[13]=(S+E)*j,y[14]=P*G,y[15]=1,y},be.lookAt=function(y,T,C,E){var S,P,O,F,j,G,N,Z,K,ie,ue=T[0],de=T[1],le=T[2],xe=E[0],me=E[1],Ee=E[2],Pe=C[0],Be=C[1],ze=C[2];return Math.abs(ue-Pe)<t.EPSILON&&Math.abs(de-Be)<t.EPSILON&&Math.abs(le-ze)<t.EPSILON?c(y):(N=ue-Pe,Z=de-Be,K=le-ze,S=me*(K*=ie=1/Math.hypot(N,Z,K))-Ee*(Z*=ie),P=Ee*(N*=ie)-xe*K,O=xe*Z-me*N,(ie=Math.hypot(S,P,O))?(S*=ie=1/ie,P*=ie,O*=ie):(S=0,P=0,O=0),F=Z*O-K*P,j=K*S-N*O,G=N*P-Z*S,(ie=Math.hypot(F,j,G))?(F*=ie=1/ie,j*=ie,G*=ie):(F=0,j=0,G=0),y[0]=S,y[1]=F,y[2]=N,y[3]=0,y[4]=P,y[5]=j,y[6]=Z,y[7]=0,y[8]=O,y[9]=G,y[10]=K,y[11]=0,y[12]=-(S*ue+P*de+O*le),y[13]=-(F*ue+j*de+G*le),y[14]=-(N*ue+Z*de+K*le),y[15]=1,y)},be.targetTo=function(y,T,C,E){var S=T[0],P=T[1],O=T[2],F=E[0],j=E[1],G=E[2],N=S-C[0],Z=P-C[1],K=O-C[2],ie=N*N+Z*Z+K*K;ie>0&&(N*=ie=1/Math.sqrt(ie),Z*=ie,K*=ie);var ue=j*K-G*Z,de=G*N-F*K,le=F*Z-j*N;return(ie=ue*ue+de*de+le*le)>0&&(ue*=ie=1/Math.sqrt(ie),de*=ie,le*=ie),y[0]=ue,y[1]=de,y[2]=le,y[3]=0,y[4]=Z*le-K*de,y[5]=K*ue-N*le,y[6]=N*de-Z*ue,y[7]=0,y[8]=N,y[9]=Z,y[10]=K,y[11]=0,y[12]=S,y[13]=P,y[14]=O,y[15]=1,y},be.str=function(y){return"mat4("+y[0]+", "+y[1]+", "+y[2]+", "+y[3]+", "+y[4]+", "+y[5]+", "+y[6]+", "+y[7]+", "+y[8]+", "+y[9]+", "+y[10]+", "+y[11]+", "+y[12]+", "+y[13]+", "+y[14]+", "+y[15]+")"},be.frob=function(y){return Math.hypot(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15])},be.add=function(y,T,C){return y[0]=T[0]+C[0],y[1]=T[1]+C[1],y[2]=T[2]+C[2],y[3]=T[3]+C[3],y[4]=T[4]+C[4],y[5]=T[5]+C[5],y[6]=T[6]+C[6],y[7]=T[7]+C[7],y[8]=T[8]+C[8],y[9]=T[9]+C[9],y[10]=T[10]+C[10],y[11]=T[11]+C[11],y[12]=T[12]+C[12],y[13]=T[13]+C[13],y[14]=T[14]+C[14],y[15]=T[15]+C[15],y},be.subtract=R,be.multiplyScalar=function(y,T,C){return y[0]=T[0]*C,y[1]=T[1]*C,y[2]=T[2]*C,y[3]=T[3]*C,y[4]=T[4]*C,y[5]=T[5]*C,y[6]=T[6]*C,y[7]=T[7]*C,y[8]=T[8]*C,y[9]=T[9]*C,y[10]=T[10]*C,y[11]=T[11]*C,y[12]=T[12]*C,y[13]=T[13]*C,y[14]=T[14]*C,y[15]=T[15]*C,y},be.multiplyScalarAndAdd=function(y,T,C,E){return y[0]=T[0]+C[0]*E,y[1]=T[1]+C[1]*E,y[2]=T[2]+C[2]*E,y[3]=T[3]+C[3]*E,y[4]=T[4]+C[4]*E,y[5]=T[5]+C[5]*E,y[6]=T[6]+C[6]*E,y[7]=T[7]+C[7]*E,y[8]=T[8]+C[8]*E,y[9]=T[9]+C[9]*E,y[10]=T[10]+C[10]*E,y[11]=T[11]+C[11]*E,y[12]=T[12]+C[12]*E,y[13]=T[13]+C[13]*E,y[14]=T[14]+C[14]*E,y[15]=T[15]+C[15]*E,y},be.exactEquals=function(y,T){return y[0]===T[0]&&y[1]===T[1]&&y[2]===T[2]&&y[3]===T[3]&&y[4]===T[4]&&y[5]===T[5]&&y[6]===T[6]&&y[7]===T[7]&&y[8]===T[8]&&y[9]===T[9]&&y[10]===T[10]&&y[11]===T[11]&&y[12]===T[12]&&y[13]===T[13]&&y[14]===T[14]&&y[15]===T[15]},be.equals=function(y,T){var C=y[0],E=y[1],S=y[2],P=y[3],O=y[4],F=y[5],j=y[6],G=y[7],N=y[8],Z=y[9],K=y[10],ie=y[11],ue=y[12],de=y[13],le=y[14],xe=y[15],me=T[0],Ee=T[1],Pe=T[2],Be=T[3],ze=T[4],Ge=T[5],rt=T[6],Ze=T[7],ft=T[8],xt=T[9],lt=T[10],Yt=T[11],Vt=T[12],Mt=T[13],Et=T[14],yr=T[15];return Math.abs(C-me)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(me))&&Math.abs(E-Ee)<=t.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ee))&&Math.abs(S-Pe)<=t.EPSILON*Math.max(1,Math.abs(S),Math.abs(Pe))&&Math.abs(P-Be)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(Be))&&Math.abs(O-ze)<=t.EPSILON*Math.max(1,Math.abs(O),Math.abs(ze))&&Math.abs(F-Ge)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs(Ge))&&Math.abs(j-rt)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(rt))&&Math.abs(G-Ze)<=t.EPSILON*Math.max(1,Math.abs(G),Math.abs(Ze))&&Math.abs(N-ft)<=t.EPSILON*Math.max(1,Math.abs(N),Math.abs(ft))&&Math.abs(Z-xt)<=t.EPSILON*Math.max(1,Math.abs(Z),Math.abs(xt))&&Math.abs(K-lt)<=t.EPSILON*Math.max(1,Math.abs(K),Math.abs(lt))&&Math.abs(ie-Yt)<=t.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Yt))&&Math.abs(ue-Vt)<=t.EPSILON*Math.max(1,Math.abs(ue),Math.abs(Vt))&&Math.abs(de-Mt)<=t.EPSILON*Math.max(1,Math.abs(de),Math.abs(Mt))&&Math.abs(le-Et)<=t.EPSILON*Math.max(1,Math.abs(le),Math.abs(Et))&&Math.abs(xe-yr)<=t.EPSILON*Math.max(1,Math.abs(xe),Math.abs(yr))},be.sub=be.mul=be.ortho=be.perspective=void 0;var t=function(y,T){if(y&&y.__esModule)return y;if(y===null||l(y)!=="object"&&typeof y!="function")return{default:y};var C=o(void 0);if(C&&C.has(y))return C.get(y);var E={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var P in y)if(P!=="default"&&Object.prototype.hasOwnProperty.call(y,P)){var O=S?Object.getOwnPropertyDescriptor(y,P):null;O&&(O.get||O.set)?Object.defineProperty(E,P,O):E[P]=y[P]}return E.default=y,C&&C.set(y,E),E}(we());function o(y){if(typeof WeakMap!="function")return null;var T=new WeakMap,C=new WeakMap;return(o=function(E){return E?C:T})(y)}function c(y){return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y}function p(y,T,C){var E=T[0],S=T[1],P=T[2],O=T[3],F=T[4],j=T[5],G=T[6],N=T[7],Z=T[8],K=T[9],ie=T[10],ue=T[11],de=T[12],le=T[13],xe=T[14],me=T[15],Ee=C[0],Pe=C[1],Be=C[2],ze=C[3];return y[0]=Ee*E+Pe*F+Be*Z+ze*de,y[1]=Ee*S+Pe*j+Be*K+ze*le,y[2]=Ee*P+Pe*G+Be*ie+ze*xe,y[3]=Ee*O+Pe*N+Be*ue+ze*me,y[4]=(Ee=C[4])*E+(Pe=C[5])*F+(Be=C[6])*Z+(ze=C[7])*de,y[5]=Ee*S+Pe*j+Be*K+ze*le,y[6]=Ee*P+Pe*G+Be*ie+ze*xe,y[7]=Ee*O+Pe*N+Be*ue+ze*me,y[8]=(Ee=C[8])*E+(Pe=C[9])*F+(Be=C[10])*Z+(ze=C[11])*de,y[9]=Ee*S+Pe*j+Be*K+ze*le,y[10]=Ee*P+Pe*G+Be*ie+ze*xe,y[11]=Ee*O+Pe*N+Be*ue+ze*me,y[12]=(Ee=C[12])*E+(Pe=C[13])*F+(Be=C[14])*Z+(ze=C[15])*de,y[13]=Ee*S+Pe*j+Be*K+ze*le,y[14]=Ee*P+Pe*G+Be*ie+ze*xe,y[15]=Ee*O+Pe*N+Be*ue+ze*me,y}function h(y,T,C){var E=T[0],S=T[1],P=T[2],O=T[3],F=E+E,j=S+S,G=P+P,N=E*F,Z=E*j,K=E*G,ie=S*j,ue=S*G,de=P*G,le=O*F,xe=O*j,me=O*G;return y[0]=1-(ie+de),y[1]=Z+me,y[2]=K-xe,y[3]=0,y[4]=Z-me,y[5]=1-(N+de),y[6]=ue+le,y[7]=0,y[8]=K+xe,y[9]=ue-le,y[10]=1-(N+ie),y[11]=0,y[12]=C[0],y[13]=C[1],y[14]=C[2],y[15]=1,y}function m(y,T){var C=T[4],E=T[5],S=T[6],P=T[8],O=T[9],F=T[10];return y[0]=Math.hypot(T[0],T[1],T[2]),y[1]=Math.hypot(C,E,S),y[2]=Math.hypot(P,O,F),y}function x(y,T,C,E,S){var P,O=1/Math.tan(T/2);return y[0]=O/C,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=O,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,S!=null&&S!==1/0?(y[10]=(S+E)*(P=1/(E-S)),y[14]=2*S*E*P):(y[10]=-1,y[14]=-2*E),y}function A(y,T,C,E,S,P,O){var F=1/(T-C),j=1/(E-S),G=1/(P-O);return y[0]=-2*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=-2*j,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=2*G,y[11]=0,y[12]=(T+C)*F,y[13]=(S+E)*j,y[14]=(O+P)*G,y[15]=1,y}function R(y,T,C){return y[0]=T[0]-C[0],y[1]=T[1]-C[1],y[2]=T[2]-C[2],y[3]=T[3]-C[3],y[4]=T[4]-C[4],y[5]=T[5]-C[5],y[6]=T[6]-C[6],y[7]=T[7]-C[7],y[8]=T[8]-C[8],y[9]=T[9]-C[9],y[10]=T[10]-C[10],y[11]=T[11]-C[11],y[12]=T[12]-C[12],y[13]=T[13]-C[13],y[14]=T[14]-C[14],y[15]=T[15]-C[15],y}return be.perspective=x,be.ortho=A,be.mul=p,be.sub=R,be}var Je,Me={},je={};function Ve(){if(Je)return je;function l(S){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},l(S)}Je=1,Object.defineProperty(je,"__esModule",{value:!0}),je.create=c,je.clone=function(S){var P=new t.ARRAY_TYPE(3);return P[0]=S[0],P[1]=S[1],P[2]=S[2],P},je.length=p,je.fromValues=function(S,P,O){var F=new t.ARRAY_TYPE(3);return F[0]=S,F[1]=P,F[2]=O,F},je.copy=function(S,P){return S[0]=P[0],S[1]=P[1],S[2]=P[2],S},je.set=function(S,P,O,F){return S[0]=P,S[1]=O,S[2]=F,S},je.add=function(S,P,O){return S[0]=P[0]+O[0],S[1]=P[1]+O[1],S[2]=P[2]+O[2],S},je.subtract=h,je.multiply=m,je.divide=x,je.ceil=function(S,P){return S[0]=Math.ceil(P[0]),S[1]=Math.ceil(P[1]),S[2]=Math.ceil(P[2]),S},je.floor=function(S,P){return S[0]=Math.floor(P[0]),S[1]=Math.floor(P[1]),S[2]=Math.floor(P[2]),S},je.min=function(S,P,O){return S[0]=Math.min(P[0],O[0]),S[1]=Math.min(P[1],O[1]),S[2]=Math.min(P[2],O[2]),S},je.max=function(S,P,O){return S[0]=Math.max(P[0],O[0]),S[1]=Math.max(P[1],O[1]),S[2]=Math.max(P[2],O[2]),S},je.round=function(S,P){return S[0]=Math.round(P[0]),S[1]=Math.round(P[1]),S[2]=Math.round(P[2]),S},je.scale=function(S,P,O){return S[0]=P[0]*O,S[1]=P[1]*O,S[2]=P[2]*O,S},je.scaleAndAdd=function(S,P,O,F){return S[0]=P[0]+O[0]*F,S[1]=P[1]+O[1]*F,S[2]=P[2]+O[2]*F,S},je.distance=A,je.squaredDistance=R,je.squaredLength=y,je.negate=function(S,P){return S[0]=-P[0],S[1]=-P[1],S[2]=-P[2],S},je.inverse=function(S,P){return S[0]=1/P[0],S[1]=1/P[1],S[2]=1/P[2],S},je.normalize=function(S,P){var O=P[0],F=P[1],j=P[2],G=O*O+F*F+j*j;return G>0&&(G=1/Math.sqrt(G)),S[0]=P[0]*G,S[1]=P[1]*G,S[2]=P[2]*G,S},je.dot=T,je.cross=function(S,P,O){var F=P[0],j=P[1],G=P[2],N=O[0],Z=O[1],K=O[2];return S[0]=j*K-G*Z,S[1]=G*N-F*K,S[2]=F*Z-j*N,S},je.lerp=function(S,P,O,F){var j=P[0],G=P[1],N=P[2];return S[0]=j+F*(O[0]-j),S[1]=G+F*(O[1]-G),S[2]=N+F*(O[2]-N),S},je.hermite=function(S,P,O,F,j,G){var N=G*G,Z=N*(2*G-3)+1,K=N*(G-2)+G,ie=N*(G-1),ue=N*(3-2*G);return S[0]=P[0]*Z+O[0]*K+F[0]*ie+j[0]*ue,S[1]=P[1]*Z+O[1]*K+F[1]*ie+j[1]*ue,S[2]=P[2]*Z+O[2]*K+F[2]*ie+j[2]*ue,S},je.bezier=function(S,P,O,F,j,G){var N=1-G,Z=N*N,K=G*G,ie=Z*N,ue=3*G*Z,de=3*K*N,le=K*G;return S[0]=P[0]*ie+O[0]*ue+F[0]*de+j[0]*le,S[1]=P[1]*ie+O[1]*ue+F[1]*de+j[1]*le,S[2]=P[2]*ie+O[2]*ue+F[2]*de+j[2]*le,S},je.random=function(S,P){P=P||1;var O=2*t.RANDOM()*Math.PI,F=2*t.RANDOM()-1,j=Math.sqrt(1-F*F)*P;return S[0]=Math.cos(O)*j,S[1]=Math.sin(O)*j,S[2]=F*P,S},je.transformMat4=function(S,P,O){var F=P[0],j=P[1],G=P[2],N=O[3]*F+O[7]*j+O[11]*G+O[15];return S[0]=(O[0]*F+O[4]*j+O[8]*G+O[12])/(N=N||1),S[1]=(O[1]*F+O[5]*j+O[9]*G+O[13])/N,S[2]=(O[2]*F+O[6]*j+O[10]*G+O[14])/N,S},je.transformMat3=function(S,P,O){var F=P[0],j=P[1],G=P[2];return S[0]=F*O[0]+j*O[3]+G*O[6],S[1]=F*O[1]+j*O[4]+G*O[7],S[2]=F*O[2]+j*O[5]+G*O[8],S},je.transformQuat=function(S,P,O){var F=O[0],j=O[1],G=O[2],N=P[0],Z=P[1],K=P[2],ie=j*K-G*Z,ue=G*N-F*K,de=F*Z-j*N,le=j*de-G*ue,xe=G*ie-F*de,me=F*ue-j*ie,Ee=2*O[3];return ue*=Ee,de*=Ee,xe*=2,me*=2,S[0]=N+(ie*=Ee)+(le*=2),S[1]=Z+ue+xe,S[2]=K+de+me,S},je.rotateX=function(S,P,O,F){var j=[],G=[];return j[0]=P[0]-O[0],j[1]=P[1]-O[1],j[2]=P[2]-O[2],G[0]=j[0],G[1]=j[1]*Math.cos(F)-j[2]*Math.sin(F),G[2]=j[1]*Math.sin(F)+j[2]*Math.cos(F),S[0]=G[0]+O[0],S[1]=G[1]+O[1],S[2]=G[2]+O[2],S},je.rotateY=function(S,P,O,F){var j=[],G=[];return j[0]=P[0]-O[0],j[1]=P[1]-O[1],j[2]=P[2]-O[2],G[0]=j[2]*Math.sin(F)+j[0]*Math.cos(F),G[1]=j[1],G[2]=j[2]*Math.cos(F)-j[0]*Math.sin(F),S[0]=G[0]+O[0],S[1]=G[1]+O[1],S[2]=G[2]+O[2],S},je.rotateZ=function(S,P,O,F){var j=[],G=[];return j[0]=P[0]-O[0],j[1]=P[1]-O[1],j[2]=P[2]-O[2],G[0]=j[0]*Math.cos(F)-j[1]*Math.sin(F),G[1]=j[0]*Math.sin(F)+j[1]*Math.cos(F),G[2]=j[2],S[0]=G[0]+O[0],S[1]=G[1]+O[1],S[2]=G[2]+O[2],S},je.angle=function(S,P){var O=S[0],F=S[1],j=S[2],G=P[0],N=P[1],Z=P[2],K=Math.sqrt(O*O+F*F+j*j)*Math.sqrt(G*G+N*N+Z*Z),ie=K&&T(S,P)/K;return Math.acos(Math.min(Math.max(ie,-1),1))},je.zero=function(S){return S[0]=0,S[1]=0,S[2]=0,S},je.str=function(S){return"vec3("+S[0]+", "+S[1]+", "+S[2]+")"},je.exactEquals=function(S,P){return S[0]===P[0]&&S[1]===P[1]&&S[2]===P[2]},je.equals=function(S,P){var O=S[0],F=S[1],j=S[2],G=P[0],N=P[1],Z=P[2];return Math.abs(O-G)<=t.EPSILON*Math.max(1,Math.abs(O),Math.abs(G))&&Math.abs(F-N)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs(N))&&Math.abs(j-Z)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(Z))},je.forEach=je.sqrLen=je.len=je.sqrDist=je.dist=je.div=je.mul=je.sub=void 0;var t=function(S,P){if(S&&S.__esModule)return S;if(S===null||l(S)!=="object"&&typeof S!="function")return{default:S};var O=o(void 0);if(O&&O.has(S))return O.get(S);var F={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in S)if(G!=="default"&&Object.prototype.hasOwnProperty.call(S,G)){var N=j?Object.getOwnPropertyDescriptor(S,G):null;N&&(N.get||N.set)?Object.defineProperty(F,G,N):F[G]=S[G]}return F.default=S,O&&O.set(S,F),F}(we());function o(S){if(typeof WeakMap!="function")return null;var P=new WeakMap,O=new WeakMap;return(o=function(F){return F?O:P})(S)}function c(){var S=new t.ARRAY_TYPE(3);return t.ARRAY_TYPE!=Float32Array&&(S[0]=0,S[1]=0,S[2]=0),S}function p(S){return Math.hypot(S[0],S[1],S[2])}function h(S,P,O){return S[0]=P[0]-O[0],S[1]=P[1]-O[1],S[2]=P[2]-O[2],S}function m(S,P,O){return S[0]=P[0]*O[0],S[1]=P[1]*O[1],S[2]=P[2]*O[2],S}function x(S,P,O){return S[0]=P[0]/O[0],S[1]=P[1]/O[1],S[2]=P[2]/O[2],S}function A(S,P){return Math.hypot(P[0]-S[0],P[1]-S[1],P[2]-S[2])}function R(S,P){var O=P[0]-S[0],F=P[1]-S[1],j=P[2]-S[2];return O*O+F*F+j*j}function y(S){var P=S[0],O=S[1],F=S[2];return P*P+O*O+F*F}function T(S,P){return S[0]*P[0]+S[1]*P[1]+S[2]*P[2]}je.sub=h,je.mul=m,je.div=x,je.dist=A,je.sqrDist=R,je.len=p,je.sqrLen=y;var C,E=(C=c(),function(S,P,O,F,j,G){var N,Z;for(P||(P=3),O||(O=0),Z=F?Math.min(F*P+O,S.length):S.length,N=O;N<Z;N+=P)C[0]=S[N],C[1]=S[N+1],C[2]=S[N+2],j(C,C,G),S[N]=C[0],S[N+1]=C[1],S[N+2]=C[2];return S});return je.forEach=E,je}var An,jn,or={};function Cr(){if(An)return or;function l(E){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},l(E)}An=1,Object.defineProperty(or,"__esModule",{value:!0}),or.create=c,or.clone=function(E){var S=new t.ARRAY_TYPE(4);return S[0]=E[0],S[1]=E[1],S[2]=E[2],S[3]=E[3],S},or.fromValues=function(E,S,P,O){var F=new t.ARRAY_TYPE(4);return F[0]=E,F[1]=S,F[2]=P,F[3]=O,F},or.copy=function(E,S){return E[0]=S[0],E[1]=S[1],E[2]=S[2],E[3]=S[3],E},or.set=function(E,S,P,O,F){return E[0]=S,E[1]=P,E[2]=O,E[3]=F,E},or.add=function(E,S,P){return E[0]=S[0]+P[0],E[1]=S[1]+P[1],E[2]=S[2]+P[2],E[3]=S[3]+P[3],E},or.subtract=p,or.multiply=h,or.divide=m,or.ceil=function(E,S){return E[0]=Math.ceil(S[0]),E[1]=Math.ceil(S[1]),E[2]=Math.ceil(S[2]),E[3]=Math.ceil(S[3]),E},or.floor=function(E,S){return E[0]=Math.floor(S[0]),E[1]=Math.floor(S[1]),E[2]=Math.floor(S[2]),E[3]=Math.floor(S[3]),E},or.min=function(E,S,P){return E[0]=Math.min(S[0],P[0]),E[1]=Math.min(S[1],P[1]),E[2]=Math.min(S[2],P[2]),E[3]=Math.min(S[3],P[3]),E},or.max=function(E,S,P){return E[0]=Math.max(S[0],P[0]),E[1]=Math.max(S[1],P[1]),E[2]=Math.max(S[2],P[2]),E[3]=Math.max(S[3],P[3]),E},or.round=function(E,S){return E[0]=Math.round(S[0]),E[1]=Math.round(S[1]),E[2]=Math.round(S[2]),E[3]=Math.round(S[3]),E},or.scale=function(E,S,P){return E[0]=S[0]*P,E[1]=S[1]*P,E[2]=S[2]*P,E[3]=S[3]*P,E},or.scaleAndAdd=function(E,S,P,O){return E[0]=S[0]+P[0]*O,E[1]=S[1]+P[1]*O,E[2]=S[2]+P[2]*O,E[3]=S[3]+P[3]*O,E},or.distance=x,or.squaredDistance=A,or.length=R,or.squaredLength=y,or.negate=function(E,S){return E[0]=-S[0],E[1]=-S[1],E[2]=-S[2],E[3]=-S[3],E},or.inverse=function(E,S){return E[0]=1/S[0],E[1]=1/S[1],E[2]=1/S[2],E[3]=1/S[3],E},or.normalize=function(E,S){var P=S[0],O=S[1],F=S[2],j=S[3],G=P*P+O*O+F*F+j*j;return G>0&&(G=1/Math.sqrt(G)),E[0]=P*G,E[1]=O*G,E[2]=F*G,E[3]=j*G,E},or.dot=function(E,S){return E[0]*S[0]+E[1]*S[1]+E[2]*S[2]+E[3]*S[3]},or.cross=function(E,S,P,O){var F=P[0]*O[1]-P[1]*O[0],j=P[0]*O[2]-P[2]*O[0],G=P[0]*O[3]-P[3]*O[0],N=P[1]*O[2]-P[2]*O[1],Z=P[1]*O[3]-P[3]*O[1],K=P[2]*O[3]-P[3]*O[2],ie=S[0],ue=S[1],de=S[2],le=S[3];return E[0]=ue*K-de*Z+le*N,E[1]=-ie*K+de*G-le*j,E[2]=ie*Z-ue*G+le*F,E[3]=-ie*N+ue*j-de*F,E},or.lerp=function(E,S,P,O){var F=S[0],j=S[1],G=S[2],N=S[3];return E[0]=F+O*(P[0]-F),E[1]=j+O*(P[1]-j),E[2]=G+O*(P[2]-G),E[3]=N+O*(P[3]-N),E},or.random=function(E,S){var P,O,F,j,G,N;S=S||1;do G=(P=2*t.RANDOM()-1)*P+(O=2*t.RANDOM()-1)*O;while(G>=1);do N=(F=2*t.RANDOM()-1)*F+(j=2*t.RANDOM()-1)*j;while(N>=1);var Z=Math.sqrt((1-G)/N);return E[0]=S*P,E[1]=S*O,E[2]=S*F*Z,E[3]=S*j*Z,E},or.transformMat4=function(E,S,P){var O=S[0],F=S[1],j=S[2],G=S[3];return E[0]=P[0]*O+P[4]*F+P[8]*j+P[12]*G,E[1]=P[1]*O+P[5]*F+P[9]*j+P[13]*G,E[2]=P[2]*O+P[6]*F+P[10]*j+P[14]*G,E[3]=P[3]*O+P[7]*F+P[11]*j+P[15]*G,E},or.transformQuat=function(E,S,P){var O=S[0],F=S[1],j=S[2],G=P[0],N=P[1],Z=P[2],K=P[3],ie=K*O+N*j-Z*F,ue=K*F+Z*O-G*j,de=K*j+G*F-N*O,le=-G*O-N*F-Z*j;return E[0]=ie*K+le*-G+ue*-Z-de*-N,E[1]=ue*K+le*-N+de*-G-ie*-Z,E[2]=de*K+le*-Z+ie*-N-ue*-G,E[3]=S[3],E},or.zero=function(E){return E[0]=0,E[1]=0,E[2]=0,E[3]=0,E},or.str=function(E){return"vec4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+")"},or.exactEquals=function(E,S){return E[0]===S[0]&&E[1]===S[1]&&E[2]===S[2]&&E[3]===S[3]},or.equals=function(E,S){var P=E[0],O=E[1],F=E[2],j=E[3],G=S[0],N=S[1],Z=S[2],K=S[3];return Math.abs(P-G)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(G))&&Math.abs(O-N)<=t.EPSILON*Math.max(1,Math.abs(O),Math.abs(N))&&Math.abs(F-Z)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs(Z))&&Math.abs(j-K)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(K))},or.forEach=or.sqrLen=or.len=or.sqrDist=or.dist=or.div=or.mul=or.sub=void 0;var t=function(E,S){if(E&&E.__esModule)return E;if(E===null||l(E)!=="object"&&typeof E!="function")return{default:E};var P=o(void 0);if(P&&P.has(E))return P.get(E);var O={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in E)if(j!=="default"&&Object.prototype.hasOwnProperty.call(E,j)){var G=F?Object.getOwnPropertyDescriptor(E,j):null;G&&(G.get||G.set)?Object.defineProperty(O,j,G):O[j]=E[j]}return O.default=E,P&&P.set(E,O),O}(we());function o(E){if(typeof WeakMap!="function")return null;var S=new WeakMap,P=new WeakMap;return(o=function(O){return O?P:S})(E)}function c(){var E=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0,E[3]=0),E}function p(E,S,P){return E[0]=S[0]-P[0],E[1]=S[1]-P[1],E[2]=S[2]-P[2],E[3]=S[3]-P[3],E}function h(E,S,P){return E[0]=S[0]*P[0],E[1]=S[1]*P[1],E[2]=S[2]*P[2],E[3]=S[3]*P[3],E}function m(E,S,P){return E[0]=S[0]/P[0],E[1]=S[1]/P[1],E[2]=S[2]/P[2],E[3]=S[3]/P[3],E}function x(E,S){return Math.hypot(S[0]-E[0],S[1]-E[1],S[2]-E[2],S[3]-E[3])}function A(E,S){var P=S[0]-E[0],O=S[1]-E[1],F=S[2]-E[2],j=S[3]-E[3];return P*P+O*O+F*F+j*j}function R(E){return Math.hypot(E[0],E[1],E[2],E[3])}function y(E){var S=E[0],P=E[1],O=E[2],F=E[3];return S*S+P*P+O*O+F*F}or.sub=p,or.mul=h,or.div=m,or.dist=x,or.sqrDist=A,or.len=R,or.sqrLen=y;var T,C=(T=c(),function(E,S,P,O,F,j){var G,N;for(S||(S=4),P||(P=0),N=O?Math.min(O*S+P,E.length):E.length,G=P;G<N;G+=S)T[0]=E[G],T[1]=E[G+1],T[2]=E[G+2],T[3]=E[G+3],F(T,T,j),E[G]=T[0],E[G+1]=T[1],E[G+2]=T[2],E[G+3]=T[3];return E});return or.forEach=C,or}function Vr(){if(jn)return Me;function l(me){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ee){return typeof Ee}:function(Ee){return Ee&&typeof Symbol=="function"&&Ee.constructor===Symbol&&Ee!==Symbol.prototype?"symbol":typeof Ee},l(me)}jn=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.create=x,Me.identity=function(me){return me[0]=0,me[1]=0,me[2]=0,me[3]=1,me},Me.setAxisAngle=A,Me.getAxisAngle=function(me,Ee){var Pe=2*Math.acos(Ee[3]),Be=Math.sin(Pe/2);return Be>t.EPSILON?(me[0]=Ee[0]/Be,me[1]=Ee[1]/Be,me[2]=Ee[2]/Be):(me[0]=1,me[1]=0,me[2]=0),Pe},Me.getAngle=function(me,Ee){var Pe=P(me,Ee);return Math.acos(2*Pe*Pe-1)},Me.multiply=R,Me.rotateX=function(me,Ee,Pe){Pe*=.5;var Be=Ee[0],ze=Ee[1],Ge=Ee[2],rt=Ee[3],Ze=Math.sin(Pe),ft=Math.cos(Pe);return me[0]=Be*ft+rt*Ze,me[1]=ze*ft+Ge*Ze,me[2]=Ge*ft-ze*Ze,me[3]=rt*ft-Be*Ze,me},Me.rotateY=function(me,Ee,Pe){Pe*=.5;var Be=Ee[0],ze=Ee[1],Ge=Ee[2],rt=Ee[3],Ze=Math.sin(Pe),ft=Math.cos(Pe);return me[0]=Be*ft-Ge*Ze,me[1]=ze*ft+rt*Ze,me[2]=Ge*ft+Be*Ze,me[3]=rt*ft-ze*Ze,me},Me.rotateZ=function(me,Ee,Pe){Pe*=.5;var Be=Ee[0],ze=Ee[1],Ge=Ee[2],rt=Ee[3],Ze=Math.sin(Pe),ft=Math.cos(Pe);return me[0]=Be*ft+ze*Ze,me[1]=ze*ft-Be*Ze,me[2]=Ge*ft+rt*Ze,me[3]=rt*ft-Ge*Ze,me},Me.calculateW=function(me,Ee){var Pe=Ee[0],Be=Ee[1],ze=Ee[2];return me[0]=Pe,me[1]=Be,me[2]=ze,me[3]=Math.sqrt(Math.abs(1-Pe*Pe-Be*Be-ze*ze)),me},Me.exp=y,Me.ln=T,Me.pow=function(me,Ee,Pe){return T(me,Ee),S(me,me,Pe),y(me,me),me},Me.slerp=C,Me.random=function(me){var Ee=t.RANDOM(),Pe=t.RANDOM(),Be=t.RANDOM(),ze=Math.sqrt(1-Ee),Ge=Math.sqrt(Ee);return me[0]=ze*Math.sin(2*Math.PI*Pe),me[1]=ze*Math.cos(2*Math.PI*Pe),me[2]=Ge*Math.sin(2*Math.PI*Be),me[3]=Ge*Math.cos(2*Math.PI*Be),me},Me.invert=function(me,Ee){var Pe=Ee[0],Be=Ee[1],ze=Ee[2],Ge=Ee[3],rt=Pe*Pe+Be*Be+ze*ze+Ge*Ge,Ze=rt?1/rt:0;return me[0]=-Pe*Ze,me[1]=-Be*Ze,me[2]=-ze*Ze,me[3]=Ge*Ze,me},Me.conjugate=function(me,Ee){return me[0]=-Ee[0],me[1]=-Ee[1],me[2]=-Ee[2],me[3]=Ee[3],me},Me.fromMat3=E,Me.fromEuler=function(me,Ee,Pe,Be){var ze=.5*Math.PI/180;Ee*=ze,Pe*=ze,Be*=ze;var Ge=Math.sin(Ee),rt=Math.cos(Ee),Ze=Math.sin(Pe),ft=Math.cos(Pe),xt=Math.sin(Be),lt=Math.cos(Be);return me[0]=Ge*ft*lt-rt*Ze*xt,me[1]=rt*Ze*lt+Ge*ft*xt,me[2]=rt*ft*xt-Ge*Ze*lt,me[3]=rt*ft*lt+Ge*Ze*xt,me},Me.str=function(me){return"quat("+me[0]+", "+me[1]+", "+me[2]+", "+me[3]+")"},Me.setAxes=Me.sqlerp=Me.rotationTo=Me.equals=Me.exactEquals=Me.normalize=Me.sqrLen=Me.squaredLength=Me.len=Me.length=Me.lerp=Me.dot=Me.scale=Me.mul=Me.add=Me.set=Me.copy=Me.fromValues=Me.clone=void 0;var t=m(we()),o=m(qt()),c=m(Ve()),p=m(Cr());function h(me){if(typeof WeakMap!="function")return null;var Ee=new WeakMap,Pe=new WeakMap;return(h=function(Be){return Be?Pe:Ee})(me)}function m(me,Ee){if(me&&me.__esModule)return me;if(me===null||l(me)!=="object"&&typeof me!="function")return{default:me};var Pe=h(Ee);if(Pe&&Pe.has(me))return Pe.get(me);var Be={},ze=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ge in me)if(Ge!=="default"&&Object.prototype.hasOwnProperty.call(me,Ge)){var rt=ze?Object.getOwnPropertyDescriptor(me,Ge):null;rt&&(rt.get||rt.set)?Object.defineProperty(Be,Ge,rt):Be[Ge]=me[Ge]}return Be.default=me,Pe&&Pe.set(me,Be),Be}function x(){var me=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(me[0]=0,me[1]=0,me[2]=0),me[3]=1,me}function A(me,Ee,Pe){Pe*=.5;var Be=Math.sin(Pe);return me[0]=Be*Ee[0],me[1]=Be*Ee[1],me[2]=Be*Ee[2],me[3]=Math.cos(Pe),me}function R(me,Ee,Pe){var Be=Ee[0],ze=Ee[1],Ge=Ee[2],rt=Ee[3],Ze=Pe[0],ft=Pe[1],xt=Pe[2],lt=Pe[3];return me[0]=Be*lt+rt*Ze+ze*xt-Ge*ft,me[1]=ze*lt+rt*ft+Ge*Ze-Be*xt,me[2]=Ge*lt+rt*xt+Be*ft-ze*Ze,me[3]=rt*lt-Be*Ze-ze*ft-Ge*xt,me}function y(me,Ee){var Pe=Ee[0],Be=Ee[1],ze=Ee[2],Ge=Ee[3],rt=Math.sqrt(Pe*Pe+Be*Be+ze*ze),Ze=Math.exp(Ge),ft=rt>0?Ze*Math.sin(rt)/rt:0;return me[0]=Pe*ft,me[1]=Be*ft,me[2]=ze*ft,me[3]=Ze*Math.cos(rt),me}function T(me,Ee){var Pe=Ee[0],Be=Ee[1],ze=Ee[2],Ge=Ee[3],rt=Math.sqrt(Pe*Pe+Be*Be+ze*ze),Ze=rt>0?Math.atan2(rt,Ge)/rt:0;return me[0]=Pe*Ze,me[1]=Be*Ze,me[2]=ze*Ze,me[3]=.5*Math.log(Pe*Pe+Be*Be+ze*ze+Ge*Ge),me}function C(me,Ee,Pe,Be){var ze,Ge,rt,Ze,ft,xt=Ee[0],lt=Ee[1],Yt=Ee[2],Vt=Ee[3],Mt=Pe[0],Et=Pe[1],yr=Pe[2],Xt=Pe[3];return(Ge=xt*Mt+lt*Et+Yt*yr+Vt*Xt)<0&&(Ge=-Ge,Mt=-Mt,Et=-Et,yr=-yr,Xt=-Xt),1-Ge>t.EPSILON?(ze=Math.acos(Ge),rt=Math.sin(ze),Ze=Math.sin((1-Be)*ze)/rt,ft=Math.sin(Be*ze)/rt):(Ze=1-Be,ft=Be),me[0]=Ze*xt+ft*Mt,me[1]=Ze*lt+ft*Et,me[2]=Ze*Yt+ft*yr,me[3]=Ze*Vt+ft*Xt,me}function E(me,Ee){var Pe,Be=Ee[0]+Ee[4]+Ee[8];if(Be>0)Pe=Math.sqrt(Be+1),me[3]=.5*Pe,me[0]=(Ee[5]-Ee[7])*(Pe=.5/Pe),me[1]=(Ee[6]-Ee[2])*Pe,me[2]=(Ee[1]-Ee[3])*Pe;else{var ze=0;Ee[4]>Ee[0]&&(ze=1),Ee[8]>Ee[3*ze+ze]&&(ze=2);var Ge=(ze+1)%3,rt=(ze+2)%3;Pe=Math.sqrt(Ee[3*ze+ze]-Ee[3*Ge+Ge]-Ee[3*rt+rt]+1),me[ze]=.5*Pe,me[3]=(Ee[3*Ge+rt]-Ee[3*rt+Ge])*(Pe=.5/Pe),me[Ge]=(Ee[3*Ge+ze]+Ee[3*ze+Ge])*Pe,me[rt]=(Ee[3*rt+ze]+Ee[3*ze+rt])*Pe}return me}Me.clone=p.clone,Me.fromValues=p.fromValues,Me.copy=p.copy,Me.set=p.set,Me.add=p.add,Me.mul=R;var S=p.scale;Me.scale=S;var P=p.dot;Me.dot=P,Me.lerp=p.lerp;var O=p.length;Me.length=O,Me.len=O;var F=p.squaredLength;Me.squaredLength=F,Me.sqrLen=F;var j=p.normalize;Me.normalize=j,Me.exactEquals=p.exactEquals,Me.equals=p.equals;var G,N,Z,K=(G=c.create(),N=c.fromValues(1,0,0),Z=c.fromValues(0,1,0),function(me,Ee,Pe){var Be=c.dot(Ee,Pe);return Be<-.999999?(c.cross(G,N,Ee),c.len(G)<1e-6&&c.cross(G,Z,Ee),c.normalize(G,G),A(me,G,Math.PI),me):Be>.999999?(me[0]=0,me[1]=0,me[2]=0,me[3]=1,me):(c.cross(G,Ee,Pe),me[0]=G[0],me[1]=G[1],me[2]=G[2],me[3]=1+Be,j(me,me))});Me.rotationTo=K;var ie,ue,de=(ie=x(),ue=x(),function(me,Ee,Pe,Be,ze,Ge){return C(ie,Ee,ze,Ge),C(ue,Pe,Be,Ge),C(me,ie,ue,2*Ge*(1-Ge)),me});Me.sqlerp=de;var le,xe=(le=o.create(),function(me,Ee,Pe,Be){return le[0]=Pe[0],le[3]=Pe[1],le[6]=Pe[2],le[1]=Be[0],le[4]=Be[1],le[7]=Be[2],le[2]=-Ee[0],le[5]=-Ee[1],le[8]=-Ee[2],j(me,E(me,le))});return Me.setAxes=xe,Me}var On,dr={};function Zn(){if(On)return dr;function l(C){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},l(C)}On=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.create=function(){var C=new t.ARRAY_TYPE(8);return t.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0,C[4]=0,C[5]=0,C[6]=0,C[7]=0),C[3]=1,C},dr.clone=function(C){var E=new t.ARRAY_TYPE(8);return E[0]=C[0],E[1]=C[1],E[2]=C[2],E[3]=C[3],E[4]=C[4],E[5]=C[5],E[6]=C[6],E[7]=C[7],E},dr.fromValues=function(C,E,S,P,O,F,j,G){var N=new t.ARRAY_TYPE(8);return N[0]=C,N[1]=E,N[2]=S,N[3]=P,N[4]=O,N[5]=F,N[6]=j,N[7]=G,N},dr.fromRotationTranslationValues=function(C,E,S,P,O,F,j){var G=new t.ARRAY_TYPE(8);G[0]=C,G[1]=E,G[2]=S,G[3]=P;var N=.5*O,Z=.5*F,K=.5*j;return G[4]=N*P+Z*S-K*E,G[5]=Z*P+K*C-N*S,G[6]=K*P+N*E-Z*C,G[7]=-N*C-Z*E-K*S,G},dr.fromRotationTranslation=m,dr.fromTranslation=function(C,E){return C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=.5*E[0],C[5]=.5*E[1],C[6]=.5*E[2],C[7]=0,C},dr.fromRotation=function(C,E){return C[0]=E[0],C[1]=E[1],C[2]=E[2],C[3]=E[3],C[4]=0,C[5]=0,C[6]=0,C[7]=0,C},dr.fromMat4=function(C,E){var S=o.create();c.getRotation(S,E);var P=new t.ARRAY_TYPE(3);return c.getTranslation(P,E),m(C,S,P),C},dr.copy=x,dr.identity=function(C){return C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=0,C[5]=0,C[6]=0,C[7]=0,C},dr.set=function(C,E,S,P,O,F,j,G,N){return C[0]=E,C[1]=S,C[2]=P,C[3]=O,C[4]=F,C[5]=j,C[6]=G,C[7]=N,C},dr.getDual=function(C,E){return C[0]=E[4],C[1]=E[5],C[2]=E[6],C[3]=E[7],C},dr.setDual=function(C,E){return C[4]=E[0],C[5]=E[1],C[6]=E[2],C[7]=E[3],C},dr.getTranslation=function(C,E){var S=E[4],P=E[5],O=E[6],F=E[7],j=-E[0],G=-E[1],N=-E[2],Z=E[3];return C[0]=2*(S*Z+F*j+P*N-O*G),C[1]=2*(P*Z+F*G+O*j-S*N),C[2]=2*(O*Z+F*N+S*G-P*j),C},dr.translate=function(C,E,S){var P=E[0],O=E[1],F=E[2],j=E[3],G=.5*S[0],N=.5*S[1],Z=.5*S[2],K=E[4],ie=E[5],ue=E[6],de=E[7];return C[0]=P,C[1]=O,C[2]=F,C[3]=j,C[4]=j*G+O*Z-F*N+K,C[5]=j*N+F*G-P*Z+ie,C[6]=j*Z+P*N-O*G+ue,C[7]=-P*G-O*N-F*Z+de,C},dr.rotateX=function(C,E,S){var P=-E[0],O=-E[1],F=-E[2],j=E[3],G=E[4],N=E[5],Z=E[6],K=E[7],ie=G*j+K*P+N*F-Z*O,ue=N*j+K*O+Z*P-G*F,de=Z*j+K*F+G*O-N*P,le=K*j-G*P-N*O-Z*F;return o.rotateX(C,E,S),C[4]=ie*(j=C[3])+le*(P=C[0])+ue*(F=C[2])-de*(O=C[1]),C[5]=ue*j+le*O+de*P-ie*F,C[6]=de*j+le*F+ie*O-ue*P,C[7]=le*j-ie*P-ue*O-de*F,C},dr.rotateY=function(C,E,S){var P=-E[0],O=-E[1],F=-E[2],j=E[3],G=E[4],N=E[5],Z=E[6],K=E[7],ie=G*j+K*P+N*F-Z*O,ue=N*j+K*O+Z*P-G*F,de=Z*j+K*F+G*O-N*P,le=K*j-G*P-N*O-Z*F;return o.rotateY(C,E,S),C[4]=ie*(j=C[3])+le*(P=C[0])+ue*(F=C[2])-de*(O=C[1]),C[5]=ue*j+le*O+de*P-ie*F,C[6]=de*j+le*F+ie*O-ue*P,C[7]=le*j-ie*P-ue*O-de*F,C},dr.rotateZ=function(C,E,S){var P=-E[0],O=-E[1],F=-E[2],j=E[3],G=E[4],N=E[5],Z=E[6],K=E[7],ie=G*j+K*P+N*F-Z*O,ue=N*j+K*O+Z*P-G*F,de=Z*j+K*F+G*O-N*P,le=K*j-G*P-N*O-Z*F;return o.rotateZ(C,E,S),C[4]=ie*(j=C[3])+le*(P=C[0])+ue*(F=C[2])-de*(O=C[1]),C[5]=ue*j+le*O+de*P-ie*F,C[6]=de*j+le*F+ie*O-ue*P,C[7]=le*j-ie*P-ue*O-de*F,C},dr.rotateByQuatAppend=function(C,E,S){var P=S[0],O=S[1],F=S[2],j=S[3],G=E[0],N=E[1],Z=E[2],K=E[3];return C[0]=G*j+K*P+N*F-Z*O,C[1]=N*j+K*O+Z*P-G*F,C[2]=Z*j+K*F+G*O-N*P,C[3]=K*j-G*P-N*O-Z*F,C[4]=(G=E[4])*j+(K=E[7])*P+(N=E[5])*F-(Z=E[6])*O,C[5]=N*j+K*O+Z*P-G*F,C[6]=Z*j+K*F+G*O-N*P,C[7]=K*j-G*P-N*O-Z*F,C},dr.rotateByQuatPrepend=function(C,E,S){var P=E[0],O=E[1],F=E[2],j=E[3],G=S[0],N=S[1],Z=S[2],K=S[3];return C[0]=P*K+j*G+O*Z-F*N,C[1]=O*K+j*N+F*G-P*Z,C[2]=F*K+j*Z+P*N-O*G,C[3]=j*K-P*G-O*N-F*Z,C[4]=P*(K=S[7])+j*(G=S[4])+O*(Z=S[6])-F*(N=S[5]),C[5]=O*K+j*N+F*G-P*Z,C[6]=F*K+j*Z+P*N-O*G,C[7]=j*K-P*G-O*N-F*Z,C},dr.rotateAroundAxis=function(C,E,S,P){if(Math.abs(P)<t.EPSILON)return x(C,E);var O=Math.hypot(S[0],S[1],S[2]);P*=.5;var F=Math.sin(P),j=F*S[0]/O,G=F*S[1]/O,N=F*S[2]/O,Z=Math.cos(P),K=E[0],ie=E[1],ue=E[2],de=E[3];C[0]=K*Z+de*j+ie*N-ue*G,C[1]=ie*Z+de*G+ue*j-K*N,C[2]=ue*Z+de*N+K*G-ie*j,C[3]=de*Z-K*j-ie*G-ue*N;var le=E[4],xe=E[5],me=E[6],Ee=E[7];return C[4]=le*Z+Ee*j+xe*N-me*G,C[5]=xe*Z+Ee*G+me*j-le*N,C[6]=me*Z+Ee*N+le*G-xe*j,C[7]=Ee*Z-le*j-xe*G-me*N,C},dr.add=function(C,E,S){return C[0]=E[0]+S[0],C[1]=E[1]+S[1],C[2]=E[2]+S[2],C[3]=E[3]+S[3],C[4]=E[4]+S[4],C[5]=E[5]+S[5],C[6]=E[6]+S[6],C[7]=E[7]+S[7],C},dr.multiply=A,dr.scale=function(C,E,S){return C[0]=E[0]*S,C[1]=E[1]*S,C[2]=E[2]*S,C[3]=E[3]*S,C[4]=E[4]*S,C[5]=E[5]*S,C[6]=E[6]*S,C[7]=E[7]*S,C},dr.lerp=function(C,E,S,P){var O=1-P;return R(E,S)<0&&(P=-P),C[0]=E[0]*O+S[0]*P,C[1]=E[1]*O+S[1]*P,C[2]=E[2]*O+S[2]*P,C[3]=E[3]*O+S[3]*P,C[4]=E[4]*O+S[4]*P,C[5]=E[5]*O+S[5]*P,C[6]=E[6]*O+S[6]*P,C[7]=E[7]*O+S[7]*P,C},dr.invert=function(C,E){var S=T(E);return C[0]=-E[0]/S,C[1]=-E[1]/S,C[2]=-E[2]/S,C[3]=E[3]/S,C[4]=-E[4]/S,C[5]=-E[5]/S,C[6]=-E[6]/S,C[7]=E[7]/S,C},dr.conjugate=function(C,E){return C[0]=-E[0],C[1]=-E[1],C[2]=-E[2],C[3]=E[3],C[4]=-E[4],C[5]=-E[5],C[6]=-E[6],C[7]=E[7],C},dr.normalize=function(C,E){var S=T(E);if(S>0){S=Math.sqrt(S);var P=E[0]/S,O=E[1]/S,F=E[2]/S,j=E[3]/S,G=E[4],N=E[5],Z=E[6],K=E[7],ie=P*G+O*N+F*Z+j*K;C[0]=P,C[1]=O,C[2]=F,C[3]=j,C[4]=(G-P*ie)/S,C[5]=(N-O*ie)/S,C[6]=(Z-F*ie)/S,C[7]=(K-j*ie)/S}return C},dr.str=function(C){return"quat2("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+", "+C[6]+", "+C[7]+")"},dr.exactEquals=function(C,E){return C[0]===E[0]&&C[1]===E[1]&&C[2]===E[2]&&C[3]===E[3]&&C[4]===E[4]&&C[5]===E[5]&&C[6]===E[6]&&C[7]===E[7]},dr.equals=function(C,E){var S=C[0],P=C[1],O=C[2],F=C[3],j=C[4],G=C[5],N=C[6],Z=C[7],K=E[0],ie=E[1],ue=E[2],de=E[3],le=E[4],xe=E[5],me=E[6],Ee=E[7];return Math.abs(S-K)<=t.EPSILON*Math.max(1,Math.abs(S),Math.abs(K))&&Math.abs(P-ie)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(ie))&&Math.abs(O-ue)<=t.EPSILON*Math.max(1,Math.abs(O),Math.abs(ue))&&Math.abs(F-de)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs(de))&&Math.abs(j-le)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(le))&&Math.abs(G-xe)<=t.EPSILON*Math.max(1,Math.abs(G),Math.abs(xe))&&Math.abs(N-me)<=t.EPSILON*Math.max(1,Math.abs(N),Math.abs(me))&&Math.abs(Z-Ee)<=t.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ee))},dr.sqrLen=dr.squaredLength=dr.len=dr.length=dr.dot=dr.mul=dr.setReal=dr.getReal=void 0;var t=h(we()),o=h(Vr()),c=h(Fe());function p(C){if(typeof WeakMap!="function")return null;var E=new WeakMap,S=new WeakMap;return(p=function(P){return P?S:E})(C)}function h(C,E){if(C&&C.__esModule)return C;if(C===null||l(C)!=="object"&&typeof C!="function")return{default:C};var S=p(E);if(S&&S.has(C))return S.get(C);var P={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in C)if(F!=="default"&&Object.prototype.hasOwnProperty.call(C,F)){var j=O?Object.getOwnPropertyDescriptor(C,F):null;j&&(j.get||j.set)?Object.defineProperty(P,F,j):P[F]=C[F]}return P.default=C,S&&S.set(C,P),P}function m(C,E,S){var P=.5*S[0],O=.5*S[1],F=.5*S[2],j=E[0],G=E[1],N=E[2],Z=E[3];return C[0]=j,C[1]=G,C[2]=N,C[3]=Z,C[4]=P*Z+O*N-F*G,C[5]=O*Z+F*j-P*N,C[6]=F*Z+P*G-O*j,C[7]=-P*j-O*G-F*N,C}function x(C,E){return C[0]=E[0],C[1]=E[1],C[2]=E[2],C[3]=E[3],C[4]=E[4],C[5]=E[5],C[6]=E[6],C[7]=E[7],C}function A(C,E,S){var P=E[0],O=E[1],F=E[2],j=E[3],G=S[4],N=S[5],Z=S[6],K=S[7],ie=E[4],ue=E[5],de=E[6],le=E[7],xe=S[0],me=S[1],Ee=S[2],Pe=S[3];return C[0]=P*Pe+j*xe+O*Ee-F*me,C[1]=O*Pe+j*me+F*xe-P*Ee,C[2]=F*Pe+j*Ee+P*me-O*xe,C[3]=j*Pe-P*xe-O*me-F*Ee,C[4]=P*K+j*G+O*Z-F*N+ie*Pe+le*xe+ue*Ee-de*me,C[5]=O*K+j*N+F*G-P*Z+ue*Pe+le*me+de*xe-ie*Ee,C[6]=F*K+j*Z+P*N-O*G+de*Pe+le*Ee+ie*me-ue*xe,C[7]=j*K-P*G-O*N-F*Z+le*Pe-ie*xe-ue*me-de*Ee,C}dr.getReal=o.copy,dr.setReal=o.copy,dr.mul=A;var R=o.dot;dr.dot=R;var y=o.length;dr.length=y,dr.len=y;var T=o.squaredLength;return dr.squaredLength=T,dr.sqrLen=T,dr}var yn,kt,fr={};function li(){if(yn)return fr;function l(E){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},l(E)}yn=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.create=c,fr.clone=function(E){var S=new t.ARRAY_TYPE(2);return S[0]=E[0],S[1]=E[1],S},fr.fromValues=function(E,S){var P=new t.ARRAY_TYPE(2);return P[0]=E,P[1]=S,P},fr.copy=function(E,S){return E[0]=S[0],E[1]=S[1],E},fr.set=function(E,S,P){return E[0]=S,E[1]=P,E},fr.add=function(E,S,P){return E[0]=S[0]+P[0],E[1]=S[1]+P[1],E},fr.subtract=p,fr.multiply=h,fr.divide=m,fr.ceil=function(E,S){return E[0]=Math.ceil(S[0]),E[1]=Math.ceil(S[1]),E},fr.floor=function(E,S){return E[0]=Math.floor(S[0]),E[1]=Math.floor(S[1]),E},fr.min=function(E,S,P){return E[0]=Math.min(S[0],P[0]),E[1]=Math.min(S[1],P[1]),E},fr.max=function(E,S,P){return E[0]=Math.max(S[0],P[0]),E[1]=Math.max(S[1],P[1]),E},fr.round=function(E,S){return E[0]=Math.round(S[0]),E[1]=Math.round(S[1]),E},fr.scale=function(E,S,P){return E[0]=S[0]*P,E[1]=S[1]*P,E},fr.scaleAndAdd=function(E,S,P,O){return E[0]=S[0]+P[0]*O,E[1]=S[1]+P[1]*O,E},fr.distance=x,fr.squaredDistance=A,fr.length=R,fr.squaredLength=y,fr.negate=function(E,S){return E[0]=-S[0],E[1]=-S[1],E},fr.inverse=function(E,S){return E[0]=1/S[0],E[1]=1/S[1],E},fr.normalize=function(E,S){var P=S[0],O=S[1],F=P*P+O*O;return F>0&&(F=1/Math.sqrt(F)),E[0]=S[0]*F,E[1]=S[1]*F,E},fr.dot=function(E,S){return E[0]*S[0]+E[1]*S[1]},fr.cross=function(E,S,P){var O=S[0]*P[1]-S[1]*P[0];return E[0]=E[1]=0,E[2]=O,E},fr.lerp=function(E,S,P,O){var F=S[0],j=S[1];return E[0]=F+O*(P[0]-F),E[1]=j+O*(P[1]-j),E},fr.random=function(E,S){S=S||1;var P=2*t.RANDOM()*Math.PI;return E[0]=Math.cos(P)*S,E[1]=Math.sin(P)*S,E},fr.transformMat2=function(E,S,P){var O=S[0],F=S[1];return E[0]=P[0]*O+P[2]*F,E[1]=P[1]*O+P[3]*F,E},fr.transformMat2d=function(E,S,P){var O=S[0],F=S[1];return E[0]=P[0]*O+P[2]*F+P[4],E[1]=P[1]*O+P[3]*F+P[5],E},fr.transformMat3=function(E,S,P){var O=S[0],F=S[1];return E[0]=P[0]*O+P[3]*F+P[6],E[1]=P[1]*O+P[4]*F+P[7],E},fr.transformMat4=function(E,S,P){var O=S[0],F=S[1];return E[0]=P[0]*O+P[4]*F+P[12],E[1]=P[1]*O+P[5]*F+P[13],E},fr.rotate=function(E,S,P,O){var F=S[0]-P[0],j=S[1]-P[1],G=Math.sin(O),N=Math.cos(O);return E[0]=F*N-j*G+P[0],E[1]=F*G+j*N+P[1],E},fr.angle=function(E,S){var P=E[0],O=E[1],F=S[0],j=S[1],G=Math.sqrt(P*P+O*O)*Math.sqrt(F*F+j*j);return Math.acos(Math.min(Math.max(G&&(P*F+O*j)/G,-1),1))},fr.zero=function(E){return E[0]=0,E[1]=0,E},fr.str=function(E){return"vec2("+E[0]+", "+E[1]+")"},fr.exactEquals=function(E,S){return E[0]===S[0]&&E[1]===S[1]},fr.equals=function(E,S){var P=E[0],O=E[1],F=S[0],j=S[1];return Math.abs(P-F)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(F))&&Math.abs(O-j)<=t.EPSILON*Math.max(1,Math.abs(O),Math.abs(j))},fr.forEach=fr.sqrLen=fr.sqrDist=fr.dist=fr.div=fr.mul=fr.sub=fr.len=void 0;var t=function(E,S){if(E&&E.__esModule)return E;if(E===null||l(E)!=="object"&&typeof E!="function")return{default:E};var P=o(void 0);if(P&&P.has(E))return P.get(E);var O={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in E)if(j!=="default"&&Object.prototype.hasOwnProperty.call(E,j)){var G=F?Object.getOwnPropertyDescriptor(E,j):null;G&&(G.get||G.set)?Object.defineProperty(O,j,G):O[j]=E[j]}return O.default=E,P&&P.set(E,O),O}(we());function o(E){if(typeof WeakMap!="function")return null;var S=new WeakMap,P=new WeakMap;return(o=function(O){return O?P:S})(E)}function c(){var E=new t.ARRAY_TYPE(2);return t.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0),E}function p(E,S,P){return E[0]=S[0]-P[0],E[1]=S[1]-P[1],E}function h(E,S,P){return E[0]=S[0]*P[0],E[1]=S[1]*P[1],E}function m(E,S,P){return E[0]=S[0]/P[0],E[1]=S[1]/P[1],E}function x(E,S){return Math.hypot(S[0]-E[0],S[1]-E[1])}function A(E,S){var P=S[0]-E[0],O=S[1]-E[1];return P*P+O*O}function R(E){return Math.hypot(E[0],E[1])}function y(E){var S=E[0],P=E[1];return S*S+P*P}fr.len=R,fr.sub=p,fr.mul=h,fr.div=m,fr.dist=x,fr.sqrDist=A,fr.sqrLen=y;var T,C=(T=c(),function(E,S,P,O,F,j){var G,N;for(S||(S=2),P||(P=0),N=O?Math.min(O*S+P,E.length):E.length,G=P;G<N;G+=S)T[0]=E[G],T[1]=E[G+1],F(T,T,j),E[G]=T[0],E[G+1]=T[1];return E});return fr.forEach=C,fr}function Dn(){if(kt)return Q;function l(E){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},l(E)}kt=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.vec4=Q.vec3=Q.vec2=Q.quat2=Q.quat=Q.mat4=Q.mat3=Q.mat2d=Q.mat2=Q.glMatrix=void 0;var t=C(we());Q.glMatrix=t;var o=C(Ne());Q.mat2=o;var c=C(vt());Q.mat2d=c;var p=C(qt());Q.mat3=p;var h=C(Fe());Q.mat4=h;var m=C(Vr());Q.quat=m;var x=C(Zn());Q.quat2=x;var A=C(li());Q.vec2=A;var R=C(Ve());Q.vec3=R;var y=C(Cr());function T(E){if(typeof WeakMap!="function")return null;var S=new WeakMap,P=new WeakMap;return(T=function(O){return O?P:S})(E)}function C(E,S){if(E&&E.__esModule)return E;if(E===null||l(E)!=="object"&&typeof E!="function")return{default:E};var P=T(S);if(P&&P.has(E))return P.get(E);var O={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in E)if(j!=="default"&&Object.prototype.hasOwnProperty.call(E,j)){var G=F?Object.getOwnPropertyDescriptor(E,j):null;G&&(G.get||G.set)?Object.defineProperty(O,j,G):O[j]=E[j]}return O.default=E,P&&P.set(E,O),O}return Q.vec4=y,Q}var It,lr,sr,wr,_e=Dn(),un=function(){if(lr)return It;function l(t,o,c,p){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=o,this.p2x=c,this.p2y=p}return lr=1,It=l,l.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,o){if(o===void 0&&(o=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,p=0;p<8;p++){var h=this.sampleCurveX(c)-t;if(Math.abs(h)<o)return c;var m=this.sampleCurveDerivativeX(c);if(Math.abs(m)<1e-6)break;c-=h/m}var x=0,A=1;for(c=t,p=0;p<20&&(h=this.sampleCurveX(c),!(Math.abs(h-t)<o));p++)t>h?x=c:A=c,c=.5*(A-x)+x;return c},solve:function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))}},It}(),Le=$(un);function Ye(){if(wr)return sr;function l(t,o){this.x=t,this.y=o}return wr=1,sr=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,c=t.y-this.y;return o*o+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),c=Math.sin(t),p=c*this.x+o*this.y;return this.x=o*this.x-c*this.y,this.y=p,this},_rotateAround:function(t,o){var c=Math.cos(t),p=Math.sin(t),h=o.y+p*(this.x-o.x)+c*(this.y-o.y);return this.x=o.x+c*(this.x-o.x)-p*(this.y-o.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(t){return t instanceof l?t:Array.isArray(t)?new l(t[0],t[1]):t},sr}var De=$(Ye());function jt(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let o=0;o<l.length;o++)if(!jt(l[o],t[o]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(const o in l)if(!jt(l[o],t[o]))return!1;return!0}return l===t}const St=Math.PI/180,Zt=180/Math.PI;function Dt(l){return l*St}function Wt(l){return l*Zt}const nr=[[0,0],[1,0],[1,1],[0,1]];function Kt(l){if(l<=0)return 0;if(l>=1)return 1;const t=l*l,o=t*l;return 4*(l<.5?o:3*(l-t)+o-.75)}function mr(l,t,o,c){const p=new Le(l,t,o,c);return function(h){return p.solve(h)}}const Ar=mr(.25,.1,.25,1);function Ft(l,t,o){return Math.min(o,Math.max(t,l))}function Ir(l,t,o){return(o=Ft((o-l)/(t-l),0,1))*o*(3-2*o)}function Sr(l,t,o){const c=o-t,p=((l-t)%c+c)%c+t;return p===t?o:p}function tn(l,t,o){if(!l.length)return o(null,[]);let c=l.length;const p=new Array(l.length);let h=null;l.forEach((m,x)=>{t(m,(A,R)=>{A&&(h=A),p[x]=R,--c==0&&o(h,p)})})}function Xr(l,...t){for(const o of t)for(const c in o)l[c]=o[c];return l}let vn=1;function xi(){return vn++}function Ii(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function yo(l,t){l.forEach(o=>{t[o]&&(t[o]=t[o].bind(t))})}function eo(l,t){return l.indexOf(t,l.length-t.length)!==-1}function co(l,t,o){const c={};for(const p in l)c[p]=t.call(this,l[p],p,l);return c}function Mi(l,t,o){const c={};for(const p in l)t.call(this,l[p],p,l)&&(c[p]=l[p]);return c}function fi(l){return Array.isArray(l)?l.map(fi):typeof l=="object"&&l?co(l,fi):l}const ls={};function nn(l){ls[l]||(typeof console<"u"&&console.warn(l),ls[l]=!0)}function Vo(l,t,o){return(o.y-l.y)*(t.x-l.x)>(t.y-l.y)*(o.x-l.x)}function Fs(l){let t=0;for(let o,c,p=0,h=l.length,m=h-1;p<h;m=p++)o=l[p],c=l[m],t+=(c.x-o.x)*(o.y+c.y);return t}function to([l,t,o]){const c=Dt(t+90),p=Dt(o);return{x:l*Math.cos(c)*Math.sin(p),y:l*Math.sin(c)*Math.sin(p),z:l*Math.cos(p),azimuthal:t,polar:o}}function Co(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ro(l){const t={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,c,p,h)=>{const m=p||h;return t[c]=!m||m.toLowerCase(),""}),t["max-age"]){const o=parseInt(t["max-age"],10);isNaN(o)?delete t["max-age"]:t["max-age"]=o}return t}let Ns,Vs=null;function Us(l,t){return[l[4*t],l[4*t+1],l[4*t+2],l[4*t+3]]}function nt(l,t,o,c){for(;t<o;){const p=t+o>>1;l[p]<c?t=p+1:o=p}return t}function ne(l,t,o,c){for(;t<o;){const p=t+o>>1;l[p]<=c?t=p+1:o=p}return t}function oe(l){return l>0?1/(1.001-l):1+l}function ve(l){return l>0?1-1/(1.001-l):-l}const Ce={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Ns==null){const l=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ns=i.API_URL_REGEX!=null?new RegExp(i.API_URL_REGEX):l}catch{Ns=l}}return Ns},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ce.API_URL)return null;try{const l=new URL(Ce.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ie(l){return Ce.API_URL_REGEX.test(l)}function Ue(l){return Ce.API_SPRITE_REGEX.test(l)}let ot,We,it,ut,at,At;function Gt(){return ot==null&&(ot=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ot}const Ht={now:()=>ut!==void 0?ut:performance.now(),setNow(l){ut=l},restoreNow(){ut=void 0},frame(l){const t=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(l,t=0){const{width:o,height:c}=l;at||(at=document.createElement("canvas"));const p=at.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(o>at.width||c>at.height)&&(at.width=o,at.height=c),p.clearRect(-t,-t,o+2*t,c+2*t),p.drawImage(l,0,0,o,c),p.getImageData(-t,-t,o+2*t,c+2*t)},resolveURL:l=>(We||(We=document.createElement("a")),We.href=l,We.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(it==null&&(it=window.matchMedia("(prefers-reduced-motion: reduce)")),it.matches)},hasCanvasFingerprintNoise(){if(At!==void 0)return At;if(!Gt())return At=!1,!1;const l=new OffscreenCanvas(85,1),t=l.getContext("2d",{willReadFrequently:!0});let o=0;for(let p=0;p<l.width;++p)t.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,t.fillRect(p,0,1,1);const c=t.getImageData(0,0,l.width,l.height);o=0;for(let p=0;p<c.data.length;++p)if(p%4!=3&&o++!==c.data[p])return At=!0,!0;return At=!1,!1}};function vr(l,t){const o=l.indexOf("?");if(o<0)return`${l}?${new URLSearchParams(t).toString()}`;const c=new URLSearchParams(l.slice(o));for(const p in t)c.set(p,t[p]);return`${l.slice(0,o)}?${c.toString()}`}function Er(l,t={persistentParams:[]}){const o=l.indexOf("?");if(o<0)return l;const c=new URLSearchParams,p=new URLSearchParams(l.slice(o));for(const m of t.persistentParams){const x=p.get(m);x&&c.set(m,x)}const h=c.toString();return`${l.slice(0,o)}${h.length>0?`?${h}`:""}`}const Rr="mapbox-tiles";let br=500,on=50;const pn=["language","worldview","jobid"];let Or,mn;function Bn(){try{return caches}catch{}}function pi(){const l=Bn();l&&Or==null&&(Or=l.open(Rr))}let mi=1/0;const gi={supported:!1,testSupport:function(l){!Cs&&Uo&&(ko?js(l):ji=l)}};let ji,Uo,Cs=!1,ko=!1;const pa=typeof self<"u"?self:{};function js(l){const t=l.createTexture();l.bindTexture(l.TEXTURE_2D,t);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,Uo),l.isContextLost())return;gi.supported=!0}catch{}l.deleteTexture(t),Cs=!0}pa.document&&(Uo=pa.document.createElement("img"),Uo.onload=function(){ji&&js(ji),ji=null,ko=!0},Uo.onerror=function(){Cs=!0,ji=null},Uo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const $s={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze($s);class ol extends Error{constructor(t,o,c){o===401&&Ie(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=o,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ml=Co()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,La=function(l,t){if(!(/^file:/.test(o=l.url)||/^file:/.test(Ml())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,p){const h=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Ml(),referrerPolicy:c.referrerPolicy,signal:h.signal});let x=!1,A=!1;const R=(y=m.url).indexOf("sku=")>0&&Ie(y);var y;c.type==="json"&&m.headers.set("Accept","application/json");const T=(E,S,P)=>{if(A)return;if(E&&E.message!=="SecurityError"&&nn(E.toString()),S&&P)return C(S);const O=Date.now();fetch(m).then(F=>{if(F.ok){const j=R?F.clone():null;return C(F,j,O)}return p(new ol(F.statusText,F.status,c.url))}).catch(F=>{F.name!=="AbortError"&&p(new Error(`${F.message} ${c.url}`))})},C=(E,S,P)=>{(c.type==="arrayBuffer"?E.arrayBuffer():c.type==="json"?E.json():E.text()).then(O=>{A||(S&&P&&function(F,j,G){if(pi(),Or==null)return;const N=Ro(j.headers.get("Cache-Control")||"");if(N["no-store"])return;const Z={status:j.status,statusText:j.statusText,headers:new Headers};j.headers.forEach((ue,de)=>Z.headers.set(de,ue)),N["max-age"]&&Z.headers.set("Expires",new Date(G+1e3*N["max-age"]).toUTCString());const K=Z.headers.get("Expires");if(!K||new Date(K).getTime()-G<42e4)return;let ie=Er(F.url,{persistentParams:pn});if(j.status===206){const ue=F.headers.get("Range");if(!ue)return;Z.status=200,ie=vr(ie,{range:ue})}(function(ue,de){if(mn===void 0)try{new Response(new ReadableStream),mn=!0}catch{mn=!1}mn?de(ue.body):ue.blob().then(de)})(j,ue=>{const de=new Response((le=j.status)!==200&&le!==404&&[101,103,204,205,304].includes(le)?null:ue,Z);var le;pi(),Or!=null&&Or.then(xe=>xe.put(ie,de)).catch(xe=>nn(xe.message))})}(m,S,P),x=!0,p(null,O,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(O=>{A||p(new Error(O.message))})};return R?function(E,S){if(pi(),Or==null)return S(null);Or.then(P=>{let O=Er(E.url,{persistentParams:pn});const F=E.headers.get("Range");F&&(O=vr(O,{range:F})),P.match(O).then(j=>{const G=function(N){if(!N)return!1;const Z=new Date(N.headers.get("Expires")||0),K=Ro(N.headers.get("Cache-Control")||"");return Z>Date.now()&&!K["no-cache"]}(j);P.delete(O),G&&P.put(O,j.clone()),S(null,j,G)}).catch(S)}).catch(S)}(m,T):T(null,null),{cancel:()=>{A=!0,x||h.abort()}}}(l,t);if(Co()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,t,void 0,!0)}var o;return function(c,p){const h=new XMLHttpRequest;h.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const m in c.headers)h.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=c.credentials==="include",h.onerror=()=>{p(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let m=h.response;if(c.type==="json")try{m=JSON.parse(h.response)}catch(x){return p(x)}p(null,m,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else p(new ol(h.statusText,h.status,c.url))},h.send(c.body),{cancel:()=>h.abort()}}(l,t)},Oa=function(l,t){return La(Xr(l,{type:"arrayBuffer"}),t)};function Po(l){const t=document.createElement("a");return t.href=l,t.protocol===location.protocol&&t.host===location.host}const Mo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Do,ci;Do=[],ci=0;const Zi=function(l,t){if(gi.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),ci>=Ce.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:l,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Do.push(h),h}ci++;let o=!1;const c=()=>{if(!o)for(o=!0,ci--;Do.length&&ci<Ce.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Do.shift(),{requestParameters:m,callback:x,cancelled:A}=h;A||(h.cancel=Zi(m,x).cancel)}},p=Oa(l,(h,m,x,A)=>{c(),h?t(h):m&&(self.createImageBitmap?function(R,y){const T=new Blob([new Uint8Array(R)],{type:"image/png"});createImageBitmap(T).then(C=>{y(null,C)}).catch(C=>{y(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(R,y)=>t(R,y,x,A)):function(R,y){const T=new Image;T.onload=()=>{y(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=Mo})},T.onerror=()=>y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(R)],{type:"image/png"});T.src=R.byteLength?URL.createObjectURL(C):Mo}(m,(R,y)=>t(R,y,x,A)))});return{cancel:()=>{p.cancel(),c()}}};var uo,ma,Ba,jo={exports:{}},$n={exports:{}},qs={exports:{}},sl=function(){if(Ba)return jo.exports;Ba=1;var l=(uo||(uo=1,$n.exports=function(o,c){var p,h,m,x,A,R,y,T;for(h=o.length-(p=3&o.length),m=c,A=3432918353,R=461845907,T=0;T<h;)y=255&o.charCodeAt(T)|(255&o.charCodeAt(++T))<<8|(255&o.charCodeAt(++T))<<16|(255&o.charCodeAt(++T))<<24,++T,m=27492+(65535&(x=5*(65535&(m=(m^=y=(65535&(y=(y=(65535&y)*A+(((y>>>16)*A&65535)<<16)&4294967295)<<15|y>>>17))*R+(((y>>>16)*R&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(y=0,p){case 3:y^=(255&o.charCodeAt(T+2))<<16;case 2:y^=(255&o.charCodeAt(T+1))<<8;case 1:m^=y=(65535&(y=(y=(65535&(y^=255&o.charCodeAt(T)))*A+(((y>>>16)*A&65535)<<16)&4294967295)<<15|y>>>17))*R+(((y>>>16)*R&65535)<<16)&4294967295}return m^=o.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),$n.exports),t=(ma||(ma=1,qs.exports=function(o,c){for(var p,h=o.length,m=c^h,x=0;h>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(x)|(255&o.charCodeAt(++x))<<8|(255&o.charCodeAt(++x))<<16|(255&o.charCodeAt(++x))<<24))+((1540483477*(p>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),h-=4,++x;switch(h){case 3:m^=(255&o.charCodeAt(x+2))<<16;case 2:m^=(255&o.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&o.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),qs.exports);return jo.exports=l,jo.exports.murmur3=l,jo.exports.murmur2=t,jo.exports}(),$i=$(sl);class Rs{constructor(t,...o){Xr(this,o[0]||{}),this.type=t}}class za extends Rs{constructor(t,o={}){super("error",Xr({error:t},o))}}function Fa(l,t,o){o[l]&&o[l].indexOf(t)!==-1||(o[l]=o[l]||[],o[l].push(t))}function Dl(l,t,o){if(o&&o[l]){const c=o[l].indexOf(t);c!==-1&&o[l].splice(c,1)}}class ga{on(t,o){return this._listeners=this._listeners||{},Fa(t,o,this._listeners),this}off(t,o){return Dl(t,o,this._listeners),Dl(t,o,this._oneTimeListeners),this}once(t,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Fa(t,o,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,o){const c=typeof t=="string"?new Rs(t,o):t,p=c.type;if(this.listens(p)){c.target=this;const h=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const A of h)A.call(this,c);const m=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const A of m)Dl(p,A,this._oneTimeListeners),A.call(this,c);const x=this._eventedParent;x&&(Xr(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(c))}else c instanceof za&&console.error(c.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,o){return this._eventedParent=t,this._eventedParentData=o,this}}var Ll,Gr={},$o=function(){if(Ll)return Gr;Ll=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(h){return(h=Math.round(h))<0?0:h>255?255:h}function o(h){return t(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function c(h){return(m=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:m>1?1:m;var m}function p(h,m,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?h+(m-h)*x*6:2*x<1?m:3*x<2?h+(m-h)*(2/3-x)*6:h}try{Gr.parseCSSColor=function(h){var m,x=h.replace(/ /g,"").toLowerCase();if(x in l)return l[x].slice();if(x[0]==="#")return x.length===4?(m=parseInt(x.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:x.length===7&&(m=parseInt(x.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var A=x.indexOf("("),R=x.indexOf(")");if(A!==-1&&R+1===x.length){var y=x.substr(0,A),T=x.substr(A+1,R-(A+1)).split(","),C=1;switch(y){case"rgba":if(T.length!==4)return null;C=c(T.pop());case"rgb":return T.length!==3?null:[o(T[0]),o(T[1]),o(T[2]),C];case"hsla":if(T.length!==4)return null;C=c(T.pop());case"hsl":if(T.length!==3)return null;var E=(parseFloat(T[0])%360+360)%360/360,S=c(T[1]),P=c(T[2]),O=P<=.5?P*(S+1):P+S-P*S,F=2*P-O;return[t(255*p(F,O,E+1/3)),t(255*p(F,O,E)),t(255*p(F,O,E-1/3)),C];default:return null}}return null}}catch{}return Gr}();class an{constructor(t,o,c,p=1){this.r=t,this.g=o,this.b=c,this.a=p}static parse(t){if(!t)return;if(t instanceof an)return t;if(typeof t!="string")return;const o=$o.parseCSSColor(t);return o?new an(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[t,o,c,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(t)},${Math.round(o)},${Math.round(c)},${p})`}toRenderColor(t){const{r:o,g:c,b:p,a:h}=this;return new vo(t,o,c,p,h)}}class vo{constructor(t,o,c,p,h){if(t){const m=t.image.height,x=m*m;o=h===0?0:o/h*(m-1),c=h===0?0:c/h*(m-1),p=h===0?0:p/h*(m-1);const A=Math.floor(o),R=Math.floor(c),y=Math.floor(p),T=Math.ceil(o),C=Math.ceil(c),E=Math.ceil(p),S=o-A,P=c-R,O=p-y,F=t.image.data,j=4*(A+R*x+y*m),G=4*(A+R*x+E*m),N=4*(A+C*x+y*m),Z=4*(A+C*x+E*m),K=4*(T+R*x+y*m),ie=4*(T+R*x+E*m),ue=4*(T+C*x+y*m),de=4*(T+C*x+E*m);if(j<0||de>=F.length)throw new Error("out of range");this.r=xr(xr(xr(F[j],F[G],O),xr(F[N],F[Z],O),P),xr(xr(F[K],F[ie],O),xr(F[ue],F[de],O),P),S)/255*h,this.g=xr(xr(xr(F[j+1],F[G+1],O),xr(F[N+1],F[Z+1],O),P),xr(xr(F[K+1],F[ie+1],O),xr(F[ue+1],F[de+1],O),P),S)/255*h,this.b=xr(xr(xr(F[j+2],F[G+2],O),xr(F[N+2],F[Z+2],O),P),xr(xr(F[K+2],F[ie+2],O),xr(F[ue+2],F[de+2],O),P),S)/255*h,this.a=h}else this.r=o,this.g=c,this.b=p,this.a=h}toArray(){const{r:t,g:o,b:c,a:p}=this;return p===0?[0,0,0,0]:[255*t/p,255*o/p,255*c/p,p]}toArray01(){const{r:t,g:o,b:c,a:p}=this;return p===0?[0,0,0,0]:[t/p,o/p,c/p,p]}toArray01Scaled(t){const{r:o,g:c,b:p,a:h}=this;return h===0?[0,0,0]:[o/h*t,c/h*t,p/h*t]}toArray01PremultipliedAlpha(){const{r:t,g:o,b:c,a:p}=this;return[t,o,c,p]}toArray01Linear(){const{r:t,g:o,b:c,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(t/p,2.2),Math.pow(o/p,2.2),Math.pow(c/p,2.2),p]}}function xr(l,t,o){return l*(1-o)+t*o}function cs(l,t,o){return l.map((c,p)=>xr(c,t[p],o))}an.black=new an(0,0,0,1),an.white=new an(1,1,1,1),an.transparent=new an(0,0,0,0),an.red=new an(1,0,0,1),an.blue=new an(0,0,1,1);var Gs=Object.freeze({__proto__:null,array:cs,color:function(l,t,o){return new an(xr(l.r,t.r,o),xr(l.g,t.g,o),xr(l.b,t.b,o),xr(l.a,t.a,o))},number:xr});function _a(l,...t){for(const o of t)for(const c in o)l[c]=o[c];return l}class us extends Error{constructor(t,o){super(o),this.message=o,this.key=t}}class qo{constructor(t,o=[]){this.parent=t,this.bindings={};for(const[c,p]of o)this.bindings[c]=p}concat(t){return new qo(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Go={kind:"null"},er={kind:"number"},Wr={kind:"string"},Kr={kind:"boolean"},ro={kind:"color"},Ai={kind:"object"},Hr={kind:"value"},al={kind:"collator"},Hs={kind:"formatted"},Pn={kind:"resolvedImage"};function _i(l,t){return{kind:"array",itemType:l,N:t}}function ei(l){if(l.kind==="array"){const t=ei(l.itemType);return typeof l.N=="number"?`array<${t}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${t}>`}return l.kind}const dc=[Go,er,Wr,Kr,ro,Hs,Ai,_i(Hr),Pn];function Ws(l,t){if(t.kind==="error")return null;if(l.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Ws(l.itemType,t.itemType))&&(typeof l.N!="number"||l.N===t.N))return null}else{if(l.kind===t.kind)return null;if(l.kind==="value"){for(const o of dc)if(!Ws(o,t))return null}}return`Expected ${ei(l)} but found ${ei(t)} instead.`}function Zs(l,t){return t.some(o=>o.kind===l.kind)}function ho(l,t){return t.some(o=>o==="null"?l===null:o==="array"?Array.isArray(l):o==="object"?l&&!Array.isArray(l)&&typeof l=="object":o===typeof l)}class Na{constructor(t,o,c){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,o){return this.collator.compare(t,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Si{constructor(t,o,c,p,h){this.text=t.normalize?t.normalize():t,this.image=o,this.scale=c,this.fontStack=p,this.textColor=h}}class Xi{constructor(t){this.sections=t}static fromString(t){return new Xi([new Si(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof Xi?t:Xi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const o of this.sections){if(o.image){t.push(["image",o.image.namePrimary]);continue}t.push(o.text);const c={};o.fontStack&&(c["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(c["font-scale"]=o.scale),o.textColor&&(c["text-color"]=["rgba"].concat(o.textColor.toRenderColor(null).toArray())),t.push(c)}return t}}class io{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,o){return t?new io({namePrimary:t,nameSecondary:o,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function ya(l,t,o,c){return typeof l=="number"&&l>=0&&l<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[l,t,o,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[l,t,o,c]:[l,t,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function hs(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof an||l instanceof Na||l instanceof Xi||l instanceof io)return!0;if(Array.isArray(l)){for(const t of l)if(!hs(t))return!1;return!0}if(typeof l=="object"){for(const t in l)if(!hs(l[t]))return!1;return!0}return!1}function ii(l){if(l===null)return Go;if(typeof l=="string")return Wr;if(typeof l=="boolean")return Kr;if(typeof l=="number")return er;if(l instanceof an)return ro;if(l instanceof Na)return al;if(l instanceof Xi)return Hs;if(l instanceof io)return Pn;if(Array.isArray(l)){const t=l.length;let o;for(const c of l){const p=ii(c);if(o){if(o===p)continue;o=Hr;break}o=p}return _i(o||Hr,t)}return Ai}function qi(l){const t=typeof l;return l===null?"":t==="string"||t==="number"||t==="boolean"?String(l):l instanceof an||l instanceof Xi||l instanceof io?l.toString():JSON.stringify(l)}class Lo{constructor(t,o){this.type=t,this.value=o}static parse(t,o){if(t.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!hs(t[1]))return o.error("invalid value");const c=t[1];let p=ii(c);const h=o.expectedType;return p.kind!=="array"||p.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(p=h),new Lo(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof an?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Xi?this.value.serialize():this.value}}class yi{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const fc={string:Wr,number:er,boolean:Kr,object:Ai};class Di{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");let c,p=1;const h=t[0];if(h==="array"){let x,A;if(t.length>2){const R=t[1];if(typeof R!="string"||!(R in fc)||R==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);x=fc[R],p++}else x=Hr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);A=t[2],p++}c=_i(x,A)}else c=fc[h];const m=[];for(;p<t.length;p++){const x=o.parse(t[p],p,Hr);if(!x)return null;m.push(x)}return new Di(c,m)}evaluate(t){for(let o=0;o<this.args.length;o++){const c=this.args[o].evaluate(t);if(!Ws(this.type,ii(c)))return c;if(o===this.args.length-1)throw new yi(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${ei(ii(c))} but was expected to be of type ${ei(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,o=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){o.push(c.kind);const p=t.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(c=>c.serialize()))}}class Ho{constructor(t){this.type=Hs,this.sections=t}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return o.error("First argument must be an image or text section.");const p=[];let h=!1;for(let m=1;m<=t.length-1;++m){const x=t[m];if(h&&typeof x=="object"&&!Array.isArray(x)){h=!1;let A=null;if(x["font-scale"]&&(A=o.parseObjectValue(x["font-scale"],m,"font-scale",er),!A))return null;let R=null;if(x["text-font"]&&(R=o.parseObjectValue(x["text-font"],m,"text-font",_i(Wr)),!R))return null;let y=null;if(x["text-color"]&&(y=o.parseObjectValue(x["text-color"],m,"text-color",ro),!y))return null;const T=p[p.length-1];T.scale=A,T.font=R,T.textColor=y}else{const A=o.parse(t[m],m,Hr);if(!A)return null;const R=A.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,p.push({content:A,scale:null,font:null,textColor:null})}}return new Ho(p)}evaluate(t){return new Xi(this.sections.map(o=>{const c=o.content.evaluate(t);return ii(c)===Pn?new Si("",c,null,null,null):new Si(qi(c),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))}eachChild(t){for(const o of this.sections)t(o.content),o.scale&&t(o.scale),o.font&&t(o.font),o.textColor&&t(o.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const o of this.sections){t.push(o.content.serialize());const c={};o.scale&&(c["font-scale"]=o.scale.serialize()),o.font&&(c["text-font"]=o.font.serialize()),o.textColor&&(c["text-color"]=o.textColor.serialize()),t.push(c)}return t}}class Xs{constructor(t,o){this.type=Pn,this.inputPrimary=t,this.inputSecondary=o}static parse(t,o){if(t.length<2)return o.error("Expected two or more arguments.");const c=o.parse(t[1],1,Wr);if(!c)return o.error("No image name provided.");if(t.length===2)return new Xs(c);const p=o.parse(t[2],1,Wr);return p?new Xs(c,p):o.error("Secondary image variant is not a string.")}evaluate(t){const o=io.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(o.namePrimary)>-1,o.nameSecondary&&o.available&&t.availableImages&&(o.available=t.availableImages.indexOf(o.nameSecondary)>-1)),o}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ks(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}const Va={"to-boolean":Kr,"to-color":ro,"to-number":er,"to-string":Wr};class Wo{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const c=t[0],p=[];let h=Go;if(c==="to-array"){if(!Array.isArray(t[1]))return null;const m=t[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);h=_i(o.expectedType.itemType,m)}else{if(!(m>0&&hs(t[1][0])))return null;h=_i(ii(t[1][0]),m)}for(let x=0;x<m;x++){const A=t[1][x];let R;if(Ks(A)==="array")R=o.parse(A,void 0,h.itemType);else{const y=Ks(A);if(y!==h.itemType.kind)return o.error(`Expected ${h.itemType.kind} but found ${y}.`);R=o.registry.literal.parse(["literal",A===void 0?null:A],o)}if(!R)return null;p.push(R)}}else{if((c==="to-boolean"||c==="to-string")&&t.length!==2)return o.error("Expected one argument.");h=Va[c];for(let m=1;m<t.length;m++){const x=o.parse(t[m],m,Hr);if(!x)return null;p.push(x)}}return new Wo(h,p)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let o,c;for(const p of this.args){if(o=p.evaluate(t),c=null,o instanceof an)return o;if(typeof o=="string"){const h=t.parseColor(o);if(h)return h}else if(Array.isArray(o)&&(c=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:ya(o[0],o[1],o[2],o[3]),!c))return new an(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new yi(c||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const c of this.args){if(o=c.evaluate(t),o===null)return 0;const p=Number(o);if(!isNaN(p))return p}throw new yi(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?Xi.fromString(qi(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?io.fromString(qi(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(o=>o.evaluate(t)):qi(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ho([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Xs(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{t.push(o.serialize())}),t}}const Kc=["Unknown","Point","LineString","Polygon"];class ll{constructor(t,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Kc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:c,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*o-t[0])+this.featureDistanceData.bearing[1]*(p*o-t[1])}return 0}parseColor(t){let o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=an.parse(t)),o}getConfig(t){return this.options?this.options.get(t):null}}class oo{constructor(t,o,c,p,h){this.name=t,this.type=o,this._evaluate=c,this.args=p,this._overloadIndex=h}evaluate(t){if(!this._evaluate){const o=oo.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,o){const c=t[0],p=oo.definitions[c];if(!p)return o.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(p)?p[0]:p.type,m=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,x=[];let A=null,R=-1;for(const[y,T]of m){if(Array.isArray(y)&&y.length!==t.length-1)continue;x.push(y),R++,A=new Bo(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const C=[];let E=!1;for(let S=1;S<t.length;S++){const P=t[S],O=Array.isArray(y)?y[S-1]:y.type,F=A.parse(P,1+C.length,O);if(!F){E=!0;break}C.push(F)}if(!E)if(Array.isArray(y)&&y.length!==C.length)A.error(`Expected ${y.length} arguments, but found ${C.length} instead.`);else{for(let S=0;S<C.length;S++){const P=Array.isArray(y)?y[S]:y.type,O=C[S];A.concat(S+1).checkSubtype(P,O.type)}if(A.errors.length===0)return new oo(c,h,T,C,R)}}if(x.length===1)o.errors.push(...A.errors);else{const y=(x.length?x:m.map(([C])=>C)).map(Yc).join(" | "),T=[];for(let C=1;C<t.length;C++){const E=o.parse(t[C],1+T.length);if(!E)return null;T.push(ei(E.type))}o.error(`Expected arguments of type ${y}, but found (${T.join(", ")}) instead.`)}return null}static register(t,o){oo.definitions=o;for(const c in o)t[c]=oo}}function Yc(l){return Array.isArray(l)?`(${l.map(ei).join(", ")})`:`(${ei(l.type)}...)`}class Oo{constructor(t,o,c){this.type=al,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=o}static parse(t,o){if(t.length!==2)return o.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return o.error("Collator options argument must be an object.");const p=c["case-sensitive"]===void 0?o.parse(!1,1,Kr):o.parseObjectValue(c["case-sensitive"],1,"case-sensitive",Kr);if(!p)return null;const h=c["diacritic-sensitive"]===void 0?o.parse(!1,1,Kr):o.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",Kr);if(!h)return null;let m=null;return c.locale&&(m=o.parseObjectValue(c.locale,1,"locale",Wr),!m)?null:new Oo(p,h,m)}evaluate(t){return new Na(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Ua(l,t,o=0,c=l.length-1,p=Js){for(;c>o;){if(c-o>600){const A=c-o+1,R=t-o+1,y=Math.log(A),T=.5*Math.exp(2*y/3),C=.5*Math.sqrt(y*T*(A-T)/A)*(R-A/2<0?-1:1);Ua(l,t,Math.max(o,Math.floor(t-R*T/A+C)),Math.min(c,Math.floor(t+(A-R)*T/A+C)),p)}const h=l[t];let m=o,x=c;for(Ys(l,o,t),p(l[c],h)>0&&Ys(l,o,c);m<x;){for(Ys(l,m,x),m++,x--;p(l[m],h)<0;)m++;for(;p(l[x],h)>0;)x--}p(l[o],h)===0?Ys(l,o,x):(x++,Ys(l,x,c)),x<=t&&(o=x+1),t<=x&&(c=x-1)}}function Ys(l,t,o){const c=l[t];l[t]=l[o],l[o]=c}function Js(l,t){return l<t?-1:l>t?1:0}function ja(l){let t=0;for(let o,c,p=0,h=l.length,m=h-1;p<h;m=p++)o=l[p],c=l[m],t+=(c.x-o.x)*(o.y+c.y);return t}function ds(l,t){l[0]=Math.min(l[0],t[0]),l[1]=Math.min(l[1],t[1]),l[2]=Math.max(l[2],t[0]),l[3]=Math.max(l[3],t[1])}function zi(l,t){return!(l[0]<=t[0]||l[2]>=t[2]||l[1]<=t[1]||l[3]>=t[3])}function Jc(l,t,o){const c=l[0]-t[0],p=l[1]-t[1],h=l[0]-o[0],m=l[1]-o[1];return c*m-h*p==0&&c*h<=0&&p*m<=0}function va(l,t,o=!1){let c=!1;for(let x=0,A=t.length;x<A;x++){const R=t[x];for(let y=0,T=R.length,C=T-1;y<T;C=y++){const E=R[C],S=R[y];if(Jc(l,E,S))return o;(h=E)[1]>(p=l)[1]!=(m=S)[1]>p[1]&&p[0]<(m[0]-h[0])*(p[1]-h[1])/(m[1]-h[1])+h[0]&&(c=!c)}}var p,h,m;return c}function bo(l,t,o,c){const p=c[0]-o[0],h=c[1]-o[1],m=(l[0]-o[0])*h-p*(l[1]-o[1]),x=(t[0]-o[0])*h-p*(t[1]-o[1]);return m>0&&x<0||m<0&&x>0}function D(l,t,o,c){return(p=[c[0]-o[0],c[1]-o[1]])[0]*(h=[t[0]-l[0],t[1]-l[1]])[1]-p[1]*h[0]!=0&&!(!bo(l,t,o,c)||!bo(o,c,l,t));var p,h}const X=8192;function te(l,t){const o=(180+l[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(o*p*X),Math.round(c*p*X)]}function fe(l,t){for(let o=0;o<t.length;o++)if(va(l,t[o]))return!0;return!1}function _t(l,t,o){for(const c of o)for(let p=0,h=c.length,m=h-1;p<h;m=p++)if(D(l,t,c[m],c[p]))return!0;return!1}function st(l,t){for(let o=0;o<l.length;++o)if(!va(l[o],t))return!1;for(let o=0;o<l.length-1;++o)if(_t(l[o],l[o+1],t))return!1;return!0}function ur(l,t){for(let o=0;o<t.length;o++)if(st(l,t[o]))return!0;return!1}function Tn(l,t,o){const c=[];for(let p=0;p<l.length;p++){const h=[];for(let m=0;m<l[p].length;m++){const x=te(l[p][m],o);ds(t,x),h.push(x)}c.push(h)}return c}function cr(l,t,o){const c=[];for(let p=0;p<l.length;p++){const h=Tn(l[p],t,o);c.push(h)}return c}function Sn(l,t,o,c){if(l[0]<o[0]||l[0]>o[2]){const p=.5*c;let h=l[0]-o[0]>p?-c:o[0]-l[0]>p?c:0;h===0&&(h=l[0]-o[2]>p?-c:o[2]-l[0]>p?c:0),l[0]+=h}ds(t,l)}function Fi(l,t,o,c){const p=Math.pow(2,c.z)*X,h=[c.x*X,c.y*X],m=[];if(!l)return m;for(const x of l)for(const A of x){const R=[A.x+h[0],A.y+h[1]];Sn(R,t,o,p),m.push(R)}return m}function Gi(l,t,o,c){const p=Math.pow(2,c.z)*X,h=[c.x*X,c.y*X],m=[];if(!l)return m;for(const A of l){const R=[];for(const y of A){const T=[y.x+h[0],y.y+h[1]];ds(t,T),R.push(T)}m.push(R)}if(t[2]-t[0]<=p/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const A of m)for(const R of A)Sn(R,t,o,p)}var x;return m}class xo{constructor(t,o){this.type=Kr,this.geojson=t,this.geometries=o}static parse(t,o){if(t.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(hs(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let p=0;p<c.features.length;++p){const h=c.features[p].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new xo(c,c.features[p].geometry)}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new xo(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new xo(c,c)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,c){const p=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const x=Tn(c.coordinates,h,m),A=Fi(o.geometry(),p,h,m);if(!zi(p,h))return!1;for(const R of A)if(!va(R,x))return!1}if(c.type==="MultiPolygon"){const x=cr(c.coordinates,h,m),A=Fi(o.geometry(),p,h,m);if(!zi(p,h))return!1;for(const R of A)if(!fe(R,x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,c){const p=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const x=Tn(c.coordinates,h,m),A=Gi(o.geometry(),p,h,m);if(!zi(p,h))return!1;for(const R of A)if(!st(R,x))return!1}if(c.type==="MultiPolygon"){const x=cr(c.coordinates,h,m),A=Gi(o.geometry(),p,h,m);if(!zi(p,h))return!1;for(const R of A)if(!ur(R,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ci={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ti=1/298.257223563,$a=ti*(2-ti),Ol=Math.PI/180;class Bl{static fromTile(t,o,c){const p=Math.PI*(1-2*(t+.5)/Math.pow(2,o)),h=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Ol;return new Bl(h,c)}static get units(){return Ci}constructor(t,o){if(t===void 0)throw new Error("No latitude given.");if(o&&!Ci[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(Ci).join(", ")}`);const c=6378.137*Ol*(o?Ci[o]:1),p=Math.cos(t*Ol),h=1/(1-$a*(1-p*p)),m=Math.sqrt(h);this.kx=c*m*p,this.ky=c*m*h*(1-$a)}distance(t,o){const c=oi(t[0]-o[0])*this.kx,p=(t[1]-o[1])*this.ky;return Math.sqrt(c*c+p*p)}bearing(t,o){const c=oi(o[0]-t[0])*this.kx;return Math.atan2(c,(o[1]-t[1])*this.ky)/Ol}destination(t,o,c){const p=c*Ol;return this.offset(t,Math.sin(p)*o,Math.cos(p)*o)}offset(t,o,c){return[t[0]+o/this.kx,t[1]+c/this.ky]}lineDistance(t){let o=0;for(let c=0;c<t.length-1;c++)o+=this.distance(t[c],t[c+1]);return o}area(t){let o=0;for(let c=0;c<t.length;c++){const p=t[c];for(let h=0,m=p.length,x=m-1;h<m;x=h++)o+=oi(p[h][0]-p[x][0])*(p[h][1]+p[x][1])*(c?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(t,o){let c=0;if(o<=0)return t[0];for(let p=0;p<t.length-1;p++){const h=t[p],m=t[p+1],x=this.distance(h,m);if(c+=x,c>o)return ba(h,m,(o-(c-x))/x)}return t[t.length-1]}pointToSegmentDistance(t,o,c){let[p,h]=o,m=oi(c[0]-p)*this.kx,x=(c[1]-h)*this.ky;if(m!==0||x!==0){const A=(oi(t[0]-p)*this.kx*m+(t[1]-h)*this.ky*x)/(m*m+x*x);A>1?(p=c[0],h=c[1]):A>0&&(p+=m/this.kx*A,h+=x/this.ky*A)}return m=oi(t[0]-p)*this.kx,x=(t[1]-h)*this.ky,Math.sqrt(m*m+x*x)}pointOnLine(t,o){let c=1/0,p=t[0][0],h=t[0][1],m=0,x=0;for(let A=0;A<t.length-1;A++){let R=t[A][0],y=t[A][1],T=oi(t[A+1][0]-R)*this.kx,C=(t[A+1][1]-y)*this.ky,E=0;T===0&&C===0||(E=(oi(o[0]-R)*this.kx*T+(o[1]-y)*this.ky*C)/(T*T+C*C),E>1?(R=t[A+1][0],y=t[A+1][1]):E>0&&(R+=T/this.kx*E,y+=C/this.ky*E)),T=oi(o[0]-R)*this.kx,C=(o[1]-y)*this.ky;const S=T*T+C*C;S<c&&(c=S,p=R,h=y,m=A,x=E)}return{point:[p,h],index:m,t:Math.max(0,Math.min(1,x))}}lineSlice(t,o,c){let p=this.pointOnLine(c,t),h=this.pointOnLine(c,o);if(p.index>h.index||p.index===h.index&&p.t>h.t){const R=p;p=h,h=R}const m=[p.point],x=p.index+1,A=h.index;!Qc(c[x],m[0])&&x<=A&&m.push(c[x]);for(let R=x+1;R<=A;R++)m.push(c[R]);return Qc(c[A],h.point)||m.push(h.point),m}lineSliceAlong(t,o,c){let p=0;const h=[];for(let m=0;m<c.length-1;m++){const x=c[m],A=c[m+1],R=this.distance(x,A);if(p+=R,p>t&&h.length===0&&h.push(ba(x,A,(t-(p-R))/R)),p>=o)return h.push(ba(x,A,(o-(p-R))/R)),h;p>t&&h.push(A)}return h}bufferPoint(t,o){const c=o/this.ky,p=o/this.kx;return[t[0]-p,t[1]-c,t[0]+p,t[1]+c]}bufferBBox(t,o){const c=o/this.ky,p=o/this.kx;return[t[0]-p,t[1]-c,t[2]+p,t[3]+c]}insideBBox(t,o){return oi(t[0]-o[0])>=0&&oi(t[0]-o[2])<=0&&t[1]>=o[1]&&t[1]<=o[3]}}function Qc(l,t){return l[0]===t[0]&&l[1]===t[1]}function ba(l,t,o){const c=oi(t[0]-l[0]);return[l[0]+c*o,l[1]+(t[1]-l[1])*o]}function oi(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class ch{constructor(t=[],o=(c,p)=>c<p?-1:c>p?1:0){if(this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:o,compare:c}=this,p=o[t];for(;t>0;){const h=t-1>>1,m=o[h];if(c(p,m)>=0)break;o[t]=m,t=h}o[t]=p}_down(t){const{data:o,compare:c}=this,p=this.length>>1,h=o[t];for(;t<p;){let m=1+(t<<1);const x=m+1;if(x<this.length&&c(o[x],o[m])<0&&(m=x),c(o[m],h)>=0)break;o[t]=o[m],t=m}o[t]=h}}var Ut=8192;function uh(l,t){return t.dist-l.dist}const zl=100,pc=50;function Fl(l){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==l.length)return!1;for(let o=0;o<t.length;o++)if(t[o]!==l[o])return!1;return!0}function mc(l){return l[1]-l[0]+1}function wo(l,t){const o=l[1]>=l[0]&&l[1]<t;return o||console.warn("Distance Expression: Index is out of range"),o}function eu(l,t){if(l[0]>l[1])return[null,null];const o=mc(l);if(t){if(o===2)return[l,null];const c=Math.floor(o/2);return[[l[0],l[0]+c],[l[0]+c,l[1]]]}{if(o===1)return[l,null];const c=Math.floor(o/2)-1;return[[l[0],l[0]+c],[l[0]+c+1,l[1]]]}}function To(l,t){const o=[1/0,1/0,-1/0,-1/0];if(!wo(t,l.length))return o;for(let c=t[0];c<=t[1];++c)ds(o,l[c]);return o}function gc(l){const t=[1/0,1/0,-1/0,-1/0];for(let o=0;o<l.length;++o)for(let c=0;c<l[o].length;++c)ds(t,l[o][c]);return t}function qa(l,t,o){if(Fl(l)||Fl(t))return NaN;let c=0,p=0;return l[2]<t[0]&&(c=t[0]-l[2]),l[0]>t[2]&&(c=l[0]-t[2]),l[1]>t[3]&&(p=l[1]-t[3]),l[3]<t[1]&&(p=t[1]-l[3]),o.distance([0,0],[c,p])}function hh(l){return 360*l-180}function tu(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Zo(l,t){const o=Math.pow(2,t.z),c=(l.y/Ut+t.y)/o;return[hh((l.x/Ut+t.x)/o),tu(c)]}function Ga(l,t){const o=[];for(let c=0;c<l.length;++c)o.push(Zo(l[c],t));return o}function Qs(l,t,o){const c=o.pointOnLine(t,l).point;return o.distance(l,c)}function dh(l,t,o,c,p){const h=o.slice(c[0],c[1]+1);let m=1/0;for(let x=t[0];x<=t[1];++x)if((m=Math.min(m,Qs(l[x],h,p)))===0)return 0;return m}function ru(l,t,o,c,p){const h=Math.min(p.pointToSegmentDistance(l,o,c),p.pointToSegmentDistance(t,o,c)),m=Math.min(p.pointToSegmentDistance(o,l,t),p.pointToSegmentDistance(c,l,t));return Math.min(h,m)}function gd(l,t,o,c,p){if(!wo(t,l.length)||!wo(c,o.length))return NaN;let h=1/0;for(let m=t[0];m<t[1];++m)for(let x=c[0];x<c[1];++x){if(D(l[m],l[m+1],o[x],o[x+1]))return 0;h=Math.min(h,ru(l[m],l[m+1],o[x],o[x+1],p))}return h}function _d(l,t,o,c,p){if(!wo(t,l.length)||!wo(c,o.length))return NaN;let h=1/0;for(let m=t[0];m<=t[1];++m)for(let x=c[0];x<=c[1];++x)if((h=Math.min(h,p.distance(l[m],o[x])))===0)return h;return h}function yd(l,t,o){if(va(l,t,!0))return 0;let c=1/0;for(const p of t){const h=p.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[h-1]&&(c=Math.min(c,o.pointToSegmentDistance(l,p[h-1],p[0])))===0||(c=Math.min(c,Qs(l,p,o)))===0)return c}return c}function vd(l,t,o,c){if(!wo(t,l.length))return NaN;for(let h=t[0];h<=t[1];++h)if(va(l[h],o,!0))return 0;let p=1/0;for(let h=t[0];h<t[1];++h)for(const m of o)for(let x=0,A=m.length,R=A-1;x<A;R=x++){if(D(l[h],l[h+1],m[R],m[x]))return 0;p=Math.min(p,ru(l[h],l[h+1],m[R],m[x],c))}return p}function fh(l,t){for(const o of l)for(let c=0;c<=o.length-1;++c)if(va(o[c],t,!0))return!0;return!1}function bd(l,t,o,c=1/0){const p=gc(l),h=gc(t);if(c!==1/0&&qa(p,h,o)>=c)return c;if(zi(p,h)){if(fh(l,t))return 0}else if(fh(t,l))return 0;let m=c;for(const x of l)for(let A=0,R=x.length,y=R-1;A<R;y=A++)for(const T of t)for(let C=0,E=T.length,S=E-1;C<E;S=C++){if(D(x[y],x[A],T[S],T[C]))return 0;m=Math.min(m,ru(x[y],x[A],T[S],T[C],o))}return m}function Nl(l,t,o,c,p,h,m){if(h===null||m===null)return;const x=qa(To(c,h),To(p,m),o);x<t&&l.push({dist:x,range1:h,range2:m})}function cl(l,t,o,c,p=1/0){let h=Math.min(c.distance(l[0],o[0][0]),p);if(h===0)return h;const m=new ch([{dist:0,range1:[0,l.length-1],range2:[0,0]}],uh),x=t?pc:zl,A=gc(o);for(;m.length;){const R=m.pop();if(R.dist>=h)continue;const y=R.range1;if(mc(y)<=x){if(!wo(y,l.length))return NaN;if(t){const T=vd(l,y,o,c);if((h=Math.min(h,T))===0)return h}else for(let T=y[0];T<=y[1];++T){const C=yd(l[T],o,c);if((h=Math.min(h,C))===0)return h}}else{const T=eu(y,t);if(T[0]!==null){const C=qa(To(l,T[0]),A,c);C<h&&m.push({dist:C,range1:T[0],range2:[0,0]})}if(T[1]!==null){const C=qa(To(l,T[1]),A,c);C<h&&m.push({dist:C,range1:T[1],range2:[0,0]})}}}return h}function Ha(l,t,o,c,p,h=1/0){let m=Math.min(h,p.distance(l[0],o[0]));if(m===0)return m;const x=new ch([{dist:0,range1:[0,l.length-1],range2:[0,o.length-1]}],uh),A=t?pc:zl,R=c?pc:zl;for(;x.length;){const y=x.pop();if(y.dist>=m)continue;const T=y.range1,C=y.range2;if(mc(T)<=A&&mc(C)<=R){if(!wo(T,l.length)||!wo(C,o.length))return NaN;if(t&&c?m=Math.min(m,gd(l,T,o,C,p)):t||c?t&&!c?m=Math.min(m,dh(o,C,l,T,p)):!t&&c&&(m=Math.min(m,dh(l,T,o,C,p))):m=Math.min(m,_d(l,T,o,C,p)),m===0)return m}else{const E=eu(T,t),S=eu(C,c);Nl(x,m,p,l,o,E[0],S[0]),Nl(x,m,p,l,o,E[0],S[1]),Nl(x,m,p,l,o,E[1],S[0]),Nl(x,m,p,l,o,E[1],S[1])}}return m}function Vl(l,t,o,c,p=1/0){let h=p;const m=To(l,[0,l.length-1]);for(const x of o)if(!(h!==1/0&&qa(m,To(x,[0,x.length-1]),c)>=h)&&(h=Math.min(h,Ha(l,t,x,!0,c,h)),h===0))return h;return h}function _c(l,t,o,c,p=1/0){let h=p;const m=To(l,[0,l.length-1]);for(const x of o){if(h!==1/0&&qa(m,gc(x),c)>=h)continue;const A=cl(l,t,x,c,h);if(isNaN(A))return A;if((h=Math.min(h,A))===0)return h}return h}function Wa(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class et{constructor(t,o){this.type=er,this.geojson=t,this.geometries=o}static parse(t,o){if(t.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(hs(t[1])){const c=t[1];if(c.type==="FeatureCollection"){for(let p=0;p<c.features.length;++p)if(Wa(c.features[p].geometry.type))return new et(c,c.features[p].geometry)}else if(c.type==="Feature"){if(Wa(c.geometry.type))return new et(c,c.geometry)}else if(Wa(c.type))return new et(c,c)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const o=t.geometry(),c=t.canonicalID();if(o!=null&&c!=null){if(t.geometryType()==="Point")return function(p,h,m){const x=[];for(const R of p)for(const y of R)x.push(Zo(y,h));const A=new Bl(x[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Ha(x,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",A):m.type==="MultiLineString"?Vl(x,!1,m.coordinates,A):m.type==="Polygon"||m.type==="MultiPolygon"?_c(x,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,A):null}(o,c,this.geometries);if(t.geometryType()==="LineString")return function(p,h,m){const x=[];for(const R of p){const y=[];for(const T of R)y.push(Zo(T,h));x.push(y)}const A=new Bl(x[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Vl(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,A);if(m.type==="MultiLineString"){let R=1/0;for(let y=0;y<m.coordinates.length;y++){const T=Vl(m.coordinates[y],!0,x,A,R);if(isNaN(T))return T;if((R=Math.min(R,T))===0)return R}return R}if(m.type==="Polygon"||m.type==="MultiPolygon"){let R=1/0;for(let y=0;y<x.length;y++){const T=_c(x[y],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,A,R);if(isNaN(T))return T;if((R=Math.min(R,T))===0)return R}return R}return null}(o,c,this.geometries);if(t.geometryType()==="Polygon")return function(p,h,m){const x=[];for(const R of function(y,T){const C=y.length;if(C<=1)return[y];const E=[];let S,P;for(let O=0;O<C;O++){const F=ja(y[O]);F!==0&&(y[O].area=Math.abs(F),P===void 0&&(P=F<0),P===F<0?(S&&E.push(S),S=[y[O]]):S.push(y[O]))}return S&&E.push(S),E}(p)){const y=[];for(let T=0;T<R.length;++T)y.push(Ga(R[T],h));x.push(y)}const A=new Bl(x[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return _c(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,A);if(m.type==="MultiLineString"){let R=1/0;for(let y=0;y<m.coordinates.length;y++){const T=_c(m.coordinates[y],!0,x,A,R);if(isNaN(T))return T;if((R=Math.min(R,T))===0)return R}return R}return m.type==="Polygon"||m.type==="MultiPolygon"?function(R,y,T){let C=1/0;for(const E of R)for(const S of y){const P=bd(E,S,T,C);if(isNaN(P))return P;if((C=Math.min(C,P))===0)return C}return C}(m.type==="Polygon"?[m.coordinates]:m.coordinates,x,A):null}(o,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function H(l,t){switch(l){case"string":return qi(t);case"number":return+t;case"boolean":return!!t;case"color":return an.parse(t);case"formatted":return Xi.fromString(qi(t));case"resolvedImage":return io.fromString(qi(t))}return t}function se(l,t,o,c){return c!==void 0&&(l=c*Math.round(l/c)),t!==void 0&&l<t&&(l=t),o!==void 0&&l>o&&(l=o),l}class Qe{constructor(t,o,c){this.type=t,this.key=o,this.scope=c}static parse(t,o){let c=o.expectedType;if(c==null&&(c=Hr),t.length<2||t.length>3)return o.error("Invalid number of arguments for 'config' expression.");const p=o.parse(t[1],1);if(!(p instanceof Lo))return o.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const h=o.parse(t[2],2);return h instanceof Lo?new Qe(c,qi(p.value),qi(h.value)):o.error("Scope of 'config' expression must be a string literal.")}return new Qe(c,qi(p.value))}evaluate(t){const o=[this.key,this.scope,t.scope].filter(Boolean).join(""),c=t.getConfig(o);if(!c)return null;const{type:p,value:h,values:m,minValue:x,maxValue:A,stepValue:R}=c,y=c.default.evaluate(t);let T=y;if(h){const C=t.scope;t.scope=(C||"").split("").slice(1).join(""),T=h.evaluate(t),t.scope=C}return p&&(T=H(p,T)),T===void 0||x===void 0&&A===void 0&&R===void 0||(typeof T=="number"?T=se(T,x,A,R):Array.isArray(T)&&(T=T.map(C=>typeof C=="number"?se(C,x,A,R):C))),h!==void 0&&T!==void 0&&m&&!m.includes(T)&&(T=y,p&&(T=H(p,T))),(p&&p!==this.type||T!==void 0&&ii(T)!==this.type)&&(T=H(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function $t(l){if(l instanceof oo&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof xo||l instanceof et)return!1;let t=!0;return l.eachChild(o=>{t&&!$t(o)&&(t=!1)}),t}function gr(l){if(l instanceof oo&&l.name==="feature-state")return!1;let t=!0;return l.eachChild(o=>{t&&!gr(o)&&(t=!1)}),t}function Pr(l){if(l instanceof Qe)return new Set([l.key]);let t=new Set;return l.eachChild(o=>{t=new Set([...t,...Pr(o)])}),t}function bn(l,t){if(l instanceof oo&&t.indexOf(l.name)>=0)return!1;let o=!0;return l.eachChild(c=>{o&&!bn(c,t)&&(o=!1)}),o}class Nr{constructor(t,o){this.type=o.type,this.name=t,this.boundExpression=o}static parse(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const c=t[1];return o.scope.has(c)?new Nr(c,o.scope.get(c)):o.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class fo{constructor(t,o=[],c,p=new qo,h=[],m,x){this.registry=t,this.path=o,this.key=o.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=p,this.errors=h,this.expectedType=c,this._scope=m,this.options=x}parse(t,o,c,p,h={}){return o||c?this.concat(o,null,c,p)._parse(t,h):this._parse(t,h)}parseObjectValue(t,o,c,p,h,m={}){return this.concat(o,c,p,h)._parse(t,m)}_parse(t,o){function c(p,h,m){return m==="assert"?new Di(h,[p]):m==="coerce"?new Wo(h,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(p){let h=p.parse(t,this);if(!h)return null;if(this.expectedType){const m=this.expectedType,x=h.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||x.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(m,x))return null}else h=c(h,m,o.typeAnnotation||"coerce");else h=c(h,m,o.typeAnnotation||"assert")}if(!(h instanceof Lo)&&h.type.kind!=="resolvedImage"&&Xo(h)){const m=new ll(this._scope,this.options);try{h=new Lo(h.type,h.evaluate(m))}catch(x){return this.error(x.message),null}}return h}return Wo.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,o,c,p){let h=typeof t=="number"?this.path.concat(t):this.path;h=typeof o=="string"?h.concat(o):h;const m=p?this.scope.concat(p):this.scope;return new fo(this.registry,h,c||null,m,this.errors,this._scope,this.options)}error(t,...o){const c=`${this.key}${o.map(p=>`[${p}]`).join("")}`;this.errors.push(new us(c,t))}checkSubtype(t,o){const c=Ws(t,o);return c&&this.error(c),c}}var Bo=fo;function Xo(l){if(l instanceof Nr)return Xo(l.boundExpression);if(l instanceof oo&&l.name==="error"||l instanceof Oo||l instanceof xo||l instanceof et||l instanceof Qe)return!1;const t=l instanceof Wo||l instanceof Di;let o=!0;return l.eachChild(c=>{o=t?o&&Xo(c):o&&c instanceof Lo}),!!o&&$t(l)&&bn(l,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function fs(l,t){const o=l.length-1;let c,p,h=0,m=o,x=0;for(;h<=m;)if(x=Math.floor((h+m)/2),c=l[x],p=l[x+1],c<=t){if(x===o||t<p)return x;h=x+1}else{if(!(c>t))throw new yi("Input is not a number.");m=x-1}return 0}class Ko{constructor(t,o,c){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(const[p,h]of c)this.labels.push(p),this.outputs.push(h)}static parse(t,o){if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");const c=o.parse(t[1],1,er);if(!c)return null;const p=[];let h=null;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(let m=1;m<t.length;m+=2){const x=m===1?-1/0:t[m],A=t[m+1],R=m,y=m+1;if(typeof x!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(p.length&&p[p.length-1][0]>=x)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const T=o.parse(A,y,h);if(!T)return null;h=h||T.type,p.push([x,T])}return new Ko(h,c,p)}evaluate(t){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=o[0])return c[0].evaluate(t);const h=o.length;return p>=o[h-1]?c[h-1].evaluate(t):c[fs(o,p)].evaluate(t)}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t}}const Za=.95047,ps=1.08883,Ul=4/29,xa=6/29,xd=3*xa*xa,ul=xa*xa*xa,op=Math.PI/180,bv=180/Math.PI;function sp(l){return l>ul?Math.pow(l,1/3):l/xd+Ul}function ap(l){return l>xa?l*l*l:xd*(l-Ul)}function lp(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function cp(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Wg(l){const t=cp(l.r),o=cp(l.g),c=cp(l.b),p=sp((.4124564*t+.3575761*o+.1804375*c)/Za),h=sp((.2126729*t+.7151522*o+.072175*c)/1);return{l:116*h-16,a:500*(p-h),b:200*(h-sp((.0193339*t+.119192*o+.9503041*c)/ps)),alpha:l.a}}function Zg(l){let t=(l.l+16)/116,o=isNaN(l.a)?t:t+l.a/500,c=isNaN(l.b)?t:t-l.b/200;return t=1*ap(t),o=Za*ap(o),c=ps*ap(c),new an(lp(3.2404542*o-1.5371385*t-.4985314*c),lp(-.969266*o+1.8760108*t+.041556*c),lp(.0556434*o-.2040259*t+1.0572252*c),l.alpha)}function xv(l,t,o){const c=t-l;return l+o*(c>180||c<-180?c-360*Math.round(c/360):c)}const ph={forward:Wg,reverse:Zg,interpolate:function(l,t,o){return{l:xr(l.l,t.l,o),a:xr(l.a,t.a,o),b:xr(l.b,t.b,o),alpha:xr(l.alpha,t.alpha,o)}}},mh={forward:function(l){const{l:t,a:o,b:c}=Wg(l),p=Math.atan2(c,o)*bv;return{h:p<0?p+360:p,c:Math.sqrt(o*o+c*c),l:t,alpha:l.a}},reverse:function(l){const t=l.h*op,o=l.c;return Zg({l:l.l,a:Math.cos(t)*o,b:Math.sin(t)*o,alpha:l.alpha})},interpolate:function(l,t,o){return{h:xv(l.h,t.h,o),c:xr(l.c,t.c,o),l:xr(l.l,t.l,o),alpha:xr(l.alpha,t.alpha,o)}}};var Xg=Object.freeze({__proto__:null,hcl:mh,lab:ph});class ks{constructor(t,o,c,p,h){this.type=t,this.operator=o,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[m,x]of h)this.labels.push(m),this.outputs.push(x)}static interpolationFactor(t,o,c,p){let h=0;if(t.name==="exponential")h=up(o,t.base,c,p);else if(t.name==="linear")h=up(o,1,c,p);else if(t.name==="cubic-bezier"){const m=t.controlPoints;h=new Le(m[0],m[1],m[2],m[3]).solve(up(o,1,c,p))}return h}static parse(t,o){let[c,p,h,...m]=t;if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const R=p[1];if(typeof R!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:R}}else{if(p[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const R=p.slice(1);if(R.length!==4||R.some(y=>typeof y!="number"||y<0||y>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:R}}}if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(h=o.parse(h,2,er),!h)return null;const x=[];let A=null;c==="interpolate-hcl"||c==="interpolate-lab"?A=ro:o.expectedType&&o.expectedType.kind!=="value"&&(A=o.expectedType);for(let R=0;R<m.length;R+=2){const y=m[R],T=m[R+1],C=R+3,E=R+4;if(typeof y!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(x.length&&x[x.length-1][0]>=y)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const S=o.parse(T,E,A);if(!S)return null;A=A||S.type,x.push([y,S])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new ks(A,c,p,h,x):o.error(`Type ${ei(A)} is not interpolatable.`)}evaluate(t){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=o[0])return c[0].evaluate(t);const h=o.length;if(p>=o[h-1])return c[h-1].evaluate(t);const m=fs(o,p),x=ks.interpolationFactor(this.interpolation,p,o[m],o[m+1]),A=c[m].evaluate(t),R=c[m+1].evaluate(t);return this.operator==="interpolate"?Gs[this.type.kind.toLowerCase()](A,R,x):this.operator==="interpolate-hcl"?mh.reverse(mh.interpolate(mh.forward(A),mh.forward(R),x)):ph.reverse(ph.interpolate(ph.forward(A),ph.forward(R),x))}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,t,this.input.serialize()];for(let c=0;c<this.labels.length;c++)o.push(this.labels[c],this.outputs[c].serialize());return o}}function up(l,t,o,c){const p=c-o,h=l-o;return p===0?0:t===1?h/p:(Math.pow(t,h)-1)/(Math.pow(t,p)-1)}class wd{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expectected at least one argument.");let c=null;const p=o.expectedType;p&&p.kind!=="value"&&(c=p);const h=[];for(const x of t.slice(1)){const A=o.parse(x,1+h.length,c,void 0,{typeAnnotation:"omit"});if(!A)return null;c=c||A.type,h.push(A)}const m=p&&h.some(x=>Ws(p,x.type));return new wd(m?Hr:c,h)}evaluate(t){let o,c=null,p=0;for(const h of this.args){if(p++,c=h.evaluate(t),c&&c instanceof io&&!c.available&&(o||(o=c),c=null,p===this.args.length))return o;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(o=>{t.push(o.serialize())}),t}}class Td{constructor(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const o of this.bindings)t(o[1]);t(this.result)}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let h=1;h<t.length-1;h+=2){const m=t[h];if(typeof m!="string")return o.error(`Expected string, but found ${typeof m} instead.`,h);if(/[^a-zA-Z0-9_]/.test(m))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);const x=o.parse(t[h+1],h+1);if(!x)return null;c.push([m,x])}const p=o.parse(t[t.length-1],t.length-1,o.expectedType,c);return p?new Td(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[o,c]of this.bindings)t.push(o,c.serialize());return t.push(this.result.serialize()),t}}class hp{constructor(t,o,c){this.type=t,this.index=o,this.input=c}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=o.parse(t[1],1,er),p=o.parse(t[2],2,_i(o.expectedType||Hr));return c&&p?new hp(p.type.itemType,c,p):null}evaluate(t){const o=this.index.evaluate(t),c=this.input.evaluate(t);if(o<0)throw new yi(`Array index out of bounds: ${o} < 0.`);if(o>=c.length)throw new yi(`Array index out of bounds: ${o} > ${c.length-1}.`);if(o!==Math.floor(o))throw new yi(`Array index must be an integer, but found ${o} instead.`);return c[o]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class dp{constructor(t,o){this.type=Kr,this.needle=t,this.haystack=o}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=o.parse(t[1],1,Hr),p=o.parse(t[2],2,Hr);return c&&p?Zs(c.type,[Kr,Wr,er,Go,Hr])?new dp(c,p):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ei(c.type)} instead`):null}evaluate(t){const o=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!ho(o,["boolean","string","number","null"]))throw new yi(`Expected first argument to be of type boolean, string, number or null, but found ${ei(ii(o))} instead.`);if(!ho(c,["string","array"]))throw new yi(`Expected second argument to be of type array or string, but found ${ei(ii(c))} instead.`);return c.indexOf(o)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ed{constructor(t,o,c){this.type=er,this.needle=t,this.haystack=o,this.fromIndex=c}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=o.parse(t[1],1,Hr),p=o.parse(t[2],2,Hr);if(!c||!p)return null;if(!Zs(c.type,[Kr,Wr,er,Go,Hr]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ei(c.type)} instead`);if(t.length===4){const h=o.parse(t[3],3,er);return h?new Ed(c,p,h):null}return new Ed(c,p)}evaluate(t){const o=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!ho(o,["boolean","string","number","null"]))throw new yi(`Expected first argument to be of type boolean, string, number or null, but found ${ei(ii(o))} instead.`);if(!ho(c,["string","array"]))throw new yi(`Expected second argument to be of type array or string, but found ${ei(ii(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(t);return c.indexOf(o,p)}return c.indexOf(o)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class fp{constructor(t,o,c,p,h,m){this.inputType=t,this.type=o,this.input=c,this.cases=p,this.outputs=h,this.otherwise=m}static parse(t,o){if(t.length<5)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return o.error("Expected an even number of arguments.");let c,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const h={},m=[];for(let R=2;R<t.length-1;R+=2){let y=t[R];const T=t[R+1];Array.isArray(y)||(y=[y]);const C=o.concat(R);if(y.length===0)return C.error("Expected at least one branch label.");for(const S of y){if(typeof S!="number"&&typeof S!="string")return C.error("Branch labels must be numbers or strings.");if(typeof S=="number"&&Math.abs(S)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof S=="number"&&Math.floor(S)!==S)return C.error("Numeric branch labels must be integer values.");if(c){if(C.checkSubtype(c,ii(S)))return null}else c=ii(S);if(h[String(S)]!==void 0)return C.error("Branch labels must be unique.");h[String(S)]=m.length}const E=o.parse(T,R,p);if(!E)return null;p=p||E.type,m.push(E)}const x=o.parse(t[1],1,Hr);if(!x)return null;const A=o.parse(t[t.length-1],t.length-1,p);return A?x.type.kind!=="value"&&o.concat(1).checkSubtype(c,x.type)?null:new fp(c,p,x,h,m,A):null}evaluate(t){const o=this.input.evaluate(t);return(ii(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),c=[],p={};for(const m of o){const x=p[this.cases[m]];x===void 0?(p[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[x][1].push(m)}const h=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,x]of c)t.push(x.length===1?h(x[0]):x.map(h)),t.push(this.outputs[m].serialize());return t.push(this.otherwise.serialize()),t}}class gh{constructor(t,o,c){this.type=t,this.branches=o,this.otherwise=c}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return o.error("Expected an odd number of arguments.");let c;o.expectedType&&o.expectedType.kind!=="value"&&(c=o.expectedType);const p=[];for(let m=1;m<t.length-1;m+=2){const x=o.parse(t[m],m,Kr);if(!x)return null;const A=o.parse(t[m+1],m+1,c);if(!A)return null;p.push([x,A]),c=c||A.type}const h=o.parse(t[t.length-1],t.length-1,c);return h?new gh(c,p,h):null}evaluate(t){for(const[o,c]of this.branches)if(o.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[o,c]of this.branches)t(o),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(o=>{t.push(o.serialize())}),t}}class Id{constructor(t,o,c,p){this.type=t,this.input=o,this.beginIndex=c,this.endIndex=p}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=o.parse(t[1],1,Hr),p=o.parse(t[2],2,er);if(!c||!p)return null;if(!Zs(c.type,[_i(Hr),Wr,Hr]))return o.error(`Expected first argument to be of type array or string, but found ${ei(c.type)} instead`);if(t.length===4){const h=o.parse(t[3],3,er);return h?new Id(c.type,c,p,h):null}return new Id(c.type,c,p)}evaluate(t){const o=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!ho(o,["string","array"]))throw new yi(`Expected first argument to be of type array or string, but found ${ei(ii(o))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(t);return o.slice(c,p)}return o.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function pp(l,t){return l==="=="||l==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Kg(l,t,o,c){return c.compare(t,o)===0}function nu(l,t,o){const c=l!=="=="&&l!=="!=";return class ZD{constructor(h,m,x){this.type=Kr,this.lhs=h,this.rhs=m,this.collator=x,this.hasUntypedArgument=h.type.kind==="value"||m.type.kind==="value"}static parse(h,m){if(h.length!==3&&h.length!==4)return m.error("Expected two or three arguments.");const x=h[0];let A=m.parse(h[1],1,Hr);if(!A)return null;if(!pp(x,A.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${ei(A.type)}'.`);let R=m.parse(h[2],2,Hr);if(!R)return null;if(!pp(x,R.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${ei(R.type)}'.`);if(A.type.kind!==R.type.kind&&A.type.kind!=="value"&&R.type.kind!=="value")return m.error(`Cannot compare types '${ei(A.type)}' and '${ei(R.type)}'.`);c&&(A.type.kind==="value"&&R.type.kind!=="value"?A=new Di(R.type,[A]):A.type.kind!=="value"&&R.type.kind==="value"&&(R=new Di(A.type,[R])));let y=null;if(h.length===4){if(A.type.kind!=="string"&&R.type.kind!=="string"&&A.type.kind!=="value"&&R.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(y=m.parse(h[3],3,al),!y)return null}return new ZD(A,R,y)}evaluate(h){const m=this.lhs.evaluate(h),x=this.rhs.evaluate(h);if(c&&this.hasUntypedArgument){const A=ii(m),R=ii(x);if(A.kind!==R.kind||A.kind!=="string"&&A.kind!=="number")throw new yi(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${A.kind}, ${R.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const A=ii(m),R=ii(x);if(A.kind!=="string"||R.kind!=="string")return t(h,m,x)}return this.collator?o(h,m,x,this.collator.evaluate(h)):t(h,m,x)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[l];return this.eachChild(m=>{h.push(m.serialize())}),h}}}const wv=nu("==",function(l,t,o){return t===o},Kg),Yg=nu("!=",function(l,t,o){return t!==o},function(l,t,o,c){return!Kg(0,t,o,c)}),Jg=nu("<",function(l,t,o){return t<o},function(l,t,o,c){return c.compare(t,o)<0}),iu=nu(">",function(l,t,o){return t>o},function(l,t,o,c){return c.compare(t,o)>0}),Qg=nu("<=",function(l,t,o){return t<=o},function(l,t,o,c){return c.compare(t,o)<=0}),e_=nu(">=",function(l,t,o){return t>=o},function(l,t,o,c){return c.compare(t,o)>=0});class mp{constructor(t,o,c,p,h,m){this.type=Wr,this.number=t,this.locale=o,this.currency=c,this.unit=p,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(t,o){if(t.length!==3)return o.error("Expected two arguments.");const c=o.parse(t[1],1,er);if(!c)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");let h=null;if(p.locale&&(h=o.parseObjectValue(p.locale,2,"locale",Wr),!h))return null;let m=null;if(p.currency&&(m=o.parseObjectValue(p.currency,2,"currency",Wr),!m))return null;let x=null;if(p.unit&&(x=o.parseObjectValue(p.unit,2,"unit",Wr),!x))return null;let A=null;if(p["min-fraction-digits"]&&(A=o.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",er),!A))return null;let R=null;return p["max-fraction-digits"]&&(R=o.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",er),!R)?null:new mp(c,h,m,x,A,R)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class _h{constructor(t){this.type=er,this.input=t}static parse(t,o){if(t.length!==2)return o.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=o.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${ei(c.type)} instead.`):new _h(c):null}evaluate(t){const o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new yi(`Expected value to be of type string or array, but found ${ei(ii(o))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(o=>{t.push(o.serialize())}),t}}function Ad(l){return function(){l=1831565813+(l|=0)|0;let t=Math.imul(l^l>>>15,1|l);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const ou={"==":wv,"!=":Yg,">":iu,"<":Jg,">=":e_,"<=":Qg,array:Di,at:hp,boolean:Di,case:gh,coalesce:wd,collator:Oo,format:Ho,image:Xs,in:dp,"index-of":Ed,interpolate:ks,"interpolate-hcl":ks,"interpolate-lab":ks,length:_h,let:Td,literal:Lo,match:fp,number:Di,"number-format":mp,object:Di,slice:Id,step:Ko,string:Di,"to-boolean":Wo,"to-color":Wo,"to-number":Wo,"to-string":Wo,var:Nr,within:xo,distance:et,config:Qe};function t_(l,[t,o,c,p]){t=t.evaluate(l),o=o.evaluate(l),c=c.evaluate(l);const h=p?p.evaluate(l):1,m=ya(t,o,c,h);if(m)throw new yi(m);return new an(t/255*h,o/255*h,c/255*h,h)}function gp(l,[t,o,c,p]){t=t.evaluate(l),o=o.evaluate(l),c=c.evaluate(l);const h=p?p.evaluate(l):1,m=function(R,y,T,C){return typeof R=="number"&&R>=0&&R<=360?typeof y=="number"&&y>=0&&y<=100&&typeof T=="number"&&T>=0&&T<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[R,y,T,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[R,y,T,C]:[R,y,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[R,y,T,C]:[R,y,T]).join(", ")}]: 'h' must be between 0 and 360.`}(t,o,c,h);if(m)throw new yi(m);const x=`hsla(${t}, ${o}%, ${c}%, ${h})`,A=an.parse(x);if(!A)throw new yi(`Failed to parse HSLA color: ${x}`);return A}function _p(l,t){return l in t}function yp(l,t){const o=t[l];return o===void 0?null:o}function yc(l){return{type:l}}function r_(l){return{result:"success",value:l}}function jl(l){return{result:"error",value:l}}function vp(l,t){return!!l&&!!l.parameters&&l.parameters.indexOf(t)>-1}function Sd(l){return l["property-type"]==="data-driven"}function bp(l){return vp(l.expression,"measure-light")}function n_(l){return vp(l.expression,"zoom")}function xp(l){return!!l.expression&&l.expression.interpolated}function Cd(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function i_(l){return l}function o_(l,t){const o=t.type==="color",c=l.stops&&typeof l.stops[0][0]=="object",p=c||!(c||l.property!==void 0),h=l.type||(xp(t)?"exponential":"interval");if(o&&((l=_a({},l)).stops&&(l.stops=l.stops.map(R=>[R[0],an.parse(R[1])])),l.default=an.parse(l.default?l.default:t.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!Xg[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let m,x,A;if(h==="exponential")m=a_;else if(h==="interval")m=s_;else if(h==="categorical"){m=Tv,x=Object.create(null);for(const R of l.stops)x[R[0]]=R[1];A=typeof l.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);m=Ev}if(c){const R={},y=[];for(let E=0;E<l.stops.length;E++){const S=l.stops[E],P=S[0].zoom;R[P]===void 0&&(R[P]={zoom:P,type:l.type,property:l.property,default:l.default,stops:[]},y.push(P)),R[P].stops.push([S[0].value,S[1]])}const T=[];for(const E of y)T.push([R[E].zoom,o_(R[E],t)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:ks.interpolationFactor.bind(void 0,C),zoomStops:T.map(E=>E[0]),evaluate:({zoom:E},S)=>a_({stops:T,base:l.base},t,E).evaluate(E,S)}}if(p){const R=h==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:ks.interpolationFactor.bind(void 0,R),zoomStops:l.stops.map(y=>y[0]),evaluate:({zoom:y})=>m(l,t,y,x,A)}}return{kind:"source",evaluate(R,y){const T=y&&y.properties?y.properties[l.property]:void 0;return T===void 0?yh(l.default,t.default):m(l,t,T,x,A)}}}function yh(l,t,o){return l!==void 0?l:t!==void 0?t:o!==void 0?o:void 0}function Tv(l,t,o,c,p){return yh(typeof o===p?c[o]:void 0,l.default,t.default)}function s_(l,t,o){if(Ks(o)!=="number")return yh(l.default,t.default);const c=l.stops.length;if(c===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[c-1][0])return l.stops[c-1][1];const p=fs(l.stops.map(h=>h[0]),o);return l.stops[p][1]}function a_(l,t,o){const c=l.base!==void 0?l.base:1;if(Ks(o)!=="number")return yh(l.default,t.default);const p=l.stops.length;if(p===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[p-1][0])return l.stops[p-1][1];const h=fs(l.stops.map(y=>y[0]),o),m=function(y,T,C,E){const S=E-C,P=y-C;return S===0?0:T===1?P/S:(Math.pow(T,P)-1)/(Math.pow(T,S)-1)}(o,c,l.stops[h][0],l.stops[h+1][0]),x=l.stops[h][1],A=l.stops[h+1][1];let R=Gs[t.type]||i_;if(l.colorSpace&&l.colorSpace!=="rgb"){const y=Xg[l.colorSpace];R=(T,C)=>y.reverse(y.interpolate(y.forward(T),y.forward(C),m))}return typeof x.evaluate=="function"?{evaluate(...y){const T=x.evaluate.apply(void 0,y),C=A.evaluate.apply(void 0,y);if(T!==void 0&&C!==void 0)return R(T,C,m)}}:R(x,A,m)}function Ev(l,t,o){return t.type==="color"?o=an.parse(o):t.type==="formatted"?o=Xi.fromString(o.toString()):t.type==="resolvedImage"?o=io.fromString(o.toString()):Ks(o)===t.type||t.type==="enum"&&t.values[o]||(o=void 0),yh(o,l.default,t.default)}oo.register(ou,{error:[{kind:"error"},[Wr],(l,[t])=>{throw new yi(t.evaluate(l))}],typeof:[Wr,[Hr],(l,[t])=>ei(ii(t.evaluate(l)))],"to-rgba":[_i(er,4),[ro],(l,[t])=>t.evaluate(l).toRenderColor(null).toArray()],rgb:[ro,[er,er,er],t_],rgba:[ro,[er,er,er,er],t_],hsl:[ro,[er,er,er],gp],hsla:[ro,[er,er,er,er],gp],has:{type:Kr,overloads:[[[Wr],(l,[t])=>_p(t.evaluate(l),l.properties())],[[Wr,Ai],(l,[t,o])=>_p(t.evaluate(l),o.evaluate(l))]]},get:{type:Hr,overloads:[[[Wr],(l,[t])=>yp(t.evaluate(l),l.properties())],[[Wr,Ai],(l,[t,o])=>yp(t.evaluate(l),o.evaluate(l))]]},"feature-state":[Hr,[Wr],(l,[t])=>yp(t.evaluate(l),l.featureState||{})],properties:[Ai,[],l=>l.properties()],"geometry-type":[Wr,[],l=>l.geometryType()],id:[Hr,[],l=>l.id()],zoom:[er,[],l=>l.globals.zoom],pitch:[er,[],l=>l.globals.pitch||0],"distance-from-center":[er,[],l=>l.distanceFromCenter()],"measure-light":[er,[Wr],(l,[t])=>l.measureLight(t.evaluate(l))],"heatmap-density":[er,[],l=>l.globals.heatmapDensity||0],"line-progress":[er,[],l=>l.globals.lineProgress||0],"raster-value":[er,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[er,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[er,[],l=>l.globals.skyRadialProgress||0],accumulated:[Hr,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[er,yc(er),(l,t)=>{let o=0;for(const c of t)o+=c.evaluate(l);return o}],"*":[er,yc(er),(l,t)=>{let o=1;for(const c of t)o*=c.evaluate(l);return o}],"-":{type:er,overloads:[[[er,er],(l,[t,o])=>t.evaluate(l)-o.evaluate(l)],[[er],(l,[t])=>-t.evaluate(l)]]},"/":[er,[er,er],(l,[t,o])=>t.evaluate(l)/o.evaluate(l)],"%":[er,[er,er],(l,[t,o])=>t.evaluate(l)%o.evaluate(l)],ln2:[er,[],()=>Math.LN2],pi:[er,[],()=>Math.PI],e:[er,[],()=>Math.E],"^":[er,[er,er],(l,[t,o])=>Math.pow(t.evaluate(l),o.evaluate(l))],sqrt:[er,[er],(l,[t])=>Math.sqrt(t.evaluate(l))],log10:[er,[er],(l,[t])=>Math.log(t.evaluate(l))/Math.LN10],ln:[er,[er],(l,[t])=>Math.log(t.evaluate(l))],log2:[er,[er],(l,[t])=>Math.log(t.evaluate(l))/Math.LN2],sin:[er,[er],(l,[t])=>Math.sin(t.evaluate(l))],cos:[er,[er],(l,[t])=>Math.cos(t.evaluate(l))],tan:[er,[er],(l,[t])=>Math.tan(t.evaluate(l))],asin:[er,[er],(l,[t])=>Math.asin(t.evaluate(l))],acos:[er,[er],(l,[t])=>Math.acos(t.evaluate(l))],atan:[er,[er],(l,[t])=>Math.atan(t.evaluate(l))],min:[er,yc(er),(l,t)=>Math.min(...t.map(o=>o.evaluate(l)))],max:[er,yc(er),(l,t)=>Math.max(...t.map(o=>o.evaluate(l)))],abs:[er,[er],(l,[t])=>Math.abs(t.evaluate(l))],round:[er,[er],(l,[t])=>{const o=t.evaluate(l);return o<0?-Math.round(-o):Math.round(o)}],floor:[er,[er],(l,[t])=>Math.floor(t.evaluate(l))],ceil:[er,[er],(l,[t])=>Math.ceil(t.evaluate(l))],"filter-==":[Kr,[Wr,Hr],(l,[t,o])=>l.properties()[t.value]===o.value],"filter-id-==":[Kr,[Hr],(l,[t])=>l.id()===t.value],"filter-type-==":[Kr,[Wr],(l,[t])=>l.geometryType()===t.value],"filter-<":[Kr,[Wr,Hr],(l,[t,o])=>{const c=l.properties()[t.value],p=o.value;return typeof c==typeof p&&c<p}],"filter-id-<":[Kr,[Hr],(l,[t])=>{const o=l.id(),c=t.value;return typeof o==typeof c&&o<c}],"filter->":[Kr,[Wr,Hr],(l,[t,o])=>{const c=l.properties()[t.value],p=o.value;return typeof c==typeof p&&c>p}],"filter-id->":[Kr,[Hr],(l,[t])=>{const o=l.id(),c=t.value;return typeof o==typeof c&&o>c}],"filter-<=":[Kr,[Wr,Hr],(l,[t,o])=>{const c=l.properties()[t.value],p=o.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[Kr,[Hr],(l,[t])=>{const o=l.id(),c=t.value;return typeof o==typeof c&&o<=c}],"filter->=":[Kr,[Wr,Hr],(l,[t,o])=>{const c=l.properties()[t.value],p=o.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[Kr,[Hr],(l,[t])=>{const o=l.id(),c=t.value;return typeof o==typeof c&&o>=c}],"filter-has":[Kr,[Hr],(l,[t])=>t.value in l.properties()],"filter-has-id":[Kr,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Kr,[_i(Wr)],(l,[t])=>t.value.indexOf(l.geometryType())>=0],"filter-id-in":[Kr,[_i(Hr)],(l,[t])=>t.value.indexOf(l.id())>=0],"filter-in-small":[Kr,[Wr,_i(Hr)],(l,[t,o])=>o.value.indexOf(l.properties()[t.value])>=0],"filter-in-large":[Kr,[Wr,_i(Hr)],(l,[t,o])=>function(c,p,h,m){for(;h<=m;){const x=h+m>>1;if(p[x]===c)return!0;p[x]>c?m=x-1:h=x+1}return!1}(l.properties()[t.value],o.value,0,o.value.length-1)],all:{type:Kr,overloads:[[[Kr,Kr],(l,[t,o])=>t.evaluate(l)&&o.evaluate(l)],[yc(Kr),(l,t)=>{for(const o of t)if(!o.evaluate(l))return!1;return!0}]]},any:{type:Kr,overloads:[[[Kr,Kr],(l,[t,o])=>t.evaluate(l)||o.evaluate(l)],[yc(Kr),(l,t)=>{for(const o of t)if(o.evaluate(l))return!0;return!1}]]},"!":[Kr,[Kr],(l,[t])=>!t.evaluate(l)],"is-supported-script":[Kr,[Wr],(l,[t])=>{const o=l.globals&&l.globals.isSupportedScript;return!o||o(t.evaluate(l))}],upcase:[Wr,[Wr],(l,[t])=>t.evaluate(l).toUpperCase()],downcase:[Wr,[Wr],(l,[t])=>t.evaluate(l).toLowerCase()],concat:[Wr,yc(Hr),(l,t)=>t.map(o=>qi(o.evaluate(l))).join("")],"resolved-locale":[Wr,[al],(l,[t])=>t.evaluate(l).resolvedLocale()],random:[er,[er,er,Hr],(l,t)=>{const[o,c,p]=t.map(m=>m.evaluate(l));if(o>c||o===c)return o;let h;if(typeof p=="string")h=function(m){let x=0;if(m.length===0)return x;for(let A=0;A<m.length;A++)x=(x<<5)-x+m.charCodeAt(A),x|=0;return x}(p);else{if(typeof p!="number")throw new yi(`Invalid seed input: ${p}`);h=p}return o+Ad(h)()*(c-o)}]});class Rd{constructor(t,o,c,p){this.expression=t,this._warningHistory={},this._evaluator=new ll(c,p),this._defaultValue=o?function(h){return h.type==="color"&&(Cd(h.default)||Array.isArray(h.default))?new an(0,0,0,0):h.type==="color"?an.parse(h.default)||null:h.default===void 0?null:h.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(t,o,c,p,h,m,x,A){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(t,o,c,p,h,m,x,A){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=A||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new yi(`Expected value to be one of ${Object.keys(this._enumValues).map(y=>JSON.stringify(y)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${R.message}`)),this._defaultValue}}}function kd(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in ou}function vh(l,t,o,c){const p=new Bo(ou,[],t?function(m){const x={color:ro,string:Wr,number:er,enum:Wr,boolean:Kr,formatted:Hs,resolvedImage:Pn};return m.type==="array"?_i(x[m.value]||Hr,m.length):x[m.type]}(t):void 0,void 0,void 0,o,c),h=p.parse(l,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?r_(new Rd(h,t,o,c)):jl(p.errors)}class wp{constructor(t,o,c){this.kind=t,this._styleExpression=o,this.isLightConstant=c,this.isStateDependent=t!=="constant"&&!gr(o.expression),this.configDependencies=Pr(o.expression)}evaluateWithoutErrorHandling(t,o,c,p,h,m){return this._styleExpression.evaluateWithoutErrorHandling(t,o,c,p,h,m)}evaluate(t,o,c,p,h,m){return this._styleExpression.evaluate(t,o,c,p,h,m)}}class Xa{constructor(t,o,c,p,h){this.kind=t,this.zoomStops=c,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!gr(o.expression),this.isLightConstant=h,this.configDependencies=Pr(o.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,o,c,p,h,m){return this._styleExpression.evaluateWithoutErrorHandling(t,o,c,p,h,m)}evaluate(t,o,c,p,h,m){return this._styleExpression.evaluate(t,o,c,p,h,m)}interpolationFactor(t,o,c){return this.interpolationType?ks.interpolationFactor(this.interpolationType,t,o,c):0}}function l_(l,t,o,c){if((l=vh(l,t,o,c)).result==="error")return l;const p=l.value.expression,h=$t(p);if(!h&&!Sd(t))return jl([new us("","data expressions not supported")]);const m=bn(p,["zoom","pitch","distance-from-center"]);if(!m&&!n_(t))return jl([new us("","zoom expressions not supported")]);const x=bn(p,["measure-light"]);if(!x&&!bp(t))return jl([new us("","measure-light expression not supported")]);const A=t.expression&&t.expression.relaxZoomRestriction,R=Md(p);return R||m||A?R instanceof us?jl([R]):R instanceof ks&&!xp(t)?jl([new us("",'"interpolate" expressions cannot be used with this property')]):r_(R?new Xa(h?"camera":"composite",l.value,R.labels,R instanceof ks?R.interpolation:void 0,x):new wp(h?"constant":"source",l.value,x)):jl([new us("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Pd{constructor(t,o){this._parameters=t,this._specification=o,_a(this,o_(this._parameters,this._specification))}static deserialize(t){return new Pd(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Md(l){let t=null;if(l instanceof Td)t=Md(l.result);else if(l instanceof wd){for(const o of l.args)if(t=Md(o),t)break}else(l instanceof Ko||l instanceof ks)&&l.input instanceof oo&&l.input.name==="zoom"&&(t=l);return t instanceof us||l.eachChild(o=>{const c=Md(o);c instanceof us?t=c:t&&c&&t!==c&&(t=new us("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Dd,Tp,c_=function(){if(Tp)return Dd;Tp=1,Dd=t;var l=3;function t(o,c,p){var h=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var m=new Int32Array(this.arrayBuffer);o=m[0],this.d=(c=m[1])+2*(p=m[2]);for(var x=0;x<this.d*this.d;x++){var A=m[l+x],R=m[l+x+1];h.push(A===R?null:m.subarray(A,R))}var y=m[l+h.length+1];this.keys=m.subarray(m[l+h.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=c+2*p;for(var T=0;T<this.d*this.d;T++)h.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=o,this.padding=p,this.scale=c/o,this.uid=0;var C=p/c*o;this.min=-C,this.max=o+C}return t.prototype.insert=function(o,c,p,h,m){this._forEachCell(c,p,h,m,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(h),this.bboxes.push(m)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(o,c,p,h,m,x){this.cells[m].push(x)},t.prototype.query=function(o,c,p,h,m){var x=this.min,A=this.max;if(o<=x&&c<=x&&A<=p&&A<=h&&!m)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(o,c,p,h,this._queryCell,R,{},m),R},t.prototype._queryCell=function(o,c,p,h,m,x,A,R){var y=this.cells[m];if(y!==null)for(var T=this.keys,C=this.bboxes,E=0;E<y.length;E++){var S=y[E];if(A[S]===void 0){var P=4*S;(R?R(C[P+0],C[P+1],C[P+2],C[P+3]):o<=C[P+2]&&c<=C[P+3]&&p>=C[P+0]&&h>=C[P+1])?(A[S]=!0,x.push(T[S])):A[S]=!1}}},t.prototype._forEachCell=function(o,c,p,h,m,x,A,R){for(var y=this._convertToCellCoord(o),T=this._convertToCellCoord(c),C=this._convertToCellCoord(p),E=this._convertToCellCoord(h),S=y;S<=C;S++)for(var P=T;P<=E;P++){var O=this.d*P+S;if((!R||R(this._convertFromCellCoord(S),this._convertFromCellCoord(P),this._convertFromCellCoord(S+1),this._convertFromCellCoord(P+1)))&&m.call(this,o,c,p,h,O,x,A,R))return}},t.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},t.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,c=l+this.cells.length+1+1,p=0,h=0;h<this.cells.length;h++)p+=this.cells[h].length;var m=new Int32Array(c+p+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var x=c,A=0;A<o.length;A++){var R=o[A];m[l+A]=x,m.set(R,x),x+=R.length}return m[l+o.length]=x,m.set(this.keys,x),m[l+o.length+1]=x+=this.keys.length,m.set(this.bboxes,x),x+=this.bboxes.length,m.buffer},Dd}(),vc=$(c_);const su={};function rr(l,t,o={}){Object.defineProperty(l,"_classRegistryKey",{value:t,writable:!1}),su[t]={klass:l,omit:o.omit||[]}}rr(Object,"Object"),vc.serialize=function(l,t){const o=l.toArrayBuffer();return t&&t.add(o),{buffer:o}},vc.deserialize=function(l){return new vc(l.buffer)},Object.defineProperty(vc,"name",{value:"Grid"}),rr(vc,"Grid"),rr(an,"Color"),rr(Error,"Error"),rr(Xi,"Formatted"),rr(Si,"FormattedSection"),rr(ol,"AJAXError"),rr(io,"ResolvedImage"),rr(Pd,"StylePropertyFunction"),rr(Rd,"StyleExpression",{omit:["_evaluator"]}),rr(Xa,"ZoomDependentExpression"),rr(wp,"ZoomConstantExpression"),rr(oo,"CompoundExpression",{omit:["_evaluate"]});for(const l in ou)su[ou[l]._classRegistryKey]||rr(ou[l],`Expression${l}`);function Ep(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function u_(l){return self.ImageBitmap&&l instanceof ImageBitmap}function ms(l,t){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Ep(l)||u_(l))return t&&t.add(l),l;if(ArrayBuffer.isView(l)){const o=l;return t&&t.add(o.buffer),o}if(l instanceof ImageData)return t&&t.add(l.data.buffer),l;if(Array.isArray(l)){const o=[];for(const c of l)o.push(ms(c,t));return o}if(l instanceof Map){const o={$name:"Map"};for(const[c,p]of l.entries())o[c]=ms(p);return o}if(l instanceof Set){const o={$name:"Set"};let c=0;for(const p of l.values())o[++c]=ms(p);return o}if(typeof l=="object"){const o=l.constructor,c=o._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const p=o.serialize?o.serialize(l,t):{};if(!o.serialize){for(const h in l)l.hasOwnProperty(h)&&(su[c].omit.indexOf(h)>=0||(p[h]=ms(l[h],t)));l instanceof Error&&(p.message=l.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof l)}function bc(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Ep(l)||u_(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(bc);if(typeof l=="object"){const t=l.$name||"Object";if(t==="Map"){const p=new Map;for(const h of Object.keys(l))h!=="$name"&&p.set(h,bc(l[h]));return p}if(t==="Set"){const p=new Set;for(const h of Object.keys(l))h!=="$name"&&p.add(bc(l[h]));return p}const{klass:o}=su[t];if(!o)throw new Error(`can't deserialize unregistered class ${t}`);if(o.deserialize)return o.deserialize(l);const c=Object.create(o.prototype);for(const p of Object.keys(l))p!=="$name"&&(c[p]=bc(l[p]));return c}throw new Error("can't deserialize object of type "+typeof l)}const hr={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function Ld(l){for(const t of l)if(Bd(t.charCodeAt(0)))return!0;return!1}function Iv(l){for(const t of l)if(!Od(t.charCodeAt(0)))return!1;return!0}function Od(l){return!(hr.Arabic(l)||hr["Arabic Supplement"](l)||hr["Arabic Extended-A"](l)||hr["Arabic Presentation Forms-A"](l)||hr["Arabic Presentation Forms-B"](l))}function Bd(l){return!(l!==746&&l!==747&&(l<4352||!(hr["Bopomofo Extended"](l)||hr.Bopomofo(l)||hr["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||hr["CJK Compatibility Ideographs"](l)||hr["CJK Compatibility"](l)||hr["CJK Radicals Supplement"](l)||hr["CJK Strokes"](l)||!(!hr["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||hr["CJK Unified Ideographs Extension A"](l)||hr["CJK Unified Ideographs"](l)||hr["Enclosed CJK Letters and Months"](l)||hr["Hangul Compatibility Jamo"](l)||hr["Hangul Jamo Extended-A"](l)||hr["Hangul Jamo Extended-B"](l)||hr["Hangul Jamo"](l)||hr["Hangul Syllables"](l)||hr.Hiragana(l)||hr["Ideographic Description Characters"](l)||hr.Kanbun(l)||hr["Kangxi Radicals"](l)||hr["Katakana Phonetic Extensions"](l)||hr.Katakana(l)&&l!==12540||!(!hr["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!hr["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||hr["Unified Canadian Aboriginal Syllabics"](l)||hr["Unified Canadian Aboriginal Syllabics Extended"](l)||hr["Vertical Forms"](l)||hr["Yijing Hexagram Symbols"](l)||hr["Yi Syllables"](l)||hr["Yi Radicals"](l))))}function bh(l){return!(Bd(l)||function(t){return!!(hr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||hr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||hr["Letterlike Symbols"](t)||hr["Number Forms"](t)||hr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||hr["Control Pictures"](t)&&t!==9251||hr["Optical Character Recognition"](t)||hr["Enclosed Alphanumerics"](t)||hr["Geometric Shapes"](t)||hr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||hr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||hr["CJK Symbols and Punctuation"](t)||hr.Katakana(t)||hr["Private Use Area"](t)||hr["CJK Compatibility Forms"](t)||hr["Small Form Variants"](t)||hr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(l))}function Ip(l){return l>=1424&&l<=2303||hr["Arabic Presentation Forms-A"](l)||hr["Arabic Presentation Forms-B"](l)}function Av(l,t){return!(!t&&Ip(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||hr.Khmer(l))}function Sv(l){for(const t of l)if(Ip(t.charCodeAt(0)))return!0;return!1}const xh="deferred",wh="loading",zd="loaded";let au=null,so="unavailable",$l=null;const h_=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(so="error"),au&&au(l)};function Ap(){Sp.fire(new Rs("pluginStateChange",{pluginStatus:so,pluginURL:$l}))}const Sp=new ga,Cp=function(){return so},Rp=function(){if(so!==xh||!$l)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");so=wh,Ap(),$l&&Oa({url:$l},l=>{l?h_(l):(so=zd,Ap())})},gs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>so===zd||gs.applyArabicShaping!=null,isLoading:()=>so===wh,setState(l){so=l.pluginStatus,$l=l.pluginURL},isParsed:()=>gs.applyArabicShaping!=null&&gs.processBidirectionalText!=null&&gs.processStyledBidirectionalText!=null,getPluginURL:()=>$l};class wi{constructor(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(o,c){for(const p of o)if(!Av(p.charCodeAt(0),c))return!1;return!0}(t,gs.isLoaded())}}class Fd{constructor(t,o,c,p){this.property=t,this.value=o,this.expression=function(h,m,x,A){if(Cd(h))return new Pd(h,m);if(kd(h)||Array.isArray(h)&&h.length>0){const R=l_(h,m,x,A);if(R.result==="error")throw new Error(R.value.map(y=>`${y.key}: ${y.message}`).join(", "));return R.value}{let R=h;return typeof h=="string"&&m.type==="color"&&(R=an.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>R}}}(o===void 0?t.specification.default:o,t.specification,c,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,o,c){return this.property.possiblyEvaluate(this,t,o,c)}}class kp{constructor(t,o,c){this.property=t,this.value=new Fd(t,void 0,o,c)}transitioned(t,o){return new f_(this.property,this.value,o,Xr({},t.transition,this.transition),t.now)}untransitioned(){return new f_(this.property,this.value,null,{},0)}}class d_{constructor(t,o,c){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=o,this._options=c,this.configDependencies=new Set}getValue(t){return fi(this._values[t].value.value)}setValue(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new kp(this._values[t].property,this._scope,this._options)),this._values[t].value=new Fd(this._values[t].property,o===null?void 0:fi(o),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,o){o&&(this._options=o);const c=this._properties.properties;if(t)for(const p in t){const h=t[p];if(eo(p,"-transition")){const m=p.slice(0,-11);c[m]&&this.setTransition(m,h)}else c.hasOwnProperty(p)&&this.setValue(p,h)}}getTransition(t){return fi(this._values[t].transition)}setTransition(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new kp(this._values[t].property)),this._values[t].transition=fi(o)||void 0}serialize(){const t={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(t[o]=c);const p=this.getTransition(o);p!==void 0&&(t[`${o}-transition`]=p)}return t}transitioned(t,o){const c=new p_(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(t,o._values[p]);return c}untransitioned(){const t=new p_(this._properties);for(const o of Object.keys(this._values))t._values[o]=this._values[o].untransitioned();return t}}class f_{constructor(t,o,c,p,h){const m=p.delay||0,x=p.duration||0;h=h||0,this.property=t,this.value=o,this.begin=h+m,this.end=this.begin+x,t.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(t,o,c){const p=t.now||0,h=this.value.possiblyEvaluate(t,o,c),m=this.prior;if(m){if(p>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(p<this.begin)return m.possiblyEvaluate(t,o,c);{const x=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,o,c),h,Kt(x))}}return h}}class p_{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,o,c){const p=new cu(this._properties);for(const h of Object.keys(this._values))p._values[h]=this._values[h].possiblyEvaluate(t,o,c);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Cv{constructor(t,o,c){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=o,this._options=c,this.configDependencies=new Set}getValue(t){return fi(this._values[t].value)}setValue(t,o){this._values[t]=new Fd(this._values[t].property,o===null?void 0:fi(o),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(t[o]=c)}return t}possiblyEvaluate(t,o,c){const p=new cu(this._properties);for(const h of Object.keys(this._values))p._values[h]=this._values[h].possiblyEvaluate(t,o,c);return p}}class lu{constructor(t,o,c){this.property=t,this.value=o,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,o,c,p){return this.property.evaluate(this.value,this.parameters,t,o,c,p)}}class cu{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ot{constructor(t){this.specification=t}possiblyEvaluate(t,o){return t.expression.evaluate(o)}interpolate(t,o,c){const p=Gs[this.specification.type];return p?p(t,o,c):t}}class pr{constructor(t,o){this.specification=t,this.overrides=o}possiblyEvaluate(t,o,c,p){return new lu(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},c,p)}:t.expression,o)}interpolate(t,o,c){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new lu(this,{kind:"constant",value:void 0},t.parameters);const p=Gs[this.specification.type];return p?new lu(this,{kind:"constant",value:p(t.value.value,o.value.value,c)},t.parameters):t}evaluate(t,o,c,p,h,m){return t.kind==="constant"?t.value:t.evaluate(o,c,p,h,m)}}class wa{constructor(t){this.specification=t}possiblyEvaluate(t,o,c,p){return!!t.expression.evaluate(o,null,{},c,p)}interpolate(){return!1}}class si{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new wi(0,{});for(const c in t){const p=t[c];p.specification.overridable&&this.overridableProperties.push(c);const h=this.defaultPropertyValues[c]=new Fd(p,void 0),m=this.defaultTransitionablePropertyValues[c]=new kp(p);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=h.possiblyEvaluate(o)}}}rr(pr,"DataDrivenProperty"),rr(Ot,"DataConstantProperty"),rr(wa,"ColorRampProperty");var tt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Th(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Nd(l){if(Array.isArray(l))return l.map(Nd);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const t={};for(const o in l)t[o]=Nd(l[o]);return t}return Th(l)}function Pp(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const t of l.slice(1))if(!Pp(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Ta(l,t="",o=null,c="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Pp(l)||(l=Vd(l));const p=l;let h=!0;try{h=function(T){if(!uu(T))return T;let C=Nd(T);return xc(C),C=Mp(C),C}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}const m=tt[`filter_${c}`],x=vh(h,m,t,o);let A=null;if(x.result==="error")throw new Error(x.value.map(T=>`${T.key}: ${T.message}`).join(", "));A=(T,C,E)=>x.value.evaluate(T,C,{},E);let R=null,y=null;if(h!==p){const T=vh(p,m,t,o);if(T.result==="error")throw new Error(T.value.map(C=>`${C.key}: ${C.message}`).join(", "));R=(C,E,S,P,O)=>T.value.evaluate(C,E,{},S,void 0,void 0,P,O),y=!$t(T.value.expression)}return{filter:A,dynamicFilter:R||void 0,needGeometry:m_(h),needFeature:!!y}}function Mp(l){if(!Array.isArray(l))return l;const t=function(o){if(Rv.has(o[0])){for(let c=1;c<o.length;c++)if(uu(o[c]))return!0}return o}(l);return t===!0?t:t.map(o=>Mp(o))}function xc(l){let t=!1;const o=[];if(l[0]==="case"){for(let c=1;c<l.length-1;c+=2)t=t||uu(l[c]),o.push(l[c+1]);o.push(l[l.length-1])}else if(l[0]==="match"){t=t||uu(l[1]);for(let c=2;c<l.length-1;c+=2)o.push(l[c+1]);o.push(l[l.length-1])}else if(l[0]==="step"){t=t||uu(l[1]);for(let c=1;c<l.length-1;c+=2)o.push(l[c+1])}t&&(l.length=0,l.push("any",...o));for(let c=1;c<l.length;c++)xc(l[c])}function uu(l){if(!Array.isArray(l))return!1;if((t=l[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let o=1;o<l.length;o++)if(uu(l[o]))return!0;return!1}const Rv=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function kv(l,t){return l<t?-1:l>t?1:0}function m_(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let t=1;t<l.length;t++)if(m_(l[t]))return!0;return!1}function Vd(l){if(!l)return!0;const t=l[0];return l.length<=1?t!=="any":t==="=="?Ud(l[1],l[2],"=="):t==="!="?Ih(Ud(l[1],l[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Ud(l[1],l[2],t):t==="any"?(o=l.slice(1),["any"].concat(o.map(Vd))):t==="all"?["all"].concat(l.slice(1).map(Vd)):t==="none"?["all"].concat(l.slice(1).map(Vd).map(Ih)):t==="in"?jd(l[1],l.slice(2)):t==="!in"?Ih(jd(l[1],l.slice(2))):t==="has"?Eh(l[1]):t!=="!has"||Ih(Eh(l[1]));var o}function Ud(l,t,o){switch(l){case"$type":return[`filter-type-${o}`,t];case"$id":return[`filter-id-${o}`,t];default:return[`filter-${o}`,l,t]}}function jd(l,t){if(t.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(o=>typeof o!=typeof t[0])?["filter-in-large",l,["literal",t.sort(kv)]]:["filter-in-small",l,["literal",t]]}}function Eh(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Ih(l){return["!",l]}const hu="";function g_(l,t){return t?`${l}${hu}${t}`:l}const Ea="-transition",Pv=new Set(["fill","line","background","hillshade","raster"]);class zo extends ga{constructor(t,o,c,p,h){if(super(),this.id=t.id,this.fqid=g_(this.id,c),this.type=t.type,this.scope=c,this.lut=p,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),t.slot&&(this.slot=t.slot),o.layout&&(this._unevaluatedLayout=new Cv(o.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint)){this._transitionablePaint=new d_(o.paint,this.scope,h);for(const m in t.paint)this.setPaintProperty(m,t.paint[m]);for(const m in t.layout)this.setLayoutProperty(m,t.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new cu(o.paint)}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D()&&Pv.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,o){if(this.type==="custom"&&t==="visibility")return void(this.visibility=o);const c=this._unevaluatedLayout;c._properties.properties[t]&&(c.setValue(t,o),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return eo(t,Ea)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,o){const c=this._transitionablePaint,p=c._properties.properties;if(eo(t,Ea)){const T=t.slice(0,-11);return p[T]&&c.setTransition(T,o||void 0),!1}if(!p[t])return!1;const h=c._values[t],m=h.value.isDataDriven(),x=h.value;c.setValue(t,o),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const A=c._values[t].value,R=A.isDataDriven(),y=eo(t,"pattern")||t==="line-dasharray";return R||m||y||this._handleOverridablePaintPropertyUpdate(t,x,A)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,o,c){return null}_handleOverridablePaintPropertyUpdate(t,o,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,o)}serialize(){return Mi({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,o)=>!(t===void 0||o==="layout"&&!Object.keys(t).length||o==="paint"&&!Object.keys(t).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const o=this.paint.get(t);if(o instanceof lu&&Sd(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=Ta(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,o,c,p,h,m,x,A,R){}queryIntersectsMatchingFeature(t,o,c,p){}}const Mv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ah{constructor(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,o){return t._trim(),o&&(t.isTransferred=!0,o.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function dn(l,t=1){let o=0,c=0;return{members:l.map(p=>{const h=Mv[p.type].BYTES_PER_ELEMENT,m=o=__(o,Math.max(t,h)),x=p.components||1;return c=Math.max(c,h),o+=h*x,{name:p.name,type:p.type,components:x,offset:m}}),size:__(o,Math.max(c,t)),alignment:t}}function __(l,t){return Math.ceil(l/t)*t}class ql extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,o)}emplace(t,o,c){const p=2*t;return this.int16[p+0]=o,this.int16[p+1]=c,t}}ql.prototype.bytesPerElement=4,rr(ql,"StructArrayLayout2i4");class $d extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,c)}emplace(t,o,c,p){const h=3*t;return this.int16[h+0]=o,this.int16[h+1]=c,this.int16[h+2]=p,t}}$d.prototype.bytesPerElement=6,rr($d,"StructArrayLayout3i6");class Gl extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,o,c,p)}emplace(t,o,c,p,h){const m=4*t;return this.int16[m+0]=o,this.int16[m+1]=c,this.int16[m+2]=p,this.int16[m+3]=h,t}}Gl.prototype.bytesPerElement=8,rr(Gl,"StructArrayLayout4i8");class qd extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,o,c,p,h)}emplace(t,o,c,p,h,m){const x=5*t;return this.int16[x+0]=o,this.int16[x+1]=c,this.int16[x+2]=p,this.int16[x+3]=h,this.int16[x+4]=m,t}}qd.prototype.bytesPerElement=10,rr(qd,"StructArrayLayout5i10");class Dp extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m,x){const A=this.length;return this.resize(A+1),this.emplace(A,t,o,c,p,h,m,x)}emplace(t,o,c,p,h,m,x,A){const R=6*t,y=12*t,T=3*t;return this.int16[R+0]=o,this.int16[R+1]=c,this.uint8[y+4]=p,this.uint8[y+5]=h,this.uint8[y+6]=m,this.uint8[y+7]=x,this.float32[T+2]=A,t}}Dp.prototype.bytesPerElement=12,rr(Dp,"StructArrayLayout2i4ub1f12");class hl extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,o,c,p)}emplace(t,o,c,p,h){const m=4*t;return this.float32[m+0]=o,this.float32[m+1]=c,this.float32[m+2]=p,this.float32[m+3]=h,t}}hl.prototype.bytesPerElement=16,rr(hl,"StructArrayLayout4f16");class Hl extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,c)}emplace(t,o,c,p){const h=3*t;return this.float32[h+0]=o,this.float32[h+1]=c,this.float32[h+2]=p,t}}Hl.prototype.bytesPerElement=12,rr(Hl,"StructArrayLayout3f12");class dl extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,o,c,p,h)}emplace(t,o,c,p,h,m){const x=6*t,A=3*t;return this.uint16[x+0]=o,this.uint16[x+1]=c,this.uint16[x+2]=p,this.uint16[x+3]=h,this.float32[A+2]=m,t}}dl.prototype.bytesPerElement=12,rr(dl,"StructArrayLayout4ui1f12");class wc extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,o,c,p)}emplace(t,o,c,p,h){const m=4*t;return this.uint16[m+0]=o,this.uint16[m+1]=c,this.uint16[m+2]=p,this.uint16[m+3]=h,t}}wc.prototype.bytesPerElement=8,rr(wc,"StructArrayLayout4ui8");class Gd extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,o,c,p,h,m)}emplace(t,o,c,p,h,m,x){const A=6*t;return this.int16[A+0]=o,this.int16[A+1]=c,this.int16[A+2]=p,this.int16[A+3]=h,this.int16[A+4]=m,this.int16[A+5]=x,t}}Gd.prototype.bytesPerElement=12,rr(Gd,"StructArrayLayout6i12");class Lp extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m,x,A,R,y,T,C){const E=this.length;return this.resize(E+1),this.emplace(E,t,o,c,p,h,m,x,A,R,y,T,C)}emplace(t,o,c,p,h,m,x,A,R,y,T,C,E){const S=12*t;return this.int16[S+0]=o,this.int16[S+1]=c,this.int16[S+2]=p,this.int16[S+3]=h,this.uint16[S+4]=m,this.uint16[S+5]=x,this.uint16[S+6]=A,this.uint16[S+7]=R,this.int16[S+8]=y,this.int16[S+9]=T,this.int16[S+10]=C,this.int16[S+11]=E,t}}Lp.prototype.bytesPerElement=24,rr(Lp,"StructArrayLayout4i4ui4i24");class Op extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,o,c,p,h,m)}emplace(t,o,c,p,h,m,x){const A=10*t,R=5*t;return this.int16[A+0]=o,this.int16[A+1]=c,this.int16[A+2]=p,this.float32[R+2]=h,this.float32[R+3]=m,this.float32[R+4]=x,t}}Op.prototype.bytesPerElement=20,rr(Op,"StructArrayLayout3i3f20");class Bp extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint32[1*t+0]=o,t}}Bp.prototype.bytesPerElement=4,rr(Bp,"StructArrayLayout1ul4");class Wl extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,o)}emplace(t,o,c){const p=2*t;return this.uint16[p+0]=o,this.uint16[p+1]=c,t}}Wl.prototype.bytesPerElement=4,rr(Wl,"StructArrayLayout2ui4");class du extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m,x,A,R,y,T,C,E){const S=this.length;return this.resize(S+1),this.emplace(S,t,o,c,p,h,m,x,A,R,y,T,C,E)}emplace(t,o,c,p,h,m,x,A,R,y,T,C,E,S){const P=20*t,O=10*t;return this.int16[P+0]=o,this.int16[P+1]=c,this.int16[P+2]=p,this.int16[P+3]=h,this.int16[P+4]=m,this.float32[O+3]=x,this.float32[O+4]=A,this.float32[O+5]=R,this.float32[O+6]=y,this.int16[P+14]=T,this.uint32[O+8]=C,this.uint16[P+18]=E,this.uint16[P+19]=S,t}}du.prototype.bytesPerElement=40,rr(du,"StructArrayLayout5i4f1i1ul2ui40");class Tc extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m,x){const A=this.length;return this.resize(A+1),this.emplace(A,t,o,c,p,h,m,x)}emplace(t,o,c,p,h,m,x,A){const R=8*t;return this.int16[R+0]=o,this.int16[R+1]=c,this.int16[R+2]=p,this.int16[R+4]=h,this.int16[R+5]=m,this.int16[R+6]=x,this.int16[R+7]=A,t}}Tc.prototype.bytesPerElement=16,rr(Tc,"StructArrayLayout3i2i2i16");class Yo extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,o,c,p,h)}emplace(t,o,c,p,h,m){const x=4*t,A=8*t;return this.float32[x+0]=o,this.float32[x+1]=c,this.float32[x+2]=p,this.int16[A+6]=h,this.int16[A+7]=m,t}}Yo.prototype.bytesPerElement=16,rr(Yo,"StructArrayLayout2f1f2i16");class fu extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,o,c,p,h,m)}emplace(t,o,c,p,h,m,x){const A=20*t,R=5*t;return this.uint8[A+0]=o,this.uint8[A+1]=c,this.float32[R+1]=p,this.float32[R+2]=h,this.float32[R+3]=m,this.float32[R+4]=x,t}}fu.prototype.bytesPerElement=20,rr(fu,"StructArrayLayout2ub4f20");class po extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,c)}emplace(t,o,c,p){const h=3*t;return this.uint16[h+0]=o,this.uint16[h+1]=c,this.uint16[h+2]=p,t}}po.prototype.bytesPerElement=6,rr(po,"StructArrayLayout3ui6");class zp extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m,x,A,R,y,T,C,E,S,P,O,F,j,G,N,Z){const K=this.length;return this.resize(K+1),this.emplace(K,t,o,c,p,h,m,x,A,R,y,T,C,E,S,P,O,F,j,G,N,Z)}emplace(t,o,c,p,h,m,x,A,R,y,T,C,E,S,P,O,F,j,G,N,Z,K){const ie=30*t,ue=15*t,de=60*t;return this.int16[ie+0]=o,this.int16[ie+1]=c,this.int16[ie+2]=p,this.float32[ue+2]=h,this.float32[ue+3]=m,this.uint16[ie+8]=x,this.uint16[ie+9]=A,this.uint32[ue+5]=R,this.uint32[ue+6]=y,this.uint32[ue+7]=T,this.uint16[ie+16]=C,this.uint16[ie+17]=E,this.uint16[ie+18]=S,this.float32[ue+10]=P,this.float32[ue+11]=O,this.uint8[de+48]=F,this.uint8[de+49]=j,this.uint8[de+50]=G,this.uint32[ue+13]=N,this.int16[ie+28]=Z,this.uint8[de+58]=K,t}}zp.prototype.bytesPerElement=60,rr(zp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Fp extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m,x,A,R,y,T,C,E,S,P,O,F,j,G,N,Z,K,ie,ue,de,le,xe,me,Ee,Pe,Be,ze){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,t,o,c,p,h,m,x,A,R,y,T,C,E,S,P,O,F,j,G,N,Z,K,ie,ue,de,le,xe,me,Ee,Pe,Be,ze)}emplace(t,o,c,p,h,m,x,A,R,y,T,C,E,S,P,O,F,j,G,N,Z,K,ie,ue,de,le,xe,me,Ee,Pe,Be,ze,Ge){const rt=20*t,Ze=40*t,ft=80*t;return this.float32[rt+0]=o,this.float32[rt+1]=c,this.int16[Ze+4]=p,this.int16[Ze+5]=h,this.int16[Ze+6]=m,this.int16[Ze+7]=x,this.int16[Ze+8]=A,this.int16[Ze+9]=R,this.int16[Ze+10]=y,this.int16[Ze+11]=T,this.int16[Ze+12]=C,this.uint16[Ze+13]=E,this.uint16[Ze+14]=S,this.uint16[Ze+15]=P,this.uint16[Ze+16]=O,this.uint16[Ze+17]=F,this.uint16[Ze+18]=j,this.uint16[Ze+19]=G,this.uint16[Ze+20]=N,this.uint16[Ze+21]=Z,this.uint16[Ze+22]=K,this.uint16[Ze+23]=ie,this.uint16[Ze+24]=ue,this.uint16[Ze+25]=de,this.uint16[Ze+26]=le,this.uint16[Ze+27]=xe,this.uint32[rt+14]=me,this.float32[rt+15]=Ee,this.float32[rt+16]=Pe,this.float32[rt+17]=Be,this.float32[rt+18]=ze,this.uint8[ft+76]=Ge,t}}Fp.prototype.bytesPerElement=80,rr(Fp,"StructArrayLayout2f9i15ui1ul4f1ub80");class pu extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.float32[1*t+0]=o,t}}pu.prototype.bytesPerElement=4,rr(pu,"StructArrayLayout1f4");class fl extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,o,c,p,h)}emplace(t,o,c,p,h,m){const x=5*t;return this.float32[x+0]=o,this.float32[x+1]=c,this.float32[x+2]=p,this.float32[x+3]=h,this.float32[x+4]=m,t}}fl.prototype.bytesPerElement=20,rr(fl,"StructArrayLayout5f20");class Np extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m,x){const A=this.length;return this.resize(A+1),this.emplace(A,t,o,c,p,h,m,x)}emplace(t,o,c,p,h,m,x,A){const R=7*t;return this.float32[R+0]=o,this.float32[R+1]=c,this.float32[R+2]=p,this.float32[R+3]=h,this.float32[R+4]=m,this.float32[R+5]=x,this.float32[R+6]=A,t}}Np.prototype.bytesPerElement=28,rr(Np,"StructArrayLayout7f28");class Sh extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,o,c,p)}emplace(t,o,c,p,h){const m=6*t;return this.uint32[3*t+0]=o,this.uint16[m+2]=c,this.uint16[m+3]=p,this.uint16[m+4]=h,t}}Sh.prototype.bytesPerElement=12,rr(Sh,"StructArrayLayout1ul3ui12");class Vp extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint16[1*t+0]=o,t}}Vp.prototype.bytesPerElement=2,rr(Vp,"StructArrayLayout1ui2");class Ch extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,o)}emplace(t,o,c){const p=2*t;return this.float32[p+0]=o,this.float32[p+1]=c,t}}Ch.prototype.bytesPerElement=8,rr(Ch,"StructArrayLayout2f8");class Rh extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m,x,A,R,y,T,C,E,S,P,O){const F=this.length;return this.resize(F+1),this.emplace(F,t,o,c,p,h,m,x,A,R,y,T,C,E,S,P,O)}emplace(t,o,c,p,h,m,x,A,R,y,T,C,E,S,P,O,F){const j=16*t;return this.float32[j+0]=o,this.float32[j+1]=c,this.float32[j+2]=p,this.float32[j+3]=h,this.float32[j+4]=m,this.float32[j+5]=x,this.float32[j+6]=A,this.float32[j+7]=R,this.float32[j+8]=y,this.float32[j+9]=T,this.float32[j+10]=C,this.float32[j+11]=E,this.float32[j+12]=S,this.float32[j+13]=P,this.float32[j+14]=O,this.float32[j+15]=F,t}}Rh.prototype.bytesPerElement=64,rr(Rh,"StructArrayLayout16f64");class Hd extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,c,p,h,m,x){const A=this.length;return this.resize(A+1),this.emplace(A,t,o,c,p,h,m,x)}emplace(t,o,c,p,h,m,x,A){const R=10*t,y=5*t;return this.uint16[R+0]=o,this.uint16[R+1]=c,this.uint16[R+2]=p,this.uint16[R+3]=h,this.float32[y+2]=m,this.float32[y+3]=x,this.float32[y+4]=A,t}}Hd.prototype.bytesPerElement=20,rr(Hd,"StructArrayLayout4ui3f20");class Wd extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.int16[1*t+0]=o,t}}Wd.prototype.bytesPerElement=2,rr(Wd,"StructArrayLayout1i2");class Zd extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint8[1*t+0]=o,t}}Zd.prototype.bytesPerElement=1,rr(Zd,"StructArrayLayout1ub1");class y_ extends Ah{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}y_.prototype.size=40;class Xd extends du{get(t){return new y_(this,t)}}rr(Xd,"CollisionBoxArray");class kh extends Ah{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}kh.prototype.size=60;class Up extends zp{get(t){return new kh(this,t)}}rr(Up,"PlacedSymbolArray");class v_ extends Ah{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}v_.prototype.size=80;class jp extends Fp{get(t){return new v_(this,t)}}rr(jp,"SymbolInstanceArray");class b_ extends pu{getoffsetX(t){return this.float32[1*t+0]}}rr(b_,"GlyphOffsetArray");class Kd extends ql{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}rr(Kd,"SymbolLineVertexArray");class x_ extends Ah{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}x_.prototype.size=12;class w_ extends Sh{get(t){return new x_(this,t)}}rr(w_,"FeatureIndexArray");class T_ extends Wl{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}rr(T_,"FillExtrusionCentroidArray");class E_ extends Ah{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}E_.prototype.size=6;class $p extends $d{get(t){return new E_(this,t)}}rr($p,"FillExtrusionWallArray");const Dv=dn([{name:"a_pos",components:2,type:"Int16"}],4),Lv=dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ti{constructor(t=[]){this.segments=t}_prepareSegment(t,o,c,p){let h=this.segments[this.segments.length-1];return t>Ti.MAX_VERTEX_ARRAY_LENGTH&&nn(`Max vertices per segment is ${Ti.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!h||h.vertexLength+t>Ti.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==p)&&(h={vertexOffset:o,primitiveOffset:c,vertexLength:0,primitiveLength:0},p!==void 0&&(h.sortKey=p),this.segments.push(h)),h}prepareSegment(t,o,c,p){return this._prepareSegment(t,o.length,c.length,p)}get(){return this.segments}destroy(){for(const t of this.segments)for(const o in t.vaos)t.vaos[o].destroy()}static simpleSegment(t,o,c,p){return new Ti([{vertexOffset:t,primitiveOffset:o,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}function I_(l,t){return 256*(l=Ft(Math.floor(l),0,255))+Ft(Math.floor(t),0,255)}Ti.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rr(Ti,"SegmentVector");const Ov=dn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Bv=dn([{name:"a_dash",components:4,type:"Uint16"}]);class Ph{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,o,c,p){this.ids.push(A_(t)),this.positions.push(o,c,p)}eachPosition(t,o){const c=A_(t);let p=0,h=this.ids.length-1;for(;p<h;){const m=p+h>>1;this.ids[m]>=c?h=m:p=m+1}for(;this.ids[p]===c;)o(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(t,o){const c=new Float64Array(t.ids),p=new Uint32Array(t.positions);return mu(c,p,0,c.length-1),o&&(o.add(c.buffer),o.add(p.buffer)),{ids:c,positions:p}}static deserialize(t){const o=new Ph;let c;o.ids=t.ids,o.positions=t.positions;for(const p of o.ids)p!==c&&o.uniqueIds.push(p),c=p;return o.indexed=!0,o}}function A_(l){const t=+l;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:$i(String(l))}function mu(l,t,o,c){for(;o<c;){const p=l[o+c>>1];let h=o-1,m=c+1;for(;;){do h++;while(l[h]<p);do m--;while(l[m]>p);if(h>=m)break;Yd(l,h,m),Yd(t,3*h,3*m),Yd(t,3*h+1,3*m+1),Yd(t,3*h+2,3*m+2)}m-o<c-m?(mu(l,t,o,m),o=m+1):(mu(l,t,m+1,c),c=m)}}function Yd(l,t,o){const c=l[t];l[t]=l[o],l[o]=c}rr(Ph,"FeaturePositionMap");class pl{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,o),this.initialized=!0),!!this.location}set(t,o,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ec extends pl{constructor(t){super(t),this.current=0}set(t,o,c){this.fetchUniformLocation(t,o)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class Fo extends pl{constructor(t){super(t),this.current=0}set(t,o,c){this.fetchUniformLocation(t,o)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Ka extends pl{constructor(t){super(t),this.current=[0,0]}set(t,o,c){this.fetchUniformLocation(t,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class qp extends pl{constructor(t){super(t),this.current=[0,0,0]}set(t,o,c){this.fetchUniformLocation(t,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class Jd extends pl{constructor(t){super(t),this.current=[0,0,0,0]}set(t,o,c){this.fetchUniformLocation(t,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class Gp extends pl{constructor(t){super(t),this.current=an.transparent.toRenderColor(null)}set(t,o,c){this.fetchUniformLocation(t,o)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const S_=new Float32Array(16);class Mh extends pl{constructor(t){super(t),this.current=S_}set(t,o,c){if(this.fetchUniformLocation(t,o)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let p=1;p<16;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const zv=new Float32Array(9),Fv=new Float32Array(4);class Hp extends pl{constructor(t){super(t),this.current=Fv}set(t,o,c){if(this.fetchUniformLocation(t,o)){for(let p=0;p<4;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function Wp(l){return[I_(255*l.r,255*l.g),I_(255*l.b,255*l.a)]}class Dh{constructor(t,o,c,p){this.value=t,this.uniformNames=o.map(h=>`u_${h}`),this.type=c,this.context=p}setUniform(t,o,c,p,h){const m=p.constantOr(this.value);o.set(t,h,m instanceof an?m.toRenderColor(this.context.lut):m)}getBinding(t,o){return this.type==="color"?new Gp(t):new Fo(t)}}class gu{constructor(t,o){this.uniformNames=o.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,o,c,p,h){const m=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;m&&o.set(t,h,m)}getBinding(t,o){return o==="u_pattern"||o==="u_dash"?new Jd(t):new Fo(t)}}class Ya{constructor(t,o,c,p){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=o.map(h=>({name:`a_${h}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,o,c,p,h,m,x){const A=this.paintVertexArray.length,R=this.expression.evaluate(new wi(0,{brightness:m}),o,{},h,p,x);this.paintVertexArray.resize(t),this._setPaintValue(A,t,R,this.context)}updatePaintArray(t,o,c,p,h,m,x){const A=this.expression.evaluate({zoom:0,brightness:x},c,p,void 0,h);this._setPaintValue(t,o,A,this.context)}_setPaintValue(t,o,c,p){if(this.type==="color"){const h=Wp(c.toRenderColor(p.lut));for(let m=t;m<o;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=t;h<o;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ps{constructor(t,o,c,p,h,m){this.expression=t,this.uniformNames=o.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=p,this.context=h,this.maxValue=0,this.paintVertexAttributes=o.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,o,c,p,h,m,x){const A=this.expression.evaluate(new wi(this.context.zoom,{brightness:m}),o,{},h,p,x),R=this.expression.evaluate(new wi(this.context.zoom+1,{brightness:m}),o,{},h,p,x),y=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(y,t,A,R,this.context)}updatePaintArray(t,o,c,p,h,m,x){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:x},c,p,void 0,h),R=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x},c,p,void 0,h);this._setPaintValue(t,o,A,R,this.context)}_setPaintValue(t,o,c,p,h){if(this.type==="color"){const m=Wp(c.toRenderColor(h.lut)),x=Wp(c.toRenderColor(h.lut));for(let A=t;A<o;A++)this.paintVertexArray.emplace(A,m[0],m[1],x[0],x[1])}else{for(let m=t;m<o;m++)this.paintVertexArray.emplace(m,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,o,c,p,h){const m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=Ft(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);o.set(t,h,x)}getBinding(t,o){return new Fo(t)}}class Ja{constructor(t,o,c,p,h){this.expression=t,this.layerId=h,this.paintVertexAttributes=(c==="array"?Bv:Ov).members;for(let m=0;m<o.length;++m);this.paintVertexArray=new p}populatePaintArray(t,o,c,p){const h=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(h,t,o.patterns&&o.patterns[this.layerId],c)}updatePaintArray(t,o,c,p,h,m,x){this._setPaintValues(t,o,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(t,o,c,p){if(!p||!c)return;const h=p[c];if(!h)return;const{tl:m,br:x,pixelRatio:A}=h;for(let R=t;R<o;R++)this.paintVertexArray.emplace(R,m[0],m[1],x[0],x[1],A)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ic{constructor(t,o,c=()=>!0){this.binders={},this._buffers=[],this.context=o;const p=[];for(const h in t.paint._values){const m=t.paint.get(h);if(!c(h)||!(m instanceof lu&&Sd(m.property.specification)))continue;const x=Vv(h,t.type),A=m.value,R=m.property.specification.type,y=!!m.property.useIntegerZoom,T=h==="line-dasharray"||h.endsWith("pattern"),C=h==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(A.kind!=="constant"||C)if(A.kind==="source"||C||T){const E=d(h,R,"source");this.binders[h]=T?new Ja(A,x,R,E,t.id):new Ya(A,x,R,E),p.push(`/a_${h}`)}else{const E=d(h,R,"composite");this.binders[h]=new Ps(A,x,R,y,o,E),p.push(`/z_${h}`)}else this.binders[h]=T?new gu(A.value,x):new Dh(A.value,x,R,o),p.push(`/u_${h}`)}this.cacheKey=p.sort().join("")}getMaxValue(t){const o=this.binders[t];return o instanceof Ya||o instanceof Ps?o.maxValue:0}populatePaintArrays(t,o,c,p,h,m,x){for(const A in this.binders){const R=this.binders[A];R.context=this.context,(R instanceof Ya||R instanceof Ps||R instanceof Ja)&&R.populatePaintArray(t,o,c,p,h,m,x)}}setConstantPatternPositions(t){for(const o in this.binders){const c=this.binders[o];c instanceof gu&&c.setConstantPatternPositions(t)}}updatePaintArrays(t,o,c,p,h,m,x,A){let R=!1;const y=Object.keys(t),T=y.length!==0,C=T?y:o.uniqueIds;this.context.lut=h.lut;for(const E in this.binders){const S=this.binders[E];if(S.context=this.context,(S instanceof Ya||S instanceof Ps||S instanceof Ja)&&(S.expression.isStateDependent===!0||S.expression.isLightConstant===!1)){const P=h.paint.get(E);S.expression=P.value;for(const O of C){const F=t[O.toString()];o.eachPosition(O,(j,G,N)=>{const Z=p.feature(j);S.updatePaintArray(G,N,Z,F,m,x,A)})}if(!T)for(const O of c.uniqueIds){const F=t[O.toString()];c.eachPosition(O,(j,G,N)=>{const Z=p.feature(j);S.updatePaintArray(G,N,Z,F,m,x,A)})}R=!0}}return R}defines(){const t=[];for(const o in this.binders){const c=this.binders[o];(c instanceof Dh||c instanceof gu)&&t.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof Ya||c instanceof Ps||c instanceof Ja)for(let p=0;p<c.paintVertexAttributes.length;p++)t.push(c.paintVertexAttributes[p].name)}return t}getBinderUniforms(){const t=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof Dh||c instanceof gu||c instanceof Ps)for(const p of c.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const o=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Dh||p instanceof gu||p instanceof Ps)for(const h of p.uniformNames)o.push({name:h,property:c,binding:p.getBinding(t,h)})}return o}setUniforms(t,o,c,p,h){for(const{name:m,property:x,binding:A}of c)this.binders[x].setUniform(t,A,h,p.get(x),m)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const o=this.binders[t];(o instanceof Ya||o instanceof Ps||o instanceof Ja)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const o in this.binders){const c=this.binders[o];(c instanceof Ya||c instanceof Ps||c instanceof Ja)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const o=this.binders[t];(o instanceof Ya||o instanceof Ps||o instanceof Ja)&&o.destroy()}}}class Zl{constructor(t,o,c=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new Ic(p,o,c);this.needsUpload=!1,this._featureMap=new Ph,this._featureMapWithoutIds=new Ph,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,o,c,p,h,m,x,A){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(t,o,p,h,m,x,A);o.id!==void 0?this._featureMap.add(o.id,c,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,o,c,p,h,m){for(const x of c)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,o,x,p,h,m||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Nv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Vv(l,t){return Nv[l]||[l.replace(`${t}-`,"").replace(/-/g,"_")]}const Uv={"line-pattern":{source:dl,composite:dl},"fill-pattern":{source:dl,composite:dl},"fill-extrusion-pattern":{source:dl,composite:dl},"line-dasharray":{source:wc,composite:wc}},C_={color:{source:Ch,composite:hl},number:{source:pu,composite:Ch}};function d(l,t,o){const c=Uv[l];return c&&c[o]||C_[t][o]}rr(Dh,"ConstantBinder"),rr(gu,"PatternConstantBinder"),rr(Ya,"SourceExpressionBinder"),rr(Ja,"PatternCompositeBinder"),rr(Ps,"CompositeExpressionBinder"),rr(Ic,"ProgramConfiguration",{omit:["_buffers"]}),rr(Zl,"ProgramConfigurationSet");const r=Ut/Math.PI/2,a=5,f=6,_=16383,v=64,w=[v,32,16],k=-r,M=r;function B(l,t,o,c=r){return o=Dt(o),[l*Math.sin(o)*c,-t*c,l*Math.cos(o)*c]}function z(l,t,o){return B(Math.cos(Dt(l)),Math.sin(Dt(l)),t,o)}const V=63710088e-1,U=2*Math.PI*V;class q{constructor(t,o){if(isNaN(t)||isNaN(o))throw new Error(`Invalid LngLat object: (${t}, ${o})`);if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new q(Sr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const o=Math.PI/180,c=this.lat*o,p=t.lat*o,h=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return V*Math.acos(Math.min(h,1))}toBounds(t=0){const o=360*t/40075017,c=o/Math.cos(Math.PI/180*this.lat);return new Y({lng:this.lng-c,lat:this.lat-o},{lng:this.lng+c,lat:this.lat+o})}toEcef(t){return z(this.lat,this.lng,r+t*r/V)}static convert(t){if(t instanceof q)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new q(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new q(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Y{constructor(t,o){if(t)if(o)this.setSouthWest(t).setNorthEast(o);else if(t.length===4){const c=t;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=t;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(t){return this._ne=t instanceof q?new q(t.lng,t.lat):q.convert(t),this}setSouthWest(t){return this._sw=t instanceof q?new q(t.lng,t.lat):q.convert(t),this}extend(t){const o=this._sw,c=this._ne;let p,h;if(t instanceof q)p=t,h=t;else{if(!(t instanceof Y))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Y.convert(t)):this.extend(q.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(q.convert(t)):this;if(p=t._sw,h=t._ne,!p||!h)return this}return o||c?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),c.lng=Math.max(h.lng,c.lng),c.lat=Math.max(h.lat,c.lat)):(this._sw=new q(p.lng,p.lat),this._ne=new q(h.lng,h.lat)),this}getCenter(){return new q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new q(this.getWest(),this.getNorth())}getSouthEast(){return new q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:o,lat:c}=q.convert(t);let p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(t){if(t)return t instanceof Y?t:new Y(t)}}const J=0,ee=25.5;function re(l){return U*Math.cos(l*Math.PI/180)}function he(l){return(180+l)/360}function pe(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function ce(l,t){return l/re(t)}function ye(l){return 360*l-180}function ge(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Ae(l,t){return l*re(ge(t))}const Te=85.051129;function Se(l){return Math.cos(Dt(Ft(l,-Te,Te)))}function Oe(l,t){const o=Ft(t,J,ee),c=Math.pow(2,o);return Se(l)*U/(512*c)}function ke(l){return 1/Math.cos(l*Math.PI/180)}function Re(l,t=0){const o=Math.exp(Math.PI*(1-(l.y+t/Ut)/(1<<l.z)*2));return 80150034*o/(o*o+1)/Ut/(1<<l.z)}class Xe{constructor(t,o,c=0){this.x=+t,this.y=+o,this.z=+c}static fromLngLat(t,o=0){const c=q.convert(t);return new Xe(he(c.lng),pe(c.lat),ce(o,c.lat))}toLngLat(){return new q(ye(this.x),ge(this.y))}toAltitude(){return Ae(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/U*ke(ge(this.y))}}function ht(l,t,o,c,p,h,m,x,A){const R=(t+c)/2,y=(o+p)/2,T=new De(R,y);x(T),function(C,E,S,P,O,F){const j=S-O,G=P-F;return Math.abs((P-E)*j-(S-C)*G)/Math.hypot(j,G)}(T.x,T.y,h.x,h.y,m.x,m.y)>=A?(ht(l,t,o,R,y,h,T,x,A),ht(l,R,y,c,p,T,m,x,A)):l.push(m)}function bt(l,t,o){let c=l[0],p=c.x,h=c.y;t(c);const m=[c];for(let x=1;x<l.length;x++){const A=l[x],{x:R,y}=A;t(A),ht(m,p,h,R,y,c,A,t,o),p=R,h=y,c=A}return m}function ct(l,t,o,c){if(c(t,o)){const p=t.add(o)._mult(.5);ct(l,t,p,c),ct(l,p,o,c)}else l.push(o)}function Rt(l,t){let o=l[0];const c=[o];for(let p=1;p<l.length;p++){const h=l[p];ct(c,o,h,t),o=h}return c}const Ke=Math.pow(2,14)-1,gt=-Ke-1;function pt(l,t){const o=Math.round(l.x*t),c=Math.round(l.y*t);return l.x=Ft(o,gt,Ke),l.y=Ft(c,gt,Ke),(o<l.x||o>l.x+1||c<l.y||c>l.y+1)&&nn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function Pt(l,t,o){const c=l.loadGeometry(),p=l.extent,h=Ut/p;if(t&&o&&o.projection.isReprojectedInTileSpace){const m=1<<t.z,{scale:x,x:A,y:R,projection:y}=o,T=C=>{const E=ye((t.x+C.x/p)/m),S=ge((t.y+C.y/p)/m),P=y.project(E,S);C.x=(P.x*x-A)*p,C.y=(P.y*x-R)*p};for(let C=0;C<c.length;C++)if(l.type!==1)c[C]=bt(c[C],T,1);else{const E=[];for(const S of c[C])S.x<0||S.x>=p||S.y<0||S.y>=p||(T(S),E.push(S));c[C]=E}}for(const m of c)for(const x of m)pt(x,h);return c}function Lt(l,t){return{type:l.type,id:l.id,properties:l.properties,geometry:t?Pt(l):[]}}function yt(l,t,o,c,p){l.emplaceBack(2*t+(c+1)/2,2*o+(p+1)/2)}function Tt(l,t,o){l.emplaceBack(t.x,t.y,t.z,o[0]*16384,o[1]*16384,o[2]*16384)}class _r{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ql,this.indexArray=new po,this.segments=new Ti,this.programConfigurations=new Zl(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}updateFootprints(t,o){}populate(t,o,c,p){const h=this.layers[0],m=[];let x=null;h.type==="circle"&&(x=h.layout.get("circle-sort-key"));for(const{feature:R,id:y,index:T,sourceLayerIndex:C}of t){const E=this.layers[0]._featureFilter.needGeometry,S=Lt(R,E);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),S,c))continue;const P=x?x.evaluate(S,{},c):void 0,O={id:y,properties:R.properties,type:R.type,sourceLayerIndex:C,index:T,geometry:E?S.geometry:Pt(R,c,p),patterns:{},sortKey:P};m.push(O)}x&&m.sort((R,y)=>R.sortKey-y.sortKey);let A=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Gd,A=p.projection);for(const R of m){const{geometry:y,index:T,sourceLayerIndex:C}=R,E=t[T].feature;this.addFeature(R,y,T,o.availableImages,c,A,o.brightness),o.featureIndex.insert(E,y,T,C,this.index)}}update(t,o,c,p,h){const m=Object.keys(t).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,o,m?this.stateDependentLayers:this.layers,c,p,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Dv.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Lv.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,o,c,p,h,m,x){for(const A of o)for(const R of A){const y=R.x,T=R.y;if(y<0||y>=Ut||T<0||T>=Ut)continue;if(m){const S=m.projectTilePoint(y,T,h),P=m.upVector(h,y,T),O=this.globeExtVertexArray;Tt(O,S,P),Tt(O,S,P),Tt(O,S,P),Tt(O,S,P)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),E=C.vertexLength;yt(this.layoutVertexArray,y,T,-1,-1),yt(this.layoutVertexArray,y,T,1,-1),yt(this.layoutVertexArray,y,T,1,1),yt(this.layoutVertexArray,y,T,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+2,E+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},p,h,x)}}function Nt(l,t){for(let o=0;o<l.length;o++)if(Xn(t,l[o]))return!0;for(let o=0;o<t.length;o++)if(Xn(l,t[o]))return!0;return!!Tr(l,t)}function Qt(l,t,o){return!!Xn(l,t)||!!Ur(t,l,o)}function kr(l,t){if(l.length===1)return zn(t,l[0]);for(let o=0;o<t.length;o++){const c=t[o];for(let p=0;p<c.length;p++)if(Xn(l,c[p]))return!0}for(let o=0;o<l.length;o++)if(zn(t,l[o]))return!0;for(let o=0;o<t.length;o++)if(Tr(l,t[o]))return!0;return!1}function ar(l,t,o){if(l.length>1){if(Tr(l,t))return!0;for(let c=0;c<t.length;c++)if(Ur(t[c],l,o))return!0}for(let c=0;c<l.length;c++)if(Ur(l[c],t,o))return!0;return!1}function Tr(l,t){if(l.length===0||t.length===0)return!1;for(let o=0;o<l.length-1;o++){const c=l[o],p=l[o+1];for(let h=0;h<t.length-1;h++)if(qr(c,p,t[h],t[h+1]))return!0}return!1}function qr(l,t,o,c){return Vo(l,o,c)!==Vo(t,o,c)&&Vo(l,t,o)!==Vo(l,t,c)}function Ur(l,t,o){const c=o*o;if(t.length===1)return l.distSqr(t[0])<c;for(let p=1;p<t.length;p++)if(kn(l,t[p-1],t[p])<c)return!0;return!1}function kn(l,t,o){const c=t.distSqr(o);if(c===0)return l.distSqr(t);const p=((l.x-t.x)*(o.x-t.x)+(l.y-t.y)*(o.y-t.y))/c;return l.distSqr(p<0?t:p>1?o:o.sub(t)._mult(p)._add(t))}function zn(l,t){let o,c,p,h=!1;for(let m=0;m<l.length;m++){o=l[m];for(let x=0,A=o.length-1;x<o.length;A=x++)c=o[x],p=o[A],c.y>t.y!=p.y>t.y&&t.x<(p.x-c.x)*(t.y-c.y)/(p.y-c.y)+c.x&&(h=!h)}return h}function Xn(l,t){let o=!1;for(let c=0,p=l.length-1;c<l.length;p=c++){const h=l[c],m=l[p];h.y>t.y!=m.y>t.y&&t.x<(m.x-h.x)*(t.y-h.y)/(m.y-h.y)+h.x&&(o=!o)}return o}function ea(l,t,o,c,p){for(const m of l)if(t<=m.x&&o<=m.y&&c>=m.x&&p>=m.y)return!0;const h=[new De(t,o),new De(t,p),new De(c,p),new De(c,o)];if(l.length>2){for(const m of h)if(Xn(l,m))return!0}for(let m=0;m<l.length-1;m++)if(Li(l[m],l[m+1],h))return!0;return!1}function Li(l,t,o){const c=o[0],p=o[2];if(l.x<c.x&&t.x<c.x||l.x>p.x&&t.x>p.x||l.y<c.y&&t.y<c.y||l.y>p.y&&t.y>p.y)return!1;const h=Vo(l,t,o[0]);return h!==Vo(l,t,o[1])||h!==Vo(l,t,o[2])||h!==Vo(l,t,o[3])}function Qr(l,t,o,c,p,h){let m=t.y-l.y,x=l.x-t.x;if(h=h||0){const A=m*m+x*x;if(A===0)return!0;const R=Math.sqrt(A);m/=R,x/=R}return!((o.x-l.x)*m+(o.y-l.y)*x-h<0||(c.x-l.x)*m+(c.y-l.y)*x-h<0||(p.x-l.x)*m+(p.y-l.y)*x-h<0)}function Ln(l,t,o,c,p,h,m){return!(Qr(l,t,c,p,h,m)||Qr(t,o,c,p,h,m)||Qr(o,l,c,p,h,m)||Qr(c,p,l,t,o,m)||Qr(p,h,l,t,o,m)||Qr(h,c,l,t,o,m))}function ai(l,t,o){const c=t.paint.get(l).value;return c.kind==="constant"?c.value:o.programConfigurations.get(t.id).getMaxValue(l)}function Mn(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function jr(l,t,o,c,p){if(!t[0]&&!t[1])return l;const h=De.convert(t)._mult(p);o==="viewport"&&h._rotate(-c);const m=[];for(let x=0;x<l.length;x++)m.push(l[x].sub(h));return m}function fn(l,t,o,c){const p=De.convert(l)._mult(c);return t==="viewport"&&p._rotate(-o),p}let Cn,Ei;rr(_r,"CircleBucket",{omit:["layers"]});var Oi,ln={exports:{}},Ki=(Oi||(Oi=1,function(l,t){(function(o){function c(h,m,x){var A=p(256*h,256*(m=Math.pow(2,x)-m-1),x),R=p(256*(h+1),256*(m+1),x);return A[0]+","+A[1]+","+R[0]+","+R[1]}function p(h,m,x){var A=2*Math.PI*6378137/256/Math.pow(2,x);return[h*A-2*Math.PI*6378137/2,m*A-2*Math.PI*6378137/2]}o.getURL=function(h,m,x,A,R,y){return y=y||{},h+"?"+["bbox="+c(x,A,R),"format="+(y.format||"image/png"),"service="+(y.service||"WMS"),"version="+(y.version||"1.1.1"),"request="+(y.request||"GetMap"),"srs="+(y.srs||"EPSG:3857"),"width="+(y.width||256),"height="+(y.height||256),"layers="+m].join("&")},o.getTileBBox=c,o.getMercCoords=p,Object.defineProperty(o,"__esModule",{value:!0})})(t)}(0,ln.exports)),ln.exports);class no{constructor(t,o,c){this.z=t,this.x=o,this.y=c,this.key=Jo(0,t,t,o,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,o){const c=Ki.getTileBBox(this.x,this.y,this.z),p=function(h,m,x){let A,R="";for(let y=h;y>0;y--)A=1<<y-1,R+=(m&A?1:0)+(x&A?2:0);return R}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Yi{constructor(t,o){this.wrap=t,this.canonical=o,this.key=Jo(t,o.z,o.z,o.x,o.y)}}class qn{constructor(t,o,c,p,h){this.overscaledZ=t,this.wrap=o,this.canonical=new no(c,+p,+h),this.key=o===0&&t===c?this.canonical.key:Jo(o,t,c,p,h)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const o=this.canonical.z-t;return t>this.canonical.z?new qn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qn(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(t,o=!0){if(this.overscaledZ===t&&o)return this.key;if(t>this.canonical.z)return Jo(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return Jo(this.wrap*+o,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o}children(t){if(this.overscaledZ>=t)return[new qn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new qn(o,this.wrap,o,c,p),new qn(o,this.wrap,o,c+1,p),new qn(o,this.wrap,o,c,p+1),new qn(o,this.wrap,o,c+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new qn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new qn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Yi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Jo(l,t,o,c,p){const h=1<<Math.min(o,22);let m=h*(p%h)+c%h;return l&&o<22&&(m+=h*h*((l<0?-2*l-1:2*l)%(1<<2*(22-o)))),16*(32*m+o)+(t-o)}const Qo=[l=>{let t=l.canonical.x-1,o=l.wrap;return t<0&&(t=(1<<l.canonical.z)-1,o--),new qn(l.overscaledZ,o,l.canonical.z,t,l.canonical.y)},l=>{let t=l.canonical.x+1,o=l.wrap;return t===1<<l.canonical.z&&(t=0,o++),new qn(l.overscaledZ,o,l.canonical.z,t,l.canonical.y)},l=>new qn(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new qn(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];rr(no,"CanonicalTileID"),rr(qn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ta=dn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ms}=ta,_s=dn([{name:"a_pos_3",components:3,type:"Int16"}]);var ra=dn([{name:"a_pos",type:"Int16",components:2}]);class ml{constructor(t,o){this.pos=t,this.dir=o}intersectsPlane(t,o,c){const p=_e.vec3.dot(o,this.dir);if(Math.abs(p)<1e-6)return!1;const h=((t[0]-this.pos[0])*o[0]+(t[1]-this.pos[1])*o[1]+(t[2]-this.pos[2])*o[2])/p;return c[0]=this.pos[0]+this.dir[0]*h,c[1]=this.pos[1]+this.dir[1]*h,c[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(t,o,c){if(_e.vec3.equals(this.pos,t)||o===0)return c[0]=c[1]=c[2]=0,!1;const[p,h,m]=this.dir,x=this.pos[0]-t[0],A=this.pos[1]-t[1],R=this.pos[2]-t[2],y=p*p+h*h+m*m,T=2*(x*p+A*h+R*m),C=T*T-4*y*(x*x+A*A+R*R-o*o);if(C<0){const E=Math.max(-T/2,0),S=x+p*E,P=A+h*E,O=R+m*E,F=Math.hypot(S,P,O);return c[0]=S*o/F,c[1]=P*o/F,c[2]=O*o/F,!1}{const E=(-T-Math.sqrt(C))/(2*y);if(E<0){const S=Math.hypot(x,A,R);return c[0]=x*o/S,c[1]=A*o/S,c[2]=R*o/S,!1}return c[0]=x+p*E,c[1]=A+h*E,c[2]=R+m*E,!0}}}class Xl{constructor(t,o,c,p,h){this.TL=t,this.TR=o,this.BR=c,this.BL=p,this.horizon=h}static fromInvProjectionMatrix(t,o,c){const p=[-1,1,1],h=[1,1,1],m=[1,-1,1],x=[-1,-1,1],A=_e.vec3.transformMat4(p,p,t),R=_e.vec3.transformMat4(h,h,t),y=_e.vec3.transformMat4(m,m,t),T=_e.vec3.transformMat4(x,x,t);return new Xl(A,R,y,T,o/c)}}function Qa(l,t,o){let c=1/0,p=-1/0;const h=[];for(const m of l){_e.vec3.sub(h,m,t);const x=_e.vec3.dot(h,o);c=Math.min(c,x),p=Math.max(p,x)}return[c,p]}function _u(l,t){let o=!0;for(let c=0;c<l.planes.length;c++){const p=l.planes[c];let h=0;for(let m=0;m<t.length;m++)h+=_e.vec3.dot(p,t[m])+p[3]>=0;if(h===0)return 0;h!==t.length&&(o=!1)}return o?2:1}function yu(l,t){for(const o of l.projections){const c=Qa(t,l.points[0],o.axis);if(o.projection[1]<c[0]||o.projection[0]>c[1])return 0}return 1}function Qd(l,t){let o=0;const c=[0,0,0,0];for(let p=0;p<l.length;p++)c[0]=l[p][0],c[1]=l[p][1],c[2]=l[p][2],c[3]=1,_e.vec4.dot(c,t)>=0&&o++;return o}class vu{constructor(t,o){this.points=t||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Gn.fromPoints(this.points),this.projections=[],this.frustumEdges=[_e.vec3.sub([],this.points[2],this.points[3]),_e.vec3.sub([],this.points[0],this.points[3]),_e.vec3.sub([],this.points[4],this.points[0]),_e.vec3.sub([],this.points[5],this.points[1]),_e.vec3.sub([],this.points[6],this.points[2]),_e.vec3.sub([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const p=[0,-c[2],c[1]],h=[c[2],0,-c[0]];this.projections.push({axis:p,projection:Qa(this.points,this.points[0],p)}),this.projections.push({axis:h,projection:Qa(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(t,o,c,p){const h=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const y=_e.vec4.transformMat4([],R,t),T=1/y[3]/o*h;return _e.vec4.mul(y,y,[T,T,p?1/y[3]:T,T])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const y=_e.vec3.sub([],m[R[0]],m[R[1]]),T=_e.vec3.sub([],m[R[2]],m[R[1]]),C=_e.vec3.normalize([],_e.vec3.cross([],y,T)),E=-_e.vec3.dot(C,m[R[1]]);return C.concat(E)}),A=[];for(let R=0;R<m.length;R++)A.push([m[R][0],m[R][1],m[R][2]]);return new vu(A,x)}intersectsPrecise(t,o,c){for(let p=0;p<o.length;p++)if(!Qd(t,o[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!Qd(t,this.planes[p]))return 0;for(const p of c)for(const h of this.frustumEdges){const m=_e.vec3.cross([],p,h),x=_e.vec3.length(m);if(x===0)continue;_e.vec3.scale(m,m,1/x);const A=Qa(this.points,this.points[0],m),R=Qa(t,this.points[0],m);if(A[0]>R[1]||R[0]>A[1])return 0}return 1}containsPoint(t){for(const o of this.planes){const c=o[3];if(_e.vec3.dot([o[0],o[1],o[2]],t)+c<0)return!1}return!0}}class Gn{static fromPoints(t){const o=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const p of t)_e.vec3.min(o,o,p),_e.vec3.max(c,c,p);return new Gn(o,c)}static fromTileIdAndHeight(t,o,c){const p=1<<t.canonical.z,h=t.canonical.x,m=t.canonical.y;return new Gn([h/p,m/p,o],[(h+1)/p,(m+1)/p,c])}static applyTransform(t,o){const c=t.getCorners();for(let p=0;p<c.length;++p)_e.vec3.transformMat4(c[p],c[p],o);return Gn.fromPoints(c)}static applyTransformFast(t,o){const c=[o[12],o[13],o[14]],p=[...c];for(let h=0;h<3;h++)for(let m=0;m<3;m++){const x=o[4*m+h],A=x*t.min[m],R=x*t.max[m];c[h]+=Math.min(A,R),p[h]+=Math.max(A,R)}return new Gn(c,p)}static projectAabbCorners(t,o){const c=t.getCorners();for(let p=0;p<c.length;++p)_e.vec3.transformMat4(c[p],c[p],o);return c}constructor(t,o){this.min=t,this.max=o,this.center=_e.vec3.scale([],_e.vec3.add([],this.min,this.max),.5)}quadrant(t){const o=[t%2==0,t<2],c=_e.vec3.clone(this.min),p=_e.vec3.clone(this.max);for(let h=0;h<o.length;h++)c[h]=o[h]?this.min[h]:this.center[h],p[h]=o[h]?this.center[h]:this.max[h];return p[2]=this.max[2],new Gn(c,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,o=this.max;return[[t[0],t[1],t[2]],[o[0],t[1],t[2]],[o[0],o[1],t[2]],[t[0],o[1],t[2]],[t[0],t[1],o[2]],[o[0],t[1],o[2]],[o[0],o[1],o[2]],[t[0],o[1],o[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?_u(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?_u(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,o){return o||this.intersects(t)?yu(t,this.getCorners()):0}intersectsPreciseFlat(t,o){return o||this.intersectsFlat(t)?yu(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let o=0;o<3;++o)if(this.min[o]>t.max[o]||t.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],t.min[o]),this.max[o]=Math.max(this.max[o],t.max[o])}encapsulatePoint(t){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],t[o]),this.max[o]=Math.max(this.max[o],t[o])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}function Ac(l){return l*r/V}rr(Gn,"Aabb");const jv=[new Gn([k,k,k],[M,M,M]),new Gn([k,k,k],[0,0,M]),new Gn([0,k,k],[M,0,M]),new Gn([k,0,k],[0,M,M]),new Gn([0,0,k],[M,M,M])];function R_(l,t,o,c=!0){const p=_e.vec3.scale([],l._camera.position,l.worldSize),h=[t,o,1,1];_e.vec4.transformMat4(h,h,l.pixelMatrixInverse),_e.vec4.scale(h,h,1/h[3]);const m=_e.vec3.sub([],h,p),x=_e.vec3.normalize([],m),A=l.globeMatrix,R=[A[12],A[13],A[14]],y=_e.vec3.sub([],R,p),T=_e.vec3.length(y),C=_e.vec3.normalize([],y),E=l.worldSize/(2*Math.PI),S=_e.vec3.dot(C,x),P=Math.asin(E/T);if(P<Math.acos(S)){if(!c)return null;const xe=[],me=[];_e.vec3.scale(xe,x,T/S),_e.vec3.normalize(me,_e.vec3.sub(me,xe,y)),_e.vec3.normalize(x,_e.vec3.add(x,y,_e.vec3.scale(x,me,Math.tan(P)*T)))}const O=[];new ml(p,x).closestPointOnSphere(R,E,O);const F=_e.vec3.normalize([],Us(A,0)),j=_e.vec3.normalize([],Us(A,1)),G=_e.vec3.normalize([],Us(A,2)),N=_e.vec3.dot(F,O),Z=_e.vec3.dot(j,O),K=_e.vec3.dot(G,O),ie=Wt(Math.asin(-Z/E));let ue=Wt(Math.atan2(N,K));ue=l.center.lng+function(xe,me){const Ee=(me-xe+180)%360-180;return Ee<-180?Ee+360:Ee}(l.center.lng,ue);const de=he(ue),le=Ft(pe(ie),0,1);return new Xe(de,le)}class oL{constructor(t,o,c){this.a=_e.vec3.sub([],t,c),this.b=_e.vec3.sub([],o,c),this.center=c;const p=_e.vec3.normalize([],this.a),h=_e.vec3.normalize([],this.b);this.angle=Math.acos(_e.vec3.dot(p,h))}}function $v(l,t){if(l.angle===0)return null;let o;return o=l.a[t]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[t]/l.a[t]/Math.sin(l.angle)-1/Math.tan(l.angle)),o<0||o>1?null:function(c,p,h,m){const x=Math.sin(h);return c*(Math.sin((1-m)*h)/x)+p*(Math.sin(m*h)/x)}(l.a[t],l.b[t],l.angle,Ft(o,0,1))+l.center[t]}function Kl(l){if(l.z<=1)return jv[l.z+2*l.y+l.x];const t=qv(k_(l));return Gn.fromPoints(t)}function Sc(l,t,o){return _e.vec3.scale(l,l,1-o),_e.vec3.scaleAndAdd(l,l,t,o)}function lT(l,t,o){for(const c of l)_e.vec3.transformMat4(c,c,t),_e.vec3.scale(c,c,o)}function cT(l,t,o,c){const p=t/l.worldSize,h=l.globeMatrix;if(o.z<=1){const de=Kl(o).getCorners();return lT(de,h,p),Gn.fromPoints(de)}const m=k_(o,c),x=qv(m,r+Ac(l._tileCoverLift));lT(x,h,p);const A=Number.MAX_VALUE,R=[-A,-A,-A],y=[A,A,A];if(m.contains(l.center)){for(const xe of x)_e.vec3.min(y,y,xe),_e.vec3.max(R,R,xe);R[2]=0;const de=l.point,le=[de.x*p,de.y*p,0];return _e.vec3.min(y,y,le),_e.vec3.max(R,R,le),new Gn(y,R)}if(l._tileCoverLift>0){for(const de of x)_e.vec3.min(y,y,de),_e.vec3.max(R,R,de);return new Gn(y,R)}const T=[h[12]*p,h[13]*p,h[14]*p],C=m.getCenter(),E=Ft(l.center.lat,-Te,Te),S=Ft(C.lat,-Te,Te),P=he(l.center.lng),O=pe(E);let F=P-he(C.lng);const j=O-pe(S);F>.5?F-=1:F<-.5&&(F+=1);let G=0;if(Math.abs(F)>Math.abs(j))G=F>=0?1:3;else{G=j>=0?0:2;const de=[h[4]*p,h[5]*p,h[6]*p],le=-Math.sin(Dt(j>=0?m.getSouth():m.getNorth()))*r;_e.vec3.scaleAndAdd(T,T,de,le)}const N=x[G],Z=x[(G+1)%4],K=new oL(N,Z,T),ie=[$v(K,0)||N[0],$v(K,1)||N[1],$v(K,2)||N[2]],ue=bu(l.zoom);if(ue>0){const de=function({x:xe,y:me,z:Ee},Pe,Be,ze,Ge){const rt=1/(1<<Ee);let Ze=xe*rt,ft=Ze+rt,xt=me*rt,lt=xt+rt,Yt=0;const Vt=(Ze+ft)/2-ze;return Vt>.5?Yt=-1:Vt<-.5&&(Yt=1),Ze=((Ze+Yt)*Pe-(ze*=Pe))*Be+ze,ft=((ft+Yt)*Pe-ze)*Be+ze,xt=(xt*Pe-(Ge*=Pe))*Be+Ge,lt=(lt*Pe-Ge)*Be+Ge,[[Ze,lt,0],[ft,lt,0],[ft,xt,0],[Ze,xt,0]]}(o,t,l._pixelsPerMercatorPixel,P,O);for(let xe=0;xe<x.length;xe++)Sc(x[xe],de[xe],ue);const le=_e.vec3.add([],de[G],de[(G+1)%4]);_e.vec3.scale(le,le,.5),Sc(ie,le,ue)}for(const de of x)_e.vec3.min(y,y,de),_e.vec3.max(R,R,de);return y[2]=Math.min(N[2],Z[2]),_e.vec3.min(y,y,ie),_e.vec3.max(R,R,ie),new Gn(y,R)}function k_({x:l,y:t,z:o},c=!1){const p=1/(1<<o),h=new q(ye(l*p),t===(1<<o)-1&&c?-90:ge((t+1)*p)),m=new q(ye((l+1)*p),t===0&&c?90:ge(t*p));return new Y(h,m)}function qv(l,t=r){const o=Dt(l.getNorth()),c=Dt(l.getSouth()),p=Math.cos(o),h=Math.cos(c),m=Math.sin(o),x=Math.sin(c),A=l.getWest(),R=l.getEast();return[B(h,x,A,t),B(h,x,R,t),B(p,m,R,t),B(p,m,A,t)]}function Zp(l,t,o,c){const p=1<<o.z,h=(l/Ut+o.x)/p;return z(ge((t/Ut+o.y)/p),ye(h),c)}function P_({min:l,max:t}){return _/Math.max(t[0]-l[0],t[1]-l[1],t[2]-l[2])}const uT=new Float64Array(16);function M_(l){const t=P_(l),o=_e.mat4.fromScaling(uT,[t,t,t]);return _e.mat4.translate(o,o,_e.vec3.negate([],l.min))}function Gv(l){const t=_e.mat4.fromTranslation(uT,l.min),o=1/P_(l);return _e.mat4.scale(t,t,[o,o,o])}function Hv(l){const t=Ut/(2*Math.PI);return l/(2*Math.PI)/t}function hT(l,t){return Ut/(512*Math.pow(2,l))*P_(Kl(t))}function dT(l,t,o,c,p){const h=Hv(o),m=[l,t,-o/(2*Math.PI)],x=_e.mat4.identity(new Float64Array(16));return _e.mat4.translate(x,x,m),_e.mat4.scale(x,x,[h,h,h]),_e.mat4.rotateX(x,x,Dt(-p)),_e.mat4.rotateY(x,x,Dt(-c)),x}function bu(l){return Ir(a,f,l)}function fT(l,t){const o=z(t.lat,t.lng),c=function(h){const m=z(h._center.lat,h._center.lng),x=_e.vec3.fromValues(0,1,0);let A=_e.vec3.cross([],x,m);const R=_e.mat4.fromRotation([],-h.angle,m);A=_e.vec3.transformMat4(A,A,R),_e.mat4.fromRotation(R,-h._pitch,A);const y=_e.vec3.normalize([],m);return _e.vec3.scale(y,y,Ac(h.cameraToCenterDistance/h.pixelsPerMeter)),_e.vec3.transformMat4(y,y,R),_e.vec3.add([],m,y)}(l),p=_e.vec3.subtract([],c,o);return _e.vec3.angle(p,o)}function Wv(l,t){return fT(l,t)>Math.PI/2*1.01}const pT=Dt(85),sL=Math.cos(pT),aL=Math.sin(pT),lL=_e.mat4.create(),mT=l=>{const t=[];return l.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function gT(l,t,o,c,p,h,m,x,A){if(h&&l.queryGeometry.isAboveHorizon)return!1;h&&(A*=l.pixelToTileUnitsFactor);const R=l.tileID.canonical,y=o.projection.upVectorScale(R,o.center.lat,o.worldSize).metersToTile;for(const T of t)for(const C of T){const E=C.add(x),S=p&&o.elevation?o.elevation.exaggeration()*p.getElevationAt(E.x,E.y,!0):0,P=o.projection.projectTilePoint(E.x,E.y,R);if(S>0){const G=o.projection.upVector(R,E.x,E.y);P.x+=G[0]*y*S,P.y+=G[1]*y*S,P.z+=G[2]*y*S}const O=h?E:cL(P.x,P.y,P.z,c),F=h?l.tilespaceRays.map(G=>hL(G,S)):l.queryGeometry.screenGeometry,j=_e.vec4.transformMat4([],[P.x,P.y,P.z,1],c);if(!m&&h?A*=j[3]/o.cameraToCenterDistance:m&&!h&&(A*=o.cameraToCenterDistance/j[3]),h){const G=ge((C.y/Ut+R.y)/(1<<R.z));A/=o.projection.pixelsPerMeter(G,1)/ce(1,G)}if(Qt(F,O,A))return!0}return!1}function cL(l,t,o,c){const p=_e.vec4.transformMat4([],[l,t,o,1],c);return new De(p[0]/p[3],p[1]/p[3])}const _T=_e.vec3.fromValues(0,0,0),uL=_e.vec3.fromValues(0,0,1);function hL(l,t){const o=_e.vec3.create();return _T[2]=t,l.intersectsPlane(_T,uL,o),new De(o[0],o[1])}class yT extends _r{}let vT,bT,xT,wT;function TT(l,{width:t,height:o},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*o*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(t*o*c);return l.width=t,l.height=o,l.data=p,l}function ET(l,t,o){const{width:c,height:p}=t;c===l.width&&p===l.height||(Zv(l,t,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,c),height:Math.min(l.height,p)},o,null),l.width=c,l.height=p,l.data=t.data)}function Zv(l,t,o,c,p,h,m,x){if(p.width===0||p.height===0)return t;if(p.width>l.width||p.height>l.height||o.x>l.width-p.width||o.y>l.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||c.x>t.width-p.width||c.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const A=l.data,R=t.data,y=h===4&&x;for(let T=0;T<p.height;T++){const C=((o.y+T)*l.width+o.x)*h,E=((c.y+T)*t.width+c.x)*h;if(y)for(let S=0;S<p.width;S++){const P=C+S*h+3,O=E+S*h;R[O+0]=255,R[O+1]=255,R[O+2]=255,R[O+3]=A[P]}else if(m)for(let S=0;S<p.width;S++){const P=C+S*h,O=E+S*h,F=A[P+3],j=new an(A[P+0]/255*F,A[P+1]/255*F,A[P+2]/255*F,F).toRenderColor(m).toArray();R[O+0]=j[0],R[O+1]=j[1],R[O+2]=j[2],R[O+3]=j[3]}else for(let S=0;S<p.width*h;S++)R[E+S]=A[C+S]}return t}rr(yT,"HeatmapBucket",{omit:["layers"]});class xu{constructor(t,o){TT(this,t,1,o)}resize(t){ET(this,new xu(t),1)}clone(){return new xu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,c,p,h){Zv(t,o,c,p,h,1,null)}}class es{constructor(t,o){TT(this,t,4,o)}resize(t){ET(this,new es(t),4)}replace(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new es({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,c,p,h,m,x){Zv(t,o,c,p,h,4,m,x)}}class IT{constructor(t,o){this.width=t.width,this.height=t.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function Xp(l){const t={},o=l.resolution||256,c=l.clips?l.clips.length:1,p=l.image||new es({width:o,height:c}),h=(m,x,A)=>{t[l.evaluationKey]=A;const R=l.expression.evaluate(t);R&&(p.data[m+x+0]=Math.floor(255*R.r/R.a),p.data[m+x+1]=Math.floor(255*R.g/R.a),p.data[m+x+2]=Math.floor(255*R.b/R.a),p.data[m+x+3]=Math.floor(255*R.a))};if(l.clips)for(let m=0,x=0;m<c;++m,x+=4*o)for(let A=0,R=0;A<o;A++,R+=4){const y=A/(o-1),{start:T,end:C}=l.clips[m];h(x,R,T*(1-y)+C*y)}else for(let m=0,x=0;m<o;m++,x+=4)h(0,x,m/(o-1));return p}rr(xu,"AlphaImage"),rr(es,"RGBAImage");const dL=dn([{name:"a_pos",components:2,type:"Int16"}],4),{members:fL}=dL;function Kp(l,t,o=2){const c=t&&t.length,p=c?t[0]*o:l.length;let h=AT(l,0,p,o,!0);const m=[];if(!h||h.next===h.prev)return m;let x,A,R;if(c&&(h=function(y,T,C,E){const S=[];for(let P=0,O=T.length;P<O;P++){const F=AT(y,T[P]*E,P<O-1?T[P+1]*E:y.length,E,!1);F===F.next&&(F.steiner=!0),S.push(xL(F))}S.sort(yL);for(let P=0;P<S.length;P++)C=vL(S[P],C);return C}(l,t,h,o)),l.length>80*o){x=1/0,A=1/0;let y=-1/0,T=-1/0;for(let C=o;C<p;C+=o){const E=l[C],S=l[C+1];E<x&&(x=E),S<A&&(A=S),E>y&&(y=E),S>T&&(T=S)}R=Math.max(y-x,T-A),R=R!==0?32767/R:0}return Yp(h,m,o,x,A,R,0),m}function AT(l,t,o,c,p){let h;if(p===function(m,x,A,R){let y=0;for(let T=x,C=A-R;T<A;T+=R)y+=(m[C]-m[T])*(m[T+1]+m[C+1]),C=T;return y}(l,t,o,c)>0)for(let m=t;m<o;m+=c)h=RT(m/c|0,l[m],l[m+1],h);else for(let m=o-c;m>=t;m-=c)h=RT(m/c|0,l[m],l[m+1],h);return h&&D_(h,h.next)&&(Qp(h),h=h.next),h}function Lh(l,t){if(!l)return l;t||(t=l);let o,c=l;do if(o=!1,c.steiner||!D_(c,c.next)&&Ji(c.prev,c,c.next)!==0)c=c.next;else{if(Qp(c),c=t=c.prev,c===c.next)break;o=!0}while(o||c!==t);return t}function Yp(l,t,o,c,p,h,m){if(!l)return;!m&&h&&function(A,R,y,T){let C=A;do C.z===0&&(C.z=Xv(C.x,C.y,R,y,T)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==A);C.prevZ.nextZ=null,C.prevZ=null,function(E){let S,P=1;do{let O,F=E;E=null;let j=null;for(S=0;F;){S++;let G=F,N=0;for(let K=0;K<P&&(N++,G=G.nextZ,G);K++);let Z=P;for(;N>0||Z>0&&G;)N!==0&&(Z===0||!G||F.z<=G.z)?(O=F,F=F.nextZ,N--):(O=G,G=G.nextZ,Z--),j?j.nextZ=O:E=O,O.prevZ=j,j=O;F=G}j.nextZ=null,P*=2}while(S>1)}(C)}(l,c,p,h);let x=l;for(;l.prev!==l.next;){const A=l.prev,R=l.next;if(h?mL(l,c,p,h):pL(l))t.push(A.i,l.i,R.i),Qp(l),l=R.next,x=R.next;else if((l=R)===x){m?m===1?Yp(l=gL(Lh(l),t),t,o,c,p,h,2):m===2&&_L(l,t,o,c,p,h):Yp(Lh(l),t,o,c,p,h,1);break}}}function pL(l){const t=l.prev,o=l,c=l.next;if(Ji(t,o,c)>=0)return!1;const p=t.x,h=o.x,m=c.x,x=t.y,A=o.y,R=c.y,y=p<h?p<m?p:m:h<m?h:m,T=x<A?x<R?x:R:A<R?A:R,C=p>h?p>m?p:m:h>m?h:m,E=x>A?x>R?x:R:A>R?A:R;let S=c.next;for(;S!==t;){if(S.x>=y&&S.x<=C&&S.y>=T&&S.y<=E&&ef(p,x,h,A,m,R,S.x,S.y)&&Ji(S.prev,S,S.next)>=0)return!1;S=S.next}return!0}function mL(l,t,o,c){const p=l.prev,h=l,m=l.next;if(Ji(p,h,m)>=0)return!1;const x=p.x,A=h.x,R=m.x,y=p.y,T=h.y,C=m.y,E=x<A?x<R?x:R:A<R?A:R,S=y<T?y<C?y:C:T<C?T:C,P=x>A?x>R?x:R:A>R?A:R,O=y>T?y>C?y:C:T>C?T:C,F=Xv(E,S,t,o,c),j=Xv(P,O,t,o,c);let G=l.prevZ,N=l.nextZ;for(;G&&G.z>=F&&N&&N.z<=j;){if(G.x>=E&&G.x<=P&&G.y>=S&&G.y<=O&&G!==p&&G!==m&&ef(x,y,A,T,R,C,G.x,G.y)&&Ji(G.prev,G,G.next)>=0||(G=G.prevZ,N.x>=E&&N.x<=P&&N.y>=S&&N.y<=O&&N!==p&&N!==m&&ef(x,y,A,T,R,C,N.x,N.y)&&Ji(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;G&&G.z>=F;){if(G.x>=E&&G.x<=P&&G.y>=S&&G.y<=O&&G!==p&&G!==m&&ef(x,y,A,T,R,C,G.x,G.y)&&Ji(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;N&&N.z<=j;){if(N.x>=E&&N.x<=P&&N.y>=S&&N.y<=O&&N!==p&&N!==m&&ef(x,y,A,T,R,C,N.x,N.y)&&Ji(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function gL(l,t){let o=l;do{const c=o.prev,p=o.next.next;!D_(c,p)&&ST(c,o,o.next,p)&&Jp(c,p)&&Jp(p,c)&&(t.push(c.i,o.i,p.i),Qp(o),Qp(o.next),o=l=p),o=o.next}while(o!==l);return Lh(o)}function _L(l,t,o,c,p,h){let m=l;do{let x=m.next.next;for(;x!==m.prev;){if(m.i!==x.i&&wL(m,x)){let A=CT(m,x);return m=Lh(m,m.next),A=Lh(A,A.next),Yp(m,t,o,c,p,h,0),void Yp(A,t,o,c,p,h,0)}x=x.next}m=m.next}while(m!==l)}function yL(l,t){return l.x-t.x}function vL(l,t){const o=function(p,h){let m=h;const x=p.x,A=p.y;let R,y=-1/0;do{if(A<=m.y&&A>=m.next.y&&m.next.y!==m.y){const P=m.x+(A-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(P<=x&&P>y&&(y=P,R=m.x<m.next.x?m:m.next,P===x))return R}m=m.next}while(m!==h);if(!R)return null;const T=R,C=R.x,E=R.y;let S=1/0;m=R;do{if(x>=m.x&&m.x>=C&&x!==m.x&&ef(A<E?x:y,A,C,E,A<E?y:x,A,m.x,m.y)){const P=Math.abs(A-m.y)/(x-m.x);Jp(m,p)&&(P<S||P===S&&(m.x>R.x||m.x===R.x&&bL(R,m)))&&(R=m,S=P)}m=m.next}while(m!==T);return R}(l,t);if(!o)return t;const c=CT(o,l);return Lh(c,c.next),Lh(o,o.next)}function bL(l,t){return Ji(l.prev,l,t.prev)<0&&Ji(t.next,l,l.next)<0}function Xv(l,t,o,c,p){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-o)*p|0)|l<<8))|l<<4))|l<<2))|l<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xL(l){let t=l,o=l;do(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next;while(t!==l);return o}function ef(l,t,o,c,p,h,m,x){return(p-m)*(t-x)>=(l-m)*(h-x)&&(l-m)*(c-x)>=(o-m)*(t-x)&&(o-m)*(h-x)>=(p-m)*(c-x)}function wL(l,t){return l.next.i!==t.i&&l.prev.i!==t.i&&!function(o,c){let p=o;do{if(p.i!==o.i&&p.next.i!==o.i&&p.i!==c.i&&p.next.i!==c.i&&ST(p,p.next,o,c))return!0;p=p.next}while(p!==o);return!1}(l,t)&&(Jp(l,t)&&Jp(t,l)&&function(o,c){let p=o,h=!1;const m=(o.x+c.x)/2,x=(o.y+c.y)/2;do p.y>x!=p.next.y>x&&p.next.y!==p.y&&m<(p.next.x-p.x)*(x-p.y)/(p.next.y-p.y)+p.x&&(h=!h),p=p.next;while(p!==o);return h}(l,t)&&(Ji(l.prev,l,t.prev)||Ji(l,t.prev,t))||D_(l,t)&&Ji(l.prev,l,l.next)>0&&Ji(t.prev,t,t.next)>0)}function Ji(l,t,o){return(t.y-l.y)*(o.x-t.x)-(t.x-l.x)*(o.y-t.y)}function D_(l,t){return l.x===t.x&&l.y===t.y}function ST(l,t,o,c){const p=O_(Ji(l,t,o)),h=O_(Ji(l,t,c)),m=O_(Ji(o,c,l)),x=O_(Ji(o,c,t));return p!==h&&m!==x||!(p!==0||!L_(l,o,t))||!(h!==0||!L_(l,c,t))||!(m!==0||!L_(o,l,c))||!(x!==0||!L_(o,t,c))}function L_(l,t,o){return t.x<=Math.max(l.x,o.x)&&t.x>=Math.min(l.x,o.x)&&t.y<=Math.max(l.y,o.y)&&t.y>=Math.min(l.y,o.y)}function O_(l){return l>0?1:l<0?-1:0}function Jp(l,t){return Ji(l.prev,l,l.next)<0?Ji(l,t,l.next)>=0&&Ji(l,l.prev,t)>=0:Ji(l,t,l.prev)<0||Ji(l,l.next,t)<0}function CT(l,t){const o=Kv(l.i,l.x,l.y),c=Kv(t.i,t.x,t.y),p=l.next,h=t.prev;return l.next=t,t.prev=l,o.next=p,p.prev=o,c.next=o,o.prev=c,h.next=c,c.prev=h,c}function RT(l,t,o,c){const p=Kv(l,t,o);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function Qp(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Kv(l,t,o){return{i:l,x:t,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function B_(l,t){const o=l.length;if(o<=1)return[l];const c=[];let p,h;for(let m=0;m<o;m++){const x=Fs(l[m]);x!==0&&(l[m].area=Math.abs(x),h===void 0&&(h=x<0),h===x<0?(p&&c.push(p),p=[l[m]]):p.push(l[m]))}if(p&&c.push(p),t>1)for(let m=0;m<c.length;m++)c[m].length<=t||(Ua(c[m],t,1,c[m].length-1,TL),c[m]=c[m].slice(0,t));return c}function TL(l,t){return t.area-l.area}function Yv(l,t,o){const c=o.patternDependencies;let p=!1;for(const h of t){const m=h.paint.get(`${l}-pattern`);m.isConstant()||(p=!0);const x=m.constantOr(null);x&&(p=!0,c[x]=!0)}return p}function Jv(l,t,o,c,p){const h=p.patternDependencies;for(const m of t){const x=m.paint.get(`${l}-pattern`).value;if(x.kind!=="constant"){let A=x.evaluate({zoom:c},o,{},p.availableImages);A=A&&A.name?A.name:A,h[A]=!0,o.patterns[m.id]=A}}return o}class Qv{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ql,this.indexArray=new po,this.indexArray2=new Wl,this.programConfigurations=new Zl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Ti,this.segments2=new Ti,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=t.projection}updateFootprints(t,o){}populate(t,o,c,p){this.hasPattern=Yv("fill",this.layers,o);const h=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:x,id:A,index:R,sourceLayerIndex:y}of t){const T=this.layers[0]._featureFilter.needGeometry,C=Lt(x,T);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),C,c))continue;const E=h?h.evaluate(C,{},c,o.availableImages):void 0,S={id:A,properties:x.properties,type:x.type,sourceLayerIndex:y,index:R,geometry:T?C.geometry:Pt(x,c,p),patterns:{},sortKey:E};m.push(S)}h&&m.sort((x,A)=>x.sortKey-A.sortKey);for(const x of m){const{geometry:A,index:R,sourceLayerIndex:y}=x;if(this.hasPattern){const T=Jv("fill",this.layers,x,this.zoom,o);this.patternFeatures.push(T)}else this.addFeature(x,A,R,c,{},o.availableImages,o.brightness);o.featureIndex.insert(t[R].feature,A,R,y,this.index)}}update(t,o,c,p,h){const m=Object.keys(t).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,o,m?this.stateDependentLayers:this.layers,c,p,h)}addFeatures(t,o,c,p,h,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,o,c,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fL),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,o,c,p,h,m=[],x){for(const A of B_(o,500)){let R=0;for(const P of A)R+=P.length;const y=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray),T=y.vertexLength,C=[],E=[];for(const P of A){if(P.length===0)continue;P!==A[0]&&E.push(C.length/2);const O=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),F=O.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(F+P.length-1,F),C.push(P[0].x),C.push(P[0].y);for(let j=1;j<P.length;j++)this.layoutVertexArray.emplaceBack(P[j].x,P[j].y),this.indexArray2.emplaceBack(F+j-1,F+j),C.push(P[j].x),C.push(P[j].y);O.vertexLength+=P.length,O.primitiveLength+=P.length}const S=Kp(C,E);for(let P=0;P<S.length;P+=3)this.indexArray.emplaceBack(T+S[P],T+S[P+1],T+S[P+2]);y.vertexLength+=R,y.primitiveLength+=S.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,m,p,x)}}let kT,PT,MT,DT;rr(Qv,"FillBucket",{omit:["layers","patternFeatures"]});class eb{constructor(t,o,c,p){if(this.triangleCount=o.length/3,this.min=new De(0,0),this.max=new De(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[h,m]=[t[0].clone(),t[0].clone()];for(let T=1;T<t.length;++T){const C=t[T];h.x=Math.min(h.x,C.x),h.y=Math.min(h.y,C.y),m.x=Math.max(m.x,C.x),m.y=Math.max(m.y,C.y)}if(p){const T=Math.ceil(Math.max(m.x-h.x,m.y-h.y)/p);c=Math.max(c,T)}if(c===0)return;this.min=h,this.max=m;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const A=Math.max(x.x,x.y)/c;this.cellsX=Math.max(1,Math.ceil(x.x/A)),this.cellsY=Math.max(1,Math.ceil(x.y/A)),this.xScale=1/A,this.yScale=1/A;const R=[];for(let T=0;T<this.triangleCount;T++){const C=t[o[3*T+0]].sub(this.min),E=t[o[3*T+1]].sub(this.min),S=t[o[3*T+2]].sub(this.min),P=Yl(Math.floor(Math.min(C.x,E.x,S.x)),this.xScale,this.cellsX),O=Yl(Math.floor(Math.max(C.x,E.x,S.x)),this.xScale,this.cellsX),F=Yl(Math.floor(Math.min(C.y,E.y,S.y)),this.yScale,this.cellsY),j=Yl(Math.floor(Math.max(C.y,E.y,S.y)),this.yScale,this.cellsY),G=new De(0,0),N=new De(0,0),Z=new De(0,0),K=new De(0,0);for(let ie=F;ie<=j;++ie){G.y=N.y=ie*A,Z.y=K.y=(ie+1)*A;for(let ue=P;ue<=O;++ue)G.x=Z.x=ue*A,N.x=K.x=(ue+1)*A,(Ln(C,E,S,G,N,K)||Ln(C,E,S,G,K,Z))&&R.push({cellIdx:ie*this.cellsX+ue,triIdx:T})}}if(R.length===0)return;R.sort((T,C)=>T.cellIdx-C.cellIdx||T.triIdx-C.triIdx);let y=0;for(;y<R.length;){const T=R[y].cellIdx,C={start:this.payload.length,len:0};for(;y<R.length&&R[y].cellIdx===T;)++C.len,this.payload.push(R[y++].triIdx);this.cells[T]=C}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,o){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const c=Yl(t.x-this.min.x,this.xScale,this.cellsX),p=Yl(t.y-this.min.y,this.yScale,this.cellsY),h=this.cells[p*this.cellsX+c];if(h){this._lazyInitLookup();for(let m=0;m<h.len;m++){const x=this.payload[h.start+m],A=Math.floor(x/8),R=1<<x%8;if(!(this.lookup[A]&R)&&(this.lookup[A]|=R,o.push(x),o.length===this.triangleCount))return}}}query(t,o,c){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>o.x||t.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const p=Yl(t.x-this.min.x,this.xScale,this.cellsX),h=Yl(o.x-this.min.x,this.xScale,this.cellsX),m=Yl(t.y-this.min.y,this.yScale,this.cellsY),x=Yl(o.y-this.min.y,this.yScale,this.cellsY);for(let A=m;A<=x;A++)for(let R=p;R<=h;R++){const y=this.cells[A*this.cellsX+R];if(y)for(let T=0;T<y.len;T++){const C=this.payload[y.start+T],E=Math.floor(C/8),S=1<<C%8;if(!(this.lookup[E]&S)&&(this.lookup[E]|=S,c.push(C),c.length===this.triangleCount))return}}}}function Yl(l,t,o){return Math.max(0,Math.min(o-1,Math.floor(l*t)))}rr(eb,"TriangleGridIndex");class LT{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[]}updateFootprints(t,o){for(const c of this.footprints)o.push({footprint:c,id:t})}populate(t,o,c,p){const h=[];for(const{feature:m,id:x,index:A,sourceLayerIndex:R}of t){const y=this.layers[0]._featureFilter.needGeometry,T=Lt(m,y);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),T,c))continue;const C={id:x,properties:m.properties,type:m.type,sourceLayerIndex:R,index:A,geometry:y?T.geometry:Pt(m,c,p),patterns:{}};h.push(C)}for(const m of h){const{geometry:x,index:A,sourceLayerIndex:R}=m;this.addFeature(m,x,A,c,{},o.availableImages,o.brightness),o.featureIndex.insert(t[A].feature,x,A,R,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,o,c,p,h){}destroy(){}addFeature(t,o,c,p,h,m=[],x){for(const A of B_(o,2)){const R=[],y=[],T=[],C=new De(1/0,1/0),E=new De(-1/0,-1/0);for(const O of A)if(O.length!==0){O!==A[0]&&T.push(y.length/2);for(let F=0;F<O.length;F++)y.push(O[F].x),y.push(O[F].y),R.push(O[F]),C.x=Math.min(C.x,O[F].x),C.y=Math.min(C.y,O[F].y),E.x=Math.max(E.x,O[F].x),E.y=Math.max(E.y,O[F].y)}const S=Kp(y,T),P=new eb(R,S,8,256);this.footprints.push({vertices:R,indices:S,grid:P,min:C,max:E})}}}rr(LT,"ClipBucket",{omit:["layers"]});const EL=dn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),IL=dn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),AL=dn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),SL=dn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),CL=dn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),RL=dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:kL}=EL;var tb,OT,rb,BT,nb,zT,FT,z_={};function NT(){if(OT)return tb;OT=1;var l=Ye();function t(p,h,m,x,A){this.properties={},this.extent=m,this.type=0,this._pbf=p,this._geometry=-1,this._keys=x,this._values=A,p.readFields(o,this,h)}function o(p,h,m){p==1?h.id=m.readVarint():p==2?function(x,A){for(var R=x.readVarint()+x.pos;x.pos<R;){var y=A._keys[x.readVarint()],T=A._values[x.readVarint()];A.properties[y]=T}}(m,h):p==3?h.type=m.readVarint():p==4&&(h._geometry=m.pos)}function c(p){for(var h,m,x=0,A=0,R=p.length,y=R-1;A<R;y=A++)x+=((m=p[y]).x-(h=p[A]).x)*(h.y+m.y);return x}return tb=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var h,m=p.readVarint()+p.pos,x=1,A=0,R=0,y=0,T=[];p.pos<m;){if(A<=0){var C=p.readVarint();x=7&C,A=C>>3}if(A--,x===1||x===2)R+=p.readSVarint(),y+=p.readSVarint(),x===1&&(h&&T.push(h),h=[]),h.push(new l(R,y));else{if(x!==7)throw new Error("unknown command "+x);h&&h.push(h[0].clone())}}return h&&T.push(h),T},t.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var h=p.readVarint()+p.pos,m=1,x=0,A=0,R=0,y=1/0,T=-1/0,C=1/0,E=-1/0;p.pos<h;){if(x<=0){var S=p.readVarint();m=7&S,x=S>>3}if(x--,m===1||m===2)(A+=p.readSVarint())<y&&(y=A),A>T&&(T=A),(R+=p.readSVarint())<C&&(C=R),R>E&&(E=R);else if(m!==7)throw new Error("unknown command "+m)}return[y,C,T,E]},t.prototype.toGeoJSON=function(p,h,m){var x,A,R=this.extent*Math.pow(2,m),y=this.extent*p,T=this.extent*h,C=this.loadGeometry(),E=t.types[this.type];function S(F){for(var j=0;j<F.length;j++){var G=F[j];F[j]=[360*(G.x+y)/R-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+T)/R)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(x=0;x<C.length;x++)P[x]=C[x][0];S(C=P);break;case 2:for(x=0;x<C.length;x++)S(C[x]);break;case 3:for(C=function(F){var j=F.length;if(j<=1)return[F];for(var G,N,Z=[],K=0;K<j;K++){var ie=c(F[K]);ie!==0&&(N===void 0&&(N=ie<0),N===ie<0?(G&&Z.push(G),G=[F[K]]):G.push(F[K]))}return G&&Z.push(G),Z}(C),x=0;x<C.length;x++)for(A=0;A<C[x].length;A++)S(C[x][A])}C.length===1?C=C[0]:E="Multi"+E;var O={type:"Feature",geometry:{type:E,coordinates:C},properties:this.properties};return"id"in this&&(O.id=this.id),O},tb}function VT(){if(BT)return rb;BT=1;var l=NT();function t(c,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(o,this,p),this.length=this._features.length}function o(c,p,h){c===15?p.version=h.readVarint():c===1?p.name=h.readString():c===5?p.extent=h.readVarint():c===2?p._features.push(h.pos):c===3?p._keys.push(h.readString()):c===4&&p._values.push(function(m){for(var x=null,A=m.readVarint()+m.pos;m.pos<A;){var R=m.readVarint()>>3;x=R===1?m.readString():R===2?m.readFloat():R===3?m.readDouble():R===4?m.readVarint64():R===5?m.readVarint():R===6?m.readSVarint():R===7?m.readBoolean():null}return x}(h))}return rb=t,t.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var p=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,p,this.extent,this._keys,this._values)},rb}function UT(){return FT||(FT=1,z_.VectorTile=function(){if(zT)return nb;zT=1;var l=VT();function t(o,c,p){if(o===3){var h=new l(p,p.readVarint()+p.pos);h.length&&(c[h.name]=h)}}return nb=function(o,c){this.layers=o.readFields(t,{},c)},nb}(),z_.VectorTileFeature=NT(),z_.VectorTileLayer=VT()),z_}var tf=UT();class Oh extends De{constructor(t,o,c){super(t,o),this.z=c}}class jT extends Oh{constructor(t,o,c,p){super(t,o,c),this.w=p}}function F_(l,t,o,c){const p=[],h=c===0?(m,x,A,R,y,T)=>{m.push(new De(T,A+(T-x)/(R-x)*(y-A)))}:(m,x,A,R,y,T)=>{m.push(new De(x+(T-A)/(y-A)*(R-x),T))};for(const m of l){const x=[];for(const A of m){if(A.length<=2)continue;const R=[];for(let C=0;C<A.length-1;C++){const E=A[C].x,S=A[C].y,P=A[C+1].x,O=A[C+1].y,F=c===0?E:S,j=c===0?P:O;F<t?j>t&&h(R,E,S,P,O,t):F>o?j<o&&h(R,E,S,P,O,o):R.push(A[C]),j<t&&F>=t&&h(R,E,S,P,O,t),j>o&&F<=o&&h(R,E,S,P,O,o)}let y=A[A.length-1];const T=c===0?y.x:y.y;T>=t&&T<=o&&R.push(y),R.length&&(y=R[R.length-1],R[0].x===y.x&&R[0].y===y.y||R.push(R[0]),x.push(R))}x.length&&p.push(x)}return p}function $T(l,t,o,c){const p=o==="x"?"y":"x",h=(c-l[o])/(t[o]-l[o]);l[p]=l[p]+(t[p]-l[p])*h,l[o]=c,l.hasOwnProperty("z")&&(l.z=xr(l.z,t.z,h)),l.hasOwnProperty("w")&&(l.w=xr(l.w,t.w,h))}function qT(l,t,o,c){const p=o,h=c;for(const m of["x","y"]){let x=l,A=t;x[m]>=A[m]&&(x=t,A=l),x[m]<p&&A[m]>p&&$T(x,A,m,p),x[m]<h&&A[m]>h&&$T(A,x,m,h)}}const N_=Number.MAX_SAFE_INTEGER;function GT(l,t,o,c){return l.order<t||l.order===N_||!(l.clipMask&o)||function(p,h){return h.length!==0&&h.find(m=>m===p)===void 0}(c,l.clipScope)}function V_(l,t){return l.x-t.x||l.y-t.y}function HT(l,t){return V_(l.min,t.min)===0&&V_(l.max,t.max)===0}function ib(l,t){return!(l.min.x>t.max.x||l.max.x<t.min.x||l.min.y>t.max.y||l.max.y<t.min.y)}function ob(l,t){if(l.length!==t.length)return!1;for(let o=0;o<l.length;o++)if(l[o].sourceId!==t[o].sourceId||!HT(l[o],t[o])||l[o].order!==t[o].order||l[o].clipMask!==t[o].clipMask||!jt(l[o].clipScope,t[o].clipScope))return!1;return!0}function WT(l,t,o){const c=1/Ut,p=1/(1<<o.canonical.z),h=(t.x*c+o.canonical.x)*p+o.wrap,m=(t.y*c+o.canonical.y)*p;return{min:new De((l.x*c+o.canonical.x)*p+o.wrap,(l.y*c+o.canonical.y)*p),max:new De(h,m)}}function PL(l,t,o){const c=1<<o.canonical.z,p=((t.x-o.wrap)*c-o.canonical.x)*Ut,h=(t.y*c-o.canonical.y)*Ut;return{min:new De(((l.x-o.wrap)*c-o.canonical.x)*Ut,(l.y*c-o.canonical.y)*Ut),max:new De(p,h)}}function ZT(l,t,o,c,p,h,m){const x=l.indices,A=l.vertices,R=[];for(let y=c;y<c+p;y+=3){const T=t[o[y+0]+h],C=t[o[y+1]+h],E=t[o[y+2]+h],S=Math.min(T.x,C.x,E.x),P=Math.max(T.x,C.x,E.x),O=Math.min(T.y,C.y,E.y),F=Math.max(T.y,C.y,E.y);R.length=0,l.grid.query(new De(S,O),new De(P,F),R);for(let j=0;j<R.length;j++){const G=R[j];if(Ln(A[x[3*G+0]],A[x[3*G+1]],A[x[3*G+2]],T,C,E,m))return!0}}return!1}function XT(l,t,o,c){if(!l||!o)return!1;let p=l.vertices;if(!t.canonical.equals(c.canonical)||t.wrap!==c.wrap){if(o.vertices.length<l.vertices.length)return XT(o,c,l,t);const h=t.canonical,m=c.canonical,x=Math.pow(2,m.z-h.z);p=l.vertices.map(A=>new De((A.x+h.x*Ut)*x-m.x*Ut,(A.y+h.y*Ut)*x-m.y*Ut))}return ZT(o,p,l.indices,0,l.indices.length,0,0)}function KT(l,t,o,c){const p=Math.pow(2,c.z-o.z);return new De((l+o.x*Ut)*p-c.x*Ut,(t+o.y*Ut)*p-c.y*Ut)}function YT(l,t){const o=[];t.grid.queryPoint(l,o);const c=t.indices,p=t.vertices;for(let h=0;h<o.length;h++){const m=o[h];if(Xn([p[c[3*m+0]],p[c[3*m+1]],p[c[3*m+2]]],l))return!0}return!1}const sb=[new De(0,0),new De(Ut,0),new De(Ut,Ut),new De(0,Ut)];function JT(l,t){const o=[];let c=[];if(!t||l.length<2)return[l];if(l.length===2)return Li(l[0],l[1],sb)?[l]:[];for(let p=0;p<l.length+2;p++){const h=l[p%l.length],m=l[(p+1)%l.length],x=Li(p===0?l[l.length-1]:l[(p-1)%l.length],h,sb),A=Li(h,m,sb),R=x||A;R&&c.push(h),R&&A||c.length>0&&(c.length>1&&o.push(c),c=[])}return c.length>1&&o.push(c),o}const ab=tf.VectorTileFeature.types,ML=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],DL=["fill-extrusion-flood-light-ground-radius"],LL=Math.pow(2,13),OL=Math.pow(2,15)-1,QT=new De(0,1),wu=2147483648;function em(l,t,o,c,p,h,m,x){l.emplaceBack((t<<1)+m,(o<<1)+h,(Math.floor(c*LL)<<1)+p,Math.round(x))}function tm(l,t,o){l.emplaceBack(t.x*Ut,t.y*Ut,o?1:0)}function U_(l,t,o,c,p,h){l.emplaceBack(t.x,t.y,(o.x<<1)+c,(o.y<<1)+p,h)}function rm(l,t,o){l.emplaceBack(t.x,t.y,t.z,o[0]*16384,o[1]*16384,o[2]*16384)}class eE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class tE{constructor(){this.centroidXY=new De(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new De(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new De(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new De(this.max.x-this.min.x,this.max.y-this.min.y)}}class rE{constructor(){this.acc=new De(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,o){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=o.x,t.min.y=t.max.y=o.y)}appendEdge(t,o,c){this.accCount++,this.acc._add(o);let p=!!this.borders;o.x<t.min.x?(t.min.x=o.x,p=!0):o.x>t.max.x&&(t.max.x=o.x,p=!0),o.y<t.min.y?(t.min.y=o.y,p=!0):o.y>t.max.y&&(t.max.y=o.y,p=!0),((o.x===0||o.x===Ut)&&o.x===c.x)!=((o.y===0||o.y===Ut)&&o.y===c.y)&&this.processBorderOverlap(o,c),p&&this.checkBorderIntersection(o,c)}checkBorderIntersection(t,o){o.x<0!=t.x<0&&this.addBorderIntersection(0,xr(o.y,t.y,(0-o.x)/(t.x-o.x))),o.x>Ut!=t.x>Ut&&this.addBorderIntersection(1,xr(o.y,t.y,(Ut-o.x)/(t.x-o.x))),o.y<0!=t.y<0&&this.addBorderIntersection(2,xr(o.x,t.x,(0-o.y)/(t.y-o.y))),o.y>Ut!=t.y>Ut&&this.addBorderIntersection(3,xr(o.x,t.x,(Ut-o.y)/(t.y-o.y)))}addBorderIntersection(t,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];o<c[0]&&(c[0]=o),o>c[1]&&(c[1]=o)}processBorderOverlap(t,o){if(t.x===o.x){if(t.y===o.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,o.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,o.x),this.addBorderIntersection(c,t.x)}}centroid(){return this.accCount===0?new De(0,0):new De(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,o)=>t+ +(o[0]!==Number.MAX_VALUE),0):0}}function nE(l,t){const o=l.add(t)._unit(),c=Ft(l.x*o.x+l.y*o.y,-1,1);var p,h,m;return m=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(m)))/4*OL*((p=l).x*(h=t).y-p.y*h.x<0?-1:1)}const BL=[l=>l.x<0,l=>l.x>Ut,l=>l.y<0,l=>l.y>Ut];function zL(l,t,o,c){const p=[4];if(c===0)return p;o._mult(c);const h=l.sub(o),m=t.sub(o),x=[l,t,h,m];for(let A=0;A<4;A++)for(const R of x)if(BL[A](R)){p.push(A);break}return p}class iE{constructor(t){this.vertexArray=new qd,this.indexArray=new po,this.programConfigurations=new Zl(t.layers,{zoom:t.zoom,lut:t.lut},o=>DL.includes(o)),this._segments=new Ti,this.hiddenByLandmarkVertexArray=new Zd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ti}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,o,c,p=!1){const h=t.length;if(h>2){let m=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let A;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const R=t[0],y=t[1];A=nE(R.sub(t[h-1])._perp()._unit(),y.sub(R)._perp()._unit())}for(let R=0;R<h;R++){const y=R===h-1?0:R+1,T=t[R],C=t[y],E=t[y===h-1?0:y+1],S=C.sub(T)._perp()._unit(),P=nE(S,E.sub(C)._perp()._unit()),O=A,F=P;if(lb(T,C,o)||p&&aE(T,o)&&aE(C,o)){A=P;continue}const j=x.vertexLength;U_(this.vertexArray,T,C,1,1,O),U_(this.vertexArray,T,C,1,0,O),U_(this.vertexArray,T,C,0,1,F),U_(this.vertexArray,T,C,0,0,F),x.vertexLength+=4;const G=zL(T,C,S,c);for(const N of G)this._segmentToGroundQuads[m].push({id:j,region:N}),this._segmentToRegionTriCounts[m][N]+=2,x.primitiveLength+=2;A=P}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),o=t.length;for(let c=0;c<o;c++)this._segmentToGroundQuads[c].sort((p,h)=>p.region-h.region);for(let c=0;c<o;c++){const p=this._segmentToGroundQuads[c],h=t[c],m=this._segmentToRegionTriCounts[c];m.reduce((A,R)=>A+R,0);let x=0;for(let A=0;A<=4;A++){const R=m[A];if(R!==0){let y=this.regionSegments[A];y||(y=this.regionSegments[A]=new Ti);const T={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+x,vertexLength:h.vertexLength,primitiveLength:R};y.get().push(T)}x+=R}for(let A=0;A<p.length;A++){const R=p[A].id;this.indexArray.emplaceBack(R,R+1,R+3),this.indexArray.emplaceBack(R,R+3,R+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,o,c,p,h,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,o,c,p,h,m)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,IL.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,o,c,p,h,m){this.hasData()&&this.programConfigurations.updatePaintArrays(t,o,c,p,h,m)}updateHiddenByLandmark(t){if(!this.hasData())return;const o=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const c=t.flags&wu?1:0;for(let p=t.groundVertexArrayOffset;p<o;++p)this.hiddenByLandmarkVertexArray.emplace(p,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,CL.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const o=this.regionSegments[t];o&&o.destroy()}}}}class j_{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new po,this.footprintVertices=new ql,this.footprintSegments=[],this.layoutVertexArray=new Gl,this.centroidVertexArray=new T_,this.wallVertexArray=new $p,this.indexArray=new po,this.programConfigurations=new Zl(t.layers,{zoom:t.zoom,lut:t.lut},o=>ML.includes(o)),this.segments=new Ti,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new iE(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(t,o){}populate(t,o,c,p){this.features=[],this.hasPattern=Yv("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Re(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:m,index:x,sourceLayerIndex:A}of t){const R=this.layers[0]._featureFilter.needGeometry,y=Lt(h,R);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),y,c))continue;const T={id:m,sourceLayerIndex:A,index:x,geometry:R?y.geometry:Pt(h,c,p),properties:h.properties,type:h.type,patterns:{}},C=this.layoutVertexArray.length,E=ab[T.type]==="Polygon";if(this.hasPattern)this.features.push(Jv("fill-extrusion",this.layers,T,this.zoom,o));else if(this.wallMode)for(const S of T.geometry)for(const P of JT(S,E))this.addFeature(T,[P],x,c,{},o.availableImages,p,o.brightness);else this.addFeature(T,T.geometry,x,c,{},o.availableImages,p,o.brightness);o.featureIndex.insert(h,T.geometry,x,A,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,o,c,p,h,m){for(const x of this.features){const A=ab[x.type]==="Polygon",{geometry:R}=x;if(this.wallMode)for(const y of R)for(const T of JT(y,A))this.addFeature(x,[T],x.index,o,c,p,h,m);else this.addFeature(x,R,x.index,o,c,p,h,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,o,c,p,h){const m=Object.keys(t).length!==0;if(m&&!this.stateDependentLayers.length)return;const x=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,o,x,c,p,h),this.groundEffect.update(t,o,x,c,p,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,kL),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,SL.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,RL.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,AL.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,o,c,p,h,m,x,A){const R=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,y=[new De(0,0),new De(Ut,Ut)],T=x.projection,C=T.name==="globe",E=this.wallMode||ab[t.type]==="Polygon",S=new rE;S.centroidDataIndex=this.centroidData.length;const P=new tE,O=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},p)<=0,F=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},p);let j;if(P.height=F,P.vertexArrayOffset=this.layoutVertexArray.length,P.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Gd),this.wallMode){if(C)return void nn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;j=function(le){const xe=le[0].x===le[le.length-1].x&&le[0].y===le[le.length-1].y;(function(Mt){let Et=0;const yr=Mt.length;for(let Xt=0;Xt<yr;Xt++)Et+=(Mt[(Xt+1)%yr].x-Mt[Xt].x)*(Mt[(Xt+1)%yr].y+Mt[Xt].y);return Et>=0})(le)||(le=le.reverse());const Ee={geometry:[],joinNormals:[],indices:[]},Pe=[],Be=[],ze=[];let Ge=le.length;if(Ge<(xe?3:2))return Ee;for(;Ge>=2&&le[Ge-1].equals(le[Ge-2]);)Ge--;let rt,Ze,ft,xt,lt,Yt=0;for(;Yt<Ge-1&&le[Yt].equals(le[Yt+1]);)Yt++;xe&&(rt=le[Ge-2],lt=le[Yt].sub(rt)._unit()._perp());for(let Mt=Yt;Mt<Ge;Mt++){if(ft=Mt===Ge-1?xe?le[Yt+1]:void 0:le[Mt+1],ft&&le[Mt].equals(ft))continue;lt&&(xt=lt),rt&&(Ze=rt),rt=le[Mt],lt=ft?ft.sub(rt)._unit()._perp():xt,xt=xt||lt;let Et=xt.add(lt);Et.x===0&&Et.y===0||Et._unit();const yr=Et.x*lt.x+Et.y*lt.y,Xt=yr!==0?1/yr:1/0,tr=xt.x*lt.y-xt.y*lt.x>0;let Mr="miter";const $r=2;Mr==="miter"&&Xt>$r&&(Mr="bevel"),Mr==="bevel"&&(Xt>100&&(Mr="flipbevel"),Xt<$r&&(Mr="miter"));const Br=(zr,Zr,Yr,Fn)=>{const Rn=new De(zr.x,zr.y),Lr=new De(zr.x,zr.y);Rn.x+=Zr.x*Fn,Rn.y+=Zr.y*Fn,Lr.x-=Zr.x*Math.max(Yr,1),Lr.y-=Zr.y*Math.max(Yr,1),ze.push(Zr),Pe.push(Rn),Be.push(Lr)};if(Mr==="miter")Et._mult(Xt),Br(rt,Et,0,0);else if(Mr==="flipbevel")Et=lt.mult(-1),Br(rt,Et,0,0),Br(rt,Et.mult(-1),0,0);else{const zr=-Math.sqrt(Xt*Xt-1),Zr=tr?zr:0,Yr=tr?0:zr;Ze&&Br(rt,xt,Zr,Yr),ft&&Br(rt,lt,Zr,Yr)}}Ee.geometry=[...Pe,...Be.reverse(),Pe[0]],Ee.joinNormals=[...ze,...ze.reverse(),ze[ze.length-1]];const Vt=Ee.geometry.length-1;for(let Mt=0;Mt<Vt/2;Mt++)if(Mt+1<Vt/2){let Et=Mt,yr=Mt+1,Xt=Vt-1-Mt,tr=Vt-2-Mt;Et=Et===0?Vt-1:Et-1,yr=yr===0?Vt-1:yr-1,Xt=Xt===0?Vt-1:Xt-1,tr=tr===0?Vt-1:tr-1,Ee.indices.push(Xt),Ee.indices.push(yr),Ee.indices.push(Et),Ee.indices.push(Xt),Ee.indices.push(tr),Ee.indices.push(yr)}return Ee}(o[0]),o=[j.geometry]}const G=(le,xe)=>le<(xe.length-1)/2||le===xe.length-1,N=this.wallMode?[o]:B_(o,500);for(let le=N.length-1;le>=0;le--){const xe=N[le];(xe.length===0||(Z=xe[0]).every(me=>me.x<=0)||Z.every(me=>me.x>=Ut)||Z.every(me=>me.y<=0)||Z.every(me=>me.y>=Ut))&&N.splice(le,1)}var Z;let K;if(C)K=hE(N,y,p);else{K=[];for(const le of N)K.push({polygon:le,bounds:y})}const ie=E?this.edgeRadius:0,ue=ie>0&&this.zoom<17,de=(le,xe)=>{if(le.length===0)return!1;const me=le[le.length-1];return xe.x===me.x&&xe.y===me.y};for(const{polygon:le,bounds:xe}of K){let me=0,Ee=0;for(const Ge of le)E&&!Ge[0].equals(Ge[Ge.length-1])&&Ge.push(Ge[0]),Ee+=E?Ge.length-1:Ge.length;const Pe=this.segments.prepareSegment((E?5:4)*Ee,this.layoutVertexArray,this.indexArray);P.footprintSegIdx<0&&(P.footprintSegIdx=this.footprintSegments.length),P.polygonSegIdx<0&&(P.polygonSegIdx=this.polygonSegments.length);const Be={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ze=new eE;if(ze.vertexOffset=this.footprintVertices.length,ze.indexOffset=3*this.footprintIndices.length,ze.ringIndices=[],E){const Ge=[],rt=[];me=Pe.vertexLength;for(let ft=0;ft<le.length;ft++){const xt=le[ft];xt.length&&ft!==0&&rt.push(Ge.length/2);const lt=[];let Yt,Vt;Yt=xt[1].sub(xt[0])._perp()._unit(),ze.ringIndices.push(xt.length-1);for(let Mt=1;Mt<xt.length;Mt++){const Et=xt[Mt],yr=xt[Mt===xt.length-1?1:Mt+1],Xt=Et.clone();if(ie){Vt=yr.sub(Et)._perp()._unit();const tr=Yt.add(Vt)._unit(),Mr=ie*Math.min(4,1/(Yt.x*tr.x+Yt.y*tr.y));Xt.x+=Mr*tr.x,Xt.y+=Mr*tr.y,Xt.x=Math.round(Xt.x),Xt.y=Math.round(Xt.y),Yt=Vt}if(!O||ie!==0&&!ue||de(lt,Xt)||lt.push(Xt),em(this.layoutVertexArray,Xt.x,Xt.y,0,0,1,1,0),this.wallMode){const tr=G(Mt,xt);tm(this.wallVertexArray,j.joinNormals[Mt],!tr)}Pe.vertexLength++,this.footprintVertices.emplaceBack(Et.x,Et.y),Ge.push(Et.x,Et.y),C&&rm(this.layoutVertexExtArray,T.projectTilePoint(Xt.x,Xt.y,p),T.upVector(p,Xt.x,Xt.y))}O&&(ie===0||ue)&&(lt.length!==0&&de(lt,lt[0])&&lt.pop(),this.groundEffect.addData(lt,xe,R))}const Ze=this.wallMode?j.indices:Kp(Ge,rt);for(let ft=0;ft<Ze.length;ft+=3)this.footprintIndices.emplaceBack(ze.vertexOffset+Ze[ft+0],ze.vertexOffset+Ze[ft+1],ze.vertexOffset+Ze[ft+2]),this.indexArray.emplaceBack(me+Ze[ft],me+Ze[ft+2],me+Ze[ft+1]),Pe.primitiveLength++;ze.indexCount+=Ze.length,ze.vertexCount+=this.footprintVertices.length-ze.vertexOffset}for(let Ge=0;Ge<le.length;Ge++){const rt=le[Ge];S.startRing(P,rt[0]);let Ze=rt.length>4&&lE(rt[rt.length-2],rt[0],rt[1]),ft=ie?FL(rt[rt.length-2],rt[0],rt[1],ie):0;const xt=[];let lt,Yt,Vt;Yt=rt[1].sub(rt[0])._perp()._unit();let Mt=!0;for(let Et=1,yr=0;Et<rt.length;Et++){let Xt=rt[Et-1],tr=rt[Et];const Mr=rt[Et===rt.length-1?1:Et+1];if(S.appendEdge(P,tr,Xt),lb(tr,Xt,xe)){ie&&(Yt=Mr.sub(tr)._perp()._unit(),Mt=!Mt);continue}const $r=tr.sub(Xt)._perp(),Br=$r.x/(Math.abs($r.x)+Math.abs($r.y)),zr=$r.y>0?1:0,Zr=Xt.dist(tr);if(yr+Zr>32768&&(yr=0),ie){Vt=Mr.sub(tr)._perp()._unit();let Lr=sE(Xt,tr,Mr,oE(Yt,Vt),ie);isNaN(Lr)&&(Lr=0);const xn=tr.sub(Xt)._unit();Xt=Xt.add(xn.mult(ft))._round(),tr=tr.add(xn.mult(-Lr))._round(),ft=Lr,Yt=Vt,O&&this.zoom>=17&&(de(xt,Xt)||xt.push(Xt),de(xt,tr)||xt.push(tr))}const Yr=Pe.vertexLength,Fn=rt.length>4&&lE(Xt,tr,Mr);let Rn=cE(yr,Ze,Mt);if(em(this.layoutVertexArray,Xt.x,Xt.y,Br,zr,0,0,Rn),em(this.layoutVertexArray,Xt.x,Xt.y,Br,zr,0,1,Rn),this.wallMode){const Lr=G(Et-1,rt),xn=j.joinNormals[Et-1];tm(this.wallVertexArray,xn,Lr),tm(this.wallVertexArray,xn,Lr)}if(yr+=Zr,Rn=cE(yr,Fn,!Mt),Ze=Fn,em(this.layoutVertexArray,tr.x,tr.y,Br,zr,0,0,Rn),em(this.layoutVertexArray,tr.x,tr.y,Br,zr,0,1,Rn),this.wallMode){const Lr=G(Et,rt),xn=j.joinNormals[Et];tm(this.wallVertexArray,xn,Lr),tm(this.wallVertexArray,xn,Lr)}if(Pe.vertexLength+=4,this.indexArray.emplaceBack(Yr+0,Yr+1,Yr+2),this.indexArray.emplaceBack(Yr+1,Yr+3,Yr+2),Pe.primitiveLength+=2,ie){const Lr=me+(Et===1?rt.length-2:Et-2),xn=Et===1?me:Lr+1;if(this.indexArray.emplaceBack(Yr+1,Lr,Yr+3),this.indexArray.emplaceBack(Lr,xn,Yr+3),Pe.primitiveLength+=2,lt===void 0&&(lt=Yr),!lb(Mr,rt[Et],xe)){const En=Et===rt.length-1?lt:Pe.vertexLength;this.indexArray.emplaceBack(Yr+2,Yr+3,En),this.indexArray.emplaceBack(Yr+3,En+1,En),this.indexArray.emplaceBack(Yr+3,xn,En+1),Pe.primitiveLength+=3}Mt=!Mt}if(C){const Lr=this.layoutVertexExtArray,xn=T.projectTilePoint(Xt.x,Xt.y,p),En=T.projectTilePoint(tr.x,tr.y,p),Kn=T.upVector(p,Xt.x,Xt.y),Ri=T.upVector(p,tr.x,tr.y);rm(Lr,xn,Kn),rm(Lr,xn,Kn),rm(Lr,En,Ri),rm(Lr,En,Ri)}}E&&(me+=rt.length-1),O&&ie&&this.zoom>=17&&(xt.length!==0&&de(xt,xt[0])&&xt.pop(),this.groundEffect.addData(xt,xe,R,ie>0))}this.footprintSegments.push(ze),Be.triangleCount=this.indexArray.length-Be.triangleArrayOffset,this.polygonSegments.push(Be),++P.footprintSegLen,++P.polygonSegLen}if(P.vertexCount=this.layoutVertexArray.length-P.vertexArrayOffset,P.groundVertexCount=this.groundEffect.vertexArray.length-P.groundVertexArrayOffset,P.vertexCount!==0){if(P.centroidXY=S.borders?QT:this.encodeCentroid(S,P),this.centroidData.push(P),S.borders){this.featuresOnBorder.push(S);const le=this.featuresOnBorder.length-1;for(let xe=0;xe<S.borders.length;xe++)S.borders[xe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[xe].push(le)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,m,p,A),this.groundEffect.addPaintPropertiesData(t,c,h,m,p,A),this.maxHeight=Math.max(this.maxHeight,F)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((o,c)=>this.featuresOnBorder[o].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}splitToSubtiles(){const t=[];for(let x=0;x<this.centroidData.length;x++){const A=this.centroidData[x],R=+(A.min.y+A.max.y>Ut),y=2*R+(+(A.min.x+A.max.x>Ut)^R);for(let T=0;T<A.polygonSegLen;T++){const C=A.polygonSegIdx+T;t.push({centroidIdx:x,subtile:y,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}const o=new po;t.sort((x,A)=>x.triangleSegmentIdx===A.triangleSegmentIdx?x.subtile-A.subtile:x.triangleSegmentIdx-A.triangleSegmentIdx);let c=0,p=0,h=0;for(const x of t){if(x.triangleSegmentIdx!==c)break;h++}const m=t.length;for(;p!==t.length;){c=t[p].triangleSegmentIdx;let x=0,A=p,R=p;for(let y=A;y<h&&t[y].subtile===x;y++)R++;for(;A!==h;){const y=t[A];x=y.subtile;const T=this.centroidData[y.centroidIdx].min.clone(),C=this.centroidData[y.centroidIdx].max.clone(),E={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let S=A;S<R;S++){const P=t[S],O=this.polygonSegments[P.polygonSegmentIdx],F=this.centroidData[P.centroidIdx].min,j=this.centroidData[P.centroidIdx].max,G=this.indexArray.uint16;for(let N=O.triangleArrayOffset;N<O.triangleArrayOffset+O.triangleCount;N++)o.emplaceBack(G[3*N],G[3*N+1],G[3*N+2]);E.primitiveLength+=O.triangleCount,T.x=Math.min(T.x,F.x),T.y=Math.min(T.y,F.y),C.x=Math.max(C.x,j.x),C.y=Math.max(C.y,j.y)}E.primitiveLength>0&&this.triangleSubSegments.push({segment:E,min:T,max:C}),A=R;for(let S=A;S<h&&t[S].subtile===t[A].subtile;S++)R++}p=h;for(let y=p;y<m&&t[y].triangleSegmentIdx===t[p].triangleSegmentIdx;y++)h++}o._trim(),this.indexArray=o}getVisibleSegments(t,o,c){const p=new Ti;if(this.wallMode){for(const P of this.triangleSubSegments)p.segments.push(P.segment);return p}let h=0,m=0;const x=1<<t.canonical.z;if(o){const P=o.getMinMaxForTile(t);P&&(h=P.min,m=P.max)}m+=this.maxHeight;const A=t.toUnwrapped();let R;const y=[A.canonical.x/x+A.wrap,A.canonical.y/x],T=[(A.canonical.x+1)/x+A.wrap,(A.canonical.y+1)/x],C=(P,O,F)=>[P[0]*(1-F[0])+O[0]*F[0],P[1]*(1-F[1])+O[1]*F[1]],E=[],S=[];for(const P of this.triangleSubSegments){E[0]=P.min.x/Ut,E[1]=P.min.y/Ut,S[0]=P.max.x/Ut,S[1]=P.max.y/Ut;const O=C(y,T,E),F=C(y,T,S);if(new Gn([O[0],O[1],h],[F[0],F[1],m]).intersectsPrecise(c)===0){R&&(p.segments.push(R),R=void 0);continue}const j=P.segment;R&&R.vertexOffset!==j.vertexOffset&&(p.segments.push(R),R=void 0),R?(R.vertexLength+=j.vertexLength,R.primitiveLength+=j.primitiveLength):R={vertexOffset:j.vertexOffset,primitiveLength:j.primitiveLength,vertexLength:j.vertexLength,primitiveOffset:j.primitiveOffset,sortKey:void 0,vaos:{}}}return R&&p.segments.push(R),p}encodeCentroid(t,o){const c=t.centroid(),p=o.span(),h=Math.min(7,Math.round(p.x*this.tileToMeter/10)),m=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new De(Ft(c.x,1,Ut-1)<<3|h,Ft(c.y,1,Ut-1)<<3|m)}encodeBorderCentroid(t){if(!t.borders)return new De(0,0);const o=t.borders,c=Number.MAX_VALUE;if(o[0][0]!==c||o[1][0]!==c){const p=o[0][0]!==c?0:1;return new De(6|(o[0][0]!==c?0:65528),(o[p][0]+o[p][1])/2<<3|6)}{const p=o[2][0]!==c?2:3;return new De((o[p][0]+o[p][1])/2<<3|6,6|(o[2][0]!==c?0:65528))}}showCentroid(t){const o=this.centroidData[t.centroidDataIndex];o.flags&=wu,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const o=t.vertexArrayOffset,c=t.vertexCount+t.vertexArrayOffset,p=t.flags&wu?QT:t.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==p.y||h!==p.x){for(let m=o;m<c;++m)this.centroidVertexArray.emplace(m,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,o,c){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const p=o.getReplacementRegionsForTile(t.toUnwrapped());if(ob(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const h=[];for(const m of this.activeReplacements){if(m.order<c)continue;const x=Math.pow(2,m.footprintTileId.canonical.z-t.canonical.z);for(const A of this.centroidData)if(!(A.flags&wu||m.min.x>A.max.x||A.min.x>m.max.x||m.min.y>A.max.y||A.min.y>m.max.y))for(let R=0;R<A.footprintSegLen;R++){const y=this.footprintSegments[A.footprintSegIdx+R];if(h.length=0,NL(this.footprintVertices,y.vertexOffset,y.vertexCount,m.footprintTileId.canonical,t.canonical,h),ZT(m.footprint,h,this.footprintIndices.uint16,y.indexOffset,y.indexCount,-y.vertexOffset,-x)){A.flags|=wu;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,o,c){let p=!1;for(let h=0;h<c.footprintSegLen;h++){const m=this.footprintSegments[c.footprintSegIdx+h];let x=0;for(const A of m.ringIndices){for(let R=x,y=A+x-1;R<A+x;y=R++){const T=this.footprintVertices.int16[2*(R+m.vertexOffset)+0],C=this.footprintVertices.int16[2*(R+m.vertexOffset)+1],E=this.footprintVertices.int16[2*(y+m.vertexOffset)+1];C>o!=E>o&&t<(this.footprintVertices.int16[2*(y+m.vertexOffset)+0]-T)*(o-C)/(E-C)+T&&(p=!p)}x=A}}return p}getHeightAtTileCoord(t,o){let c=Number.NEGATIVE_INFINITY,p=!0;const h=4*(t+Ut)*Ut+(o+Ut);if(this.partLookup.hasOwnProperty(h)){const m=this.partLookup[h];return m?{height:m.height,hidden:!!(m.flags&wu)}:void 0}for(const m of this.centroidData)t>m.max.x||m.min.x>t||o>m.max.y||m.min.y>o||this.footprintContainsPoint(t,o,m)&&m&&m.height>c&&(c=m.height,this.partLookup[h]=m,p=!!(m.flags&wu));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:p};this.partLookup[h]=void 0}}function oE(l,t){const o=l.add(t)._unit();return l.x*o.x+l.y*o.y}function FL(l,t,o,c){const p=t.sub(l)._perp()._unit(),h=o.sub(t)._perp()._unit();return sE(l,t,o,oE(p,h),c)}function sE(l,t,o,c,p){const h=Math.sqrt(1-c*c);return Math.min(l.dist(t)/3,t.dist(o)/3,p*h/c)}function lb(l,t,o){return l.x<o[0].x&&t.x<o[0].x||l.x>o[1].x&&t.x>o[1].x||l.y<o[0].y&&t.y<o[0].y||l.y>o[1].y&&t.y>o[1].y}function aE(l,t){return l.x<t[0].x||l.x>t[1].x||l.y<t[0].y||l.y>t[1].y}function lE(l,t,o){if(l.x<0||l.x>=Ut||t.x<0||t.x>=Ut||o.x<0||o.x>=Ut)return!1;const c=o.sub(t),p=c.perp(),h=l.sub(t);return(c.x*h.x+c.y*h.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(h.x*h.x+h.y*h.y))>-.866&&p.x*h.x+p.y*h.y<0}function cE(l,t,o){const c=t?2|l:-3&l;return o?1|c:-2&c}function uE(){const l=Math.PI/32,t=Math.tan(l),o=V;return o*Math.sqrt(1+2*t*t)-o}function hE(l,t,o){const c=1<<o.z,p=ye(o.x/c),h=ye((o.x+1)/c),m=ge(o.y/c),x=ge((o.y+1)/c);return function(A,R,y,T,C=0,E){const S=[];if(!A.length||!y||!T)return S;const P=(K,ie)=>{for(const ue of K)S.push({polygon:ue,bounds:ie})},O=Math.ceil(Math.log2(y)),F=Math.ceil(Math.log2(T)),j=O-F,G=[];for(let K=0;K<Math.abs(j);K++)G.push(j>0?0:1);for(let K=0;K<Math.min(O,F);K++)G.push(0),G.push(1);let N=A;if(N=F_(N,R[0].y-C,R[1].y+C,1),N=F_(N,R[0].x-C,R[1].x+C,0),!N.length)return S;const Z=[];for(G.length?Z.push({polygons:N,bounds:R,depth:0}):P(N,R);Z.length;){const K=Z.pop(),ie=K.depth,ue=G[ie],de=K.bounds[0],le=K.bounds[1],xe=ue===0?de.x:de.y,me=ue===0?le.x:le.y,Ee=E?E(ue,xe,me):.5*(xe+me),Pe=F_(K.polygons,xe-C,Ee+C,ue),Be=F_(K.polygons,Ee-C,me+C,ue);if(Pe.length){const ze=[de,new De(ue===0?Ee:le.x,ue===1?Ee:le.y)];G.length>ie+1?Z.push({polygons:Pe,bounds:ze,depth:ie+1}):P(Pe,ze)}if(Be.length){const ze=[new De(ue===0?Ee:de.x,ue===1?Ee:de.y),le];G.length>ie+1?Z.push({polygons:Be,bounds:ze,depth:ie+1}):P(Be,ze)}}return S}(l,t,Math.ceil((h-p)/11.25),Math.ceil((m-x)/11.25),1,(A,R,y)=>{if(A===0)return .5*(R+y);{const T=ge((o.y+R/Ut)/c);return(pe(.5*(ge((o.y+y/Ut)/c)+T))*c-o.y)*Ut}})}function NL(l,t,o,c,p,h){const m=Math.pow(2,c.z-p.z);for(let x=0;x<o;x++){let A=l.int16[2*(x+t)+0],R=l.int16[2*(x+t)+1];A=(A+p.x*Ut)*m-c.x*Ut,R=(R+p.y*Ut)*m-c.y*Ut,h.push(new De(A,R))}}let dE,fE;function nm(l,t){return l.x*t.x+l.y*t.y}function pE(l,t){if(l.length===1){let o=0;const c=t[o++];let p;for(;!p||c.equals(p);)if(p=t[o++],!p)return 1/0;for(;o<t.length;o++){const h=t[o],m=l[0],x=p.sub(c),A=h.sub(c),R=m.sub(c),y=nm(x,x),T=nm(x,A),C=nm(A,A),E=nm(R,x),S=nm(R,A),P=y*C-T*T,O=(C*E-T*S)/P,F=(y*S-T*E)/P,j=c.z*(1-O-F)+p.z*O+h.z*F;if(isFinite(j))return j}return 1/0}{let o=1/0;for(const c of t)o=Math.min(o,c.z);return o}}function mE(l,t,o,c,p,h,m,x){const A=m*p.getElevationAt(l,t,!0,!0),R=h[0]!==0,y=R?h[1]===0?m*(h[0]/7-450):m*function(T,C,E){const S=Math.floor(C[0]/8),P=Math.floor(C[1]/8),O=10*(C[0]-8*S),F=10*(C[1]-8*P),j=T.getElevationAt(S,P,!0,!0),G=T.getMeterToDEM(E),N=Math.floor(.5*(O*G-1)),Z=Math.floor(.5*(F*G-1)),K=T.tileCoordToPixel(S,P),ie=2*N+1,ue=2*Z+1,de=function(Be,ze,Ge,rt,Ze){return[Be.getElevationAtPixel(ze,Ge,!0),Be.getElevationAtPixel(ze+Ze,Ge,!0),Be.getElevationAtPixel(ze,Ge+Ze,!0),Be.getElevationAtPixel(ze+rt,Ge+Ze,!0)]}(T,K.x-N,K.y-Z,ie,ue),le=Math.abs(de[0]-de[1]),xe=Math.abs(de[2]-de[3]),me=Math.abs(de[0]-de[2])+Math.abs(de[1]-de[3]),Ee=Math.min(.25,.5*G*(le+xe)/ie),Pe=Math.min(.25,.5*G*me/ue);return j+Math.max(Ee*O,Pe*F)}(p,h,x):A;return{base:A+(o===0)?-1:o,top:R?Math.max(y+c,A+o+2):A+c}}rr(j_,"FillExtrusionBucket",{omit:["layers","features"]}),rr(tE,"PartData"),rr(eE,"FootprintSegment"),rr(rE,"BorderCentroidData"),rr(iE,"GroundEffect");const VL=dn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),UL=dn([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:jL}=VL,$L=dn([{name:"a_packed",components:4,type:"Float32"}]),{members:qL}=$L,GL=dn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:HL}=GL;class gE{constructor(t,o){this.width=t,this.height=o,this.nextRow=0,this.image=new xu({width:t,height:o}),this.positions={},this.uploaded=!1}getDash(t,o){const c=this.getKey(t,o);return this.positions[c]}trim(){const t=this.width,o=this.height=Ii(this.nextRow);this.image.resize({width:t,height:o})}getKey(t,o){return t.join(",")+o}getDashRanges(t,o,c){const p=[];let h=t.length%2==1?-t[t.length-1]*c:0,m=t[0]*c,x=!0;p.push({left:h,right:m,isDash:x,zeroLength:t[0]===0});let A=t[0];for(let R=1;R<t.length;R++){x=!x;const y=t[R];h=A*c,A+=y,m=A*c,p.push({left:h,right:m,isDash:x,zeroLength:y===0})}return p}addRoundDash(t,o,c){const p=o/2;for(let h=-c;h<=c;h++){const m=this.width*(this.nextRow+c+h);let x=0,A=t[x];for(let R=0;R<this.width;R++){R/A.right>1&&(A=t[++x]);const y=Math.abs(R-A.left),T=Math.abs(R-A.right),C=Math.min(y,T);let E;const S=h/c*(p+1);if(A.isDash){const P=p-Math.abs(S);E=Math.sqrt(C*C+P*P)}else E=p-Math.sqrt(C*C+S*S);this.image.data[m+R]=Math.max(0,Math.min(255,E+128))}}}addRegularDash(t,o){for(let A=t.length-1;A>=0;--A){const R=t[A],y=t[A+1];R.zeroLength?t.splice(A,1):y&&y.isDash===R.isDash&&(y.left=R.left,t.splice(A,1))}const c=t[0],p=t[t.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const h=this.width*this.nextRow;let m=0,x=t[m];for(let A=0;A<this.width;A++){A/x.right>1&&(x=t[++m]);const R=Math.abs(A-x.left),y=Math.abs(A-x.right),T=Math.min(R,y);this.image.data[h+A]=Math.max(0,Math.min(255,(x.isDash?T:-T)+o+128))}}addDash(t,o){const c=this.getKey(t,o);if(this.positions[c])return this.positions[c];const p=o==="round",h=p?7:0,m=2*h+1;if(this.nextRow+m>this.height)return nn("LineAtlas out of space"),null;t.length===0&&t.push(1);let x=0;for(let y=0;y<t.length;y++)t[y]<0&&(nn("Negative value is found in line dasharray, replacing values with 0"),t[y]=0),x+=t[y];if(x!==0){const y=this.width/x,T=this.getDashRanges(t,this.width,y);p?this.addRoundDash(T,y,h):this.addRegularDash(T,o==="square"?.5*y:0)}const A=this.nextRow+h;this.nextRow+=m;const R={tl:[A,h],br:[x,0]};return this.positions[c]=R,R}}rr(gE,"LineAtlas");const WL=tf.VectorTileFeature.types,ZL=Math.cos(Math.PI/180*37.5),XL=Math.cos(Math.PI/180*5);class cb{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Dp,this.layoutVertexArray2=new hl,this.patternVertexArray=new Hl,this.indexArray=new po,this.programConfigurations=new Zl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Ti,this.maxLineLength=0,this.zOffsetVertexArray=new pu,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:Ut/64}updateFootprints(t,o){}populate(t,o,c,p){this.hasPattern=Yv("line",this.layers,o);const h=this.layers[0].layout.get("line-sort-key"),m=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!m.isConstant()||!!m.constantOr(0);const x=[];for(const{feature:T,id:C,index:E,sourceLayerIndex:S}of t){const P=this.layers[0]._featureFilter.needGeometry,O=Lt(T,P);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),O,c))continue;const F=h?h.evaluate(O,{},c):void 0,j={id:C,properties:T.properties,type:T.type,sourceLayerIndex:S,index:E,geometry:P?O.geometry:Pt(T,c,p),patterns:{},sortKey:F};x.push(j)}h&&x.sort((T,C)=>T.sortKey-C.sortKey);const{lineAtlas:A,featureIndex:R}=o,y=this.addConstantDashes(A);for(const T of x){const{geometry:C,index:E,sourceLayerIndex:S}=T;if(y&&this.addFeatureDashes(T,A),this.hasPattern){const P=Jv("line",this.layers,T,this.zoom,o);this.patternFeatures.push(P)}else this.addFeature(T,C,E,c,A.positions,o.availableImages,o.brightness);R.insert(t[E].feature,C,E,S,this.index)}}addConstantDashes(t){let o=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,h=c.layout.get("line-cap").value;if(p.kind!=="constant"||h.kind!=="constant")o=!0;else{const m=h.value,x=p.value;if(!x)continue;t.addDash(x,m)}}return o}addFeatureDashes(t,o){const c=this.zoom;for(const p of this.layers){const h=p.paint.get("line-dasharray").value,m=p.layout.get("line-cap").value;if(h.kind==="constant"&&m.kind==="constant")continue;let x,A;if(h.kind==="constant"){if(x=h.value,!x)continue}else x=h.evaluate({zoom:c},t);A=m.kind==="constant"?m.value:m.evaluate({zoom:c},t),o.addDash(x,A),t.patterns[p.id]=o.getKey(x,A)}}update(t,o,c,p,h){const m=Object.keys(t).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,o,m?this.stateDependentLayers:this.layers,c,p,h)}addFeatures(t,o,c,p,h,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,o,c,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,qL)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,HL)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,UL.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,jL),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,o,c,p,h,m,x){const A=this.layers[0].layout,R=A.get("line-join").evaluate(t,{}),y=A.get("line-cap").evaluate(t,{}),T=A.get("line-miter-limit"),C=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const E of o)this.addLine(E,t,p,R,y,T,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,m,p,x)}addLine(t,o,c,p,h,m,x){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const A={zoom:this.zoom,lineProgress:void 0},R=this.layers[0].layout,y=p==="none";if(this.patternJoinNone=this.hasPattern&&y,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<t.length-1;K++)this.totalDistance+=t[K].dist(t[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=WL[o.type]==="Polygon";let C=t.length;for(;C>=2&&t[C-1].equals(t[C-2]);)C--;let E=0;for(;E<C-1&&t[E].equals(t[E+1]);)E++;if(C<(T?3:2))return;p==="bevel"&&(m=1.05);const S=this.overscaling<=16?15*Ut/(512*this.overscaling):0,P=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let O,F,j,G,N,Z;this.e1=this.e2=-1,T&&(O=t[C-2],N=t[E].sub(O)._unit()._perp());for(let K=E;K<C;K++){if(j=K===C-1?T?t[E+1]:void 0:t[K+1],j&&t[K].equals(j))continue;if(N&&(G=N),O&&(F=O),O=t[K],this.hasZOffset){const ze=R.get("line-z-offset").value;if(ze.kind==="constant")Z=ze.value;else{if(this.lineClips){const Ge=this.totalDistance/(this.lineClips.end-this.lineClips.start);A.lineProgress=(Ge*this.lineClips.start+this.distance+(F?F.dist(O):0))/Ge}else nn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),A.lineProgress=0;Z=ze.evaluate(A,o)}Z=Z||0}N=j?j.sub(O)._unit()._perp():G,G=G||N;const ie=F&&j;let ue=ie?p:T||y?"butt":h;const de=G.x*N.x+G.y*N.y;if(y){const ze=function(Ge){if(Ge.patternJoinNone){const rt=Ge.segmentPoints.length/2,Ze=Ge.lineSoFar-Ge.segmentStart;for(let ft=0;ft<rt;++ft){const xt=Ge.segmentPoints[2*ft+1],lt=Math.round(Ge.segmentPoints[2*ft])+.5+.25*xt;Ge.patternVertexArray.emplaceBack(lt,Ze,Ge.segmentStart),Ge.patternVertexArray.emplaceBack(lt,Ze,Ge.segmentStart)}Ge.segmentPoints.length=0}Ge.e1=Ge.e2=-1};if(ie&&de<XL){this.updateDistance(F,O),this.addCurrentVertex(O,G,1,1,P,Z),ze(this),this.addCurrentVertex(O,N,-1,-1,P,Z);continue}if(F){if(!j){this.updateDistance(F,O),this.addCurrentVertex(O,G,1,1,P,Z),ze(this);continue}ue="miter"}}let le=G.add(N);le.x===0&&le.y===0||le._unit();const xe=le.x*N.x+le.y*N.y,me=xe!==0?1/xe:1/0,Ee=2*Math.sqrt(2-2*xe),Pe=xe<ZL&&F&&j,Be=G.x*N.y-G.y*N.x>0;if(Pe&&K>E){const ze=O.dist(F);if(ze>2*S){const Ge=O.sub(O.sub(F)._mult(S/ze)._round());this.updateDistance(F,Ge),this.addCurrentVertex(Ge,G,0,0,P,Z),F=Ge}}if(ie&&ue==="round"&&(me<x?ue="miter":me<=2&&(ue="fakeround")),ue==="miter"&&me>m&&(ue="bevel"),ue==="bevel"&&(me>2&&(ue="flipbevel"),me<m&&(ue="miter")),F&&this.updateDistance(F,O),ue==="miter")le._mult(me),this.addCurrentVertex(O,le,0,0,P,Z);else if(ue==="flipbevel"){if(me>100)le=N.mult(-1);else{const ze=me*G.add(N).mag()/G.sub(N).mag();le._perp()._mult(ze*(Be?-1:1))}this.addCurrentVertex(O,le,0,0,P,Z),this.addCurrentVertex(O,le.mult(-1),0,0,P,Z)}else if(ue==="bevel"||ue==="fakeround"){const ze=-Math.sqrt(me*me-1),Ge=Be?ze:0,rt=Be?0:ze;if(F&&this.addCurrentVertex(O,G,Ge,rt,P,Z),ue==="fakeround"){const Ze=Math.round(180*Ee/Math.PI/20);for(let ft=1;ft<Ze;ft++){let xt=ft/Ze;if(xt!==.5){const Yt=xt-.5;xt+=xt*Yt*(xt-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*Yt*Yt+(.848013+de*(.215638*de-1.06021)))}const lt=N.sub(G)._mult(xt)._add(G)._unit()._mult(Be?-1:1);this.addHalfVertex(O,lt.x,lt.y,!1,Be,0,P,Z)}}j&&this.addCurrentVertex(O,N,-Ge,-rt,P,Z)}else ue==="butt"?this.addCurrentVertex(O,le,0,0,P,Z):ue==="square"?(F||this.addCurrentVertex(O,le,-1,-1,P,Z),this.addCurrentVertex(O,le,0,0,P,Z),F&&this.addCurrentVertex(O,le,1,1,P,Z)):ue==="round"&&(F&&(this.addCurrentVertex(O,G,0,0,P,Z),this.addCurrentVertex(O,G,1,1,P,Z,!0)),j&&(this.addCurrentVertex(O,N,-1,-1,P,Z,!0),this.addCurrentVertex(O,N,0,0,P,Z)));if(Pe&&K<C-1){const ze=O.dist(j);if(ze>2*S){const Ge=O.add(j.sub(O)._mult(S/ze)._round());this.updateDistance(O,Ge),this.addCurrentVertex(Ge,N,0,0,P,Z),O=Ge}}}}addVerticesTo(t,o,c,p,h,m,x,A,R,y){const T=(o.w-t.w)/this.tessellationStep|0;if(T>1){this.lineSoFar=t.w;const C=(o.x-t.x)/T,E=(o.y-t.y)/T,S=(o.z-t.z)/T,P=(o.w-t.w)/T;for(let O=1;O<T;++O)t.x+=C,t.y+=E,t.z+=S,this.lineSoFar+=P,this.addHalfVertex(t,c,p,y,!1,x,R,t.z),this.addHalfVertex(t,h,m,y,!0,-A,R,t.z)}this.lineSoFar=o.w,this.addHalfVertex(o,c,p,y,!1,x,R,o.z),this.addHalfVertex(o,h,m,y,!0,-A,R,o.z)}addCurrentVertex(t,o,c,p,h,m,x=!1){const A=o.x+o.y*c,R=o.y-o.x*c,y=o.y*p-o.x,T=-o.y-o.x*p;if(m!=null){const E=Ut+10,S=m,P=new jT(t.x,t.y,S,this.lineSoFar),O=_E(t,-10,E),F=this.lineSoFar;if(this.currentVertex)if(O){const j=this.currentVertexIsOutside,G=this.currentVertex,N=new jT(t.x,t.y,S,this.lineSoFar);qT(G,N,-10,E),_E(N,-10,E)||(j&&(this.e1=this.e2=-1,this.lineSoFar=G.w,this.addHalfVertex(G,A,R,x,!1,c,h,G.z),this.addHalfVertex(G,y,T,x,!0,-p,h,G.z)),this.addVerticesTo(G,N,A,R,y,T,c,p,h,x))}else{const j=this.currentVertex;this.currentVertexIsOutside&&(qT(j,P,-10,E),this.e1=this.e2=-1,this.lineSoFar=j.w,this.addHalfVertex(j,A,R,x,!1,c,h,j.z),this.addHalfVertex(j,y,T,x,!0,-p,h,j.z)),this.addVerticesTo(j,P,A,R,y,T,c,p,h,x)}else O||(this.addHalfVertex(t,A,R,x,!1,c,h,m),this.addHalfVertex(t,y,T,x,!0,-p,h,m));this.currentVertex=P,this.currentVertexIsOutside=O,this.lineSoFar=F}else this.addHalfVertex(t,A,R,x,!1,c,h,m),this.addHalfVertex(t,y,T,x,!0,-p,h,m)}addHalfVertex({x:t,y:o},c,p,h,m,x,A,R){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((t<<1)+(h?1:0),(o<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const y=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,y),A.primitiveLength++),m?this.e2=y:this.e1=y,R!=null&&this.zOffsetVertexArray.emplaceBack(R)}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,o){this.distance+=t.dist(o),this.updateScaledDistance()}}function _E(l,t,o){return l.x<t||l.x>o||l.y<t||l.y>o}let yE,vE;function bE(l,t,o){return t*(Ut/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}function xE(l,t){return 1/bE(l,1,t.tileZoom)}function wE(l,t,o,c){return l.translatePosMatrix(c||t.tileID.projMatrix,t,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}rr(cb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const TE=l=>{const t=[];EE(l)&&t.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const o=l.paint.get("line-trim-offset");o[0]===0&&o[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const c=l.layout.get("line-join").constantOr("miter")==="none",p=!!l.paint.get("line-pattern").constantOr(1);return c&&p&&t.push("LINE_JOIN_NONE"),t};function EE(l){const t=l.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let ub;const IE=()=>ub||(ub={layout:yE||(yE=new si({"line-cap":new pr(tt.layout_line["line-cap"]),"line-join":new pr(tt.layout_line["line-join"]),"line-miter-limit":new Ot(tt.layout_line["line-miter-limit"]),"line-round-limit":new Ot(tt.layout_line["line-round-limit"]),"line-sort-key":new pr(tt.layout_line["line-sort-key"]),"line-z-offset":new pr(tt.layout_line["line-z-offset"]),visibility:new Ot(tt.layout_line.visibility)})),paint:vE||(vE=new si({"line-opacity":new pr(tt.paint_line["line-opacity"]),"line-color":new pr(tt.paint_line["line-color"]),"line-translate":new Ot(tt.paint_line["line-translate"]),"line-translate-anchor":new Ot(tt.paint_line["line-translate-anchor"]),"line-width":new pr(tt.paint_line["line-width"]),"line-gap-width":new pr(tt.paint_line["line-gap-width"]),"line-offset":new pr(tt.paint_line["line-offset"]),"line-blur":new pr(tt.paint_line["line-blur"]),"line-dasharray":new pr(tt.paint_line["line-dasharray"]),"line-pattern":new pr(tt.paint_line["line-pattern"]),"line-gradient":new wa(tt.paint_line["line-gradient"]),"line-trim-offset":new Ot(tt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ot(tt.paint_line["line-trim-fade-range"]),"line-trim-color":new Ot(tt.paint_line["line-trim-color"]),"line-emissive-strength":new Ot(tt.paint_line["line-emissive-strength"]),"line-border-width":new pr(tt.paint_line["line-border-width"]),"line-border-color":new pr(tt.paint_line["line-border-color"]),"line-occlusion-opacity":new Ot(tt.paint_line["line-occlusion-opacity"])}))},ub);class KL extends pr{possiblyEvaluate(t,o){return o=new wi(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(t,o)}evaluate(t,o,c,p){return o=Xr({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(t,o,c,p)}}let im;function AE(l,t){return t>0?t+2*l:l}const YL=dn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),JL=dn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),QL=dn([{name:"a_projected_pos",components:4,type:"Float32"}],4);dn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eO=dn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),tO=dn([{name:"a_texb",components:2,type:"Uint16"}]),rO=dn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),nO=dn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const SE=dn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),iO=dn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);dn([{name:"triangle",components:3,type:"Uint16"}]),dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),dn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),dn([{type:"Float32",name:"offsetX"}]),dn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Eo=24;const gl=128;function hb(l,t){const{expression:o}=t;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new wi(l+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=o;let h=0;for(;h<c.length&&c[h]<=l;)h++;h=Math.max(0,h-1);let m=h;for(;m<c.length&&c[m]<l+1;)m++;m=Math.min(c.length-1,m);const x=c[h],A=c[m];return o.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:A,interpolationType:p}:{kind:"camera",minZoom:x,maxZoom:A,minSize:o.evaluate(new wi(x)),maxSize:o.evaluate(new wi(A)),interpolationType:p}}}function $_(l,{uSize:t,uSizeT:o},{lowerSize:c,upperSize:p}){return l.kind==="source"?c/gl:l.kind==="composite"?xr(c/gl,p/gl,o):t}function rf(l,t){let o=0,c=0;if(l.kind==="constant")c=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:p,minZoom:h,maxZoom:m}=l,x=p?Ft(ks.interpolationFactor(p,t,h,m),0,1):0;l.kind==="camera"?c=xr(l.minSize,l.maxSize,x):o=x}return{uSizeT:o,uSize:c}}var oO=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:gl,evaluateSizeForFeature:$_,evaluateSizeForZoom:rf,getSizeData:hb});function sO(l,t,o){return l.sections.forEach(c=>{c.text=function(p,h,m){const x=h.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?p=p.toLocaleUpperCase():x==="lowercase"&&(p=p.toLocaleLowerCase()),gs.applyArabicShaping&&(p=gs.applyArabicShaping(p)),p}(c.text,t,o)}),l}const om={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function aO(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}function lO(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}var CE,db,RE,fb={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function cO(){return CE||(CE=1,fb.read=function(l,t,o,c,p){var h,m,x=8*p-c-1,A=(1<<x)-1,R=A>>1,y=-7,T=o?p-1:0,C=o?-1:1,E=l[t+T];for(T+=C,h=E&(1<<-y)-1,E>>=-y,y+=x;y>0;h=256*h+l[t+T],T+=C,y-=8);for(m=h&(1<<-y)-1,h>>=-y,y+=c;y>0;m=256*m+l[t+T],T+=C,y-=8);if(h===0)h=1-R;else{if(h===A)return m?NaN:1/0*(E?-1:1);m+=Math.pow(2,c),h-=R}return(E?-1:1)*m*Math.pow(2,h-c)},fb.write=function(l,t,o,c,p,h){var m,x,A,R=8*h-p-1,y=(1<<R)-1,T=y>>1,C=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=c?0:h-1,S=c?1:-1,P=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,m=y):(m=Math.floor(Math.log(t)/Math.LN2),t*(A=Math.pow(2,-m))<1&&(m--,A*=2),(t+=m+T>=1?C/A:C*Math.pow(2,1-T))*A>=2&&(m++,A/=2),m+T>=y?(x=0,m=y):m+T>=1?(x=(t*A-1)*Math.pow(2,p),m+=T):(x=t*Math.pow(2,T-1)*Math.pow(2,p),m=0));p>=8;l[o+E]=255&x,E+=S,x/=256,p-=8);for(m=m<<p|x,R+=p;R>0;l[o+E]=255&m,E+=S,m/=256,R-=8);l[o+E-S]|=128*P}),fb}function kE(){if(RE)return db;RE=1,db=t;var l=cO();function t(N){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(N)?N:new Uint8Array(N||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var o=4294967296,c=1/o,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(N){return N.type===t.Bytes?N.readVarint()+N.pos:N.pos+1}function m(N,Z,K){return K?4294967296*Z+(N>>>0):4294967296*(Z>>>0)+(N>>>0)}function x(N,Z,K){var ie=Z<=16383?1:Z<=2097151?2:Z<=268435455?3:Math.floor(Math.log(Z)/(7*Math.LN2));K.realloc(ie);for(var ue=K.pos-1;ue>=N;ue--)K.buf[ue+ie]=K.buf[ue]}function A(N,Z){for(var K=0;K<N.length;K++)Z.writeVarint(N[K])}function R(N,Z){for(var K=0;K<N.length;K++)Z.writeSVarint(N[K])}function y(N,Z){for(var K=0;K<N.length;K++)Z.writeFloat(N[K])}function T(N,Z){for(var K=0;K<N.length;K++)Z.writeDouble(N[K])}function C(N,Z){for(var K=0;K<N.length;K++)Z.writeBoolean(N[K])}function E(N,Z){for(var K=0;K<N.length;K++)Z.writeFixed32(N[K])}function S(N,Z){for(var K=0;K<N.length;K++)Z.writeSFixed32(N[K])}function P(N,Z){for(var K=0;K<N.length;K++)Z.writeFixed64(N[K])}function O(N,Z){for(var K=0;K<N.length;K++)Z.writeSFixed64(N[K])}function F(N,Z){return(N[Z]|N[Z+1]<<8|N[Z+2]<<16)+16777216*N[Z+3]}function j(N,Z,K){N[K]=Z,N[K+1]=Z>>>8,N[K+2]=Z>>>16,N[K+3]=Z>>>24}function G(N,Z){return(N[Z]|N[Z+1]<<8|N[Z+2]<<16)+(N[Z+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(N,Z,K){for(K=K||this.length;this.pos<K;){var ie=this.readVarint(),ue=ie>>3,de=this.pos;this.type=7&ie,N(ue,Z,this),this.pos===de&&this.skip(ie)}return Z},readMessage:function(N,Z){return this.readFields(N,Z,this.readVarint()+this.pos)},readFixed32:function(){var N=F(this.buf,this.pos);return this.pos+=4,N},readSFixed32:function(){var N=G(this.buf,this.pos);return this.pos+=4,N},readFixed64:function(){var N=F(this.buf,this.pos)+F(this.buf,this.pos+4)*o;return this.pos+=8,N},readSFixed64:function(){var N=F(this.buf,this.pos)+G(this.buf,this.pos+4)*o;return this.pos+=8,N},readFloat:function(){var N=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,N},readDouble:function(){var N=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,N},readVarint:function(N){var Z,K,ie=this.buf;return Z=127&(K=ie[this.pos++]),K<128?Z:(Z|=(127&(K=ie[this.pos++]))<<7,K<128?Z:(Z|=(127&(K=ie[this.pos++]))<<14,K<128?Z:(Z|=(127&(K=ie[this.pos++]))<<21,K<128?Z:function(ue,de,le){var xe,me,Ee=le.buf;if(xe=(112&(me=Ee[le.pos++]))>>4,me<128||(xe|=(127&(me=Ee[le.pos++]))<<3,me<128)||(xe|=(127&(me=Ee[le.pos++]))<<10,me<128)||(xe|=(127&(me=Ee[le.pos++]))<<17,me<128)||(xe|=(127&(me=Ee[le.pos++]))<<24,me<128)||(xe|=(1&(me=Ee[le.pos++]))<<31,me<128))return m(ue,xe,de);throw new Error("Expected varint not more than 10 bytes")}(Z|=(15&(K=ie[this.pos]))<<28,N,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var N=this.readVarint();return N%2==1?(N+1)/-2:N/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var N=this.readVarint()+this.pos,Z=this.pos;return this.pos=N,N-Z>=12&&p?function(K,ie,ue){return p.decode(K.subarray(ie,ue))}(this.buf,Z,N):function(K,ie,ue){for(var de="",le=ie;le<ue;){var xe,me,Ee,Pe=K[le],Be=null,ze=Pe>239?4:Pe>223?3:Pe>191?2:1;if(le+ze>ue)break;ze===1?Pe<128&&(Be=Pe):ze===2?(192&(xe=K[le+1]))==128&&(Be=(31&Pe)<<6|63&xe)<=127&&(Be=null):ze===3?(me=K[le+2],(192&(xe=K[le+1]))==128&&(192&me)==128&&((Be=(15&Pe)<<12|(63&xe)<<6|63&me)<=2047||Be>=55296&&Be<=57343)&&(Be=null)):ze===4&&(me=K[le+2],Ee=K[le+3],(192&(xe=K[le+1]))==128&&(192&me)==128&&(192&Ee)==128&&((Be=(15&Pe)<<18|(63&xe)<<12|(63&me)<<6|63&Ee)<=65535||Be>=1114112)&&(Be=null)),Be===null?(Be=65533,ze=1):Be>65535&&(Be-=65536,de+=String.fromCharCode(Be>>>10&1023|55296),Be=56320|1023&Be),de+=String.fromCharCode(Be),le+=ze}return de}(this.buf,Z,N)},readBytes:function(){var N=this.readVarint()+this.pos,Z=this.buf.subarray(this.pos,N);return this.pos=N,Z},readPackedVarint:function(N,Z){if(this.type!==t.Bytes)return N.push(this.readVarint(Z));var K=h(this);for(N=N||[];this.pos<K;)N.push(this.readVarint(Z));return N},readPackedSVarint:function(N){if(this.type!==t.Bytes)return N.push(this.readSVarint());var Z=h(this);for(N=N||[];this.pos<Z;)N.push(this.readSVarint());return N},readPackedBoolean:function(N){if(this.type!==t.Bytes)return N.push(this.readBoolean());var Z=h(this);for(N=N||[];this.pos<Z;)N.push(this.readBoolean());return N},readPackedFloat:function(N){if(this.type!==t.Bytes)return N.push(this.readFloat());var Z=h(this);for(N=N||[];this.pos<Z;)N.push(this.readFloat());return N},readPackedDouble:function(N){if(this.type!==t.Bytes)return N.push(this.readDouble());var Z=h(this);for(N=N||[];this.pos<Z;)N.push(this.readDouble());return N},readPackedFixed32:function(N){if(this.type!==t.Bytes)return N.push(this.readFixed32());var Z=h(this);for(N=N||[];this.pos<Z;)N.push(this.readFixed32());return N},readPackedSFixed32:function(N){if(this.type!==t.Bytes)return N.push(this.readSFixed32());var Z=h(this);for(N=N||[];this.pos<Z;)N.push(this.readSFixed32());return N},readPackedFixed64:function(N){if(this.type!==t.Bytes)return N.push(this.readFixed64());var Z=h(this);for(N=N||[];this.pos<Z;)N.push(this.readFixed64());return N},readPackedSFixed64:function(N){if(this.type!==t.Bytes)return N.push(this.readSFixed64());var Z=h(this);for(N=N||[];this.pos<Z;)N.push(this.readSFixed64());return N},skip:function(N){var Z=7&N;if(Z===t.Varint)for(;this.buf[this.pos++]>127;);else if(Z===t.Bytes)this.pos=this.readVarint()+this.pos;else if(Z===t.Fixed32)this.pos+=4;else{if(Z!==t.Fixed64)throw new Error("Unimplemented type: "+Z);this.pos+=8}},writeTag:function(N,Z){this.writeVarint(N<<3|Z)},realloc:function(N){for(var Z=this.length||16;Z<this.pos+N;)Z*=2;if(Z!==this.length){var K=new Uint8Array(Z);K.set(this.buf),this.buf=K,this.length=Z}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(N){this.realloc(4),j(this.buf,N,this.pos),this.pos+=4},writeSFixed32:function(N){this.realloc(4),j(this.buf,N,this.pos),this.pos+=4},writeFixed64:function(N){this.realloc(8),j(this.buf,-1&N,this.pos),j(this.buf,Math.floor(N*c),this.pos+4),this.pos+=8},writeSFixed64:function(N){this.realloc(8),j(this.buf,-1&N,this.pos),j(this.buf,Math.floor(N*c),this.pos+4),this.pos+=8},writeVarint:function(N){(N=+N||0)>268435455||N<0?function(Z,K){var ie,ue;if(Z>=0?(ie=Z%4294967296|0,ue=Z/4294967296|0):(ue=~(-Z/4294967296),4294967295^(ie=~(-Z%4294967296))?ie=ie+1|0:(ie=0,ue=ue+1|0)),Z>=18446744073709552e3||Z<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");K.realloc(10),function(de,le,xe){xe.buf[xe.pos++]=127&de|128,de>>>=7,xe.buf[xe.pos++]=127&de|128,de>>>=7,xe.buf[xe.pos++]=127&de|128,de>>>=7,xe.buf[xe.pos++]=127&de|128,xe.buf[xe.pos]=127&(de>>>=7)}(ie,0,K),function(de,le){var xe=(7&de)<<4;le.buf[le.pos++]|=xe|((de>>>=3)?128:0),de&&(le.buf[le.pos++]=127&de|((de>>>=7)?128:0),de&&(le.buf[le.pos++]=127&de|((de>>>=7)?128:0),de&&(le.buf[le.pos++]=127&de|((de>>>=7)?128:0),de&&(le.buf[le.pos++]=127&de|((de>>>=7)?128:0),de&&(le.buf[le.pos++]=127&de)))))}(ue,K)}(N,this):(this.realloc(4),this.buf[this.pos++]=127&N|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=N>>>7&127))))},writeSVarint:function(N){this.writeVarint(N<0?2*-N-1:2*N)},writeBoolean:function(N){this.writeVarint(!!N)},writeString:function(N){N=String(N),this.realloc(4*N.length),this.pos++;var Z=this.pos;this.pos=function(ie,ue,de){for(var le,xe,me=0;me<ue.length;me++){if((le=ue.charCodeAt(me))>55295&&le<57344){if(!xe){le>56319||me+1===ue.length?(ie[de++]=239,ie[de++]=191,ie[de++]=189):xe=le;continue}if(le<56320){ie[de++]=239,ie[de++]=191,ie[de++]=189,xe=le;continue}le=xe-55296<<10|le-56320|65536,xe=null}else xe&&(ie[de++]=239,ie[de++]=191,ie[de++]=189,xe=null);le<128?ie[de++]=le:(le<2048?ie[de++]=le>>6|192:(le<65536?ie[de++]=le>>12|224:(ie[de++]=le>>18|240,ie[de++]=le>>12&63|128),ie[de++]=le>>6&63|128),ie[de++]=63&le|128)}return de}(this.buf,N,this.pos);var K=this.pos-Z;K>=128&&x(Z,K,this),this.pos=Z-1,this.writeVarint(K),this.pos+=K},writeFloat:function(N){this.realloc(4),l.write(this.buf,N,this.pos,!0,23,4),this.pos+=4},writeDouble:function(N){this.realloc(8),l.write(this.buf,N,this.pos,!0,52,8),this.pos+=8},writeBytes:function(N){var Z=N.length;this.writeVarint(Z),this.realloc(Z);for(var K=0;K<Z;K++)this.buf[this.pos++]=N[K]},writeRawMessage:function(N,Z){this.pos++;var K=this.pos;N(Z,this);var ie=this.pos-K;ie>=128&&x(K,ie,this),this.pos=K-1,this.writeVarint(ie),this.pos+=ie},writeMessage:function(N,Z,K){this.writeTag(N,t.Bytes),this.writeRawMessage(Z,K)},writePackedVarint:function(N,Z){Z.length&&this.writeMessage(N,A,Z)},writePackedSVarint:function(N,Z){Z.length&&this.writeMessage(N,R,Z)},writePackedBoolean:function(N,Z){Z.length&&this.writeMessage(N,C,Z)},writePackedFloat:function(N,Z){Z.length&&this.writeMessage(N,y,Z)},writePackedDouble:function(N,Z){Z.length&&this.writeMessage(N,T,Z)},writePackedFixed32:function(N,Z){Z.length&&this.writeMessage(N,E,Z)},writePackedSFixed32:function(N,Z){Z.length&&this.writeMessage(N,S,Z)},writePackedFixed64:function(N,Z){Z.length&&this.writeMessage(N,P,Z)},writePackedSFixed64:function(N,Z){Z.length&&this.writeMessage(N,O,Z)},writeBytesField:function(N,Z){this.writeTag(N,t.Bytes),this.writeBytes(Z)},writeFixed32Field:function(N,Z){this.writeTag(N,t.Fixed32),this.writeFixed32(Z)},writeSFixed32Field:function(N,Z){this.writeTag(N,t.Fixed32),this.writeSFixed32(Z)},writeFixed64Field:function(N,Z){this.writeTag(N,t.Fixed64),this.writeFixed64(Z)},writeSFixed64Field:function(N,Z){this.writeTag(N,t.Fixed64),this.writeSFixed64(Z)},writeVarintField:function(N,Z){this.writeTag(N,t.Varint),this.writeVarint(Z)},writeSVarintField:function(N,Z){this.writeTag(N,t.Varint),this.writeSVarint(Z)},writeStringField:function(N,Z){this.writeTag(N,t.Bytes),this.writeString(Z)},writeFloatField:function(N,Z){this.writeTag(N,t.Fixed32),this.writeFloat(Z)},writeDoubleField:function(N,Z){this.writeTag(N,t.Fixed64),this.writeDouble(Z)},writeBooleanField:function(N,Z){this.writeVarintField(N,!!Z)}},db}var q_=$(kE());const pb=3;function uO(l,t,o){t.glyphs=[],l===1&&o.readMessage(hO,t)}function hO(l,t,o){if(l===3){const{id:c,bitmap:p,width:h,height:m,left:x,top:A,advance:R}=o.readMessage(dO,{});t.glyphs.push({id:c,bitmap:new xu({width:h+2*pb,height:m+2*pb},p),metrics:{width:h,height:m,left:x,top:A,advance:R}})}else l===4?t.ascender=o.readSVarint():l===5&&(t.descender=o.readSVarint())}function dO(l,t,o){l===1?t.id=o.readVarint():l===2?t.bitmap=o.readBytes():l===3?t.width=o.readVarint():l===4?t.height=o.readVarint():l===5?t.left=o.readSVarint():l===6?t.top=o.readSVarint():l===7&&(t.advance=o.readVarint())}const PE=pb,Ia={horizontal:1,vertical:2,horizontalOnly:3};class sm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,o){const c=new sm;return c.scale=t||1,c.fontStack=o,c}static forImage(t){const o=new sm;return o.imageName=t,o}}class nf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,o){const c=new nf;for(let p=0;p<t.sections.length;p++){const h=t.sections[p];h.image?c.addImageSection(h):c.addTextSection(h,o)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(o,c){let p="";for(let h=0;h<o.length;h++){const m=o.charCodeAt(h+1)||null,x=o.charCodeAt(h-1)||null;p+=!c&&(m&&bh(m)&&!om[o[h+1]]||x&&bh(x)&&!om[o[h-1]])||!om[o[h]]?o[h]:om[o[h]]}return p}(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&G_[this.text.charCodeAt(c)];c++)t++;let o=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&G_[this.text.charCodeAt(c)];c--)o--;this.text=this.text.substring(t,o),this.sectionIndex=this.sectionIndex.slice(t,o)}substring(t,o){const c=new nf;return c.text=this.text.substring(t,o),c.sectionIndex=this.sectionIndex.slice(t,o),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,o)=>Math.max(t,this.sections[o].scale),0)}addTextSection(t,o){this.text+=t.text,this.sections.push(sm.forText(t.scale,t.fontStack||o));const c=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(c)}addImageSection(t){const o=t.image?t.image.namePrimary:"";if(o.length===0)return void nn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(sm.forImage(o)),this.sectionIndex.push(this.sections.length-1)):nn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function mb(l,t,o,c,p,h,m,x,A,R,y,T,C,E,S){const P=nf.fromFeature(l,p);T===Ia.vertical&&P.verticalizePunctuation(C);let O=[];const F=function(K,ie,ue,de,le,xe){if(!K)return[];const me=[],Ee=function(Ge,rt,Ze,ft,xt,lt){let Yt=0;for(let Vt=0;Vt<Ge.length();Vt++){const Mt=Ge.getSection(Vt);Yt+=ME(Ge.getCodePoint(Vt),Mt,ft,xt,rt,lt)}return Yt/Math.max(1,Math.ceil(Yt/Ze))}(K,ie,ue,de,le,xe),Pe=K.text.indexOf("")>=0;let Be=0;for(let Ge=0;Ge<K.length();Ge++){const rt=K.getSection(Ge),Ze=K.getCodePoint(Ge);if(G_[Ze]||(Be+=ME(Ze,rt,de,le,ie,xe)),Ge<K.length()-1){const ft=!((ze=Ze)<11904||!(hr["Bopomofo Extended"](ze)||hr.Bopomofo(ze)||hr["CJK Compatibility Forms"](ze)||hr["CJK Compatibility Ideographs"](ze)||hr["CJK Compatibility"](ze)||hr["CJK Radicals Supplement"](ze)||hr["CJK Strokes"](ze)||hr["CJK Symbols and Punctuation"](ze)||hr["CJK Unified Ideographs Extension A"](ze)||hr["CJK Unified Ideographs"](ze)||hr["Enclosed CJK Letters and Months"](ze)||hr["Halfwidth and Fullwidth Forms"](ze)||hr.Hiragana(ze)||hr["Ideographic Description Characters"](ze)||hr["Kangxi Radicals"](ze)||hr["Katakana Phonetic Extensions"](ze)||hr.Katakana(ze)||hr["Vertical Forms"](ze)||hr["Yi Radicals"](ze)||hr["Yi Syllables"](ze)));(fO[Ze]||ft||rt.imageName)&&me.push(LE(Ge+1,Be,Ee,me,pO(Ze,K.getCodePoint(Ge+1),ft&&Pe),!1))}}var ze;return OE(LE(K.length(),Be,Ee,me,0,!0))}(P,R,h,t,c,E),{processBidirectionalText:j,processStyledBidirectionalText:G}=gs;if(j&&P.sections.length===1){const K=j(P.toString(),F);for(const ie of K){const ue=new nf;ue.text=ie,ue.sections=P.sections;for(let de=0;de<ie.length;de++)ue.sectionIndex.push(0);O.push(ue)}}else if(G){const K=G(P.text,P.sectionIndex,F);for(const ie of K){const ue=new nf;ue.text=ie[0],ue.sectionIndex=ie[1],ue.sections=P.sections,O.push(ue)}}else O=function(K,ie){const ue=[],de=K.text;let le=0;for(const xe of ie)ue.push(K.substring(le,xe)),le=xe;return le<de.length&&ue.push(K.substring(le,de.length)),ue}(P,F);const N=[],Z={positionedLines:N,text:P.toString(),top:y[1],bottom:y[1],left:y[0],right:y[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(K,ie,ue,de,le,xe,me,Ee,Pe,Be,ze,Ge){let rt=0,Ze=0,ft=0;const xt=Ee==="right"?1:Ee==="left"?0:.5;let lt=!1;for(const Xt of le){const tr=Xt.getSections();for(const Mr of tr){if(Mr.imageName)continue;const $r=ie[Mr.fontStack];if($r&&(lt=$r.ascender!==void 0&&$r.descender!==void 0,!lt))break}if(!lt)break}let Yt=0;for(const Xt of le){Xt.trim();const tr=Xt.getMaxScale(),Mr=(tr-1)*Eo,$r={positionedGlyphs:[],lineOffset:0};K.positionedLines[Yt]=$r;const Br=$r.positionedGlyphs;let zr=0;if(!Xt.length()){Ze+=xe,++Yt;continue}let Zr=0,Yr=0;for(let Rn=0;Rn<Xt.length();Rn++){const Lr=Xt.getSection(Rn),xn=Xt.getSectionIndex(Rn),En=Xt.getCodePoint(Rn);let Kn=Lr.scale,Ri=null,Vi=null,ki=null,vi=Eo,ao=0;const Hi=!(Pe===Ia.horizontal||!ze&&!Bd(En)||ze&&(G_[En]||(Vt=En,hr.Arabic(Vt)||hr["Arabic Supplement"](Vt)||hr["Arabic Extended-A"](Vt)||hr["Arabic Presentation Forms-A"](Vt)||hr["Arabic Presentation Forms-B"](Vt))));if(Lr.imageName){const Io=de[Lr.imageName];if(!Io)continue;ki=Lr.imageName,K.iconsInText=K.iconsInText||!0,Vi=Io.paddedRect;const Hn=Io.displaySize;Kn=Kn*Eo/Ge,Ri={width:Hn[0],height:Hn[1],left:0,top:-PE,advance:Hi?Hn[1]:Hn[0],localGlyph:!1},ao=lt?-Ri.height*Kn:tr*Eo-17-Hn[1]*Kn,vi=Ri.advance;const Ds=(Hi?Hn[0]:Hn[1])*Kn-Eo*tr;Ds>0&&Ds>zr&&(zr=Ds)}else{const Io=ue[Lr.fontStack];if(!Io)continue;Io[En]&&(Vi=Io[En]);const Hn=ie[Lr.fontStack];if(!Hn)continue;const Ds=Hn.glyphs[En];if(!Ds)continue;if(Ri=Ds.metrics,vi=En!==8203?Eo:0,lt){const xl=Hn.ascender!==void 0?Math.abs(Hn.ascender):0,tl=Hn.descender!==void 0?Math.abs(Hn.descender):0,rl=(xl+tl)*Kn;Zr<rl&&(Zr=rl,Yr=(xl-tl)/2*Kn),ao=-xl*Kn}else ao=(tr-Kn)*Eo-17}Hi?(K.verticalizable=!0,Br.push({glyph:En,imageName:ki,x:rt,y:Ze+ao,vertical:Hi,scale:Kn,localGlyph:Ri.localGlyph,fontStack:Lr.fontStack,sectionIndex:xn,metrics:Ri,rect:Vi}),rt+=vi*Kn+Be):(Br.push({glyph:En,imageName:ki,x:rt,y:Ze+ao,vertical:Hi,scale:Kn,localGlyph:Ri.localGlyph,fontStack:Lr.fontStack,sectionIndex:xn,metrics:Ri,rect:Vi}),rt+=Ri.advance*Kn+Be)}Br.length!==0&&(ft=Math.max(rt-Be,ft),lt?BE(Br,xt,zr,Yr,xe*tr/2):BE(Br,xt,zr,0,xe/2)),rt=0;const Fn=xe*tr+zr;$r.lineOffset=Math.max(zr,Mr),Ze+=Fn,++Yt}var Vt;const Mt=Ze,{horizontalAlign:Et,verticalAlign:yr}=gb(me);(function(Xt,tr,Mr,$r,Br,zr){const Zr=(tr-Mr)*Br,Yr=-zr*$r;for(const Fn of Xt)for(const Rn of Fn.positionedGlyphs)Rn.x+=Zr,Rn.y+=Yr})(K.positionedLines,xt,Et,yr,ft,Mt),K.top+=-yr*Mt,K.bottom=K.top+Mt,K.left+=-Et*ft,K.right=K.left+ft,K.hasBaseline=lt}(Z,t,o,c,O,m,x,A,T,R,C,S),!function(K){for(const ie of K)if(ie.positionedGlyphs.length!==0)return!1;return!0}(N)&&Z}const G_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},fO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ME(l,t,o,c,p,h){if(t.imageName){const m=c[t.imageName];return m?m.displaySize[0]*t.scale*Eo/h+p:0}{const m=o[t.fontStack],x=m&&m.glyphs[l];return x?x.metrics.advance*t.scale+p:0}}function DE(l,t,o,c){const p=Math.pow(l-t,2);return c?l<t?p/2:2*p:p+Math.abs(o)*o}function pO(l,t,o){let c=0;return l===10&&(c-=1e4),o&&(c+=150),l!==40&&l!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function LE(l,t,o,c,p,h){let m=null,x=DE(t,o,p,h);for(const A of c){const R=DE(t-A.x,o,p,h)+A.badness;R<=x&&(m=A,x=R)}return{index:l,x:t,priorBreak:m,badness:x}}function OE(l){return l?OE(l.priorBreak).concat(l.index):[]}function gb(l){let t=.5,o=.5;switch(l){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:t,verticalAlign:o}}function BE(l,t,o,c,p){if(!(t||o||c||p))return;const h=l.length-1,m=l[h],x=(m.x+m.metrics.advance*m.scale)*t;for(let A=0;A<=h;A++)l[A].x-=x,l[A].y+=o+c+p}function mO(l,t,o,c){const{horizontalAlign:p,verticalAlign:h}=gb(c),m=o[0]-l.displaySize[0]*p,x=o[1]-l.displaySize[1]*h;return{imagePrimary:l,imageSecondary:t,top:x,bottom:x+l.displaySize[1],left:m,right:m+l.displaySize[0]}}function zE(l,t,o,c,p,h){const m=l.imagePrimary;let x;if(m.content){const O=m.content,F=m.pixelRatio||1;x=[O[0]/F,O[1]/F,m.displaySize[0]-O[2]/F,m.displaySize[1]-O[3]/F]}const A=t.left*h,R=t.right*h;let y,T,C,E;o==="width"||o==="both"?(E=p[0]+A-c[3],T=p[0]+R+c[1]):(E=p[0]+(A+R-m.displaySize[0])/2,T=E+m.displaySize[0]);const S=t.top*h,P=t.bottom*h;return o==="height"||o==="both"?(y=p[1]+S-c[0],C=p[1]+P+c[2]):(y=p[1]+(S+P-m.displaySize[1])/2,C=y+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:y,right:T,bottom:C,left:E,collisionPadding:x}}class Cc extends De{constructor(t,o,c,p,h){super(t,o),this.angle=p,this.z=c,h!==void 0&&(this.segment=h)}clone(){return new Cc(this.x,this.y,this.z,this.angle,this.segment)}}function FE(l,t,o,c,p){if(t.segment===void 0)return!0;let h=t,m=t.segment+1,x=0;for(;x>-o/2;){if(m--,m<0)return!1;x-=l[m].dist(h),h=l[m]}x+=l[m].dist(l[m+1]),m++;const A=[];let R=0;for(;x<o/2;){const y=l[m],T=l[m+1];if(!T)return!1;let C=l[m-1].angleTo(y)-y.angleTo(T);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:x,angleDelta:C}),R+=C;x-A[0].distance>c;)R-=A.shift().angleDelta;if(R>p)return!1;m++,x+=y.dist(T)}return!0}function NE(l){let t=0;for(let o=0;o<l.length-1;o++)t+=l[o].dist(l[o+1]);return t}function VE(l,t,o){return l?.6*t*o:0}function UE(l,t){return Math.max(l?l.right-l.left:0,t?t.right-t.left:0)}function gO(l,t,o,c,p,h){const m=VE(o,p,h),x=UE(o,c)*h;let A=0;const R=NE(l)/2;for(let y=0;y<l.length-1;y++){const T=l[y],C=l[y+1],E=T.dist(C);if(A+E>R){const S=(R-A)/E,P=xr(T.x,C.x,S),O=xr(T.y,C.y,S),F=new Cc(P,O,0,C.angleTo(T),y);return!m||FE(l,F,x,m,t)?F:void 0}A+=E}}function _O(l,t,o,c,p,h,m,x,A){const R=VE(c,h,m),y=UE(c,p),T=y*m,C=l[0].x===0||l[0].x===A||l[0].y===0||l[0].y===A;return t-T<t/4&&(t=T+t/4),jE(l,C?t/2*x%t:(y/2+2*h)*m*x%t,t,R,o,T,C,!1,A)}function jE(l,t,o,c,p,h,m,x,A){const R=h/2,y=NE(l);let T=0,C=t-o,E=[];for(let S=0;S<l.length-1;S++){const P=l[S],O=l[S+1],F=P.dist(O),j=O.angleTo(P);for(;C+o<T+F;){C+=o;const G=(C-T)/F,N=xr(P.x,O.x,G),Z=xr(P.y,O.y,G);if(N>=0&&N<A&&Z>=0&&Z<A&&C-R>=0&&C+R<=y){const K=new Cc(N,Z,0,j,S);c&&!FE(l,K,h,c,p)||E.push(K)}}T+=F}return x||E.length||m||(E=jE(l,T/2,o,c,p,h,m,!0,A)),E}function $E(l,t,o,c,p){const h=[];for(let m=0;m<l.length;m++){const x=l[m];let A;for(let R=0;R<x.length-1;R++){let y=x[R],T=x[R+1];y.x<t&&T.x<t||(y.x<t?y=new De(t,y.y+(t-y.x)/(T.x-y.x)*(T.y-y.y))._round():T.x<t&&(T=new De(t,y.y+(t-y.x)/(T.x-y.x)*(T.y-y.y))._round()),y.y<o&&T.y<o||(y.y<o?y=new De(y.x+(o-y.y)/(T.y-y.y)*(T.x-y.x),o)._round():T.y<o&&(T=new De(y.x+(o-y.y)/(T.y-y.y)*(T.x-y.x),o)._round()),y.x>=c&&T.x>=c||(y.x>=c?y=new De(c,y.y+(c-y.x)/(T.x-y.x)*(T.y-y.y))._round():T.x>=c&&(T=new De(c,y.y+(c-y.x)/(T.x-y.x)*(T.y-y.y))._round()),y.y>=p&&T.y>=p||(y.y>=p?y=new De(y.x+(p-y.y)/(T.y-y.y)*(T.x-y.x),p)._round():T.y>=p&&(T=new De(y.x+(p-y.y)/(T.y-y.y)*(T.x-y.x),p)._round()),A&&y.equals(A[A.length-1])||(A=[y],h.push(A)),A.push(T)))))}}return h}function qE(l){let t=0,o=0;for(const m of l)t+=m.w*m.h,o=Math.max(o,m.w);l.sort((m,x)=>x.h-m.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),o),h:1/0}];let p=0,h=0;for(const m of l)for(let x=c.length-1;x>=0;x--){const A=c[x];if(!(m.w>A.w||m.h>A.h)){if(m.x=A.x,m.y=A.y,h=Math.max(h,m.y+m.h),p=Math.max(p,m.x+m.w),m.w===A.w&&m.h===A.h){const R=c.pop();x<c.length&&(c[x]=R)}else m.h===A.h?(A.x+=m.w,A.w-=m.w):m.w===A.w?(A.y+=m.h,A.h-=m.h):(c.push({x:A.x+m.w,y:A.y,w:A.w-m.w,h:m.h}),A.y+=m.h,A.h-=m.h);break}}return{w:p,h,fill:t/(p*h)||0}}rr(Cc,"Anchor");const am=1;class _b{constructor(t,{pixelRatio:o,version:c,stretchX:p,stretchY:h,content:m},x){this.paddedRect=t,this.pixelRatio=o,this.stretchX=p,this.stretchY=h,this.content=m,this.version=c,this.padding=x}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class GE{constructor(t,o,c){const p={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,p,am,m),this.addImages(o,h,2,m);const{w:x,h:A}=qE(m),R=new es({width:x||1,height:A||1});for(const y in t){const T=t[y],C=p[y].paddedRect;es.copy(T.data,R,{x:0,y:0},{x:C.x+am,y:C.y+am},T.data,c,T.sdf)}for(const y in o){const T=o[y],C=h[y].paddedRect;let E=h[y].padding;const S=C.x+E,P=C.y+E,O=T.data.width,F=T.data.height;E=E>1?E-1:E,es.copy(T.data,R,{x:0,y:0},{x:S,y:P},T.data,c),es.copy(T.data,R,{x:0,y:F-E},{x:S,y:P-E},{width:O,height:E},c),es.copy(T.data,R,{x:0,y:0},{x:S,y:P+F},{width:O,height:E},c),es.copy(T.data,R,{x:O-E,y:0},{x:S-E,y:P},{width:E,height:F},c),es.copy(T.data,R,{x:0,y:0},{x:S+O,y:P},{width:E,height:F},c),es.copy(T.data,R,{x:O-E,y:F-E},{x:S-E,y:P-E},{width:E,height:E},c),es.copy(T.data,R,{x:0,y:F-E},{x:S+O,y:P-E},{width:E,height:E},c),es.copy(T.data,R,{x:0,y:0},{x:S+O,y:P+F},{width:E,height:E},c),es.copy(T.data,R,{x:O-E,y:0},{x:S-E,y:P+F},{width:E,height:E},c)}this.image=R,this.iconPositions=p,this.patternPositions=h}addImages(t,o,c,p){for(const h in t){const m=t[h],x={x:0,y:0,w:m.data.width+2*c,h:m.data.height+2*c};p.push(x),o[h]=new _b(x,m,c),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,o,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>t.hasImage(p,c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const p in t.getUpdatedImages(c))this.patchUpdatedImage(this.iconPositions[p],t.getImage(p,c),o),this.patchUpdatedImage(this.patternPositions[p],t.getImage(p,c),o)}patchUpdatedImage(t,o,c){if(!t||!o||t.version===o.version)return;t.version=o.version;const[p,h]=t.tl;c.update(o.data,{position:{x:p,y:h}})}}rr(_b,"ImagePosition"),rr(GE,"ImageAtlas");const lm=1e20;function HE(l,t,o,c,p,h,m,x,A){for(let R=t;R<t+c;R++)WE(l,o*h+R,h,p,m,x,A);for(let R=o;R<o+p;R++)WE(l,R*h+t,1,c,m,x,A)}function WE(l,t,o,c,p,h,m){h[0]=0,m[0]=-lm,m[1]=lm,p[0]=l[t];for(let x=1,A=0,R=0;x<c;x++){p[x]=l[t+x*o];const y=x*x;do{const T=h[A];R=(p[x]-p[T]+y-T*T)/(x-T)/2}while(R<=m[A]&&--A>-1);A++,h[A]=x,m[A]=R,m[A+1]=lm}for(let x=0,A=0;x<c;x++){for(;m[A+1]<x;)A++;const R=h[A],y=x-R;l[t+x*o]=p[R]+y*y}}const _l=2,yb={none:0,ideographs:1,all:2};class of{constructor(t,o,c){this.requestManager=t,this.localGlyphMode=o,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,o){this.urls[o]=t}getGlyphs(t,o,c){const p=[],h=this.urls[o]||Ce.GLYPHS_URL;for(const m in t)for(const x of t[m])p.push({stack:m,id:x});tn(p,({stack:m,id:x},A)=>{let R=this.entries[m];R||(R=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=R.glyphs[x];if(y!==void 0)return void A(null,{stack:m,id:x,glyph:y});if(y=this._tinySDF(R,m,x),y)return R.glyphs[x]=y,void A(null,{stack:m,id:x,glyph:y});const T=Math.floor(x/256);if(256*T>65535)return void A(new Error("glyphs > 65535 not supported"));if(R.ranges[T])return void A(null,{stack:m,id:x,glyph:y});let C=R.requests[T];C||(C=R.requests[T]=[],of.loadGlyphRange(m,T,h,this.requestManager,(E,S)=>{if(S){R.ascender=S.ascender,R.descender=S.descender;for(const P in S.glyphs)this._doesCharSupportLocalGlyph(+P)||(R.glyphs[+P]=S.glyphs[+P]);R.ranges[T]=!0}for(const P of C)P(E,S);delete R.requests[T]})),C.push((E,S)=>{E?A(E):S&&A(null,{stack:m,id:x,glyph:S.glyphs[x]||null})})},(m,x)=>{if(m)c(m);else if(x){const A={};for(const{stack:R,id:y,glyph:T}of x)A[R]===void 0&&(A[R]={}),A[R].glyphs===void 0&&(A[R].glyphs={}),A[R].glyphs[y]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},A[R].ascender=this.entries[R].ascender,A[R].descender=this.entries[R].descender;c(null,A)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==yb.none&&(this.localGlyphMode===yb.all?!!this.localFontFamily:!!this.localFontFamily&&(hr["CJK Unified Ideographs"](t)||hr["Hangul Syllables"](t)||hr.Hiragana(t)||hr.Katakana(t)||hr["CJK Symbols and Punctuation"](t)||hr["CJK Unified Ideographs Extension A"](t)||hr["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,o,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let h=t.tinySDF;if(!h){let P="400";/bold/i.test(o)?P="900":/medium/i.test(o)?P="500":/light/i.test(o)&&(P="200"),h=t.tinySDF=new of.TinySDF({fontFamily:p,fontWeight:P,fontSize:24*_l,buffer:3*_l,radius:8*_l}),h.fontWeight=P}if(this.localGlyphs[h.fontWeight][c])return this.localGlyphs[h.fontWeight][c];const m=String.fromCodePoint(c),{data:x,width:A,height:R,glyphWidth:y,glyphHeight:T,glyphLeft:C,glyphTop:E,glyphAdvance:S}=h.draw(m);return this.localGlyphs[h.fontWeight][c]={id:c,bitmap:new xu({width:A,height:R},x),metrics:{width:y/_l,height:T/_l,left:C/_l,top:E/_l-27,advance:S/_l,localGlyph:!0}}}}of.loadGlyphRange=function(l,t,o,c,p){const h=256*t,m=h+255,x=c.transformRequest(c.normalizeGlyphsURL(o).replace("{fontstack}",l).replace("{range}",`${h}-${m}`),$s.Glyphs);Oa(x,(A,R)=>{if(A)p(A);else if(R){const y={},T=function(C){return new q_(C).readFields(uO,{})}(R);for(const C of T.glyphs)y[C.id]=C;p(null,{glyphs:y,ascender:T.ascender,descender:T.descender})}})},of.TinySDF=class{constructor({fontSize:l=24,buffer:t=3,radius:o=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:h="normal",fontStyle:m="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=o;const x=this.size=l+4*t,A=this._createCanvas(x),R=this.ctx=A.getContext("2d",{willReadFrequently:!0});R.font=`${m} ${h} ${l}px ${p}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(l){const t=document.createElement("canvas");return t.width=t.height=l,t}draw(l){const{width:t,actualBoundingBoxAscent:o,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:h}=this.ctx.measureText(l),m=Math.ceil(o),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-p))),A=Math.min(this.size-this.buffer,m+Math.ceil(c)),R=x+2*this.buffer,y=A+2*this.buffer,T=Math.max(R*y,0),C=new Uint8ClampedArray(T),E={data:C,width:R,height:y,glyphWidth:x,glyphHeight:A,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(x===0||A===0)return E;const{ctx:S,buffer:P,gridInner:O,gridOuter:F}=this;S.clearRect(P,P,x,A),S.fillText(l,P,P+m);const j=S.getImageData(P,P,x,A);F.fill(lm,0,T),O.fill(0,0,T);for(let G=0;G<A;G++)for(let N=0;N<x;N++){const Z=j.data[4*(G*x+N)+3]/255;if(Z===0)continue;const K=(G+P)*R+N+P;if(Z===1)F[K]=0,O[K]=lm;else{const ie=.5-Z;F[K]=ie>0?ie*ie:0,O[K]=ie<0?ie*ie:0}}HE(F,0,0,R,y,R,this.f,this.v,this.z),HE(O,P,P,x,A,R,this.f,this.v,this.z);for(let G=0;G<T;G++){const N=Math.sqrt(F[G])-Math.sqrt(O[G]);C[G]=Math.round(255-255*(N/this.radius+this.cutoff))}return E}};const Tu=am;function ZE(l,t,o,c){const p=[],h=l.imagePrimary,m=h.pixelRatio,x=h.paddedRect.w-2*Tu,A=h.paddedRect.h-2*Tu,R=l.right-l.left,y=l.bottom-l.top,T=h.stretchX||[[0,x]],C=h.stretchY||[[0,A]],E=(xe,me)=>xe+me[1]-me[0],S=T.reduce(E,0),P=C.reduce(E,0),O=x-S,F=A-P;let j=0,G=S,N=0,Z=P,K=0,ie=O,ue=0,de=F;if(h.content&&c){const xe=h.content;j=H_(T,0,xe[0]),N=H_(C,0,xe[1]),G=H_(T,xe[0],xe[2]),Z=H_(C,xe[1],xe[3]),K=xe[0]-j,ue=xe[1]-N,ie=xe[2]-xe[0]-G,de=xe[3]-xe[1]-Z}const le=(xe,me,Ee,Pe)=>{const Be=W_(xe.stretch-j,G,R,l.left),ze=Z_(xe.fixed-K,ie,xe.stretch,S),Ge=W_(me.stretch-N,Z,y,l.top),rt=Z_(me.fixed-ue,de,me.stretch,P),Ze=W_(Ee.stretch-j,G,R,l.left),ft=Z_(Ee.fixed-K,ie,Ee.stretch,S),xt=W_(Pe.stretch-N,Z,y,l.top),lt=Z_(Pe.fixed-ue,de,Pe.stretch,P),Yt=new De(Be,Ge),Vt=new De(Ze,Ge),Mt=new De(Ze,xt),Et=new De(Be,xt),yr=new De(ze/m,rt/m),Xt=new De(ft/m,lt/m),tr=t*Math.PI/180;if(tr){const Yr=Math.sin(tr),Fn=Math.cos(tr),Rn=[Fn,-Yr,Yr,Fn];Yt._matMult(Rn),Vt._matMult(Rn),Et._matMult(Rn),Mt._matMult(Rn)}const Mr=xe.stretch+xe.fixed,$r=Ee.stretch+Ee.fixed,Br=me.stretch+me.fixed,zr=Pe.stretch+Pe.fixed,Zr=l.imageSecondary;return{tl:Yt,tr:Vt,bl:Et,br:Mt,texPrimary:{x:h.paddedRect.x+Tu+Mr,y:h.paddedRect.y+Tu+Br,w:$r-Mr,h:zr-Br},texSecondary:Zr?{x:Zr.paddedRect.x+Tu+Mr,y:Zr.paddedRect.y+Tu+Br,w:$r-Mr,h:zr-Br}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yr,pixelOffsetBR:Xt,minFontScaleX:ie/m/R,minFontScaleY:de/m/y,isSDF:o}};if(c&&(h.stretchX||h.stretchY)){const xe=XE(T,O,S),me=XE(C,F,P);for(let Ee=0;Ee<xe.length-1;Ee++){const Pe=xe[Ee],Be=xe[Ee+1];for(let ze=0;ze<me.length-1;ze++)p.push(le(Pe,me[ze],Be,me[ze+1]))}}else p.push(le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:A+1}));return p}function H_(l,t,o){let c=0;for(const p of l)c+=Math.max(t,Math.min(o,p[1]))-Math.max(t,Math.min(o,p[0]));return c}function XE(l,t,o){const c=[{fixed:-Tu,stretch:0}];for(const[p,h]of l){const m=c[c.length-1];c.push({fixed:p-m.stretch,stretch:m.stretch}),c.push({fixed:p-m.stretch,stretch:m.stretch+(h-p)})}return c.push({fixed:t+Tu,stretch:o}),c}function W_(l,t,o,c){return l/t*o+c}function Z_(l,t,o,c){return l-t*o/c}function yO(l,t,o,c){const p=t+l.positionedLines[c].lineOffset;return c===0?o+p/2:o+(p+(t+l.positionedLines[c-1].lineOffset))/2}function vO(l,t=1,o=!1){let c=1/0,p=1/0,h=-1/0,m=-1/0;const x=l[0];for(let E=0;E<x.length;E++){const S=x[E];(!E||S.x<c)&&(c=S.x),(!E||S.y<p)&&(p=S.y),(!E||S.x>h)&&(h=S.x),(!E||S.y>m)&&(m=S.y)}const A=Math.min(h-c,m-p);let R=A/2;const y=new ch([],bO);if(A===0)return new De(c,p);for(let E=c;E<h;E+=A)for(let S=p;S<m;S+=A)y.push(new sf(E+R,S+R,R,l));let T=function(E){let S=0,P=0,O=0;const F=E[0];for(let j=0,G=F.length,N=G-1;j<G;N=j++){const Z=F[j],K=F[N],ie=Z.x*K.y-K.x*Z.y;P+=(Z.x+K.x)*ie,O+=(Z.y+K.y)*ie,S+=3*ie}return new sf(P/S,O/S,0,E)}(l),C=y.length;for(;y.length;){const E=y.pop();(E.d>T.d||!T.d)&&(T=E,o&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,C)),E.max-T.d<=t||(R=E.h/2,y.push(new sf(E.p.x-R,E.p.y-R,R,l)),y.push(new sf(E.p.x+R,E.p.y-R,R,l)),y.push(new sf(E.p.x-R,E.p.y+R,R,l)),y.push(new sf(E.p.x+R,E.p.y+R,R,l)),C+=4)}return o&&(console.log(`num probes: ${C}`),console.log(`best distance: ${T.d}`)),T.p}function bO(l,t){return t.max-l.max}class sf{constructor(t,o,c,p){this.p=new De(t,o),this.h=c,this.d=function(h,m){let x=!1,A=1/0;for(let R=0;R<m.length;R++){const y=m[R];for(let T=0,C=y.length,E=C-1;T<C;E=T++){const S=y[T],P=y[E];S.y>h.y!=P.y>h.y&&h.x<(P.x-S.x)*(h.y-S.y)/(P.y-S.y)+S.x&&(x=!x),A=Math.min(A,kn(h,S,P))}}return(x?1:-1)*Math.sqrt(A)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const vb=Number.POSITIVE_INFINITY,xO=Math.sqrt(2);function KE(l,[t,o]){let c=0,p=0;if(o===vb){t<0&&(t=0);const h=t/xO;switch(l){case"top-right":case"top-left":p=h-7;break;case"bottom-right":case"bottom-left":p=7-h;break;case"bottom":p=7-t;break;case"top":p=t-7}switch(l){case"top-right":case"bottom-right":c=-h;break;case"top-left":case"bottom-left":c=h;break;case"left":c=t;break;case"right":c=-t}}else{switch(t=Math.abs(t),o=Math.abs(o),l){case"top-right":case"top-left":case"top":p=o-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-o}switch(l){case"top-right":case"bottom-right":case"right":c=-t;break;case"top-left":case"bottom-left":case"left":c=t}}return[c,p]}function bb(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wO(l,t,o,c,p,h,m,x,A,R,y,T,C,E,S){let P=h.textMaxSize.evaluate(t,{},T);P===void 0&&(P=m);const O=l.layers[0].layout,F=O.get("icon-offset").evaluate(t,{},T),j=JE(o.horizontal)||o.vertical,G=C.name==="globe",N=Eo,Z=m/N,K=l.tilePixelRatio*P/N,ie=(Be=l.overscaling,l.zoom>18&&Be>2&&(Be>>=1),Math.max(Ut/(512*Be),1)*O.get("symbol-spacing")),ue=O.get("text-padding")*l.tilePixelRatio,de=O.get("icon-padding")*l.tilePixelRatio,le=Dt(O.get("text-max-angle")),xe=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",me=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",Ee=O.get("symbol-placement"),Pe=ie/2;var Be;const ze=O.get("icon-text-fit").evaluate(t,{},T),Ge=O.get("icon-text-fit-padding").evaluate(t,{},T),rt=ze!=="none";let Ze;l.hasAnyIconTextFit===!1&&rt&&(l.hasAnyIconTextFit=!0),c&&rt&&(l.allowVerticalPlacement&&o.vertical&&(Ze=zE(c,o.vertical,ze,Ge,F,Z)),j&&(c=zE(c,j,ze,Ge,F,Z)));const ft=(xt,lt,Yt)=>{if(lt.x<0||lt.x>=Ut||lt.y<0||lt.y>=Ut)return;let Vt=null;if(G){const{x:Mt,y:Et,z:yr}=C.projectTilePoint(lt.x,lt.y,Yt);Vt={anchor:new Cc(Mt,Et,yr,0,void 0),up:C.upVector(Yt,lt.x,lt.y)}}(function(Mt,Et,yr,Xt,tr,Mr,$r,Br,zr,Zr,Yr,Fn,Rn,Lr,xn,En,Kn,Ri,Vi,ki,vi,ao,Hi,Io,Hn,Ds,xl){const tl=Mt.addToLineVertexArray(Et,Xt);let rl,Nh,Cu,Vh,Am,vA,bA,xA=0,wA=0,TA=0,EA=0,Xb=-1,Kb=-1;const Jl={};let IA=$i("");const Uh=yr?yr.anchor:Et,Yb=zr.layout.get("icon-text-fit").evaluate(vi,{},Hn)!=="none";let Jb=0,Qb=0;if(zr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Jb,Qb]=zr.layout.get("text-offset").evaluate(vi,{},Hn).map(na=>na*Eo):(Jb=zr.layout.get("text-radial-offset").evaluate(vi,{},Hn)*Eo,Qb=vb),Mt.allowVerticalPlacement&&tr.vertical){const na=tr.vertical;if(xn)vA=xb(na),Br&&(bA=xb(Br));else{const ia=zr.layout.get("text-rotate").evaluate(vi,{},Hn)+90;Cu=X_(Zr,Uh,Et,Yr,Fn,Rn,na,Lr,ia,En),Br&&(Vh=X_(Zr,Uh,Et,Yr,Fn,Rn,Br,Ri,ia))}}if(Mr){const na=zr.layout.get("icon-rotate").evaluate(vi,{},Hn),ia=ZE(Mr,na,Hi,Yb),pf=Br?ZE(Br,na,Hi,Yb):void 0;Nh=X_(Zr,Uh,Et,Yr,Fn,Rn,Mr,Ri,na),xA=4*ia.length;const AA=Mt.iconSizeData;let jh=null;AA.kind==="source"?(jh=[gl*zr.layout.get("icon-size").evaluate(vi,{},Hn)],jh[0]>Eu&&nn(`${Mt.layerIds[0]}: Value for "icon-size" is >= ${cm}. Reduce your "icon-size".`)):AA.kind==="composite"&&(jh=[gl*ao.compositeIconSizes[0].evaluate(vi,{},Hn),gl*ao.compositeIconSizes[1].evaluate(vi,{},Hn)],(jh[0]>Eu||jh[1]>Eu)&&nn(`${Mt.layerIds[0]}: Value for "icon-size" is >= ${cm}. Reduce your "icon-size".`)),Mt.addSymbols(Mt.icon,ia,jh,ki,Vi,vi,!1,yr,Et,tl.lineStartIndex,tl.lineLength,-1,Io,Hn,Ds,xl),Xb=Mt.icon.placedSymbolArray.length-1,pf&&(wA=4*pf.length,Mt.addSymbols(Mt.icon,pf,jh,ki,Vi,vi,Ia.vertical,yr,Et,tl.lineStartIndex,tl.lineLength,-1,Io,Hn,Ds,xl),Kb=Mt.icon.placedSymbolArray.length-1)}for(const na in tr.horizontal){const ia=tr.horizontal[na];rl||(IA=$i(ia.text),xn?Am=xb(ia):rl=X_(Zr,Uh,Et,Yr,Fn,Rn,ia,Lr,zr.layout.get("text-rotate").evaluate(vi,{},Hn),En));const pf=ia.positionedLines.length===1;if(TA+=YE(Mt,yr,Et,ia,$r,zr,xn,vi,En,tl,tr.vertical?Ia.horizontal:Ia.horizontalOnly,pf?Object.keys(tr.horizontal):[na],Jl,Xb,ao,Io,Hn,Ds),pf)break}tr.vertical&&(EA+=YE(Mt,yr,Et,tr.vertical,$r,zr,xn,vi,En,tl,Ia.vertical,["vertical"],Jl,Kb,ao,Io,Hn,Ds));let Ru=-1;const ex=(na,ia)=>na?Math.max(na,ia):ia;Ru=ex(Am,Ru),Ru=ex(vA,Ru),Ru=ex(bA,Ru);const zB=Ru>-1?1:0;Mt.glyphOffsetArray.length>=65535&&nn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vi.sortKey!==void 0&&Mt.addToSortKeyRanges(Mt.symbolInstances.length,vi.sortKey),Mt.symbolInstances.emplaceBack(Et.x,Et.y,Uh.x,Uh.y,Uh.z,Jl.right>=0?Jl.right:-1,Jl.center>=0?Jl.center:-1,Jl.left>=0?Jl.left:-1,Jl.vertical>=0?Jl.vertical:-1,Xb,Kb,IA,rl!==void 0?rl:Mt.collisionBoxArray.length,rl!==void 0?rl+1:Mt.collisionBoxArray.length,Cu!==void 0?Cu:Mt.collisionBoxArray.length,Cu!==void 0?Cu+1:Mt.collisionBoxArray.length,Nh!==void 0?Nh:Mt.collisionBoxArray.length,Nh!==void 0?Nh+1:Mt.collisionBoxArray.length,Vh||Mt.collisionBoxArray.length,Vh?Vh+1:Mt.collisionBoxArray.length,Yr,TA,EA,xA,wA,zB,0,Jb,Qb,Ru,0,Yb?1:0)})(l,lt,Vt,xt,o,c,p,Ze,l.layers[0],l.collisionBoxArray,t.index,t.sourceLayerIndex,l.index,ue,xe,A,0,de,me,F,t,h,R,y,T,E,S)};if(Ee==="line")for(const xt of $E(t.geometry,0,0,Ut,Ut)){const lt=_O(xt,ie,le,o.vertical||j,c,N,K,l.overscaling,Ut);for(const Yt of lt)j&&TO(l,j.text,Pe,Yt)||ft(xt,Yt,T)}else if(Ee==="line-center"){for(const xt of t.geometry)if(xt.length>1){const lt=gO(xt,le,o.vertical||j,c,N,K);lt&&ft(xt,lt,T)}}else if(t.type==="Polygon")for(const xt of B_(t.geometry,0)){const lt=vO(xt,16);ft(xt[0],new Cc(lt.x,lt.y,0,0,void 0),T)}else if(t.type==="LineString")for(const xt of t.geometry)ft(xt,new Cc(xt[0].x,xt[0].y,0,0,void 0),T);else if(t.type==="Point")for(const xt of t.geometry)for(const lt of xt)ft([lt],new Cc(lt.x,lt.y,0,0,void 0),T)}const cm=255,Eu=cm*gl;function YE(l,t,o,c,p,h,m,x,A,R,y,T,C,E,S,P,O,F){const j=function(Z,K,ie,ue,de,le,xe,me){const Ee=[];if(K.positionedLines.length===0)return Ee;const Pe=ue.layout.get("text-rotate").evaluate(le,{})*Math.PI/180,Be=function(ft){const xt=ft[0],lt=ft[1],Yt=xt*lt;return Yt>0?[xt,-lt]:Yt<0?[-xt,lt]:xt===0?[lt,xt]:[lt,-xt]}(ie);let ze=Math.abs(K.top-K.bottom);for(const ft of K.positionedLines)ze-=ft.lineOffset;const Ge=K.positionedLines.length,rt=ze/Ge;let Ze=K.top-ie[1];for(let ft=0;ft<Ge;++ft){const xt=K.positionedLines[ft];Ze=yO(K,rt,Ze,ft);for(const lt of xt.positionedGlyphs){if(!lt.rect)continue;const Yt=lt.rect||{};let Vt=PE+1,Mt=!0,Et=1,yr=0;if(lt.imageName){const ki=xe[lt.imageName];if(!ki)continue;if(ki.sdf){nn("SDF images are not supported in formatted text and will be ignored.");continue}Mt=!1,Et=ki.pixelRatio,Vt=am/Et}const Xt=(de||me)&&lt.vertical,tr=lt.metrics.advance*lt.scale/2,Mr=lt.metrics,$r=lt.rect;if($r===null)continue;me&&K.verticalizable&&(yr=lt.imageName?tr-lt.metrics.width*lt.scale/2:0);const Br=de?[lt.x+tr,lt.y]:[0,0];let zr=[0,0],Zr=[0,0],Yr=!1;de||(Xt?(Zr=[lt.x+tr+Be[0],lt.y+Be[1]-yr],Yr=!0):zr=[lt.x+tr+ie[0],lt.y+ie[1]-yr]);const Fn=$r.w*lt.scale/(Et*(lt.localGlyph?_l:1)),Rn=$r.h*lt.scale/(Et*(lt.localGlyph?_l:1));let Lr,xn,En,Kn;if(Xt){const ki=lt.y-Ze,vi=new De(-tr,tr-ki),ao=-Math.PI/2,Hi=new De(...Zr);Lr=new De(-tr+zr[0],zr[1]),Lr._rotateAround(ao,vi)._add(Hi),Lr.x+=-ki+tr,Lr.y-=(Mr.left-Vt)*lt.scale;const Io=lt.imageName?Mr.advance*lt.scale:Eo*lt.scale,Hn=String.fromCodePoint(lt.glyph);aO(Hn)?Lr.x+=(1-Vt)*lt.scale:lO(Hn)?Lr.x+=Io-Mr.height*lt.scale+(-Vt-1)*lt.scale:Lr.x+=lt.imageName||Mr.width+2*Vt===$r.w&&Mr.height+2*Vt===$r.h?(Io-Rn)/2:(Io-(Mr.height+2*Vt)*lt.scale)/2,xn=new De(Lr.x,Lr.y-Fn),En=new De(Lr.x+Rn,Lr.y),Kn=new De(Lr.x+Rn,Lr.y-Fn)}else{const ki=(Mr.left-Vt)*lt.scale-tr+zr[0],vi=(-Mr.top-Vt)*lt.scale+zr[1],ao=ki+Fn,Hi=vi+Rn;Lr=new De(ki,vi),xn=new De(ao,vi),En=new De(ki,Hi),Kn=new De(ao,Hi)}if(Pe){let ki;ki=de?new De(0,0):Yr?new De(Be[0],Be[1]):new De(ie[0],ie[1]),Lr._rotateAround(Pe,ki),xn._rotateAround(Pe,ki),En._rotateAround(Pe,ki),Kn._rotateAround(Pe,ki)}const Ri=new De(0,0),Vi=new De(0,0);Ee.push({tl:Lr,tr:xn,bl:En,br:Kn,texPrimary:Yt,texSecondary:void 0,writingMode:K.writingMode,glyphOffset:Br,sectionIndex:lt.sectionIndex,isSDF:Mt,pixelOffsetTL:Ri,pixelOffsetBR:Vi,minFontScaleX:0,minFontScaleY:0})}}return Ee}(0,c,A,h,m,x,p,l.allowVerticalPlacement),G=l.textSizeData;let N=null;G.kind==="source"?(N=[gl*h.layout.get("text-size").evaluate(x,{},O)],N[0]>Eu&&nn(`${l.layerIds[0]}: Value for "text-size" is >= ${cm}. Reduce your "text-size".`)):G.kind==="composite"&&(N=[gl*S.compositeTextSizes[0].evaluate(x,{},O),gl*S.compositeTextSizes[1].evaluate(x,{},O)],(N[0]>Eu||N[1]>Eu)&&nn(`${l.layerIds[0]}: Value for "text-size" is >= ${cm}. Reduce your "text-size".`)),l.addSymbols(l.text,j,N,A,m,x,y,t,o,R.lineStartIndex,R.lineLength,E,P,O,F,!1);for(const Z of T)C[Z]=l.text.placedSymbolArray.length-1;return 4*j.length}function JE(l){for(const t in l)return l[t];return null}function X_(l,t,o,c,p,h,m,x,A,R){let y=m.top,T=m.bottom,C=m.left,E=m.right;const S=m.collisionPadding;if(S&&(C-=S[0],y-=S[1],E+=S[2],T+=S[3]),A){const P=new De(C,y),O=new De(E,y),F=new De(C,T),j=new De(E,T),G=Dt(A);let N=new De(0,0);R&&(N=new De(R[0],R[1])),P._rotateAround(G,N),O._rotateAround(G,N),F._rotateAround(G,N),j._rotateAround(G,N),C=Math.min(P.x,O.x,F.x,j.x),E=Math.max(P.x,O.x,F.x,j.x),y=Math.min(P.y,O.y,F.y,j.y),T=Math.max(P.y,O.y,F.y,j.y)}return l.emplaceBack(t.x,t.y,t.z,o.x,o.y,C,y,E,T,x,c,p,h),l.length-1}function xb(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const t=l.bottom-l.top;return t>0?Math.max(10,t):null}function TO(l,t,o,c){const p=l.compareText;if(t in p){const h=p[t];for(let m=h.length-1;m>=0;m--)if(c.dist(h[m])<o)return!0}else p[t]=[];return p[t].push(c),!1}function QE(l,t){const o=l.fovAboveCenter,c=l.elevation?l.elevation.getMinElevationBelowMSL()*t:0,p=(l._camera.position[2]*l.worldSize-c)/Math.cos(l._pitch),h=Math.sin(o)*p/Math.sin(Math.max(Math.PI/2-l._pitch-o,.01));let m=Math.sin(l._pitch)*h+p;const x=p*(1/l._horizonShift);return l.elevation&&l.elevation.exaggeration()!==0||(m*=1+Math.max(l.zoom-17,0)),Math.min(1.01*m,x)}function um(l,t){if(!t.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:t};const o=Math.pow(2,-l.z),c=l.x*o,p=(l.x+1)*o,h=l.y*o,m=(l.y+1)*o,x=ye(c),A=ye(p),R=ge(h),y=ge(m),T=t.project(x,R),C=t.project(A,R),E=t.project(A,y),S=t.project(x,y);let P=Math.min(T.x,C.x,E.x,S.x),O=Math.min(T.y,C.y,E.y,S.y),F=Math.max(T.x,C.x,E.x,S.x),j=Math.max(T.y,C.y,E.y,S.y);const G=o/16;function N(K,ie,ue,de,le,xe){const me=(ue+le)/2,Ee=(de+xe)/2,Pe=t.project(ye(me),ge(Ee)),Be=Math.max(0,P-Pe.x,O-Pe.y,Pe.x-F,Pe.y-j);P=Math.min(P,Pe.x),F=Math.max(F,Pe.x),O=Math.min(O,Pe.y),j=Math.max(j,Pe.y),Be>G&&(N(K,Pe,ue,de,me,Ee),N(Pe,ie,me,Ee,le,xe))}N(T,C,c,h,p,h),N(C,E,p,h,p,m),N(E,S,p,m,c,m),N(S,T,c,m,c,h),P-=G,O-=G,F+=G,j+=G;const Z=1/Math.max(F-P,j-O);return{scale:Z,x:P*Z,y:O*Z,x2:F*Z,y2:j*Z,projection:t}}function eI(l,{x:t,y:o},c=0){return new De(((t-c)*l.scale-l.x)*Ut,(o*l.scale-l.y)*Ut)}const EO=_e.mat4.identity(new Float32Array(16));class Iu{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,o){return{x:0,y:0,z:0}}unproject(t,o){return new q(0,0)}projectTilePoint(t,o,c){return{x:t,y:o,z:0}}locationPoint(t,o,c=!0){return t._coordinatePoint(t.locationCoordinate(o),c)}pixelsPerMeter(t,o){return ce(1,t)*o}pixelSpaceConversion(t,o,c){return 1}farthestPixelDistance(t){return QE(t,t.pixelsPerMeter)}pointCoordinate(t,o,c,p){const h=t.horizonLineFromTop(!1),m=new De(o,Math.max(h,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(m,p))}pointCoordinate3D(t,o,c){const p=new De(o,c);if(t.elevation)return t.elevation.pointCoordinate(p);{const h=this.pointCoordinate(t,p.x,p.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(t,o){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,o.x,o.y);const c=t.horizonLineFromTop();return o.y<c}createInversionMatrix(t,o){return EO}createTileMatrix(t,o,c){let p,h,m;const x=c.canonical,A=_e.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=um(x,this);p=1,h=R.x+c.wrap*R.scale,m=R.y,_e.mat4.scale(A,A,[p/R.scale,p/R.scale,t.pixelsPerMeter/o])}else p=o/t.zoomScale(x.z),h=(x.x+Math.pow(2,x.z)*c.wrap)*p,m=x.y*p;return _e.mat4.translate(A,A,[h,m,0]),_e.mat4.scale(A,A,[p/Ut,p/Ut,1]),A}upVector(t,o,c){return[0,0,1]}upVectorScale(t,o,c){return{metersToTile:1}}}class IO extends Iu{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[o,c]=this.parallels=t.parallels||[29.5,45.5],p=Math.sin(Dt(o));this.n=(p+Math.sin(Dt(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(t,o){const{n:c,c:p,r0:h}=this,m=Dt(t-this.center[0]),x=Dt(o),A=Math.sqrt(p-2*c*Math.sin(x))/c;return{x:A*Math.sin(m*c),y:A*Math.cos(m*c)-h,z:0}}unproject(t,o){const{n:c,c:p,r0:h}=this,m=h+o;let x=Math.atan2(t,Math.abs(m))*Math.sign(m);m*c<0&&(x-=Math.PI*Math.sign(t)*Math.sign(m));const A=Dt(this.center[0])*c;x=Sr(x,-Math.PI-A,Math.PI-A);const R=Ft(Wt(x/c)+this.center[0],-180,180),y=Math.asin(Ft((p-(t*t+m*m)*c*c)/(2*c),-1,1)),T=Ft(Wt(y),-Te,Te);return new q(R,T)}}const hm=1.340264,dm=-.081106,fm=893e-6,pm=.003796,K_=Math.sqrt(3)/2;class AO extends Iu{project(t,o){o=o/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(K_*Math.sin(o)),p=c*c,h=p*p*p;return{x:.5*(t*Math.cos(c)/(K_*(hm+3*dm*p+h*(7*fm+9*pm*p)))/Math.PI+.5),y:1-.5*(c*(hm+dm*p+h*(fm+pm*p))/Math.PI+1),z:0}}unproject(t,o){t=(2*t-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,p=c*c,h=p*p*p;for(let y,T,C,E=0;E<12&&(T=c*(hm+dm*p+h*(fm+pm*p))-o,C=hm+3*dm*p+h*(7*fm+9*pm*p),y=T/C,c=Ft(c-y,-Math.PI/3,Math.PI/3),p=c*c,h=p*p*p,!(Math.abs(y)<1e-12));++E);const m=K_*t*(hm+3*dm*p+h*(7*fm+9*pm*p))/Math.cos(c),x=Math.asin(Math.sin(c)/K_),A=Ft(180*m/Math.PI,-180,180),R=Ft(180*x/Math.PI,-Te,Te);return new q(A,R)}}class SO extends Iu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,o){return{x:.5+t/360,y:.5-o/360,z:0}}unproject(t,o){const c=360*(t-.5),p=Ft(360*(.5-o),-Te,Te);return new q(c,p)}}const af=Math.PI/2;function Y_(l){return Math.tan((af+l)/2)}class CO extends Iu{constructor(t){super(t),this.center=t.center||[0,30];const[o,c]=this.parallels=t.parallels||[30,30];let p=Dt(o),h=Dt(c);this.southernCenter=p+h<0,this.southernCenter&&(p=-p,h=-h);const m=Math.cos(p),x=Y_(p);this.n=p===h?Math.sin(p):Math.log(m/Math.cos(h))/Math.log(Y_(h)/x),this.f=m*Math.pow(Y_(p),this.n)/this.n}project(t,o){o=Dt(o),this.southernCenter&&(o=-o),t=Dt(t-this.center[0]);const c=1e-6,{n:p,f:h}=this;h>0?o<-af+c&&(o=-af+c):o>af-c&&(o=af-c);const m=h/Math.pow(Y_(o),p);let x=m*Math.sin(p*t),A=h-m*Math.cos(p*t);return x=.5*(x/Math.PI+.5),A=.5*(A/Math.PI+.5),{x,y:this.southernCenter?A:1-A,z:0}}unproject(t,o){t=(2*t-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:c,f:p}=this,h=p-o,m=Math.sign(h),x=Math.sign(c)*Math.sqrt(t*t+h*h);let A=Math.atan2(t,Math.abs(h))*m;h*c<0&&(A-=Math.PI*Math.sign(t)*m);const R=Ft(Wt(A/c)+this.center[0],-180,180),y=Ft(Wt(2*Math.atan(Math.pow(p/x,1/c))-af),-Te,Te);return new q(R,this.southernCenter?-y:y)}}class tI extends Iu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,o){return{x:he(t),y:pe(o),z:0}}unproject(t,o){const c=ye(t),p=ge(o);return new q(c,p)}}const rI=Dt(Te);class RO extends Iu{project(t,o){const c=(o=Dt(o))*o,p=c*c;return{x:.5*((t=Dt(t))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(t,o){t=(2*t-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,p=25,h=0,m=c*c;do{m=c*c;const R=m*m;h=(c*(1.007226+m*(.015085+R*(.028874*m-.044475-.005916*R)))-o)/(1.007226+m*(.045255+R*(.259866*m-.311325-.005916*11*R))),c=Ft(c-h,-rI,rI)}while(Math.abs(h)>1e-6&&--p>0);m=c*c;const x=Ft(Wt(t/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),A=Wt(c);return new q(x,A)}}const nI=Dt(Te);class kO extends Iu{project(t,o){o=Dt(o),t=Dt(t);const c=Math.cos(o),p=2/Math.PI,h=Math.acos(c*Math.cos(t/2)),m=Math.sin(h)/h,x=.5*(t*p+2*c*Math.sin(t/2)/m)||0,A=.5*(o+Math.sin(o)/m)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(t,o){let c=t=(2*t-.5)*Math.PI,p=o=(2*(1-o)-1)*Math.PI,h=25;const m=1e-6;let x=0,A=0;do{const R=Math.cos(p),y=Math.sin(p),T=2*y*R,C=y*y,E=R*R,S=Math.cos(c/2),P=Math.sin(c/2),O=2*S*P,F=P*P,j=1-E*S*S,G=j?1/j:0,N=j?Math.acos(R*S)*Math.sqrt(1/j):0,Z=.5*(2*N*R*P+2*c/Math.PI)-t,K=.5*(N*y+p)-o,ie=.5*G*(E*F+N*R*S*C)+1/Math.PI,ue=G*(O*T/4-N*y*P),de=.125*G*(T*P-N*y*E*O),le=.5*G*(C*S+N*F*R)+.5,xe=ue*de-le*ie;x=(K*ue-Z*le)/xe,A=(Z*de-K*ie)/xe,c=Ft(c-x,-Math.PI,Math.PI),p=Ft(p-A,-nI,nI)}while((Math.abs(x)>m||Math.abs(A)>m)&&--h>0);return new q(Wt(c),Wt(p))}}class iI extends Iu{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Dt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,o){const{scale:c,cosPhi:p}=this;return{x:Dt(t)*p*c+.5,y:-Math.sin(Dt(o))/p*c+.5,z:0}}unproject(t,o){const{scale:c,cosPhi:p}=this,h=-(o-.5)/c,m=Ft(Wt((t-.5)/c)/p,-180,180),x=Math.asin(Ft(h*p,-1,1)),A=Ft(Wt(x),-Te,Te);return new q(m,A)}}class PO extends tI{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,o,c){const p=Zp(t,o,c),h=M_(Kl(c));return _e.vec3.transformMat4(p,p,h),{x:p[0],y:p[1],z:p[2]}}locationPoint(t,o){const c=z(o.lat,o.lng),p=_e.vec3.normalize([],c),h=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(o),t._centerAltitude):t._centerAltitude,m=ce(1,0)*Ut*h;_e.vec3.scaleAndAdd(c,c,p,m);const x=_e.mat4.identity(new Float64Array(16));return _e.mat4.multiply(x,t.pixelMatrix,t.globeMatrix),_e.vec3.transformMat4(c,c,x),new De(c[0],c[1])}pixelsPerMeter(t,o){return ce(1,0)*o}pixelSpaceConversion(t,o,c){const p=ce(1,t)*o,h=xr(ce(1,45)*o,p,c);return this.pixelsPerMeter(t,o)/h}createTileMatrix(t,o,c){const p=Gv(Kl(c.canonical));return _e.mat4.multiply(new Float64Array(16),t.globeMatrix,p)}createInversionMatrix(t,o){const{center:c}=t,p=M_(Kl(o));return _e.mat4.rotateY(p,p,Dt(c.lng)),_e.mat4.rotateX(p,p,Dt(c.lat)),_e.mat4.scale(p,p,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(t,o,c,p){return R_(t,o,c,!0)||new Xe(0,0)}pointCoordinate3D(t,o,c){const p=this.pointCoordinate(t,o,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(t,o){return!R_(t,o.x,o.y,!1)}farthestPixelDistance(t){const o=function(p,h){const m=p.cameraToCenterDistance,x=p._centerAltitude*h,A=p._camera,R=p._camera.forward(),y=_e.vec3.add([],_e.vec3.scale([],R,-m),[0,0,x]),T=p.worldSize/(2*Math.PI),C=[0,0,-T],E=p.width/p.height,S=Math.tan(p.fovAboveCenter),P=_e.vec3.scale([],A.up(),S),O=_e.vec3.scale([],A.right(),S*E),F=_e.vec3.normalize([],_e.vec3.add([],_e.vec3.add([],R,P),O)),j=[];let G;if(new ml(y,F).closestPointOnSphere(C,T,j)){const N=_e.vec3.add([],j,C),Z=_e.vec3.sub([],N,y);G=Math.cos(p.fovAboveCenter)*_e.vec3.length(Z)}else{const N=_e.vec3.sub([],y,C),Z=_e.vec3.sub([],C,y);_e.vec3.normalize(Z,Z);const K=_e.vec3.length(N)-T;G=Math.sqrt(K*(K+2*T));const ie=Math.acos(G/(T+K))-Math.acos(_e.vec3.dot(R,Z));G*=Math.cos(ie)}return 1.01*G}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=bu(t.zoom);if(c>0){const p=QE(t,ce(1,t.center.lat)*t.worldSize),h=t.worldSize/(2*Math.PI),m=Math.max(t.width,t.height)/t.worldSize*Math.PI;return xr(o,p+h*(1-Math.cos(m)),Math.pow(c,10))}return o}upVector(t,o,c){return Zp(o,c,t,1)}upVectorScale(t){return{metersToTile:Ac(P_(Kl(t)))}}}function oI(l){const t=l.parallels,o=!!t&&Math.abs(t[0]+t[1])<.01;switch(l.name){case"mercator":return new tI(l);case"equirectangular":return new SO(l);case"naturalEarth":return new RO(l);case"equalEarth":return new AO(l);case"winkelTripel":return new kO(l);case"albers":return o?new iI(l):new IO(l);case"lambertConformalConic":return o?new iI(l):new CO(l);case"globe":return new PO(l)}throw new Error(`Invalid projection name: ${l.name}`)}const MO=tf.VectorTileFeature.types,DO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function J_(l,t,o,c,p,h,m,x,A,R,y,T,C){const E=x?Math.min(Eu,Math.round(x[0])):0,S=x?Math.min(Eu,Math.round(x[1])):0;l.emplaceBack(t,o,Math.round(32*c),Math.round(32*p),h,m,(E<<1)+(A?1:0),S,16*R,16*y,256*T,256*C)}function Q_(l,t,o){l.emplaceBack(t,o)}function ey(l,t,o,c,p,h,m){l.emplaceBack(t,o,c,p,h,m)}function ty(l,t,o,c,p){l.emplaceBack(t,o,c,p),l.emplaceBack(t,o,c,p),l.emplaceBack(t,o,c,p),l.emplaceBack(t,o,c,p)}function LO(l){for(const t of l.sections)if(Sv(t.text))return!0;return!1}class wb{constructor(t){this.layoutVertexArray=new Lp,this.indexArray=new po,this.programConfigurations=t,this.segments=new Ti,this.dynamicLayoutVertexArray=new hl,this.opacityVertexArray=new Bp,this.placedSymbolArray=new Up,this.iconTransitioningVertexArray=new Wl,this.globeExtVertexArray=new Op,this.zOffsetVertexArray=new pu}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,o,c,p,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,YL.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,QL.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,DO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,tO.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,JL.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,eO.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}rr(wb,"SymbolBuffers");class Tb{constructor(t,o,c){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new c,this.segments=new Ti,this.collisionVertexArray=new fu,this.collisionVertexArrayExt=new hl}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,rO.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,nO.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}rr(Tb,"CollisionBuffers");class ry{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_e.mat4.identity([]),this.placementViewportMatrix=_e.mat4.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hb(this.zoom,o["text-size"]),this.iconSizeData=hb(this.zoom,o["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),h=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>Ia[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new wb(new Zl(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new wb(new Zl(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new b_,this.lineVertexArray=new Kd,this.symbolInstances=new jp}calculateGlyphDependencies(t,o,c,p,h){for(let m=0;m<t.length;m++){const x=t.codePointAt(m);if(x===void 0)break;if(o[x]=!0,p&&h&&x<=65535){const A=om[t.charAt(m)];A&&(o[A.charCodeAt(0)]=!0)}}}updateFootprints(t,o){}updateReplacement(t,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const c=o.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!ob(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(t,o,c,p){const h=this.layers[0],m=h.layout,x=this.projection.name==="globe",A=m.get("text-font"),R=m.get("text-field"),y=m.get("icon-image"),T=(R.value.kind!=="constant"||R.value.value instanceof Xi&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),C=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,E=m.get("symbol-sort-key");if(this.features=[],!T&&!C)return;const S=o.iconDependencies,P=o.glyphDependencies,O=o.availableImages,F=new wi(this.zoom);for(const{feature:j,id:G,index:N,sourceLayerIndex:Z}of t){const K=h._featureFilter.needGeometry,ie=Lt(j,K);if(!h._featureFilter.filter(F,ie,c))continue;if(K||(ie.geometry=Pt(j,c,p)),x&&j.type!==1&&c.z<=5){const xe=ie.geometry,me=.98078528056,Ee=(Pe,Be)=>{const ze=Zp(Pe.x,Pe.y,c,1),Ge=Zp(Be.x,Be.y,c,1);return _e.vec3.dot(ze,Ge)<me};for(let Pe=0;Pe<xe.length;Pe++)xe[Pe]=Rt(xe[Pe],Ee)}let ue,de;if(T){const xe=h.getValueAndResolveTokens("text-field",ie,c,O),me=Xi.factory(xe);LO(me)&&(this.hasRTLText=!0),(!this.hasRTLText||Cp()==="unavailable"||this.hasRTLText&&gs.isParsed())&&(ue=sO(me,h,ie))}if(C){const xe=h.getValueAndResolveTokens("icon-image",ie,c,O);de=xe instanceof io?xe:io.fromString(xe)}if(!ue&&!de)continue;const le=this.sortFeaturesByKey?E.evaluate(ie,{},c):void 0;if(this.features.push({id:G,text:ue,icon:de,index:N,sourceLayerIndex:Z,geometry:ie.geometry,properties:j.properties,type:MO[j.type],sortKey:le}),de&&(S[de.namePrimary]=!0,de.nameSecondary&&(S[de.nameSecondary]=!0)),ue){const xe=A.evaluate(ie,{},c).join(","),me=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ia.vertical)>=0;for(const Ee of ue.sections)if(Ee.image)S[Ee.image.namePrimary]=!0;else{const Pe=Ld(ue.toString()),Be=Ee.fontStack||xe,ze=P[Be]=P[Be]||{};this.calculateGlyphDependencies(Ee.text,ze,me,this.allowVerticalPlacement,Pe)}}}m.get("symbol-placement")==="line"&&(this.features=function(j){const G={},N={},Z=[];let K=0;function ie(xe){Z.push(j[xe]),K++}function ue(xe,me,Ee){const Pe=N[xe];return delete N[xe],N[me]=Pe,Z[Pe].geometry[0].pop(),Z[Pe].geometry[0]=Z[Pe].geometry[0].concat(Ee[0]),Pe}function de(xe,me,Ee){const Pe=G[me];return delete G[me],G[xe]=Pe,Z[Pe].geometry[0].shift(),Z[Pe].geometry[0]=Ee[0].concat(Z[Pe].geometry[0]),Pe}function le(xe,me,Ee){const Pe=Ee?me[0][me[0].length-1]:me[0][0];return`${xe}:${Pe.x}:${Pe.y}`}for(let xe=0;xe<j.length;xe++){const me=j[xe],Ee=me.geometry,Pe=me.text?me.text.toString():null;if(!Pe){ie(xe);continue}const Be=le(Pe,Ee),ze=le(Pe,Ee,!0);if(Be in N&&ze in G&&N[Be]!==G[ze]){const Ge=de(Be,ze,Ee),rt=ue(Be,ze,Z[Ge].geometry);delete G[Be],delete N[ze],N[le(Pe,Z[rt].geometry,!0)]=rt,Z[Ge].geometry=null}else Be in N?ue(Be,ze,Ee):ze in G?de(Be,ze,Ee):(ie(xe),G[Be]=K-1,N[ze]=K-1)}return Z.filter(xe=>xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((j,G)=>j.sortKey-G.sortKey)}update(t,o,c,p,h){const m=Object.keys(t).length!==0;if(m&&!this.stateDependentLayers.length)return;const x=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,o,x,c,p,h),this.icon.programConfigurations.updatePaintArrays(t,o,x,c,p,h)}updateZOffset(){const t=(h,m,x)=>{c+=m,c>h.length&&h.resize(c);for(let A=-m;A<0;A++)h.emplace(A+c,x)},o=(h,m,x)=>{p+=m,p>h.length&&h.resize(p);for(let A=-m;A<0;A++)h.emplace(A+p,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,p=0;for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:A,numIconVertices:R}=m,y=m.zOffset,T=R>0;if((x>0||A>0)&&(t(this.text.zOffsetVertexArray,x,y),t(this.text.zOffsetVertexArray,A,y)),T){const{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:E}=m;C>=0&&o(this.icon.zOffsetVertexArray,R,y),E>=0&&o(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,y)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=oI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,o){const c=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:p,y:h}of o)this.lineVertexArray.emplaceBack(p,h);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,o,c,p,h,m,x,A,R,y,T,C,E,S,P,O){const F=t.indexArray,j=t.layoutVertexArray,G=t.globeExtVertexArray,N=t.segments.prepareSegment(4*o.length,j,F,this.canOverlap?m.sortKey:void 0),Z=this.glyphOffsetArray.length,K=N.vertexLength,ie=this.allowVerticalPlacement&&x===Ia.vertical?Math.PI/2:0,ue=m.text&&m.text.sections;for(let le=0;le<o.length;le++){const{tl:xe,tr:me,bl:Ee,br:Pe,texPrimary:Be,texSecondary:ze,pixelOffsetTL:Ge,pixelOffsetBR:rt,minFontScaleX:Ze,minFontScaleY:ft,glyphOffset:xt,isSDF:lt,sectionIndex:Yt}=o[le],Vt=N.vertexLength,Mt=xt[1];if(J_(j,R.x,R.y,xe.x,Mt+xe.y,Be.x,Be.y,c,lt,Ge.x,Ge.y,Ze,ft),J_(j,R.x,R.y,me.x,Mt+me.y,Be.x+Be.w,Be.y,c,lt,rt.x,Ge.y,Ze,ft),J_(j,R.x,R.y,Ee.x,Mt+Ee.y,Be.x,Be.y+Be.h,c,lt,Ge.x,rt.y,Ze,ft),J_(j,R.x,R.y,Pe.x,Mt+Pe.y,Be.x+Be.w,Be.y+Be.h,c,lt,rt.x,rt.y,Ze,ft),A){const{x:Et,y:yr,z:Xt}=A.anchor,[tr,Mr,$r]=A.up;ey(G,Et,yr,Xt,tr,Mr,$r),ey(G,Et,yr,Xt,tr,Mr,$r),ey(G,Et,yr,Xt,tr,Mr,$r),ey(G,Et,yr,Xt,tr,Mr,$r),ty(t.dynamicLayoutVertexArray,Et,yr,Xt,ie)}else ty(t.dynamicLayoutVertexArray,R.x,R.y,R.z,ie);if(O){const Et=ze||Be;Q_(t.iconTransitioningVertexArray,Et.x,Et.y),Q_(t.iconTransitioningVertexArray,Et.x+Et.w,Et.y),Q_(t.iconTransitioningVertexArray,Et.x,Et.y+Et.h),Q_(t.iconTransitioningVertexArray,Et.x+Et.w,Et.y+Et.h)}F.emplaceBack(Vt,Vt+1,Vt+2),F.emplaceBack(Vt+1,Vt+2,Vt+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xt[0]),le!==o.length-1&&Yt===o[le+1].sectionIndex||t.programConfigurations.populatePaintArrays(j.length,m,m.index,{},E,S,P,ue&&ue[Yt])}const de=A?A.anchor:R;t.placedSymbolArray.emplaceBack(de.x,de.y,de.z,R.x,R.y,Z,this.glyphOffsetArray.length-Z,K,y,T,R.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],x,0,!1,0,C,0)}_commitLayoutVertex(t,o,c,p,h,m,x){t.emplaceBack(o,c,p,h,m,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(t,o,c,p,h,m,x){const A=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),R=A.vertexLength,y=x.tileAnchorX,T=x.tileAnchorY;for(let E=0;E<4;E++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,o,t.padding,x.zOffset),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,T,new De(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,T,new De(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,T,new De(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,T,new De(t.x1,t.y2)),A.vertexLength+=4;const C=c.indexArray;C.emplaceBack(R,R+1),C.emplaceBack(R+1,R+2),C.emplaceBack(R+2,R+3),C.emplaceBack(R+3,R),A.primitiveLength+=4}_addTextDebugCollisionBoxes(t,o,c,p,h,m){for(let x=p;x<h;x++){const A=c.get(x),R=this.getSymbolInstanceTextSize(t,m,o,x);this._addCollisionDebugVertices(A,R,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(t,o,c,p,h,m){for(let x=p;x<h;x++){const A=c.get(x),R=this.getSymbolInstanceIconSize(t,o,m.placedIconSymbolIndex);this._addCollisionDebugVertices(A,R,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,m)}}generateCollisionDebugBuffers(t,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tb(Tc,SE.members,Wl),this.iconCollisionBox=new Tb(Tc,SE.members,Wl);const c=rf(this.iconSizeData,t),p=rf(this.textSizeData,t);for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(p,t,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(p,t,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(c,t,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(c,t,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(t,o,c,p){const h=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:p),m=$_(this.textSizeData,t,h)/Eo;return this.tilePixelRatio*m}getSymbolInstanceIconSize(t,o,c){const p=this.icon.placedSymbolArray.get(c),h=$_(this.iconSizeData,t,p);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(t,o,c,p){t.emplaceBack(o,-c,-c,p),t.emplaceBack(o,c,-c,p),t.emplaceBack(o,c,c,p),t.emplaceBack(o,-c,c,p)}_updateTextDebugCollisionBoxes(t,o,c,p,h,m){for(let x=p;x<h;x++){const A=c.get(x),R=this.getSymbolInstanceTextSize(t,m,o,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,A.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(t,o,c,p,h,m){for(let x=p;x<h;x++){const A=c.get(x),R=this.getSymbolInstanceIconSize(t,o,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,A.padding,m.zOffset)}}updateCollisionDebugBuffers(t,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=rf(this.iconSizeData,t),p=rf(this.textSizeData,t);for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(p,t,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(p,t,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(c,t,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(c,t,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,o,c,p,h,m,x,A,R){const y={};if(o<c){const{x1:T,y1:C,x2:E,y2:S,padding:P,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:j,tileAnchorX:G,tileAnchorY:N,featureIndex:Z}=t.get(o);y.textBox={x1:T,y1:C,x2:E,y2:S,padding:P,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:j,tileAnchorX:G,tileAnchorY:N},y.textFeatureIndex=Z}if(p<h){const{x1:T,y1:C,x2:E,y2:S,padding:P,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:j,tileAnchorX:G,tileAnchorY:N,featureIndex:Z}=t.get(p);y.verticalTextBox={x1:T,y1:C,x2:E,y2:S,padding:P,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:j,tileAnchorX:G,tileAnchorY:N},y.verticalTextFeatureIndex=Z}if(m<x){const{x1:T,y1:C,x2:E,y2:S,padding:P,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:j,tileAnchorX:G,tileAnchorY:N,featureIndex:Z}=t.get(m);y.iconBox={x1:T,y1:C,x2:E,y2:S,padding:P,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:j,tileAnchorX:G,tileAnchorY:N},y.iconFeatureIndex=Z}if(A<R){const{x1:T,y1:C,x2:E,y2:S,padding:P,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:j,tileAnchorX:G,tileAnchorY:N,featureIndex:Z}=t.get(A);y.verticalIconBox={x1:T,y1:C,x2:E,y2:S,padding:P,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:j,tileAnchorX:G,tileAnchorY:N},y.verticalIconFeatureIndex=Z}return y}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,o){const c=t.placedSymbolArray.get(o),p=c.vertexStartIndex+4*c.numGlyphs;for(let h=c.vertexStartIndex;h<p;h+=4)t.indexArray.emplaceBack(h,h+1,h+2),t.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(t),c=Math.cos(t),p=[],h=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);const A=this.symbolInstances.get(x);p.push(0|Math.round(o*A.tileAnchorX+c*A.tileAnchorY)),h.push(A.featureIndex)}return m.sort((x,A)=>p[x]-p[A]||h[A]-h[x]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,o){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===o?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const c=this.symbolInstances.get(o);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:R}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),h>=0&&h!==p&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&m!==p&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let sI,aI,Eb;rr(ry,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ry.addDynamicAttributes=ty;class lI{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Go,this.defaultValue=t}evaluate(t){if(t.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rr(lI,"FormatSectionOverride",{omit:["defaultValue"]});const Ib=()=>Eb||(Eb={layout:sI||(sI=new si({"symbol-placement":new Ot(tt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ot(tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ot(tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pr(tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ot(tt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ot(tt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Ot(tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ot(tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ot(tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ot(tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new pr(tt.layout_symbol["icon-size"]),"icon-text-fit":new pr(tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pr(tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new pr(tt.layout_symbol["icon-image"]),"icon-rotate":new pr(tt.layout_symbol["icon-rotate"]),"icon-padding":new Ot(tt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ot(tt.layout_symbol["icon-keep-upright"]),"icon-offset":new pr(tt.layout_symbol["icon-offset"]),"icon-anchor":new pr(tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ot(tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ot(tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ot(tt.layout_symbol["text-rotation-alignment"]),"text-field":new pr(tt.layout_symbol["text-field"]),"text-font":new pr(tt.layout_symbol["text-font"]),"text-size":new pr(tt.layout_symbol["text-size"]),"text-max-width":new pr(tt.layout_symbol["text-max-width"]),"text-line-height":new pr(tt.layout_symbol["text-line-height"]),"text-letter-spacing":new pr(tt.layout_symbol["text-letter-spacing"]),"text-justify":new pr(tt.layout_symbol["text-justify"]),"text-radial-offset":new pr(tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ot(tt.layout_symbol["text-variable-anchor"]),"text-anchor":new pr(tt.layout_symbol["text-anchor"]),"text-max-angle":new Ot(tt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ot(tt.layout_symbol["text-writing-mode"]),"text-rotate":new pr(tt.layout_symbol["text-rotate"]),"text-padding":new Ot(tt.layout_symbol["text-padding"]),"text-keep-upright":new Ot(tt.layout_symbol["text-keep-upright"]),"text-transform":new pr(tt.layout_symbol["text-transform"]),"text-offset":new pr(tt.layout_symbol["text-offset"]),"text-allow-overlap":new Ot(tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ot(tt.layout_symbol["text-ignore-placement"]),"text-optional":new Ot(tt.layout_symbol["text-optional"]),visibility:new Ot(tt.layout_symbol.visibility)})),paint:aI||(aI=new si({"icon-opacity":new pr(tt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new pr(tt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new pr(tt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new pr(tt.paint_symbol["text-emissive-strength"]),"icon-color":new pr(tt.paint_symbol["icon-color"]),"icon-halo-color":new pr(tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new pr(tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pr(tt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ot(tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ot(tt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new pr(tt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new pr(tt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new pr(tt.paint_symbol["text-occlusion-opacity"]),"text-color":new pr(tt.paint_symbol["text-color"],{runtimeType:ro,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new pr(tt.paint_symbol["text-halo-color"]),"text-halo-width":new pr(tt.paint_symbol["text-halo-width"]),"text-halo-blur":new pr(tt.paint_symbol["text-halo-blur"]),"text-translate":new Ot(tt.paint_symbol["text-translate"]),"text-translate-anchor":new Ot(tt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ot(tt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ot(tt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ot(tt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ot(tt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new pr(tt.paint_symbol["symbol-z-offset"]),"symbol-elevation-reference":new Ot(tt.paint_symbol["symbol-elevation-reference"])}))},Eb);class ny extends zo{constructor(t,o,c,p){super(t,Ib(),o,c,p),this._colorAdjustmentMatrix=_e.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}recalculate(t,o){super.recalculate(t,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const h of c)p.indexOf(h)<0&&p.push(h);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,o,c,p){return this._saturation===t&&this._contrast===o&&this._brightnessMin===c&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(h,m,x,A){h=ve(h),m=oe(m);const R=_e.mat4.create(),y=h/3,T=1-2*y,C=[T,y,y,0,y,T,y,0,y,y,T,0,0,0,0,1],E=.5-.5*m,S=A-x;return _e.mat4.multiply(R,[S,0,0,0,0,S,0,0,0,0,S,0,x,x,x,1],[m,0,0,0,0,m,0,0,0,0,m,0,E,E,E,1]),_e.mat4.multiply(R,R,C),R}(t,o,c,p),this._saturation=t,this._contrast=o,this._brightnessMin=c,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,o,c,p){const h=this.layout.get(t).evaluate(o,{},c,p),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||kd(m.value)||!h?h:function(x,A){return A.replace(/{([^{}]+)}/g,(R,y)=>y in x?String(x[y]):"")}(o.properties,h)}createBucket(t){return new ry(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Ib().paint.overridableProperties){if(!ny.hasPaintOverride(this.layout,t))continue;const o=this.paint.get(t),c=new lI(o),p=new Rd(c,o.property.specification,this.scope,this.options);let h=null;h=o.value.kind==="constant"||o.value.kind==="source"?new wp("source",p):new Xa("composite",p,o.value.zoomStops,o.value._interpolationType),this.paint._values[t]=new lu(o.property,h,o.parameters)}}_handleOverridablePaintPropertyUpdate(t,o,c){return!(!this.layout||o.isDataDriven()||c.isDataDriven())&&ny.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,o){const c=t.get("text-field"),p=Ib().paint.properties[o];let h=!1;const m=x=>{for(const A of x)if(p.overrides&&p.overrides.hasOverride(A))return void(h=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Xi)m(c.value.value.sections);else if(c.value.kind==="source"){const x=R=>{h||(R instanceof Lo&&ii(R.value)===Hs?m(R.value.sections):R instanceof Ho?m(R.sections):R.eachChild(x))},A=c.value;A._styleExpression&&x(A._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,o,c){return{config:new Ic(this,{zoom:o,lut:c}),overrideFog:!1}}}let cI,uI,hI,dI;var Ab=dn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Sb(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Cb(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Rb{constructor(t,o,c,p){this.context=t,this.format=c,this.useMipmap=p&&p.useMipmap,this.texture=t.gl.createTexture(),this.update(o,{premultiply:p&&p.premultiply})}update(t,o){const c=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,p=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:h}=this,{gl:m}=h,{x,y:A}=o&&o.position?o.position:{x:0,y:0},R=Math.max(x+c,this.size?this.size[0]:0),y=Math.max(A+p,this.size?this.size[1]:0);!this.size||this.size[0]===R&&this.size[1]===y||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!o||o.premultiply!==!1));const T=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&R>0&&y>0){const C=this.useMipmap?Math.floor(Math.log2(Math.max(R,y)))+1:1;m.texStorage2D(m.TEXTURE_2D,C,this.format,R,y),this.size=[R,y]}if(this.size)if(T)m.texSubImage2D(m.TEXTURE_2D,0,x,A,Sb(this.format),Cb(this.format),t);else{const C=t.data;C&&m.texSubImage2D(m.TEXTURE_2D,0,x,A,c,p,Sb(this.format),Cb(this.format),C)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(t,o,c=!1){const{context:p}=this,{gl:h}=p;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!c?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(t,o,c,p){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),o!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),this.magFilter=o),t!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?t===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),this.wrapS=c),p!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class iy{constructor(t,o){this.context=t,this.texture=o}bind(t,o){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),t!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,t),this.minFilter=t),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrapS=o)}}function oy(l,t,o,c,p,h,m,x){const A=[l,t,1,o,c,1,p,h,1],R=[m,x,1],y=_e.mat3.adjoint([],A),[T,C,E]=_e.vec3.transformMat3(R,R,y);return _e.mat3.multiply(A,A,[T,0,0,0,C,0,0,0,E])}function fI(l,t,o,c,p,h,m,x){const A=function(R,y,T,C,E,S,P,O){const F=oy(0,0,1,0,1,1,0,1),j=oy(R,y,T,C,E,S,P,O),G=_e.mat3.adjoint([],F);return _e.mat3.multiply(j,j,G)}(l,t,o,c,p,h,m,x);return[A[2]/A[8]/Ut,A[5]/A[8]/Ut]}function sy(l){return[l[0],Math.min(Math.max(l[1],-Te),Te)]}class pI extends ga{constructor(t,o,c,p){super(),this.id=t,this.dispatcher=c,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=o,this._dirty=!1}load(t,o){if(this._loaded=o||!1,this.fire(new Rs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Zi(this.map._requestManager.transformRequest(this.url,$s.Image),(c,p)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new za(c)):p&&(this.image=p instanceof HTMLImageElement?Ht.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new iy(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Rs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof iy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=t[0][1],c=t[0][1];for(const h of t)h[1]>c&&(c=h[1]),h[1]<o&&(o=h[1]);const p=(c+o)/2;if(p>Te?this.onNorthPole=!0:p<-Te&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=t.map(Xe.fromLngLat);this.tileID=function(m){let x=1/0,A=1/0,R=-1/0,y=-1/0;for(const P of m)x=Math.min(x,P.x),A=Math.min(A,P.y),R=Math.max(R,P.x),y=Math.max(y,P.y);const T=Math.max(R-x,y-A),C=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),E=Math.pow(2,C);let S=Math.floor((x+R)/2*E);return S>1&&(S-=1),new no(C,S,Math.floor((A+y)/2*E))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Rs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const F in this.tiles){const j=this.tiles[F];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=um(new no(0,0,0),this.map.transform.projection),c=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(F){const j=F[1].x-F[0].x,G=F[1].y-F[0].y,N=F[2].x-F[1].x,Z=F[2].y-F[1].y,K=F[3].x-F[2].x,ie=F[3].y-F[2].y,ue=F[0].x-F[3].x,de=F[0].y-F[3].y,le=j*Z-N*G,xe=N*ie-K*Z,me=K*de-ue*ie,Ee=ue*G-j*de;return le>0&&xe>0&&me>0&&Ee>0||le<0&&xe<0&&me<0&&Ee<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=um(this.tileID,this.map.transform.projection),[h,m,x,A]=this.coordinates.map(F=>{const j=p.projection.project(F[0],F[1]);return eI(p,j)._round()});this.perspectiveTransform=fI(h.x,h.y,m.x,m.y,x.x,x.y,A.x,A.y);const R=this._boundsArray=new Gl;R.emplaceBack(h.x,h.y,0,0),R.emplaceBack(m.x,m.y,Ut,0),R.emplaceBack(A.x,A.y,0,Ut),R.emplaceBack(x.x,x.y,Ut,Ut),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(R,Ab.members),this.boundsSegments=Ti.simpleSegment(0,0,4,2);const y=[],T=[sy((C=this.coordinates)[0]),sy(C[1]),sy(C[2]),sy(C[3])];var C;const[E,S,P,O]=function(F){let j=F[0][0],G=j,N=F[0][1],Z=N;for(let K=1;K<F.length;K++)F[K][0]<j?j=F[K][0]:F[K][0]>G&&(G=F[K][0]),F[K][1]<N?N=F[K][1]:F[K][1]>Z&&(Z=F[K][1]);return[j,N,G-j,Z-N]}(T);{const F=new Gl,[j,G,N,Z]=function(Ge){let rt=Ge[0].x,Ze=rt,ft=Ge[0].y,xt=ft;for(let lt=1;lt<Ge.length;lt++)Ge[lt].x<rt?rt=Ge[lt].x:Ge[lt].x>Ze&&(Ze=Ge[lt].x),Ge[lt].y<ft?ft=Ge[lt].y:Ge[lt].y>xt&&(xt=Ge[lt].y);return[rt,ft,Ze-rt,xt-ft]}(c),K=Ge=>[(Ge.x-j)/N,(Ge.y-G)/Z],[ie,ue,de,le]=c.map(K),xe=function(Ge,rt,Ze,ft,xt,lt,Yt,Vt){const Mt=oy(0,0,1,0,1,1,0,1),Et=oy(Ge,rt,Ze,ft,xt,lt,Yt,Vt),yr=_e.mat3.adjoint([],Et);return _e.mat3.multiply(Mt,Mt,yr)}(ie[0],ie[1],ue[0],ue[1],de[0],de[1],le[0],le[1]);this.elevatedGlobePerspectiveTransform=fI(ie[0],ie[1],ue[0],ue[1],de[0],de[1],le[0],le[1]);const me=(Ge,rt)=>{y.push(Ge.lng);const Ze=Math.round((Ge.lng-E)/P*Ut),ft=Math.round((Ge.lat-S)/O*Ut),xt=K(rt),lt=_e.vec3.transformMat3([],[xt[0],xt[1],1],xe),Yt=Math.round(lt[0]/lt[2]*Ut),Vt=Math.round(lt[1]/lt[2]*Ut);F.emplaceBack(Ze,ft,Yt,Vt)},Ee=c[3].x-c[0].x,Pe=c[3].y-c[0].y,Be=c[2].x-c[1].x,ze=c[2].y-c[1].y;for(let Ge=0;Ge<65;Ge++){const rt=Ge/64,Ze=[c[0].x+rt*Ee,c[0].y+rt*Pe],ft=[c[1].x+rt*Be,c[1].y+rt*ze],xt=ft[0]-Ze[0],lt=ft[1]-Ze[1];for(let Yt=0;Yt<65;Yt++){const Vt=Yt/64,Mt={x:Ze[0]+xt*Vt,y:Ze[1]+lt*Vt,z:0};me(o.projection.unproject(Mt.x,Mt.y),Mt)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(F,Ab.members)}{this.maxLongitudeTriangleSize=0;let F=[],j=new po;const G=(N,Z,K)=>{j.emplaceBack(N,Z,K);const ie=y[N],ue=y[Z],de=y[K],le=Math.min(Math.min(ie,ue),de),xe=Math.max(Math.max(ie,ue),de)-le;xe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=xe),F.push(le+xe/2)};for(let N=0;N<64;N++)for(let Z=0;Z<64;Z++){const K=65*N+Z,ie=K+1,ue=K+65,de=ue+1;G(K,ue,ie),G(ie,ue,de)}[F,j]=function(N,Z){const K=Array.from({length:N.length},(de,le)=>le);K.sort((de,le)=>N[de]-N[le]);const ie=[],ue=new po;for(let de=0;de<K.length;de++){const le=K[de];ie.push(N[le]);const xe=3*le,me=xe+1;ue.emplaceBack(Z.uint16[xe],Z.uint16[me],Z.uint16[me+1])}return[ie,ue]}(F,j),this.elevatedGlobeTrianglesCenterLongitudes=F,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(j)}this.elevatedGlobeSegments=Ti.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,P/Ut,0,O/Ut,0,0,S,E,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const o=this.map.painter.context,c=o.gl;!this._dirty||this.texture instanceof iy||(this.texture?this.texture.update(this.image):(this.texture=new Rb(o,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(o)}loadTile(t,o){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},o(null)):(t.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let p=(h=t+180)+360*Math.round((c[0]-h)/360);var h;const m=new Ti,x=(T,C)=>{m.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:o.segments[0].vertexLength,primitiveLength:C,sortKey:void 0,vaos:{}})},A=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-p)<=A){const T=ne(c,0,c.length,p+A);return T===c.length||x(T,nt(c,T+1,c.length,p+360-A)-T),m}p<c[0]&&(p+=360);const R=nt(c,0,c.length,p-A);if(R===c.length)return x(0,c.length),m;x(0,R-0);const y=ne(c,R+1,c.length,p+A);return y!==c.length&&x(y,c.length-y),m}}const OO=(Math.pow(256,2)-1)/16907520;class mI extends zo{constructor(t,o,c,p){super(t,{layout:hI||(hI=new si({visibility:new Ot(tt.layout_raster.visibility)})),paint:dI||(dI=new si({"raster-opacity":new Ot(tt.paint_raster["raster-opacity"]),"raster-color":new wa(tt.paint_raster["raster-color"]),"raster-color-mix":new Ot(tt.paint_raster["raster-color-mix"]),"raster-color-range":new Ot(tt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ot(tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ot(tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ot(tt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ot(tt.paint_raster["raster-saturation"]),"raster-contrast":new Ot(tt.paint_raster["raster-contrast"]),"raster-resampling":new Ot(tt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ot(tt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ot(tt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ot(tt.paint_raster["raster-array-band"]),"raster-elevation":new Ot(tt.paint_raster["raster-elevation"])}))},o,c,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof pI&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[c,p]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(p)||c===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=Xp({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,p])}}let gI,_I,yI,vI,bI;class xI extends zo{constructor(t,o,c,p){super(t,{layout:gI||(gI=new si({visibility:new Ot(tt["layout_raster-particle"].visibility)})),paint:_I||(_I=new si({"raster-particle-array-band":new Ot(tt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ot(tt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new wa(tt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ot(tt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ot(tt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ot(tt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ot(tt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ot(tt["paint_raster-particle"]["raster-particle-elevation"])}))},o,c,p),this._updateColorRamp(),this.lastInvalidatedAt=Ht.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Xp({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ht.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class BO extends zo{constructor(t,o){super(t,{},o,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function kb(l,t,o){const c=[0,0,1],p=_e.quat.identity([]);return _e.quat.rotateY(p,p,o?-Dt(l)+Math.PI:Dt(l)),_e.quat.rotateX(p,p,-Dt(t)),_e.vec3.transformQuat(c,c,p),_e.vec3.normalize(c,c)}function wI(l,t){const o=ay(l.projection,l.zoom,l.width,l.height),c=function(h,m,x,A,R){const y=new q(x.lng-180*Au,x.lat),T=new q(x.lng+180*Au,x.lat),C=h.project(y.lng,y.lat),E=h.project(T.lng,T.lat),S=-Math.atan2(E.y-C.y,E.x-C.x),P=Xe.fromLngLat(x);P.y=Ft(P.y,-1+Au,1-Au);const O=P.toLngLat(),F=h.project(O.lng,O.lat),j=Xe.fromLngLat(O);j.x+=Au;const G=j.toLngLat(),N=h.project(G.lng,G.lat),Z=EI(N.x-F.x,N.y-F.y,S),K=Xe.fromLngLat(O);K.y+=Au;const ie=K.toLngLat(),ue=h.project(ie.lng,ie.lat),de=EI(ue.x-F.x,ue.y-F.y,S),le=Math.abs(Z.x)/Math.abs(de.y),xe=_e.mat4.identity([]);_e.mat4.rotateZ(xe,xe,-S*(1-(R?0:A)));const me=_e.mat4.identity([]);return _e.mat4.scale(me,me,[1,1-(1-le)*A,1]),me[4]=-de.x/de.y*A,_e.mat4.rotateZ(me,me,S),_e.mat4.multiply(me,xe,me),me}(l.projection,0,l.center,o,t),p=TI(l);return _e.mat4.scale(c,c,[p,p,1]),c}function TI(l){const t=l.projection,o=ay(l.projection,l.zoom,l.width,l.height),c=Pb(t,l.center),p=Pb(t,q.convert(t.center));return Math.pow(2,c*o+(1-o)*p)}function ay(l,t,o,c,p=1/0){const h=l.range;if(!h)return 0;const m=Math.min(p,Math.max(o,c)),x=Math.log(m/1024)/Math.LN2;return Ir(h[0]+x,h[1]+x,t)}const Au=1/4e4;function Pb(l,t){const o=Ft(t.lat,-Te,Te),c=new q(t.lng-180*Au,o),p=new q(t.lng+180*Au,o),h=l.project(c.lng,o),m=l.project(p.lng,o),x=Xe.fromLngLat(c),A=Xe.fromLngLat(p),R=m.x-h.x,y=m.y-h.y,T=A.x-x.x,C=A.y-x.y,E=Math.sqrt((T*T+C*C)/(R*R+y*y));return Math.log(E)/Math.LN2}function EI(l,t,o){const c=Math.cos(o),p=Math.sin(o);return{x:l*c-t*p,y:l*p+t*c}}function II(l,t,o){_e.mat4.identity(l),_e.mat4.rotateZ(l,l,Dt(t[2])),_e.mat4.rotateX(l,l,Dt(t[0])),_e.mat4.rotateY(l,l,Dt(t[1])),_e.mat4.scale(l,l,o),_e.mat4.multiply(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ly(l,t,o,c,p,h,m,x){const A=[o[0]-t[0],o[1]-t[1],0],R=[c[0]-t[0],c[1]-t[1],0];if(_e.vec3.length(A)<1e-12||_e.vec3.length(R)<1e-12)return _e.quat.identity(l);const y=_e.vec3.cross([],A,R);_e.vec3.normalize(y,y),_e.vec3.subtract(R,c,t),A[2]=(h-p)*x,R[2]=(m-p)*x;const T=A;return _e.vec3.cross(T,A,R),_e.vec3.normalize(T,T),_e.quat.rotationTo(l,y,T)}function Mb(l,t,o=!1){const c=bu(t.zoom),p=function(h,m,x){const A=m.worldSize,R=[h[12],h[13],h[14]],y=ge(R[1]/A),T=ye(R[0]/A),C=_e.mat4.identity([]),E=ce(1,y)*A,S=ce(1,0)*A*Oe(y,m.zoom),P=1/Hv(A);let O=S*P;if(x){const N=ay(m.projection,m.zoom,m.width,m.height,1024);O=P*m.projection.pixelSpaceConversion(m.center.lat,A,N)}const F=z(y,T);_e.vec3.add(F,F,_e.vec3.scale([],_e.vec3.normalize([],F),E*O*R[2]));const j=function(N){const Z=[N[0],N[1],N[2]];let K=[0,1,0];const ie=_e.vec3.cross([],K,Z);return _e.vec3.cross(K,Z,ie),_e.vec3.squaredLength(K)===0&&(K=[0,1,0],_e.vec3.cross(ie,Z,K)),_e.vec3.normalize(ie,ie),_e.vec3.normalize(K,K),_e.vec3.normalize(Z,Z),[ie[0],ie[1],ie[2],0,K[0],K[1],K[2],0,Z[0],Z[1],Z[2],0,N[0],N[1],N[2],1]}(F);_e.mat4.scale(C,C,[O,O,O*E]),_e.mat4.translate(C,C,[-R[0],-R[1],-R[2]]);const G=_e.mat4.multiply([],m.globeMatrix,j);return _e.mat4.multiply(G,G,C),_e.mat4.multiply(G,G,h),G}(l,t,o);if(c>0){const h=function(m,x){const A=x.worldSize,R=ce(1,0)*A*Oe(x.center.lat,x.zoom)/Hv(A),y=ce(1,x.center.lat)*A,T=_e.mat4.identity([]);return _e.mat4.rotateY(T,T,Dt(x.center.lng)),_e.mat4.rotateX(T,T,Dt(x.center.lat)),_e.mat4.translate(T,T,[0,0,r]),_e.mat4.scale(T,T,[R,R,R*y]),_e.mat4.translate(T,T,[x.point.x-.5*A,x.point.y-.5*A,0]),_e.mat4.multiply(T,T,m),_e.mat4.multiply(T,x.globeMatrix,T)}(l,t);return function(m,x,A){const R=(S,P,O)=>{const F=_e.vec3.length(S),j=_e.vec3.length(P),G=Sc(S,P,O);return _e.vec3.scale(G,G,1/_e.vec3.length(G)*xr(F,j,O))},y=R([m[0],m[1],m[2]],[x[0],x[1],x[2]],A),T=R([m[4],m[5],m[6]],[x[4],x[5],x[6]],A),C=R([m[8],m[9],m[10]],[x[8],x[9],x[10]],A),E=Sc([m[12],m[13],m[14]],[x[12],x[13],x[14]],A);return[y[0],y[1],y[2],0,T[0],T[1],T[2],0,C[0],C[1],C[2],0,E[0],E[1],E[2],1]}(p,h,c)}return p}function AI(l,t,o,c){const p=Gn.projectAabbCorners(c,o);let h=Number.MAX_VALUE,m=-1;for(let R=0;R<p.length;++R){const y=p[R];y[0]=(.5*y[0]+.5)*t.width,y[1]=(.5-.5*y[1])*t.height,y[2]<h&&(m=R,h=y[2])}const x=R=>new De(p[R][0],p[R][1]);let A;switch(m){case 0:case 6:A=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:A=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:A=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:A=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(Nt(l,A))return h}const zO=dn([{name:"a_pos_3f",components:3,type:"Float32"}]),FO=dn([{name:"a_color_3f",components:3,type:"Float32"}]),NO=dn([{name:"a_color_4f",components:4,type:"Float32"}]),VO=dn([{name:"a_uv_2f",components:2,type:"Float32"}]),UO=dn([{name:"a_normal_3f",components:3,type:"Float32"}]),jO=dn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),$O=dn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),SI={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class cy{constructor(t,o,c,p){this.message=(t?`${t}: `:"")+c,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)}}function CI(l,t){const o=l.indexOf("://")===-1;try{return new URL(l,o&&t?"http://example.com":void 0),!0}catch{return!1}}class RI{constructor(t,o){this.feature=t,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class kI{constructor(){this.instancedDataArray=new Rh,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Db{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(t,o){}populate(t,o,c,p){this.tileToMeter=Re(c);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:x,index:A,sourceLayerIndex:R}of t){const y=x??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),T=Lt(m,h);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),T,c))continue;const C={id:y,sourceLayerIndex:R,index:A,geometry:h?T.geometry:Pt(m,c,p),properties:m.properties,type:m.type,patterns:{}},E=this.addFeature(C,C.geometry,T);E&&o.featureIndex.insert(m,C.geometry,A,R,this.index,this.instancesPerModel[E].instancedDataArray.length,Ut/32)}this.lookup=null}update(t,o,c,p){for(const h in this.instancesPerModel){const m=this.instancesPerModel[h];for(const x in t)m.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(m.features[m.idToFeaturesIndex[x]],t[x],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const o in this.instancesPerModel){const c=this.instancesPerModel[o];for(const p of c.features){const h=this.layers[0],m=p.feature,x=this.canonical,A=h.paint.get("model-rotation").evaluate(m,{},x),R=h.paint.get("model-scale").evaluate(m,{},x),y=h.paint.get("model-translation").evaluate(m,{},x);_e.vec3.exactEquals(p.rotation,A)&&_e.vec3.exactEquals(p.scale,R)&&_e.vec3.exactEquals(p.translation,y)||(this.evaluate(p,p.featureStates,c,!0),t=!0)}}return t}updateReplacement(t,o,c,p){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(ob(this.activeReplacements,h))return!1;this.activeReplacements=h;let m=!1;for(const x in this.instancesPerModel){const A=this.instancesPerModel[x],R=A.instancedDataArray;for(const y of A.features){const T=y.instancedDataOffset,C=y.instancedDataCount;for(let E=0;E<C;E++){const S=16*(E+T);let P=R.float32[S+0];const O=P>Ut;P=O?P-Ut:P;const F=Math.floor(P),j=R.float32[S+1];let G=!1;for(const N of this.activeReplacements)if(!GT(N,c,SI.Model,p)&&!(N.min.x>F||F>N.max.x||N.min.y>j||j>N.max.y)&&(G=YT(KT(F,j,t.canonical,N.footprintTileId.canonical),N.footprint),G))break;R.float32[S]=G?P+Ut:P,m=m||G!==O}}}return m}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const o in this.instancesPerModel){const c=this.instancesPerModel[o];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=t.createVertexBuffer(c.instancedDataArray,jO.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const c=this.instancesPerModel[o];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris)for(const o of this.modelUris)t.removeModel(o,"")}addFeature(t,o,c){const p=this.layers[0],h=p.layout.get("model-id").evaluate(c,{},this.canonical);if(!h)return nn(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),h;CI(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new kI);const m=this.instancesPerModel[h],x=m.instancedDataArray,A=new RI(c,x.length);for(const R of o)for(const y of R){if(y.x<0||y.x>=Ut||y.y<0||y.y>=Ut)continue;const T=(this.lookupDim-1)/Ut,C=this.lookupDim*(y.y*T|0)+y.x*T|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;const E=x.length;x.resize(E+1),m.instancesEvaluatedElevation.push(0),x.float32[16*E]=y.x,x.float32[16*E+1]=y.y}return A.instancedDataCount=m.instancedDataArray.length-A.instancedDataOffset,A.instancedDataCount>0&&(t.id&&(m.idToFeaturesIndex[t.id]=m.features.length),m.features.push(A),this.evaluate(A,{},m,!1)),h}getModelUris(){return this.modelUris}evaluate(t,o,c,p){const h=this.layers[0],m=t.feature,x=this.canonical,A=t.rotation=h.paint.get("model-rotation").evaluate(m,o,x),R=t.scale=h.paint.get("model-scale").evaluate(m,o,x),y=t.translation=h.paint.get("model-translation").evaluate(m,o,x),T=h.paint.get("model-color").evaluate(m,o,x);T.a=h.paint.get("model-color-mix-intensity").evaluate(m,o,x);const C=[];this.maxVerticalOffset<y[2]&&(this.maxVerticalOffset=y[2]),this.maxScale=Math.max(Math.max(this.maxScale,R[0]),Math.max(R[1],R[2])),II(C,A,R);const E=Math.round(100*T.a)+T.b/1.05;for(let S=0;S<t.instancedDataCount;++S){const P=t.instancedDataOffset+S,O=16*P,F=c.instancedDataArray.float32;let j=0;p&&(j=F[O+6]-c.instancesEvaluatedElevation[P]);const G=0|F[O+1];F[O]=(0|F[O])+T.r/1.05,F[O+1]=G+T.g/1.05,F[O+2]=E,F[O+3]=1/(x.z>10?this.tileToMeter:Re(x,G)),F[O+4]=y[0],F[O+5]=y[1],F[O+6]=y[2]+j,F[O+7]=C[0],F[O+8]=C[1],F[O+9]=C[2],F[O+10]=C[4],F[O+11]=C[5],F[O+12]=C[6],F[O+13]=C[8],F[O+14]=C[9],F[O+15]=C[10],c.instancesEvaluatedElevation[P]=y[2]}}}let PI,MI;rr(Db,"ModelBucket",{omit:["layers"]}),rr(kI,"PerModelAttributes"),rr(RI,"ModelFeature");const Bh=64,lf={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function DI(l,t,o,c,p,h,m,x,A,R=!1){const y=o.zoom,T=o.project(c),C=Oe(c.lat,y),E=1/C;_e.mat4.identity(l),_e.mat4.translate(l,l,[T.x+m[0]*E,T.y+m[1]*E,m[2]]);let S=1,P=1;const O=o.worldSize;if(R){if(o.projection.name==="mercator"){let N=0;o.elevation&&(N=o.elevation.getAtPointOrZero(new Xe(T.x/O,T.y/O),0));const Z=_e.vec4.transformMat4([],[T.x,T.y,N,1],o.projMatrix)[3]/o.cameraToCenterDistance;S=Z,P=Z*Oe(o.center.lat,y)}else if(o.projection.name==="globe"){const N=Mb(l,o),Z=_e.mat4.multiply([],o.projMatrix,N),K=[0,0,0,1];_e.vec4.transformMat4(K,K,Z);const ie=K[3]/o.cameraToCenterDistance,ue=bu(y),de=o.projection.pixelsPerMeter(c.lat,O)*Oe(c.lat,y),le=o.projection.pixelsPerMeter(o.center.lat,O)*Oe(o.center.lat,y);S=ie/xr(de,Se(o.center.lat),ue),P=ie*C/de,S*=le,P*=le}}else S=E;_e.mat4.scale(l,l,[S,S,P]);const F=[...l],j=t.orientation,G=[];if(II(G,[j[0]+p[0],j[1]+p[1],j[2]+p[2]],h),_e.mat4.multiply(l,F,G),x&&o.elevation){let N=0;const Z=[];if(A&&o.elevation){N=function(ue,de,le,xe,me){const Ee=de.elevation;if(!Ee)return 0;const Pe=Gn.projectAabbCorners(le,xe),Be=ce(1,me.lat)*de.worldSize,ze=function(yr,Xt){const tr=[0,0,1],Mr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const $r of Mr){const Br=yr[$r.corners[0]],zr=yr[$r.corners[1]],Zr=yr[$r.corners[2]],Yr=[zr[0]-Br[0],zr[1]-Br[1],Xt*(zr[2]-Br[2])],Fn=_e.vec3.cross(Yr,Yr,[Zr[0]-Br[0],Zr[1]-Br[1],Xt*(Zr[2]-Br[2])]);_e.vec3.normalize(Fn,Fn),$r.dotProductWithUp=_e.vec3.dot(Fn,tr)}return Mr.sort(($r,Br)=>$r.dotProductWithUp-Br.dotProductWithUp),Mr[0].corners}(Pe,Be),Ge=Pe[ze[0]],rt=Pe[ze[1]],Ze=Pe[ze[2]],ft=Pe[ze[3]],xt=Ee.getAtPointOrZero(new Xe(Ge[0]/de.worldSize,Ge[1]/de.worldSize),0),lt=Ee.getAtPointOrZero(new Xe(rt[0]/de.worldSize,rt[1]/de.worldSize),0),Yt=Ee.getAtPointOrZero(new Xe(Ze[0]/de.worldSize,Ze[1]/de.worldSize),0),Vt=Ee.getAtPointOrZero(new Xe(ft[0]/de.worldSize,ft[1]/de.worldSize),0),Mt=(xt+Vt)/2,Et=(lt+Yt)/2;return Mt>Et?lt<Yt?ly(ue,rt,ft,Ge,lt,Vt,xt,Be):ly(ue,Ze,Ge,ft,Yt,xt,Vt,Be):xt<Vt?ly(ue,Ge,rt,Ze,xt,lt,Yt,Be):ly(ue,ft,Ze,rt,Vt,Yt,lt,Be),Math.max(Mt,Et)}(Z,o,t.aabb,l,c);const K=_e.mat4.fromQuat([],Z),ie=_e.mat4.multiply([],K,G);_e.mat4.multiply(l,F,ie)}else N=o.elevation.getAtPointOrZero(new Xe(T.x/O,T.y/O),0);N!==0&&(l[14]+=N)}}function mm(l,t,o=!1){l.uploaded||(l.gfxTexture=new Rb(t,l.image,o?t.gl.R8:t.gl.RGBA8,{useMipmap:l.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function qO(l,t,o){l.indexBuffer=t.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=t.createVertexBuffer(l.vertexArray,zO.members,!1,!0),l.normalArray&&(l.normalBuffer=t.createVertexBuffer(l.normalArray,UO.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=t.createVertexBuffer(l.texcoordArray,VO.members,!1,!0)),l.colorArray&&(l.colorBuffer=t.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?FO:NO).members,!1,!0)),l.featureArray&&(l.pbrBuffer=t.createVertexBuffer(l.featureArray,$O.members,!0)),l.segments=Ti.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const c=l.material;c.pbrMetallicRoughness.baseColorTexture&&mm(c.pbrMetallicRoughness.baseColorTexture,t),c.pbrMetallicRoughness.metallicRoughnessTexture&&mm(c.pbrMetallicRoughness.metallicRoughnessTexture,t),c.normalTexture&&mm(c.normalTexture,t),c.occlusionTexture&&mm(c.occlusionTexture,t,o),c.emissionTexture&&mm(c.emissionTexture,t)}function Lb(l,t,o){if(l.meshes)for(const c of l.meshes)qO(c,t,o);if(l.children)for(const c of l.children)Lb(c,t,o)}function uy(l){if(l.meshes)for(const t of l.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(l.children)for(const t of l.children)uy(t)}function Ob(l){if(l.meshes)for(const o of l.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((t=o.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(l.children)for(const o of l.children)Ob(o)}class cf{constructor(t,o,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=o,this._offset=c}static create(t,o,c){const p=c||t.findDEMTileFor(o);if(!p||!p.dem)return;const h=p.dem,m=p.tileID,x=1<<o.canonical.z-m.canonical.z;return new cf(p,h.dim/Ut/x,[(o.canonical.x/x-m.canonical.x)*h.dim,(o.canonical.y/x-m.canonical.y)*h.dim])}tileCoordToPixel(t,o){const c=o*this._scale+this._offset[1],p=Math.floor(t*this._scale+this._offset[0]),h=Math.floor(c);return new De(p,h)}getElevationAt(t,o,c,p){const h=t*this._scale+this._offset[0],m=o*this._scale+this._offset[1],x=Math.floor(h),A=Math.floor(m),R=this._dem;return p=!!p,c?xr(xr(R.get(x,A,p),R.get(x,A+1,p),m-A),xr(R.get(x+1,A,p),R.get(x+1,A+1,p),m-A),h-x):R.get(x,A,p)}getElevationAtPixel(t,o,c){return this._dem.get(t,o,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ce(1,t)*this._dem.stride}}const Bb=new Float32Array(262144),zh=new Uint8Array(262144);function LI(l){let t=0;if(l.meshes)for(const o of l.meshes)t=Math.max(t,o.aabb.max[2]);if(l.children)for(const o of l.children)t=Math.max(t,LI(o));return t}function OI(l,t,o){if(l.meshes)for(const c of l.meshes)c.aabb.min[0]!==1/0&&o.insert(t,c.aabb.min[0],c.aabb.min[1],c.aabb.max[0],c.aabb.max[1]);if(l.children)for(const c of l.children)OI(c,t,o)}const BI=["","wall","door","roof","window","lamp","logo"];class zI{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:LI(t)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const o=new Gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==t&&(c.transformedAabb=Gn.applyTransformFast(c.aabb,this.node.matrix),o.encapsulate(c.transformedAabb)),t++;this.aabb=o}return this.aabb}}class hy{constructor(t,o,c,p,h,m){this.id=o,this.modelTraits|=lf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=lf.HasMapboxMeshFeatures),p&&(this.modelTraits|=lf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const x of t)this.nodesInfo.push(new zI(x)),OI(x,m.featureIndexArray.length,m.grid),m.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,m.bucketLayerIDs.length-1,0)}updateFootprints(t,o){for(const c of this.getNodesInfo()){const p=c.node;p.footprint&&o.push({footprint:p.footprint,id:t})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const c of o){const p=c.node;this.uploaded?this.updatePbrBuffer(p):Lb(p,t,!0)}for(const c of o)uy(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let o=!1;if(!t.meshes)return o;for(const c of t.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),o=!0);return o}needsReEvaluation(t,o,c){const p=t.transform.projectionOptions,h=t.style.getBrightness(),m=this.brightness!==h;return!!(!this.uploaded||this.dirty||p.name!==this.projection.name||gm(c.paint.get("model-color").value,m)||gm(c.paint.get("model-color-mix-intensity").value,m)||gm(c.paint.get("model-roughness").value,m)||gm(c.paint.get("model-emissive-strength").value,m)||gm(c.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=p,this.brightness=h,!0)}evaluateScale(t,o){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const c=this.getNodesInfo(),p=this.id.canonical;for(const h of c){const m=h.feature;h.evaluatedScale=o.paint.get("model-scale").evaluate(m,{},p)}}evaluate(t){const o=this.getNodesInfo();for(const c of o){if(!c.node.meshes)continue;const p=c.feature,h=c.node.meshes&&c.node.meshes[0].featureData,m=c.evaluatedColor[2],x=c.evaluatedRMEA[2],A=this.id.canonical;if(c.hasTranslucentParts=!1,h){for(let R=0;R<BI.length;R++){const y=BI[R];y.length&&(p.properties.part=y);const T=t.paint.get("model-color").evaluate(p,{},A).toRenderColor(null),C=t.paint.get("model-color-mix-intensity").evaluate(p,{},A);c.evaluatedColor[R]=[T.r,T.g,T.b,C],c.evaluatedRMEA[R][0]=t.paint.get("model-roughness").evaluate(p,{},A),c.evaluatedRMEA[R][2]=t.paint.get("model-emissive-strength").evaluate(p,{},A),c.evaluatedRMEA[R][3]=T.a,c.emissionHeightBasedParams[R]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,{},A),!c.hasTranslucentParts&&T.a<1&&(c.hasTranslucentParts=!0)}delete p.properties.part,HO(c,m!==c.evaluatedColor[2]||x!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(p,{},A);c.evaluatedScale=t.paint.get("model-scale").evaluate(p,{},A),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,o,c,p){const h=t.findDEMTileFor(c);if(h&&(h.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const m=cf.create(t,c,h);if(!m)return;this.modelTraits&lf.HasMapboxMeshFeatures&&this.updateDEM(t,m,c,p);for(const x of this.getNodesInfo()){const A=x.node;if(!A.footprint||!A.footprint.vertices||!A.footprint.vertices.length)continue;const R=A.footprint.vertices;let y=m.getElevationAt(R[0].x,R[0].y,!0,!0);for(let T=1;T<R.length;T++)y=Math.min(y,m.getElevationAt(R[T].x,R[T].y,!0,!0));A.elevation=y}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=o}}updateDEM(t,o,c,p){let h=o._dem._modifiedForSources[p];if(h===void 0&&(o._dem._modifiedForSources[p]=[],h=o._dem._modifiedForSources[p]),h.includes(c.canonical))return;const m=o._dem.dim;h.push(c.canonical);let x=!1;for(const A of this.getNodesInfo()){const R=A.node;if(!R.footprint||!R.footprint.grid)continue;const y=R.footprint.grid,T=o.tileCoordToPixel(y.min.x,y.min.y),C=o.tileCoordToPixel(y.max.x,y.max.y),E=Math.min(Math.min(m-C.y,T.x),Math.min(T.y,m-C.x));if(E<0)continue;const S=Ft(E,2,5);let P=Math.max(0,T.x-S),O=Math.max(0,T.y-S),F=Math.min(C.x+S,m-1),j=Math.min(C.y+S,m-1);for(let K=O;K<=j;++K)for(let ie=P;ie<=F;++ie)zh[K*m+ie]=255;let G=0,N=0;for(let K=0;K<y.cellsY;++K)for(let ie=0;ie<y.cellsX;++ie){if(!y.cells[K*y.cellsX+ie])continue;const ue=o.tileCoordToPixel(y.min.x+ie/y.xScale,y.min.y+K/y.yScale),de=o.tileCoordToPixel(y.min.x+(ie+1)/y.xScale,y.min.y+(K+1)/y.yScale);for(let le=ue.y;le<=Math.min(de.y+1,m-1);++le)for(let xe=ue.x;xe<=Math.min(de.x+1,m-1);++xe)zh[le*m+xe]===255&&(zh[le*m+xe]=0,G+=o.getElevationAtPixel(xe,le),N++)}const Z=G/N;P=Math.max(1,T.x-S),O=Math.max(1,T.y-S),F=Math.min(C.x+S,m-2),j=Math.min(C.y+S,m-2),x=!0;for(let K=O;K<=j;++K)for(let ie=P;ie<=F;++ie)zh[K*m+ie]===0&&(Bb[K*m+ie]=o._dem.set(ie,K,Z));for(let K=1;K<S;++K){P=Math.max(1,T.x-K),O=Math.max(1,T.y-K),F=Math.min(C.x+K,m-2),j=Math.min(C.y+K,m-2);for(let ie=O;ie<=j;++ie)for(let ue=P;ue<=F;++ue){const de=ie*m+ue;if(zh[de]===255){let le=0,xe=0,me=-1,Ee=-1;for(let Pe=-1;Pe<=1;++Pe)for(let Be=-1;Be<=1;++Be){const ze=(ie+Pe)*m+ue+Be;if(zh[ze]>=K)continue;const Ge=Bb[ze],rt=Math.abs(Ge);rt>xe&&(le=Ge,xe=rt,me=Be,Ee=Pe)}if(xe>.1){const Pe=1-(K+.5*Math.abs(me*Ee))/S;let Be=o._dem.get(ue,ie)+le*Pe;const ze=o._dem.get(ue+me,ie+Ee),Ge=o._dem.get(ue-me,ie-Ee,!0);(Be-ze)*(Be-Ge)>0&&(Be=(ze+Ge)/2),Bb[de]=o._dem.set(ue,ie,Be),zh[de]=K}}}}}x&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=Ht.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const o of t)uy(o.node),Ob(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const c=o.getReplacementRegionsForTile(t.toUnwrapped()),p=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const m=p[h].node;p[h].hiddenByReplacement=!!m.footprint&&!c.find(x=>x.footprint===m.footprint)}}getHeightAtTileCoord(t,o){const c=this.getNodesInfo(),p=[],h=[0,0,0],m=_e.mat4.identity([]);for(let x=0;x<this.nodesInfo.length;x++){const A=c[x],R=A.node.meshes[0],y=R.transformedAabb;if(t<y.min[0]||o<y.min[1]||t>y.max[0]||o>y.max[1])continue;if(A.node.hidden===!0)return{height:1/0,maxHeight:A.feature.properties.height,hidden:!1,verticalScale:A.evaluatedScale[2]};_e.mat4.invert(m,A.node.matrix),h[0]=t,h[1]=o,_e.vec3.transformMat4(h,h,m);const T=(h[0]-R.aabb.min[0])/(R.aabb.max[0]-R.aabb.min[0])*Bh|0,C=Math.min(63,(h[1]-R.aabb.min[1])/(R.aabb.max[1]-R.aabb.min[1])*Bh|0)*Bh+Math.min(63,T),E=R.heightmap[C];if(!(E<0&&A.node.footprint))return A.hiddenByReplacement?void 0:{height:E,maxHeight:A.feature.properties.height,hidden:!1,verticalScale:A.evaluatedScale[2]};if(A.node.footprint.grid.query(new De(t,o),new De(t,o),p),p.length>0)return{height:void 0,maxHeight:A.feature.properties.height,hidden:A.hiddenByReplacement,verticalScale:A.evaluatedScale[2]}}}}function gm(l,t){return!l.isLightConstant&&t}function GO(l,t,o,c,p,h,m,x){let A=(61440&t|(61440&t)>>4)>>8,R=(3840&t|(3840&t)>>4)>>4,y=240&t|(240&t)>>4;o[3]>0&&(A=xr(A,255*o[0],o[3]),R=xr(R,255*o[1],o[3]),y=xr(y,255*o[2],o[3]));const T=A<<8|R,C=y<<8|Math.floor(255*c[3]),E=function(K){const ie=Ft(K,0,2);return Math.min(Math.round(.5*ie*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],S=Ft(p[0],0,1),P=Ft(p[1],0,1),O=Ft(p[2],0,1),F=Ft(p[3],0,1);let j,G,N,Z;if(S!==P&&m!==h&&P!==S){const K=m-h;G=1/(K*(P-S)),N=-(h+K*S)/(K*(P-S));const ie=Ft(p[4],-1,1);Z=Math.pow(10,ie),j=255*O<<8|255*F}else j=65535,G=0,N=1,Z=1;if(l.emplaceBack(T,C,E,j,G,N,Z),x){const K=x.length;x.clear();for(let ie=0;ie<K;ie++)x.emplaceBack(T,C,E,j,G,N,Z)}}function HO(l,t,o){const c=l.node;let p=0;const h=o&lf.HasMeshoptCompression;for(const m of c.meshes){if(c.lights&&c.lightMeshIndex===p||!m.featureData)continue;m.featureArray=new Hd,m.featureArray.reserve(m.featureData.length);let x=t;for(const A of m.featureData){const R=h?65535&A:A>>16&65535,y=h?A>>16&65535:65535&A,T=(15&y)<8?15&y:0,C=l.evaluatedRMEA[T],E=l.evaluatedColor[T],S=l.emissionHeightBasedParams[T];let P;if(x&&T===2&&c.lights&&(P=new Hd,P.resize(10*c.lights.length)),GO(m.featureArray,R,E,C,S,m.aabb.min[2],m.aabb.max[2],P),P&&x){x=!1;const O=c.meshes[c.lightMeshIndex];O.featureArray=P,O.featureArray._trim()}}m.featureArray._trim(),p++}}function FI(l,t,o,c){const p=1<<l.z;t.lat=ge((c/Ut+l.y)/p),t.lng=ye((o/Ut+l.x)/p)}rr(hy,"Tiled3dModelBucket",{omit:["layers"]}),rr(zI,"Tiled3dModelFeature");const WO={circle:class extends zo{constructor(l,t,o,c){super(l,{layout:Cn||(Cn=new si({"circle-sort-key":new pr(tt.layout_circle["circle-sort-key"]),visibility:new Ot(tt.layout_circle.visibility)})),paint:Ei||(Ei=new si({"circle-radius":new pr(tt.paint_circle["circle-radius"]),"circle-color":new pr(tt.paint_circle["circle-color"]),"circle-blur":new pr(tt.paint_circle["circle-blur"]),"circle-opacity":new pr(tt.paint_circle["circle-opacity"]),"circle-translate":new Ot(tt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ot(tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ot(tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ot(tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pr(tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pr(tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pr(tt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ot(tt.paint_circle["circle-emissive-strength"])}))},t,o,c)}createBucket(l){return new _r(l)}queryRadius(l){const t=l;return ai("circle-radius",this,t)+ai("circle-stroke-width",this,t)+Mn(this.paint.get("circle-translate"))}queryIntersectsFeature(l,t,o,c,p,h,m,x){const A=fn(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(t,o)+this.paint.get("circle-stroke-width").evaluate(t,o);return gT(l,c,h,m,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,R)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,t,o){const c=mT(this);return{config:new Ic(this,{zoom:t,lut:o}),defines:c,overrideFog:!1}}},heatmap:class extends zo{createBucket(l){return new yT(l)}constructor(l,t,o,c){super(l,{layout:vT||(vT=new si({visibility:new Ot(tt.layout_heatmap.visibility)})),paint:bT||(bT=new si({"heatmap-radius":new pr(tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pr(tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ot(tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new wa(tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ot(tt.paint_heatmap["heatmap-opacity"])}))},t,o,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return ai("heatmap-radius",this,l)}queryIntersectsFeature(l,t,o,c,p,h,m,x){const A=this.paint.get("heatmap-radius").evaluate(t,o);return gT(l,c,h,m,x,!0,!0,new De(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,t,o){return l==="heatmap"?{config:new Ic(this,{zoom:t,lut:o}),overrideFog:!1}:{}}},hillshade:class extends zo{constructor(l,t,o,c){super(l,{layout:xT||(xT=new si({visibility:new Ot(tt.layout_hillshade.visibility)})),paint:wT||(wT=new si({"hillshade-illumination-direction":new Ot(tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ot(tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ot(tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ot(tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ot(tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ot(tt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ot(tt.paint_hillshade["hillshade-emissive-strength"])}))},t,o,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,t,o){return{overrideFog:!1}}},fill:class extends zo{constructor(l,t,o,c){super(l,{layout:kT||(kT=new si({"fill-sort-key":new pr(tt.layout_fill["fill-sort-key"]),visibility:new Ot(tt.layout_fill.visibility)})),paint:PT||(PT=new si({"fill-antialias":new Ot(tt.paint_fill["fill-antialias"]),"fill-opacity":new pr(tt.paint_fill["fill-opacity"]),"fill-color":new pr(tt.paint_fill["fill-color"]),"fill-outline-color":new pr(tt.paint_fill["fill-outline-color"]),"fill-translate":new Ot(tt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ot(tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new pr(tt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ot(tt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new pr(tt.paint_fill["fill-z-offset"])}))},t,o,c)}getProgramIds(){const l=this.paint.get("fill-pattern"),t=l&&l.constantOr(1),o=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(l,t,o){return{config:new Ic(this,{zoom:t,lut:o}),overrideFog:!1}}recalculate(l,t){super.recalculate(l,t);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new Qv(l)}queryRadius(){return Mn(this.paint.get("fill-translate"))}queryIntersectsFeature(l,t,o,c,p,h){return!l.queryGeometry.isAboveHorizon&&kr(jr(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends zo{constructor(l,t,o,c){super(l,{layout:dE||(dE=new si({visibility:new Ot(tt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ot(tt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:fE||(fE=new si({"fill-extrusion-opacity":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pr(tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new pr(tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pr(tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pr(tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new pr(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new pr(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new pr(tt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new pr(tt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ot(tt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},t,o,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new j_(l)}queryRadius(){return Mn(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,t,o,c,p,h,m,x,A){const R=fn(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),y=this.paint.get("fill-extrusion-height").evaluate(t,o),T=this.paint.get("fill-extrusion-base").evaluate(t,o),C=[0,0],E=x&&h.elevation,S=h.elevation?h.elevation.exaggeration():1,P=l.tile.getBucket(this);if(E&&P instanceof j_){const N=P.centroidVertexArray,Z=A+1;Z<N.length&&(C[0]=N.geta_centroid_pos0(Z),C[1]=N.geta_centroid_pos1(Z))}if(C[0]===0&&C[1]===1)return!1;h.projection.name==="globe"&&(c=hE([c],[new De(0,0),new De(Ut,Ut)],l.tileID.canonical).map(N=>N.polygon).flat());const O=E?x:null,[F,j]=function(N,Z,K,ie,ue,de,le,xe,me,Ee,Pe){return N.projection.name==="globe"?function(Be,ze,Ge,rt,Ze,ft,xt,lt,Yt,Vt,Mt){const Et=[],yr=[],Xt=Be.projection.upVectorScale(Mt,Be.center.lat,Be.worldSize).metersToTile,tr=[0,0,0,1],Mr=[0,0,0,1],$r=(zr,Zr,Yr,Fn)=>{zr[0]=Zr,zr[1]=Yr,zr[2]=Fn,zr[3]=1},Br=uE();Ge>0&&(Ge+=Br),rt+=Br;for(const zr of ze){const Zr=[],Yr=[];for(const Fn of zr){const Rn=Fn.x+Ze.x,Lr=Fn.y+Ze.y,xn=Be.projection.projectTilePoint(Rn,Lr,Mt),En=Be.projection.upVector(Mt,Fn.x,Fn.y);let Kn=Ge,Ri=rt;if(xt){const Vi=mE(Rn,Lr,Ge,rt,xt,lt,Yt,Vt);Kn+=Vi.base,Ri+=Vi.top}Ge!==0?$r(tr,xn.x+En[0]*Xt*Kn,xn.y+En[1]*Xt*Kn,xn.z+En[2]*Xt*Kn):$r(tr,xn.x,xn.y,xn.z),$r(Mr,xn.x+En[0]*Xt*Ri,xn.y+En[1]*Xt*Ri,xn.z+En[2]*Xt*Ri),_e.vec3.transformMat4(tr,tr,ft),_e.vec3.transformMat4(Mr,Mr,ft),Zr.push(new Oh(tr[0],tr[1],tr[2])),Yr.push(new Oh(Mr[0],Mr[1],Mr[2]))}Et.push(Zr),yr.push(Yr)}return[Et,yr]}(N,Z,K,ie,ue,de,le,xe,me,Ee,Pe):le?function(Be,ze,Ge,rt,Ze,ft,xt,lt,Yt){const Vt=[],Mt=[],Et=[0,0,0,1];for(const yr of Be){const Xt=[],tr=[];for(const Mr of yr){const $r=Mr.x+rt.x,Br=Mr.y+rt.y,zr=mE($r,Br,ze,Ge,ft,xt,lt,Yt);Et[0]=$r,Et[1]=Br,Et[2]=zr.base,Et[3]=1,_e.vec4.transformMat4(Et,Et,Ze),Et[3]=Math.max(Et[3],1e-5);const Zr=new Oh(Et[0]/Et[3],Et[1]/Et[3],Et[2]/Et[3]);Et[0]=$r,Et[1]=Br,Et[2]=zr.top,Et[3]=1,_e.vec4.transformMat4(Et,Et,Ze),Et[3]=Math.max(Et[3],1e-5);const Yr=new Oh(Et[0]/Et[3],Et[1]/Et[3],Et[2]/Et[3]);Xt.push(Zr),tr.push(Yr)}Vt.push(Xt),Mt.push(tr)}return[Vt,Mt]}(Z,K,ie,ue,de,le,xe,me,Ee):function(Be,ze,Ge,rt,Ze){const ft=[],xt=[],lt=Ze[8]*ze,Yt=Ze[9]*ze,Vt=Ze[10]*ze,Mt=Ze[11]*ze,Et=Ze[8]*Ge,yr=Ze[9]*Ge,Xt=Ze[10]*Ge,tr=Ze[11]*Ge;for(const Mr of Be){const $r=[],Br=[];for(const zr of Mr){const Zr=zr.x+rt.x,Yr=zr.y+rt.y,Fn=Ze[0]*Zr+Ze[4]*Yr+Ze[12],Rn=Ze[1]*Zr+Ze[5]*Yr+Ze[13],Lr=Ze[2]*Zr+Ze[6]*Yr+Ze[14],xn=Ze[3]*Zr+Ze[7]*Yr+Ze[15],En=Fn+lt,Kn=Rn+Yt,Ri=Lr+Vt,Vi=Math.max(xn+Mt,1e-5),ki=Fn+Et,vi=Rn+yr,ao=Lr+Xt,Hi=Math.max(xn+tr,1e-5);$r.push(new Oh(En/Vi,Kn/Vi,Ri/Vi)),Br.push(new Oh(ki/Hi,vi/Hi,ao/Hi))}ft.push($r),xt.push(Br)}return[ft,xt]}(Z,K,ie,ue,de)}(h,c,T,y,R,m,O,C,S,h.center.lat,l.tileID.canonical),G=l.queryGeometry;return function(N,Z,K){let ie=1/0;kr(K,Z)&&(ie=pE(K,Z[0]));for(let ue=0;ue<Z.length;ue++){const de=Z[ue],le=N[ue];for(let xe=0;xe<de.length-1;xe++){const me=de[xe],Ee=[me,de[xe+1],le[xe+1],le[xe],me];Nt(K,Ee)&&(ie=Math.min(ie,pE(K,Ee)))}}return ie!==1/0&&ie}(F,j,G.isPointQuery()?G.screenBounds:G.screenGeometry)}},line:class extends zo{constructor(l,t,o,c){const p=IE();super(l,p,t,o,c),p.layout&&(this.layout=new cu(p.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Ko,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,t){super.recalculate(l,t),this.paint._values["line-floorwidth"]=(()=>{if(im)return im;const o=IE();return im=new KL(o.paint.properties["line-width"].specification),im.useIntegerZoom=!0,im})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new cb(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,t,o){const c=TE(this);return{config:new Ic(this,{zoom:t,lut:o}),defines:c,overrideFog:!1}}queryRadius(l){const t=l,o=AE(ai("line-width",this,t),ai("line-gap-width",this,t)),c=ai("line-offset",this,t);return o/2+Math.abs(c)+Mn(this.paint.get("line-translate"))}queryIntersectsFeature(l,t,o,c,p,h){if(l.queryGeometry.isAboveHorizon)return!1;const m=jr(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),x=l.pixelToTileUnitsFactor/2*AE(this.paint.get("line-width").evaluate(t,o),this.paint.get("line-gap-width").evaluate(t,o)),A=this.paint.get("line-offset").evaluate(t,o);return A&&(c=function(R,y){const T=[],C=new De(0,0);for(let E=0;E<R.length;E++){const S=R[E],P=[];for(let O=0;O<S.length;O++){const F=S[O],j=S[O+1],G=O===0?C:F.sub(S[O-1])._unit()._perp(),N=O===S.length-1?C:j.sub(F)._unit()._perp(),Z=G._add(N)._unit();Z._mult(1/(Z.x*N.x+Z.y*N.y)),P.push(Z._mult(y)._add(F))}T.push(P)}return T}(c,A*l.pixelToTileUnitsFactor)),function(R,y,T){for(let C=0;C<y.length;C++){const E=y[C];if(R.length>=3){for(let S=0;S<E.length;S++)if(Xn(R,E[S]))return!0}if(ar(R,E,T))return!0}return!1}(m,c,x)}isTileClipped(){return!0}isDraped(l){const t=this.layout.get("line-z-offset");return t.isConstant()&&!t.constantOr(0)}},symbol:ny,background:class extends zo{constructor(l,t,o,c){super(l,{layout:cI||(cI=new si({visibility:new Ot(tt.layout_background.visibility)})),paint:uI||(uI=new si({"background-pitch-alignment":new Ot(tt.paint_background["background-pitch-alignment"]),"background-color":new Ot(tt.paint_background["background-color"]),"background-pattern":new Ot(tt.paint_background["background-pattern"]),"background-opacity":new Ot(tt.paint_background["background-opacity"]),"background-emissive-strength":new Ot(tt.paint_background["background-emissive-strength"])}))},t,o,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,t,o){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:mI,"raster-particle":xI,sky:class extends zo{constructor(l,t,o,c){super(l,{layout:yI||(yI=new si({visibility:new Ot(tt.layout_sky.visibility)})),paint:vI||(vI=new si({"sky-type":new Ot(tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ot(tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ot(tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ot(tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ot(tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new wa(tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ot(tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ot(tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ot(tt.paint_sky["sky-opacity"])}))},t,o,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Xp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(l,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),p=!c,h=l.style.light,m=h.properties.get("position");return p&&h.properties.get("anchor")==="viewport"&&nn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?kb(m.azimuthal,90-m.polar,t):kb(c[0],90-c[1],t)}const o=this.paint.get("sky-gradient-center");return kb(o[0],90-o[1],t)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends zo{constructor(l,t,o,c){super(l,{paint:bI||(bI=new si({}))},t,null)}},model:class extends zo{constructor(l,t,o,c){super(l,{layout:PI||(PI=new si({visibility:new Ot(tt.layout_model.visibility),"model-id":new pr(tt.layout_model["model-id"])})),paint:MI||(MI=new si({"model-opacity":new Ot(tt.paint_model["model-opacity"]),"model-rotation":new pr(tt.paint_model["model-rotation"]),"model-scale":new pr(tt.paint_model["model-scale"]),"model-translation":new pr(tt.paint_model["model-translation"]),"model-color":new pr(tt.paint_model["model-color"]),"model-color-mix-intensity":new pr(tt.paint_model["model-color-mix-intensity"]),"model-type":new Ot(tt.paint_model["model-type"]),"model-cast-shadows":new Ot(tt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ot(tt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ot(tt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new pr(tt.paint_model["model-emissive-strength"]),"model-roughness":new pr(tt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new pr(tt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ot(tt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ot(tt.paint_model["model-front-cutoff"])}))},t,o,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new Db(l)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof hy?Ut-1:0}queryIntersectsFeature(l,t,o,c,p,h){if(!this.modelManager)return!1;const m=this.modelManager,x=l.tile.getBucket(this);if(!(x&&x instanceof Db))return!1;const A=x;for(const R in A.instancesPerModel){const y=A.instancesPerModel[R],T=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(y.idToFeaturesIndex.hasOwnProperty(T)){const C=y.features[y.idToFeaturesIndex[T]],E=m.getModel(R,this.scope);if(!E)return!1;let S=_e.mat4.create();const P=new q(0,0),O=A.canonical;let F=Number.MAX_VALUE;for(let j=0;j<C.instancedDataCount;++j){const G=16*(C.instancedDataOffset+j),N=y.instancedDataArray.float32,Z=[N[G+4],N[G+5],N[G+6]];FI(O,P,N[G],0|N[G+1]),DI(S,E,h,P,C.rotation,C.scale,Z,!1,!1,!1),h.projection.name==="globe"&&(S=Mb(S,h));const K=_e.mat4.multiply([],h.projMatrix,S),ie=l.queryGeometry,ue=AI(ie.isPointQuery()?ie.screenBounds:ie.screenGeometry,h,K,E.aabb);ue!=null&&(F=Math.min(ue,F))}return F!==Number.MAX_VALUE&&F}}return!1}_handleOverridablePaintPropertyUpdate(l,t,o){return!(!this.layout||t.isDataDriven()||o.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const t=this._transitionablePaint._values[l];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Xa}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(l,t,o,c){const p=l.tile,h=p.getBucket(this);let m=null,x=Number.MAX_VALUE;if(!(h&&h instanceof hy))return{queryFeature:m,intersectionZ:x};const A=h.getNodesInfo()[t];if(A.hiddenByReplacement||!A.node.meshes||!o.filter(new wi(p.tileID.overscaledZ),A.feature,p.tileID.canonical))return{queryFeature:m,intersectionZ:x};const R=A.node,y=c.calculatePosMatrix(p.tileID.toUnwrapped(),c.worldSize),T=A.evaluatedScale;let C=0;c.elevation&&R.elevation&&(C=R.elevation*c.elevation.exaggeration()),_e.mat4.translate(y,y,[(R.anchor?R.anchor[0]:0)*(T[0]-1),(R.anchor?R.anchor[1]:0)*(T[1]-1),C]),_e.mat4.scale(y,y,T),_e.mat4.multiply(y,y,R.matrix);const E=l.queryGeometry,S=E.isPointQuery()?E.screenBounds:E.screenGeometry,P=function(F){const j=_e.mat4.multiply([],y,F.matrix),G=_e.mat4.multiply(j,c.expandedFarZProjMatrix,j);for(let N=0;N<F.meshes.length;++N){const Z=F.meshes[N];if(N===F.lightMeshIndex)continue;const K=AI(S,c,G,Z.aabb);K!=null&&(x=Math.min(K,x))}if(F.children)for(const N of F.children)P(N)};if(P(R),x===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:x};const O=new q(0,0);return FI(p.tileID.canonical,O,A.node.anchor[0],A.node.anchor[1]),m={type:"Feature",geometry:{type:"Point",coordinates:[O.lng,O.lat]},properties:A.feature.properties,id:A.feature.id,state:{},layer:this.serialize()},{queryFeature:m,intersectionZ:x}}},clip:class extends zo{constructor(l,t,o,c){super(l,{layout:MT||(MT=new si({"clip-layer-types":new Ot(tt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ot(tt.layout_clip["clip-layer-scope"])})),paint:DT||(DT=new si({}))},t,o,c)}recalculate(l,t){super.recalculate(l,t)}createBucket(l){return new LT(l)}isTileClipped(){return!0}is3D(){return!0}}};class ZO{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class XO{constructor(){this.tasks={},this.taskQueue=[],yo(["process"],this),this.invoker=new ZO(this.process),this.nextId=0}add(t,o){const c=this.nextId++,p=function({type:h,isSymbolTile:m,zoom:x}){return x=x||0,h==="message"?0:h!=="maybePrepare"||m?h!=="parseTile"||m?h==="parseTile"&&m?300-x:h==="maybePrepare"&&m?400-x:500:200-x:100-x}(o);if(p===0){try{t()}finally{}return null}return this.tasks[c]={fn:t,metadata:o,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const o=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let t=null,o=1/0;for(let p=0;p<this.taskQueue.length;p++){const h=this.tasks[this.taskQueue[p]];h.priority<o&&(o=h.priority,t=p)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class NI{constructor(t,o,c){this.target=t,this.parent=o,this.mapId=c,this.callbacks={},this.cancelCallbacks={},yo(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new XO}send(t,o,c,p,h=!1,m){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[x]=c);const A=new Set;return this.target.postMessage({id:x,type:t,hasCallback:!!c,targetMapId:p,mustQueue:h,sourceMapId:this.mapId,data:ms(o,A)},A),{cancel:()=>{c&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(t){const o=t.data,c=o.id;if(c&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const p=this.cancelCallbacks[c];delete this.cancelCallbacks[c],p&&p.cancel()}else if(o.mustQueue||Co()){const p=this.callbacks[c],h=this.scheduler.add(()=>this.processTask(c,o),p&&p.metadata||{type:"message"});h&&(this.cancelCallbacks[c]=h)}else this.processTask(c,o)}processTask(t,o){if(delete this.cancelCallbacks[t],o.type==="<response>"){const c=this.callbacks[t];delete this.callbacks[t],c&&(o.error?c(bc(o.error)):c(null,bc(o.data)))}else{const c=new Set,p=o.hasCallback?(m,x)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:m?ms(m):null,data:ms(x,c)},c)}:m=>{},h=bc(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,h,p);else if(this.parent.getWorkerSource){const m=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,m[0],h.source,h.scope)[m[1]](h,p)}else p(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class uf{constructor(t,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=xi();const c=this.workerPool.acquire(this.id);for(let p=0;p<c.length;p++){const h=new uf.Actor(c[p],o,this.id);h.name=`Worker ${p}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,o,c){tn(this.actors,(p,h)=>{p.send(t,o,h)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}uf.Actor=NI;class VI{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,o){const c=this.toIdx(t,o);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,o){return this.leaves[this.toIdx(t,o)]}toIdx(t,o){return o*this.size+t}}function UI(l,t,o,c){let p=0,h=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(o[m]<l[m]||o[m]>t[m])return null}else{const x=1/c[m];let A=(l[m]-o[m])*x,R=(t[m]-o[m])*x;if(A>R){const y=A;A=R,R=y}if(A>p&&(p=A),R<h&&(h=R),p>h)return null}return p}function jI(l,t,o,c,p,h,m,x,A,R,y){const T=c-l,C=p-t,E=h-o,S=m-l,P=x-t,O=A-o,F=y[1]*O-y[2]*P,j=y[2]*S-y[0]*O,G=y[0]*P-y[1]*S,N=T*F+C*j+E*G;if(Math.abs(N)<1e-15)return null;const Z=1/N,K=R[0]-l,ie=R[1]-t,ue=R[2]-o,de=(K*F+ie*j+ue*G)*Z;if(de<0||de>1)return null;const le=ie*E-ue*C,xe=ue*T-K*E,me=K*C-ie*T,Ee=(y[0]*le+y[1]*xe+y[2]*me)*Z;return Ee<0||de+Ee>1?null:(S*le+P*xe+O*me)*Z}function $I(l,t,o){return(l-t)/(o-t)}function qI(l,t,o,c,p,h,m,x,A){const R=1<<o,y=h-c,T=m-p,C=(l+1)/R*y+c,E=(t+0)/R*T+p,S=(t+1)/R*T+p;x[0]=(l+0)/R*y+c,x[1]=E,A[0]=C,A[1]=S}class GI{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(h){const m=Math.ceil(Math.log2(h.dim/8)),x=[];let A=Math.ceil(Math.pow(2,m));const R=1/A,y=(E,S,P,O,F)=>{const j=O?1:0,G=(E+1)*P-j,N=S*P,Z=(S+1)*P-j;F[0]=E*P,F[1]=N,F[2]=G,F[3]=Z};let T=new VI(A);const C=[];for(let E=0;E<A*A;E++){y(E%A,Math.floor(E/A),R,!1,C);const S=Su(C[0],C[1],h),P=Su(C[2],C[1],h),O=Su(C[2],C[3],h),F=Su(C[0],C[3],h);T.minimums.push(Math.min(S,P,O,F)),T.maximums.push(Math.max(S,P,O,F)),T.leaves.push(1)}for(x.push(T),A/=2;A>=1;A/=2){const E=x[x.length-1];T=new VI(A);for(let S=0;S<A*A;S++){y(S%A,Math.floor(S/A),2,!0,C);const P=E.getElevation(C[0],C[1]),O=E.getElevation(C[2],C[1]),F=E.getElevation(C[2],C[3]),j=E.getElevation(C[0],C[3]),G=E.isLeaf(C[0],C[1]),N=E.isLeaf(C[2],C[1]),Z=E.isLeaf(C[2],C[3]),K=E.isLeaf(C[0],C[3]),ie=Math.min(P.min,O.min,F.min,j.min),ue=Math.max(P.max,O.max,F.max,j.max),de=G&&N&&Z&&K;T.maximums.push(ue),T.minimums.push(ie),T.leaves.push(ue-ie<=5&&de?1:0)}x.push(T)}return x}(this.dem),c=o.length-1,p=o[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(o,0,0,c,0)}raycastRoot(t,o,c,p,h,m,x=1){return UI([t,o,-100],[c,p,this.maximums[0]*x],h,m)}raycast(t,o,c,p,h,m,x=1){if(!this.nodeCount)return null;const A=this.raycastRoot(t,o,c,p,h,m,x);if(A==null)return null;const R=[],y=[],T=[],C=[],E=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;E.length>0;){const{idx:S,t:P,nodex:O,nodey:F,depth:j}=E.pop();if(this.leaves[S]){qI(O,F,j,t,o,c,p,T,C);const N=1<<j,Z=(O+0)/N,K=(O+1)/N,ie=(F+0)/N,ue=(F+1)/N,de=Su(Z,ie,this.dem)*x,le=Su(K,ie,this.dem)*x,xe=Su(K,ue,this.dem)*x,me=Su(Z,ue,this.dem)*x,Ee=jI(T[0],T[1],de,C[0],T[1],le,C[0],C[1],xe,h,m),Pe=jI(C[0],C[1],xe,T[0],C[1],me,T[0],T[1],de,h,m),Be=Math.min(Ee!==null?Ee:Number.MAX_VALUE,Pe!==null?Pe:Number.MAX_VALUE);if(Be!==Number.MAX_VALUE)return Be;{const ze=_e.vec3.scaleAndAdd([],h,m,P);if(HI(de,le,me,xe,$I(ze[0],T[0],C[0]),$I(ze[1],T[1],C[1]))>=ze[2])return P}continue}let G=0;for(let N=0;N<this._siblingOffset.length;N++){qI((O<<1)+this._siblingOffset[N][0],(F<<1)+this._siblingOffset[N][1],j+1,t,o,c,p,T,C),T[2]=-100,C[2]=this.maximums[this.childOffsets[S]+N]*x;const Z=UI(T,C,h,m);if(Z!=null){const K=Z;R[N]=K;let ie=!1;for(let ue=0;ue<G&&!ie;ue++)K>=R[y[ue]]&&(y.splice(ue,0,N),ie=!0);ie||(y[G]=N),G++}}for(let N=0;N<G;N++){const Z=y[N];E.push({idx:this.childOffsets[S]+Z,t:R[Z],nodex:(O<<1)+this._siblingOffset[Z][0],nodey:(F<<1)+this._siblingOffset[Z][1],depth:j+1})}}return null}_addNode(t,o,c){return this.minimums.push(t),this.maximums.push(o),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,o,c,p,h){if(t[p].isLeaf(o,c)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const m=p-1,x=t[m];let A=0,R=0;for(let y=0;y<this._siblingOffset.length;y++){const T=2*o+this._siblingOffset[y][0],C=2*c+this._siblingOffset[y][1],E=x.getElevation(T,C),S=x.isLeaf(T,C),P=this._addNode(E.min,E.max,S);S&&(A|=1<<y),R||(R=P)}for(let y=0;y<this._siblingOffset.length;y++)A&1<<y||this._construct(t,2*o+this._siblingOffset[y][0],2*c+this._siblingOffset[y][1],m,R+y)}}function HI(l,t,o,c,p,h){return xr(xr(l,o,h),xr(t,c,h),p)}function Su(l,t,o){const c=o.dim,p=Ft(l*c-.5,0,c-1),h=Ft(t*c-.5,0,c-1),m=Math.floor(p),x=Math.floor(h),A=Math.min(m+1,c-1),R=Math.min(x+1,c-1);return HI(o.get(m,x),o.get(A,x),o.get(m,R),o.get(A,R),p-m,h-x)}const KO={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function YO(l,t,o){return(256*l*256+256*t+o)/10-1e4}function JO(l,t,o){return 256*l+t+o/256-32768}class dy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,o,c,p=!1){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void nn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const h=this.dim=o.height-2,m=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let A=0;A<h;A++)m[this._idx(-1,A)]=m[this._idx(0,A)],m[this._idx(h,A)]=m[this._idx(h-1,A)],m[this._idx(A,-1)]=m[this._idx(A,0)],m[this._idx(A,h)]=m[this._idx(A,h-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(h,-1)]=m[this._idx(h-1,0)],m[this._idx(-1,h)]=m[this._idx(0,h-1)],m[this._idx(h,h)]=m[this._idx(h-1,h-1)]}const x=c==="terrarium"?JO:YO;for(let A=0;A<m.length;++A){const R=4*A;this.floatView[A]=x(this.pixels[R],this.pixels[R+1],this.pixels[R+2])}this._timestamp=Ht.now()}_buildQuadTree(){this._tree=new GI(this)}get(t,o,c=!1){c&&(t=Ft(t,-1,this.dim),o=Ft(o,-1,this.dim));const p=this._idx(t,o);return this.floatView[p]}set(t,o,c){const p=this._idx(t,o),h=this.floatView[p];return this.floatView[p]=c,c-h}static getUnpackVector(t){return KO[t]}_idx(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)}static pack(t,o){const c=[0,0,0,0],p=dy.getUnpackVector(o);let h=Math.floor((t+p[3])/p[2]);return c[2]=h%256,h=Math.floor(h/256),c[1]=h%256,h=Math.floor(h/256),c[0]=h,c}getPixels(){return new IT({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,o,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=o*this.dim,h=o*this.dim+this.dim,m=c*this.dim,x=c*this.dim+this.dim;switch(o){case-1:p=h-1;break;case 1:h=p+1}switch(c){case-1:m=x-1;break;case 1:x=m+1}const A=-o*this.dim,R=-c*this.dim;for(let y=m;y<x;y++)for(let T=p;T<h;T++){const C=4*this._idx(T,y),E=4*this._idx(T+A,y+R);this.pixels[C+0]=t.pixels[E+0],this.pixels[C+1]=t.pixels[E+1],this.pixels[C+2]=t.pixels[E+2],this.pixels[C+3]=t.pixels[E+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function QO(l,t,o){l===1?t.header_length=o.readFixed32():l===2?t.x=o.readVarint():l===3?t.y=o.readVarint():l===4?t.z=o.readVarint():l===5&&t.layers.push(function(c,p){return c.readFields(iB,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},p)}(o,o.readVarint()+o.pos))}function eB(l,t,o){l===1?(t.delta_filter=function(c,p){return c.readFields(tB,{block_size:0},p)}(o,o.readVarint()+o.pos),t.filter="delta_filter"):l===2?(o.readVarint(),t.filter="zigzag_filter"):l===3?(o.readVarint(),t.filter="bitshuffle_filter"):l===4&&(o.readVarint(),t.filter="byteshuffle_filter")}function tB(l,t,o){l===1&&(t.block_size=o.readVarint())}function rB(l,t,o){l===1?(o.readVarint(),t.codec="gzip_data"):l===2?(o.readVarint(),t.codec="jpeg_image"):l===3?(o.readVarint(),t.codec="webp_image"):l===4&&(o.readVarint(),t.codec="png_image")}function nB(l,t,o){l===1?t.first_byte=o.readFixed64():l===2?t.last_byte=o.readFixed64():l===3?t.filters.push(function(c,p){return c.readFields(eB,{},p)}(o,o.readVarint()+o.pos)):l===4?t.codec=function(c,p){return c.readFields(rB,{},p)}(o,o.readVarint()+o.pos):l===5?t.deprecated_offset=o.readFloat():l===6?t.deprecated_scale=o.readFloat():l===7?t.bands.push(o.readString()):l===8?t.offset=o.readDouble():l===9&&(t.scale=o.readDouble())}function iB(l,t,o){l===1?t.version=o.readVarint():l===2?t.name=o.readString():l===3?t.units=o.readString():l===4?t.tilesize=o.readVarint():l===5?t.buffer=o.readVarint():l===6?t.pixel_format=o.readVarint():l===7&&t.data_index.push(function(c,p){return c.readFields(nB,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},p)}(o,o.readVarint()+o.pos))}function oB(l,t,o){if(l===2)(function(c,p,h){c.readFields(sB,h,p)})(o,o.readVarint()+o.pos,t);else if(l===3)throw new Error("Not implemented")}function sB(l,t,o){if(l===1){let c=0;const p=o.readVarint()+o.pos;for(;o.pos<p;)t[c++]=o.readVarint()}}rr(dy,"DEMData"),rr(GI,"DemMinMaxQuadTree",{omit:["dem"]});class aB{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const o=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,o),o}put(t,o){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,o)}}function lB(l,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let o=t[3];for(let c=2;c>=1;c--){const p=c===1?1:0,h=c===2?1:0;for(let m=0;m<t[0];m++){const x=t[1]*m;for(let A=p;A<t[1];A++){const R=t[2]*(A+x);for(let y=h;y<t[2];y++){const T=t[3]*(y+R);for(let C=0;C<t[3];C++){const E=T+C;l[E]+=l[E-o]}}}}o*=t[c]}return l}function cB(l){for(let t=0,o=l.length;t<o;t++)l[t]=l[t]>>>1^-(1&l[t]);return l}function uB(l,t){switch(t){case"uint32":return l;case"uint16":for(let o=0;o<l.length;o+=2){const c=l[o],p=l[o+1];l[o]=(240&c)>>4|(61440&c)>>8|(240&p)<<4|61440&p,l[o+1]=15&c|(3840&c)>>4|(15&p)<<8|(3840&p)<<4}return l;case"uint8":for(let o=0;o<l.length;o+=4){const c=l[o],p=l[o+1],h=l[o+2],m=l[o+3];l[o+0]=(192&c)>>6|(192&p)>>4|(192&h)>>2|192&m,l[o+1]=(48&c)>>4|(48&p)>>2|48&h|(48&m)<<2,l[o+2]=(12&c)>>2|12&p|(12&h)<<2|(12&m)<<4,l[o+3]=3&c|(3&p)<<2|(3&h)<<4|(3&m)<<6}return l;default:throw new Error(`Invalid pixel format, "${t}"`)}}var Aa=Uint8Array,_m=Uint16Array,hB=Int32Array,WI=new Aa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ZI=new Aa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dB=new Aa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),XI=function(l,t){for(var o=new _m(31),c=0;c<31;++c)o[c]=t+=1<<l[c-1];var p=new hB(o[30]);for(c=1;c<30;++c)for(var h=o[c];h<o[c+1];++h)p[h]=h-o[c]<<5|c;return{b:o,r:p}},KI=XI(WI,2),YI=KI.b,fB=KI.r;YI[28]=258,fB[258]=28;for(var pB=XI(ZI,0).b,JI=new _m(32768),Ni=0;Ni<32768;++Ni){var hf=(43690&Ni)>>1|(21845&Ni)<<1;JI[Ni]=((65280&(hf=(61680&(hf=(52428&hf)>>2|(13107&hf)<<2))>>4|(3855&hf)<<4))>>8|(255&hf)<<8)>>1}var ym=function(l,t,o){for(var c=l.length,p=0,h=new _m(t);p<c;++p)l[p]&&++h[l[p]-1];var m,x=new _m(t);for(p=1;p<t;++p)x[p]=x[p-1]+h[p-1]<<1;m=new _m(1<<t);var A=15-t;for(p=0;p<c;++p)if(l[p])for(var R=p<<4|l[p],y=t-l[p],T=x[l[p]-1]++<<y,C=T|(1<<y)-1;T<=C;++T)m[JI[T]>>A]=R;return m},vm=new Aa(288);for(Ni=0;Ni<144;++Ni)vm[Ni]=8;for(Ni=144;Ni<256;++Ni)vm[Ni]=9;for(Ni=256;Ni<280;++Ni)vm[Ni]=7;for(Ni=280;Ni<288;++Ni)vm[Ni]=8;var QI=new Aa(32);for(Ni=0;Ni<32;++Ni)QI[Ni]=5;var mB=ym(vm,9),gB=ym(QI,5),zb=function(l){for(var t=l[0],o=1;o<l.length;++o)l[o]>t&&(t=l[o]);return t},yl=function(l,t,o){var c=t/8|0;return(l[c]|l[c+1]<<8)>>(7&t)&o},Fb=function(l,t){var o=t/8|0;return(l[o]|l[o+1]<<8|l[o+2]<<16)>>(7&t)},_B=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],vl=function(l,t,o){var c=new Error(t||_B[l]);if(c.code=l,Error.captureStackTrace&&Error.captureStackTrace(c,vl),!o)throw c;return c},yB=new Aa(0),vB=typeof TextDecoder<"u"&&new TextDecoder;try{vB.decode(yB,{stream:!0})}catch{}const bB={gzip_data:"gzip"};class el extends Error{constructor(t){super(t),this.name="MRTError"}}const xB={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},eA={uint32:1,uint16:2,uint8:4},wB={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Nb;class Vb{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const o=this.layers[t];if(!o)throw new el(`Layer '${t}' not found`);return o}getHeaderLength(t){const o=new Uint8Array(t),c=new DataView(t);if(o[0]!==13)throw new el("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(t){const o=new Uint8Array(t),c=this.getHeaderLength(t);if(o.length<c)throw new el(`Expected header with length >= ${c} but got buffer of length ${o.length}`);const p=function(h,m){return h.readFields(QO,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new Nb(o.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new el(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const h of p.layers)this.layers[h.name]=new TB(h,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const o=[],c=this.getLayer(t.layerName);for(let p of t.blockIndices){const h=c.dataIndex[p],m=h.first_byte-t.firstByte,x=h.last_byte-t.firstByte;if(c._blocksInProgress.has(p))continue;const A={layerName:c.name,firstByte:m,lastByte:x,pixelFormat:c.pixelFormat,blockIndex:p,blockShape:[h.bands.length].concat(c.bandShape),buffer:c.buffer,codec:h.codec.codec,filters:h.filters.map(R=>R.filter)};c._blocksInProgress.add(p),o.push(A)}return new tA(o,()=>{o.forEach(p=>c._blocksInProgress.delete(p.blockIndex))},(p,h)=>{if(o.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),p)throw p;h.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class TB{constructor({version:t,name:o,units:c,tilesize:p,pixel_format:h,buffer:m,data_index:x},A){if(this.version=t,this.version!==1)throw new el(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=o,this.units=c,this.tileSize=p,this.buffer=m,this.pixelFormat=xB[h],this.dataIndex=x,this.bandShape=[p+2*m,p+2*m,eA[this.pixelFormat]],this._decodedBlocks=new aB(A?A.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return eA[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){const o=t.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,t.data)}getBlockForBand(t){let o=0;switch(typeof t){case"string":for(const[c,p]of this.dataIndex.entries()){for(const[h,m]of p.bands.entries())if(m===t)return{bandIndex:o+h,blockIndex:c,blockBandIndex:h};o+=p.bands.length}break;case"number":for(const[c,p]of this.dataIndex.entries()){if(t>=o&&t<o+p.bands.length)return{bandIndex:t,blockIndex:c,blockBandIndex:t-o};o+=p.bands.length}break;default:throw new el(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new el(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let o=1/0,c=-1/0;const p=[],h=new Set;for(const m of t){const{blockIndex:x}=this.getBlockForBand(m);if(x<0)throw new el(`Invalid band: ${JSON.stringify(m)}`);const A=this.dataIndex[x];p.includes(x)||p.push(x),h.add(x),o=Math.min(o,A.first_byte),c=Math.max(c,A.last_byte)}if(h.size>this.cacheSize)throw new el(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:c,blockIndices:p}}hasBand(t){const{blockIndex:o}=this.getBlockForBand(t);return o>=0}hasDataForBand(t){const{blockIndex:o}=this.getBlockForBand(t);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(t){const{blockIndex:o,blockBandIndex:c}=this.getBlockForBand(t),p=this._decodedBlocks.get(o.toString());if(!p)throw new el(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[o],m=this.bandShape.reduce((R,y)=>R*y,1),x=c*m,A=p.subarray(x,x+m);return{data:A,bytes:new Uint8Array(A.buffer).subarray(A.byteOffset,A.byteOffset+A.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset!==0?h.offset:h.deprecated_offset,scale:h.scale!==0?h.scale:h.deprecated_scale}}}Vb.setPbf=function(l){Nb=l};class tA{constructor(t,o,c){this.tasks=t,this._onCancel=o,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,o){this._finalized||(this._onComplete(t,o),this._finalized=!0)}}Vb.performDecoding=function(l,t){const o=new Uint8Array(l);return Promise.all(t.tasks.map(c=>{const{layerName:p,firstByte:h,lastByte:m,pixelFormat:x,blockShape:A,blockIndex:R,filters:y,codec:T}=c,C=o.subarray(h,m+1),E=new Uint32Array(A[0]*A[1]*A[2]);let S;if(T!=="gzip_data")throw new el(`Unhandled codec: ${T}`);return S=function(P,O){if(!globalThis.DecompressionStream&&O==="gzip_data")return Promise.resolve(((N=function(ie){ie[0]==31&&ie[1]==139&&ie[2]==8||vl(6,"invalid gzip data");var ue=ie[3],de=10;4&ue&&(de+=2+(ie[10]|ie[11]<<8));for(var le=(ue>>3&1)+(ue>>4&1);le>0;le-=!ie[de++]);return de+(2&ue)}(G=P))+8>G.length&&vl(6,"invalid gzip data"),function(ie,ue,de,le){var xe=ie.length;if(!xe||ue.f&&!ue.l)return de||new Aa(0);var me=!de,Ee=me||ue.i!=2,Pe=ue.i;me&&(de=new Aa(3*xe));var Be,ze,Ge=function(Cu){var Vh=de.length;if(Cu>Vh){var Am=new Aa(Math.max(2*Vh,Cu));Am.set(de),de=Am}},rt=ue.f||0,Ze=ue.p||0,ft=ue.b||0,xt=ue.l,lt=ue.d,Yt=ue.m,Vt=ue.n,Mt=8*xe;do{if(!xt){rt=yl(ie,Ze,1);var Et=yl(ie,Ze+1,3);if(Ze+=3,!Et){var yr=ie[(Lr=4+((Ze+7)/8|0))-4]|ie[Lr-3]<<8,Xt=Lr+yr;if(Xt>xe){Pe&&vl(0);break}Ee&&Ge(ft+yr),de.set(ie.subarray(Lr,Xt),ft),ue.b=ft+=yr,ue.p=Ze=8*Xt,ue.f=rt;continue}if(Et==1)xt=mB,lt=gB,Yt=9,Vt=5;else if(Et==2){var tr=yl(ie,Ze,31)+257,Mr=yl(ie,Ze+10,15)+4,$r=tr+yl(ie,Ze+5,31)+1;Ze+=14;for(var Br=new Aa($r),zr=new Aa(19),Zr=0;Zr<Mr;++Zr)zr[dB[Zr]]=yl(ie,Ze+3*Zr,7);Ze+=3*Mr;var Yr=zb(zr),Fn=(1<<Yr)-1,Rn=ym(zr,Yr);for(Zr=0;Zr<$r;){var Lr,xn=Rn[yl(ie,Ze,Fn)];if(Ze+=15&xn,(Lr=xn>>4)<16)Br[Zr++]=Lr;else{var En=0,Kn=0;for(Lr==16?(Kn=3+yl(ie,Ze,3),Ze+=2,En=Br[Zr-1]):Lr==17?(Kn=3+yl(ie,Ze,7),Ze+=3):Lr==18&&(Kn=11+yl(ie,Ze,127),Ze+=7);Kn--;)Br[Zr++]=En}}var Ri=Br.subarray(0,tr),Vi=Br.subarray(tr);Yt=zb(Ri),Vt=zb(Vi),xt=ym(Ri,Yt),lt=ym(Vi,Vt)}else vl(1);if(Ze>Mt){Pe&&vl(0);break}}Ee&&Ge(ft+131072);for(var ki=(1<<Yt)-1,vi=(1<<Vt)-1,ao=Ze;;ao=Ze){var Hi=(En=xt[Fb(ie,Ze)&ki])>>4;if((Ze+=15&En)>Mt){Pe&&vl(0);break}if(En||vl(2),Hi<256)de[ft++]=Hi;else{if(Hi==256){ao=Ze,xt=null;break}var Io=Hi-254;Hi>264&&(Io=yl(ie,Ze,(1<<(xl=WI[Zr=Hi-257]))-1)+YI[Zr],Ze+=xl);var Hn=lt[Fb(ie,Ze)&vi],Ds=Hn>>4;if(Hn||vl(3),Ze+=15&Hn,Vi=pB[Ds],Ds>3){var xl=ZI[Ds];Vi+=Fb(ie,Ze)&(1<<xl)-1,Ze+=xl}if(Ze>Mt){Pe&&vl(0);break}Ee&&Ge(ft+131072);var tl=ft+Io;if(ft<Vi){var rl=0-Vi,Nh=Math.min(Vi,tl);for(rl+ft<0&&vl(3);ft<Nh;++ft)de[ft]=(void 0)[rl+ft]}for(;ft<tl;++ft)de[ft]=de[ft-Vi]}}ue.l=xt,ue.p=ao,ue.b=ft,ue.f=rt,xt&&(rt=1,ue.m=Yt,ue.d=lt,ue.n=Vt)}while(!rt);return ft!=de.length&&me?(Be=de,((ze=ft)==null||ze>Be.length)&&(ze=Be.length),new Aa(Be.subarray(0,ze))):de.subarray(0,ft)}(G.subarray(N,-8),{i:2},new Aa(((F=G)[(j=F.length)-4]|F[j-3]<<8|F[j-2]<<16|F[j-1]<<24)>>>0))));var F,j,G,N;const Z=bB[O];if(!Z)throw new Error(`Unhandled codec: ${O}`);const K=new globalThis.DecompressionStream(Z);return new Response(new Blob([P]).stream().pipeThrough(K)).arrayBuffer().then(ie=>new Uint8Array(ie))}(C,T).then(P=>(function(O,F){O.readFields(oB,F)}(new Nb(P),E),new wB[x](E.buffer))),S.then(P=>{for(let O=y.length-1;O>=0;O--)switch(y[O]){case"delta_filter":lB(P,A);break;case"zigzag_filter":cB(P);break;case"bitshuffle_filter":uB(P,x);break;default:throw new el(`Unhandled filter "${y[O]}"`)}return{layerName:p,blockIndex:R,data:P}}).catch(P=>{throw P})}))},rr(tA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var bm={workerUrl:"",workerClass:null,workerParams:void 0};const Ub="mapboxgl_preloaded_worker_pool";class xm{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<xm.workerCount;)this.workers.push(bm.workerClass!=null?new bm.workerClass:new self.Worker(bm.workerUrl,bm.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ub]}numActive(){return Object.keys(this.active).length}}let wm;function fy(){return wm||(wm=new xm),wm}xm.workerCount=2;let Tm,jb,bl,df,$b,ff=null;function rA(){return Co()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:jb||Ce.DRACO_URL}function nA(){if(Co()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(df)return df;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return df=WebAssembly.validate(l)?Ce.MESHOPT_SIMD_URL:Ce.MESHOPT_URL,df}const py={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},EB={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Em={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function iA(l,t,o){const c=o.json.bufferViews.length,p=o.buffers.length;t.bufferView=c,o.json.bufferViews[c]={buffer:p,byteLength:l.byteLength},o.buffers[p]=l}const qb="KHR_draco_mesh_compression";function IB(l,t){const o=l.extensions&&l.extensions[qb];if(!o)return;const c=new bl.Decoder,p=lA(t,o.bufferView),h=new bl.Mesh;if(!c.DecodeArrayToMesh(p,p.byteLength,h))throw new Error("Failed to decode Draco mesh");const m=t.json.accessors[l.indices],x=py[m.componentType],A=m.count*x.BYTES_PER_ELEMENT,R=bl._malloc(A);x===Uint16Array?c.GetTrianglesUInt16Array(h,A,R):c.GetTrianglesUInt32Array(h,A,R),iA(bl.memory.buffer.slice(R,R+A),m,t),bl._free(R);for(const y of Object.keys(o.attributes)){const T=c.GetAttributeByUniqueId(h,o.attributes[y]),C=t.json.accessors[l.attributes[y]],E=EB[C.componentType],S=C.count*Em[C.type]*py[C.componentType].BYTES_PER_ELEMENT,P=bl._malloc(S);c.GetAttributeDataArrayForAllPoints(h,T,bl[E],S,P),iA(bl.memory.buffer.slice(P,P+S),C,t),bl._free(P)}c.destroy(),h.destroy(),delete l.extensions[qb]}const my="EXT_meshopt_compression";function AB(l,t){if(!l.extensions||!l.extensions[my])return;const o=l.extensions[my],c=new Uint8Array(t.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),p=new Uint8Array(o.count*o.byteStride);$b.decodeGltfBuffer(p,o.count,o.byteStride,c,o.mode,o.filter),l.buffer=t.buffers.length,l.byteOffset=0,t.buffers[l.buffer]=p.buffer,delete l.extensions[my]}const oA=1179937895,sA=new TextDecoder("utf8");function aA(l,t){return new URL(l,t).href}function SB(l,t,o,c){return fetch(aA(l.uri,c)).then(p=>p.arrayBuffer()).then(p=>{t.buffers[o]=p})}function lA(l,t){const o=l.json.bufferViews[t];return new Uint8Array(l.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function CB(l,t,o,c){if(l.uri){const p=aA(l.uri,c);return fetch(p).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{t.images[o]=h})}if(l.bufferView!==void 0){const p=lA(t,l.bufferView),h=new Blob([p],{type:l.mimeType});return createImageBitmap(h).then(m=>{t.images[o]=m})}}function cA(l,t=0,o){const c={json:null,images:[],buffers:[]};if(new Uint32Array(l,t,1)[0]===oA){const y=new Uint32Array(l,t);let T=2;const C=(y[T++]>>2)-3,E=y[T++]>>2;if(T++,c.json=JSON.parse(sA.decode(y.subarray(T,T+E))),T+=E,T<C){const S=y[T++];T++;const P=t+(T<<2);c.buffers[0]=l.slice(P,P+S)}}else c.json=JSON.parse(sA.decode(new Uint8Array(l,t)));const{buffers:p,images:h,meshes:m,extensionsUsed:x,bufferViews:A}=c.json;let R=Promise.resolve();if(p){const y=[];for(let T=0;T<p.length;T++){const C=p[T];C.uri?y.push(SB(C,c,T,o)):c.buffers[T]||(c.buffers[T]=null)}R=Promise.all(y)}return R.then(()=>{const y=[],T=x&&x.includes(qb),C=x&&x.includes(my);if(T&&y.push(function(){if(!bl)return Tm??(Tm=function(E){let S,P=null;function O(){S=new Uint8Array(P.buffer)}function F(){throw new Error("Unexpected Draco error.")}const j={a:{a:F,d:function(G,N,Z){return S.copyWithin(G,N,N+Z)},c:function(G){const N=S.length,Z=Math.max(G>>>0,Math.ceil(1.2*N)),K=Math.ceil((Z-N)/65536);try{return P.grow(K),O(),!0}catch{return!1}},b:F}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,j):E.then(G=>G.arrayBuffer()).then(G=>WebAssembly.instantiate(G,j))).then(G=>{const{Rb:N,Qb:Z,P:K,T:ie,X:ue,Ja:de,La:le,Qa:xe,Va:me,Wa:Ee,eb:Pe,jb:Be,f:ze,e:Ge,yb:rt,zb:Ze,Ab:ft,Bb:xt,Db:lt,Gb:Yt}=G.instance.exports;P=Ge;const Vt=(()=>{let Mt=0,Et=0,yr=0,Xt=0;return tr=>{yr&&(N(Xt),N(Mt),Et+=yr,yr=Mt=0),Mt||(Et+=128,Mt=Z(Et));const Mr=tr.length+7&-8;let $r=Mt;Mr>=Et&&(yr=Mr,$r=Xt=Z(Mr));for(let Br=0;Br<tr.length;Br++)S[$r+Br]=tr[Br];return $r}})();return O(),ze(),{memory:Ge,_free:N,_malloc:Z,Mesh:class{constructor(){this.ptr=K()}destroy(){ie(this.ptr)}},Decoder:class{constructor(){this.ptr=de()}destroy(){Be(this.ptr)}DecodeArrayToMesh(Mt,Et,yr){const Xt=Vt(Mt),tr=le(this.ptr,Xt,Et,yr.ptr);return!!ue(tr)}GetAttributeByUniqueId(Mt,Et){return{ptr:xe(this.ptr,Mt.ptr,Et)}}GetTrianglesUInt16Array(Mt,Et,yr){me(this.ptr,Mt.ptr,Et,yr)}GetTrianglesUInt32Array(Mt,Et,yr){Ee(this.ptr,Mt.ptr,Et,yr)}GetAttributeDataArrayForAllPoints(Mt,Et,yr,Xt,tr){Pe(this.ptr,Mt.ptr,Et.ptr,yr,Xt,tr)}},DT_INT8:rt(),DT_UINT8:Ze(),DT_INT16:ft(),DT_UINT16:xt(),DT_UINT32:lt(),DT_FLOAT32:Yt()}})}(fetch(rA())),Tm.then(E=>{bl=E,Tm=void 0}))}()),C&&y.push(function(){if($b)return;const E=function(S){let P;const O=WebAssembly.instantiateStreaming(S,{}).then(G=>{P=G.instance,P.exports.__wasm_call_ctors()}),F={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},j={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:O,supported:!0,decodeGltfBuffer(G,N,Z,K,ie,ue){(function(de,le,xe,me,Ee,Pe,Be){const ze=de.exports.sbrk,Ge=me+3&-4,rt=ze(Ge*Ee),Ze=ze(Pe.length),ft=new Uint8Array(de.exports.memory.buffer);ft.set(Pe,Ze);const xt=le(rt,me,Ee,Ze,Pe.length);if(xt===0&&Be&&Be(rt,Ge,Ee),xe.set(ft.subarray(rt,rt+me*Ee)),ze(rt-ze(0)),xt!==0)throw new Error(`Malformed buffer data: ${xt}`)})(P,P.exports[j[ie]],G,N,Z,K,P.exports[F[ue]])}}}(fetch(nA()));return E.ready.then(()=>{$b=E})}()),h)for(let E=0;E<h.length;E++)y.push(CB(h[E],c,E,o));return(y.length?Promise.all(y):Promise.resolve()).then(()=>{if(T&&m)for(const{primitives:E}of m)for(const S of E)IB(S,c);if(C&&m&&A)for(const E of A)AB(E,c);return c})})}function Fh(l,t){const o=l.json.bufferViews[t.bufferView],c=py[t.componentType];return new c(l.buffers[o.buffer],(t.byteOffset||0)+(o.byteOffset||0),t.count*(o.byteStride&&o.byteStride!==Em[t.type]*c.BYTES_PER_ELEMENT?o.byteStride/c.BYTES_PER_ELEMENT:Em[t.type]))}function Gb(l,t,o,c){const p=py[t.componentType],h=function(y){switch(y){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),m=l.json.bufferViews[t.bufferView],x=m.byteStride?m.byteStride/p.BYTES_PER_ELEMENT:Em[t.type],A=o.float32,R=A.length/o.capacity;for(let y=0,T=0;y<t.count*x;y+=x,T+=R)for(let C=0;C<R;C++)A[T+C]=c[y+C]*h;o._trim()}function RB(l,t,o){const c=l.indices,p=l.attributes,h={};h.indexArray=new po;const m=t.json.accessors[c],x=m.count/3;h.indexArray.reserve(x);const A=Fh(t,m);for(let C=0;C<x;C++)h.indexArray.emplaceBack(A[3*C],A[3*C+1],A[3*C+2]);h.indexArray._trim(),h.vertexArray=new Hl;const R=t.json.accessors[p.POSITION];h.vertexArray.reserve(R.count);const y=Fh(t,R);for(let C=0;C<R.count;C++)h.vertexArray.emplaceBack(y[3*C],y[3*C+1],y[3*C+2]);if(h.vertexArray._trim(),h.aabb=new Gn(R.min,R.max),h.centroid=function(C,E){const S=[0,0,0],P=C.length;if(P>0){for(let O=0;O<P;O++){const F=3*C[O];S[0]+=E[F],S[1]+=E[F+1],S[2]+=E[F+2]}S[0]/=P,S[1]/=P,S[2]/=P}return S}(A,y),p.COLOR_0!==void 0){const C=t.json.accessors[p.COLOR_0],E=Em[C.type],S=Fh(t,C);h.colorArray=E===3?new Hl:new hl,h.colorArray.resize(C.count),Gb(t,C,h.colorArray,S)}if(p.NORMAL!==void 0){h.normalArray=new Hl;const C=t.json.accessors[p.NORMAL];h.normalArray.resize(C.count);const E=Fh(t,C);Gb(t,C,h.normalArray,E)}if(p.TEXCOORD_0!==void 0&&o.length>0){h.texcoordArray=new Ch;const C=t.json.accessors[p.TEXCOORD_0];h.texcoordArray.resize(C.count);const E=Fh(t,C);Gb(t,C,h.texcoordArray,E)}if(p._FEATURE_ID_RGBA4444!==void 0){const C=t.json.accessors[p._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=Fh(t,C))}p._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(Fh(t,t.json.accessors[p._FEATURE_RGBA4444]).buffer));const T=l.material;return h.material=function(C,E){const{emissiveFactor:S=[0,0,0],alphaMode:P="OPAQUE",alphaCutoff:O=.5,normalTexture:F,occlusionTexture:j,emissiveTexture:G,doubleSided:N}=C,{baseColorFactor:Z=[1,1,1,1],metallicFactor:K=1,roughnessFactor:ie=1,baseColorTexture:ue,metallicRoughnessTexture:de}=C.pbrMetallicRoughness||{},le=j?E[j.index]:void 0;if(j&&j.extensions&&j.extensions.KHR_texture_transform&&le){const xe=j.extensions.KHR_texture_transform;le.offsetScale=[xe.offset[0],xe.offset[1],xe.scale[0],xe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new an(...Z),metallicFactor:K,roughnessFactor:ie,baseColorTexture:ue?E[ue.index]:void 0,metallicRoughnessTexture:de?E[de.index]:void 0},doubleSided:N,emissiveFactor:S,alphaMode:P,alphaCutoff:O,normalTexture:F?E[F.index]:void 0,occlusionTexture:le,emissionTexture:G?E[G.index]:void 0,defined:C.defined===void 0}}(T!==void 0?t.json.materials[T]:{defined:!1},o),h}function uA(l,t,o){const{matrix:c,rotation:p,translation:h,scale:m,mesh:x,extras:A,children:R}=l,y={};if(y.matrix=c||_e.mat4.fromRotationTranslationScale([],p||[0,0,0,1],h||[0,0,0],m||[1,1,1]),x!==void 0){y.meshes=o[x];const T=y.anchor=[0,0];for(const C of y.meshes){const{min:E,max:S}=C.aabb;T[0]+=E[0]+S[0],T[1]+=E[1]+S[1]}T[0]=Math.floor(T[0]/y.meshes.length/2),T[1]=Math.floor(T[1]/y.meshes.length/2)}if(A&&(A.id&&(y.id=A.id),A.lights&&(y.lights=function(T){if(!T.length)return[];const C=function(F){const j=atob(F),G=new Uint8Array(j.length);for(let N=0;N<j.length;N++)G[N]=j.codePointAt(N);return G}(T),E=[],S=C.length/24,P=new Uint16Array(C.buffer),O=new Float32Array(C.buffer);for(let F=0;F<S;F++){const j=P[2*F*6]/30,G=P[2*F*6+1]/30,N=P[2*F*6+10]/100,Z=O[6*F+1],K=O[6*F+2],ie=O[6*F+3],ue=O[6*F+4],de=ie-Z,le=ue-K,xe=Math.hypot(de,le);E.push({pos:[Z+.5*de,K+.5*le,G],normal:[le/xe,-de/xe,0],width:xe,height:j,depth:N,points:[Z,K,ie,ue]})}return E}(A.lights))),R){const T=[];for(const C of R)T.push(uA(t.json.nodes[C],t,o));y.children=T}return y}function kB(l){if(l.vertices.length===0||l.indices.length===0)return null;const t=new eb(l.vertices,l.indices,8,256),[o,c]=[t.min.clone(),t.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:t,min:o,max:c}}function PB(l){if(!l.extras||!l.extras.ground)return null;const t=l.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const o=t[0];if(!o||!Array.isArray(o)||o.length===0)return null;const c=[];for(const m of o){if(!Array.isArray(m)||m.length!==2)continue;const x=m[0],A=m[1];typeof x=="number"&&typeof A=="number"&&c.push(new De(x,A))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let p=0;for(let m=0;m<c.length;m++){const x=c[m],A=c[(m+1)%c.length],R=c[(m+2)%c.length];p+=(x.x-A.x)*(R.y-A.y)-(R.x-A.x)*(x.y-A.y)}p>0&&c.reverse();const h=Kp(c.flatMap(m=>[m.x,m.y]),[]);return h.length===0?null:{vertices:c,indices:h}}function MB(l,t){const o=[],c=[];let p=0;const h=[];for(const m of l){p=o.length;const x=m.vertexArray.float32,A=m.indexArray.uint16;for(let R=0;R<m.vertexArray.length;R++)h[0]=x[3*R+0],h[1]=x[3*R+1],h[2]=x[3*R+2],_e.vec3.transformMat4(h,h,t),o.push(new De(h[0],h[1]));for(let R=0;R<3*m.indexArray.length;R++)c.push(A[R]+p)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){const x=o[c[m+0]],A=o[c[m+1]],R=o[c[m+2]];(x.x-A.x)*(R.y-A.y)-(R.x-A.x)*(x.y-A.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:o,indices:c}}function hA(l){const t=function(A,R){const y=[],T=WebGL2RenderingContext;if(A.json.textures)for(const C of A.json.textures){const E={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};C.sampler!==void 0&&Object.assign(E,A.json.samplers[C.sampler]),y.push({image:R[C.source],sampler:E,uploaded:!1})}return y}(l,l.images),o=function(A,R){const y=[];for(const T of A.json.meshes){const C=[];for(const E of T.primitives)C.push(RB(E,A,R));y.push(C)}return y}(l,t),{scenes:c,scene:p,nodes:h}=l.json,m=c?c[p||0].nodes:h,x=[];for(const A of m)x.push(uA(h[A],l,o));return function(A,R,y){const T={},C=new Set;for(let E=0;E<A.length;E++){const S=y[R[E]];if(!S.extras)continue;const P=S.extras["mapbox:footprint:version"],O=S.extras["mapbox:footprint:id"];(P||O)&&C.add(E),P==="1.0.0"&&O&&(T[O]=E)}for(let E=0;E<A.length;E++){if(C.has(E))continue;const S=A[E],P=y[R[E]];if(!P.extras)continue;let O=null;S.id in T&&(O=MB(A[T[S.id]].meshes,S.matrix)),O||(O=PB(P)),O&&(S.footprint=kB(O))}if(C.size>0){const E=Array.from(C.values()).sort((S,P)=>S-P);for(let S=E.length-1;S>=0;S--)A.splice(E[S],1)}}(x,m,l.json.nodes),x}function DB(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const t=l.vertexArray.float32,o=l.aabb.min[0]-1,c=l.aabb.min[1]-1,p=Bh/(l.aabb.max[0]-o+2),h=Bh/(l.aabb.max[1]-c+2);for(let m=0;m<t.length;m+=3){const x=t[m+2],A=(t[m+0]-o)*p|0,R=(t[m+1]-c)*h|0;x>l.heightmap[R*Bh+A]&&(l.heightmap[R*Bh+A]=x)}}function LB(l,t){const o={};o.indexArray=new po,o.indexArray.reserve(4*l.length),o.vertexArray=new Hl,o.vertexArray.reserve(10*l.length),o.colorArray=new hl,o.vertexArray.reserve(10*l.length);let c=0;for(const m of l){const x=Math.min(10,Math.max(4,1.3*m.height))*t,A=[-m.normal[1],m.normal[0],0],R=Math.min(.29,.1*m.width/m.depth),y=m.width-2*m.depth*t*(R+.01),T=_e.vec3.scaleAndAdd([],m.pos,A,y/2),C=_e.vec3.scaleAndAdd([],m.pos,A,-y/2),E=[T[0],T[1],T[2]+m.height],S=[C[0],C[1],C[2]+m.height],P=_e.vec3.scaleAndAdd([],m.normal,A,R);_e.vec3.scale(P,P,x);const O=_e.vec3.scaleAndAdd([],m.normal,A,-R);_e.vec3.scale(O,O,x),_e.vec3.add(P,T,P),_e.vec3.add(O,C,O),T[2]+=.1,C[2]+=.1,o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(O[0],O[1],O[2]),o.vertexArray.emplaceBack(T[0],T[1],T[2]),o.vertexArray.emplaceBack(C[0],C[1],C[2]),o.vertexArray.emplaceBack(E[0],E[1],E[2]),o.vertexArray.emplaceBack(S[0],S[1],S[2]),o.vertexArray.emplaceBack(T[0],T[1],T[2]),o.vertexArray.emplaceBack(C[0],C[1],C[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(O[0],O[1],O[2]);const F=y/x/2;o.colorArray.emplaceBack(-F-R,-1,F,.8),o.colorArray.emplaceBack(F+R,-1,F,.8),o.colorArray.emplaceBack(-F,0,F,1.3),o.colorArray.emplaceBack(F,0,F,1.3),o.colorArray.emplaceBack(F+R,-.8,F,.7),o.colorArray.emplaceBack(F+R,-.8,F,.7),o.colorArray.emplaceBack(0,0,F,1.3),o.colorArray.emplaceBack(0,0,F,1.3),o.colorArray.emplaceBack(F+R,-1.2,F,.8),o.colorArray.emplaceBack(F+R,-1.2,F,.8),o.indexArray.emplaceBack(6+c,4+c,8+c),o.indexArray.emplaceBack(7+c,9+c,5+c),o.indexArray.emplaceBack(0+c,1+c,2+c),o.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}const p={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=an.white,p.pbrMetallicRoughness=h,o.material=p,o.aabb=new Gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}class dA{constructor(t){this._stringToNumber={},this._numberToString=[];for(let o=0;o<t.length;o++){const c=t[o];this._stringToNumber[c]=o,this._numberToString[o]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const OB=["id","tile","layer","source","sourceLayer","state"];class fA{constructor(t,o,c,p,h){this.type="Feature",this._vectorTileFeature=t,this._z=o,this._x=c,this._y=p,this.properties=t.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of OB)this[o]!==void 0&&(t[o]=this[o]);return t}}class pA{constructor(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new vc(Ut,16,0),this.featureIndexArray=new w_,this.promoteId=o,this.is3DTile=!1}insert(t,o,c,p,h,m=0,x=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,h,m);const R=this.grid;for(let y=0;y<o.length;y++){const T=o[y],C=[1/0,1/0,-1/0,-1/0];for(let E=0;E<T.length;E++){const S=T[E];C[0]=Math.min(C[0],S.x),C[1]=Math.min(C[1],S.y),C[2]=Math.max(C[2],S.x),C[3]=Math.max(C[3],S.y)}x!==0&&(C[0]-=x,C[1]-=x,C[2]+=x,C[3]+=x),C[0]<Ut&&C[1]<Ut&&C[2]>=0&&C[3]>=0&&R.insert(A,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new tf.VectorTile(new q_(this.rawTileData)).layers,this.sourceLayerCoder=new dA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,o,c,p){this.loadVTLayers();const h=t.params||{},m=Ta(h.filter),x=t.tileResult,A=t.transform,R=x.bufferedTilespaceBounds,y=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,(S,P,O,F)=>ea(x.bufferedTilespaceGeometry,S,P,O,F));y.sort(BB);let T=null;A.elevation&&y.length>0&&(T=cf.create(A.elevation,this.tileID));const C={};let E;for(let S=0;S<y.length;S++){const P=y[S];if(P===E)continue;E=P;const O=this.featureIndexArray.get(P);let F=null;if(this.is3DTile){const j=this.bucketLayerIDs[0][0],G=o[j];if(G.type!=="model")continue;const{queryFeature:N,intersectionZ:Z}=G.queryIntersectsMatchingFeature(x,O.featureIndex,m,A);N&&this.appendToResult(C,j,O.featureIndex,N,Z)}else this.loadMatchingFeature(C,O,m,h.layers,h.availableImages,o,c,p,(j,G,N,Z=0)=>(F||(F=Pt(j,this.tileID.canonical,t.tileTransform)),G.queryIntersectsFeature(x,j,N,F,this.z,t.transform,t.pixelPosMatrix,T,Z)))}return C}loadMatchingFeature(t,o,c,p,h,m,x,A,R){const{featureIndex:y,bucketIndex:T,sourceLayerIndex:C,layoutVertexArrayOffset:E}=o,S=this.bucketLayerIDs[T];if(p&&!function(j,G){for(let N=0;N<j.length;N++)if(G.indexOf(j[N])>=0)return!0;return!1}(p,S))return;const P=this.sourceLayerCoder.decode(C),O=this.vtLayers[P].feature(y);if(c.needGeometry){const j=Lt(O,!0);if(!c.filter(new wi(this.tileID.overscaledZ),j,this.tileID.canonical))return}else if(!c.filter(new wi(this.tileID.overscaledZ),O))return;const F=this.getId(O,P);for(let j=0;j<S.length;j++){const G=S[j];if(p&&p.indexOf(G)<0)continue;const N=m[G];if(!N)continue;let Z={};F!==void 0&&A&&(Z=A.getState(N.sourceLayer||"_geojsonTileLayer",F));const K=!R||R(O,N,Z,E);if(!K)continue;const ie=new fA(O,this.z,this.x,this.y,F),ue=Xr({},x[G]);ue.paint=mA(ue.paint,N.paint,O,Z,h),ue.layout=mA(ue.layout,N.layout,O,Z,h),ie.layer=ue,this.appendToResult(t,G,y,ie,K)}}appendToResult(t,o,c,p,h){let m=t[o];m===void 0&&(m=t[o]=[]),m.push({featureIndex:c,feature:p,intersectionZ:h})}lookupSymbolFeatures(t,o,c,p,h,m,x,A){const R={};this.loadVTLayers();const y=Ta(h);for(const T of t)this.loadMatchingFeature(R,{bucketIndex:c,sourceLayerIndex:p,featureIndex:T,layoutVertexArrayOffset:0},y,m,x,A,o);return R}loadFeature(t){const{featureIndex:o,sourceLayerIndex:c}=t;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),h=this.vtFeatures[p];if(h[o])return h[o];const m=this.vtLayers[p].feature(o);return h[o]=m,m}hasLayer(t){for(const o of this.bucketLayerIDs)for(const c of o)if(t===c)return!0;return!1}getId(t,o){let c=t.id;if(this.promoteId){const p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];p!=null&&(c=t.properties[p]),typeof c=="boolean"&&(c=Number(c))}return c}}function mA(l,t,o,c,p){return co(l,(h,m)=>{const x=t instanceof cu?t.get(m):null;return x&&x.evaluate?x.evaluate(o,c,p):x})}function BB(l,t){return t-l}rr(pA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const gA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Hb{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,c]=new Uint8Array(t,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const h=gA[15&c];if(!h)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new Hb(x,m,h,t)}constructor(t,o=64,c=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const h=gA.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-x%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+A,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+A),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+A,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=t)}add(t,o){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=o,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Wb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,o,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:x}=this,A=[0,h.length-1,0],R=[];for(;A.length;){const y=A.pop()||0,T=A.pop()||0,C=A.pop()||0;if(T-C<=x){for(let O=C;O<=T;O++){const F=m[2*O],j=m[2*O+1];F>=t&&F<=c&&j>=o&&j<=p&&R.push(h[O])}continue}const E=C+T>>1,S=m[2*E],P=m[2*E+1];S>=t&&S<=c&&P>=o&&P<=p&&R.push(h[E]),(y===0?t<=S:o<=P)&&(A.push(C),A.push(E-1),A.push(1-y)),(y===0?c>=S:p>=P)&&(A.push(E+1),A.push(T),A.push(1-y))}return R}within(t,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:h,nodeSize:m}=this,x=[0,p.length-1,0],A=[],R=c*c;for(;x.length;){const y=x.pop()||0,T=x.pop()||0,C=x.pop()||0;if(T-C<=m){for(let O=C;O<=T;O++)yA(h[2*O],h[2*O+1],t,o)<=R&&A.push(p[O]);continue}const E=C+T>>1,S=h[2*E],P=h[2*E+1];yA(S,P,t,o)<=R&&A.push(p[E]),(y===0?t-c<=S:o-c<=P)&&(x.push(C),x.push(E-1),x.push(1-y)),(y===0?t+c>=S:o+c>=P)&&(x.push(E+1),x.push(T),x.push(1-y))}return A}}function Wb(l,t,o,c,p,h){if(p-c<=o)return;const m=c+p>>1;_A(l,t,m,c,p,h),Wb(l,t,o,c,m-1,1-h),Wb(l,t,o,m+1,p,1-h)}function _A(l,t,o,c,p,h){for(;p>c;){if(p-c>600){const R=p-c+1,y=o-c+1,T=Math.log(R),C=.5*Math.exp(2*T/3),E=.5*Math.sqrt(T*C*(R-C)/R)*(y-R/2<0?-1:1);_A(l,t,o,Math.max(c,Math.floor(o-y*C/R+E)),Math.min(p,Math.floor(o+(R-y)*C/R+E)),h)}const m=t[2*o+h];let x=c,A=p;for(Im(l,t,c,o),t[2*p+h]>m&&Im(l,t,c,p);x<A;){for(Im(l,t,x,A),x++,A--;t[2*x+h]<m;)x++;for(;t[2*A+h]>m;)A--}t[2*c+h]===m?Im(l,t,c,A):(A++,Im(l,t,A,p)),A<=o&&(c=A+1),o<=A&&(p=A-1)}}function Im(l,t,o,c){Zb(l,o,c),Zb(t,2*o,2*c),Zb(t,2*o+1,2*c+1)}function Zb(l,t,o){const c=l[t];l[t]=l[o],l[o]=c}function yA(l,t,o,c){const p=l-o,h=t-c;return p*p+h*h}s.$=d_,s.A=class extends cy{},s.B=Ks,s.C=_a,s.D=Th,s.E=ga,s.F=xp,s.G=Sd,s.H=n_,s.I=_b,s.J=kd,s.K=Nd,s.L=l_,s.M=vh,s.N=gr,s.O=bn,s.P=De,s.Q=$t,s.R=$s,s.S=oo,s.T=Rb,s.U=$o,s.V=cy,s.W=Pp,s.X=Cd,s.Y=bp,s.Z=function(l){const t=l.value;let o=[];if(!t)return o;const c=Ks(t);return c!=="string"?(o=o.concat([new cy(l.key,t,`string expected, "${c}" found`)]),o):(CI(t,!0)||(o=o.concat([new cy(l.key,t,`invalid url "${t}"`)])),o)},s._=tt,s.a=function(l){return Ce.API_CDN_URL_REGEX.test(l)},s.a$=Vp,s.a0=si,s.a1=Ot,s.a2=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return to(l.expression.evaluate(t))}interpolate(l,t,o){return{x:xr(l.x,t.x,o),y:xr(l.y,t.y,o),z:xr(l.z,t.z,o),azimuthal:xr(l.azimuthal,t.azimuthal,o),polar:xr(l.polar,t.polar,o)}}},s.a3=wi,s.a4=Xa,s.a5=Xe,s.a6=_e,s.a7=Ir,s.a8=cu,s.a9=bu,s.aA=qn,s.aB=mI,s.aC=xI,s.aD=pI,s.aE=function(l,t){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){t(null,o)};for(let c=0;c<l.length;c++){const p=document.createElement("source");Po(l[c])||(o.crossOrigin="Anonymous"),p.src=l[c],o.appendChild(p)}return{cancel:()=>{}}},s.aF=iy,s.aG=function(l){return fetch(l).then(t=>t.arrayBuffer()).then(t=>cA(t,0,l))},s.aH=hA,s.aI=class{constructor(l,t,o,c){this.id=l,this.position=t!=null?new q(t[0],t[1]):new q(0,0),this.orientation=o??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new Gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,t){if(_e.mat4.multiply(l.matrix,t,l.matrix),l.meshes)for(const o of l.meshes){const c=Gn.applyTransformFast(o.aabb,l.matrix);this.aabb.encapsulate(c)}if(l.children)for(const o of l.children)this._applyTransformations(o,l.matrix)}computeBoundsAndApplyParent(){const l=_e.mat4.identity([]);for(const t of this.nodes)this._applyTransformations(t,l)}computeModelMatrix(l,t,o,c,p,h,m=!1){DI(this.matrix,this,l.transform,this.position,t,o,c,p,h,m)}upload(l){if(!this.uploaded){for(const t of this.nodes)Lb(t,l);for(const t of this.nodes)uy(t);this.uploaded=!0}}destroy(){for(const l of this.nodes)Ob(l)}},s.aJ=yo,s.aK=um,s.aL=ye,s.aM=ge,s.aN=Gl,s.aO=po,s.aP=xi,s.aQ=Xd,s.aR=ry,s.aS=function(){gs.isLoading()||gs.isLoaded()||Cp()!=="deferred"||Rp()},s.aT=Ta,s.aU=Lt,s.aV=fA,s.aW=Ro,s.aX=cb,s.aY=Qv,s.aZ=Pt,s.a_=ql,s.aa=xr,s.ab=Ut,s.ac=cs,s.ad=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return function([o,c]){const p=to([1,o,c]);return{x:p.x,y:p.y,z:p.z}}(l.expression.evaluate(t))}interpolate(l,t,o){return{x:xr(l.x,t.x,o),y:xr(l.y,t.y,o),z:xr(l.z,t.z,o)}}},s.ae=function(l,t,o=0,c=!0){const p=new De(o,o),h=l.sub(p),m=t.add(p),x=[h,new De(m.x,h.y),m,new De(h.x,m.y)];return c&&x.push(h.clone()),x},s.af=function(l,t){const o=[];for(let c=0;c<l.length;c++){const p=Sr(c-1,-1,l.length-1),h=Sr(c+1,-1,l.length-1),m=l[c],x=l[h],A=l[p].sub(m).unit(),R=x.sub(m).unit(),y=R.angleWithSep(A.x,A.y),T=A.add(R).unit().mult(-1*t/Math.sin(y/2));o.push(m.add(T))}return o},s.ag=eI,s.ah=ea,s.ai=function(l,t,o=0){return _e.vec3.fromValues(((t.x-o)*l.scale-l.x)*Ut,(t.y*l.scale-l.y)*Ut,Ae(t.z,t.y))},s.aj=ml,s.ak=bE,s.al=function(l){let t=1/0,o=1/0,c=-1/0,p=-1/0;for(const h of l)t=Math.min(t,h.x),o=Math.min(o,h.y),c=Math.max(c,h.x),p=Math.max(p,h.y);return{min:new De(t,o),max:new De(c,p)}},s.am=he,s.an=Xn,s.ao=bt,s.ap=Ft,s.aq=r,s.ar=function(l,t){const o={};for(let c=0;c<t.length;c++){const p=t[c];p in l&&(o[p]=l[p])}return o},s.as=Y,s.at=pe,s.au=class{constructor(l){this.entries={},this.scheduler=l}request(l,t,o,c){const p=this.entries[l]=this.entries[l]||{callbacks:[]};if(p.result){const[h,m]=p.result;return this.scheduler?this.scheduler.add(()=>{c(h,m)},t):c(h,m),()=>{}}return p.callbacks.push(c),p.cancel||(p.cancel=o((h,m)=>{p.result=[h,m];for(const x of p.callbacks)this.scheduler?this.scheduler.add(()=>{x(h,m)},t):x(h,m);setTimeout(()=>delete this.entries[l],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(h=>h!==c),p.callbacks.length||(p.cancel(),delete this.entries[l]))}}},s.av=g_,s.aw=function(l,t,o){const c=JSON.stringify(l.request);return l.data&&(this.deduped.entries[c]={result:[null,l.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},p=>{const h=Oa(l.request,(m,x,A,R)=>{m?p(m):x&&p(null,{vectorTile:o?void 0:new tf.VectorTile(new q_(x)),rawData:x,cacheControl:A,expires:R})});return()=>{h.cancel(),p()}},t)},s.ax=function(l){mi++,mi>on&&(l.getActor().send("enforceCacheSizeLimit",br),mi=0)},s.ay=Gt,s.az=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},s.b=function(l){return Ce.API_FONTS_REGEX.test(l)},s.b$=function(l){const{x:t,y:o}=l.point,{lng:c,lat:p}=l._center;return dT(t,o,l.worldSize,c,p)},s.b0=ra,s.b1=Ti,s.b2=Kp,s.b3=Ab,s.b4=function(l,t){const o=bu(t.zoom);if(o===0)return Kl(l);const c=k_(l),p=qv(c),h=he(c.getWest())*t.worldSize,m=he(c.getEast())*t.worldSize,x=pe(c.getNorth())*t.worldSize,A=pe(c.getSouth())*t.worldSize,R=[h,x,0],y=[m,x,0],T=[h,A,0],C=[m,A,0],E=_e.mat4.invert([],t.globeMatrix);return _e.vec3.transformMat4(R,R,E),_e.vec3.transformMat4(y,y,E),_e.vec3.transformMat4(T,T,E),_e.vec3.transformMat4(C,C,E),p[0]=Sc(p[0],T,o),p[1]=Sc(p[1],C,o),p[2]=Sc(p[2],y,o),p[3]=Sc(p[3],R,o),Gn.fromPoints(p)},s.b5=M_,s.b6=Zp,s.b7=Sc,s.b8=$d,s.b9=_s,s.bA=Sr,s.bB=Dt,s.bC=Us,s.bD=ce,s.bE=function(l,t,o){l[4*t+0]=o[0],l[4*t+1]=o[1],l[4*t+2]=o[2],l[4*t+3]=o[3]},s.bF=Mh,s.bG=Ka,s.bH=qp,s.bI=Fo,s.bJ=Ec,s.bK=q,s.bL=oI,s.bM=Yi,s.bN=vu,s.bO=TI,s.bP=no,s.bQ=cT,s.bR=function(l,t,o,c,p,h,m,x,A){if(A.name==="globe")return cT(l,t,new no(o,c,p),!1);const R=um({z:o,x:c,y:p},A);return new Gn([(h+R.x/R.scale)*t,t*(R.y/R.scale),m],[(h+R.x2/R.scale)*t,t*(R.y2/R.scale),x])},s.bS=function(l,t,o){let c=0;for(let p=0;p<2;++p)l[p]>0&&(c+=(l[p]-0)*(l[p]-0)),t[p]<0&&(c+=(0-t[p])*(0-t[p]));return c},s.bT=Te,s.bU=f,s.bV=function(l){const t=_e.mat4.identity(new Float64Array(16));_e.mat4.multiply(t,l.pixelMatrix,l.globeMatrix);const o=[0,k,0],c=[0,M,0];return _e.vec3.transformMat4(o,o,t),_e.vec3.transformMat4(c,c,t),[o[0]>0&&o[0]<=l.width&&o[1]>0&&o[1]<=l.height&&!Wv(l,new q(l.center.lat,90)),c[0]>0&&c[0]<=l.width&&c[1]>0&&c[1]<=l.height&&!Wv(l,new q(l.center.lat,-90))]},s.bW=function(l,t){const{scale:o}=l.tileTransform,c=o*Ut/(l.tileSize*Math.pow(2,t.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return _e.mat2.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[c,c])},s.bX=ay,s.bY=wI,s.bZ=function(l){const t=wI(l,!0);return _e.mat2.invert([],[t[0],t[1],t[4],t[5]])},s.b_=Xl,s.ba=Vb,s.bb=q_,s.bc=Oa,s.bd=function(l){const t=[];for(const o in l)t.push(l[o]);return t},s.be=function(l,t){const o=[];for(const c in l)c in t||o.push(c);return o},s.bf=tn,s.bg=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bh=jt,s.bi=function(l,t){const{x:o,y:c}=l.point,p=dT(o,c,l.worldSize/l._pixelsPerMercatorPixel,0,0);return _e.mat4.multiply(p,p,Gv(Kl(t)))},s.bj=rf,s.bk=Ia,s.bl=$_,s.bm=function(l,t,o,c,p){const h=5*t+2;l.float32[h+0]=o,l.float32[h+1]=c,l.float32[h+2]=p},s.bn=ty,s.bo=$E,s.bp=Nt,s.bq=Eo,s.br=GT,s.bs=SI,s.bt=KT,s.bu=YT,s.bv=bb,s.bw=KE,s.bx=gb,s.by=Hb,s.bz=an,s.c=Ue,s.c$=Qo,s.c0=Wt,s.c1=Jo,s.c2=a,s.c3=function(l){const t=Math.round((l+45+360)%360/90)%4;return nr[t]},s.c4=45,s.c5=re,s.c6=Jd,s.c7=function(l,t,o){const c=Math.sqrt(l*l+t*t+o*o),p=c>0?Math.acos(o/c)*Zt:0;let h=l!==0||t!==0?Math.atan2(-t,-l)*Zt+90:0;return h<0&&(h+=360),[c,h,p]},s.c8=Re,s.c9=Gn,s.cA=function(l){const t=Te-5;l=Ft(l,-t,t)/t*90;const o=Math.pow(Math.abs(Math.sin(Dt(l))),3);return Math.round(o*(w.length-1))},s.cB=function(l,t,o,c){const p=t.getNorth(),h=t.getSouth(),m=t.getWest(),x=t.getEast(),A=1<<l.z,R=x-m,y=p-h,T=R/v,C=-y/w[o],E=[0,T,0,C,0,0,p,m,0];if(l.z>0){const S=180/c;_e.mat3.multiply(E,E,[S/R+1,0,0,0,S/y+1,0,-.5*S/T,.5*S/C,1])}return E[2]=A,E[5]=l.x,E[8]=l.y,E},s.cC=Kl,s.cD=function(l,t,o){const c=_e.mat4.identity(new Float64Array(16)),p=(t/(1<<l)-.5)*Math.PI*2;return _e.mat4.rotateY(c,o.globeMatrix,p),Float32Array.from(c)},s.cE=class{isDataAvailableAtPoint(l){const t=this._source();if(this.isUsingMockSource()||!t||l.y<0||l.y>1)return!1;const o=t.getSource().maxzoom,c=1<<o,p=Math.floor(l.x),h=Math.floor((l.x-p)*c),m=Math.floor(l.y*c),x=this.findDEMTileFor(new qn(o,p,o,h,m));return!(!x||!x.dem)}getAtPointOrZero(l,t=0){return this.getAtPoint(l,t)||0}getAtPoint(l,t,o=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const c=this._source();if(!c||l.y<0||l.y>1)return t;const p=c.getSource().maxzoom,h=1<<p,m=Math.floor(l.x),x=l.x-m,A=new qn(p,m,p,Math.floor(x*h),Math.floor(l.y*h)),R=this.findDEMTileFor(A);if(!R||!R.dem)return t;const y=R.dem,T=1<<R.tileID.canonical.z,C=(x*T-R.tileID.canonical.x)*y.dim,E=(l.y*T-R.tileID.canonical.y)*y.dim,S=Math.floor(C),P=Math.floor(E);return(o?this.exaggeration():1)*xr(xr(y.get(S,P),y.get(S,P+1),E-P),xr(y.get(S+1,P),y.get(S+1,P+1),E-P),C-S)}getAtTileOffset(l,t,o){const c=1<<l.canonical.z;return this.getAtPointOrZero(new Xe(l.wrap+(l.canonical.x+t/Ut)/c,(l.canonical.y+o/Ut)/c))}getAtTileOffsetFunc(l,t,o,c){return p=>{const h=this.getAtTileOffset(l,p.x,p.y),m=c.upVector(l.canonical,p.x,p.y),x=c.upVectorScale(l.canonical,t,o).metersToTile;return _e.vec3.scale(m,m,h*x),m}}getForTilePoints(l,t,o,c){if(this.isUsingMockSource())return!1;const p=cf.create(this,l,c);return!!p&&(t.forEach(h=>{h[2]=this.exaggeration()*p.getElevationAt(h[0],h[1],o)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(l);if(!t||!t.dem)return null;const o=t.dem.tree,c=t.tileID,p=1<<l.canonical.z-c.canonical.z;let h=l.canonical.x/p-c.canonical.x,m=l.canonical.y/p-c.canonical.y,x=0;for(let A=0;A<l.canonical.z-c.canonical.z&&!o.leaves[x];A++){h*=2,m*=2;const R=2*Math.floor(m)+Math.floor(h);x=o.childOffsets[x]+R,h%=1,m%=1}return{min:this.exaggeration()*o.minimums[x],max:this.exaggeration()*o.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,t,o){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let t=!1,o=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const p of l){const h=this.getMinMaxForTile(p.tileID);h&&(o=Math.min(o,h.min),c=Math.max(c,h.max),t=!0)}return t?{min:o,max:c}:null}},s.cF=IT,s.cG=Ac,s.cH=function(l,t){return[Math.pow(l[0],2.2)*t,Math.pow(l[1],2.2)*t,Math.pow(l[2],2.2)*t]},s.cI=hT,s.cJ=ve,s.cK=oe,s.cL=256,s.cM=function(l,t){const o=[0,0,0],c=M_(Kl(t.canonical));return _e.vec3.transformMat4(o,o,c),_e.vec3.transformMat4(o,o,l),o},s.cN=l=>({u_camera_to_center_distance:new Fo(l),u_extrude_scale:new Hp(l),u_device_pixel_ratio:new Fo(l),u_matrix:new Mh(l),u_inv_rot_matrix:new Mh(l),u_merc_center:new Ka(l),u_tile_id:new qp(l),u_zoom_transition:new Fo(l),u_up_dir:new qp(l),u_emissive_strength:new Fo(l)}),s.cO=l=>({u_matrix:new Mh(l),u_pixels_to_tile_units:new Hp(l),u_device_pixel_ratio:new Fo(l),u_units_to_pixels:new Ka(l),u_dash_image:new Ec(l),u_gradient_image:new Ec(l),u_image_height:new Fo(l),u_texsize:new Ka(l),u_tile_units_to_pixels:new Fo(l),u_alpha_discard_threshold:new Fo(l),u_trim_offset:new Ka(l),u_trim_fade_range:new Ka(l),u_trim_color:new Jd(l),u_emissive_strength:new Fo(l)}),s.cP=l=>({u_matrix:new Mh(l),u_texsize:new Ka(l),u_pixels_to_tile_units:new Hp(l),u_device_pixel_ratio:new Fo(l),u_image:new Ec(l),u_units_to_pixels:new Ka(l),u_tile_units_to_pixels:new Fo(l),u_alpha_discard_threshold:new Fo(l),u_trim_offset:new Ka(l)}),s.cQ=Yo,s.cR=iO,s.cS=oO,s.cT=mT,s.cU=(l,t,o,c,p,h)=>{const m=l.transform,x=m.projection.name==="globe";let A;if(h.paint.get("circle-pitch-alignment")==="map")if(x){const y=hT(m.zoom,t.canonical)*m._pixelsPerMercatorPixel;A=Float32Array.from([y,0,0,y])}else A=m.calculatePixelsToTileUnitsMatrix(o);else A=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(m.projection),u_matrix:l.translatePosMatrix(t.projMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ht.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:lL,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(x){R.u_inv_rot_matrix=c,R.u_merc_center=p,R.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],R.u_zoom_transition=bu(m.zoom);const y=p[0]*Ut,T=p[1]*Ut;R.u_up_dir=m.projection.upVector(new no(0,0,0),y,T)}return R},s.cV=TE,s.cW=(l,t,o,c,p,h)=>{const m=l.transform;return{u_matrix:wE(l,t,o,c),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:p,u_image:0,u_tile_units_to_pixels:xE(t,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:h}},s.cX=(l,t,o,c,p,h,m)=>{const x=l.transform,A=x.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:wE(l,t,o,c),u_pixels_to_tile_units:A,u_device_pixel_ratio:h,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:EE(o)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:xE(t,l.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength")}},s.cY=Ii,s.cZ=Xp,s.c_=uE,s.ca=to,s.cb=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},s.cc=function(l){return l({pluginStatus:so,pluginURL:$l}),Sp.on("pluginStateChange",l),l},s.cd=uf,s.ce=fy,s.cf=of,s.cg=yb,s.ch=Ml,s.ci=h_,s.cj=Er,s.ck=$i,s.cl=fi,s.cm=function(l){const t=l.indexOf(hu);return t>=0?l.slice(0,t):l},s.cn=function(l){return l.indexOf(hu)>=0},s.co=function(l){const t=l.indexOf(hu);return t>=0?l.slice(t+1):""},s.cp=function(l){const t=[],o=l.id;return o===void 0&&t.push({message:`layers.${o}: missing required property "id"`}),l.render===void 0&&t.push({message:`layers.${o}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&t.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),t},s.cq=function(l,t,o,c){return l.type==="custom"?new BO(l,t):new WO[l.type](l,t,o,c)},s.cr=Mi,s.cs=Sp,s.ct=La,s.cu=Gp,s.cv=class extends pl{constructor(l){super(l),this.current=zv}set(l,t,o){if(this.fetchUniformLocation(l,t)){for(let c=0;c<9;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},s.cw=Kt,s.cx=function(l,t,o){const c=bu(o.zoom),p=l.style.map._antialias,h=t.options.extStandardDerivativesForceOff||l.terrain&&l.terrain.exaggeration()>0;return c===0&&!p&&!h},s.cy=function(l){const t=l.pixelsPerMeter,o=t/ce(1,l.center.lat),c=_e.mat4.identity(new Float64Array(16));return _e.mat4.translate(c,c,[l.point.x,l.point.y,0]),_e.mat4.scale(c,c,[o,o,t]),Float32Array.from(c)},s.cz=k_,s.d=function(l){return Ce.API_TILEJSON_REGEX.test(l)},s.d$=$,s.d0=j_,s.d1=wu,s.d2=450,s.d3=7,s.d4=OO,s.d5=dn,s.d6=Wd,s.d7=256,s.d8=Gv,s.d9=Hl,s.dA=fT,s.dB=function(l){const t=[0,0,0],o=_e.mat4.identity(new Float64Array(16));return _e.mat4.multiply(o,l.pixelMatrix,l.globeMatrix),_e.vec3.transformMat4(t,t,o),new De(t[0],t[1])},s.dC=function(l,t,o=!1){if(so===xh||so===wh||so===zd)throw new Error("setRTLTextPlugin cannot be called multiple times.");$l=Ht.resolveURL(l),so=xh,au=t,Ap(),o||Rp()},s.dD=Cp,s.dE=function(){fy().acquire(Ub)},s.dF=function(){const l=wm;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ub),wm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dG=xm,s.dH=function(l){const t=Bn();if(!t)return;const o=t.delete(Rr);l&&o.catch(l).then(()=>l())},s.dI=bm,s.dJ=rA,s.dK=function(l){jb=Ht.resolveURL(l),ff||(ff=new uf(fy(),new ga)),ff.broadcast("setDracoUrl",jb)},s.dL=nA,s.dM=function(l){df=Ht.resolveURL(l),ff||(ff=new uf(fy(),new ga)),ff.broadcast("setMeshoptUrl",df)},s.dN=rr,s.dO=xu,s.dP=_l,s.dQ=dA,s.dR=pA,s.dS=gE,s.dT=co,s.dU=GE,s.dV=function(l,t,o,c,p,h,m,x,A,R,y){l.createArrays(),l.tilePixelRatio=Ut/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const T=l.layers[0].layout,C=l.layers[0]._unevaluatedLayout._values,E={};if(l.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=l.textSizeData;E.compositeTextSizes=[C["text-size"].possiblyEvaluate(new wi(F),x),C["text-size"].possiblyEvaluate(new wi(j),x)]}if(l.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=l.iconSizeData;E.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new wi(F),x),C["icon-size"].possiblyEvaluate(new wi(j),x)]}E.layoutTextSize=C["text-size"].possiblyEvaluate(new wi(A+1),x),E.layoutIconSize=C["icon-size"].possiblyEvaluate(new wi(A+1),x),E.textMaxSize=C["text-size"].possiblyEvaluate(new wi(18),x);const S=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",P=T.get("text-size");let O=!1;for(const F of l.features)if(F.icon&&F.icon.nameSecondary){O=!0;break}for(const F of l.features){const j=T.get("text-font").evaluate(F,{},x).join(","),G=P.evaluate(F,{},x),N=E.layoutTextSize.evaluate(F,{},x),Z=(E.layoutIconSize.evaluate(F,{},x),{horizontal:{},vertical:void 0}),K=F.text;let ie,ue=[0,0];if(K){const xe=K.toString(),me=T.get("text-letter-spacing").evaluate(F,{},x)*Eo,Ee=T.get("text-line-height").evaluate(F,{},x)*Eo,Pe=Iv(xe)?me:0,Be=T.get("text-anchor").evaluate(F,{},x),ze=T.get("text-variable-anchor");if(!ze){const xt=T.get("text-radial-offset").evaluate(F,{},x);ue=xt?KE(Be,[xt*Eo,vb]):T.get("text-offset").evaluate(F,{},x).map(lt=>lt*Eo)}let Ge=S?"center":T.get("text-justify").evaluate(F,{},x);const rt=T.get("symbol-placement")==="point",Ze=rt?T.get("text-max-width").evaluate(F,{},x)*Eo:1/0,ft=xt=>{l.allowVerticalPlacement&&Ld(xe)&&(Z.vertical=mb(K,t,o,p,j,Ze,Ee,Be,xt,Pe,ue,Ia.vertical,!0,N,G))};if(!S&&ze){const xt=Ge==="auto"?ze.map(Yt=>bb(Yt)):[Ge];let lt=!1;for(let Yt=0;Yt<xt.length;Yt++){const Vt=xt[Yt];if(!Z.horizontal[Vt])if(lt)Z.horizontal[Vt]=Z.horizontal[0];else{const Mt=mb(K,t,o,p,j,Ze,Ee,"center",Vt,Pe,ue,Ia.horizontal,!1,N,G);Mt&&(Z.horizontal[Vt]=Mt,lt=Mt.positionedLines.length===1)}}ft("left")}else{if(Ge==="auto"&&(Ge=bb(Be)),rt||T.get("text-writing-mode").indexOf("horizontal")>=0||!Ld(xe)){const xt=mb(K,t,o,p,j,Ze,Ee,Be,Ge,Pe,ue,Ia.horizontal,!1,N,G);xt&&(Z.horizontal[Ge]=xt)}ft(rt?"left":Ge)}}let de=!1;if(F.icon&&F.icon.namePrimary){const xe=c[F.icon.namePrimary];xe&&(ie=mO(p[F.icon.namePrimary],F.icon.nameSecondary?p[F.icon.nameSecondary]:void 0,T.get("icon-offset").evaluate(F,{},x),T.get("icon-anchor").evaluate(F,{},x)),de=xe.sdf,l.sdfIcons===void 0?l.sdfIcons=xe.sdf:l.sdfIcons!==xe.sdf&&nn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xe.pixelRatio!==l.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0))}const le=JE(Z.horizontal)||Z.vertical;l.iconsInText||(l.iconsInText=!!le&&le.iconsInText),(le||ie)&&wO(l,F,Z,ie,c,E,N,0,ue,de,m,x,R,y,O)}h&&l.generateCollisionDebugBuffers(A,l.collisionBoxArray)},s.dW=tf,s.dX=dy,s.dY=Ye,s.dZ=UT,s.d_=kE,s.da=fl,s.db=Np,s.dc=function(l,t,o,c,p){return Ft((l-t)/(o-t)*(p-c)+c,c,p)},s.dd=Ad,s.de=Oe,s.df=class{constructor(l,t,o,c){this.context=l,this.format=c,this.size=o,this.texture=l.gl.createTexture();const[p,h,m]=this.size,{gl:x}=l;x.bindTexture(x.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),x.texImage3D(x.TEXTURE_3D,0,this.format,p,h,m,0,Sb(this.format),Cb(this.format),t.data)}bind(l,t){const{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_3D,this.texture),l!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,l),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,l),this.minFilter=l),t!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},s.dg=Mb,s.dh=[1,1,1],s.di=cf,s.dj=lf,s.dk=Wl,s.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new De(1/0,1/0),max:new De(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,t=!1){const o=WT(new De(0,0),new De(Ut,Ut),l),c=[];if(t&&!ib(o,this._globalClipBounds))return c;for(const p of this._activeRegions){if(p.hiddenByOverlap||!ib(o,p))continue;const h=PL(p.min,p.max,l);c.push({min:h.min,max:h.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return c}setSources(l){this._setSources(l.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const o=[];for(const c of t.cache.getVisibleCoordinates()){const p=t.cache.getTile(c).buckets[t.layer];p&&p.updateFootprints(c.toUnwrapped(),o)}return o},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(l){const t=l.getFootprints();if(t.length===0)return;const o=l.getOrder(),c=l.getClipMask(),p=l.getClipScope();for(const h of t){if(!h.footprint)continue;const m=WT(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:o,clipMask:c,clipScope:p})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,o)=>t.priority-o.priority||V_(t.min,o.min)||V_(t.max,o.max)||t.order-o.order||t.clipMask-o.clipMask||function(c,p){const h=(m,x)=>m+x;return c.length-p.length||c.reduce(h,"").localeCompare(p.reduce(h,""))}(t.clipScope,o.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let t=0;for(;!l&&t!==this._activeRegions.length;){const o=this._activeRegions[t],c=this._prevRegions[t];l=o.priority!==c.priority||!HT(o,c)||o.order!==c.order||o.clipMask!==c.clipMask||!jt(o.clipScope,c.clipScope),++t}}if(l){++this._updateTime;for(const o of this._activeRegions)o.order!==N_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const t=o=>{const c=this._activeRegions;if(o>=c.length)return o;const p=c[o].priority;for(;o<c.length&&c[o].priority===p;)++o;return o};if(this._sourceIds.length>1){let o=0,c=t(o);for(;o!==c;){let p=o;const h=o;for(;p!==c;){const m=this._activeRegions[p];m.hiddenByOverlap=!1;for(let x=0;x<h;x++){const A=this._activeRegions[x];if(!A.hiddenByOverlap&&m.order===N_&&ib(m,A)&&(m.hiddenByOverlap=XT(m.footprint,m.tileId,A.footprint,A.tileId),m.hiddenByOverlap))break}++p}o=c,c=t(o)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=l.length-1;t>=0;t--)this._addSource(l[t]);this._computeReplacement()}},s.dm=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,t){const o=new ql,c=new po,p=[],h=l+1+2,m=t[0]+1,x=t[0]+1+(1+t.length),A=(R,y,T)=>{let C=R===h-1?R-2:R===0?R:R-1;return C+=T?24575:0,[C,y]};for(let R=0;R<h;++R)o.emplaceBack(...A(R,0,!0));for(let R=0;R<m;++R)for(let y=0;y<h;++y)o.emplaceBack(...A(y,R,(y===0||y===h-1)&&!0));for(let R=0;R<t.length;++R){const y=t[R];for(let T=0;T<h;++T)o.emplaceBack(...A(T,y,!0))}for(let R=0;R<t.length;++R){const y=c.length,T=t[R]+1+2,C=new po;for(let P=0;P<T-1;P++){const O=P===T-2,F=O?h*(x-t.length+R-P):h;for(let j=0;j<h-1;j++){const G=P*h+j;P===0||O||j===0||j===h-2?(C.emplaceBack(G+1,G,G+F),C.emplaceBack(G+F,G+F+1,G+1)):(c.emplaceBack(G+1,G,G+F),c.emplaceBack(G+F,G+F+1,G+1))}}const E=Ti.simpleSegment(0,y,o.length,c.length-y);for(let P=0;P<C.uint16.length;P+=3)c.emplaceBack(C.uint16[P],C.uint16[P+1],C.uint16[P+2]);const S=Ti.simpleSegment(0,y,o.length,c.length-y);p.push({withoutSkirts:E,withSkirts:S})}return{vertices:o,indices:c,segments:p}}_createGrid(l){const t=this._fillGridMeshWithLods(v,w);this._gridSegments=t.segments,this._gridBuffer=l.createVertexBuffer(t.vertices,ra.members),this._gridIndexBuffer=l.createIndexBuffer(t.indices,!0)}_createPoles(l){const t=new po;for(let m=0;m<=v;m++)t.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=l.createIndexBuffer(t,!0);const o=new fl,c=new fl,p=new fl,h=new fl;this._poleSegments=[];for(let m=0,x=0;m<a;m++){const A=360/(1<<m);o.emplaceBack(0,-r,0,.5,0),c.emplaceBack(0,-r,0,.5,1),p.emplaceBack(0,-r,0,.5,.5),h.emplaceBack(0,-r,0,.5,.5);for(let R=0;R<=v;R++){let y=R/v,T=0;const C=xr(0,A,y),[E,S,P]=B(sL,aL,C,r);o.emplaceBack(E,S,P,y,T),c.emplaceBack(E,S,P,y,1-T);const O=Dt(C);y=.5+.5*Math.sin(O),T=.5+.5*Math.cos(O),p.emplaceBack(E,S,P,y,T),h.emplaceBack(E,S,P,y,1-T)}this._poleSegments.push(Ti.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(o,Ms,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(c,Ms,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(p,Ms,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(h,Ms,!1)}getGridBuffers(l,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},s.dn=N_,s.dp=mr,s.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.dr=Ar,s.ds=ke,s.dt=z,s.du=function([l,t,o]){const c=Math.hypot(l,t,o),p=Math.atan2(l,o),h=.5*Math.PI-Math.acos(-t/c);return new q(Wt(p),Wt(h))},s.dv=Pb,s.dw=V,s.dx=function(l){const t=l.navigator?l.navigator.userAgent:null;return!!function(o){if(Vs==null){const c=o.navigator?o.navigator.userAgent:null;Vs=!!o.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Vs}(l)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dy=function(l,t){br=l,on=t},s.dz=Wv,s.e=Ce,s.e0=function(l){let t=0;if(new Uint32Array(l,0,1)[0]!==oA){const o=new Uint32Array(l,0,7),[,,c,p,h,m]=o;t=o.byteLength+p+h+m+h,(c!==l.byteLength||t>=l.byteLength)&&nn("Invalid b3dm header information.")}return cA(l,t)},s.e1=function(l,t){const o=hA(l);for(const c of o){for(const p of c.meshes)DB(p);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(LB(c.lights,t)))}return o},s.e2=hy,s.e3=NI,s.e4=gs,s.e5=function(l){pi(),Or!=null&&Or.then(t=>{t.keys().then(o=>{for(let c=0;c<o.length-l;c++)t.delete(o[c])})})},s.f=function(l){return l.indexOf("mapbox:")===0},s.g=function(l,t){return La(Xr(l,{method:"GET"}),t)},s.h=Ie,s.i=function(l){return Ce.API_STYLE_REGEX.test(l)&&!Ue(l)},s.j=function(l){return decodeURIComponent(atob(l).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(t,o)=>String.fromCharCode(+("0x"+o))))},s.l=Xr,s.m=gi,s.n=function(l,t){return La(Xr(l,{type:"json"}),t)},s.o=Zi,s.p=function(l,t){return La(Xr(l,{method:"POST"}),t)},s.q=Ht,s.r=es,s.s=function(l){try{const t=self[l];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=za,s.u=function(){return function l(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},s.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},s.w=nn,s.x=Rs,s.y=2,s.z=qE}),I(["./shared"],function(s){function $(nt){const ne=nt?nt.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function W(nt){if(typeof nt=="number"||typeof nt=="boolean"||typeof nt=="string"||nt==null)return JSON.stringify(nt);if(Array.isArray(nt)){let oe="[";for(const ve of nt)oe+=`${W(ve)},`;return`${oe}]`}let ne="{";for(const oe of Object.keys(nt).sort())ne+=`${oe}:${W(nt[oe])},`;return`${ne}}`}function Q(nt){let ne="";for(const oe of s.bg)ne+=`/${W(nt[oe])}`;return ne}class ae{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,oe){this._layerConfigs={},this._layers={},this.update(ne,[],oe)}update(ne,oe,ve){this._options=ve;for(const Ie of ne)this._layerConfigs[Ie.id]=Ie,(this._layers[Ie.id]=s.cq(Ie,this.scope,null,this._options)).compileFilter(ve),this.keyCache[Ie.id]&&delete this.keyCache[Ie.id];for(const Ie of oe)delete this.keyCache[Ie],delete this._layerConfigs[Ie],delete this._layers[Ie];this.familiesBySource={};const Ce=function(Ie,Ue){const ot={};for(let it=0;it<Ie.length;it++){const ut=Ue&&Ue[Ie[it].id]||Q(Ie[it]);Ue&&(Ue[Ie[it].id]=ut);let at=ot[ut];at||(at=ot[ut]=[]),at.push(Ie[it])}const We=[];for(const it in ot)We.push(ot[it]);return We}(s.bd(this._layerConfigs),this.keyCache);for(const Ie of Ce){const Ue=Ie.map(At=>this._layers[At.id]),ot=Ue[0];if(ot.visibility==="none")continue;const We=ot.source||"";let it=this.familiesBySource[We];it||(it=this.familiesBySource[We]={});const ut=ot.sourceLayer||"_geojsonTileLayer";let at=it[ut];at||(at=it[ut]=[]),at.push(Ue)}}}const we=1*s.dP;class He{constructor(ne){const oe={},ve=[];for(const ot in ne){const We=ne[ot],it=oe[ot]={};for(const ut in We.glyphs){const at=We.glyphs[+ut];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const At=at.metrics.localGlyph?we:1,Gt={x:0,y:0,w:at.bitmap.width+2*At,h:at.bitmap.height+2*At};ve.push(Gt),it[ut]=Gt}}const{w:Ce,h:Ie}=s.z(ve),Ue=new s.dO({width:Ce||1,height:Ie||1});for(const ot in ne){const We=ne[ot];for(const it in We.glyphs){const ut=We.glyphs[+it];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const at=oe[ot][it],At=ut.metrics.localGlyph?we:1;s.dO.copy(ut.bitmap,Ue,{x:0,y:0},{x:at.x+At,y:at.y+At},ut.bitmap)}}this.image=Ue,this.positions=oe}}s.dN(He,"GlyphAtlas");class $e{constructor(ne){this.tileID=new s.aA(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=s.aK(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep}parse(ne,oe,ve,Ce,Ie){this.status="parsing",this.data=ne,this.collisionBoxArray=new s.aQ;const Ue=new s.dQ(Object.keys(ne.layers).sort()),ot=new s.dR(this.tileID,this.promoteId);ot.bucketLayerIDs=[];const We={},it=new s.dS(256,256),ut={featureIndex:ot,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:it,availableImages:ve,brightness:this.brightness},at=oe.familiesBySource[this.source];for(const br in at){const on=ne.layers[br];if(!on)continue;let pn=!1,Or=!1,mn=!1;for(const mi of at[br])mi[0].type==="symbol"?pn=!0:Or=!0,mi[0].is3D()&&mi[0].type!=="model"&&(mn=!0);if(this.extraShadowCaster&&!mn||this.isSymbolTile===!0&&!pn||this.isSymbolTile===!1&&!Or)continue;on.version===1&&s.w(`Vector tile source "${this.source}" layer "${br}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bn=Ue.encode(br),pi=[];for(let mi=0;mi<on.length;mi++){const gi=on.feature(mi),ji=ot.getId(gi,br);pi.push({feature:gi,id:ji,index:mi,sourceLayerIndex:Bn})}for(const mi of at[br]){const gi=mi[0];(!this.extraShadowCaster||gi.is3D()&&gi.type!=="model")&&(this.isSymbolTile!==void 0&&gi.type==="symbol"!==this.isSymbolTile||gi.minzoom&&this.zoom<Math.floor(gi.minzoom)||gi.maxzoom&&this.zoom>=gi.maxzoom||gi.visibility!=="none"&&(Ne(mi,this.zoom,ut.brightness,ve),(We[gi.id]=gi.createBucket({index:ot.bucketLayerIDs.length,layers:mi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(pi,ut,this.tileID.canonical,this.tileTransform),ot.bucketLayerIDs.push(mi.map(ji=>ji.id))))}}let At,Gt,Ht,vr;it.trim();const Er={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Rr=()=>{if(At)return this.status="done",Ie(At);if(this.extraShadowCaster)this.status="done",Ie(null,{buckets:s.bd(We).filter(br=>!br.isEmpty()),featureIndex:ot,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ut.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Gt&&Ht&&vr){const br=new He(Gt),on=new s.dU(Ht,vr,this.lut);for(const pn in We){const Or=We[pn];Or instanceof s.aR?(Ne(Or.layers,this.zoom,ut.brightness,ve),s.dV(Or,Gt,br.positions,Ht,on.iconPositions,this.showCollisionBoxes,ve,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Or.hasPattern&&(Or instanceof s.aX||Or instanceof s.aY||Or instanceof s.d0)&&(Ne(Or.layers,this.zoom,ut.brightness,ve),Or.addFeatures(ut,this.tileID.canonical,on.patternPositions,ve,this.tileTransform,this.brightness))}this.status="done",Ie(null,{buckets:s.bd(We).filter(pn=>!pn.isEmpty()),featureIndex:ot,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:br.image,lineAtlas:it,imageAtlas:on,brightness:ut.brightness})}};if(!this.extraShadowCaster){const br=s.dT(ut.glyphDependencies,Or=>Object.keys(Or).map(Number));Object.keys(br).length?Ce.send("getGlyphs",{uid:this.uid,stacks:br,scope:this.scope},(Or,mn)=>{At||(At=Or,Gt=mn,Rr())},void 0,!1,Er):Gt={};const on=Object.keys(ut.iconDependencies);on.length?Ce.send("getImages",{icons:on,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Or,mn)=>{At||(At=Or,Ht=mn,Rr())},void 0,!1,Er):Ht={};const pn=Object.keys(ut.patternDependencies);pn.length?Ce.send("getImages",{icons:pn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Or,mn)=>{At||(At=Or,vr=mn,Rr())},void 0,!1,Er):vr={}}Rr()}}function Ne(nt,ne,oe,ve){const Ce=new s.a3(ne,{brightness:oe});for(const Ie of nt)Ie.recalculate(Ce,ve)}class wt extends s.E{constructor(ne,oe,ve,Ce,Ie,Ue){super(),this.actor=ne,this.layerIndex=oe,this.availableImages=ve,this.loadVectorData=Ie||s.aw,this.loading={},this.loaded={},this.deduped=new s.au(ne.scheduler),this.isSpriteLoaded=Ce,this.scheduler=ne.scheduler,this.brightness=Ue}loadTile(ne,oe){const ve=ne.uid,Ce=ne&&ne.request,Ie=Ce&&Ce.collectResourceTiming,Ue=this.loading[ve]=new $e(ne);Ue.abort=this.loadVectorData(ne,(ot,We)=>{const it=!this.loading[ve];if(delete this.loading[ve],it||ot||!We)return Ue.status="done",it||(this.loaded[ve]=Ue),oe(ot);const ut=We.rawData,at={};We.expires&&(at.expires=We.expires),We.cacheControl&&(at.cacheControl=We.cacheControl),Ue.vectorTile=We.vectorTile||new s.dW.VectorTile(new s.bb(ut));const At=()=>{Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor,(Gt,Ht)=>{if(Gt||!Ht)return oe(Gt);const vr={};if(Ie){const Er=$(Ce);Er.length>0&&(vr.resourceTiming=JSON.parse(JSON.stringify(Er)))}oe(null,s.l({rawTileData:ut.slice(0)},Ht,at,vr))})};this.isSpriteLoaded?At():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(At,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):At()}),this.loaded=this.loaded||{},this.loaded[ve]=Ue})}reloadTile(ne,oe){const ve=this.loaded,Ce=ne.uid;if(ve&&ve[Ce]){const Ie=ve[Ce];Ie.showCollisionBoxes=ne.showCollisionBoxes,Ie.projection=ne.projection,Ie.brightness=ne.brightness,Ie.tileTransform=s.aK(ne.tileID.canonical,ne.projection),Ie.extraShadowCaster=ne.extraShadowCaster,Ie.lut=ne.lut;const Ue=(ot,We)=>{const it=Ie.reloadCallback;it&&(delete Ie.reloadCallback,Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,it)),oe(ot,We)};Ie.status==="parsing"?Ie.reloadCallback=Ue:Ie.status==="done"&&(Ie.vectorTile?Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,Ue):Ue())}else oe(null,void 0)}abortTile(ne,oe){const ve=ne.uid,Ce=this.loading[ve];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[ve]),oe()}removeTile(ne,oe){const ve=this.loaded,Ce=ne.uid;ve&&ve[Ce]&&delete ve[Ce],oe()}}class mt{loadTile(ne,oe){const{uid:ve,encoding:Ce,rawImageData:Ie,padding:Ue}=ne,ot=ImageBitmap&&Ie instanceof ImageBitmap?this.getImageData(Ie,Ue):Ie;oe(null,new s.dX(ve,ot,Ce,Ue<1))}getImageData(ne,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const ve=this.offscreenCanvasContext.getImageData(-oe,-oe,ne.width+2*oe,ne.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ve}}s.ba.setPbf(s.bb);class vt{decodeRasterArray({task:ne,buffer:oe},ve){s.ba.performDecoding(oe,ne).then(Ce=>{ve(null,Ce)},Ce=>{ve(Ce)})}}const zt=s.dW.VectorTileFeature.prototype.toGeoJSON;class Ct{constructor(ne){this._feature=ne,this.extent=s.ab,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const oe of this._feature.geometry)ne.push([new s.P(oe[0],oe[1])]);return ne}{const ne=[];for(const oe of this._feature.geometry){const ve=[];for(const Ce of oe)ve.push(new s.P(Ce[0],Ce[1]));ne.push(ve)}return ne}}toGeoJSON(ne,oe,ve){return zt.call(this,ne,oe,ve)}}class qt{constructor(ne){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.ab,this.length=ne.length,this._features=ne}feature(ne){return new Ct(this._features[ne])}}const qe=64/4096,be=128;class Fe{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],oe){for(const ve of ne){const Ce=ve.id;if(Ce==null)continue;let Ie=this.features.get(Ce);Ie&&this.updateCache(Ie,oe),ve.geometry?(Ie=Me(ve),this.updateCache(Ie,oe),this.features.set(Ce,Ie)):this.features.delete(Ce),this.updateCache(Ie,oe)}}updateCache(ne,oe){for(const{canonical:ve,uid:Ce}of Object.values(oe)){const{z:Ie,x:Ue,y:ot}=ve;Je(ne,Math.pow(2,Ie),Ue,ot)&&delete oe[Ce]}}getTile(ne,oe,ve){const Ce=Math.pow(2,ne),Ie=[];for(const Ue of this.features.values())Je(Ue,Ce,oe,ve)&&Ie.push(jn(Ue,Ce,oe,ve));return{features:Ie}}getFeatures(){return[...this.features.values()]}}function Je({minX:nt,minY:ne,maxX:oe,maxY:ve},Ce,Ie,Ue){return nt<(Ie+1+qe)/Ce&&ne<(Ue+1+qe)/Ce&&oe>(Ie-qe)/Ce&&ve>(Ue-qe)/Ce}function Me(nt){const{id:ne,geometry:oe,properties:ve}=nt;if(!oe)return;if(oe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ce,coordinates:Ie}=oe,Ue={id:ne,type:1,geometry:[],tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ot=Ue.geometry;if(Ce==="Point")je(Ie,ot,Ue);else if(Ce==="MultiPoint")for(const We of Ie)je(We,ot,Ue);else if(Ce==="LineString")Ue.type=2,Ve(Ie,ot,Ue);else if(Ce==="MultiLineString")Ue.type=2,An(Ie,ot,Ue);else if(Ce==="Polygon")Ue.type=3,An(Ie,ot,Ue,!0);else{if(Ce!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ue.type=3;for(const We of Ie)An(We,ot,Ue,!0)}return Ue}function je([nt,ne],oe,ve){const Ce=s.am(nt);let Ie=s.at(ne);Ie=Ie<0?0:Ie>1?1:Ie,oe.push(Ce,Ie),ve.minX=Math.min(ve.minX,Ce),ve.minY=Math.min(ve.minY,Ie),ve.maxX=Math.max(ve.maxX,Ce),ve.maxY=Math.max(ve.maxY,Ie)}function Ve(nt,ne,oe,ve=!1,Ce=!1){const Ie=[];for(const Ue of nt)je(Ue,Ie,oe);ne.push(Ie),ve&&function(Ue,ot){let We=0;for(let it=0,ut=Ue.length,at=ut-2;it<ut;at=it,it+=2)We+=(Ue[it]-Ue[at])*(Ue[it+1]+Ue[at+1]);if(We>0===ot)for(let it=0,ut=Ue.length;it<ut/2;it+=2){const at=Ue[it],At=Ue[it+1];Ue[it]=Ue[ut-2-it],Ue[it+1]=Ue[ut-1-it],Ue[ut-2-it]=at,Ue[ut-1-it]=At}}(Ie,Ce)}function An(nt,ne,oe,ve=!1){for(let Ce=0;Ce<nt.length;Ce++)Ve(nt[Ce],ne,oe,ve,Ce===0)}function jn(nt,ne,oe,ve){const{id:Ce,type:Ie,geometry:Ue,tags:ot}=nt,We=[];if(Ie===1)(function(it,ut,at,At,Gt){for(let Ht=0;Ht<it.length;Ht+=2){const vr=Math.round(s.ab*(it[Ht+0]*ut-at)),Er=Math.round(s.ab*(it[Ht+1]*ut-At));Gt.push([vr,Er])}})(Ue,ne,oe,ve,We);else for(const it of Ue)or(it,ne,oe,ve,We);return{id:Ce,type:Ie,geometry:We,tags:ot}}function or(nt,ne,oe,ve,Ce){const Ie=-be,Ue=s.ab+be;let ot;for(let We=0;We<nt.length-2;We+=2){let it=Math.round(s.ab*(nt[We+0]*ne-oe)),ut=Math.round(s.ab*(nt[We+1]*ne-ve)),at=Math.round(s.ab*(nt[We+2]*ne-oe)),At=Math.round(s.ab*(nt[We+3]*ne-ve));const Gt=at-it,Ht=At-ut;it<Ie&&at<Ie||(it<Ie?(ut+=Math.round(Ht*((Ie-it)/Gt)),it=Ie):at<Ie&&(At=ut+Math.round(Ht*((Ie-it)/Gt)),at=Ie),ut<Ie&&At<Ie||(ut<Ie?(it+=Math.round(Gt*((Ie-ut)/Ht)),ut=Ie):At<Ie&&(at=it+Math.round(Gt*((Ie-ut)/Ht)),At=Ie),it>=Ue&&at>=Ue||(it>=Ue?(ut+=Math.round(Ht*((Ue-it)/Gt)),it=Ue):at>=Ue&&(At=ut+Math.round(Ht*((Ue-it)/Gt)),at=Ue),ut>=Ue&&At>=Ue||(ut>=Ue?(it+=Math.round(Gt*((Ue-ut)/Ht)),ut=Ue):At>=Ue&&(at=it+Math.round(Gt*((Ue-ut)/Ht)),At=Ue),ot&&it===ot[ot.length-1][0]&&ut===ot[ot.length-1][1]||(ot=[[it,ut]],Ce.push(ot)),ot.push([at,At])))))}}var Cr,Vr,On,dr={exports:{}},Zn=function(){if(On)return dr.exports;On=1;var nt=s.d_(),ne=function(){if(Vr)return Cr;Vr=1;var ut=s.dY(),at=s.dZ().VectorTileFeature;function At(Ht,vr){this.options=vr||{},this.features=Ht,this.length=Ht.length}function Gt(Ht,vr){this.id=typeof Ht.id=="number"?Ht.id:void 0,this.type=Ht.type,this.rawGeometry=Ht.type===1?[Ht.geometry]:Ht.geometry,this.properties=Ht.tags,this.extent=vr||4096}return Cr=At,At.prototype.feature=function(Ht){return new Gt(this.features[Ht],this.options.extent)},Gt.prototype.loadGeometry=function(){var Ht=this.rawGeometry;this.geometry=[];for(var vr=0;vr<Ht.length;vr++){for(var Er=Ht[vr],Rr=[],br=0;br<Er.length;br++)Rr.push(new ut(Er[br][0],Er[br][1]));this.geometry.push(Rr)}return this.geometry},Gt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ht=this.geometry,vr=1/0,Er=-1/0,Rr=1/0,br=-1/0,on=0;on<Ht.length;on++)for(var pn=Ht[on],Or=0;Or<pn.length;Or++){var mn=pn[Or];vr=Math.min(vr,mn.x),Er=Math.max(Er,mn.x),Rr=Math.min(Rr,mn.y),br=Math.max(br,mn.y)}return[vr,Rr,Er,br]},Gt.prototype.toGeoJSON=at.prototype.toGeoJSON,Cr}();function oe(ut){var at=new nt;return function(At,Gt){for(var Ht in At.layers)Gt.writeMessage(3,ve,At.layers[Ht])}(ut,at),at.finish()}function ve(ut,at){var At;at.writeVarintField(15,ut.version||1),at.writeStringField(1,ut.name||""),at.writeVarintField(5,ut.extent||4096);var Gt={keys:[],values:[],keycache:{},valuecache:{}};for(At=0;At<ut.length;At++)Gt.feature=ut.feature(At),at.writeMessage(2,Ce,Gt);var Ht=Gt.keys;for(At=0;At<Ht.length;At++)at.writeStringField(3,Ht[At]);var vr=Gt.values;for(At=0;At<vr.length;At++)at.writeMessage(4,it,vr[At])}function Ce(ut,at){var At=ut.feature;At.id!==void 0&&at.writeVarintField(1,At.id),at.writeMessage(2,Ie,ut),at.writeVarintField(3,At.type),at.writeMessage(4,We,At)}function Ie(ut,at){var At=ut.feature,Gt=ut.keys,Ht=ut.values,vr=ut.keycache,Er=ut.valuecache;for(var Rr in At.properties){var br=At.properties[Rr],on=vr[Rr];if(br!==null){on===void 0&&(Gt.push(Rr),vr[Rr]=on=Gt.length-1),at.writeVarint(on);var pn=typeof br;pn!=="string"&&pn!=="boolean"&&pn!=="number"&&(br=JSON.stringify(br));var Or=pn+":"+br,mn=Er[Or];mn===void 0&&(Ht.push(br),Er[Or]=mn=Ht.length-1),at.writeVarint(mn)}}}function Ue(ut,at){return(at<<3)+(7&ut)}function ot(ut){return ut<<1^ut>>31}function We(ut,at){for(var At=ut.loadGeometry(),Gt=ut.type,Ht=0,vr=0,Er=At.length,Rr=0;Rr<Er;Rr++){var br=At[Rr],on=1;Gt===1&&(on=br.length),at.writeVarint(Ue(1,on));for(var pn=Gt===3?br.length-1:br.length,Or=0;Or<pn;Or++){Or===1&&Gt!==1&&at.writeVarint(Ue(2,pn-1));var mn=br[Or].x-Ht,Bn=br[Or].y-vr;at.writeVarint(ot(mn)),at.writeVarint(ot(Bn)),Ht+=mn,vr+=Bn}Gt===3&&at.writeVarint(Ue(7,1))}}function it(ut,at){var At=typeof ut;At==="string"?at.writeStringField(1,ut):At==="boolean"?at.writeBooleanField(7,ut):At==="number"&&(ut%1!=0?at.writeDoubleField(3,ut):ut<0?at.writeSVarintField(6,ut):at.writeVarintField(5,ut))}return dr.exports=oe,dr.exports.fromVectorTileJs=oe,dr.exports.fromGeojsonVt=function(ut,at){at=at||{};var At={};for(var Gt in ut)At[Gt]=new ne(ut[Gt].features,at),At[Gt].name=Gt,At[Gt].version=at.version,At[Gt].extent=at.extent;return oe({layers:At})},dr.exports.GeoJSONWrapper=ne,dr.exports}(),yn=s.d$(Zn);const kt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:nt=>nt},fr=Math.fround||(li=new Float32Array(1),nt=>(li[0]=+nt,li[0]));var li;const Dn=3,It=5,lr=6;class sr{constructor(ne){this.options=Object.assign(Object.create(kt),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:oe,minZoom:ve,maxZoom:Ce}=this.options;oe&&console.time("total time");const Ie=`prepare ${ne.length} points`;oe&&console.time(Ie),this.points=ne;const Ue=[];for(let We=0;We<ne.length;We++){const it=ne[We];if(!it.geometry)continue;const[ut,at]=it.geometry.coordinates,At=fr(un(ut)),Gt=fr(Le(at));Ue.push(At,Gt,1/0,We,-1,1),this.options.reduce&&Ue.push(0)}let ot=this.trees[Ce+1]=this._createTree(Ue);oe&&console.timeEnd(Ie);for(let We=Ce;We>=ve;We--){const it=+Date.now();ot=this.trees[We]=this._createTree(this._cluster(ot,We)),oe&&console.log("z%d: %d clusters in %dms",We,ot.numItems,+Date.now()-it)}return oe&&console.timeEnd("total time"),this}getClusters(ne,oe){let ve=((ne[0]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,ne[1]));let Ie=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Ue=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ve=-180,Ie=180;else if(ve>Ie){const at=this.getClusters([ve,Ce,180,Ue],oe),At=this.getClusters([-180,Ce,Ie,Ue],oe);return at.concat(At)}const ot=this.trees[this._limitZoom(oe)],We=ot.range(un(ve),Le(Ue),un(Ie),Le(Ce)),it=ot.data,ut=[];for(const at of We){const At=this.stride*at;ut.push(it[At+It]>1?wr(it,At,this.clusterProps):this.points[it[At+Dn]])}return ut}getChildren(ne){const oe=this._getOriginId(ne),ve=this._getOriginZoom(ne),Ce="No cluster with the specified id.",Ie=this.trees[ve];if(!Ie)throw new Error(Ce);const Ue=Ie.data;if(oe*this.stride>=Ue.length)throw new Error(Ce);const ot=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),We=Ie.within(Ue[oe*this.stride],Ue[oe*this.stride+1],ot),it=[];for(const ut of We){const at=ut*this.stride;Ue[at+4]===ne&&it.push(Ue[at+It]>1?wr(Ue,at,this.clusterProps):this.points[Ue[at+Dn]])}if(it.length===0)throw new Error(Ce);return it}getLeaves(ne,oe,ve){const Ce=[];return this._appendLeaves(Ce,ne,oe=oe||10,ve=ve||0,0),Ce}getTile(ne,oe,ve){const Ce=this.trees[this._limitZoom(ne)],Ie=Math.pow(2,ne),{extent:Ue,radius:ot}=this.options,We=ot/Ue,it=(ve-We)/Ie,ut=(ve+1+We)/Ie,at={features:[]};return this._addTileFeatures(Ce.range((oe-We)/Ie,it,(oe+1+We)/Ie,ut),Ce.data,oe,ve,Ie,at),oe===0&&this._addTileFeatures(Ce.range(1-We/Ie,it,1,ut),Ce.data,Ie,ve,Ie,at),oe===Ie-1&&this._addTileFeatures(Ce.range(0,it,We/Ie,ut),Ce.data,-1,ve,Ie,at),at.features.length?at:null}getClusterExpansionZoom(ne){let oe=this._getOriginZoom(ne)-1;for(;oe<=this.options.maxZoom;){const ve=this.getChildren(ne);if(oe++,ve.length!==1)break;ne=ve[0].properties.cluster_id}return oe}_appendLeaves(ne,oe,ve,Ce,Ie){const Ue=this.getChildren(oe);for(const ot of Ue){const We=ot.properties;if(We&&We.cluster?Ie+We.point_count<=Ce?Ie+=We.point_count:Ie=this._appendLeaves(ne,We.cluster_id,ve,Ce,Ie):Ie<Ce?Ie++:ne.push(ot),ne.length===ve)break}return Ie}_createTree(ne){const oe=new s.by(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ve=0;ve<ne.length;ve+=this.stride)oe.add(ne[ve],ne[ve+1]);return oe.finish(),oe.data=ne,oe}_addTileFeatures(ne,oe,ve,Ce,Ie,Ue){for(const ot of ne){const We=ot*this.stride,it=oe[We+It]>1;let ut,at,At;if(it)ut=_e(oe,We,this.clusterProps),at=oe[We],At=oe[We+1];else{const vr=this.points[oe[We+Dn]];ut=vr.properties;const[Er,Rr]=vr.geometry.coordinates;at=un(Er),At=Le(Rr)}const Gt={type:1,geometry:[[Math.round(this.options.extent*(at*Ie-ve)),Math.round(this.options.extent*(At*Ie-Ce))]],tags:ut};let Ht;Ht=it||this.options.generateId?oe[We+Dn]:this.points[oe[We+Dn]].id,Ht!==void 0&&(Gt.id=Ht),Ue.features.push(Gt)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,oe){const{radius:ve,extent:Ce,reduce:Ie,minPoints:Ue}=this.options,ot=ve/(Ce*Math.pow(2,oe)),We=ne.data,it=[],ut=this.stride;for(let at=0;at<We.length;at+=ut){if(We[at+2]<=oe)continue;We[at+2]=oe;const At=We[at],Gt=We[at+1],Ht=ne.within(We[at],We[at+1],ot),vr=We[at+It];let Er=vr;for(const Rr of Ht){const br=Rr*ut;We[br+2]>oe&&(Er+=We[br+It])}if(Er>vr&&Er>=Ue){let Rr,br=At*vr,on=Gt*vr,pn=-1;const Or=(at/ut<<5)+(oe+1)+this.points.length;for(const mn of Ht){const Bn=mn*ut;if(We[Bn+2]<=oe)continue;We[Bn+2]=oe;const pi=We[Bn+It];br+=We[Bn]*pi,on+=We[Bn+1]*pi,We[Bn+4]=Or,Ie&&(Rr||(Rr=this._map(We,at,!0),pn=this.clusterProps.length,this.clusterProps.push(Rr)),Ie(Rr,this._map(We,Bn)))}We[at+4]=Or,it.push(br/Er,on/Er,1/0,Or,-1,Er),Ie&&it.push(pn)}else{for(let Rr=0;Rr<ut;Rr++)it.push(We[at+Rr]);if(Er>1)for(const Rr of Ht){const br=Rr*ut;if(!(We[br+2]<=oe)){We[br+2]=oe;for(let on=0;on<ut;on++)it.push(We[br+on])}}}}return it}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,oe,ve){if(ne[oe+It]>1){const Ue=this.clusterProps[ne[oe+lr]];return ve?Object.assign({},Ue):Ue}const Ce=this.points[ne[oe+Dn]].properties,Ie=this.options.map(Ce);return ve&&Ie===Ce?Object.assign({},Ie):Ie}}function wr(nt,ne,oe){return{type:"Feature",id:nt[ne+Dn],properties:_e(nt,ne,oe),geometry:{type:"Point",coordinates:[(ve=nt[ne],360*(ve-.5)),Ye(nt[ne+1])]}};var ve}function _e(nt,ne,oe){const ve=nt[ne+It],Ce=ve>=1e4?`${Math.round(ve/1e3)}k`:ve>=1e3?Math.round(ve/100)/10+"k":ve,Ie=nt[ne+lr],Ue=Ie===-1?{}:Object.assign({},oe[Ie]);return Object.assign(Ue,{cluster:!0,cluster_id:nt[ne+Dn],point_count:ve,point_count_abbreviated:Ce})}function un(nt){return nt/360+.5}function Le(nt){const ne=Math.sin(nt*Math.PI/180),oe=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return oe<0?0:oe>1?1:oe}function Ye(nt){const ne=(180-360*nt)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function De(nt,ne,oe,ve){let Ce=ve;const Ie=ne+(oe-ne>>1);let Ue,ot=oe-ne;const We=nt[ne],it=nt[ne+1],ut=nt[oe],at=nt[oe+1];for(let At=ne+3;At<oe;At+=3){const Gt=jt(nt[At],nt[At+1],We,it,ut,at);if(Gt>Ce)Ue=At,Ce=Gt;else if(Gt===Ce){const Ht=Math.abs(At-Ie);Ht<ot&&(Ue=At,ot=Ht)}}Ce>ve&&(Ue-ne>3&&De(nt,ne,Ue,ve),nt[Ue+2]=Ce,oe-Ue>3&&De(nt,Ue,oe,ve))}function jt(nt,ne,oe,ve,Ce,Ie){let Ue=Ce-oe,ot=Ie-ve;if(Ue!==0||ot!==0){const We=((nt-oe)*Ue+(ne-ve)*ot)/(Ue*Ue+ot*ot);We>1?(oe=Ce,ve=Ie):We>0&&(oe+=Ue*We,ve+=ot*We)}return Ue=nt-oe,ot=ne-ve,Ue*Ue+ot*ot}function St(nt,ne,oe,ve){const Ce={id:nt??null,type:ne,geometry:oe,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")Zt(Ce,oe);else if(ne==="Polygon")Zt(Ce,oe[0]);else if(ne==="MultiLineString")for(const Ie of oe)Zt(Ce,Ie);else if(ne==="MultiPolygon")for(const Ie of oe)Zt(Ce,Ie[0]);return Ce}function Zt(nt,ne){for(let oe=0;oe<ne.length;oe+=3)nt.minX=Math.min(nt.minX,ne[oe]),nt.minY=Math.min(nt.minY,ne[oe+1]),nt.maxX=Math.max(nt.maxX,ne[oe]),nt.maxY=Math.max(nt.maxY,ne[oe+1])}function Dt(nt,ne,oe,ve){if(!ne.geometry)return;const Ce=ne.geometry.coordinates;if(Ce&&Ce.length===0)return;const Ie=ne.geometry.type,Ue=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2);let ot=[],We=ne.id;if(oe.promoteId?We=ne.properties[oe.promoteId]:oe.generateId&&(We=ve||0),Ie==="Point")Wt(Ce,ot);else if(Ie==="MultiPoint")for(const it of Ce)Wt(it,ot);else if(Ie==="LineString")nr(Ce,ot,Ue,!1);else if(Ie==="MultiLineString"){if(oe.lineMetrics){for(const it of Ce)ot=[],nr(it,ot,Ue,!1),nt.push(St(We,"LineString",ot,ne.properties));return}Kt(Ce,ot,Ue,!1)}else if(Ie==="Polygon")Kt(Ce,ot,Ue,!0);else{if(Ie!=="MultiPolygon"){if(Ie==="GeometryCollection"){for(const it of ne.geometry.geometries)Dt(nt,{id:We,geometry:it,properties:ne.properties},oe,ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const it of Ce){const ut=[];Kt(it,ut,Ue,!0),ot.push(ut)}}nt.push(St(We,Ie,ot,ne.properties))}function Wt(nt,ne){ne.push(mr(nt[0]),Ar(nt[1]),0)}function nr(nt,ne,oe,ve){let Ce,Ie,Ue=0;for(let We=0;We<nt.length;We++){const it=mr(nt[We][0]),ut=Ar(nt[We][1]);ne.push(it,ut,0),We>0&&(Ue+=ve?(Ce*ut-it*Ie)/2:Math.sqrt(Math.pow(it-Ce,2)+Math.pow(ut-Ie,2))),Ce=it,Ie=ut}const ot=ne.length-3;ne[2]=1,De(ne,0,ot,oe),ne[ot+2]=1,ne.size=Math.abs(Ue),ne.start=0,ne.end=ne.size}function Kt(nt,ne,oe,ve){for(let Ce=0;Ce<nt.length;Ce++){const Ie=[];nr(nt[Ce],Ie,oe,ve),ne.push(Ie)}}function mr(nt){return nt/360+.5}function Ar(nt){const ne=Math.sin(nt*Math.PI/180),oe=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return oe<0?0:oe>1?1:oe}function Ft(nt,ne,oe,ve,Ce,Ie,Ue,ot){if(ve/=ne,Ie>=(oe/=ne)&&Ue<ve)return nt;if(Ue<oe||Ie>=ve)return null;const We=[];for(const it of nt){const ut=it.geometry;let at=it.type;const At=Ce===0?it.minX:it.minY,Gt=Ce===0?it.maxX:it.maxY;if(At>=oe&&Gt<ve){We.push(it);continue}if(Gt<oe||At>=ve)continue;let Ht=[];if(at==="Point"||at==="MultiPoint")Ir(ut,Ht,oe,ve,Ce);else if(at==="LineString")Sr(ut,Ht,oe,ve,Ce,!1,ot.lineMetrics);else if(at==="MultiLineString")Xr(ut,Ht,oe,ve,Ce,!1);else if(at==="Polygon")Xr(ut,Ht,oe,ve,Ce,!0);else if(at==="MultiPolygon")for(const vr of ut){const Er=[];Xr(vr,Er,oe,ve,Ce,!0),Er.length&&Ht.push(Er)}if(Ht.length){if(ot.lineMetrics&&at==="LineString"){for(const vr of Ht)We.push(St(it.id,at,vr,it.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(Ht.length===1?(at="LineString",Ht=Ht[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=Ht.length===3?"Point":"MultiPoint"),We.push(St(it.id,at,Ht,it.tags))}}return We.length?We:null}function Ir(nt,ne,oe,ve,Ce){for(let Ie=0;Ie<nt.length;Ie+=3){const Ue=nt[Ie+Ce];Ue>=oe&&Ue<=ve&&vn(ne,nt[Ie],nt[Ie+1],nt[Ie+2])}}function Sr(nt,ne,oe,ve,Ce,Ie,Ue){let ot=tn(nt);const We=Ce===0?xi:Ii;let it,ut,at=nt.start;for(let Er=0;Er<nt.length-3;Er+=3){const Rr=nt[Er],br=nt[Er+1],on=nt[Er+2],pn=nt[Er+3],Or=nt[Er+4],mn=Ce===0?Rr:br,Bn=Ce===0?pn:Or;let pi=!1;Ue&&(it=Math.sqrt(Math.pow(Rr-pn,2)+Math.pow(br-Or,2))),mn<oe?Bn>oe&&(ut=We(ot,Rr,br,pn,Or,oe),Ue&&(ot.start=at+it*ut)):mn>ve?Bn<ve&&(ut=We(ot,Rr,br,pn,Or,ve),Ue&&(ot.start=at+it*ut)):vn(ot,Rr,br,on),Bn<oe&&mn>=oe&&(ut=We(ot,Rr,br,pn,Or,oe),pi=!0),Bn>ve&&mn<=ve&&(ut=We(ot,Rr,br,pn,Or,ve),pi=!0),!Ie&&pi&&(Ue&&(ot.end=at+it*ut),ne.push(ot),ot=tn(nt)),Ue&&(at+=it)}let At=nt.length-3;const Gt=nt[At],Ht=nt[At+1],vr=Ce===0?Gt:Ht;vr>=oe&&vr<=ve&&vn(ot,Gt,Ht,nt[At+2]),At=ot.length-3,Ie&&At>=3&&(ot[At]!==ot[0]||ot[At+1]!==ot[1])&&vn(ot,ot[0],ot[1],ot[2]),ot.length&&ne.push(ot)}function tn(nt){const ne=[];return ne.size=nt.size,ne.start=nt.start,ne.end=nt.end,ne}function Xr(nt,ne,oe,ve,Ce,Ie){for(const Ue of nt)Sr(Ue,ne,oe,ve,Ce,Ie,!1)}function vn(nt,ne,oe,ve){nt.push(ne,oe,ve)}function xi(nt,ne,oe,ve,Ce,Ie){const Ue=(Ie-ne)/(ve-ne);return vn(nt,Ie,oe+(Ce-oe)*Ue,1),Ue}function Ii(nt,ne,oe,ve,Ce,Ie){const Ue=(Ie-oe)/(Ce-oe);return vn(nt,ne+(ve-ne)*Ue,Ie,1),Ue}function yo(nt,ne){const oe=[];for(let ve=0;ve<nt.length;ve++){const Ce=nt[ve],Ie=Ce.type;let Ue;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")Ue=eo(Ce.geometry,ne);else if(Ie==="MultiLineString"||Ie==="Polygon"){Ue=[];for(const ot of Ce.geometry)Ue.push(eo(ot,ne))}else if(Ie==="MultiPolygon"){Ue=[];for(const ot of Ce.geometry){const We=[];for(const it of ot)We.push(eo(it,ne));Ue.push(We)}}oe.push(St(Ce.id,Ie,Ue,Ce.tags))}return oe}function eo(nt,ne){const oe=[];oe.size=nt.size,nt.start!==void 0&&(oe.start=nt.start,oe.end=nt.end);for(let ve=0;ve<nt.length;ve+=3)oe.push(nt[ve]+ne,nt[ve+1],nt[ve+2]);return oe}function co(nt,ne){if(nt.transformed)return nt;const oe=1<<nt.z,ve=nt.x,Ce=nt.y;for(const Ie of nt.features){const Ue=Ie.geometry,ot=Ie.type;if(Ie.geometry=[],ot===1)for(let We=0;We<Ue.length;We+=2)Ie.geometry.push(Mi(Ue[We],Ue[We+1],ne,oe,ve,Ce));else for(let We=0;We<Ue.length;We++){const it=[];for(let ut=0;ut<Ue[We].length;ut+=2)it.push(Mi(Ue[We][ut],Ue[We][ut+1],ne,oe,ve,Ce));Ie.geometry.push(it)}}return nt.transformed=!0,nt}function Mi(nt,ne,oe,ve,Ce,Ie){return[Math.round(oe*(nt*ve-Ce)),Math.round(oe*(ne*ve-Ie))]}function fi(nt,ne,oe,ve,Ce){const Ie=ne===Ce.maxZoom?0:Ce.tolerance/((1<<ne)*Ce.extent),Ue={features:[],numPoints:0,numSimplified:0,numFeatures:nt.length,source:null,x:oe,y:ve,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ot of nt)ls(Ue,ot,Ie,Ce);return Ue}function ls(nt,ne,oe,ve){const Ce=ne.geometry,Ie=ne.type,Ue=[];if(nt.minX=Math.min(nt.minX,ne.minX),nt.minY=Math.min(nt.minY,ne.minY),nt.maxX=Math.max(nt.maxX,ne.maxX),nt.maxY=Math.max(nt.maxY,ne.maxY),Ie==="Point"||Ie==="MultiPoint")for(let ot=0;ot<Ce.length;ot+=3)Ue.push(Ce[ot],Ce[ot+1]),nt.numPoints++,nt.numSimplified++;else if(Ie==="LineString")nn(Ue,Ce,nt,oe,!1,!1);else if(Ie==="MultiLineString"||Ie==="Polygon")for(let ot=0;ot<Ce.length;ot++)nn(Ue,Ce[ot],nt,oe,Ie==="Polygon",ot===0);else if(Ie==="MultiPolygon")for(let ot=0;ot<Ce.length;ot++){const We=Ce[ot];for(let it=0;it<We.length;it++)nn(Ue,We[it],nt,oe,!0,it===0)}if(Ue.length){let ot=ne.tags||null;if(Ie==="LineString"&&ve.lineMetrics){ot={};for(const it in ne.tags)ot[it]=ne.tags[it];ot.mapbox_clip_start=Ce.start/Ce.size,ot.mapbox_clip_end=Ce.end/Ce.size}const We={geometry:Ue,type:Ie==="Polygon"||Ie==="MultiPolygon"?3:Ie==="LineString"||Ie==="MultiLineString"?2:1,tags:ot};ne.id!==null&&(We.id=ne.id),nt.features.push(We)}}function nn(nt,ne,oe,ve,Ce,Ie){const Ue=ve*ve;if(ve>0&&ne.size<(Ce?Ue:ve))return void(oe.numPoints+=ne.length/3);const ot=[];for(let We=0;We<ne.length;We+=3)(ve===0||ne[We+2]>Ue)&&(oe.numSimplified++,ot.push(ne[We],ne[We+1])),oe.numPoints++;Ce&&function(We,it){let ut=0;for(let at=0,At=We.length,Gt=At-2;at<At;Gt=at,at+=2)ut+=(We[at]-We[Gt])*(We[at+1]+We[Gt+1]);if(ut>0===it)for(let at=0,At=We.length;at<At/2;at+=2){const Gt=We[at],Ht=We[at+1];We[at]=We[At-2-at],We[at+1]=We[At-1-at],We[At-2-at]=Gt,We[At-1-at]=Ht}}(ot,Ie),nt.push(ot)}const Vo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Fs{constructor(ne,oe){const ve=(oe=this.options=function(Ie,Ue){for(const ot in Ue)Ie[ot]=Ue[ot];return Ie}(Object.create(Vo),oe)).debug;if(ve&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ce=function(Ie,Ue){const ot=[];if(Ie.type==="FeatureCollection")for(let We=0;We<Ie.features.length;We++)Dt(ot,Ie.features[We],Ue,We);else Dt(ot,Ie.type==="Feature"?Ie:{geometry:Ie},Ue);return ot}(ne,oe);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=function(Ie,Ue){const ot=Ue.buffer/Ue.extent;let We=Ie;const it=Ft(Ie,1,-1-ot,ot,0,-1,2,Ue),ut=Ft(Ie,1,1-ot,2+ot,0,-1,2,Ue);return(it||ut)&&(We=Ft(Ie,1,-ot,1+ot,0,-1,2,Ue)||[],it&&(We=yo(it,1).concat(We)),ut&&(We=We.concat(yo(ut,-1)))),We}(Ce,oe),Ce.length&&this.splitTile(Ce,0,0,0),ve&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,oe,ve,Ce,Ie,Ue,ot){const We=[ne,oe,ve,Ce],it=this.options,ut=it.debug;for(;We.length;){Ce=We.pop(),ve=We.pop(),oe=We.pop(),ne=We.pop();const at=1<<oe,At=to(oe,ve,Ce);let Gt=this.tiles[At];if(!Gt&&(ut>1&&console.time("creation"),Gt=this.tiles[At]=fi(ne,oe,ve,Ce,it),this.tileCoords.push({z:oe,x:ve,y:Ce}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,ve,Ce,Gt.numFeatures,Gt.numPoints,Gt.numSimplified),console.timeEnd("creation"));const pi=`z${oe}`;this.stats[pi]=(this.stats[pi]||0)+1,this.total++}if(Gt.source=ne,Ie==null){if(oe===it.indexMaxZoom||Gt.numPoints<=it.indexMaxPoints)continue}else{if(oe===it.maxZoom||oe===Ie)continue;if(Ie!=null){const pi=Ie-oe;if(ve!==Ue>>pi||Ce!==ot>>pi)continue}}if(Gt.source=null,ne.length===0)continue;ut>1&&console.time("clipping");const Ht=.5*it.buffer/it.extent,vr=.5-Ht,Er=.5+Ht,Rr=1+Ht;let br=null,on=null,pn=null,Or=null,mn=Ft(ne,at,ve-Ht,ve+Er,0,Gt.minX,Gt.maxX,it),Bn=Ft(ne,at,ve+vr,ve+Rr,0,Gt.minX,Gt.maxX,it);ne=null,mn&&(br=Ft(mn,at,Ce-Ht,Ce+Er,1,Gt.minY,Gt.maxY,it),on=Ft(mn,at,Ce+vr,Ce+Rr,1,Gt.minY,Gt.maxY,it),mn=null),Bn&&(pn=Ft(Bn,at,Ce-Ht,Ce+Er,1,Gt.minY,Gt.maxY,it),Or=Ft(Bn,at,Ce+vr,Ce+Rr,1,Gt.minY,Gt.maxY,it),Bn=null),ut>1&&console.timeEnd("clipping"),We.push(br||[],oe+1,2*ve,2*Ce),We.push(on||[],oe+1,2*ve,2*Ce+1),We.push(pn||[],oe+1,2*ve+1,2*Ce),We.push(Or||[],oe+1,2*ve+1,2*Ce+1)}}getTile(ne,oe,ve){ne=+ne,oe=+oe,ve=+ve;const Ce=this.options,{extent:Ie,debug:Ue}=Ce;if(ne<0||ne>24)return null;const ot=1<<ne,We=to(ne,oe=oe+ot&ot-1,ve);if(this.tiles[We])return co(this.tiles[We],Ie);Ue>1&&console.log("drilling down to z%d-%d-%d",ne,oe,ve);let it,ut=ne,at=oe,At=ve;for(;!it&&ut>0;)ut--,at>>=1,At>>=1,it=this.tiles[to(ut,at,At)];return it&&it.source?(Ue>1&&(console.log("found parent tile z%d-%d-%d",ut,at,At),console.time("drilling down")),this.splitTile(it.source,ut,at,At,ne,oe,ve),Ue>1&&console.timeEnd("drilling down"),this.tiles[We]?co(this.tiles[We],Ie):null):null}}function to(nt,ne,oe){return 32*((1<<nt)*oe+ne)+nt}function Co(nt,ne){const oe=nt.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const ve=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!ve)return void ne(null,null);const Ce=new qt(ve.features);let Ie=yn(Ce);Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),ne(null,{vectorTile:Ce,rawData:Ie.buffer})}class Ro extends wt{constructor(ne,oe,ve,Ce,Ie,Ue){super(ne,oe,ve,Ce,Co,Ue),Ie&&(this.loadGeoJSON=Ie),this._dynamicIndex=new Fe}loadData(ne,oe){const ve=ne&&ne.request,Ce=ve&&ve.collectResourceTiming;this.loadGeoJSON(ne,(Ie,Ue)=>{if(Ie||!Ue)return oe(Ie);if(typeof Ue!="object")return oe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const We=s.M(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(We.result==="error")throw new Error(We.value.map(it=>`${it.key}: ${it.message}`).join(", "));Ue.features=Ue.features.filter(it=>We.value.evaluate({zoom:0},it))}ne.dynamic?(Ue.type==="Feature"&&(Ue={type:"FeatureCollection",features:[Ue]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ue.features,this.loaded),ne.cluster&&(Ue.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new sr(function({superclusterOptions:We,clusterProperties:it}){if(!it||!We)return We;const ut={},at={},At={accumulated:null,zoom:0},Gt={properties:null},Ht=Object.keys(it);for(const vr of Ht){const[Er,Rr]=it[vr],br=s.M(Rr),on=s.M(typeof Er=="string"?[Er,["accumulated"],["get",vr]]:Er);ut[vr]=br.value,at[vr]=on.value}return We.map=vr=>{Gt.properties=vr;const Er={};for(const Rr of Ht)Er[Rr]=ut[Rr].evaluate(At,Gt);return Er},We.reduce=(vr,Er)=>{Gt.properties=Er;for(const Rr of Ht)At.accumulated=vr[Rr],vr[Rr]=at[Rr].evaluate(At,Gt)},We}(ne)).load(Ue.features):ne.dynamic?this._dynamicIndex:function(We,it){return new Fs(We,it)}(Ue,ne.geojsonVtOptions)}catch(We){return oe(We)}const ot={};if(Ce){const We=$(ve);We&&(ot.resourceTiming={},ot.resourceTiming[ne.source]=JSON.parse(JSON.stringify(We)))}oe(null,ot)}})}reloadTile(ne,oe){const ve=this.loaded;return ve&&ve[ne.uid]?ne.partial?oe(null,void 0):super.reloadTile(ne,oe):this.loadTile(ne,oe)}loadGeoJSON(ne,oe){if(ne.request)s.n(ne.request,oe);else{if(typeof ne.data!="string")return oe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));try{return oe(null,JSON.parse(ne.data))}catch{return oe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ne,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(ve){oe(ve)}}getClusterChildren(ne,oe){try{oe(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(ve){oe(ve)}}getClusterLeaves(ne,oe){try{oe(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(ve){oe(ve)}}}class Ns{constructor(ne,oe){this.tileID=new s.aA(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=oe}parse(ne,oe,ve,Ce){this.status="parsing";const Ie=new s.aA(ve.tileID.overscaledZ,ve.tileID.wrap,ve.tileID.canonical.z,ve.tileID.canonical.x,ve.tileID.canonical.y),Ue={},ot=oe.familiesBySource[ve.source],We=new s.dR(Ie,ve.promoteId);return We.bucketLayerIDs=[],We.is3DTile=!0,s.e0(ne).then(it=>{if(!it)return Ce(new Error("Could not parse tile"));const ut=s.e1(it,1/s.c8(ve.tileID.canonical)),at=it.json.extensionsUsed&&it.json.extensionsUsed.includes("MAPBOX_mesh_features")||it.json.asset.extras&&it.json.asset.extras.MAPBOX_mesh_features,At=it.json.extensionsUsed&&it.json.extensionsUsed.includes("EXT_meshopt_compression"),Gt=new s.a3(this.zoom,{brightness:this.brightness});for(const Ht in ot)for(const vr of ot[Ht]){const Er=vr[0];We.bucketLayerIDs.push(vr.map(br=>br.id)),Er.recalculate(Gt,[]);const Rr=new s.e2(ut,Ie,at,At,this.brightness,We);at||(Rr.needsUpload=!0),Ue[Er.fqid]=Rr,Rr.evaluate(Er)}this.status="done",Ce(null,{buckets:Ue,featureIndex:We})}).catch(it=>Ce(new Error(it.message)))}}class Vs{constructor(ne,oe,ve,Ce,Ie,Ue){this.actor=ne,this.layerIndex=oe,this.brightness=Ue,this.loading={},this.loaded={}}loadTile(ne,oe){const ve=ne.uid,Ce=this.loading[ve]=new Ns(ne,this.brightness);s.bc(ne.request,(Ie,Ue)=>{const ot=!this.loading[ve];return delete this.loading[ve],ot||Ie?(Ce.status="done",ot||(this.loaded[ve]=Ce),oe(Ie)):Ue&&Ue.byteLength!==0?void Ce.parse(Ue,this.layerIndex,ne,(We,it)=>{Ce.status="done",this.loaded=this.loaded||{},this.loaded[ve]=Ce,We||!it?oe(We):oe(null,it)}):(Ce.status="done",this.loaded[ve]=Ce,oe())})}reloadTile(ne,oe){const ve=this.loaded,Ce=ne.uid;if(ve&&ve[Ce]){const Ie=ve[Ce];Ie.projection=ne.projection,Ie.brightness=ne.brightness;const Ue=(ot,We)=>{Ie.reloadCallback&&(delete Ie.reloadCallback,this.loadTile(ne,oe)),oe(ot,We)};Ie.status==="parsing"?Ie.reloadCallback=Ue:Ie.status==="done"&&this.loadTile(ne,oe)}}abortTile(ne,oe){const ve=ne.uid;this.loading[ve]&&delete this.loading[ve],oe()}removeTile(ne,oe){const ve=this.loaded,Ce=ne.uid;ve&&ve[Ce]&&delete ve[Ce],oe()}}class Us{constructor(ne){this.self=ne,this.actor=new s.e3(ne,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.bL({name:"mercator"}),this.workerSourceTypes={vector:wt,geojson:Ro,"batched-model":Vs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(oe,ve)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=ve},this.self.registerRTLTextPlugin=oe=>{if(s.e4.isParsed())throw new Error("RTL text plugin already registered.");s.e4.applyArabicShaping=oe.applyArabicShaping,s.e4.processBidirectionalText=oe.processBidirectionalText,s.e4.processStyledBidirectionalText=oe.processStyledBidirectionalText}}clearCaches(ne,oe,ve){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.workerSources[ne],delete this.demWorkerSources[ne],delete this.rasterArrayWorkerSource,ve()}checkIfReady(ne,oe,ve){ve()}setReferrer(ne,oe){this.referrer=oe}spriteLoaded(ne,{scope:oe,isLoaded:ve}){if(this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),this.isSpriteLoaded[ne][oe]=ve,this.workerSources[ne]&&this.workerSources[ne][oe])for(const Ce in this.workerSources[ne][oe]){const Ie=this.workerSources[ne][oe][Ce];for(const Ue in Ie){const ot=Ie[Ue];ot instanceof wt&&(ot.isSpriteLoaded=ve,ot.fire(new s.x("isSpriteLoaded")))}}}setImages(ne,{scope:oe,images:ve},Ce){if(this.availableImages[ne]||(this.availableImages[ne]={}),this.availableImages[ne][oe]=ve,this.workerSources[ne]&&this.workerSources[ne][oe]){for(const Ie in this.workerSources[ne][oe]){const Ue=this.workerSources[ne][oe][Ie];for(const ot in Ue)Ue[ot].availableImages=ve}Ce()}else Ce()}setProjection(ne,oe){this.projections[ne]=s.bL(oe)}setBrightness(ne,oe,ve){this.brightness=oe,ve()}setLayers(ne,oe,ve){this.getLayerIndex(ne,oe.scope).replace(oe.layers,oe.options),ve()}updateLayers(ne,oe,ve){this.getLayerIndex(ne,oe.scope).update(oe.layers,oe.removedIds,oe.options),ve()}loadTile(ne,oe,ve){oe.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,oe.type,oe.source,oe.scope).loadTile(oe,ve)}loadDEMTile(ne,oe,ve){this.getDEMWorkerSource(ne,oe.source,oe.scope).loadTile(oe,ve)}decodeRasterArray(ne,oe,ve){this.getRasterArrayWorkerSource().decodeRasterArray(oe,ve)}reloadTile(ne,oe,ve){oe.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,oe.type,oe.source,oe.scope).reloadTile(oe,ve)}abortTile(ne,oe,ve){this.getWorkerSource(ne,oe.type,oe.source,oe.scope).abortTile(oe,ve)}removeTile(ne,oe,ve){this.getWorkerSource(ne,oe.type,oe.source,oe.scope).removeTile(oe,ve)}removeSource(ne,oe,ve){if(!(this.workerSources[ne]&&this.workerSources[ne][oe.scope]&&this.workerSources[ne][oe.scope][oe.type]&&this.workerSources[ne][oe.scope][oe.type][oe.source]))return;const Ce=this.workerSources[ne][oe.scope][oe.type][oe.source];delete this.workerSources[ne][oe.scope][oe.type][oe.source],Ce.removeSource!==void 0?Ce.removeSource(oe,ve):ve()}loadWorkerSource(ne,oe,ve){try{this.self.importScripts(oe.url),ve()}catch(Ce){ve(Ce.toString())}}syncRTLPluginState(ne,oe,ve){try{s.e4.setState(oe);const Ce=s.e4.getPluginURL();if(s.e4.isLoaded()&&!s.e4.isParsed()&&Ce!=null){this.self.importScripts(Ce);const Ie=s.e4.isParsed();ve(Ie?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ce}`),Ie)}}catch(Ce){ve(Ce.toString())}}setDracoUrl(ne,oe){this.dracoUrl=oe}getAvailableImages(ne,oe){this.availableImages[ne]||(this.availableImages[ne]={});let ve=this.availableImages[ne][oe];return ve||(ve=[]),ve}getLayerIndex(ne,oe){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let ve=this.layerIndexes[ne][oe];return ve||(ve=this.layerIndexes[ne][oe]=new ae,ve.scope=oe),ve}getWorkerSource(ne,oe,ve,Ce){return this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][Ce]||(this.workerSources[ne][Ce]={}),this.workerSources[ne][Ce][oe]||(this.workerSources[ne][Ce][oe]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),this.workerSources[ne][Ce][oe][ve]||(this.workerSources[ne][Ce][oe][ve]=new this.workerSourceTypes[oe]({send:(Ie,Ue,ot,We,it,ut)=>{this.actor.send(Ie,Ue,ot,ne,it,ut)},scheduler:this.actor.scheduler},this.getLayerIndex(ne,Ce),this.getAvailableImages(ne,Ce),this.isSpriteLoaded[ne][Ce],void 0,this.brightness)),this.workerSources[ne][Ce][oe][ve]}getDEMWorkerSource(ne,oe,ve){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][ve]||(this.demWorkerSources[ne][ve]={}),this.demWorkerSources[ne][ve][oe]||(this.demWorkerSources[ne][ve][oe]=new mt),this.demWorkerSources[ne][ve][oe]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new vt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ne,oe){s.e5(oe)}getWorkerPerformanceMetrics(ne,oe,ve){ve(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Us(self)),Us}),I(["./shared"],function(s){var $="3.7.0";const W={create:"create",load:"load",fullLoad:"fullLoad"},Q={mark(d){performance.mark(d)},measure(d,r,a){performance.measure(d,r,a)}};function ae(d){const r=d.name.split("?")[0];return s.a(r)&&r.includes("mapbox-gl.js")?"javascript":s.a(r)&&r.includes("mapbox-gl.css")?"css":s.b(r)?"fontRange":s.c(r)?"sprite":s.i(r)?"style":s.d(r)?"tilejson":"other"}var we,He={},$e=function(){if(we)return He;function d(f){return!r(f)}function r(f){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,k=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(k);try{w=new Worker(M),v=!0}catch{v=!1}return w&&w.terminate(),URL.revokeObjectURL(M),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var k=w.getImageData(0,0,1,1);return k&&k.width===v.width}()?(a[_=f&&f.failIfMajorPerformanceCaveat]===void 0&&(a[_]=function(v){var w,k=function(M){var B=document.createElement("canvas"),z=Object.create(d.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=M,B.getContext("webgl2",z)}(v);if(!k)return!1;try{w=k.createShader(k.VERTEX_SHADER)}catch{return!1}return!(!w||k.isContextLost())&&(k.shaderSource(w,"void main() {}"),k.compileShader(w),k.getShaderParameter(w,k.COMPILE_STATUS)===!0)}(_)),a[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}we=1,He.supported=d,He.notSupportedReason=r;var a={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},He}();function Ne(d,r,a){const f=document.createElement(d);return r!=null&&(f.className=r),a&&a.appendChild(f),f}function wt(d,r,a){const f=document.createElementNS("http://www.w3.org/2000/svg",d);for(const _ of Object.keys(r))f.setAttributeNS(null,_,String(r[_]));return a&&a.appendChild(f),f}const mt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,vt=mt&&mt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let zt;function Ct(){mt&&vt&&(zt=mt[vt],mt[vt]="none")}function qt(){mt&&vt&&(mt[vt]=zt)}function qe(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",qe,!0)}function be(){window.addEventListener("click",qe,!0),window.setTimeout(()=>{window.removeEventListener("click",qe,!0)},0)}function Fe(d,r){const a=d.getBoundingClientRect();return je(d,a,r)}function Je(d,r){const a=d.getBoundingClientRect(),f=[];for(let _=0;_<r.length;_++)f.push(je(d,a,r[_]));return f}function Me(d){return window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function je(d,r,a){const f=d.offsetWidth===r.width?1:d.offsetWidth/r.width;return new s.P((a.clientX-r.left)*f,(a.clientY-r.top)*f)}const Ve="01",An="NO_ACCESS_TOKEN";class jn{constructor(r,a,f){this._transformRequestFn=r,this._customAccessToken=a,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const r=function(){let a="";for(let f=0;f<10;f++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ve,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,a){return this._transformRequestFn&&this._transformRequestFn(r,a)||{url:r}}normalizeStyleURL(r,a){if(!s.f(r))return r;const f=Cr(r);return f.params.push(`sdk=js-${$}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeGlyphsURL(r,a){if(!s.f(r))return r;const f=Cr(r);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeModelURL(r,a){if(!s.f(r))return r;const f=Cr(r);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeSourceURL(r,a,f,_){if(!s.f(r))return r;const v=Cr(r);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),f&&v.params.push(`language=${f}`),_&&v.params.push(`worldview=${_}`),this._makeAPIURL(v,this._customAccessToken||a)}normalizeSpriteURL(r,a,f,_){const v=Cr(r);return s.f(r)?(v.path=`/styles/v1${v.path}/sprite${a}${f}`,this._makeAPIURL(v,this._customAccessToken||_)):(v.path+=`${a}${f}`,Vr(v))}normalizeTileURL(r,a,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!s.f(r))return r;const _=Cr(r);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||f&&_.authority!=="raster"&&f===512?"@2x":""}${s.m.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${s.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${s.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${s.e.TILE_URL_VERSION}${_.path}`);const v=this._customAccessToken||function(w){for(const k of w){const M=k.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(_.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,v)}canonicalizeTileURL(r,a){const f=Cr(r);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return r;let _="mapbox://";f.path.match(/^\/raster\/v1\//)?_+=`raster/${f.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${f.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${f.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let v=f.params;return a&&(v=v.filter(w=>!w.match(/^access_token=/))),v.length&&(_+=`?${v.join("&")}`),_}canonicalizeTileset(r,a){const f=!!a&&s.f(a),_=[];for(const v of r.tiles||[])s.h(v)?_.push(this.canonicalizeTileURL(v,f)):_.push(v);return _}_makeAPIURL(r,a){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Cr(s.e.API_URL);if(r.protocol=_.protocol,r.authority=_.authority,r.protocol==="http"){const v=r.params.indexOf("secure");v>=0&&r.params.splice(v,1)}if(_.path!=="/"&&(r.path=`${_.path}${r.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Vr(r);if(a=a||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return r.params=r.params.filter(v=>v.indexOf("access_token")===-1),r.params.push(`access_token=${a||""}`),Vr(r)}}const or=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Cr(d){const r=d.match(or);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Vr(d){const r=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${r}`}const On="mapbox.eventData";function dr(d){if(!d)return null;const r=d.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(s.j(r[1]))}catch{return null}}class Zn{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const a=dr(s.e.ACCESS_TOKEN);let f="";return f=a&&a.u?s.k(a.u):s.e.ACCESS_TOKEN||"",r?`${On}.${r}:${f}`:`${On}:${f}`}fetchEventData(){const r=s.s("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid");if(r)try{const _=localStorage.getItem(a);_&&(this.eventData=JSON.parse(_));const v=localStorage.getItem(f);v&&(this.anonId=v)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const r=s.s("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.anonId;if(r&&_)try{localStorage.setItem(f,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,a,f,_){if(!s.e.EVENTS_URL)return;const v=Cr(s.e.EVENTS_URL);v.params.push(`access_token=${_||s.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(r).toISOString()},k=a?s.l(w,a):w,M={url:Vr(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=s.p(M,B=>{this.pendingRequest=null,f(B),this.saveEventData(),this.processRequests(_)})}queueRequest(r,a){this.queue.push(r),this.processRequests(a)}}const yn=new class extends Zn{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,r){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(a=>s.f(a)||s.h(a))&&this.queueRequest(Date.now(),r)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=dr(s.e.ACCESS_TOKEN),a=r?r.u:s.e.ACCESS_TOKEN;let f=a!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),f=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),w=new Date(_),k=(_-this.eventData.lastSuccess)/864e5;f=f||k>=1||k<-1||v.getDate()!==w.getDate()}else f=!0;f?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:$,skuId:Ve,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=_,this.eventData.tokenU=a)},d):this.processRequests()}},kt=yn.postTurnstileEvent.bind(yn),fr=new class extends Zn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,r,a,f){this.skuToken=r,this.errorCb=f,s.e.EVENTS_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(An)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:$,skuId:Ve,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):r&&(this.success[r]=!0)},d))}remove(){this.errorCb=null}},li=fr.postMapLoadEvent.bind(fr),Dn=new class extends Zn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let r=this.mapInstanceIdMap.get(d);return r||(r=s.u(),this.mapInstanceIdMap.set(d,r)),r}getEventId(d){const r=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,r+1),r}postStyleLoadEvent(d,r){const{map:a,style:f,importedStyles:_}=r;if(!s.e.EVENTS_URL||!d&&!s.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(a),w={mapInstanceId:v,eventId:this.getEventId(v),style:f};_.length&&(w.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:w},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:a}=this.queue.shift();this.postEvent(r,a,()=>{},d)}},It=Dn.postStyleLoadEvent.bind(Dn),lr=new class extends Zn{constructor(){super("gljs.performance")}postPerformanceEvent(d,r){s.e.EVENTS_URL&&(d||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:a}=this.queue.shift(),f=function(_){const v=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),k=function(q){const Y={};if(q){for(const J in q)if(J!=="other")for(const ee of q[J]){const re=`${J}ResolveRangeMin`,he=`${J}ResolveRangeMax`,pe=`${J}RequestCount`,ce=`${J}RequestCachedCount`;Y[re]=Math.min(Y[re]||1/0,ee.startTime),Y[he]=Math.max(Y[he]||-1/0,ee.responseEnd);const ye=ge=>{Y[ge]===void 0&&(Y[ge]=0),++Y[ge]};ee.transferSize!==void 0&&ee.transferSize===0&&ye(ce),ye(pe)}}return Y}(function(q,Y){const J={};if(q)for(const ee of q){const re=Y(ee);J[re]===void 0&&(J[re]=[]),J[re].push(ee)}return J}(v,ae)),M=window.devicePixelRatio,B=navigator.connection||navigator.mozConnection||navigator.webkitConnection,z=B?B.effectiveType:void 0,V={counters:[],metadata:[],attributes:[]},U=(q,Y,J)=>{J!=null&&q.push({name:Y,value:J.toString()})};for(const q in k)U(V.counters,q,k[q]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(U(V.counters,"interactionRangeMin",_.interactionRange[0]),U(V.counters,"interactionRangeMax",_.interactionRange[1])),w)for(const q of Object.keys(W)){const Y=W[q],J=w.find(ee=>ee.name===Y);J&&U(V.counters,Y,J.startTime)}return U(V.counters,"visibilityHidden",_.visibilityHidden),U(V.attributes,"style",function(q){if(q)for(const Y of q){const J=Y.name.split("?")[0];if(s.i(J)){const ee=J.split("/").slice(-2);if(ee.length===2)return`mapbox://styles/${ee[0]}/${ee[1]}`}}}(v)),U(V.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),U(V.attributes,"fogEnabled",_.fogEnabled?"true":"false"),U(V.attributes,"projection",_.projection),U(V.attributes,"zoom",_.zoom),U(V.metadata,"devicePixelRatio",M),U(V.metadata,"connectionEffectiveType",z),U(V.metadata,"navigatorUserAgent",navigator.userAgent),U(V.metadata,"screenWidth",window.screen.width),U(V.metadata,"screenHeight",window.screen.height),U(V.metadata,"windowWidth",window.innerWidth),U(V.metadata,"windowHeight",window.innerHeight),U(V.metadata,"mapWidth",_.width/M),U(V.metadata,"mapHeight",_.height/M),U(V.metadata,"webglRenderer",_.renderer),U(V.metadata,"webglVendor",_.vendor),U(V.metadata,"sdkVersion",$),U(V.metadata,"sdkIdentifier","mapbox-gl-js"),V}(a);for(const _ of f.metadata);for(const _ of f.counters);for(const _ of f.attributes);this.postEvent(r,f,()=>{},d)}},sr=lr.postPerformanceEvent.bind(lr),wr=new class extends Zn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,r,a,f){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const _=Cr(s.e.API_URL+s.e.SESSION_PATH);_.params.push(`sku=${r||""}`),_.params.push(`access_token=${f||s.e.ACCESS_TOKEN||""}`);const v={url:Vr(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(v,w=>{this.pendingRequest=null,a(w),this.saveEventData(),this.processRequests(f)})}getSessionAPI(d,r,a,f){this.skuToken=r,this.errorCb=f,s.e.SESSION_PATH&&s.e.API_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(An)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||this.getSession(a,this.skuToken,f=>{f?this.errorCb(f):r&&(this.success[r]=!0)},d)}remove(){this.errorCb=null}},_e=wr.getSessionAPI.bind(wr),un=new Set;function Le(d,r){r?un.add(d):un.delete(d)}class Ye{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,a){this._updatedSourceCaches[r]=a,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const a=r.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(r.id),this.setDirty()}removeLayer(r){const a=r.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][r.id]=r,this._updatedLayers[a].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const a in this._updatedLayers)r[a]=r[a]||{},r[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)r[a]=r[a]||{},r[a].removedIds=Object.keys(this._removedLayers[a]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(r),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function De(d){const{userImage:r}=d;return!!(r&&r.render&&r.render())&&(d.data.replace(new Uint8Array(r.data.buffer)),!0)}class jt extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(r){this.images[r]={},this.loaded[r]=!1,this.updatedImages[r]={},this.patterns[r]={},this.callbackDispatchedThisFrame[r]={},this.atlasImage[r]=new s.r({width:1,height:1})}isLoaded(){for(const r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,a){if(this.loaded[a]!==r&&(this.loaded[a]=r,r)){for(const{ids:f,callback:_}of this.requestors)this._notify(f,a,_);this.requestors=[]}}hasImage(r,a){return!!this.getImage(r,a)}getImage(r,a){return this.images[a][r]}addImage(r,a,f){this._validate(r,f)&&(this.images[a][r]=f)}_validate(r,a){let f=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.t(new Error(`Image "${r}" has invalid "stretchX" value`))),f=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.t(new Error(`Image "${r}" has invalid "stretchY" value`))),f=!1),this._validateContent(a.content,a)||(this.fire(new s.t(new Error(`Image "${r}" has invalid "content" value`))),f=!1),f}_validateStretch(r,a){if(!r)return!0;let f=0;for(const _ of r){if(_[0]<f||_[1]<_[0]||a<_[1])return!1;f=_[1]}return!0}_validateContent(r,a){return!(r&&(r.length!==4||r[0]<0||a.data.width<r[0]||r[1]<0||a.data.height<r[1]||r[2]<0||a.data.width<r[2]||r[3]<0||a.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,a,f){f.version=this.images[a][r].version+1,this.images[a][r]=f,this.updatedImages[a][r]=!0}removeImage(r,a){const f=this.images[a][r];delete this.images[a][r],delete this.patterns[a][r],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(r){return Object.keys(this.images[r])}getImages(r,a,f){let _=!0;const v=!!this.loaded[a];if(!v)for(const w of r)this.images[a][w]||(_=!1);v||_?this._notify(r,a,f):this.requestors.push({ids:r,scope:a,callback:f})}getUpdatedImages(r){return this.updatedImages[r]}_notify(r,a,f){const _={};for(const v of r){this.images[a][v]||this.fire(new s.x("styleimagemissing",{id:v}));const w=this.images[a][v];w?_[v]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:s.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,_)}getPixelSize(r){const{width:a,height:f}=this.atlasImage[r];return{width:a,height:f}}getPattern(r,a,f){const _=this.patterns[a][r],v=this.getImage(r,a);if(!v)return null;if(_&&_.position.version===v.version)return _.position;if(_)_.position.version=v.version;else{const w={w:v.data.width+2*s.y,h:v.data.height+2*s.y,x:0,y:0},k=new s.I(w,v,s.y);this.patterns[a][r]={bin:w,position:k}}return this._updatePatternAtlas(a,f),this.patterns[a][r].position}bind(r,a){const f=r.gl;let _=this.atlasTexture[a];_?this.dirty&&(_.update(this.atlasImage[a]),this.dirty=!1):(_=new s.T(r,this.atlasImage[a],f.RGBA8),this.atlasTexture[a]=_),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(r,a){const f=[];for(const k in this.patterns[r])f.push(this.patterns[r][k].bin);const{w:_,h:v}=s.z(f),w=this.atlasImage[r];w.resize({width:_||1,height:v||1});for(const k in this.patterns[r]){const{bin:M,position:B}=this.patterns[r][k];let z=B.padding;const V=M.x+z,U=M.y+z,q=this.images[r][k].data,Y=q.width,J=q.height;z=z>1?z-1:z,s.r.copy(q,w,{x:0,y:0},{x:V,y:U},{width:Y,height:J},a),s.r.copy(q,w,{x:0,y:J-z},{x:V,y:U-z},{width:Y,height:z},a),s.r.copy(q,w,{x:0,y:0},{x:V,y:U+J},{width:Y,height:z},a),s.r.copy(q,w,{x:Y-z,y:0},{x:V-z,y:U},{width:z,height:J},a),s.r.copy(q,w,{x:0,y:0},{x:V+Y,y:U},{width:z,height:J},a),s.r.copy(q,w,{x:Y-z,y:J-z},{x:V-z,y:U-z},{width:z,height:z},a),s.r.copy(q,w,{x:0,y:J-z},{x:V+Y,y:U-z},{width:z,height:z},a),s.r.copy(q,w,{x:0,y:0},{x:V+Y,y:U+J},{width:z,height:z},a),s.r.copy(q,w,{x:Y-z,y:0},{x:V-z,y:U+J},{width:z,height:z},a)}this.dirty=!0}beginFrame(){for(const r in this.images)this.callbackDispatchedThisFrame[r]={}}dispatchRenderCallbacks(r,a){for(const f of r){if(this.callbackDispatchedThisFrame[a][f])continue;this.callbackDispatchedThisFrame[a][f]=!0;const _=this.images[a][f];De(_)&&this.updateImage(f,a,_)}}}function St(d){const r=d.key,a=d.value,f=d.valueSpec||{},_=d.objectElementValidators||{},v=d.style,w=d.styleSpec;let k=[];const M=s.B(a);if(M!=="object")return[new s.V(r,a,`object expected, ${M} found`)];for(const B in a){const z=B.split(".")[0];let V;_[z]?V=_[z]:f[z]?V=nn:_["*"]?V=_["*"]:f["*"]&&(V=nn),V?k=k.concat(V({key:(r&&`${r}.`)+B,value:a[B],valueSpec:f[z]||f["*"],style:v,styleSpec:w,object:a,objectKey:B},a)):k.push(new s.A(r,a[B],`unknown property "${B}"`))}for(const B in f)_[B]||f[B].required&&f[B].default===void 0&&a[B]===void 0&&k.push(new s.V(r,a,`missing required property "${B}"`));return k}function Zt(d){const r=d.value,a=d.valueSpec,f=d.style,_=d.styleSpec,v=d.key,w=d.arrayElementValidator||nn;if(s.B(r)!=="array")return[new s.V(v,r,`array expected, ${s.B(r)} found`)];if(a.length&&r.length!==a.length)return[new s.V(v,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new s.V(v,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let k={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};_.$version<7&&(k.function=a.function),s.B(a.value)==="object"&&(k=a.value);let M=[];for(let B=0;B<r.length;B++)M=M.concat(w({array:r,arrayIndex:B,value:r[B],valueSpec:k,style:f,styleSpec:_,key:`${v}[${B}]`},!0));return M}function Dt(d){const r=d.key,a=d.value,f=d.valueSpec;let _=s.B(a);if(_==="number"&&a!=a&&(_="NaN"),_!=="number")return[new s.V(r,a,`number expected, ${_} found`)];if("minimum"in f){let v=f.minimum;if(s.B(f.minimum)==="array"&&(v=f.minimum[d.arrayIndex]),a<v)return[new s.V(r,a,`${a} is less than the minimum value ${v}`)]}if("maximum"in f){let v=f.maximum;if(s.B(f.maximum)==="array"&&(v=f.maximum[d.arrayIndex]),a>v)return[new s.V(r,a,`${a} is greater than the maximum value ${v}`)]}return[]}function Wt(d){const r=d.valueSpec,a=s.D(d.value.type);let f,_,v,w={};const k=a!=="categorical"&&d.value.property===void 0,M=!k,B=s.B(d.value.stops)==="array"&&s.B(d.value.stops[0])==="array"&&s.B(d.value.stops[0][0])==="object",z=St({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(q){if(a==="identity")return[new s.V(q.key,q.value,'identity function may not have a "stops" property')];let Y=[];const J=q.value;return Y=Y.concat(Zt({key:q.key,value:J,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:V})),s.B(J)==="array"&&J.length===0&&Y.push(new s.V(q.key,J,"array must have at least one stop")),Y},default:function(q){return nn({key:q.key,value:q.value,valueSpec:r,style:q.style,styleSpec:q.styleSpec})}}});return a==="identity"&&k&&z.push(new s.V(d.key,d.value,'missing required property "property"')),a==="identity"||d.value.stops||z.push(new s.V(d.key,d.value,'missing required property "stops"')),a==="exponential"&&d.valueSpec.expression&&!s.F(d.valueSpec)&&z.push(new s.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(M&&!s.G(d.valueSpec)?z.push(new s.V(d.key,d.value,"property functions not supported")):k&&!s.H(d.valueSpec)&&z.push(new s.V(d.key,d.value,"zoom functions not supported"))),a!=="categorical"&&!B||d.value.property!==void 0||z.push(new s.V(d.key,d.value,'"property" property is required')),z;function V(q){let Y=[];const J=q.value,ee=q.key;if(s.B(J)!=="array")return[new s.V(ee,J,`array expected, ${s.B(J)} found`)];if(J.length!==2)return[new s.V(ee,J,`array length 2 expected, length ${J.length} found`)];if(B){if(s.B(J[0])!=="object")return[new s.V(ee,J,`object expected, ${s.B(J[0])} found`)];if(J[0].zoom===void 0)return[new s.V(ee,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new s.V(ee,J,"object stop key must have value")];const re=s.D(J[0].zoom);if(typeof re!="number")return[new s.V(ee,J[0].zoom,"stop zoom values must be numbers")];if(v&&v>re)return[new s.V(ee,J[0].zoom,"stop zoom values must appear in ascending order")];re!==v&&(v=re,_=void 0,w={}),Y=Y.concat(St({key:`${ee}[0]`,value:J[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:Dt,value:U}}))}else Y=Y.concat(U({key:`${ee}[0]`,value:J[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},J));return s.J(s.K(J[1]))?Y.concat([new s.V(`${ee}[1]`,J[1],"expressions are not allowed in function stops.")]):Y.concat(nn({key:`${ee}[1]`,value:J[1],valueSpec:r,style:q.style,styleSpec:q.styleSpec}))}function U(q,Y){const J=s.B(q.value),ee=s.D(q.value),re=q.value!==null?q.value:Y;if(f){if(J!==f)return[new s.V(q.key,re,`${J} stop domain type must match previous stop domain type ${f}`)]}else f=J;if(J!=="number"&&J!=="string"&&J!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new s.V(q.key,re,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&a!=="categorical"){let he=`number expected, ${J} found`;return s.G(r)&&a===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(q.key,re,he)]}return a!=="categorical"||J!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?a!=="categorical"&&J==="number"&&typeof ee=="number"&&typeof _=="number"&&_!==void 0&&ee<_?[new s.V(q.key,re,"stop domain values must appear in ascending order")]:(_=ee,a==="categorical"&&ee in w?[new s.V(q.key,re,"stop domain values must be unique")]:(w[ee]=!0,[])):[new s.V(q.key,re,`integer expected, found ${String(ee)}`)]}}function nr(d){const r=(d.expressionContext==="property"?s.L:s.M)(s.K(d.value),d.valueSpec);if(r.result==="error")return r.value.map(f=>new s.V(`${d.key}${f.key}`,d.value,f.message));const a=r.value.expression||r.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!a.outputDefined())return[new s.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!s.N(a))return[new s.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Kt(a,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!s.O(a,["zoom","feature-state"]))return[new s.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!s.Q(a))return[new s.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kt(d,r){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const _ of r.valueSpec.expression.parameters)a.delete(_);if(a.size===0)return[];const f=[];return d instanceof s.S&&a.has(d.name)?[new s.V(r.key,r.value,`["${d.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(d.eachChild(_=>{f.push(...Kt(_,r))}),f)}function mr(d){const r=d.key,a=d.value,f=d.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(s.D(a))===-1&&_.push(new s.V(r,a,`expected one of [${f.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(f.values).indexOf(s.D(a))===-1&&_.push(new s.V(r,a,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(a)} found`)),_}function Ar(d){return s.W(s.K(d.value))?nr(s.C({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):Ft(d)}function Ft(d){const r=d.value,a=d.key;if(s.B(r)!=="array")return[new s.V(a,r,`array expected, ${s.B(r)} found`)];const f=d.styleSpec;let _,v=[];if(r.length<1)return[new s.V(a,r,"filter array must have at least 1 element")];switch(v=v.concat(mr({key:`${a}[0]`,value:r[0],valueSpec:f.filter_operator,style:d.style,styleSpec:d.styleSpec})),s.D(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&s.D(r[1])==="$type"&&v.push(new s.V(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new s.V(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(_=s.B(r[1]),_!=="string"&&v.push(new s.V(`${a}[1]`,r[1],`string expected, ${_} found`)));for(let w=2;w<r.length;w++)_=s.B(r[w]),s.D(r[1])==="$type"?v=v.concat(mr({key:`${a}[${w}]`,value:r[w],valueSpec:f.geometry_type,style:d.style,styleSpec:d.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&v.push(new s.V(`${a}[${w}]`,r[w],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let w=1;w<r.length;w++)v=v.concat(Ft({key:`${a}[${w}]`,value:r[w],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":_=s.B(r[1]),r.length!==2?v.push(new s.V(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):_!=="string"&&v.push(new s.V(`${a}[1]`,r[1],`string expected, ${_} found`))}return v}function Ir(d,r){const a=d.key,f=d.style,_=d.layer,v=d.styleSpec,w=d.value,k=d.objectKey,M=v[`${r}_${d.layerType}`];if(!M)return[];const B=k.match(/^(.*)-transition$/);if(r==="paint"&&B&&M[B[1]]&&M[B[1]].transition)return nn({key:a,value:w,valueSpec:v.transition,style:f,styleSpec:v});const z=d.valueSpec||M[k];if(!z)return[new s.A(a,w,`unknown property "${k}"`)];let V;if(s.B(w)==="string"&&s.G(z)&&!z.tokens&&(V=/^{([^}]+)}$/.exec(w))){const q=`\`{ "type": "identity", "property": ${V?JSON.stringify(V[1]):'"_"'} }\``;return[new s.V(a,w,`"${k}" does not support interpolation syntax
Use an identity property function instead: ${q}.`)]}const U=[];if(d.layerType==="symbol")k!=="text-field"||!f||f.glyphs||f.imports||U.push(new s.V(a,w,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&s.X(s.K(w))&&s.D(w.type)==="identity"&&U.push(new s.V(a,w,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&r==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&s.G(z)&&(s.Y(z)||s.H(z))){const q=s.L(s.K(w),z),Y=q.value.expression||q.value._styleExpression.expression;Y&&!s.O(Y,["measure-light"])&&(k==="model-emissive-strength"&&s.Q(Y)&&s.N(Y)||U.push(new s.V(a,w,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat(nn({key:d.key,value:w,valueSpec:z,style:f,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:k}))}function Sr(d){return Ir(d,"paint")}function tn(d){return Ir(d,"layout")}function Xr(d){let r=[];const a=d.value,f=d.key,_=d.style,v=d.styleSpec;a.type||a.ref||r.push(new s.V(f,a,'either "type" or "ref" is required'));let w=s.D(a.type);const k=s.D(a.ref);if(a.id){const M=s.D(a.id);for(let B=0;B<d.arrayIndex;B++){const z=_.layers[B];s.D(z.id)===M&&r.push(new s.V(f,a.id,`duplicate layer id "${a.id}", previously used at line ${z.id.__line__}`))}}if("ref"in a){let M;["type","source","source-layer","filter","layout"].forEach(B=>{B in a&&r.push(new s.V(f,a[B],`"${B}" is prohibited for ref layers`))}),_.layers.forEach(B=>{s.D(B.id)===k&&(M=B)}),M?M.ref?r.push(new s.V(f,a.ref,"ref cannot reference another ref layer")):w=s.D(M.type):typeof k=="string"&&r.push(new s.V(f,a.ref,`ref layer "${k}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(a.source){const M=_.sources&&_.sources[a.source],B=M&&s.D(M.type);M?B==="vector"&&w==="raster"?r.push(new s.V(f,a.source,`layer "${a.id}" requires a raster source`)):B==="raster"&&w!=="raster"?r.push(new s.V(f,a.source,`layer "${a.id}" requires a vector source`)):B!=="vector"||a["source-layer"]?B==="raster-dem"&&w!=="hillshade"?r.push(new s.V(f,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):B!=="raster-array"||["raster","raster-particle"].includes(w)?w!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||B==="geojson"&&M.lineMetrics?w==="raster-particle"&&B!=="raster-array"&&r.push(new s.V(f,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):r.push(new s.V(f,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new s.V(f,a.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new s.V(f,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new s.V(f,a.source,`source "${a.source}" not found`))}else r.push(new s.V(f,a,'missing required property "source"'));return r=r.concat(St({key:f,value:a,valueSpec:v.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>nn({key:`${f}.type`,value:a.type,valueSpec:v.layer.type,style:d.style,styleSpec:d.styleSpec,object:a,objectKey:"type"}),filter:M=>Ar(s.C({layerType:w},M)),layout:M=>St({layer:a,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":B=>tn(s.C({layerType:w},B))}}),paint:M=>St({layer:a,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":B=>Sr(s.C({layerType:w,layer:a},B))}})}})),r}function vn(d){const r=d.value,a=d.key,f=s.B(r);return f!=="string"?[new s.V(a,r,`string expected, ${f} found`)]:[]}const xi={promoteId:function({key:d,value:r}){if(s.B(r)==="string")return vn({key:d,value:r});{const a=[];for(const f in r)a.push(...vn({key:`${d}.${f}`,value:r[f]}));return a}}};function Ii(d){const r=d.value,a=d.key,f=d.styleSpec,_=d.style;if(!r.type)return[new s.V(a,r,'"type" is required')];const v=s.D(r.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(r.url||r.tiles||w.push(new s.A(a,r,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(St({key:a,value:r,valueSpec:f[`source_${v.replace("-","_")}`],style:d.style,styleSpec:f,objectElementValidators:xi})),w;case"geojson":if(w=St({key:a,value:r,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:xi}),r.cluster)for(const k in r.clusterProperties){const[M,B]=r.clusterProperties[k],z=typeof M=="string"?[M,["accumulated"],["get",k]]:M;w.push(...nr({key:`${a}.${k}.map`,value:B,expressionContext:"cluster-map"})),w.push(...nr({key:`${a}.${k}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return w;case"video":return St({key:a,value:r,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return St({key:a,value:r,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new s.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return mr({key:`${a}.type`,value:r.type,valueSpec:{values:yo(f)},style:_,styleSpec:f})}}function yo(d){return d.source.reduce((r,a)=>{const f=d[a];return f.type.type==="enum"&&(r=r.concat(Object.keys(f.type.values))),r},[])}function eo(d){const r=d.value,a=d.styleSpec,f=a.light,_=d.style;let v=[];const w=s.B(r);if(r===void 0)return v;if(w!=="object")return v=v.concat([new s.V("light",r,`object expected, ${w} found`)]),v;for(const k in r){const M=k.match(/^(.*)-transition$/);v=v.concat(M&&f[M[1]]&&f[M[1]].transition?nn({key:k,value:r[k],valueSpec:a.transition,style:_,styleSpec:a}):f[k]?nn({key:k,value:r[k],valueSpec:f[k],style:_,styleSpec:a}):[new s.V(k,r[k],`unknown property "${k}"`)])}return v}function co(d){const r=d.value;let a=[];if(!r)return a;const f=s.B(r);if(f!=="object")return a=a.concat([new s.V("light-3d",r,`object expected, ${f} found`)]),a;const _=d.styleSpec,v=_["light-3d"],w=d.key,k=d.style,M=d.style.lights;for(const V of["type","id"])if(!(V in r))return a=a.concat([new s.V("light-3d",r,`missing property ${V} on light`)]),a;if(r.type&&M)for(let V=0;V<d.arrayIndex;V++){const U=s.D(r.type),q=M[V];s.D(q.type)===U&&a.push(new s.V(w,r.id,`duplicate light type "${r.type}", previously defined at line ${q.id.__line__}`))}const B=`properties_light_${r.type}`;if(!(B in _))return a=a.concat([new s.V("light-3d",r,`Invalid light type ${r.type}`)]),a;const z=_[B];for(const V in r)if(V==="properties"){const U=r[V],q=s.B(U);if(q!=="object")return a=a.concat([new s.V("properties",U,`object expected, ${q} found`)]),a;for(const Y in U)a=a.concat(z[Y]?nn({key:Y,value:U[Y],valueSpec:z[Y],style:k,styleSpec:_}):[new s.A(d.key,U[Y],`unknown property "${Y}"`)])}else{const U=V.match(/^(.*)-transition$/);a=a.concat(U&&v[U[1]]&&v[U[1]].transition?nn({key:V,value:r[V],valueSpec:_.transition,style:k,styleSpec:_}):v[V]?nn({key:V,value:r[V],valueSpec:v[V],style:k,styleSpec:_}):[new s.A(V,r[V],`unknown property "${V}"`)])}return a}function Mi(d){const r=d.value,a=d.key,f=d.style,_=d.styleSpec,v=_.terrain;let w=[];const k=s.B(r);if(r===void 0||k==="null")return w;if(k!=="object")return w=w.concat([new s.V("terrain",r,`object expected, ${k} found`)]),w;for(const M in r){const B=M.match(/^(.*)-transition$/);w=w.concat(B&&v[B[1]]&&v[B[1]].transition?nn({key:M,value:r[M],valueSpec:_.transition,style:f,styleSpec:_}):v[M]?nn({key:M,value:r[M],valueSpec:v[M],style:f,styleSpec:_}):[new s.A(M,r[M],`unknown property "${M}"`)])}if(r.source){const M=f.sources&&f.sources[r.source],B=M&&s.D(M.type);M?B!=="raster-dem"&&w.push(new s.V(a,r.source,`terrain cannot be used with a source of type ${String(B)}, it only be used with a "raster-dem" source type`)):w.push(new s.V(a,r.source,`source "${r.source}" not found`))}else w.push(new s.V(a,r,'terrain is missing required property "source"'));return w}function fi(d){const r=d.value,a=d.style,f=d.styleSpec,_=f.fog;let v=[];const w=s.B(r);if(r===void 0)return v;if(w!=="object")return v=v.concat([new s.V("fog",r,`object expected, ${w} found`)]),v;for(const k in r){const M=k.match(/^(.*)-transition$/);v=v.concat(M&&_[M[1]]&&_[M[1]].transition?nn({key:k,value:r[k],valueSpec:f.transition,style:a,styleSpec:f}):_[k]?nn({key:k,value:r[k],valueSpec:_[k],style:a,styleSpec:f}):[new s.A(k,r[k],`unknown property "${k}"`)])}return v}const ls={"*":()=>[],array:Zt,boolean:function(d){const r=d.value,a=d.key,f=s.B(r);return f!=="boolean"?[new s.V(a,r,`boolean expected, ${f} found`)]:[]},number:Dt,color:function(d){const r=d.key,a=d.value,f=s.B(a);return f!=="string"?[new s.V(r,a,`color expected, ${f} found`)]:s.U.parseCSSColor(a)===null?[new s.V(r,a,`color expected, "${a}" found`)]:[]},enum:mr,filter:Ar,function:Wt,layer:Xr,object:St,source:Ii,model:s.Z,light:eo,"light-3d":co,terrain:Mi,fog:fi,string:vn,formatted:function(d){return vn(d).length===0?[]:nr(d)},resolvedImage:function(d){return vn(d).length===0?[]:nr(d)},projection:function(d){const r=d.value,a=d.styleSpec,f=a.projection,_=d.style;let v=[];const w=s.B(r);if(w==="object")for(const k in r)v=v.concat(nn({key:k,value:r[k],valueSpec:f[k],style:_,styleSpec:a}));else w!=="string"&&(v=v.concat([new s.V("projection",r,`object or string expected, ${w} found`)]));return v},import:function(d){const{value:r,styleSpec:a}=d,{data:f,..._}=r;Object.defineProperty(_,"__line__",{value:r.__line__,enumerable:!1});let v=St(s.C({},d,{value:_,valueSpec:a.import}));return s.D(_.id)===""&&v.push(new s.V(`${d.key}.id`,_,"import id can't be an empty string")),f&&(v=v.concat(Fs(f,a,{key:`${d.key}.data`}))),v}};function nn(d,r=!1){const a=d.value,f=d.valueSpec,_=d.styleSpec;if(f.expression&&s.X(s.D(a)))return Wt(d);if(f.expression&&s.J(s.K(a)))return nr(d);if(f.type&&ls[f.type]){const v=ls[f.type](d);return r===!0&&v.length>0&&s.B(d.value)==="array"?nr(d):v}return St(s.C({},d,{valueSpec:f.type?_[f.type]:f}))}function Vo(d){const r=d.value,a=d.key,f=vn(d);return f.length||(r.indexOf("{fontstack}")===-1&&f.push(new s.V(a,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&f.push(new s.V(a,r,'"glyphs" url must include a "{range}" token'))),f}function Fs(d,r=s._,a={}){return nn({key:a.key||"",value:d,valueSpec:r.$root,styleSpec:r,style:d,objectElementValidators:{glyphs:Vo,"*":()=>[]}})}function to(d,r=s._){return Ie(Fs(d,r))}const Co=d=>Ie(Ii(d)),Ro=d=>Ie(eo(d)),Ns=d=>Ie(co(d)),Vs=d=>Ie(Mi(d)),Us=d=>Ie(fi(d)),nt=d=>Ie(Xr(d)),ne=d=>Ie(Ar(d)),oe=d=>Ie(Sr(d)),ve=d=>Ie(tn(d)),Ce=d=>Ie(s.Z(d));function Ie(d){return d.slice().sort((r,a)=>r.line&&a.line?r.line-a.line:0)}function Ue(d,r){let a=!1;if(r&&r.length)for(const f of r)f instanceof s.A?s.w(f.message):(d.fire(new s.t(new Error(f.message))),a=!0);return a}let ot;class We extends s.E{constructor(r,a="flat"){super(),this._transitionable=new s.$(ot||(ot=new s.a0({anchor:new s.a1(s._.light.anchor),position:new s.a2(s._.light.position),color:new s.a1(s._.light.color),intensity:new s.a1(s._.light.intensity)}))),this.setLight(r,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,a,f={}){this._validate(Ro,r,f)||(this._transitionable.setTransitionOrValue(r),this.id=a)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,a,f){return(!f||f.validate!==!1)&&Ue(this,r.call(to,s.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s._})))}}const it=new s.a0({source:new s.a1(s._.terrain.source),exaggeration:new s.a1(s._.terrain.exaggeration)});let ut=class extends s.E{constructor(d,r,a,f){super(),this.scope=a,this._transitionable=new s.$(it,a,f),this._transitionable.setTransitionOrValue(d,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(d,r){this._transitionable.setTransitionOrValue(d,r)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new s.a3(d)).get("exaggeration")}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof s.a4}};const at=45,At=65,Gt=.05;function Ht(d,r,a,f){const _=s.a7(at,At,a),[v,w]=vr(d,f);let k=1-Math.min(1,Math.exp((r-v)/(w-v)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*_*d.alpha}function vr(d,r){const a=.5/Math.tan(.5*r);return[d.range[0]+a,d.range[1]+a]}function Er(d,r,a,f,_){const v=s.a6.vec3.transformMat4([],[r,a,f],_.mercatorFogMatrix);return Ht(d,s.a6.vec3.length(v),_.pitch,_._fov)}function Rr(d,r,a,f,_,v,w){const k=[[a,f,0],[_,f,0],[_,v,0],[a,v,0]];let M=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(const z of k){const V=s.a6.vec3.transformMat4([],z,r),U=s.a6.vec3.length(V);M=Math.min(M,U),B=Math.max(B,U)}return[Ht(d,M,w.pitch,w._fov),Ht(d,B,w.pitch,w._fov)]}const br=new s.a0({range:new s.a1(s._.fog.range),color:new s.a1(s._.fog.color),"high-color":new s.a1(s._.fog["high-color"]),"space-color":new s.a1(s._.fog["space-color"]),"horizon-blend":new s.a1(s._.fog["horizon-blend"]),"star-intensity":new s.a1(s._.fog["star-intensity"]),"vertical-range":new s.a1(s._.fog["vertical-range"])});class on extends s.E{constructor(r,a,f,_){super(),this._transitionable=new s.$(br,f,new Map(_)),this.set(r,_),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new s.a8(br),this.scope=f}get state(){const r=this._transform,a=r.projection.name==="globe",f=s.a9(r.zoom),_=this.properties.get("range"),v=[.5,3];return{range:a?[s.aa(v[0],_[0],f),s.aa(v[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,a,f={}){if(this._validate(Us,r,f))return;const _=s.l({},r);for(const v of Object.keys(s._.fog))_[v]===void 0&&(_[v]=s._.fog[v].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.a7(at,At,r))*a.a}getOpacityAtLatLng(r,a){return this._transform.projection.supportsFog?function(f,_,v){const w=s.a5.fromLngLat(_),k=v.elevation?v.elevation.getAtPointOrZero(w):0;return Er(f,w.x,w.y,k,v)}(this.state,r,a):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(r.toUnwrapped());return Rr(this.state,a,0,0,s.ab,s.ab,this._transform)}getOpacityForBounds(r,a,f,_,v){return this._transform.projection.supportsFog?Rr(this.state,r,a,f,_,v,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?vr(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const f of a){const _=r.points[f];let v;if(_[2]>=0)v=_;else{const w=r.points[f-4];v=s.ac(w,_,w[2]/(w[2]-_[2]))}if(Er(this.state,v[0],v[1],0,this._transform)>=Gt)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,a,f){return(!f||f.validate!==!1)&&Ue(this,r.call(to,s.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s._})))}}class pn extends s.E{constructor(r,a,f,_){super(),this.scope=f,this._options=r,this.properties=new s.a8(a),this._transitionable=new s.$(a,f,new Map(_)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,a){this._options=r,this._transitionable.setTransitionOrValue(r.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Or,mn;class Bn{constructor(r,a,f,_){this.screenBounds=r,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(r,a){let f,_;if(r instanceof s.P||typeof r[0]=="number"){const v=s.P.convert(r);f=[v],_=a.isPointAboveHorizon(v)}else{const v=s.P.convert(r[0]),w=s.P.convert(r[1]);f=[v,w],_=s.ae(v,w).every(k=>a.isPointAboveHorizon(k))}return new Bn(f,a.getCameraPoint(),_,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return s.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],_=s.ae(a,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(_[3]=this.cameraPoint)),s.af(_,r)}bufferedCameraGeometryGlobe(r){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],_=s.ae(a,f,r),v=this.cameraPoint.clone();switch(3*((v.y>a.y)+(v.y>f.y))+((v.x>a.x)+(v.x>f.x))){case 0:_[0]=v,_[4]=v.clone();break;case 1:_.splice(1,0,v);break;case 2:_[1]=v;break;case 3:_.splice(4,0,v);break;case 5:_.splice(2,0,v);break;case 6:_[3]=v;break;case 7:_.splice(3,0,v);break;case 8:_[2]=v}return _}containsTile(r,a,f,_=0){const v=r.queryPadding/a._pixelsPerMercatorPixel+1,w=f?this._bufferedCameraMercator(v,a):this._bufferedScreenMercator(v,a);let k=r.tileID.wrap+(w.unwrapped?_:0);const M=w.polygon.map(ee=>s.ag(r.tileTransform,ee,k));if(!s.ah(M,0,0,s.ab,s.ab))return;k=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const B=this.screenGeometryMercator.polygon.map(ee=>s.ai(r.tileTransform,ee,k)),z=B.map(ee=>new s.P(ee[0],ee[1])),V=a.getFreeCameraOptions().position||new s.a5(0,0,0),U=s.ai(r.tileTransform,V,k),q=B.map(ee=>{const re=s.a6.vec3.sub(ee,ee,U);return s.a6.vec3.normalize(re,re),new s.aj(U,re)}),Y=s.ak(r,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:q,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(J=s.al(M),J.min.x=s.ap(J.min.x,0,s.ab),J.min.y=s.ap(J.min.y,0,s.ab),J.max.x=s.ap(J.max.x,0,s.ab),J.max.y=s.ap(J.max.y,0,s.ab),J),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:Y};var J}_bufferedScreenMercator(r,a){const f=gi(r);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),a):{polygon:this.bufferedScreenGeometry(r).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(r,a){const f=gi(r);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),a):{polygon:this.bufferedCameraGeometry(r).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(r,a){const f=function(v,w){const k=s.a6.mat4.multiply([],w.pixelMatrix,w.globeMatrix),M=[0,-s.aq,0,1],B=[0,s.aq,0,1],z=[0,0,0,1];s.a6.vec4.transformMat4(M,M,k),s.a6.vec4.transformMat4(B,B,k),s.a6.vec4.transformMat4(z,z,k);const V=new s.P(M[0]/M[3],M[1]/M[3]),U=new s.P(B[0]/B[3],B[1]/B[3]),q=s.an(v,V)&&M[3]<z[3],Y=s.an(v,U)&&B[3]<z[3];if(!q&&!Y)return null;const J=function(Ae,Te,Se){for(let Oe=1;Oe<Ae.length;Oe++){const ke=mi(Te.pointCoordinate3D(Ae[Oe-1]).x),Re=mi(Te.pointCoordinate3D(Ae[Oe]).x);if(Se<0){if(ke<Re)return{idx:Oe,t:-ke/(Re-1-ke)}}else if(Re<ke)return{idx:Oe,t:(1-ke)/(Re+1-ke)}}return null}(v,w,q?-1:1);if(!J)return null;const{idx:ee,t:re}=J;let he=ee>1?pi(v.slice(0,ee),w):[],pe=ee<v.length?pi(v.slice(ee),w):[];he=he.map(Ae=>new s.P(mi(Ae.x),Ae.y)),pe=pe.map(Ae=>new s.P(mi(Ae.x),Ae.y));const ce=[...he];ce.length===0&&ce.push(pe[pe.length-1]);const ye=s.aa(ce[ce.length-1].y,(pe.length===0?he[0]:pe[0]).y,re);let ge;return ge=q?[new s.P(0,ye),new s.P(0,0),new s.P(1,0),new s.P(1,ye)]:[new s.P(1,ye),new s.P(1,1),new s.P(0,1),new s.P(0,ye)],ce.push(...ge),pe.length===0?ce.push(he[0]):ce.push(...pe),{polygon:ce.map(Ae=>new s.a5(Ae.x,Ae.y)),unwrapped:!1}}(r,a);if(f)return f;const _=function(v,w){let k=!1,M=-1/0,B=0;for(let V=0;V<v.length-1;V++)v[V].x>M&&(M=v[V].x,B=V);for(let V=0;V<v.length-1;V++){const U=(B+V)%(v.length-1),q=v[U],Y=v[U+1];Math.abs(q.x-Y.x)>.5&&(q.x<Y.x?(q.x+=1,U===0&&(v[v.length-1].x+=1)):(Y.x+=1,U+1===v.length-1&&(v[0].x+=1)),k=!0)}const z=s.am(w.center.lng);return k&&z<Math.abs(z-1)&&v.forEach(V=>{V.x-=1}),{polygon:v,unwrapped:k}}(pi(r,a).map(v=>new s.P(mi(v.x),v.y)),a);return{polygon:_.polygon.map(v=>new s.a5(v.x,v.y)),unwrapped:_.unwrapped}}}function pi(d,r){return s.ao(d,a=>{const f=r.pointCoordinate3D(a);a.x=f.x,a.y=f.y},1/256)}function mi(d){return d<0?1+d%1:d%1}function gi(d){return 100*d|0}function ji(d,r,a,f,_){const v=function(k,M){if(k)return _(k);if(M){if(d.url&&M.tiles&&d.tiles&&delete d.tiles,M.variants){if(!Array.isArray(M.variants))return _(new Error("variants must be an array"));for(const z of M.variants){if(z==null||typeof z!="object"||z.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(z.capabilities))return _(new Error("capabilities must be an array"));if(z.capabilities.length===1&&z.capabilities[0]==="meshopt"){M=s.l(M,z);break}}}const B=s.ar(s.l(M,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(B.vectorLayers=M.vector_layers,B.vectorLayerIds=B.vectorLayers.map(z=>z.id)),M.raster_layers&&(B.rasterLayers=M.raster_layers,B.rasterLayerIds=B.rasterLayers.map(z=>z.id)),B.tiles=r.canonicalizeTileset(B,d.url),_(null,B)}},w=function(k,M,B){if(!k)return null;if(!M&&!B)return k;B=B||k.worldview_default;const z=Object.values(k.language||{});if(z.length===0)return null;const V=Object.values(k.worldview||{});if(V.length===0)return null;const U=z.every(Y=>Y===M),q=V.every(Y=>Y===B);return U&&q?k:M in(k.language_options||{})||B in(k.worldview_options||{})?null:k.language_options&&k.worldview_options?k:null}(d.data,a,f);return w?s.q.frame(()=>v(null,w)):d.url?s.n(r.transformRequest(r.normalizeSourceURL(d.url,null,a,f),s.R.Source),v):s.q.frame(()=>{const{data:k,...M}=d;v(null,M)})}class Uo{constructor(r,a,f){this.bounds=s.as.convert(this.validateBounds(r)),this.minzoom=a||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const a=Math.pow(2,r.z),f=Math.floor(s.am(this.bounds.getWest())*a),_=Math.floor(s.at(this.bounds.getNorth())*a),v=Math.ceil(s.am(this.bounds.getEast())*a),w=Math.ceil(s.at(this.bounds.getSouth())*a);return r.x>=f&&r.x<v&&r.y>=_&&r.y<w}}class Cs extends s.E{constructor(r,a,f,_){if(super(),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.ar(a,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new s.au}load(r){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=ji(this._options,this.map._requestManager,a,f,(_,v)=>{this._tileJSONRequest=null,this._loaded=!0,_?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new s.t(_))):v&&(s.l(this,v),v.bounds&&(this.tileBounds=new Uo(v.bounds,this.minzoom,this.maxzoom)),kt(v.tiles,this.map._requestManager._customAccessToken),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))),r&&r(_)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=s.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(r,a){const f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),_=this.map._requestManager.transformRequest(f,s.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,w={request:_,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,lut:v?{image:v.image.clone()}:null,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(w.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=a:r.request=r.actor.send("reloadTile",w,k.bind(this));else if(r.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",w,k.bind(this),void 0,!0);else{const M=s.aw.call({deduped:this._deduped},w,(B,z)=>{B||!z?k.call(this,B):(w.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},r.actor&&r.actor.send("loadTile",w,k.bind(this),void 0,!0))},!0);r.request={cancel:M}}function k(M,B){return delete r.request,r.aborted?a(null):M&&M.status!==404?a(M):(B&&B.resourceTiming&&(r.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&r.setExpiryData(B),r.loadVectorData(B,this.map.painter),s.ax(this.dispatcher),a(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,a){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ko extends s.E{constructor(r,a,f,_){super(),this.id=r,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},a),s.l(this,s.ar(a,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"})),this._tileJSONRequest=ji(this._options,this.map._requestManager,null,null,(a,f)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new s.t(a)):f&&(s.l(this,f),f.bounds&&(this.tileBounds=new Uo(f.bounds,this.minzoom,this.maxzoom)),kt(f.tiles),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))),r&&r(a)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=s.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,a){const f=s.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);r.request=s.o(this.map._requestManager.transformRequest(_,s.R.Tile),(v,w,k,M)=>(delete r.request,r.aborted?(r.state="unloaded",a(null)):v?(r.state="errored",a(v)):w?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:k,expires:M}),r.setTexture(w,this.map.painter),r.state="loaded",s.ax(this.dispatcher),void a(null)):a(null)))}abortTile(r,a){r.request&&(r.request.cancel(),delete r.request),a&&a()}unloadTile(r,a){r.texture&&r.texture instanceof s.T?(r.destroy(!0),r.texture&&r.texture instanceof s.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class pa extends ko{constructor(r,a,f,_){super(r,a,f,_),this.type="raster-array",this.maxzoom=22,this._options=s.l({type:"raster-array"},a)}triggerRepaint(r){const a=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);a&&a.enabled&&f&&a._clearRenderCacheForTile(f.id,r.tileID),this.map.triggerRepaint()}loadTile(r,a){const f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,s.R.Tile);r.requestParams=_,r.actor||(r.actor=this.dispatcher.getActor()),r.request=r.fetchHeader(void 0,(v,w,k,M)=>{if(delete r.request,r.aborted)return r.state="unloaded",a(null);if(v)return v.code===20?void 0:(r.state="errored",a(v));this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:k,expires:M}),r.state="empty",a(null)})}unloadTile(r,a){const f=r.texture;f&&f instanceof s.T?(r.destroy(!0),this.map.painter.saveTileTexture(f)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,a,f){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(a,f,(_,v)=>{if(_)return r.state="errored",this.fire(new s.t(_)),void this.triggerRepaint(r);v&&(r.setTexture(v,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:v})=>v===r),f=a&&a.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(r,a,f){if(!r)return;const _=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let v=null;a instanceof s.aB?v=a.paint.get("raster-array-band"):a instanceof s.aC&&(v=a.paint.get("raster-particle-array-band"));const w=v||this.getInitialBand(_);if(w!=null)if(r.textureDescriptor){if(!r.updateNeeded(_,w)||f)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,_,w)}}const js={vector:Cs,raster:ko,"raster-dem":class extends ko{constructor(d,r,a,f){super(d,r,a,f),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(d,r){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,v){_&&(d.state="errored",r(_)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",r(null))}d.request=s.o(this.map._requestManager.transformRequest(a,s.R.Tile),(function(_,v,w,k){if(delete d.request,d.aborted)d.state="unloaded",r(null);else if(_)d.state="errored",r(_);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:w,expires:k});const M=ImageBitmap&&v instanceof ImageBitmap&&s.ay(),B=1-(v.width-s.az(v.width))/2;B<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const z=M?v:s.q.getImageData(v,B),V={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:B};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",V,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const r=d.canonical,a=Math.pow(2,r.z),f=(r.x-1+a)%a,_=r.x===0?d.wrap-1:d.wrap,v=(r.x+1+a)%a,w=r.x+1===a?d.wrap+1:d.wrap,k={};return k[new s.aA(d.overscaledZ,_,r.z,f,r.y).key]={backfilled:!1},k[new s.aA(d.overscaledZ,w,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(k[new s.aA(d.overscaledZ,_,r.z,f,r.y-1).key]={backfilled:!1},k[new s.aA(d.overscaledZ,d.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},k[new s.aA(d.overscaledZ,w,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<a&&(k[new s.aA(d.overscaledZ,_,r.z,f,r.y+1).key]={backfilled:!1},k[new s.aA(d.overscaledZ,d.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},k[new s.aA(d.overscaledZ,w,r.z,v,r.y+1).key]={backfilled:!1}),k}},"raster-array":pa,geojson:class extends s.E{constructor(d,r,a,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(f),this._data=r.data,this._options=s.l({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=s.ab/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:s.ab,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:s.ab,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new s.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new s.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const a of this._data.features)r.set(a.id,a);for(const a of d.features)r.set(a.id,a);this._data.features=[...r.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},r),this}getClusterChildren(d,r){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},r),this}getClusterLeaves(d,r,a,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:r,offset:a},f),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.x("dataloading",{dataType:"source"})),this._loaded=!1;const r=s.l({append:d},this.workerOptions);r.scope=this.scope;const a=this._data;typeof a=="string"?(r.request=this.map._requestManager.transformRequest(s.q.resolveURL(a),s.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new s.t(f));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(v.resourceTiming=_.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new s.x("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,r){const a=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const f=this.map.style?this.map.style.getLut(this.scope):null,_=this._partialReload,v={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:f?{image:f.image.clone()}:null,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:_};d.request=this.actor.send(a,v,(w,k)=>_&&!k?(d.state="loaded",r(null)):(delete d.request,d.destroy(),d.aborted?r(null):w?r(w):(d.loadVectorData(k,this.map.painter,a==="reloadTile"),r(null))),void 0,a==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,r){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aD{constructor(d,r,a,f){super(d,r,a,f),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const r of d.urls)this.urls.push(this.map._requestManager.transformRequest(r,s.R.Source).url);s.aE(this.urls,(r,a)=>{this._loaded=!0,r?this.fire(new s.t(r)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const r=this.video.seekable;d<r.start(0)||d>r.end(0)?this.fire(new s.t(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,r=d.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(d,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aD,model:class extends s.E{constructor(d,r,a,f){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const d=[];for(const r in this._options.models){const a=this._options.models[r],f=s.aG(this.map._requestManager.transformRequest(a.uri,s.R.Model).url).then(_=>{if(!_)return;const v=s.aH(_),w=new s.aI(r,a.position,a.orientation,v);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(_=>{this.fire(new s.t(new Error(`Could not load model ${r} from ${a.uri}: ${_.message}`)))});d.push(f)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new s.t(new Error(`Could not load models: ${r.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,r){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(d,r,a,f){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(d){this.map=d,this.load()}load(d){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=ji(this._options,this.map._requestManager,r,a,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.t(f))):_&&(s.l(this,_),_.bounds&&(this.tileBounds=new Uo(_.bounds,this.minzoom,this.maxzoom)),kt(_.tiles,this.map._requestManager._customAccessToken),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))),d&&d(f)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,r){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(a,s.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=r;else{if(d.buckets){const v=Object.values(d.buckets);for(const w of v)w.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",f,_.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(v,w){return d.aborted?r(null):v&&v.status!==404?r(v):(w&&(w.resourceTiming&&(d.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&d.setExpiryData(w),d.buckets={...d.buckets,...w.buckets},w.featureIndex&&(d.latestFeatureIndex=w.featureIndex)),d.state="loaded",void r(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aD{constructor(d,r,a,f){super(d,r,a,f),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(v=>typeof v!="number"))||this.fire(new s.t(new s.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.t(new s.V(`sources.${d}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new s.t(new s.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new s.t(new s.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.t(new s.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof s.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends s.E{constructor(d,r,a,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=r,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Uo(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.ar(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:r,y:a,z:f}=d.canonical;return this._implementation.hasTile({x:r,y:a,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,r){const{x:a,y:f,z:_}=d.tileID.canonical,v=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:a,y:f,z:_},{signal:v.signal})).then((function(w){return delete d.request,d.aborted?(d.state="unloaded",r(null)):w===void 0?(d.state="errored",r(null)):w===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",r(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(w)?(this.loadTileData(d,w),d.state="loaded",void r(null)):(d.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.code!==20&&(d.state="errored",r(w))}),d.request.cancel=()=>v.abort()}loadTileData(d,r){d.setTexture(r,this.map.painter)}unloadTile(d,r){if(d.texture&&d.texture instanceof s.T?(d.destroy(!0),d.texture&&d.texture instanceof s.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:a,y:f,z:_}=d.tileID.canonical;this._implementation.unloadTile({x:a,y:f,z:_})}r&&r()}abortTile(d,r){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=s.av(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))}}},$s=function(d,r,a,f){const _=new js[r.type](d,r,a,f);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return s.aJ(["load","abort","unload","serialize","prepare"],_),_};function ol(d,r){const a=s.a6.mat4.identity([]);return s.a6.mat4.scale(a,a,[.5*d.width,.5*-d.height,1]),s.a6.mat4.translate(a,a,[1,-1,0]),s.a6.mat4.multiply(a,a,d.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(a)}function Ml(d,r,a,f,_,v,w,k=!1){const M=d.tilesIn(f,w,k);M.sort(Oa);const B=[];for(const V of M)B.push({wrappedTileID:V.tile.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(r,a,d._state,V,_,v,ol(d.transform,V.tile.tileID),k)});const z=function(V){const U={},q={};for(const Y of V){const J=Y.queryResults,ee=Y.wrappedTileID,re=q[ee]=q[ee]||{};for(const he in J){const pe=J[he],ce=re[he]=re[he]||{},ye=U[he]=U[he]||[];for(const ge of pe)ce[ge.featureIndex]||(ce[ge.featureIndex]=!0,ye.push(ge))}}return U}(B);for(const V in z)z[V].forEach(U=>{const q=U.feature,Y=q.layer;Y&&Y.type!=="background"&&Y.type!=="sky"&&Y.type!=="slot"&&(q.source=Y.source,Y["source-layer"]&&(q.sourceLayer=Y["source-layer"]),q.state=q.id!==void 0?d.getFeatureState(Y["source-layer"],q.id):{})});return z}function La(d,r){const a=d.getRenderableIds().map(v=>d.getTileByID(v)),f=[],_={};for(let v=0;v<a.length;v++){const w=a[v],k=w.tileID.canonical.key;_[k]||(_[k]=!0,w.querySourceFeatures(f,r))}return f}function Oa(d,r){const a=d.tileID,f=r.tileID;return a.overscaledZ-f.overscaledZ||a.canonical.y-f.canonical.y||a.wrap-f.wrap||a.canonical.x-f.canonical.x}const Po=32,Mo=33,Do=new Uint16Array(8184);for(let d=0;d<2046;d++){let r=d+2,a=0,f=0,_=0,v=0,w=0,k=0;for(1&r?_=v=w=Po:a=f=k=Po;(r>>=1)>1;){const B=a+_>>1,z=f+v>>1;1&r?(_=a,v=f,a=w,f=k):(a=_,f=v,_=w,v=k),w=B,k=z}const M=4*d;Do[M+0]=a,Do[M+1]=f,Do[M+2]=_,Do[M+3]=v}const ci=new Uint16Array(2178),Zi=new Uint8Array(1089),uo=new Uint16Array(1089);function ma(d){return d===0?-.03125:d===32?.03125:0}const Ba={type:2,extent:s.ab,loadGeometry:()=>[[new s.P(0,0),new s.P(s.ab+1,0),new s.P(s.ab+1,s.ab+1),new s.P(0,s.ab+1),new s.P(0,0)]]};class jo{constructor(r,a,f,_,v){this.tileID=r,this.uid=s.aP(),this.uses=0,this.tileSize=a,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(r){const a=r+this.timeAdded;a<s.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aK(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,f){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(_,v){const w={};if(!v)return w;for(const k of _){const M=k.layerIds.map(B=>v.getLayer(B)).filter(Boolean);if(M.length!==0){k.layers=M,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map(B=>M.filter(z=>z.id===B)[0]));for(const B of M)w[B.fqid]=k}}return w}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof s.aR){if(this.hasSymbolBuckets=!0,!f)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof s.aR&&v.hasRTLText){this.hasRTLText=!0,s.aS();break}}this.queryPadding=0;for(const _ in this.buckets){const v=this.buckets[_],w=a.style.getOwnLayer(_);if(!w)continue;const k=w.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,k)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new s.aQ}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const _ in this.buckets){const v=this.buckets[_];v.uploadPending()&&v.upload(r)}const a=r.gl,f=this.imageAtlas;if(f&&!f.uploaded){const _=!!Object.keys(f.patternPositions).length;this.imageAtlasTexture=new s.T(r,f.image,a.RGBA8,{useMipmap:_}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(r,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(r,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(r,a,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,f),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=a.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this._lastUpdatedBrightness=_,this.updateBuckets(a)))}queryRenderedFeatures(r,a,f,_,v,w,k,M){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:_,pixelPosMatrix:k,transform:w,params:v,tileTransform:this.tileTransform},r,a,f):{}}querySourceFeatures(r,a){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),v=a?a.sourceLayer:"",w=_._geojsonTileLayer||_[v];if(!w)return;const k=s.aT(a&&a.filter),{z:M,x:B,y:z}=this.tileID.canonical,V={z:M,x:B,y:z};for(let U=0;U<w.length;U++){const q=w.feature(U);if(k.needGeometry){const ee=s.aU(q,!0);if(!k.filter(new s.a3(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!k.filter(new s.a3(this.tileID.overscaledZ),q))continue;const Y=f.getId(q,v),J=new s.aV(q,M,B,z,Y);J.tile=V,r.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const f=s.aW(r.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(a)if(this.expirationTime<a)_=!0;else{const v=this.expirationTime-a;v?this.expirationTime=f+Math.max(v,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(r).length!==0&&a&&this.updateBuckets(a)}updateBuckets(r){if(!this.latestFeatureIndex)return;const a=this.latestFeatureIndex.loadVTLayers(),f=r.style.listImages(),_=r.style.getBrightness();for(const v in this.buckets){if(!r.style.hasLayer(v))continue;const w=this.buckets[v],k=w.layers[0].sourceLayer||"_geojsonTileLayer",M=a[k],B=r.style.getOwnSourceCache(w.layers[0].source);let z={};B&&(z=B._state.getState(k,void 0)),w.update(z,M,f,this.imageAtlas&&this.imageAtlas.patternPositions||{},_),(w instanceof s.aX||w instanceof s.aY)&&r._terrain&&r._terrain.enabled&&B&&w.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(B.id,this.tileID);const V=r&&r.style&&r.style.getOwnLayer(v);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=s.q.now()+r}setTexture(r,a){const f=a.context,_=f.gl;this.texture=this.texture||a.getTileTexture(r.width),this.texture&&this.texture instanceof s.T?this.texture.update(r):(this.texture=new s.T(f,r,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(r,a){const f={};for(const _ of a)f[_]=!0;this.dependencies[r]=f}hasDependency(r,a){for(const f of r){const _=this.dependencies[f];if(_){for(const v of a)if(_[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const f=s.aZ(Ba,this.tileID.canonical,this.tileTransform)[0],_=new s.a_,v=new s.a$;for(let w=0;w<f.length;w++){const{x:k,y:M}=f[w];_.emplaceBack(k,M),v.emplaceBack(w)}v.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(v),this._tileDebugBuffer=r.createVertexBuffer(_,s.b0.members),this._tileDebugSegments=s.b1.simpleSegment(0,0,_.length,v.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const f=s.aZ(Ba,this.tileID.canonical,this.tileTransform)[0];let _,v;if(this.isRaster){const w=function(k,M){const B=s.aK(k,M),z=Math.pow(2,k.z);for(let ee=0;ee<Mo;ee++)for(let re=0;re<Mo;re++){const he=s.aL((k.x+(re+ma(re))/Po)/z),pe=s.aM((k.y+(ee+ma(ee))/Po)/z),ce=M.project(he,pe),ye=ee*Mo+re;ci[2*ye+0]=Math.round((ce.x*B.scale-B.x)*s.ab),ci[2*ye+1]=Math.round((ce.y*B.scale-B.y)*s.ab)}Zi.fill(0),uo.fill(0);for(let ee=2045;ee>=0;ee--){const re=4*ee,he=Do[re+0],pe=Do[re+1],ce=Do[re+2],ye=Do[re+3],ge=he+ce>>1,Ae=pe+ye>>1,Te=ge+Ae-pe,Se=Ae+he-ge,Oe=pe*Mo+he,ke=ye*Mo+ce,Re=Ae*Mo+ge,Xe=Math.hypot((ci[2*Oe+0]+ci[2*ke+0])/2-ci[2*Re+0],(ci[2*Oe+1]+ci[2*ke+1])/2-ci[2*Re+1])>=16;Zi[Re]=Zi[Re]||(Xe?1:0),ee<1022&&(Zi[Re]=Zi[Re]||Zi[(pe+Se>>1)*Mo+(he+Te>>1)]||Zi[(ye+Se>>1)*Mo+(ce+Te>>1)])}const V=new s.aN,U=new s.aO;let q=0;function Y(ee,re){const he=re*Mo+ee;return uo[he]===0&&(V.emplaceBack(ci[2*he+0],ci[2*he+1],ee*s.ab/Po,re*s.ab/Po),uo[he]=++q),uo[he]-1}function J(ee,re,he,pe,ce,ye){const ge=ee+he>>1,Ae=re+pe>>1;if(Math.abs(ee-ce)+Math.abs(re-ye)>1&&Zi[Ae*Mo+ge])J(ce,ye,ee,re,ge,Ae),J(he,pe,ce,ye,ge,Ae);else{const Te=Y(ee,re),Se=Y(he,pe),Oe=Y(ce,ye);U.emplaceBack(Te,Se,Oe)}}return J(0,0,Po,Po,Po,0),J(Po,Po,0,0,0,Po),{vertices:V,indices:U}}(this.tileID.canonical,a);_=w.vertices,v=w.indices}else{_=new s.aN,v=new s.aO;for(const{x:k,y:M}of f)_.emplaceBack(k,M,0,0);const w=s.b2(_.int16,void 0,4);for(let k=0;k<w.length;k+=3)v.emplaceBack(w[k],w[k+1],w[k+2])}this._tileBoundsBuffer=r.createVertexBuffer(_,s.b3.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(v),this._tileBoundsSegments=s.b1.simpleSegment(0,0,_.length,v.length)}_makeGlobeTileDebugBuffers(r,a){const f=a.projection;if(!f||f.name!=="globe"||a.freezeTileCoverage)return;const _=this.tileID.canonical,v=s.b4(_,a),w=s.b5(v),k=s.a9(a.zoom);let M;k>0&&(M=s.a6.mat4.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,_,a,w,M,k),this._makeGlobeTileDebugTextBuffer(r,_,a,w,M,k)}_globePoint(r,a,f,_,v,w,k){let M=s.b6(r,a,f);if(w){const B=1<<f.z,z=s.am(_.center.lng),V=s.at(_.center.lat),U=(f.x+.5)/B-z;let q=0;U>.5?q=-1:U<-.5&&(q=1);let Y=(r/s.ab+f.x)/B+q,J=(a/s.ab+f.y)/B;Y=(Y-z)*_._pixelsPerMercatorPixel+z,J=(J-V)*_._pixelsPerMercatorPixel+V;const ee=[Y*_.worldSize,J*_.worldSize,0];s.a6.vec3.transformMat4(ee,ee,w),M=s.b7(M,ee,k)}return s.a6.vec3.transformMat4(M,M,v)}_makeGlobeTileDebugBorderBuffer(r,a,f,_,v,w){const k=new s.a_,M=new s.a$,B=new s.b8,z=(U,q,Y,J,ee)=>{const re=(Y-U)/(ee-1),he=(J-q)/(ee-1),pe=k.length;for(let ce=0;ce<ee;ce++){const ye=U+ce*re,ge=q+ce*he;k.emplaceBack(ye,ge);const Ae=this._globePoint(ye,ge,a,f,_,v,w);B.emplaceBack(Ae[0],Ae[1],Ae[2]),M.emplaceBack(pe+ce)}},V=s.ab;z(0,0,V,0,16),z(V,0,V,V,16),z(V,V,0,V,16),z(0,V,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(M),this._tileDebugBuffer=r.createVertexBuffer(k,s.b0.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(B,s.b9.members),this._tileDebugSegments=s.b1.simpleSegment(0,0,k.length,M.length)}_makeGlobeTileDebugTextBuffer(r,a,f,_,v,w){const k=s.ab/4,M=new s.a_,B=new s.aO,z=new s.b8,V=25;B.reserve(32),M.reserve(V),z.reserve(V);const U=(q,Y)=>V*q+Y;for(let q=0;q<V;q++){const Y=q*k;for(let J=0;J<V;J++){const ee=J*k;M.emplaceBack(ee,Y);const re=this._globePoint(ee,Y,a,f,_,v,w);z.emplaceBack(re[0],re[1],re[2])}}for(let q=0;q<4;q++)for(let Y=0;Y<4;Y++){const J=U(q,Y),ee=U(q,Y+1),re=U(q+1,Y),he=U(q+1,Y+1);B.emplaceBack(J,ee,re),B.emplaceBack(re,ee,he)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(B),this._tileDebugTextBuffer=r.createVertexBuffer(M,s.b0.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(z,s.b9.members),this._tileDebugTextSegments=s.b1.simpleSegment(0,0,V,32)}destroy(r=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.ba.setPbf(s.bb);class $n extends jo{constructor(r,a,f,_,v){super(r,a,f,_,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(r,a){const f=a.context,_=f.gl;this.texture=this.texture||a.getTileTexture(r.width),this.texture&&this.texture instanceof s.T?this.texture.update(r,{premultiply:!1}):this.texture=new s.T(f,r,_.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(r=16384,a){const f=this._mrt=new s.ba(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=s.bc(_,(v,w,k,M)=>{if(v)a(v);else try{const B=f.getHeaderLength(w);if(B>r)return void(this.request=this.fetchHeader(B,a));f.parseHeader(w),this._isHeaderLoaded=!0;let z=0;for(const V of Object.values(f.layers))z=Math.max(z,V.dataIndex[V.dataIndex.length-1].last_byte);w.byteLength>=z&&(this.entireBuffer=w),a(null,this.entireBuffer||w,k,M)}catch(B){a(B)}}),this.request}fetchBand(r,a,f){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void f(new Error("Tile header is not ready"));const v=this.actor;if(!v)return void f(new Error("Can't fetch tile band without an actor"));let w;const k=(V,U)=>{w.complete(V,U),V?f(V):(this.updateTextureDescriptor(r,a),f(null,this.textureDescriptor&&this.textureDescriptor.img))},M=(V,U)=>{if(V)return f(V);const q=v.send("decodeRasterArray",{buffer:U,task:w},k,void 0,!0);this._workQueue.push(()=>{q&&q.cancel(),w.cancel()})},B=_.getLayer(r);if(!B)return void f(new Error(`Unknown sourceLayer "${r}"`));if(B.hasDataForBand(a))return this.updateTextureDescriptor(r,a),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);const z=B.getDataRange([a]);if(w=_.createDecodingTask(z),!w||w.tasks.length)if(this.flushQueues(),this.entireBuffer)M(null,this.entireBuffer.slice(z.firstByte,z.lastByte+1));else{const V=Object.assign({},this.requestParams,{headers:{Range:`bytes=${z.firstByte}-${z.lastByte}`}}),U=s.bc(V,M);this._fetchQueue.push(()=>{U.cancel(),w.cancel()})}else f(null)}updateNeeded(r,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==r)&&this.state!=="errored"}updateTextureDescriptor(r,a){if(!this._mrt)return;const f=this._mrt.getLayer(r);if(!f||!f.hasBand(a)||!f.hasDataForBand(a))return;const{bytes:_,tileSize:v,buffer:w,offset:k,scale:M}=f.getBandView(a),B=v+2*w,z={data:_,width:B,height:B},V=this.texture;V&&V instanceof s.T&&V.update(z,{premultiply:!1}),this.textureDescriptor={layer:r,band:a,img:z,buffer:w,offset:k,tileSize:v,format:f.pixelFormat,mix:[M,256*M,65536*M,16777216*M]}}}class qs{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,f){const _=r.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const v={value:a,timeout:void 0};if(f!==void 0&&(v.timeout=setTimeout(()=>{this.remove(r,v)},f)),this.data[_].push(v),this.order.push(_),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const f=r.wrapped().key,_=a===void 0?0:this.data[f].indexOf(a),v=this.data[f][_];return this.data[f].splice(_,1),v.timeout&&clearTimeout(v.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(v.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const f in this.data)for(const _ of this.data[f])r(_.value)||a.push(_);for(const f of a)this.remove(f.value.tileID,f)}}class sl{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,f){const _=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][_]=this.stateChanges[r][_]||{},s.l(this.stateChanges[r][_],f),this.deletedStates[r]===null){this.deletedStates[r]={};for(const v in this.state[r])v!==_&&(this.deletedStates[r][v]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][_]===null){this.deletedStates[r][_]={};for(const v in this.state[r][_])f[v]||(this.deletedStates[r][_][v]=null)}else for(const v in f)this.deletedStates[r]&&this.deletedStates[r][_]&&this.deletedStates[r][_][v]===null&&delete this.deletedStates[r][_][v]}removeFeatureState(r,a,f){if(this.deletedStates[r]===null)return;const _=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},f&&a!==void 0)this.deletedStates[r][_]!==null&&(this.deletedStates[r][_]=this.deletedStates[r][_]||{},this.deletedStates[r][_][f]=null);else if(a!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][_])for(f in this.deletedStates[r][_]={},this.stateChanges[r][_])this.deletedStates[r][_][f]=null;else this.deletedStates[r][_]=null;else this.deletedStates[r]=null}getState(r,a){const f=this.state[r]||{},_=this.stateChanges[r]||{},v=this.deletedStates[r];if(v===null)return{};if(a!==void 0){const k=String(a),M=s.l({},f[k],_[k]);if(v){const B=v[a];if(B===null)return{};for(const z in B)delete M[z]}return M}const w=s.l({},f,_);if(v)for(const k in v)delete w[k];return w}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const v={};for(const w in this.stateChanges[_])this.state[_][w]||(this.state[_][w]={}),s.l(this.state[_][w],this.stateChanges[_][w]),v[w]=this.state[_][w];f[_]=v}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const v={};if(this.deletedStates[_]===null)for(const w in this.state[_])v[w]={},this.state[_][w]={};else for(const w in this.deletedStates[_]){if(this.deletedStates[_][w]===null)this.state[_][w]={};else if(this.state[_][w])for(const k of Object.keys(this.deletedStates[_][w]))delete this.state[_][w][k];v[w]=this.state[_][w]}f[_]=f[_]||{},s.l(f[_],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const _ in r)r[_].setFeatureState(f,a)}}class $i extends s.E{constructor(r,a,f){super(),this.id=r,this._onlySymbols=f,a.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new qs(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new sl,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const a=this._tiles[r];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const f=this._tiles[a];f.upload(r),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return s.bd(this._tiles).map(r=>r.tileID).sort(Rs).map(r=>r.key)}getRenderableIds(r,a){const f=[];for(const _ in this._tiles)this._isIdRenderable(+_,r,a)&&f.push(this._tiles[_]);return r?f.sort((_,v)=>{const w=_.tileID,k=v.tileID,M=new s.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),B=new s.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-k.overscaledZ||B.y-M.y||B.x-M.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(Rs).map(_=>_.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a,f){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())&&(f||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){const f=this._tiles[r];f&&(f.state!=="loading"&&(f.state=a),this._loadTile(f,this._tileLoaded.bind(this,f,r,a)))}_tileLoaded(r,a,f,_){if(_)if(r.state="errored",_.status!==404)this._source.fire(new s.t(_,{tile:r}));else{if(this._source.fire(new s.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=s.q.now(),f==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new s.x("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const a=this.getRenderableIds();for(let _=0;_<a.length;_++){const v=a[_];if(r.neighboringTiles&&r.neighboringTiles[v]){const w=this.getTileByID(v);f(r,w),f(w,r)}}function f(_,v){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let w=v.tileID.canonical.x-_.tileID.canonical.x;const k=v.tileID.canonical.y-_.tileID.canonical.y,M=Math.pow(2,_.tileID.canonical.z),B=v.tileID.key;w===0&&k===0||Math.abs(k)>1||(Math.abs(w)>1&&(Math.abs(w+M)===1?w+=M:Math.abs(w-M)===1&&(w-=M)),v.dem&&_.dem&&(_.dem.backfillBorder(v.dem,w,k),_.neighboringTiles&&_.neighboringTiles[B]&&(_.neighboringTiles[B].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,f,_){for(const v in this._tiles){let w=this._tiles[v];if(_[v]||!w.hasData()||w.tileID.overscaledZ<=a||w.tileID.overscaledZ>f)continue;let k=w.tileID;for(;w&&w.tileID.overscaledZ>a+1;){const B=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[B.key],w&&w.hasData()&&(k=B)}let M=k;for(;M.overscaledZ>a;)if(M=M.scaledTo(M.overscaledZ-1),r[M.key]){_[k.key]=k;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const f=this._loadedParentTiles[r.key];return f&&f.tileID.overscaledZ>=a?f:null}for(let f=r.overscaledZ-1;f>=a;f--){const _=r.scaledTo(f),v=this._getLoadedTile(_);if(v)return v}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;const f=Math.ceil(r.width/a)+1,_=Math.ceil(r.height/a)+1,v=Math.floor(f*_*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(k)}handleWrapJump(r){const a=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,a){const f={};for(const _ in this._tiles){const v=this._tiles[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+a),f[v.tileID.key]=v}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(r,a,f,_){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(r,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let w;if(this.used||this.usedForTerrain){if(this._source.tileID)w=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new s.aA(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y));else if(this.tileCoverLift!==0){const B=r.clone();B.tileCoverLift=this.tileCoverLift,w=B.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&r.projection.name==="globe"&&(w.push(new s.aA(1,0,1,0,0)),w.push(new s.aA(1,0,1,1,0)),w.push(new s.aA(1,0,1,0,1)),w.push(new s.aA(1,0,1,1,1)))}else if(w=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);w=w.filter(z=>B(z))}}else w=[];if(w.length>0&&this.castsShadows&&_&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!za(this._source.type)){const B=r.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),z=Math.min(B,this._source.maxzoom);if(v){const V=r.extendTileCover(w,z);for(const U of V)w.push(U)}else{const V=r.extendTileCover(w,z,_);for(const U of V)this._shadowCasterTiles[U.key]=!0,w.push(U)}}const k=this._updateRetainedTiles(w);if(za(this._source.type)&&w.length!==0){const B={},z={},V=Object.keys(k);for(const q of V){const Y=k[q],J=this._tiles[q];if(!J||J.fadeEndTime&&J.fadeEndTime<=s.q.now())continue;const ee=this.findLoadedParent(Y,Math.max(Y.overscaledZ-$i.maxOverzooming,this._source.minzoom));ee&&(this._addTile(ee.tileID),B[ee.tileID.key]=ee.tileID),z[q]=Y}const U=w[w.length-1].overscaledZ;for(const q in this._tiles){const Y=this._tiles[q];if(k[q]||!Y.hasData())continue;let J=Y.tileID;for(;J.overscaledZ>U;){J=J.scaledTo(J.overscaledZ-1);const ee=this._tiles[J.key];if(ee&&ee.hasData()&&z[J.key]){k[q]=Y.tileID;break}}}for(const q in B)k[q]||(this._coveredTiles[q]=!0,k[q]=B[q])}for(const B in k)this._tiles[B].clearFadeHold();const M=s.be(this._tiles,k);for(const B of M){const z=this._tiles[B];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const a={};if(r.length===0)return a;const f={},_=r.reduce((B,z)=>Math.min(B,z.overscaledZ),1/0),v=r[0].overscaledZ,w=Math.max(v-$i.maxOverzooming,this._source.minzoom),k=Math.max(v+$i.maxUnderzooming,this._source.minzoom),M={};for(const B of r){const z=this._addTile(B);a[B.key]=B,z.hasData()||_<this._source.maxzoom&&(M[B.key]=B)}this._retainLoadedChildren(M,_,k,a);for(const B of r){let z=this._tiles[B.key];if(z.hasData())continue;if(B.canonical.z>=this._source.maxzoom){const U=B.children(this._source.maxzoom)[0],q=this.getTile(U);if(q&&q.hasData()){a[U.key]=U;continue}}else{const U=B.children(this._source.maxzoom);if(a[U[0].key]&&a[U[1].key]&&a[U[2].key]&&a[U[3].key])continue}let V=z.wasRequested();for(let U=B.overscaledZ-1;U>=w;--U){const q=B.scaledTo(U);if(f[q.key]||(f[q.key]=!0,z=this.getTile(q),!z&&V&&(z=this._addTile(q)),z&&(a[q.key]=q,V=z.wasRequested(),z.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let f,_=this._tiles[r].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}a.push(_.key);const v=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(v),f)break;_=v}for(const v of a)this._loadedParentTiles[v]=f}}_addTile(r){let a=this._tiles[r.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const f=!!a;if(!f){const _=this.map?this.map.painter:null,v=this._source.tileSize*r.overscaleFactor();a=this._source.type==="raster-array"?new $n(r,v,this.transform.tileZoom,_,this._isRaster):new jo(r,v,this.transform.tileZoom,_,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,f||this._source.fire(new s.x("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const f=a.getExpiryTimeout();f&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},f))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,a,f){const _=[],v=this.transform;if(!v)return _;const w=v.projection.name==="globe",k=s.am(v.center.lng);for(const M in this._tiles){const B=this._tiles[M];if(f&&B.clearQueryDebugViz(),B.holdingForFade())continue;let z;if(w){const V=B.tileID.canonical;if(V.z===0){const U=[Math.abs(s.ap(k,...Fa(V,-1))-k),Math.abs(s.ap(k,...Fa(V,1))-k)];z=[0,2*U.indexOf(Math.min(...U))-1]}else{const U=[Math.abs(s.ap(k,...Fa(V,-1))-k),Math.abs(s.ap(k,...Fa(V,0))-k),Math.abs(s.ap(k,...Fa(V,1))-k)];z=[U.indexOf(Math.min(...U))-1]}}else z=[0];for(const V of z){const U=r.containsTile(B,v,a,V);U&&_.push(U)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,a){const f=this.getRenderableIds(r,a).map(v=>this._tiles[v].tileID),_=this.transform.projection.name==="globe";for(const v of f)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=_?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return f}sortCoordinatesByDistance(r){const a=r.slice(),f=this.transform._camera.position,_=this.transform._camera.forward(),v={};for(const w of a){const k=1/(1<<w.canonical.z);v[w.key]=((w.canonical.x+.5)*k+w.wrap-f[0])*_[0]+((w.canonical.y+.5)*k-f[1])*_[1]-f[2]*_[2]}return a.sort((w,k)=>v[w.key]-v[k.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(za(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(r,a,f){this._state.updateState(r=r||"_geojsonTileLayer",a,f)}removeFeatureState(r,a,f){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,f)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,f){const _=this._tiles[r];_&&_.setDependencies(a,f)}reloadTilesForDependencies(r,a){for(const f in this._tiles)this._tiles[f].hasDependency(r,a)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(r,a))}_preloadTiles(r,a){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(r,a))};return void this._source.on("data",M)}const f=new Map,_=Array.isArray(r)?r:[r],v=this.map.painter.terrain,w=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const M of _){const B=M.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of B)f.set(z.key,z);this.usedForTerrain&&M.updateElevation(!1)}const k=Array.from(f.values());s.bf(k,(M,B)=>{const z=new jo(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(z,V=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),B(V,z)})},a)}}function Rs(d,r){const a=Math.abs(2*d.wrap)-+(d.wrap<0),f=Math.abs(2*r.wrap)-+(r.wrap<0);return d.overscaledZ-r.overscaledZ||f-a||r.canonical.y-d.canonical.y||r.canonical.x-d.canonical.x}function za(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function Fa(d,r){const a=1<<d.z;return[d.x/a+r,(d.x+1)/a+r]}$i.maxOverzooming=10,$i.maxUnderzooming=3;class Dl{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,a=!1;for(const f in this.style._mergedLayers){const _=this.style._mergedLayers[f];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:r,visibilityChanged:a});else if(_.type==="model"){const v=this.style.getLayerSource(_);v&&v.type==="batched-model"&&this.layers.push({layer:_,visible:r,visibilityChanged:a})}}}onNewFrame(r){this.layersGotHidden=!1;for(const a of this.layers){const f=a.layer;let _=!1;f.type==="fill-extrusion"?_=!f.isHidden(r)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(_=!f.isHidden(r)&&f.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!_&&a.visible,a.visible=_}}updateZOffset(r,a){this.currentBuildingBuckets=[];for(const _ of this.layers){const v=_.layer,w=this.style.getLayerSourceCache(v);let k=1;v.type==="fill-extrusion"&&(k=_.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let M=w?w.getTile(a):null;if(!M&&w&&a.canonical.z>w.getSource().minzoom){let B=a.scaledTo(Math.min(w.getSource().maxzoom,a.overscaledZ-1));for(;B.overscaledZ>=w.getSource().minzoom&&(M=w.getTile(B),!M&&B.overscaledZ!==0);)B=B.scaledTo(B.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:M?M.getBucket(v):null,tileID:M?M.tileID:a,verticalScale:k})}r.hasAnyZOffset=!1;let f=!1;for(let _=0;_<r.symbolInstances.length;_++){const v=r.symbolInstances.get(_),w=v.zOffset,k=this._getHeightAtTileOffset(a,v.tileAnchorX,v.tileAnchorY);v.zOffset=k!==Number.NEGATIVE_INFINITY?k:w,f||w===v.zOffset||(f=!0),r.hasAnyZOffset||v.zOffset===0||(r.hasAnyZOffset=!0)}f&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,a,f,_){let v=a,w=f;if(r.canonical.z!==_.canonical.z){const k=_.canonical,M=1/(1<<r.canonical.z-k.z);v=(a+r.canonical.x*s.ab)*M-k.x*s.ab|0,w=(f+r.canonical.y*s.ab)*M-k.y*s.ab|0}return{tileX:v,tileY:w}}_getHeightAtTileOffset(r,a,f){let _,v;for(let w=0;w<this.layers.length;++w){if(this.layers[w].layer.type!=="fill-extrusion")continue;const{bucket:k,tileID:M,verticalScale:B}=this.currentBuildingBuckets[w];if(!k)continue;const{tileX:z,tileY:V}=this._mapCoordToOverlappingTile(r,a,f,M),U=k.getHeightAtTileCoord(z,V);U&&U.height!==void 0&&(U.hidden?_=U.height:v=Math.max(U.height*B,v||0))}if(v!==void 0)return v;for(let w=0;w<this.layers.length;++w){const k=this.layers[w];if(k.layer.type!=="model"||!k.visible)continue;const{bucket:M,tileID:B}=this.currentBuildingBuckets[w];if(!M)continue;const{tileX:z,tileY:V}=this._mapCoordToOverlappingTile(r,a,f,B),U=M.getHeightAtTileCoord(z,V);if(U&&!U.hidden)return U.height===void 0&&_!==void 0?Math.min(U.maxHeight,_)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ga(d,r){const a={};for(const f in d)f!=="ref"&&(a[f]=d[f]);return s.bg.forEach(f=>{f in r&&(a[f]=r[f])}),a}function Ll(d){d=d.slice();const r=Object.create(null);for(let a=0;a<d.length;a++)r[d[a].id]=d[a];for(let a=0;a<d.length;a++)"ref"in d[a]&&(d[a]=ga(d[a],r[d[a].ref]));return d}const Gr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function $o(d,r,a){a.push({command:Gr.addSource,args:[d,r[d]]})}function an(d,r,a){r.push({command:Gr.removeSource,args:[d]}),a[d]=!0}function vo(d,r,a,f){an(d,a,f),$o(d,r,a)}function xr(d,r,a){let f;for(f in d[a])if(d[a].hasOwnProperty(f)&&f!=="data"&&!s.bh(d[a][f],r[a][f]))return!1;for(f in r[a])if(r[a].hasOwnProperty(f)&&f!=="data"&&!s.bh(d[a][f],r[a][f]))return!1;return!0}function cs(d,r,a,f,_,v){let w;for(w in r=r||{},d=d||{})d.hasOwnProperty(w)&&(s.bh(d[w],r[w])||a.push({command:v,args:[f,w,r[w],_]}));for(w in r)r.hasOwnProperty(w)&&!d.hasOwnProperty(w)&&(s.bh(d[w],r[w])||a.push({command:v,args:[f,w,r[w],_]}))}function Gs(d){return d.id}function _a(d,r){return d[r.id]=r,d}class us{constructor(r,a){this.reset(r,a)}reset(r,a){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=s.ap(r,0,1);let a=1,f=this._distances[a];const _=r*this.paddedLength+this.padding;for(;f<_&&a<this._distances.length;)f=this._distances[++a];const v=a-1,w=this._distances[v],k=f-w,M=k>0?(_-w)/k:0;return this.points[v].mult(1-M).add(this.points[a].mult(M))}}class qo{constructor(r,a,f){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(a/f);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=a,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,a,f,_,v){this._forEachCell(a,f,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(r,a,f,_){this._forEachCell(a-_,f-_,a+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(a),this.circles.push(f),this.circles.push(_)}_insertBoxCell(r,a,f,_,v,w){this.boxCells[v].push(w)}_insertCircleCell(r,a,f,_,v,w){this.circleCells[v].push(w)}_query(r,a,f,_,v,w){if(f<0||r>this.width||_<0||a>this.height)return!v&&[];const k=[];if(r<=0&&a<=0&&this.width<=f&&this.height<=_){if(v)return!0;for(let M=0;M<this.boxKeys.length;M++)k.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const B=this.circles[3*M],z=this.circles[3*M+1],V=this.circles[3*M+2];k.push({key:this.circleKeys[M],x1:B-V,y1:z-V,x2:B+V,y2:z+V})}return w?k.filter(w):k}return this._forEachCell(r,a,f,_,this._queryCell,k,{hitTest:v,seenUids:{box:{},circle:{}}},w),v?k.length>0:k}_queryCircle(r,a,f,_,v){const w=r-f,k=r+f,M=a-f,B=a+f;if(k<0||w>this.width||B<0||M>this.height)return!_&&[];const z=[];return this._forEachCell(w,M,k,B,this._queryCellCircle,z,{hitTest:_,circle:{x:r,y:a,radius:f},seenUids:{box:{},circle:{}}},v),_?z.length>0:z}query(r,a,f,_,v){return this._query(r,a,f,_,!1,v)}hitTest(r,a,f,_,v){return this._query(r,a,f,_,!0,v)}hitTestCircle(r,a,f,_){return this._queryCircle(r,a,f,!0,_)}_queryCell(r,a,f,_,v,w,k,M){const B=k.seenUids,z=this.boxCells[v];if(z!==null){const U=this.bboxes;for(const q of z)if(!B.box[q]){B.box[q]=!0;const Y=4*q;if(r<=U[Y+2]&&a<=U[Y+3]&&f>=U[Y+0]&&_>=U[Y+1]&&(!M||M(this.boxKeys[q]))){if(k.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[q],x1:U[Y],y1:U[Y+1],x2:U[Y+2],y2:U[Y+3]})}}}const V=this.circleCells[v];if(V!==null){const U=this.circles;for(const q of V)if(!B.circle[q]){B.circle[q]=!0;const Y=3*q;if(this._circleAndRectCollide(U[Y],U[Y+1],U[Y+2],r,a,f,_)&&(!M||M(this.circleKeys[q]))){if(k.hitTest)return w.push(!0),!0;{const J=U[Y],ee=U[Y+1],re=U[Y+2];w.push({key:this.circleKeys[q],x1:J-re,y1:ee-re,x2:J+re,y2:ee+re})}}}}}_queryCellCircle(r,a,f,_,v,w,k,M){const B=k.circle,z=k.seenUids,V=this.boxCells[v];if(V!==null){const q=this.bboxes;for(const Y of V)if(!z.box[Y]){z.box[Y]=!0;const J=4*Y;if(this._circleAndRectCollide(B.x,B.y,B.radius,q[J+0],q[J+1],q[J+2],q[J+3])&&(!M||M(this.boxKeys[Y])))return w.push(!0),!0}}const U=this.circleCells[v];if(U!==null){const q=this.circles;for(const Y of U)if(!z.circle[Y]){z.circle[Y]=!0;const J=3*Y;if(this._circlesCollide(q[J],q[J+1],q[J+2],B.x,B.y,B.radius)&&(!M||M(this.circleKeys[Y])))return w.push(!0),!0}}}_forEachCell(r,a,f,_,v,w,k,M){const B=this._convertToXCellCoord(r),z=this._convertToYCellCoord(a),V=this._convertToXCellCoord(f),U=this._convertToYCellCoord(_);for(let q=B;q<=V;q++)for(let Y=z;Y<=U;Y++)if(v.call(this,r,a,f,_,this.xCellCount*Y+q,w,k,M))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,a,f,_,v,w){const k=_-r,M=v-a,B=f+w;return B*B>k*k+M*M}_circleAndRectCollide(r,a,f,_,v,w,k){const M=(w-_)/2,B=Math.abs(r-(_+M));if(B>M+f)return!1;const z=(k-v)/2,V=Math.abs(a-(v+z));if(V>z+f)return!1;if(B<=M||V<=z)return!0;const U=B-M,q=V-z;return U*U+q*q<=f*f}}const Go={unknown:0,flipRequired:1,flipNotRequired:2},er=Math.tan(85*Math.PI/180);function Wr(d,r,a,f,_,v,w){const k=s.a6.mat4.create();if(a)if(v.name==="globe"){const M=s.bi(_,r);s.a6.mat4.multiply(k,k,M)}else{const M=s.a6.mat2.invert([],w);k[0]=M[0],k[1]=M[1],k[4]=M[2],k[5]=M[3],f||s.a6.mat4.rotateZ(k,k,_.angle)}else s.a6.mat4.multiply(k,_.labelPlaneMatrix,d);return k}function Kr(d,r,a,f,_,v,w){const k=Wr(d,r,a,f,_,v,w);return v.name==="globe"&&a||(k[2]=k[6]=k[10]=k[14]=0),k}function ro(d,r,a,f,_,v,w){if(a){if(v.name==="globe"){const k=Wr(d,r,a,f,_,v,w);return s.a6.mat4.invert(k,k),s.a6.mat4.multiply(k,d,k),k}{const k=s.a6.mat4.clone(d),M=s.a6.mat4.identity([]);return M[0]=w[0],M[1]=w[1],M[4]=w[2],M[5]=w[3],s.a6.mat4.multiply(k,k,M),f||s.a6.mat4.rotateZ(k,k,-_.angle),k}}return _.glCoordMatrix}function Ai(d,r,a,f){const _=[d,r,a,1];a?s.a6.vec4.transformMat4(_,_,f):Na(_,_,f);const v=_[3];return _[0]/=v,_[1]/=v,_[2]/=v,_}function Hr(d,r){return Math.min(.5+d/r*.5,1.5)}function al(d,r){const a=d[0]/d[3],f=d[1]/d[3];return a>=-r[0]&&a<=r[0]&&f>=-r[1]&&f<=r[1]}function Hs(d,r,a,f,_,v,w,k,M,B){const z=a.transform,V=f?d.textSizeData:d.iconSizeData,U=s.bj(V,a.transform.zoom),q=z.projection.name==="globe",Y=[256/a.width*2+1,256/a.height*2+1],J=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;J.clear();let ee=null;q&&(ee=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const re=d.lineVertexArray,he=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,pe=a.transform.width/a.transform.height;let ce,ye=!1;for(let ge=0;ge<he.length;ge++){const Ae=he.get(ge),{numGlyphs:Te,writingMode:Se}=Ae;if(Se!==s.bk.vertical||ye||ce===s.bk.horizontal||(ye=!0),ce=Se,(Ae.hidden||Se===s.bk.vertical)&&!ye){ho(Te,J);continue}ye=!1;const Oe=new s.P(Ae.tileAnchorX,Ae.tileAnchorY);let{x:ke,y:Re,z:Xe}=z.projection.projectTilePoint(Oe.x,Oe.y,B.canonical);if(M){const[yt,Tt,_r]=M(Oe);ke+=yt,Re+=Tt,Xe+=_r}const ht=[ke,Re,Xe,1];if(s.a6.vec4.transformMat4(ht,ht,r),!al(ht,Y)){ho(Te,J);continue}const bt=ht[3],ct=Hr(a.transform.getCameraToCenterDistance(z.projection),bt),Rt=s.bl(V,U,Ae),Ke=w?Rt/ct:Rt*ct,gt=Ai(ke,Re,Xe,_);if(gt[3]<=0){ho(Te,J);continue}let pt={};const Pt=w?null:M,Lt=ei(Ae,Ke,!1,k,r,_,v,d.glyphOffsetArray,re,J,ee,gt,Oe,pt,pe,Pt,z.projection,B,w);ye=Lt.useVertical,Pt&&Lt.needsFlipping&&(pt={}),(Lt.notEnoughRoom||ye||Lt.needsFlipping&&ei(Ae,Ke,!0,k,r,_,v,d.glyphOffsetArray,re,J,ee,gt,Oe,pt,pe,Pt,z.projection,B,w).notEnoughRoom)&&ho(Te,J)}f?(d.text.dynamicLayoutVertexBuffer.updateData(J),ee&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(ee)):(d.icon.dynamicLayoutVertexBuffer.updateData(J),ee&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(ee))}function Pn(d,r,a,f,_,v,w,k,M,B,z,V,U,q,Y,J){const{lineStartIndex:ee,glyphStartIndex:re,segment:he}=k,pe=re+k.numGlyphs,ce=ee+k.lineLength,ye=r.getoffsetX(re),ge=r.getoffsetX(pe-1),Ae=Zs(d*ye,a,f,_,v,w,he,ee,ce,M,B,z,V,U,!0,q,Y,J);if(!Ae)return null;const Te=Zs(d*ge,a,f,_,v,w,he,ee,ce,M,B,z,V,U,!0,q,Y,J);return Te?{first:Ae,last:Te}:null}function _i(d,r,a,f){return d===s.bk.horizontal&&Math.abs(f)>Math.abs(a)?{useVertical:!0}:d===s.bk.vertical?f>0?{needsFlipping:!0}:null:r!==Go.unknown&&function(_,v){return _===0||Math.abs(v/_)>er}(a,f)?r===Go.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function ei(d,r,a,f,_,v,w,k,M,B,z,V,U,q,Y,J,ee,re,he){const pe=r/24,ce=d.lineOffsetX*pe,ye=d.lineOffsetY*pe,{lineStartIndex:ge,glyphStartIndex:Ae,numGlyphs:Te,segment:Se,writingMode:Oe,flipState:ke}=d,Re=ge+d.lineLength,Xe=ht=>{if(z){const[Ke,gt,pt]=ht.up,Pt=B.length;s.bm(z,Pt+0,Ke,gt,pt),s.bm(z,Pt+1,Ke,gt,pt),s.bm(z,Pt+2,Ke,gt,pt),s.bm(z,Pt+3,Ke,gt,pt)}const[bt,ct,Rt]=ht.point;s.bn(B,bt,ct,Rt,ht.angle)};if(Te>1){const ht=Pn(pe,k,ce,ye,a,V,U,d,M,v,q,J,!1,ee,re,he);if(!ht)return{notEnoughRoom:!0};if(f&&!a){let[bt,ct,Rt]=ht.first.point,[Ke,gt,pt]=ht.last.point;[bt,ct]=Ai(bt,ct,Rt,w),[Ke,gt]=Ai(Ke,gt,pt,w);const Pt=_i(Oe,ke,(Ke-bt)*Y,gt-ct);if(d.flipState=Pt&&Pt.needsFlipping?Go.flipRequired:Go.flipNotRequired,Pt)return Pt}Xe(ht.first);for(let bt=Ae+1;bt<Ae+Te-1;bt++){const ct=Zs(pe*k.getoffsetX(bt),ce,ye,a,V,U,Se,ge,Re,M,v,q,J,!1,!1,ee,re,he);if(!ct)return B.length-=4*(bt-Ae),{notEnoughRoom:!0};Xe(ct)}Xe(ht.last)}else{if(f&&!a){const bt=Ai(U.x,U.y,0,_),ct=ge+Se+1,Rt=new s.P(M.getx(ct),M.gety(ct)),Ke=Ai(Rt.x,Rt.y,0,_),gt=Ke[3]>0?Ke:Ws(U,Rt,bt,1,_,void 0,ee,re.canonical),pt=_i(Oe,ke,(gt[0]-bt[0])*Y,gt[1]-bt[1]);if(d.flipState=pt&&pt.needsFlipping?Go.flipRequired:Go.flipNotRequired,pt)return pt}const ht=Zs(pe*k.getoffsetX(Ae),ce,ye,a,V,U,Se,ge,Re,M,v,q,J,!1,!1,ee,re,he);if(!ht)return{notEnoughRoom:!0};Xe(ht)}return{}}function dc(d,r,a,f,_){const{x:v,y:w,z:k}=f.projectTilePoint(d.x,d.y,r);if(!_)return Ai(v,w,k,a);const[M,B,z]=_(d);return Ai(v+M,w+B,k+z,a)}function Ws(d,r,a,f,_,v,w,k){const M=dc(d.sub(r)._unit()._add(d),k,_,w,v);return s.a6.vec3.sub(M,a,M),s.a6.vec3.normalize(M,M),s.a6.vec3.scaleAndAdd(M,a,M,f)}function Zs(d,r,a,f,_,v,w,k,M,B,z,V,U,q,Y,J,ee,re){const he=f?d-r:d+r;let pe=he>0?1:-1,ce=0;f&&(pe*=-1,ce=Math.PI),pe<0&&(ce+=Math.PI);let ye=k+w+(pe>0?0:1)|0,ge=_,Ae=_,Te=0,Se=0;const Oe=Math.abs(he),ke=[],Re=[];let Xe=v,ht=Xe;const bt=()=>Ws(ht,Xe,Ae,Oe-Te+1,z,U,J,ee.canonical);for(;Te+Se<=Oe;){if(ye+=pe,ye<k||ye>=M)return null;if(Ae=ge,ht=Xe,ke.push(Ae),q&&Re.push(ht),Xe=new s.P(B.getx(ye),B.gety(ye)),ge=V[ye],!ge){const Tt=dc(Xe,ee.canonical,z,J,U);ge=Tt[3]>0?V[ye]=Tt:bt()}Te+=Se,Se=s.a6.vec3.distance(Ae,ge)}Y&&U&&(V[ye]&&(ge=bt(),Se=s.a6.vec3.distance(Ae,ge)),V[ye]=ge);const ct=(Oe-Te)/Se,Rt=Xe.sub(ht)._mult(ct)._add(ht),Ke=s.a6.vec3.sub([],ge,Ae),gt=s.a6.vec3.scaleAndAdd([],Ae,Ke,ct);let pt=[0,0,1],Pt=Ke[0],Lt=Ke[1];if(re&&(pt=J.upVector(ee.canonical,Rt.x,Rt.y),pt[0]!==0||pt[1]!==0||pt[2]!==1)){const Tt=[pt[2],0,-pt[0]],_r=s.a6.vec3.cross([],pt,Tt);s.a6.vec3.normalize(Tt,Tt),s.a6.vec3.normalize(_r,_r),Pt=s.a6.vec3.dot(Ke,Tt),Lt=s.a6.vec3.dot(Ke,_r)}if(a){const Tt=s.a6.vec3.cross([],pt,Ke);s.a6.vec3.normalize(Tt,Tt),s.a6.vec3.scaleAndAdd(gt,gt,Tt,a*pe)}const yt=ce+Math.atan2(Lt,Pt);return ke.push(gt),q&&Re.push(Rt),{point:gt,angle:yt,path:ke,tilePath:Re,up:pt}}function ho(d,r){const a=r.length,f=a+4*d;r.resize(f),r.float32.fill(-1/0,4*a,4*f)}function Na(d,r,a){const f=r[0],_=r[1];return d[0]=a[0]*f+a[4]*_+a[12],d[1]=a[1]*f+a[5]*_+a[13],d[3]=a[3]*f+a[7]*_+a[15],d}const Si=100;class Xi{constructor(r,a,f=new qo(r.width+200,r.height+200,25),_=new qo(r.width+200,r.height+200,25)){this.transform=r,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Si,this.screenBottomBoundary=r.height+Si,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=a}placeCollisionBox(r,a,f,_,v,w,k,M){let B=f.projectedAnchorX,z=f.projectedAnchorY,V=f.projectedAnchorZ;const U=f.elevation,q=f.tileID,Y=r.getProjection();if(U&&q){const[ge,Ae,Te]=Y.upVector(q.canonical,f.tileAnchorX,f.tileAnchorY),Se=Y.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=ge*U*Se,z+=Ae*U*Se,V+=Te*U*Se}const J=this.projectAndGetPerspectiveRatio(k,B,z,V,f.tileID,Y.name==="globe"||!!U||this.transform.pitch>0,Y),ee=w*J.perspectiveRatio,re=(f.x1*a+_.x-f.padding)*ee+J.point.x,he=(f.y1*a+_.y-f.padding)*ee+J.point.y,pe=(f.x2*a+_.x+f.padding)*ee+J.point.x,ce=(f.y2*a+_.y+f.padding)*ee+J.point.y,ye=J.perspectiveRatio<=.55||J.occluded;return!this.isInsideGrid(re,he,pe,ce)||!v&&this.grid.hitTest(re,he,pe,ce,M)||ye?{box:[],offscreen:!1,occluded:J.occluded}:{box:[re,he,pe,ce],offscreen:this.isOffscreen(re,he,pe,ce),occluded:!1}}placeCollisionCircles(r,a,f,_,v,w,k,M,B,z,V,U,q,Y,J){const ee=[],re=this.transform.elevation,he=r.getProjection(),pe=re?re.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,he):null,ce=new s.P(f.tileAnchorX,f.tileAnchorY);let{x:ye,y:ge,z:Ae}=he.projectTilePoint(ce.x,ce.y,J.canonical);if(pe){const[Rt,Ke,gt]=pe(ce);ye+=Rt,ge+=Ke,Ae+=gt}const Te=he.name==="globe",Se=this.projectAndGetPerspectiveRatio(k,ye,ge,Ae,J,Te||!!re||this.transform.pitch>0,he),{perspectiveRatio:Oe}=Se,ke=(V?w/Oe:w*Oe)/s.bq,Re=Ai(ye,ge,Ae,M),Xe=Se.signedDistanceFromCamera>0?Pn(ke,v,f.lineOffsetX*ke,f.lineOffsetY*ke,!1,Re,ce,f,_,M,{},re&&!V?pe:null,V&&!!re,he,J,V):null;let ht=!1,bt=!1,ct=!0;if(Xe&&!Se.occluded){const Rt=.5*q*Oe+Y,Ke=new s.P(-100,-100),gt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),pt=new us,{first:Pt,last:Lt}=Xe,yt=Pt.path.length;let Tt=[];for(let Qt=yt-1;Qt>=1;Qt--)Tt.push(Pt.path[Qt]);for(let Qt=1;Qt<Lt.path.length;Qt++)Tt.push(Lt.path[Qt]);const _r=2.5*Rt;B&&(Tt=Tt.map(([Qt,kr,ar],Tr)=>(pe&&!Te&&(ar=pe(Tr<yt-1?Pt.tilePath[yt-1-Tr]:Lt.tilePath[Tr-yt+2])[2]),Ai(Qt,kr,ar,B))),Tt.some(Qt=>Qt[3]<=0)&&(Tt=[]));let Nt=[];if(Tt.length>0){let Qt=1/0,kr=-1/0,ar=1/0,Tr=-1/0;for(const qr of Tt)Qt=Math.min(Qt,qr[0]),ar=Math.min(ar,qr[1]),kr=Math.max(kr,qr[0]),Tr=Math.max(Tr,qr[1]);kr>=Ke.x&&Qt<=gt.x&&Tr>=Ke.y&&ar<=gt.y&&(Nt=[Tt.map(qr=>new s.P(qr[0],qr[1]))],(Qt<Ke.x||kr>gt.x||ar<Ke.y||Tr>gt.y)&&(Nt=s.bo(Nt,Ke.x,Ke.y,gt.x,gt.y)))}for(const Qt of Nt){pt.reset(Qt,.25*Rt);let kr=0;kr=pt.length<=.5*Rt?1:Math.ceil(pt.paddedLength/_r)+1;for(let ar=0;ar<kr;ar++){const Tr=ar/Math.max(kr-1,1),qr=pt.lerp(Tr),Ur=qr.x+Si,kn=qr.y+Si;ee.push(Ur,kn,Rt,0);const zn=Ur-Rt,Xn=kn-Rt,ea=Ur+Rt,Li=kn+Rt;if(ct=ct&&this.isOffscreen(zn,Xn,ea,Li),bt=bt||this.isInsideGrid(zn,Xn,ea,Li),!a&&this.grid.hitTestCircle(Ur,kn,Rt,U)&&(ht=!0,!z))return{circles:[],offscreen:!1,collisionDetected:ht,occluded:!1}}}}return{circles:!z&&ht||!bt?[]:ee,offscreen:ct,collisionDetected:ht,occluded:Se.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let f=1/0,_=1/0,v=-1/0,w=-1/0;for(const z of r){const V=new s.P(z.x+Si,z.y+Si);f=Math.min(f,V.x),_=Math.min(_,V.y),v=Math.max(v,V.x),w=Math.max(w,V.y),a.push(V)}const k=this.grid.query(f,_,v,w).concat(this.ignoredGrid.query(f,_,v,w)),M={},B={};for(const z of k){const V=z.key;if(M[V.bucketInstanceId]===void 0&&(M[V.bucketInstanceId]={}),M[V.bucketInstanceId][V.featureIndex])continue;const U=[new s.P(z.x1,z.y1),new s.P(z.x2,z.y1),new s.P(z.x2,z.y2),new s.P(z.x1,z.y2)];s.bp(a,U)&&(M[V.bucketInstanceId][V.featureIndex]=!0,B[V.bucketInstanceId]===void 0&&(B[V.bucketInstanceId]=[]),B[V.bucketInstanceId].push(V.featureIndex))}return B}insertCollisionBox(r,a,f,_,v){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,a,f,_,v){const w=a?this.ignoredGrid:this.grid,k={bucketInstanceId:f,featureIndex:_,collisionGroupID:v};for(let M=0;M<r.length;M+=4)w.insertCircle(k,r[M],r[M+1],r[M+2])}projectAndGetPerspectiveRatio(r,a,f,_,v,w,k){const M=[a,f,_,1];let B=!1;_||this.transform.pitch>0?(s.a6.vec4.transformMat4(M,M,r),this.fogState&&v&&k.name!=="globe"&&(B=function(U,q,Y,J,ee,re){const he=re.calculateFogTileMatrix(ee),pe=[q,Y,J];return s.a6.vec3.transformMat4(pe,pe,he),Ht(U,s.a6.vec3.length(pe),re.pitch,re._fov)}(this.fogState,a,f,_,v.toUnwrapped(),this.transform)>.9)):Na(M,M,r);const z=M[3];return{point:new s.P((M[0]/z+1)/2*this.transform.width+Si,(-M[1]/z+1)/2*this.transform.height+Si),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/z*.5,1.5),signedDistanceFromCamera:z,occluded:w&&M[2]>z||B}}isOffscreen(r,a,f,_){return f<Si||r>=this.screenRightBoundary||_<Si||a>this.screenBottomBoundary}isInsideGrid(r,a,f,_){return f>=0&&r<this.gridRightBoundary&&_>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const r=s.a6.mat4.identity([]);return s.a6.mat4.translate(r,r,[-100,-100,0]),r}}function io(d,r,a){const f=r.createTileMatrix(d,d.worldSize,a.toUnwrapped());return s.a6.mat4.multiply(new Float32Array(16),d.projMatrix,f)}function ya(d,r,a){if(r.projection.name===a.projection.name)return d.projMatrix;const f=a.clone();return f.setProjection(r.projection),io(f,r.getProjection(),d)}function hs(d,r,a){return r.name===a.projection.name?d.projMatrix:io(a,r,d)}class ii{constructor(r,a,f,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?a:-a))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class qi{constructor(r,a,f,_,v,w=!1){this.text=new ii(r?r.text:null,a,f,v),this.icon=new ii(r?r.icon:null,a,_,v),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Lo{constructor(r,a,f,_=!1){this.text=r,this.icon=a,this.skipFade=f,this.clipped=_}}class yi{constructor(){this.invProjMatrix=s.a6.mat4.create(),this.viewportMatrix=s.a6.mat4.create(),this.circles=[]}}class fc{constructor(r,a,f,_,v){this.bucketInstanceId=r,this.featureIndex=a,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=v}}class Di{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const a=++this.maxGroupID;this.collisionGroups[r]={ID:a,predicate:f=>f.collisionGroupID===a}}return this.collisionGroups[r]}}function Ho(d,r,a,f,_){const{horizontalAlign:v,verticalAlign:w}=s.bx(d),k=-(v-.5)*r,M=-(w-.5)*a,B=s.bw(d,f);return new s.P(k+B[0]*_,M+B[1]*_)}function Xs(d,r,a,f,_){const v=new s.P(d,r);return a&&v._rotate(f?_:-_),v}class Ks{constructor(r,a,f,_,v,w){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Xi(this.transform,v),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Di(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,a,f,_){const v=f.getBucket(a),w=f.latestFeatureIndex;if(!v||!w||a.fqid!==v.layerIds[0])return;const k=v.layers[0].layout,M=v.layers[0].paint,B=f.collisionBoxArray,z=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),V=f.tileSize/s.ab,U=f.tileID.toUnwrapped();this.transform.setProjection(v.projection);const q=(Y=f.tileID,J=v.getProjection(),ee=this.transform,J.name===this.projection?ee.calculateProjMatrix(Y.toUnwrapped()):io(ee,J,Y));var Y,J,ee;const re=k.get("text-pitch-alignment")==="map",he=k.get("text-rotation-alignment")==="map";a.compileFilter();const pe=a.dynamicFilter(),ce=a.dynamicFilterNeedsFeature(),ye=this.transform.calculatePixelsToTileUnitsMatrix(f),ge=Kr(q,f.tileID.canonical,re,he,this.transform,v.getProjection(),ye);let Ae=null;if(re){const Oe=ro(q,f.tileID.canonical,re,he,this.transform,v.getProjection(),ye);Ae=s.a6.mat4.multiply([],this.transform.labelPlaneMatrix,Oe)}let Te=null;pe&&f.latestFeatureIndex&&(Te={unwrappedTileID:U,dynamicFilter:pe,dynamicFilterNeedsFeature:ce}),this.retainedQueryData[v.bucketInstanceId]=new fc(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,f.tileID);const Se={bucket:v,layout:k,paint:M,posMatrix:q,textLabelPlaneMatrix:ge,labelToScreenMatrix:Ae,clippingData:Te,scale:z,textPixelRatio:V,holdingForFade:f.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:s.bj(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.bj(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(_)for(const Oe of v.sortKeyRanges){const{sortKey:ke,symbolInstanceStart:Re,symbolInstanceEnd:Xe}=Oe;r.push({sortKey:ke,symbolInstanceStart:Re,symbolInstanceEnd:Xe,parameters:Se})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Se})}attemptAnchorPlacement(r,a,f,_,v,w,k,M,B,z,V,U,q,Y,J,ee,re,he){const{textOffset0:pe,textOffset1:ce,crossTileID:ye}=U,ge=[pe,ce],Ae=Ho(r,f,_,ge,v),Te=this.collisionIndex.placeCollisionBox(Y,v,a,Xs(Ae.x,Ae.y,w,k,this.transform.angle),V,M,B,z.predicate);if(ee){const Se=Y.getSymbolInstanceIconSize(he,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,Se,ee,Xs(Ae.x,Ae.y,w,k,this.transform.angle),V,M,B,z.predicate).box.length===0)return}if(Te.box.length>0){let Se;return this.prevPlacement&&this.prevPlacement.variableOffsets[ye]&&this.prevPlacement.placements[ye]&&this.prevPlacement.placements[ye].text&&(Se=this.prevPlacement.variableOffsets[ye].anchor),this.variableOffsets[ye]={textOffset:ge,width:f,height:_,anchor:r,textScale:v,prevAnchor:Se},this.markUsedJustification(Y,r,U,J),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,J,U),this.placedOrientations[ye]=J),{shift:Ae,placedGlyphBoxes:Te}}}placeLayerBucketPart(r,a,f,_){const{bucket:v,layout:w,paint:k,posMatrix:M,textLabelPlaneMatrix:B,labelToScreenMatrix:z,clippingData:V,textPixelRatio:U,holdingForFade:q,collisionBoxArray:Y,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:ee,collisionGroup:re,latestFeatureIndex:he}=r.parameters,pe=w.get("text-optional"),ce=w.get("icon-optional"),ye=w.get("text-allow-overlap"),ge=w.get("icon-allow-overlap"),Ae=w.get("text-rotation-alignment")==="map",Te=w.get("text-pitch-alignment")==="map",Se=w.get("symbol-z-elevate"),Oe=k.get("symbol-z-offset"),ke=k.get("symbol-elevation-reference")==="sea";this.transform.setProjection(v.projection);let Re=ye&&(ge||!v.hasIconData()||ce),Xe=ge&&(ye||!v.hasTextData()||pe);const ht=!Oe.isConstant();!v.collisionArrays&&Y&&v.deserializeCollisionBoxes(Y),f&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,Y);const bt=(ct,Rt,Ke)=>{const{crossTileID:gt,numVerticalGlyphVertices:pt}=ct;let Pt=null;if(V&&V.dynamicFilterNeedsFeature||ht){const jr=this.retainedQueryData[v.bucketInstanceId];Pt=he.loadFeature({featureIndex:ct.featureIndex,bucketIndex:jr.bucketIndex,sourceLayerIndex:jr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(V&&!(0,V.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Pt,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new s.P(ct.tileAnchorX,ct.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[gt]=new Lo(!1,!1,!1,!0),void a.add(gt);const Lt=Oe.evaluate(Pt,{});if(a.has(gt))return;if(q)return void(this.placements[gt]=new Lo(!1,!1,!1));let yt=!1,Tt=!1,_r=!0,Nt=!1,Qt=!1,kr=null,ar={box:null,offscreen:null,occluded:null},Tr={box:null,offscreen:null,occluded:null},qr=null,Ur=null,kn=null,zn=0,Xn=0,ea=0;Ke.textFeatureIndex?zn=Ke.textFeatureIndex:ct.useRuntimeCollisionCircles&&(zn=ct.featureIndex),Ke.verticalTextFeatureIndex&&(Xn=Ke.verticalTextFeatureIndex);const Li=jr=>{jr.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const fn=this.transform.elevation;jr.elevation=ke?Lt:Lt+(fn?fn.getAtTileOffset(jr.tileID,jr.tileAnchorX,jr.tileAnchorY):0),jr.elevation+=ct.zOffset},Qr=Ke.textBox;if(Qr){Li(Qr);const jr=Cn=>{let Ei=s.bk.horizontal;if(v.allowVerticalPlacement&&!Cn&&this.prevPlacement){const Oi=this.prevPlacement.placedOrientations[gt];Oi&&(this.placedOrientations[gt]=Oi,Ei=Oi,this.markUsedOrientation(v,Ei,ct))}return Ei},fn=(Cn,Ei)=>{if(v.allowVerticalPlacement&&pt>0&&Ke.verticalTextBox){for(const Oi of v.writingModes)if(Oi===s.bk.vertical?(ar=Ei(),Tr=ar):ar=Cn(),ar&&ar.box&&ar.box.length)break}else ar=Cn()};if(w.get("text-variable-anchor")){let Cn=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[gt]){const ln=this.prevPlacement.variableOffsets[gt];Cn.indexOf(ln.anchor)>0&&(Cn=Cn.filter(Ki=>Ki!==ln.anchor),Cn.unshift(ln.anchor))}const Ei=(ln,Ki,no)=>{const Yi=v.getSymbolInstanceTextSize(J,ct,this.transform.zoom,Rt),qn=(ln.x2-ln.x1)*Yi+2*ln.padding,Jo=(ln.y2-ln.y1)*Yi+2*ln.padding,Qo=ct.hasIconTextFit&&!ge?Ki:null;Qo&&Li(Qo);let ta={box:[],offscreen:!1,occluded:!1};const Ms=ye?2*Cn.length:Cn.length;for(let _s=0;_s<Ms;++_s){const ra=this.attemptAnchorPlacement(Cn[_s%Cn.length],ln,qn,Jo,Yi,Ae,Te,U,M,re,_s>=Cn.length,ct,Rt,v,no,Qo,J,ee);if(ra&&(ta=ra.placedGlyphBoxes,ta&&ta.box&&ta.box.length)){yt=!0,kr=ra.shift;break}}return ta};fn(()=>Ei(Qr,Ke.iconBox,s.bk.horizontal),()=>{const ln=Ke.verticalTextBox;return ln&&Li(ln),v.allowVerticalPlacement&&!(ar&&ar.box&&ar.box.length)&&pt>0&&ln?Ei(ln,Ke.verticalIconBox,s.bk.vertical):{box:null,offscreen:null,occluded:null}}),ar&&(yt=ar.box,_r=ar.offscreen,Nt=ar.occluded);const Oi=jr(!(!ar||!ar.box));if(!yt&&this.prevPlacement){const ln=this.prevPlacement.variableOffsets[gt];ln&&(this.variableOffsets[gt]=ln,this.markUsedJustification(v,ln.anchor,ct,Oi))}}else{const Cn=(Ei,Oi)=>{const ln=v.getSymbolInstanceTextSize(J,ct,this.transform.zoom,Rt),Ki=this.collisionIndex.placeCollisionBox(v,ln,Ei,new s.P(0,0),ye,U,M,re.predicate);return Ki&&Ki.box&&Ki.box.length&&(this.markUsedOrientation(v,Oi,ct),this.placedOrientations[gt]=Oi),Ki};fn(()=>Cn(Qr,s.bk.horizontal),()=>{const Ei=Ke.verticalTextBox;return v.allowVerticalPlacement&&pt>0&&Ei?(Li(Ei),Cn(Ei,s.bk.vertical)):{box:null,offscreen:null,occluded:null}}),jr(!!(ar&&ar.box&&ar.box.length))}}if(qr=ar,yt=qr&&qr.box&&qr.box.length>0,_r=qr&&qr.offscreen,Nt=qr&&qr.occluded,ct.useRuntimeCollisionCircles){const jr=v.text.placedSymbolArray.get(ct.centerJustifiedTextSymbolIndex>=0?ct.centerJustifiedTextSymbolIndex:ct.verticalPlacedTextSymbolIndex),fn=s.bl(v.textSizeData,J,jr),Cn=w.get("text-padding");Ur=this.collisionIndex.placeCollisionCircles(v,ye,jr,v.lineVertexArray,v.glyphOffsetArray,fn,M,B,z,f,Te,re.predicate,ct.collisionCircleDiameter*fn/s.bq,Cn,this.retainedQueryData[v.bucketInstanceId].tileID),yt=ye||Ur.circles.length>0&&!Ur.collisionDetected,_r=_r&&Ur.offscreen,Nt=Ur.occluded}if(Ke.iconFeatureIndex&&(ea=Ke.iconFeatureIndex),Ke.iconBox){const jr=fn=>{Li(fn);const Cn=ct.hasIconTextFit&&kr?Xs(kr.x,kr.y,Ae,Te,this.transform.angle):new s.P(0,0),Ei=v.getSymbolInstanceIconSize(ee,this.transform.zoom,ct.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,Ei,fn,Cn,ge,U,M,re.predicate)};Tr&&Tr.box&&Tr.box.length&&Ke.verticalIconBox?(kn=jr(Ke.verticalIconBox),Tt=kn.box.length>0):(kn=jr(Ke.iconBox),Tt=kn.box.length>0),_r=_r&&kn.offscreen,Qt=kn.occluded}const Ln=pe||ct.numHorizontalGlyphVertices===0&&pt===0,ai=ce||ct.numIconVertices===0;if(Ln||ai?ai?Ln||(Tt=Tt&&yt):yt=Tt&&yt:Tt=yt=Tt&&yt,yt&&qr&&qr.box&&this.collisionIndex.insertCollisionBox(qr.box,w.get("text-ignore-placement"),v.bucketInstanceId,Tr&&Tr.box&&Xn?Xn:zn,re.ID),Tt&&kn&&this.collisionIndex.insertCollisionBox(kn.box,w.get("icon-ignore-placement"),v.bucketInstanceId,ea,re.ID),Ur&&(yt&&this.collisionIndex.insertCollisionCircles(Ur.circles,w.get("text-ignore-placement"),v.bucketInstanceId,zn,re.ID),f)){const jr=v.bucketInstanceId;let fn=this.collisionCircleArrays[jr];fn===void 0&&(fn=this.collisionCircleArrays[jr]=new yi);for(let Cn=0;Cn<Ur.circles.length;Cn+=4)fn.circles.push(Ur.circles[Cn+0]),fn.circles.push(Ur.circles[Cn+1]),fn.circles.push(Ur.circles[Cn+2]),fn.circles.push(Ur.collisionDetected?1:0)}const Mn=v.projection.name!=="globe";Re=Re&&(Mn||!Nt),Xe=Xe&&(Mn||!Qt),this.placements[gt]=new Lo(yt||Re,Tt||Xe,_r||v.justReloaded),a.add(gt)};if(Se&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.updateZOffset()),v.sortFeaturesByY){const ct=v.getSortedSymbolIndexes(this.transform.angle);for(let Rt=ct.length-1;Rt>=0;--Rt){const Ke=ct[Rt];bt(v.symbolInstances.get(Ke),Ke,v.collisionArrays[Ke])}v.hasAnyZOffset&&s.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const ct=v.getSortedIndexesByZOffset();for(let Rt=0;Rt<ct.length;++Rt){const Ke=ct[Rt];bt(v.symbolInstances.get(Ke),Ke,v.collisionArrays[Ke])}}else for(let ct=r.symbolInstanceStart;ct<r.symbolInstanceEnd;ct++)bt(v.symbolInstances.get(ct),ct,v.collisionArrays[ct]);if(f&&v.bucketInstanceId in this.collisionCircleArrays){const ct=this.collisionCircleArrays[v.bucketInstanceId];s.a6.mat4.invert(ct.invProjMatrix,M),ct.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(r,a,f,_){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:M,crossTileID:B}=f,z=s.bv(a),V=_===s.bk.vertical?M:z==="left"?v:z==="center"?w:z==="right"?k:-1;v>=0&&(r.text.placedSymbolArray.get(v).crossTileID=V>=0&&v!==V?0:B),w>=0&&(r.text.placedSymbolArray.get(w).crossTileID=V>=0&&w!==V?0:B),k>=0&&(r.text.placedSymbolArray.get(k).crossTileID=V>=0&&k!==V?0:B),M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=V>=0&&M!==V?0:B)}markUsedOrientation(r,a,f){const _=a===s.bk.horizontal||a===s.bk.horizontalOnly?a:0,v=a===s.bk.vertical?a:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:B}=f,z=r.text.placedSymbolArray;w>=0&&(z.get(w).placedOrientation=_),k>=0&&(z.get(k).placedOrientation=_),M>=0&&(z.get(M).placedOrientation=_),B>=0&&(z.get(B).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let f=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const _=a?a.symbolFadeChange(r):1,v=a?a.opacities:{},w=a?a.variableOffsets:{},k=a?a.placedOrientations:{};for(const M in this.placements){const B=this.placements[M],z=v[M];z?(this.opacities[M]=new qi(z,_,B.text,B.icon,null,B.clipped),f=f||B.text!==z.text.placed||B.icon!==z.icon.placed):(this.opacities[M]=new qi(null,_,B.text,B.icon,B.skipFade,B.clipped),f=f||B.text||B.icon)}for(const M in v){const B=v[M];if(!this.opacities[M]){const z=new qi(B,_,!1,!1);z.isHidden()||(this.opacities[M]=z,f=f||B.text.placed||B.icon.placed)}}for(const M in w)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=w[M]);for(const M in k)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=k[M]);f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:r)}updateLayerOpacities(r,a,f,_){const v=new Set;for(const w of a){const k=w.getBucket(r);k&&w.latestFeatureIndex&&r.fqid===k.layerIds[0]&&(this.updateBucketOpacities(k,v,w,w.collisionBoxArray,f,_,w.tileID,r.scope),k.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(k,w.tileID),k.updateZOffset()))}}updateBucketOpacities(r,a,f,_,v,w,k,M){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const B=r.layers[0].layout,z=r.layers[0].paint,V=!!r.layers[0].dynamicFilter(),U=new qi(null,0,!1,!1,!0),q=B.get("text-allow-overlap"),Y=B.get("icon-allow-overlap"),J=B.get("text-variable-anchor"),ee=B.get("text-rotation-alignment")==="map",re=B.get("text-pitch-alignment")==="map",he=z.get("symbol-z-offset"),pe=z.get("symbol-elevation-reference")==="sea",ce=!he.isConstant(),ye=new qi(null,0,q&&(Y||!r.hasIconData()||B.get("icon-optional")),Y&&(q||!r.hasTextData()||B.get("text-optional")),!0);!r.collisionArrays&&_&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(_);const ge=(Te,Se,Oe)=>{for(let ke=0;ke<Se/4;ke++)Te.opacityVertexArray.emplaceBack(Oe)};let Ae=0;w&&r.updateReplacement(k,w);for(let Te=0;Te<r.symbolInstances.length;Te++){const Se=r.symbolInstances.get(Te),{numHorizontalGlyphVertices:Oe,numVerticalGlyphVertices:ke,crossTileID:Re,numIconVertices:Xe,tileAnchorX:ht,tileAnchorY:bt}=Se;let ct=null;if(Se&&ce){const Nt=this.retainedQueryData[r.bucketInstanceId];ct=f.latestFeatureIndex.loadFeature({featureIndex:Se.featureIndex,bucketIndex:Nt.bucketIndex,sourceLayerIndex:Nt.sourceLayerIndex,layoutVertexArrayOffset:0})}const Rt=he.evaluate(ct,{}),Ke=a.has(Re);let gt=this.opacities[Re];Ke?gt=U:gt||(gt=ye,this.opacities[Re]=gt),a.add(Re);const pt=Oe>0||ke>0,Pt=Xe>0,Lt=this.placedOrientations[Re],yt=Lt===s.bk.vertical,Tt=Lt===s.bk.horizontal||Lt===s.bk.horizontalOnly;!pt&&!Pt||gt.isHidden()||Ae++;let _r=!1;if((pt||Pt)&&w)for(const Nt of r.activeReplacements){if(s.br(Nt,v,s.bs.Symbol,M)||Nt.min.x>ht||ht>Nt.max.x||Nt.min.y>bt||bt>Nt.max.y)continue;const Qt=s.bt(ht,bt,k.canonical,Nt.footprintTileId.canonical);if(_r=s.bu(Qt,Nt.footprint),_r)break}if(pt){const Nt=_r?Js:Ys(gt.text);ge(r.text,Oe,yt?Js:Nt),ge(r.text,ke,Tt?Js:Nt);const Qt=gt.text.isHidden(),{leftJustifiedTextSymbolIndex:kr,centerJustifiedTextSymbolIndex:ar,rightJustifiedTextSymbolIndex:Tr,verticalPlacedTextSymbolIndex:qr}=Se,Ur=r.text.placedSymbolArray,kn=Qt||yt?1:0;kr>=0&&(Ur.get(kr).hidden=kn),ar>=0&&(Ur.get(ar).hidden=kn),Tr>=0&&(Ur.get(Tr).hidden=kn),qr>=0&&(Ur.get(qr).hidden=Qt||Tt?1:0);const zn=this.variableOffsets[Re];zn&&this.markUsedJustification(r,zn.anchor,Se,Lt);const Xn=this.placedOrientations[Re];Xn&&(this.markUsedJustification(r,"left",Se,Xn),this.markUsedOrientation(r,Xn,Se))}if(Pt){const Nt=_r?Js:Ys(gt.icon),{placedIconSymbolIndex:Qt,verticalPlacedIconSymbolIndex:kr}=Se,ar=r.icon.placedSymbolArray,Tr=gt.icon.isHidden()?1:0;Qt>=0&&(ge(r.icon,Xe,yt?Js:Nt),ar.get(Qt).hidden=Tr),kr>=0&&(ge(r.icon,Se.numVerticalIconVertices,Tt?Js:Nt),ar.get(kr).hidden=Tr)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Nt=r.collisionArrays[Te];if(Nt){let Qt=new s.P(0,0),kr=!0;if(Nt.textBox||Nt.verticalTextBox){if(J){const Tr=this.variableOffsets[Re];Tr?(Qt=Ho(Tr.anchor,Tr.width,Tr.height,Tr.textOffset,Tr.textScale),ee&&Qt._rotate(re?this.transform.angle:-this.transform.angle)):kr=!1}V&&(kr=!gt.clipped),Nt.textBox&&Va(r.textCollisionBox.collisionVertexArray,gt.text.placed,!kr||yt,Rt,pe,Qt.x,Qt.y),Nt.verticalTextBox&&Va(r.textCollisionBox.collisionVertexArray,gt.text.placed,!kr||Tt,Rt,pe,Qt.x,Qt.y)}const ar=kr&&!!(!Tt&&Nt.verticalIconBox);Nt.iconBox&&Va(r.iconCollisionBox.collisionVertexArray,gt.icon.placed,ar,Rt,pe,Se.hasIconTextFit?Qt.x:0,Se.hasIconTextFit?Qt.y:0),Nt.verticalIconBox&&Va(r.iconCollisionBox.collisionVertexArray,gt.icon.placed,!ar,Rt,pe,Se.hasIconTextFit?Qt.x:0,Se.hasIconTextFit?Qt.y:0)}}}if(r.fullyClipped=Ae===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Te.invProjMatrix,r.placementViewportMatrix=Te.viewportMatrix,r.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,a){const f=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function Va(d,r,a,f,_,v,w){d.emplaceBack(r?1:0,a?1:0,v||0,w||0,f,_?1:0),d.emplaceBack(r?1:0,a?1:0,v||0,w||0,f,_?1:0),d.emplaceBack(r?1:0,a?1:0,v||0,w||0,f,_?1:0),d.emplaceBack(r?1:0,a?1:0,v||0,w||0,f,_?1:0)}const Wo=Math.pow(2,25),Kc=Math.pow(2,24),ll=Math.pow(2,17),oo=Math.pow(2,16),Yc=Math.pow(2,9),Oo=Math.pow(2,8),Ua=Math.pow(2,1);function Ys(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const r=d.placed?1:0,a=Math.floor(127*d.opacity);return a*Wo+r*Kc+a*ll+r*oo+a*Yc+r*Oo+a*Ua+r}const Js=0;class ja{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,a,f,_,v){const w=this._bucketParts;for(;this._currentTileIndex<r.length;)if(a.getBucketParts(w,_,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((k,M)=>k.sortKey-M.sortKey));this._currentPartIndex<w.length;){const k=w[this._currentPartIndex];if(a.placeLayerBucketPart(k,this._seenCrossTileIDs,f,k.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class ds{constructor(r,a,f,_,v,w,k,M,B){this.placement=new Ks(r,v,w,k,M,B),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,a,f,_){const v=s.q.now(),w=()=>{const k=s.q.now()-v;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){const k=a[r[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=M)&&(!k.maxzoom||k.maxzoom>M)){const B=k,z=B.layout.get("symbol-z-elevate"),V=B.layout.get("symbol-sort-key").constantOr(1)!==void 0,U=B.layout.get("symbol-z-order"),q=U==="viewport-y"||U==="auto"&&!(U!=="viewport-y"&&V),Y=B.layout.get("text-allow-overlap")||B.layout.get("icon-allow-overlap")||B.layout.get("text-ignore-placement")||B.layout.get("icon-ignore-placement"),J=q&&Y,ee=this._inProgressLayer=this._inProgressLayer||new ja(B),re=s.av(k.source,k.scope);if(ee.continuePlacement(z||J?_[re]:f[re],this.placement,this._showCollisionBoxes,k,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const zi=512/s.ab/2;class Jc{constructor(r,a,f){this.tileID=r,this.bucketInstanceId=f,this.index=new s.by(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=r.canonical.x*s.ab,v=r.canonical.y*s.ab;for(let w=0;w<a.length;w++){const{key:k,crossTileID:M,tileAnchorX:B,tileAnchorY:z}=a.get(w),V=Math.floor((_+B)*zi),U=Math.floor((v+z)*zi);this.index.add(V,U),this.keys.push(k),this.crossTileIDs.push(M)}this.index.finish()}findMatches(r,a,f){const _=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),v=zi/Math.pow(2,a.canonical.z-this.tileID.canonical.z),w=a.canonical.x*s.ab,k=a.canonical.y*s.ab;for(let M=0;M<r.length;M++){const B=r.get(M);if(B.crossTileID)continue;const{key:z,tileAnchorX:V,tileAnchorY:U}=B,q=Math.floor((w+V)*v),Y=Math.floor((k+U)*v),J=this.index.range(q-_,Y-_,q+_,Y+_);for(const ee of J){const re=this.crossTileIDs[ee];if(this.keys[ee]===z&&!f.has(re)){f.add(re),B.crossTileID=re;break}}}}}class va{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const a=Math.round((r-this.lng)/360);if(a!==0)for(const f in this.indexes){const _=this.indexes[f],v={};for(const w in _){const k=_[w];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+a),v[k.tileID.key]=k}this.indexes[f]=v}this.lng=r}addBucket(r,a,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const _=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>r.overscaledZ)for(const k in w){const M=w[k];M.tileID.isChildOf(r)&&M.findMatches(a.symbolInstances,r,_)}else{const k=w[r.scaledTo(Number(v)).key];k&&k.findMatches(a.symbolInstances,r,_)}}for(let v=0;v<a.symbolInstances.length;v++){const w=a.symbolInstances.get(v);w.crossTileID||(w.crossTileID=f.generate(),_.add(w.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Jc(r,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(r,a){for(const f of a.crossTileIDs)this.usedCrossTileIDs[r].delete(f)}removeStaleBuckets(r){let a=!1;for(const f in this.indexes){const _=this.indexes[f];for(const v in _)r[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[v]),delete _[v],a=!0)}return a}}class D{constructor(){this.layerIndexes={},this.crossTileIDs=new va,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,a,f,_){let v=this.layerIndexes[r.fqid];v===void 0&&(v=this.layerIndexes[r.fqid]=new bo);let w=!1;const k={};_.name!=="globe"&&v.handleWrapJump(f);for(const M of a){const B=M.getBucket(r);B&&r.fqid===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(M.tileID,B,this.crossTileIDs)&&(w=!0),k[B.bucketInstanceId]=!0)}return v.removeStaleBuckets(k)&&(w=!0),w}pruneUnusedLayers(r){const a={};r.forEach(f=>{a[f]=!0});for(const f in this.layerIndexes)a[f]||delete this.layerIndexes[f]}}const X=771;class te{constructor(r,a,f,_){this.blendFunction=r,this.blendColor=a,this.mask=f,this.blendEquation=_}}te.Replace=[1,0,1,0],te.disabled=new te(te.Replace,s.bz.transparent,[!1,!1,!1,!1]),te.unblended=new te(te.Replace,s.bz.transparent,[!0,!0,!0,!0]),te.alphaBlended=new te([1,X,1,X],s.bz.transparent,[!0,!0,!0,!0]),te.alphaBlendedNonPremultiplied=new te([770,X,770,X],s.bz.transparent,[!0,!0,!0,!0]),te.multiply=new te([774,0,774,0],s.bz.transparent,[!0,!0,!0,!0]);class fe{constructor(r,a,f){this.func=r,this.mask=a,this.range=f}}fe.ReadOnly=!1,fe.ReadWrite=!0,fe.disabled=new fe(519,fe.ReadOnly,[0,1]);const _t=7680;class st{constructor(r,a,f,_,v,w){this.test=r,this.ref=a,this.mask=f,this.fail=_,this.depthFail=v,this.pass=w}}st.disabled=new st({func:519,mask:0},0,0,_t,_t,_t);const ur=1029,Tn=2305;class cr{constructor(r,a,f){this.enable=r,this.mode=a,this.frontFace=f}}function Sn(d,r){const a=s.bC(d,3);s.a6.mat4.fromQuat(d,r),s.bE(d,3,a)}function Fi(d,r){const a=s.a6.quat.identity([]);return s.a6.quat.rotateZ(a,a,-r),s.a6.quat.rotateX(a,a,-d),a}function Gi(d,r){const a=[d[0],d[1],0],f=[r[0],r[1],0];if(s.a6.vec3.length(a)>=1e-15){const w=s.a6.vec3.normalize([],a);s.a6.vec3.scale(f,w,s.a6.vec3.dot(f,w)),r[0]=f[0],r[1]=f[1]}const _=s.a6.vec3.cross([],r,d);if(s.a6.vec3.len(_)<1e-15)return null;const v=Math.atan2(-_[1],_[0]);return Fi(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}cr.disabled=new cr(!1,ur,Tn),cr.backCCW=new cr(!0,ur,Tn),cr.backCW=new cr(!0,ur,2304),cr.frontCW=new cr(!0,1028,2304),cr.frontCCW=new cr(!0,1028,Tn);class xo{constructor(r,a){this.position=r,this.orientation=a}get position(){return this._position}set position(r){if(r){const a=r instanceof s.a5?r:new s.a5(r[0],r[1],r[2]);this._renderWorldCopies&&(a.x=s.bA(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(r,a){if(this.orientation=null,!this.position)return;const f=this.position,_=this._elevation?this._elevation.getAtPointOrZero(s.a5.fromLngLat(r)):0,v=s.a5.fromLngLat(r,_),w=[v.x-f.x,v.y-f.y,v.z-f.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Gi(w,a)}setPitchBearing(r,a){this.orientation=Fi(s.bB(r),s.bB(-a))}}class Ci{constructor(r,a){this._transform=s.a6.mat4.identity([]),this.orientation=a,this.position=r}get mercatorPosition(){const r=this.position;return new s.a5(r[0],r[1],r[2])}get position(){const r=s.bC(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var a;r&&s.bE(this._transform,3,[(a=r)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||s.a6.quat.identity([]),r&&Sn(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,a){this._orientation=Fi(r,a),Sn(this._transform,this._orientation)}forward(){const r=s.bC(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=s.bC(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=s.bC(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,a){const f=new Float64Array(16);return s.a6.mat4.invert(f,this.getWorldToCamera(r,a)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,a,f){const _=this.position;s.a6.vec3.scale(_,_,-r);const v=new Float64Array(16);return s.a6.mat4.fromScaling(v,[f,f,f]),s.a6.mat4.translate(v,v,_),v[10]*=a,v}getWorldToCamera(r,a){const f=new Float64Array(16),_=new Float64Array(4),v=this.position;return s.a6.quat.conjugate(_,this._orientation),s.a6.vec3.scale(v,v,-r),s.a6.mat4.fromQuat(f,_),s.a6.mat4.translate(f,f,v),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=a,f[9]*=a,f[10]*=a,f[11]*=a,f}getCameraToClipPerspective(r,a,f,_){const v=new Float64Array(16);return s.a6.mat4.perspective(v,r,a,f,_),v}getCameraToClipOrthographic(r,a,f,_,v,w){const k=new Float64Array(16);return s.a6.mat4.ortho(k,r,a,f,_,v,w),k}getDistanceToElevation(r,a=!1){const f=r===0?0:s.bD(r,a?s.aM(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new Ci([...this.position],[...this.orientation])}}const ti={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class $a{constructor(r=0,a=0,f=0,_=0){if(isNaN(r)||r<0||isNaN(a)||a<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=a,this.left=f,this.right=_}interpolate(r,a,f){return a.top!=null&&r.top!=null&&(this.top=s.aa(r.top,a.top,f)),a.bottom!=null&&r.bottom!=null&&(this.bottom=s.aa(r.bottom,a.bottom,f)),a.left!=null&&r.left!=null&&(this.left=s.aa(r.left,a.left,f)),a.right!=null&&r.right!=null&&(this.right=s.aa(r.right,a.right,f)),this}getCenter(r,a){const f=s.ap((this.left+r-this.right)/2,0,r),_=s.ap((this.top+a-this.bottom)/2,0,a);return new s.P(f,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new $a(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ol=(d,r,a)=>(1-a)*d+a*r,Bl=d=>d*d*d*d*d;class Qc{constructor(r,a,f,_,v,w,k){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=r||0,this._maxZoom=a||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(w),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new s.bK(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new $a,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ci,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const r=new Qc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,a=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(r||f)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return s.ar(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.bL(this.projectionOptions);const f=this.getProjection(),_=!s.bh(a,f);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bL({name:"mercator"});const a=r!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bD(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bA(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const a=-r*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=s.a6.mat2.create(),s.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const a=s.ap(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=s.bB(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const a=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let _=0,v=0;for(let w=0;w<a.length;w++){const k=new s.P(a[w][0]*this.width,f+a[w][1]*(this.height-f)),M=r.pointCoordinate(k);if(!M)continue;const B=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);_+=M[3]*B,v+=B}return v===0?NaN:_/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*a,_=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-f,v);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let f;f=r.z<this._camera.position[2]?[a.x,a.y,a.z]:[r.x,r.y,r.z];const _=s.a6.vec3.length(s.a6.vec3.sub([],this._camera.position,f));return s.ap(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let a=!1;if(r.orientation&&!s.a6.quat.exactEquals(r.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(r.orientation)),r.position){const f=[r.position.x,r.position.y,r.position.z];s.a6.vec3.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,a=new xo;return a.position=new s.a5(r[0],r[1],r[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(r){if(!s.a6.quat.length(r))return!1;s.a6.quat.normalize(r,r);const a=s.a6.vec3.transformQuat([],[0,0,-1],r),f=s.a6.vec3.transformQuat([],[0,-1,0],r);if(f[2]<0)return!1;const _=Gi(a,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const a=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=s.ap(r[2],_/f,_/a),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,a,f){this._unmodified=!1,this._edgeInsets.interpolate(r,a,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const a=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(r){const a=[new s.bM(0,r)];if(this.renderWorldCopies){const f=this.pointCoordinate(new s.P(0,0)),_=this.pointCoordinate(new s.P(this.width,0)),v=this.pointCoordinate(new s.P(this.width,this.height)),w=this.pointCoordinate(new s.P(0,this.height)),k=Math.floor(Math.min(f.x,_.x,v.x,w.x)),M=Math.floor(Math.max(f.x,_.x,v.x,w.x)),B=1;for(let z=k-B;z<=M+B;z++)z!==0&&a.push(new s.bM(z,r))}return a}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,a,f){let _=[];const v=f!==void 0,w=!v;if(w&&this.zoom<a||v&&f[0]===0&&f[1]===0)return _;const k=new Set,M=(z,V,U,q,Y)=>{const J=s.c1(V,z,U,q,Y);k.has(J)||(_.push(new s.aA(z,V,U,q,Y)),k.add(J))};for(let z=0;z<r.length;z++){const V=r[z];if(w&&V.canonical.z!==a)continue;const U=V.canonical,q=V.overscaledZ,Y=V.wrap,J=1<<U.z,ee=U.x+1<J,re=U.x>0,he=U.y+1<J,pe=U.y>0,ce=V.wrap-(re?0:1),ye=V.wrap+(ee?0:1),ge=re?U.x-1:J-1,Ae=ee?U.x+1:0;if(v)f[0]<0?(M(q,ye,U.z,Ae,U.y),f[1]<0&&he&&(M(q,Y,U.z,U.x,U.y+1),M(q,ye,U.z,Ae,U.y+1)),f[1]>0&&pe&&(M(q,Y,U.z,U.x,U.y-1),M(q,ye,U.z,Ae,U.y-1))):f[0]>0?(M(q,ce,U.z,ge,U.y),f[1]<0&&he&&(M(q,Y,U.z,U.x,U.y+1),M(q,ce,U.z,ge,U.y+1)),f[1]>0&&pe&&(M(q,Y,U.z,U.x,U.y-1),M(q,ce,U.z,ge,U.y-1))):f[1]<0&&he?M(q,Y,U.z,U.x,U.y+1):pe&&M(q,Y,U.z,U.x,U.y-1);else{const Te=V.visibleQuadrants;1&Te&&(M(q,ce,U.z,ge,U.y),pe&&(M(q,Y,U.z,U.x,U.y-1),M(q,ce,U.z,ge,U.y-1))),2&Te&&(M(q,ye,U.z,Ae,U.y),pe&&(M(q,Y,U.z,U.x,U.y-1),M(q,ye,U.z,Ae,U.y-1))),4&Te&&(M(q,ce,U.z,ge,U.y),he&&(M(q,Y,U.z,U.x,U.y+1),M(q,ce,U.z,ge,U.y+1))),8&Te&&(M(q,ye,U.z,Ae,U.y),he&&(M(q,Y,U.z,U.x,U.y+1),M(q,ye,U.z,Ae,U.y+1)))}}const B=[];for(const z of _)_.some(V=>z.isChildOf(V))||B.push(z);if(_=B.filter(z=>!r.some(V=>!!(z.overscaledZ<a&&V.isChildOf(z))||z.equals(V)||z.isChildOf(V))),w){const z=1<<a,V=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=[z*V.x,z*V.y],q=4,Y=q*q;_=_.filter(J=>{const ee=J.canonical.x+.5-U[0],re=J.canonical.y+.5-U[1];return ee*ee+re*re<Y})}return _}coveringTiles(r){let a=this.coveringZoomLevel(r);const f=a,_=this.elevation&&this.elevation.exaggeration(),v=_&&!r.isTerrainDEM,w=this.projection.name==="mercator";if(r.minzoom!==void 0&&a<r.minzoom)return[];r.maxzoom!==void 0&&a>r.maxzoom&&(a=r.maxzoom);const k=this.locationCoordinate(this.center),M=this.center.lat,B=1<<a,z=[B*k.x,B*k.y,0],V=this.projection.name==="globe",U=!V,q=s.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,U),Y=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=B*s.bD(1,this.center.lat),ee=this._camera.position[2]/s.bD(1,this.center.lat),re=[B*Y.x,B*Y.y,ee*(U?1:J)],he=V||_,pe=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ce=this.isLODDisabled(!0)?a:0;let ye;if(this._elevation&&r.isTerrainDEM)ye=1e4*this._elevation.exaggeration();else if(this._elevation){const Ke=this._elevation.getMinMaxForVisibleTiles();ye=Ke?Ke.max:this._centerAltitude}else ye=this._centerAltitude;const ge=r.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ae=this.projection.isReprojectedInTileSpace?s.bO(this):1,Te=Ke=>{const pt=new s.a5(Ke.x+25e-6,Ke.y,Ke.z),Pt=new s.a5(Ke.x,Ke.y+25e-6,Ke.z),Lt=Ke.toLngLat(),yt=pt.toLngLat(),Tt=Pt.toLngLat(),_r=this.locationCoordinate(Lt),Nt=this.locationCoordinate(yt),Qt=this.locationCoordinate(Tt),kr=Math.hypot(Nt.x-_r.x,Nt.y-_r.y),ar=Math.hypot(Qt.x-_r.x,Qt.y-_r.y);return Math.sqrt(kr*ar)*Ae/25e-6},Se=Ke=>{const gt=ye,pt=ge;return{aabb:s.bR(this,B,0,0,0,Ke,pt,gt,this.projection),zoom:0,x:0,y:0,minZ:pt,maxZ:gt,wrap:Ke,fullyVisible:!1}},Oe=[];let ke=[];const Re=a,Xe=r.reparseOverscaled?f:a,ht=(ee-this._centerAltitude)*J,bt=Ke=>{if(!this._elevation||!Ke.tileID||!w)return;const gt=this._elevation.getMinMaxForTile(Ke.tileID),pt=Ke.aabb;gt?(pt.min[2]=gt.min,pt.max[2]=gt.max,pt.center[2]=(pt.min[2]+pt.max[2])/2):(Ke.shouldSplit=Rt(Ke),Ke.shouldSplit||(pt.min[2]=pt.max[2]=pt.center[2]=this._centerAltitude))},ct=(Ke,gt)=>{if(.707*gt<Ke)return 1;const pt=gt/Ke;return pt/(1.4144271570014144+(Math.pow(1.1,pt-1.4144271570014144+1)-1)/(1.1-1)-1)},Rt=Ke=>{if(Ke.zoom<ce)return!0;if(Ke.zoom===Re)return!1;if(Ke.shouldSplit!=null)return Ke.shouldSplit;const gt=Ke.aabb.distanceX(re),pt=Ke.aabb.distanceY(re);let Pt=ht,Lt=1;if(V){Pt=Ke.aabb.distanceZ(re);const ar=Math.pow(2,Ke.zoom),Tr=s.aM((Ke.y+1)/ar),qr=s.aM(Ke.y/ar),Ur=Math.min(Math.max(M,Tr),qr),kn=s.c5(Ur)/s.c5(M);if(Lt=Ur===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,kn/this._mercatorScaleRatio),this.zoom<=s.c2&&Ke.zoom===Re-1&&kn>=.9)return!0}else if(v&&(Pt=Ke.aabb.distanceZ(re)*J),this.projection.isReprojectedInTileSpace&&f<=5){const ar=Math.pow(2,Ke.zoom),Tr=Te(new s.a5((Ke.x+.5)/ar,(Ke.y+.5)/ar));Lt=Tr>.85?1:Tr}if(!w){const ar=Math.sqrt(gt*gt+pt*pt+Pt*Pt);let Tr=(1<<Re-Ke.zoom)*pe*Lt;return Tr*=ct(Math.max(Pt,ht),ar),ar<Tr}let yt=Number.MAX_VALUE,Tt=0;const _r=Ke.aabb.getCorners(),Nt=[];for(const ar of _r){s.a6.vec3.sub(Nt,ar,re),V||(v?Nt[2]*=J:Nt[2]=ht);const Tr=s.a6.vec3.dot(Nt,this._camera.forward());Tr<yt&&(yt=Tr,Tt=Math.abs(Nt[2]))}let Qt=(1<<Re-Ke.zoom)*pe*Lt;if(Qt*=ct(Math.max(Tt,ht),yt),yt<Qt)return!0;const kr=Ke.aabb.closestPoint(z);return kr[0]===z[0]&&kr[1]===z[1]};if(this.renderWorldCopies)for(let Ke=1;Ke<=3;Ke++)Oe.push(Se(-Ke)),Oe.push(Se(Ke));for(Oe.push(Se(0));Oe.length>0;){const Ke=Oe.pop(),gt=Ke.x,pt=Ke.y;let Pt=Ke.fullyVisible;const Lt=()=>this.projection.name==="globe"&&(Ke.y===0||Ke.y===(1<<Ke.zoom)-1);if(!Pt){let yt=he?Ke.aabb.intersects(q):Ke.aabb.intersectsFlat(q);if(yt===0&&Lt()){const Tt=new s.bP(Ke.zoom,gt,pt);yt=s.bQ(this,B,Tt,!0).intersects(q)}if(yt===0)continue;Pt=yt===2}if(Ke.zoom!==Re&&Rt(Ke))for(let yt=0;yt<4;yt++){const Tt=(gt<<1)+yt%2,_r=(pt<<1)+(yt>>1),Nt={aabb:w?Ke.aabb.quadrant(yt):s.bR(this,B,Ke.zoom+1,Tt,_r,Ke.wrap,Ke.minZ,Ke.maxZ,this.projection),zoom:Ke.zoom+1,x:Tt,y:_r,wrap:Ke.wrap,fullyVisible:Pt,tileID:void 0,shouldSplit:void 0,minZ:Ke.minZ,maxZ:Ke.maxZ};v&&!V&&(Nt.tileID=new s.aA(Ke.zoom+1===Re?Xe:Ke.zoom+1,Ke.wrap,Ke.zoom+1,Tt,_r),bt(Nt)),Oe.push(Nt)}else{const yt=Ke.zoom===Re?Xe:Ke.zoom;if(r.minzoom&&r.minzoom>yt)continue;let Tt=0;if(!Pt){let kr=he?Ke.aabb.intersectsPrecise(q):Ke.aabb.intersectsPreciseFlat(q);if(kr===0&&Lt()){const ar=new s.bP(Ke.zoom,gt,pt);kr=s.bQ(this,B,ar,!0).intersectsPrecise(q)}if(kr===0)continue;if(r.calculateQuadrantVisibility)if(q.containsPoint(Ke.aabb.center))Tt=15;else for(let ar=0;ar<4;ar++)Ke.aabb.quadrant(ar).intersects(q)!==0&&(Tt|=1<<ar)}const _r=z[0]-(.5+gt+(Ke.wrap<<Ke.zoom))*(1<<a-Ke.zoom),Nt=z[1]-.5-pt,Qt=Ke.tileID?Ke.tileID:new s.aA(yt,Ke.wrap,Ke.zoom,gt,pt);r.calculateQuadrantVisibility&&(Qt.visibleQuadrants=Tt),ke.push({tileID:Qt,distanceSq:_r*_r+Nt*Nt})}}if(this.fogCullDistSq){const Ke=this.fogCullDistSq,gt=this.horizonLineFromTop();ke=ke.filter(pt=>{const Pt=[0,0,0,1],Lt=[s.ab,s.ab,0,1],yt=this.calculateFogTileMatrix(pt.tileID.toUnwrapped());s.a6.vec4.transformMat4(Pt,Pt,yt),s.a6.vec4.transformMat4(Lt,Lt,yt);const Tt=s.a6.vec4.min([],Pt,Lt),_r=s.a6.vec4.max([],Pt,Lt),Nt=s.bS(Tt,_r);if(Nt===0)return!0;let Qt=!1;const kr=this._elevation;if(kr&&Nt>Ke&&gt!==0){const ar=this.calculateProjMatrix(pt.tileID.toUnwrapped());let Tr;r.isTerrainDEM||(Tr=kr.getMinMaxForTile(pt.tileID)),Tr||(Tr={min:ge,max:ye});const qr=s.c3(this.rotation),Ur=[qr[0]*s.ab,qr[1]*s.ab,Tr.max];s.a6.vec3.transformMat4(Ur,Ur,ar),Qt=(1-Ur[1])*this.height*.5<gt}return Nt<Ke||Qt})}return ke.sort((Ke,gt)=>Ke.distanceSq-gt.distanceSq).map(Ke=>Ke.tileID)}resize(r,a){this.width=r,this.height=a,this.pixelsToGLUnits=[2/r,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const a=s.ap(r.lat,-s.bT,s.bT),f=this.projection.project(r.lng,a);return new s.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bD(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,a){let f,_;const v=this.centerPoint;if(this.projection.name==="globe"){const k=this.worldSize;f=(a.x-v.x)/k,_=(a.y-v.y)/k}else{const k=this.pointCoordinate(a),M=this.pointCoordinate(v);f=k.x-M.x,_=k.y-M.y}const w=this.locationCoordinate(r);this.setLocation(new s.a5(w.x-f,w.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,a){const f=a?s.bD(a,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new s.a5(_.x,_.y,f)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,a){const f=a??this._centerAltitude,_=[r.x,r.y,0,1],v=[r.x,r.y,1,1];s.a6.vec4.transformMat4(_,_,this.pixelMatrixInverse),s.a6.vec4.transformMat4(v,v,this.pixelMatrixInverse);const w=v[3];s.a6.vec4.scale(_,_,1/_[3]),s.a6.vec4.scale(v,v,1/w);const k=_[2],M=v[2];return{p0:_,p1:v,t:k===M?0:(f-k)/(M-k)}}screenPointToMercatorRay(r){const a=[r.x,r.y,0,1],f=[r.x,r.y,1,1];return s.a6.vec4.transformMat4(a,a,this.pixelMatrixInverse),s.a6.vec4.transformMat4(f,f,this.pixelMatrixInverse),s.a6.vec4.scale(a,a,1/a[3]),s.a6.vec4.scale(f,f,1/f[3]),a[2]=s.bD(a[2],this._center.lat)*this.worldSize,f[2]=s.bD(f[2],this._center.lat)*this.worldSize,s.a6.vec4.scale(a,a,1/this.worldSize),s.a6.vec4.scale(f,f,1/this.worldSize),new s.aj([a[0],a[1],a[2]],s.a6.vec3.normalize([],s.a6.vec3.sub([],f,a)))}rayIntersectionCoordinate(r){const{p0:a,p1:f,t:_}=r,v=s.bD(a[2],this._center.lat),w=s.bD(f[2],this._center.lat);return new s.a5(s.aa(a[0],f[0],_)/this.worldSize,s.aa(a[1],f[1],_)/this.worldSize,s.aa(v,w,_))}pointCoordinate(r,a=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,a)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let a=this.projection.pointCoordinate3D(this,r.x,r.y);if(a)return new s.a5(a[0],a[1],a[2]);let f=0,_=this.horizonLineFromTop();if(r.y>_)return this.pointCoordinate(r);const v=.02*_,w=r.clone();for(let k=0;k<10&&_-f>v;k++){w.y=s.aa(f,_,.66);const M=this.projection.pointCoordinate3D(this,w.x,w.y);M?(_=w.y,a=M):f=w.y}return a?new s.a5(a[0],a[1],a[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=s.bU)return!this.isPointAboveHorizon(r);const a=this.pointCoordinate(r);return a.y>=0&&a.y<=1}_coordinatePoint(r,a){const f=a&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,f+r.toAltitude(),1];return s.a6.vec4.transformMat4(_,_,this.pixelMatrix),_[3]>0?new s.P(_[0]/_[3],_[1]/_[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:a}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,v=this.pointLocation3D(new s.P(a,r)),w=this.pointLocation3D(new s.P(_,r)),k=this.pointLocation3D(new s.P(_,f)),M=this.pointLocation3D(new s.P(a,f));let B=Math.min(v.lng,w.lng,k.lng,M.lng),z=Math.max(v.lng,w.lng,k.lng,M.lng),V=Math.min(v.lat,w.lat,k.lat,M.lat),U=Math.max(v.lat,w.lat,k.lat,M.lat);const q=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,J=(ee,re,he,pe,ce)=>{const ye=(ee+he)/2,ge=(re+pe)/2,Ae=new s.P(ye,ge),{lng:Te,lat:Se}=this.pointLocation3D(Ae),Oe=Math.max(0,B-Te,V-Se,Te-z,Se-U);B=Math.min(B,Te),z=Math.max(z,Te),V=Math.min(V,Se),U=Math.max(U,Se),(ce<Y||Oe>q)&&(J(ee,re,ye,ge,ce+1),J(ye,ge,he,pe,ce+1))};if(J(a,r,_,r,1),J(_,r,_,f,1),J(_,f,a,f,1),J(a,f,a,r,1),this.projection.name==="globe"){const[ee,re]=s.bV(this);ee?(U=90,z=180,B=-180):re&&(V=-90,z=180,B=-180)}return new s.as(new s.bK(B,V),new s.bK(z,U))}_getBoundsRectangular(r,a){const{top:f,left:_}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,k=new s.P(_,f),M=new s.P(w,f),B=new s.P(w,v),z=new s.P(_,v);let V=this.pointCoordinate(k,r),U=this.pointCoordinate(M,r);const q=this.pointCoordinate(B,a),Y=this.pointCoordinate(z,a),J=(ee,re)=>(re.y-ee.y)/(re.x-ee.x);return V.y>1&&U.y>=0?V=new s.a5((1-Y.y)/J(Y,V)+Y.x,1):V.y<0&&U.y<=1&&(V=new s.a5(-Y.y/J(Y,V)+Y.x,0)),U.y>1&&V.y>=0?U=new s.a5((1-q.y)/J(q,U)+q.x,1):U.y<0&&V.y<=1&&(U=new s.a5(-q.y/J(q,U)+q.x,0)),new s.as().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=r.visibleDemTiles.reduce((f,_)=>{if(_.dem){const v=_.dem.tree;f.min=Math.min(f.min,v.minimums[0]),f.max=Math.max(f.max,v.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*r.exaggeration(),a.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-a*(1-this._horizonShift);return r?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-s.bT,this.maxLat=s.bT,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.am(this.minLng)*this.tileSize,this.worldMaxX=s.am(this.maxLng)*this.tileSize,this.worldMinY=s.at(this.maxLat)*this.tileSize,this.worldMaxY=s.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,a){return this.projection.createTileMatrix(this,a,r)}calculateDistanceTileData(r){const a=r.key,f=this._distanceTileDataCache;if(f[a])return f[a];const _=r.canonical,v=1/this.height,w=this.cameraWorldSize,k=w/this.zoomScale(_.z),M=(_.x+Math.pow(2,_.z)*r.wrap)*k,B=_.y*k,z=this.point;z.x*=w/this.worldSize,z.y*=w/this.worldSize;const V=this.angle,U=Math.sin(-V),q=-Math.cos(-V);return f[a]={bearing:[U,q],center:[(z.x-M)*v,(z.y-B)*v],scale:k/s.ab*v},f[a]}calculateFogTileMatrix(r){const a=r.key,f=this._fogTileMatrixCache;if(f[a])return f[a];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return s.a6.mat4.multiply(_,this.worldToFogMatrix,_),f[a]=new Float32Array(_),f[a]}calculateProjMatrix(r,a=!1,f=!1){const _=r.key;let v;if(v=f?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,v[_])return v[_];const w=this.calculatePosMatrix(r,this.worldSize);let k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,s.a6.mat4.multiply(w,k,w),v[_]=new Float32Array(w),v[_]}calculatePixelsToTileUnitsMatrix(r){const a=r.tileID.key,f=this._pixelsToTileUnitsCache;if(f[a])return f[a];const _=s.bW(r,this);return f[a]=_,f[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,a=s.a6.mat4.fromScaling([],[r,r,r]);return s.a6.mat4.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const a=s.bD(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),_=this._camera.forward(),v=s.bD(1,this._center.lat);f[2]/=v,_[2]/=v,s.a6.vec3.normalize(_,_);const w=r.raycast(f,_,r.exaggeration());if(w){const k=s.a6.vec3.scaleAndAdd([],f,_,w),M=new s.a5(k[0],k[1],s.bD(k[2],s.aM(k[1]))),B=(M.z+s.a6.vec3.length([M.x-f[0],M.y-f[1],M.z-f[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const a=this._elevation,f=s.bD(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),v=a.getAtPointOrZero(new s.a5(..._)),w=this.pixelsPerMeter/this.worldSize*v,k=this._minimumHeightOverTerrain(),M=_[2]-w;if(M<=k)if(M<0||r){const B=this.locationCoordinate(this._center,this._centerAltitude),z=[_[0],_[1],B.z-_[2]],V=s.a6.vec3.length(z);z[2]-=(k-M)/this._pixelsPerMercatorPixel;const U=s.a6.vec3.length(z);if(U===0)return;s.a6.vec3.scale(z,z,V/U*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],B.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const U=this.center;return U.lat=s.ap(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(U.lng=s.ap(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const a=this._unmodified,{x:f,y:_}=this.point;let v=0,w=f,k=_;const M=this.width/2,B=this.height/2,z=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(_-B<z&&(k=z+B),_+B>V&&(k=V-B),V-z<this.height&&(v=Math.max(v,this.height/(V-z)),k=(V+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,Y=this.worldSize/2-(U+q)/2;w=(f+Y+this.worldSize)%this.worldSize-Y,w-M<U&&(w=U+M),w+M>q&&(w=q-M),q-U<this.width&&(v=Math.max(v,this.width/(q-U)),w=(q+U)/2)}w===f&&k===_||(this.center=this.unproject(new s.P(w,k))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,a=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bD(1,this.center.lat)/s.bD(1,s.c4));const _=s.bX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?f:1,w=this._camera.getWorldToCamera(this.worldSize,v);let k;const M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-r.x/this.width,M[9]=2*r.y/this.height,this.isOrthographic){let Se=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Oe=Se*this.aspect,ke=-Oe,Re=-Se;Oe-=r.x,ke-=r.x,Se+=r.y,Re+=r.y,k=this._camera.getCameraToClipOrthographic(ke,Oe,Re,Se,this._nearZ,this._farZ),((Xe,ht,bt,ct)=>{for(let Rt=0;Rt<16;Rt++)Xe[Rt]=Ol(ht[Rt],bt[Rt],ct)})(k,k,M,Bl(this.pitch>=15?1:this.pitch/15))}else k=M;const B=s.a6.mat4.mul([],M,w);let z=s.a6.mat4.mul([],k,w);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),Oe=s.a6.mat4.identity([]);s.a6.mat4.translate(Oe,Oe,[Se.x*this.worldSize,Se.y*this.worldSize,0]),s.a6.mat4.multiply(Oe,Oe,s.bY(this)),s.a6.mat4.translate(Oe,Oe,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),s.a6.mat4.multiply(z,z,Oe),s.a6.mat4.multiply(B,B,Oe),this.inverseAdjustmentMatrix=s.bZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.a6.mat4.scale([],z,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=z,this.invProjMatrix=s.a6.mat4.invert(new Float64Array(16),this.projMatrix),a){const Se=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Se[8]=2*-r.x/this.width,Se[9]=2*r.y/this.height,this.expandedFarZProjMatrix=s.a6.mat4.mul([],Se,w)}else this.expandedFarZProjMatrix=this.projMatrix;const V=s.a6.mat4.invert([],k);this.frustumCorners=s.b_.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const U=new Float32Array(16);s.a6.mat4.identity(U),s.a6.mat4.scale(U,U,[1,-1,1]),s.a6.mat4.rotateX(U,U,this._pitch),s.a6.mat4.rotateZ(U,U,this.angle);const q=s.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.a6.mat4.clone(q);const Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-r.x/this.width,q[9]=2*(r.y+Y)/this.height,this.skyboxMatrix=s.a6.mat4.multiply(U,q,U);const J=this.point,ee=J.x,re=J.y,he=this.width%2/2,pe=this.height%2/2,ce=Math.cos(this.angle),ye=Math.sin(this.angle),ge=ee-Math.round(ee)+ce*he+ye*pe,Ae=re-Math.round(re)+ce*pe+ye*he,Te=new Float64Array(z);if(s.a6.mat4.translate(Te,Te,[ge>.5?ge-1:ge,Ae>.5?Ae-1:Ae,0]),this.alignedProjMatrix=Te,z=s.a6.mat4.create(),s.a6.mat4.scale(z,z,[this.width/2,-this.height/2,1]),s.a6.mat4.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=s.a6.mat4.create(),s.a6.mat4.scale(z,z,[1,-1,1]),s.a6.mat4.translate(z,z,[-1,-1,0]),s.a6.mat4.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=s.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,B),this._calcFogMatrices(),this._distanceTileDataCache={},z=s.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.b$(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.a6.vec3.transformMat4(Se,Se,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,v=[r,r,a];s.a6.vec3.scale(v,v,_),s.a6.vec3.scale(f,f,-1),s.a6.vec3.multiply(f,f,v);const w=s.a6.mat4.create();s.a6.mat4.translate(w,w,f),s.a6.mat4.scale(w,w,v),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,a,_)}_computeCameraPosition(r){const a=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*v,_.y/this.worldSize-f[1]*v,r/this.worldSize*this._centerAltitude-f[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=r[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(v=Math.min((a-f)/_,1)),this._camera.position=s.a6.vec3.scaleAndAdd([],this._camera.position,r,v),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,a=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),v=s.bD(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.bB(this._maxPitch)),k=Math.max((r[2]-v)/Math.cos(f),w),M=this._zoomFromMercatorZ(k);s.a6.vec3.scaleAndAdd(r,r,a,k),this._pitch=s.ap(f,s.bB(this.minPitch),s.bB(this.maxPitch)),this.angle=s.bA(_,-Math.PI,Math.PI),this._setZoom(s.ap(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.a5(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let a=0,f=s.bU,_=0,v=1/0;for(;f-a>1e-6&&f>a;){const w=a+.5*(f-a),k=this.tileSize*Math.pow(2,w),M=this.getCameraToCenterDistance(this.projection,w,k),B=this.scaleZoom(M/(r*this.tileSize)),z=Math.abs(w-B);z<v&&(v=z,_=w),w<B?a=w:f=w}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,a){const f=Math.min(r.x,a.x),_=Math.max(r.x,a.x),v=Math.min(r.y,a.y),w=Math.max(r.y,a.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const k=[new s.P(f,v),new s.P(_,w),new s.P(f,w),new s.P(_,v)],M=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const z of k){const V=this.pointRayIntersection(z);if(V.t<0)return!0;const U=this.rayIntersectionCoordinate(V);if(U.x<M||U.y<0||U.x>B||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.c0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(r,a){const f=s.a6.vec3.length(s.a6.vec3.sub([],this._camera.position,r)),_=this._zoomFromMercatorZ(f)+a;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([a,f,_],v){const w=[a,f,_,1];s.a6.vec4.transformMat4(w,w,v);const k=w[3]=Math.max(w[3],1e-6);return w[0]/=k,w[1]/=k,w[2]/=k,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,r))}}getCameraToCenterDistance(r,a=this.zoom,f=this.worldSize){const _=s.bX(r,a,this.width,this.height,1024),v=r.pixelSpaceConversion(this.center.lat,f,_);let w=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(w=Ol(1,w,Bl(this.pitch>=15?1:this.pitch/15))),w}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.a6.mat4.multiply(r,r,this.globeMatrix),r}getFrustum(r){return s.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const ba=(d,r)=>{if(r>0&&d.terrain&&s.w("Cutoff is currently disabled on terrain"),r<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=d.transform,f=Math.max(Math.abs(a._zoom-(d.minCutoffZoom-1)),1),_=a.isLODDisabled(!1)?s.a7(60,45,a.pitch):s.a7(30,15,a.pitch),v=a._farZ-a._nearZ,w=r*a.height,k=((1-(M=_))*a.cameraToCenterDistance+M*(a._farZ+w))*f;var M;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(k-a._nearZ)/v,(k-w-a._nearZ)/v]}}},oi={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class ch{constructor(r,a){this.aabb=r,this.lastCascade=a}}class Ut{add(r,a){const f=this.receivers[r.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],a.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],a.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],a.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],a.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],a.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],a.max[2])):this.receivers[r.key]=new ch(a,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,a,f){const _=s.c9.fromPoints(r.points);let v=0;for(const w in this.receivers){const k=this.receivers[w];if(!k||!_.intersectsAabb(k.aabb))continue;k.aabb.min=_.closestPoint(k.aabb.min),k.aabb.max=_.closestPoint(k.aabb.max);const M=k.aabb.getCorners();for(let B=0;B<f.length;B++){let z=!0;for(const V of M){const U=[V[0]*a,V[1]*a,V[2]];if(s.a6.vec3.transformMat4(U,U,f[B].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){z=!1;break}}if(k.lastCascade=B,v=Math.max(v,B),z)break}}return v+1}}class uh{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Ut,this._depthMode=new fe(r.context.gl.LEQUAL,fe.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(oi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(oi,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(oi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,a){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const _=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce((Y,J)=>{const ee=f.style._mergedLayers[J];return Y+(ee.hasShadowPass()&&!ee.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=f.context,w=oi.shadowMapResolution,k=oi.shadowMapResolution;if(this._cascades.length===0||oi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Y=0;Y<oi.cascadeCount;++Y){const J=f._shadowMapDebug,ee=v.gl,re=v.createFramebuffer(w,k,J,"texture"),he=new s.T(v,{width:w,height:k,data:null},ee.DEPTH_COMPONENT16);if(re.depthAttachment.set(he.texture),J){const pe=new s.T(v,{width:w,height:k,data:null},ee.RGBA8);re.colorAttachment.set(pe.texture)}this._cascades.push({framebuffer:re,texture:he,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bN,scale:0})}}this.shadowDirection=pc(a);let M=0;if(r.elevation){const Y=r.elevation,J=[1e4,-1e4];Y.visibleDemTiles.filter(ee=>ee.dem).forEach(ee=>{const re=ee.dem.tree;J[0]=Math.min(J[0],re.minimums[0]),J[1]=Math.max(J[1],re.maximums[0])}),J[0]!==1e4&&(M=(J[1]-J[0])*Y.exaggeration())}const B=1.5*r.cameraToCenterDistance,z=3*B,V=new Float64Array(16);for(let Y=0;Y<this._cascades.length;++Y){const J=this._cascades[Y];let ee=r.height/50,re=1;oi.cascadeCount===1?re=z:Y===0?re=B:(ee=B,re=z);const[he,pe]=mc(r,this.shadowDirection,ee,re,oi.shadowMapResolution,M);J.scale=r.scale,J.matrix=he,J.boundingSphereRadius=pe,s.a6.mat4.invert(V,J.matrix),J.frustum=s.bN.fromInvProjectionMatrix(V,1,0,!0),J.far=re}const U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/oi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=oi.shadowMapResolution,this._uniformValues.u_shadowmap_0=ti.ShadowMap0,this._uniformValues.u_shadowmap_1=ti.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=f.transform.elevation;for(const Y of this._groundShadowTiles){let J={min:0,max:0};if(q){const ee=q.getMinMaxForTile(Y);ee&&(J=ee)}this.addShadowReceiver(Y.toUnwrapped(),J.min,J.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,a){if(!this.enabled)return;const f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,oi.shadowMapResolution,oi.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){f.currentShadowCascade=v,_.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),_.clear({color:s.bz.white,depth:1});for(const w of r.order){const k=r._mergedLayers[w];if(!k.hasShadowPass()||k.isHidden(f.transform.zoom))continue;const M=r.getLayerSourceCache(k),B=M?a[M.id]:void 0;(k.type==="model"||B&&B.length)&&f.renderLayer(f,M,k,B)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,a=r.style,f=r.context,_=a.directionalLight,v=a.ambientLight;if(!_||!v)return;const w=[],k=ba(r,r.longestCutoffRange);k.shouldRenderCutoff&&w.push("RENDER_CUTOFF");const M=Fl(a,_,v),B=new fe(f.gl.LEQUAL,fe.ReadOnly,r.depthRangeFor3D);for(const z of this._groundShadowTiles){const V=z.toUnwrapped(),U=r.isTileAffectedByFog(z),q=r.getOrCreateProgram("groundShadow",{defines:w,overrideFog:U});this.setupShadows(V,q),r.uploadCommonUniforms(f,q,V,null,k);const Y={u_matrix:r.transform.calculateProjMatrix(V),u_ground_shadow_factor:M};q.draw(r,f.gl.TRIANGLES,B,st.disabled,te.multiply,cr.disabled,Y,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,{},r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?te.unblended:te.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const a=this.painter.transform,f=a.calculatePosMatrix(r,a.worldSize);return s.a6.mat4.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(r){return s.a6.mat4.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,a,f,_=0){if(!this.enabled)return;const v=this.painter.transform,w=this.painter.context,k=w.gl,M=this._uniformValues,B=new Float64Array(16),z=v.calculatePosMatrix(r,v.worldSize);for(let V=0;V<this._cascades.length;V++)s.a6.mat4.multiply(B,this._cascades[V].matrix,z),M[V===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(B),w.activeTexture.set(k.TEXTURE0+ti.ShadowMap0+V),this._cascades[V].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){const V=s.c8(r.canonical),U=2/v.tileSize*s.ab/oi.shadowMapResolution,q=U*this._cascades[0].boundingSphereRadius,Y=U*this._cascades[this._cascades.length-1].boundingSphereRadius,J=(f==="vector-tile"?1:3)/Math.pow(2,_-r.canonical.z-(1-v.zoom+Math.floor(v.zoom)));M.u_shadow_normal_offset=[V,q*J,Y*J],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(w,M)}setupShadowsFromMatrix(r,a,f=!1){if(!this.enabled)return;const _=this.painter.context,v=_.gl,w=this._uniformValues,k=new Float64Array(16);for(let M=0;M<oi.cascadeCount;M++)s.a6.mat4.multiply(k,this._cascades[M].matrix,r),w[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),_.activeTexture.set(v.TEXTURE0+ti.ShadowMap0+M),this._cascades[M].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=f,f){const M=oi.normalOffset;w.u_shadow_normal_offset=[1,M,M],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(_,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,a,f,_){if(_[2]>=0)return{};const v=function(M,B,z){const V=z/(1<<M.canonical.z);return new s.c9([M.canonical.x*V+M.wrap*z,M.canonical.y*V+M.wrap*z,0],[(M.canonical.x+1)*V+M.wrap*z,(M.canonical.y+1)*V+M.wrap*z,B])}(r,a,f).getCorners(),w=a/-_[2];_[0]<0?(s.a6.vec3.add(v[0],v[0],[_[0]*w,0,0]),s.a6.vec3.add(v[3],v[3],[_[0]*w,0,0])):_[0]>0&&(s.a6.vec3.add(v[1],v[1],[_[0]*w,0,0]),s.a6.vec3.add(v[2],v[2],[_[0]*w,0,0])),_[1]<0?(s.a6.vec3.add(v[0],v[0],[0,_[1]*w,0]),s.a6.vec3.add(v[1],v[1],[0,_[1]*w,0])):_[1]>0&&(s.a6.vec3.add(v[2],v[2],[0,_[1]*w,0]),s.a6.vec3.add(v[3],v[3],[0,_[1]*w,0]));const k={};return k.vertices=v,k.planes=[zl(v[1],v[0],v[4]),zl(v[2],v[1],v[5]),zl(v[3],v[2],v[6]),zl(v[0],v[3],v[7])],k}addShadowReceiver(r,a,f){this._receivers.add(r,s.c9.fromTileIdAndHeight(r,a,f))}getMaxCascadeForTile(r){const a=this._receivers.get(r);return a&&a.lastCascade?a.lastCascade:0}}function zl(d,r,a){const f=s.a6.vec3.sub([],a,r),_=s.a6.vec3.sub([],d,r),v=s.a6.vec3.cross([],f,_),w=s.a6.vec3.length(v);return w===0?[0,0,1,0]:(s.a6.vec3.scale(v,v,1/w),[v[0],v[1],v[2],-s.a6.vec3.dot(v,r)])}function pc(d){const r=d.properties.get("direction"),a=s.c7(r.x,r.y,r.z);a[2]=s.ap(a[2],0,75);const f=s.ca([a[0],a[1],a[2]]);return s.a6.vec3.fromValues(f.x,f.y,f.z)}function Fl(d,r,a){const f=r.properties.get("color"),_=r.properties.get("intensity"),v=r.properties.get("direction"),w=[v.x,v.y,v.z],k=a.properties.get("color"),M=a.properties.get("intensity"),B=Math.max(s.a6.vec3.dot([0,0,1],w),0),z=[0,0,0];s.a6.vec3.scale(z,k.toRenderColor(d.getLut(r.scope)).toArray01Linear().slice(0,3),M);const V=[0,0,0];return s.a6.vec3.scale(V,f.toRenderColor(d.getLut(a.scope)).toArray01Linear().slice(0,3),B*_),s.cb([z[0]>0?z[0]/(z[0]+V[0]):0,z[1]>0?z[1]/(z[1]+V[1]):0,z[2]>0?z[2]/(z[2]+V[2]):0])}function mc(d,r,a,f,_,v){const w=d.zoom,k=d.scale,M=d.worldSize,B=1/M,z=d.aspect,V=Math.sqrt(1+z*z)*Math.tan(.5*d.fovX),U=V*V,q=f-a,Y=f+a;let J,ee;U>q/Y?(J=f,ee=f*V):(J=.5*Y*(1+U),ee=.5*Math.sqrt(q*q+2*(f*f+a*a)*U+Y*Y*U*U));const re=d.projection.pixelsPerMeter(d.center.lat,M),he=d._camera.getCameraToWorldMercator(),pe=[0,0,-J*B];s.a6.vec3.transformMat4(pe,pe,he);let ce=ee*B;const ye=d._edgeInsets;if(!(ye.left===0&&ye.top===0&&ye.right===0&&ye.bottom===0||ye.left===ye.right&&ye.top===ye.bottom)){const Pt=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?re:1),Lt=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,a,f);Lt[8]=2*-d.centerOffset.x/d.width,Lt[9]=2*d.centerOffset.y/d.height;const yt=new Float64Array(16);s.a6.mat4.mul(yt,Lt,Pt);const Tt=new Float64Array(16);s.a6.mat4.invert(Tt,yt);const _r=s.bN.fromInvProjectionMatrix(Tt,M,w,!0);for(const Nt of _r.points){const Qt=((ge=Nt)[0]/=k,ge[1]/=k,ge[2]=s.bD(ge[2],d._center.lat),ge);ce=Math.max(ce,s.a6.vec3.len(s.a6.vec3.subtract([],pe,Qt)))}}var ge;ce*=_/(_-1);const Ae=Math.acos(r[2]),Te=Math.atan2(-r[0],-r[1]),Se=new Ci;Se.position=pe,Se.setPitchBearing(Ae,Te);const Oe=Se.getWorldToCamera(M,re),ke=ce*M,Re=Math.min(d._mercatorZfromZoom(17)*M*-2,-2*ke),Xe=Se.getCameraToClipOrthographic(-ke,ke,-ke,ke,Re,(ke+v*re)/r[2]),ht=new Float64Array(16);s.a6.mat4.multiply(ht,Xe,Oe);const bt=s.a6.vec3.fromValues(Math.floor(1e6*pe[0])/1e6*M,Math.floor(1e6*pe[1])/1e6*M,0),ct=.5*_,Rt=[0,0,0];s.a6.vec3.transformMat4(Rt,bt,ht),s.a6.vec3.scale(Rt,Rt,ct);const Ke=[Math.floor(Rt[0]),Math.floor(Rt[1]),Math.floor(Rt[2])],gt=[0,0,0];s.a6.vec3.sub(gt,Rt,Ke),s.a6.vec3.scale(gt,gt,-1/ct);const pt=new Float64Array(16);return s.a6.mat4.identity(pt),s.a6.mat4.translate(pt,pt,gt),s.a6.mat4.multiply(ht,pt,ht),[ht,ke]}class wo extends s.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.numModelsLoading={}}loadModel(r,a){return s.aG(this.requestManager.transformRequest(a,s.R.Model).url).then(f=>{if(!f)return;const _=s.aH(f),v=new s.aI(r,void 0,void 0,_);return v.computeBoundsAndApplyParent(),v}).catch(f=>{if(f&&f.status===404)return null;this.fire(new s.t(new Error(`Could not load model ${r} from ${a}: ${f.message}`)))})}load(r,a){this.models[a]||(this.models[a]={});const f=Object.keys(r);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+f.length;const _=[];for(const v of f)_.push(this.loadModel(v,r[v]));Promise.allSettled(_).then(v=>{for(let w=0;w<v.length;w++){const{status:k,value:M}=v[w];k==="fulfilled"&&M&&(this.models[a][f[w]]={model:M,numReferences:1})}this.numModelsLoading[a]-=f.length,this.fire(new s.x("data",{dataType:"style"}))}).catch(v=>{this.fire(new s.t(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,a){return!!this.getModel(r,a)}getModel(r,a){return this.models[a]||(this.models[a]={}),this.models[a][r]?this.models[a][r].model:void 0}addModel(r,a,f){this.models[f]||(this.models[f]={}),this.hasModel(r,f)&&this.models[f][r].numReferences++,this.load({[r]:this.requestManager.normalizeModelURL(a)},f)}addModels(r,a){this.models[a]||(this.models[a]={});const f={};for(const _ in r)this.models[a][_]={},f[_]=this.requestManager.normalizeModelURL(r[_]);this.load(f,a)}addModelsFromBucket(r,a){this.models[a]||(this.models[a]={});const f={};for(const _ of r)this.hasModel(_,a)?this.models[a][_].numReferences++:f[_]=this.requestManager.normalizeModelURL(_);this.load(f,a)}removeModel(r,a){if(this.models[a]&&this.models[a][r]&&(this.models[a][r].numReferences--,this.models[a][r].numReferences===0)){const f=this.models[a][r].model;delete this.models[a][r],f.destroy()}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,a){this.models[a]||(this.models[a]={});for(const f in this.models[a])this.models[a][f].model&&this.models[a][f].model.upload(r.context)}}const eu=new s.a0({data:new s.a1(s._.colorTheme.data)}),To=(d,r)=>Ue(d,r&&r.filter(a=>a.identifier!=="source.canvas")),gc=s.ar(Gr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),qa=s.ar(Gr,["setCenter","setZoom","setBearing","setPitch"]),hh={version:8,layers:[],sources:{}},tu={duration:300,delay:0};class Zo extends s.E{constructor(r,a={}){super(),this.map=r,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=s.l({},tu),this._buildingIndex=new Dl(this),this.crossTileSymbolIndex=new D,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Ye,this.dispatcher=a.dispatcher?a.dispatcher:new s.cd(s.ce(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new jt,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new s.cf(r._requestManager,a.localFontFamily?s.cg.all:a.localIdeographFontFamily?s.cg.ideographs:s.cg.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new wo(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",s.ch());const f=this;this._rtlTextPluginCallback=Zo.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,w)=>{if(s.ci(v),w&&w.every(k=>k))for(const k in f._sourceCaches){const M=f._sourceCaches[k],B=M.getSource().type;B!=="vector"&&B!=="geojson"||M.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.getOwnSource(_.sourceId);if(v&&v.vectorLayerIds)for(const w in this._layers){const k=this._layers[w];k.source===v.id&&this._validateLayer(k)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(s.f(r))return r;const a=s.cj(r);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${s.ck(JSON.stringify(r))}`}_diffStyle(r,a,f){this.globalId=this._getGlobalId(r);const _=(v,w)=>{try{w(null,this.setState(v,f))}catch(k){w(k,!1)}};if(typeof r=="string"){const v=this.map._requestManager.normalizeStyleURL(r),w=this.map._requestManager.transformRequest(v,s.R.Style);s.n(w,(k,M)=>{k?this.fire(new s.t(k)):M&&_(M,a)})}else typeof r=="object"&&_(r,a)}loadURL(r,a={}){this.fire(new s.x("dataloading",{dataType:"style"}));const f=typeof a.validate=="boolean"?a.validate:!s.f(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,a.accessToken),this.resolvedImports.add(r);const _=this.importsCache.get(r);if(_)return this._load(_,f);const v=this.map._requestManager.transformRequest(r,s.R.Style);this._request=s.n(v,(w,k)=>{if(this._request=null,w)this.fire(new s.t(w));else if(k)return this.importsCache.set(r,k),this._load(k,f)})}loadJSON(r,a={}){this.fire(new s.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=s.q.frame(()=>{this._request=null,this._load(r,a.validate!==!1)})}loadEmpty(){this.fire(new s.x("dataloading",{dataType:"style"})),this._load(hh,!1)}_loadImports(r,a,f){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const v of r){const w=this._createFragmentStyle(v),k=new Promise(z=>{w.once("style.import.load",z),w.once("error",z)}).then(()=>this.mergeAll());if(_.push(k),this.resolvedImports.has(v.url)){w.loadEmpty();continue}const M=v.data||this.importsCache.get(v.url);M?(w.loadJSON(M,{validate:a}),this._isInternalStyle(M)&&(w.globalId=null)):v.url?w.loadURL(v.url,{validate:a}):w.loadEmpty();const B={style:w,id:v.id,config:v.config};if(f){const z=this.fragments.findIndex(({id:V})=>V===f);this.fragments=this.fragments.slice(0,z).concat(B).concat(this.fragments.slice(z))}else this.fragments.push(B)}return Promise.allSettled(_)}getImportGlobalIds(r=this,a=new Set){for(const f of r.fragments)f.style.globalId&&a.add(f.style.globalId),this.getImportGlobalIds(f.style,a);return[...a.values()]}_createFragmentStyle(r){const a=this.scope?s.av(r.id,this.scope):r.id;let f;const _=this._initialConfig&&this._initialConfig[a];(r.config||_)&&(f=s.l({},r.config,_));const v=new Zo(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,a){const f=r.schema;if(this._isInternalStyle(r)){const w=s.l({},hh,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(w,a)}if(this.updateConfig(this._config,f),a&&To(this,to(r)))return;this._loaded=!0,this.stylesheet=s.cl(r);const _=()=>{for(const B in r.sources)this.addSource(B,r.sources[B],{validate:!1,isInitialLoad:!0});r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(r.glyphs,this.scope);const w=Ll(this.stylesheet.layers);if(this._order=w.map(B=>B.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const B=this.stylesheet.lights[0];this.light=new We(B.properties,B.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new We(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const B of w){const z=s.cq(B,this.scope,this._styleColorTheme.lut,this.options);z.configDependencies.size!==0&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize();const V=this.getOwnLayerSourceCache(z),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();V&&z.canCastShadows()&&U&&(V.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.x("data",{dataType:"style"}));const M=this.isRootStyle();r.imports?this._loadImports(r.imports,a).then(()=>{this._reloadImports(),this.fire(new s.x(M?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.x(M?"style.load":"style.import.load")))},v=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=v,v){const w=this._evaluateColorThemeData(v);this._loadColorTheme(w).then(()=>{_()}).catch(k=>{s.w(`Couldn't load color theme from the stylesheet: ${k}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,a,f,_,v,w,k,M;const B={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(z=>{if(z.stylesheet){if(z.light!=null&&(r=z.light),z.stylesheet.lights)for(const V of z.stylesheet.lights)V.type==="ambient"&&z.ambientLight!=null&&(a=z.ambientLight),V.type==="directional"&&z.directionalLight!=null&&(f=z.directionalLight);_=this._prioritizeTerrain(_,z.terrain,z.stylesheet.terrain),z.stylesheet.fog&&z.fog!=null&&(v=z.fog),z.stylesheet.camera!=null&&(M=z.stylesheet.camera),z.stylesheet.projection!=null&&(w=z.stylesheet.projection),z.stylesheet.transition!=null&&(k=z.stylesheet.transition),B[z.scope]=z._styleColorTheme}}),this.light=r,this.ambientLight=a,this.directionalLight=f,this.fog=v,this._styleColorThemeForScope=B,_===null?delete this.terrain:this.terrain=_,this.camera=M||{"camera-projection":"perspective"},this.projection=w||{name:"mercator"},this.transition=s.l({},tu,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const a=f=>{for(const _ of f.fragments)a(_.style);r(f)};a(this)}_prioritizeTerrain(r,a,f){const _=r&&r.drapeRenderMode===0;return f===null?a&&a.drapeRenderMode===0?a:_?r:null:a!=null&&(!r||_||a&&a.drapeRenderMode===1)?a:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{r=this._prioritizeTerrain(r,a.terrain,a.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(r=a.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},a={},f={};this.forEachFragmentStyle(_=>{for(const v in _._sourceCaches){const w=s.av(v,_.scope);r[w]=_._sourceCaches[v]}for(const v in _._otherSourceCaches){const w=s.av(v,_.scope);a[w]=_._otherSourceCaches[v]}for(const v in _._symbolSourceCaches){const w=s.av(v,_.scope);f[w]=_._symbolSourceCaches[v]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=f}mergeLayers(){const r={},a=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(const w of v._order){const k=v._layers[w];if(k.type==="slot"){const M=s.cm(w);if(r[M])continue;r[M]=[]}k.slot&&r[k.slot]?r[k.slot].push(k):a.push(k)}}),this._mergedOrder=[];const _=(v=[])=>{for(const w of v)if(w.type==="slot"){const k=s.cm(w.id);r[k]&&_(r[k]),this._mergedSlots.push(k)}else{const k=s.av(w.id,w.scope);this._mergedOrder.push(k),f[k]=w,w.is3D()&&(this._has3DLayers=!0),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0),w.type==="clip"&&(this._clipLayerPresent=!0)}};_(a),this._mergedOrder.sort((v,w)=>{const k=f[v],M=f[w];return k.hasInitialOcclusionOpacityProperties?M.is3D()?1:0:k.is3D()&&M.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=s.l({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(a,f,_){const v=s.l({},f);for(const k of Object.keys(s._.colorTheme))v[k]===void 0&&(v[k]=s._.colorTheme[k].default);const w=new s.$(eu,a,new Map(_));return w.setTransitionOrValue(v,_),w.untransitioned().possiblyEvaluate(new s.a3(0))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,_)=>{const v="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let w=r;w.startsWith(v)||(w=v+w);const k="mapbox-reserved-lut",M=new Image;M.src=w,M.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},M.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void f();this._styleColorTheme.lutLoading=!1;const{width:B,height:z,data:V}=s.q.getImageData(M);if(z>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(B!==z*z)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(k)&&this.removeImage(k),this.addImage(k,{data:new s.r({width:B,height:z},V),pixelRatio:1,sdf:!1,version:0});const U=this.imageManager.getImage(k,this.scope);U?(this._styleColorTheme.lut={image:U.data,data:r},f()):_(new Error("Missing LUT image."))}})}getLut(r){const a=this._styleColorThemeForScope[r];return a?a.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(a,f,_){let v,w,k;const M=s.q.devicePixelRatio>1?"@2x":"";let B=s.n(f.transformRequest(f.normalizeSpriteURL(a,M,".json"),s.R.SpriteJSON),(U,q)=>{B=null,k||(k=U,v=q,V())}),z=s.o(f.transformRequest(f.normalizeSpriteURL(a,M,".png"),s.R.SpriteImage),(U,q)=>{z=null,k||(k=U,w=q,V())});function V(){if(k)_(k);else if(v&&w){const U=s.q.getImageData(w),q={};for(const Y in v){const{width:J,height:ee,x:re,y:he,sdf:pe,pixelRatio:ce,stretchX:ye,stretchY:ge,content:Ae}=v[Y],Te=new s.r({width:J,height:ee});s.r.copy(U,Te,{x:re,y:he},{x:0,y:0},{width:J,height:ee},null),q[Y]={data:Te,pixelRatio:ce,sdf:pe,stretchX:ye,stretchY:ge,content:Ae}}_(null,q)}}return{cancel(){B&&(B.cancel(),B=null),z&&(z.cancel(),z=null)}}}(r,this.map._requestManager,(a,f)=>{if(this._spriteRequest=null,a)this.fire(new s.t(a));else if(f)for(const _ in f)this.imageManager.addImage(_,this.scope,f[_]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.x("data",{dataType:"style"}))})}_validateLayer(r){const a=this.getOwnSource(r.source);if(!a)return;const f=r.sourceLayer;f&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(f)===-1)&&this.fire(new s.t(new Error(`Source layer "${f}" does not exist on source "${a.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,a)=>{const f=this.fragments[a];return f&&f.style&&(r.data=f.style.serialize()),r})}_serializeSources(){const r={};for(const a in this._sourceCaches){const f=this._sourceCaches[a].getSource();r[f.id]||(r[f.id]=f.serialize())}return r}_serializeLayers(r){const a=[];for(const f of r){const _=this._layers[f];_&&_.type!=="custom"&&a.push(_.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const a=this.getOwnLayer(r);if(a)return a;this.fire(new s.t(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const a=this.getOwnSource(r);if(a)return a;this.fire(new s.t(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,a){const f=this.map.painter;if(f)for(let _=r.minzoom||0;_<(r.maxzoom||25.5);_++){const v=r.getProgramIds();if(v)for(const w of v){const k=r.getDefaultProgramParams(w,a.zoom,this._styleColorTheme.lut);k&&(f.style=this,this.fog&&(f._fogVisible=!0,k.overrideFog=!0,f.getOrCreateProgram(w,k)),f._fogVisible=!1,k.overrideFog=!1,f.getOrCreateProgram(w,k),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(k.overrideRtt=!0,f.getOrCreateProgram(w,k)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const a=this.calculateLightsBrightness();r.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));const f=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const k in w){const{updatedIds:M,removedIds:B}=w[k];(M||B)&&(this._updateWorkerLayers(k,M,B),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._changes.reset()}const v={};for(const w in this._mergedSourceCaches){const k=this._mergedSourceCaches[w];v[w]=k.used,k.used=!1,k.tileCoverLift=0}for(const w of this._mergedOrder){const k=this._mergedLayers[w];if(k.recalculate(r,this._availableImages),!k.isHidden(r.zoom)){const M=this.getLayerSourceCache(k);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,k.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(k,r)}):this.precompilePrograms(k,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();for(const w in v){const k=this._mergedSourceCaches[w];v[w]!==k.used&&k.getSource().fire(new s.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new s.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=this._changes.getUpdatedImages();if(r.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,a,f){const _=this.getFragmentStyle(r);_&&this.dispatcher.broadcast("updateLayers",{layers:a?_._serializeLayers(a):[],scope:r,removedIds:f||[],options:_.options})}setState(r,a){if(this._checkLoaded(),To(this,to(r)))return!1;(r=s.cl(r)).layers=Ll(r.layers);const f=function(w,k){if(!w)return[{command:Gr.setStyle,args:[k]}];let M=[];try{if(!s.bh(w.version,k.version))return[{command:Gr.setStyle,args:[k]}];if(s.bh(w.center,k.center)||M.push({command:Gr.setCenter,args:[k.center]}),s.bh(w.zoom,k.zoom)||M.push({command:Gr.setZoom,args:[k.zoom]}),s.bh(w.bearing,k.bearing)||M.push({command:Gr.setBearing,args:[k.bearing]}),s.bh(w.pitch,k.pitch)||M.push({command:Gr.setPitch,args:[k.pitch]}),s.bh(w.sprite,k.sprite)||M.push({command:Gr.setSprite,args:[k.sprite]}),s.bh(w.glyphs,k.glyphs)||M.push({command:Gr.setGlyphs,args:[k.glyphs]}),s.bh(w.imports,k.imports)||function(q=[],Y=[],J){Y=Y||[];const ee=(q=q||[]).map(Gs),re=Y.map(Gs),he=q.reduce(_a,{}),pe=Y.reduce(_a,{}),ce=ee.slice();let ye,ge,Ae,Te;for(ye=0,ge=0;ye<ee.length;ye++)Ae=ee[ye],pe.hasOwnProperty(Ae)?ge++:(J.push({command:Gr.removeImport,args:[Ae]}),ce.splice(ce.indexOf(Ae,ge),1));for(ye=0,ge=0;ye<re.length;ye++)Ae=re[re.length-1-ye],ce[ce.length-1-ye]!==Ae&&(he.hasOwnProperty(Ae)?(J.push({command:Gr.removeImport,args:[Ae]}),ce.splice(ce.lastIndexOf(Ae,ce.length-ge),1)):ge++,Te=ce[ce.length-ye],J.push({command:Gr.addImport,args:[pe[Ae],Te]}),ce.splice(ce.length-ye,0,Ae));for(const Se of Y){const Oe=he[Se.id];Oe&&!s.bh(Oe,Se)&&J.push({command:Gr.updateImport,args:[Se.id,Se]})}}(w.imports,k.imports,M),s.bh(w.transition,k.transition)||M.push({command:Gr.setTransition,args:[k.transition]}),s.bh(w.light,k.light)||M.push({command:Gr.setLight,args:[k.light]}),s.bh(w.fog,k.fog)||M.push({command:Gr.setFog,args:[k.fog]}),s.bh(w.projection,k.projection)||M.push({command:Gr.setProjection,args:[k.projection]}),s.bh(w.lights,k.lights)||M.push({command:Gr.setLights,args:[k.lights]}),s.bh(w.camera,k.camera)||M.push({command:Gr.setCamera,args:[k.camera]}),!s.bh(w["color-theme"],k["color-theme"]))return[{command:Gr.setStyle,args:[k]}];const B={},z=[];(function(q,Y,J,ee){let re;for(re in Y=Y||{},q=q||{})q.hasOwnProperty(re)&&(Y.hasOwnProperty(re)||an(re,J,ee));for(re in Y){if(!Y.hasOwnProperty(re))continue;const he=Y[re];q.hasOwnProperty(re)?s.bh(q[re],he)||(q[re].type==="geojson"&&he.type==="geojson"&&xr(q,Y,re)?J.push({command:Gr.setGeoJSONSourceData,args:[re,he.data]}):vo(re,Y,J,ee)):$o(re,Y,J)}})(w.sources,k.sources,z,B);const V=[];w.layers&&w.layers.forEach(q=>{q.source&&B[q.source]?M.push({command:Gr.removeLayer,args:[q.id]}):V.push(q)});let U=w.terrain;U&&B[U.source]&&(M.push({command:Gr.setTerrain,args:[void 0]}),U=void 0),M=M.concat(z),s.bh(U,k.terrain)||M.push({command:Gr.setTerrain,args:[k.terrain]}),function(q,Y,J){Y=Y||[];const ee=(q=q||[]).map(Gs),re=Y.map(Gs),he=q.reduce(_a,{}),pe=Y.reduce(_a,{}),ce=ee.slice(),ye=Object.create(null);let ge,Ae,Te,Se,Oe,ke,Re;for(ge=0,Ae=0;ge<ee.length;ge++)Te=ee[ge],pe.hasOwnProperty(Te)?Ae++:(J.push({command:Gr.removeLayer,args:[Te]}),ce.splice(ce.indexOf(Te,Ae),1));for(ge=0,Ae=0;ge<re.length;ge++)Te=re[re.length-1-ge],ce[ce.length-1-ge]!==Te&&(he.hasOwnProperty(Te)?(J.push({command:Gr.removeLayer,args:[Te]}),ce.splice(ce.lastIndexOf(Te,ce.length-Ae),1)):Ae++,ke=ce[ce.length-ge],J.push({command:Gr.addLayer,args:[pe[Te],ke]}),ce.splice(ce.length-ge,0,Te),ye[Te]=!0);for(ge=0;ge<re.length;ge++)if(Te=re[ge],Se=he[Te],Oe=pe[Te],!ye[Te]&&!s.bh(Se,Oe))if(s.bh(Se.source,Oe.source)&&s.bh(Se["source-layer"],Oe["source-layer"])&&s.bh(Se.type,Oe.type)){for(Re in cs(Se.layout,Oe.layout,J,Te,null,Gr.setLayoutProperty),cs(Se.paint,Oe.paint,J,Te,null,Gr.setPaintProperty),s.bh(Se.slot,Oe.slot)||J.push({command:Gr.setSlot,args:[Te,Oe.slot]}),s.bh(Se.filter,Oe.filter)||J.push({command:Gr.setFilter,args:[Te,Oe.filter]}),s.bh(Se.minzoom,Oe.minzoom)&&s.bh(Se.maxzoom,Oe.maxzoom)||J.push({command:Gr.setLayerZoomRange,args:[Te,Oe.minzoom,Oe.maxzoom]}),Se)Se.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?cs(Se[Re],Oe[Re],J,Te,Re.slice(6),Gr.setPaintProperty):s.bh(Se[Re],Oe[Re])||J.push({command:Gr.setLayerProperty,args:[Te,Re,Oe[Re]]}));for(Re in Oe)Oe.hasOwnProperty(Re)&&!Se.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?cs(Se[Re],Oe[Re],J,Te,Re.slice(6),Gr.setPaintProperty):s.bh(Se[Re],Oe[Re])||J.push({command:Gr.setLayerProperty,args:[Te,Re,Oe[Re]]}))}else J.push({command:Gr.removeLayer,args:[Te]}),ke=ce[ce.lastIndexOf(Te)+1],J.push({command:Gr.addLayer,args:[Oe,ke]})}(V,k.layers,M)}catch(B){console.warn("Unable to compute style diff:",B),M=[{command:Gr.setStyle,args:[k]}]}return M}(this.serialize(),r).filter(w=>!(w.command in qa));if(f.length===0)return!1;const _=f.filter(w=>!(w.command in gc));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);const v=[];return f.forEach(w=>{v.push(this[w.command].apply(this,w.args))}),a&&Promise.all(v).then(a),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(r,a){return this.getImage(r)?this.fire(new s.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,this.scope,a),this._afterImageUpdated(r),this)}updateImage(r,a){this.imageManager.updateImage(r,this.scope,a)}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._afterImageUpdated(r),this):this.fire(new s.t(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(r),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,a,f={}){return this._checkLoaded(),this._validate(Ce,`models.${r}`,a,null,f)||(this.modelManager.addModel(r,a,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new s.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,a,f={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(Co,`sources.${r}`,a,null,f))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const _=$s(r,a,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const v=w=>{const k=(w?"symbol:":"other:")+_.id,M=s.av(k,this.scope),B=this._sourceCaches[k]=new $i(M,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=B,B.onAdd(this.map)};v(!1),a.type!=="vector"&&a.type!=="geojson"||v(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const a=this.getOwnSource(r);if(!a)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new s.t(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new s.t(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const f=this.getOwnSourceCaches(r);for(const _ of f){const v=s.cm(_.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(_.id),_.fire(new s.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,a){this._checkLoaded(),this.getOwnSource(r).setData(a),this._changes.setDirty()}getOwnSource(r){const a=this.getOwnSourceCache(r);return a&&a.getSource()}getOwnSources(){const r=[];for(const a in this._otherSourceCaches){const f=this.getOwnSourceCache(a);f&&r.push(f.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const a in r){const f=r[a]._tiles;for(const _ in f){const v=f[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const _ of r){if(this._validate(Ns,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(_),v.updateTransitions(a)}else this.ambientLight=new pn(_,Or||(Or=new s.a0({color:new s.a1(s._.properties_light_ambient.color),intensity:new s.a1(s._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(_),v.updateTransitions(a)}else this.directionalLight=new pn(_,mn||(mn=new s.a0({direction:new s.ad(s._.properties_light_directional.direction),color:new s.a1(s._.properties_light_directional.color),intensity:new s.a1(s._.properties_light_directional.intensity),"cast-shadows":new s.a1(s._.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.a1(s._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const f=new s.a3(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,a=this.ambientLight;if(!r||!a)return;const f=V=>.2126*(V[0]<=.03928?V[0]/12.92:Math.pow((V[0]+.055)/1.055,2.4))+.7152*(V[1]<=.03928?V[1]/12.92:Math.pow((V[1]+.055)/1.055,2.4))+.0722*(V[2]<=.03928?V[2]/12.92:Math.pow((V[2]+.055)/1.055,2.4)),_=r.properties.get("color").toRenderColor(null).toArray01(),v=r.properties.get("intensity"),w=r.properties.get("direction"),k=1-s.c7(w.x,w.y,w.z)[2]/90,M=f(_)*v*k,B=a.properties.get("color").toRenderColor(null).toArray01(),z=a.properties.get("intensity");return(M+f(B)*z)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(s.cn(r)){const a=s.co(r),f=this.fragments.find(({id:v})=>v===a);if(!f)throw new Error(`Style import not found: ${r}`);const _=s.cm(r);return f.style.getFragmentStyle(_)}{const a=this.fragments.find(({id:f})=>f===r);if(!a)throw new Error(`Style import not found: ${r}`);return a.style}}getConfigProperty(r,a){const f=this.getFragmentStyle(r);if(!f)return null;const _=s.av(a,f.scope),v=f.options.get(_),w=v?v.value||v.default:null;return w?w.serialize():null}setConfigProperty(r,a,f){const _=this.getFragmentStyle(r);if(!_)return;const v=_.stylesheet.schema;if(!v||!v[a])return;const w=s.M(f);if(w.result!=="success")return void To(this,w.value);const k=w.value.expression,M=s.av(a,_.scope),B=_.options.get(M);if(!B)return;let z;const{minValue:V,maxValue:U,stepValue:q,type:Y,values:J}=v[a],ee=s.M(v[a].default);ee.result==="success"&&(z=ee.value.expression),z?(this.options.set(M,{...B,value:k,default:z,minValue:V,maxValue:U,stepValue:q,type:Y,values:J}),this.updateConfigDependencies(a)):this.fire(new s.t(new Error(`No schema defined for the config option "${a}" in the "${r}" fragment.`)))}getConfig(r){const a=this.getFragmentStyle(r);if(!a)return null;const f=a.stylesheet.schema;if(!f)return null;const _={};for(const v in f){const w=s.av(v,a.scope),k=a.options.get(w),M=k?k.value||k.default:null;_[v]=M?M.serialize():null}return _}setConfig(r,a){const f=this.getFragmentStyle(r);f&&(f.updateConfig(a,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const a=this.getFragmentStyle(r);return a?a.stylesheet.schema:null}setSchema(r,a){const f=this.getFragmentStyle(r);f&&(f.stylesheet.schema=a,f.updateConfig(f._config,a),this.updateConfigDependencies())}updateConfig(r,a){if(this._config=r,r||a)if(a)for(const f in a){let _,v;const w=s.M(a[f].default);if(w.result==="success"&&(_=w.value.expression),r&&r[f]!==void 0){const U=s.M(r[f]);U.result==="success"&&(v=U.value.expression)}const{minValue:k,maxValue:M,stepValue:B,type:z,values:V}=a[f];if(_){const U=s.av(f,this.scope);this.options.set(U,{default:_,value:v,minValue:k,maxValue:M,stepValue:B,type:z,values:V})}else this.fire(new s.t(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new s.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(r){for(const a of this._configDependentLayers){const f=this.getLayer(a);if(f){if(r&&!f.configDependencies.has(r))continue;f.possiblyEvaluateVisibility(),this._updateLayer(f)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(a=>{if(a._styleColorTheme.colorTheme){const f=a._evaluateColorThemeData(a._styleColorTheme.colorTheme);(!a._styleColorTheme.lut&&f!==""||a._styleColorTheme.lut&&f!==a._styleColorTheme.lut.data)&&a.setColorTheme(a._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(r,a,f={}){this._checkLoaded();const _=r.id;if(this._layers[_])return void this.fire(new s.t(new Error(`Layer with id "${_}" already exists on this map`)));let v;if(r.type==="custom"){if(To(this,s.cp(r)))return;v=s.cq(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=s.cl(r),r=s.l(r,{source:_})),this._validate(nt,`layers.${_}`,r,{arrayIndex:-1},f))return;v=s.cq(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize()}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let w=this._order.length;if(a){const z=this._order.indexOf(a);if(z===-1)return void this.fire(new s.t(new Error(`Layer with id "${a}" does not exist on this map.`)));v.slot===this._layers[a].slot?w=z:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=v;const k=this.getOwnLayerSourceCache(v),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&v.canCastShadows()&&M&&(k.castsShadows=!0);const B=this._changes.getRemovedLayer(v);if(B&&v.source&&k&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const z=s.av(v.source,v.scope);B.type!==v.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),k.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(r,a){this._checkLoaded();const f=this._checkLayer(r);if(!f||r===a)return;const _=this._order.indexOf(r);this._order.splice(_,1);let v=this._order.length;if(a){const w=this._order.indexOf(a);if(w===-1)return void this.fire(new s.t(new Error(`Layer with id "${a}" does not exist on this map.`)));f.slot===this._layers[a].slot?v=w:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const a=this._checkLayer(r);if(!a)return;a.setEventedParent(null);const f=this._order.indexOf(r);this._order.splice(f,1),delete this._layers[r],delete this._serializedLayers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const _=this.getOwnLayerSourceCache(a);if(_&&_.castsShadows){let v=!1;for(const w in this._layers)if(this._layers[w].source===a.source&&this._layers[w].canCastShadows()){v=!0;break}_.castsShadows=v}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const a in this._layers)if(this._layers[a].type===r)return!0;return!1}setLayerZoomRange(r,a,f){this._checkLoaded();const _=this._checkLayer(r);_&&(_.minzoom===a&&_.maxzoom===f||(a!=null&&(_.minzoom=a),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,a){this._checkLoaded();const f=this._checkLayer(r);f&&f.slot!==a&&(f.slot=a,this._updateLayer(f))}setFilter(r,a,f={}){this._checkLoaded();const _=this._checkLayer(r);if(_&&!s.bh(_.filter,a))return a==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(ne,`layers.${_.id}.filter`,a,{layerType:_.type},f)||(_.filter=s.cl(a),this._updateLayer(_)))}getFilter(r){const a=this._checkLayer(r);if(a)return s.cl(a.filter)}setLayoutProperty(r,a,f,_={}){this._checkLoaded();const v=this._checkLayer(r);if(v&&!s.bh(v.getLayoutProperty(a),f)){if(f!=null&&(!_||_.validate!==!1)&&To(v,ve.call(to,{key:`layers.${r}.layout.${a}`,layerType:v.type,objectKey:a,value:f,styleSpec:s._,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(a,f),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(r,a){const f=this._checkLayer(r);if(f)return f.getLayoutProperty(a)}setPaintProperty(r,a,f,_={}){this._checkLoaded();const v=this._checkLayer(r);if(!v||s.bh(v.getPaintProperty(a),f)||f!=null&&(!_||_.validate!==!1)&&To(v,oe.call(to,{key:`layers.${r}.paint.${a}`,layerType:v.type,objectKey:a,value:f,styleSpec:s._})))return;const w=v.setPaintProperty(a,f);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),w&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(r,a){const f=this._checkLayer(r);if(f)return f.getPaintProperty(a)}setFeatureState(r,a){this._checkLoaded();const f=r.source,_=r.sourceLayer,v=this._checkSource(f);if(!v)return;const w=v.type;if(w==="geojson"&&_)return void this.fire(new s.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new s.t(new Error("The feature id parameter must be provided.")));const k=this.getOwnSourceCaches(f);for(const M of k)M.setFeatureState(_,r.id,a)}removeFeatureState(r,a){this._checkLoaded();const f=r.source,_=this._checkSource(f);if(!_)return;const v=_.type,w=v==="vector"?r.sourceLayer:void 0;if(v==="vector"&&!w)return void this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new s.t(new Error("A feature id is required to remove its specific state property.")));const k=this.getOwnSourceCaches(f);for(const M of k)M.removeFeatureState(w,r.id,a)}getFeatureState(r){this._checkLoaded();const a=r.source,f=r.sourceLayer,_=this._checkSource(a);if(_){if(_.type!=="vector"||f)return r.id===void 0&&this.fire(new s.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(f,r.id);this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=s.l({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),a=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return s.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(r){this._changes.updateLayer(r);const a=this.getLayerSourceCache(r),f=s.av(r.source,r.scope),_=this._changes.getUpdatedSourceCaches();r.source&&!_[f]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),a.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const a=k=>this._mergedLayers[k].is3D(),f=this.order,_={},v=[];for(let k=f.length-1;k>=0;k--){const M=f[k];if(a(M)){_[M]=k;for(const B of r){const z=B[M];if(z)for(const V of z)v.push(V)}}}v.sort((k,M)=>M.intersectionZ-k.intersectionZ);const w=[];for(let k=f.length-1;k>=0;k--){const M=f[k];if(a(M))for(let B=v.length-1;B>=0;B--){const z=v[B].feature;if(z.layer&&_[z.layer.id]<k)break;w.push(z),v.pop()}else for(const B of r){const z=B[M];if(z)for(const V of z)w.push(V.feature)}}return w}queryRenderedFeatures(r,a,f){a&&a.filter&&this._validate(ne,"queryRenderedFeatures.filter",a.filter,null,a),a.scope=this.scope,a.availableImages=this._availableImages,a.serializedLayers=this._serializedLayers;const _={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.t(new Error("parameters.layers must be an Array."))),[];for(const B of a.layers){const z=this._mergedLayers[B];if(!z)return this.fire(new s.t(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];_[z.source]=!0}}const v=[],w=a.serializedLayers||{},k=a&&a.layers?a.layers.some(B=>{const z=this.getLayer(B);return z&&z.is3D()}):this.has3DLayers(),M=Bn.createFromScreenPoints(r,f);for(const B in this._mergedSourceCaches){const z=this._mergedSourceCaches[B].getSource();if(!z||z.scope!==a.scope)continue;const V=this._mergedSourceCaches[B].getSource().id;a.layers&&!_[V]||v.push(Ml(this._mergedSourceCaches[B],this._mergedLayers,w,M,a,f,k,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(B,z,V,U,q,Y,J){const ee={},re=Y.queryRenderedSymbols(U),he=[];for(const pe of Object.keys(re).map(Number))he.push(J[pe]);he.sort(Oa);for(const pe of he){const ce=pe.featureIndex.lookupSymbolFeatures(re[pe.bucketInstanceId],z,pe.bucketIndex,pe.sourceLayerIndex,q.filter,q.layers,q.availableImages,B);for(const ye in ce){const ge=ee[ye]=ee[ye]||[],Ae=ce[ye];Ae.sort((Te,Se)=>{const Oe=pe.featureSortOrder;if(Oe){const ke=Oe.indexOf(Te.featureIndex);return Oe.indexOf(Se.featureIndex)-ke}return Se.featureIndex-Te.featureIndex});for(const Te of Ae)ge.push(Te)}}for(const pe in ee)ee[pe].forEach(ce=>{const ye=ce.feature,ge=V(B[pe]);if(!ge)return;const Ae=ge.getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=Ae});return ee}(this._mergedLayers,w,this.getLayerSourceCache.bind(this),M.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,a){a&&a.filter&&this._validate(ne,"querySourceFeatures.filter",a.filter,null,a);const f=this.getOwnSourceCaches(r);let _=[];for(const v of f)_=_.concat(La(v,a));return _}addSourceType(r,a,f){return Zo.getSourceType(r)?f(new Error(`A source type called "${r}" already exists.`)):(Zo.setSourceType(r,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:a.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,a,f={}){this._checkLoaded();const _=this.light.getLight();let v=!1;for(const k in r)if(!s.bh(r[k],_[k])){v=!0;break}if(!v)return;const w=this._getTransitionParameters();this.light.setLight(r,a,f),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,a=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=r;const _=r.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){const k="terrain-dem-src";this.addSource(k,f.source),f=s.cl(f),f=s.l(f,{source:k})}const v=s.l({},f),w={};if(this.terrain&&_){v.source=this.terrain.get().source;const k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(w.style=k.serialize())}if(this._validate(Vs,"terrain",v,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&a!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,a),this.fire(new s.x("data",{dataType:"style"}))}else{const v=this.terrain,w=v.get();for(const k of Object.keys(s._.terrain))!f.hasOwnProperty(k)&&s._.terrain[k].default&&(f[k]=s._.terrain[k].default);for(const k in r)if(!s.bh(r[k],w[k])){v.set(r,this.options),this.stylesheet.terrain=r;const M=this._getTransitionParameters({duration:0});v.updateTransitions(M),this.fire(new s.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const a=this.fog=new on(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!s.bh(a.get(),r)){a.set(r,this.options),this.stylesheet.fog=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createFog(r);this._markersNeedUpdate=!0}setColorTheme(r){this._checkLoaded();const a=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()};if(this._styleColorTheme.colorTheme=r,!r)return this._styleColorTheme.lut=null,void a();const f=this._evaluateColorThemeData(r);this._loadColorTheme(f).then(()=>{this.fire(new s.x("colorthemeset")),a()}).catch(_=>{s.w(`Couldn't set color theme: ${_}`)})}_getTransitionParameters(r){return{now:s.q.now(),transition:s.l(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],a=[];for(const f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?r.push(f):a.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...a)}_createTerrain(r,a){const f=this.terrain=new ut(r,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const a=this._layers[r];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const a=this._layers[r];a.type==="symbol"&&this._updateLayer(a)}}_validate(r,a,f,_,v={}){if(v&&v.validate===!1)return!1;const w=s.l({},this.serialize());return To(this,r.call(to,s.l({key:a,style:w,value:f,styleSpec:s._},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){const a=this.getSourceCaches(r);for(const f of a)f.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){const a=this.getSourceCaches(r);for(const f of a)f.resume(),f.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}updateSources(r){let a;this.directionalLight&&(a=pc(this.directionalLight));for(const f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(r,void 0,void 0,a)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const a=this._sourceCaches[r];a.resume(),a.reload()}}_updatePlacement(r,a,f,_,v,w,k=!1){let M=!1,B=!1;const z={},V={};for(const U of this._mergedOrder){const q=this._mergedLayers[U];if(q.type!=="symbol")continue;const Y=s.av(q.source,q.scope);let J=z[Y];if(!J){const re=this.getLayerSourceCache(q);if(!re)continue;const he=re.getRenderableIds(!0).map(pe=>re.getTileByID(pe));V[Y]=he.slice(),J=z[Y]=he.sort((pe,ce)=>ce.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(ce.tileID)?-1:1))}const ee=this.crossTileSymbolIndex.addLayer(q,J,a.center.lng,a.projection);M=M||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),k=k||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new s.x("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),a.zoom))&&(this.pauseablePlacement=new ds(a,this._mergedOrder,k,f,_,v,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,V),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),B=!0),M&&this.pauseablePlacement.placement.setStale()),B||M){this._buildingIndex.onNewFrame(a.zoom);for(let U=0;U<this._mergedOrder.length;U++){const q=this._mergedLayers[this._mergedOrder[U]];if(q.type!=="symbol")continue;const Y=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,z[s.av(q.source,q.scope)],U,Y?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,a){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:v})=>v===r.id)!==-1)return void this.fire(new s.t(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!a)return f.push(r),this._loadImports([r],!0);const _=f.findIndex(({id:v})=>v===a);return _===-1&&this.fire(new s.t(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,_).concat(r).concat(f.slice(_)),this._loadImports([r],!0,a)}updateImport(r,a){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(r);return _===-1?this:typeof a=="string"?(this.setImportUrl(r,a),this):(a.url&&a.url!==f[_].url&&this.setImportUrl(r,a.url),s.bh(a.config,f[_].config)||this.setImportConfig(r,a.config),s.bh(a.data,f[_].data)||this.setImportData(r,a.data),this)}moveImport(r,a){this._checkLoaded();let f=this.stylesheet.imports||[];const _=this.getImportIndex(r);if(_===-1)return this;const v=this.getImportIndex(a);if(v===-1)return this;const w=f[_],k=this.fragments[_];return f=f.filter(({id:M})=>M!==r),this.fragments=this.fragments.filter(({id:M})=>M!==r),this.stylesheet.imports=f.slice(0,v).concat(w).concat(f.slice(v)),this.fragments=this.fragments.slice(0,v).concat(k).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(r,a){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(r);if(_===-1)return this;f[_].url=a;const v=this.fragments[_];return v.style=this._createFragmentStyle(f[_]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(a),this}setImportData(r,a){this._checkLoaded();const f=this.getImportIndex(r),_=this.stylesheet.imports||[];return f===-1?this:a?(this.fragments[f].style.setState(a),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(r,_[f].url))}setImportConfig(r,a){this._checkLoaded();const f=this.getImportIndex(r),_=this.stylesheet.imports||[];if(f===-1)return this;a?_[f].config=a:delete _[f].config;const v=this.fragments[f],w=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=a,v.style.updateConfig(a,w),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const a=this.stylesheet.imports||[],f=this.getImportIndex(r);f!==-1&&(a.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(r){const a=(this.stylesheet.imports||[]).findIndex(f=>f.id===r);return a===-1&&this.fire(new s.t(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),a}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const a in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[a];f&&r.push(f.getSource())}return r}getSource(r,a){const f=this.getSourceCache(r,a);return f&&f.getSource()}getLayerSource(r){const a=this.getLayerSourceCache(r);return a&&a.getSource()}getSourceCache(r,a){const f=s.av(r,a);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(r){const a=s.av(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[r]&&a.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&a.push(this._mergedSymbolSourceCaches[r]),a}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const a in r){const f=r[a];f==="reload"?this.reloadSource(a):f==="clear"&&this.clearSource(a)}}updateLayers(r){const a=this._changes.getUpdatedPaintProperties();for(const f of a){const _=this.getLayer(f);_&&_.updateTransitions(r)}}getImages(r,a,f){this.imageManager.getImages(a.icons,a.scope,f),this._updateTilesForChangedImages();const _=v=>{v&&v.setDependencies(a.tileID.key,a.type,a.icons)};_(this._otherSourceCaches[a.source]),_(this._symbolSourceCaches[a.source])}getGlyphs(r,a,f){this.glyphManager.getGlyphs(a.stacks,a.scope,f)}getResource(r,a,f){return s.ct(a,f)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const a=[];return this._otherSourceCaches[r]&&a.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&a.push(this._symbolSourceCaches[r]),a}_isSourceCacheLoaded(r){const a=this.getOwnSourceCaches(r);return a.length===0?(this.fire(new s.t(new Error(`There is no source with ID '${r}'`))),!1):a.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,a){if(!this._clipLayerPresent&&r.type!=="fill-extrusion")return!1;const f=r.type==="fill-extrusion"&&r.sourceLayer==="building";if(r.is3D()){if(f||a&&a.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Zo.getSourceType=function(d){return js[d]},Zo.setSourceType=function(d,r){js[d]=r},Zo.registerForPluginStateChange=s.cc;var Ga=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Qs=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,dh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ru="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",gd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,_d=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,yd=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,vd=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,fh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,bd=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Nl=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const cl=[];H(Ga,cl),H(dh,cl),H(Qs,cl);const Ha={"_prelude_fog.vertex.glsl":_d,"_prelude_terrain.vertex.glsl":gd,"_prelude_shadow.vertex.glsl":bd,"_prelude_fog.fragment.glsl":yd,"_prelude_shadow.fragment.glsl":Nl,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":vd,"_prelude_raster_particle.glsl":fh},Vl={};se("",gd),se(yd,_d),se(Nl,bd),se(vd,""),se(fh,"");const _c=se(Qs,dh),Wa=Ga;var et={background:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:se("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:se(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:se(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:se("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:se("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:se("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:se(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:se(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:se(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:se(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:se("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:se("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:se(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:se(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:se("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:se(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ru),skyboxGradient:se(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ru),skyboxCapture:se(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:se(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:se(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:se(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:se(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:se("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function H(d,r){const a=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of a)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=f.split(" ");for(const v of _)r.includes(v)||r.push(v)}}function se(d,r){const a=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(B=>{const z=B.split(" ");return z[z.length-1]}),_=[...new Set(_)]);const v={},w=[],k=[];if(d=d.replace(a,(B,z)=>(k.push(z),"")),(r=r.replace(a,(B,z)=>(w.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...cl];H(d,M),H(r,M);for(const B of[...w,...k])Ha[B]||console.error(`Undefined include: ${B}`),Vl[B]||(Vl[B]=[],H(Ha[B],Vl[B])),M=[...M,...Vl[B]];return{fragmentSource:d=d.replace(f,(B,z,V,U,q)=>(v[q]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${V} ${U} ${q};
#else
uniform ${V} ${U} u_${q};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${V} ${U} ${q} = u_${q};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${V} ${U} ${q};
#endif
`:z==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(f,(B,z,V,U,q)=>{const Y=U==="float"?"vec2":U,J=q.match(/color/)?"color":Y;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${V} ${U} a_${q};
#endif
`:v[q]?z==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${V} ${Y} a_${q};
out ${V} ${U} ${q};
#else
uniform ${V} ${U} u_${q};
#endif
`:z==="initialize"?J==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${V} ${U} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${J}(a_${q}, u_${q}_t);
#else
    ${V} ${U} ${q} = u_${q};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${V} ${U} a_${q};
    out ${V} ${U} ${q};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${V} ${Y} a_${q};
#else
uniform ${V} ${U} u_${q};
#endif
`:z==="define-instanced"?J==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${V} ${U} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${V} ${Y} a_${q};
#else
uniform ${V} ${U} u_${q};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${V} ${U} ${q} = a_${q};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${V} ${U} ${q} = a_${q};
#else
    ${V} ${U} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${V} ${U} ${q} = unpack_mix_${J}(a_${q}, u_${q}_t);
#else
    ${V} ${U} ${q} = u_${q};
#endif
`}),staticAttributes:_,usedDefines:M,vertexIncludes:w,fragmentIncludes:k}}class Qe{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,a,f,_,v,w,k,M){this.context=r;let B=this.boundPaintVertexBuffers.length!==_.length;for(let V=0;!B&&V<_.length;V++)this.boundPaintVertexBuffers[V]!==_[V]&&(B=!0);let z=this.boundDynamicVertexBuffers.length!==k.length;for(let V=0;!z&&V<k.length;V++)this.boundDynamicVertexBuffers[V]!==k[V]&&(z=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==f||B||z||this.boundIndexBuffer!==v||this.boundVertexOffset!==w)this.freshBind(a,f,_,v,w,k,M);else{r.bindVertexArrayOES.set(this.vao);for(const V of k)V&&(V.bind(),M&&V.instanceCount&&V.setVertexAttribDivisor(r.gl,a,M));v&&v.dynamicDraw&&v.bind()}}freshBind(r,a,f,_,v,w,k){const M=r.numAttributes,B=this.context,z=B.gl;this.vao&&this.destroy(),this.vao=B.gl.createVertexArray(),B.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=w,a.enableAttributes(z,r),a.bind(),a.setVertexAttribPointers(z,r,v);for(const V of f)V.enableAttributes(z,r),V.bind(),V.setVertexAttribPointers(z,r,v);for(const V of w)V&&(V.enableAttributes(z,r),V.bind(),V.setVertexAttribPointers(z,r,v),k&&V.instanceCount&&V.setVertexAttribDivisor(z,r,k));_&&_.bind(),B.currentNumAttributes=M}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function $t(d,r){const a=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new s.a5(0,f/a).toLngLat().lat,new s.a5(0,(f+1)/a).toLngLat().lat]}function gr(d,r,a,f,_,v,w){const k=d.context,M=k.gl,B=a.hillshadeFBO;if(!B)return;d.prepareDrawTile();const z=d.isTileAffectedByFog(r),V=d.getOrCreateProgram("hillshade",{overrideFog:z});k.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,B.colorAttachment.get());const U=((ee,re,he,pe)=>{const ce=he.paint.get("hillshade-shadow-color"),ye=he.paint.get("hillshade-highlight-color"),ge=he.paint.get("hillshade-accent-color"),Ae=he.paint.get("hillshade-emissive-strength");let Te=s.bB(he.paint.get("hillshade-illumination-direction"));if(he.paint.get("hillshade-illumination-anchor")==="viewport")Te-=ee.transform.angle;else if(ee.style&&ee.style.enable3dLights()&&ee.style.directionalLight){const Oe=ee.style.directionalLight.properties.get("direction"),ke=s.c7(Oe.x,Oe.y,Oe.z);Te=s.bB(ke[1])}const Se=!ee.options.moving;return{u_matrix:pe||ee.transform.calculateProjMatrix(re.tileID.toUnwrapped(),Se),u_image:0,u_latrange:$t(0,re.tileID),u_light:[he.paint.get("hillshade-exaggeration"),Te],u_shadow:ce.toRenderColor(he.lut),u_highlight:ye.toRenderColor(he.lut),u_emissive_strength:Ae,u_accent:ge.toRenderColor(he.lut)}})(d,a,f,d.terrain?r.projMatrix:null);d.uploadCommonUniforms(k,V,r.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:Y,tileBoundsSegments:J}=d.getTileBoundsBuffers(a);V.draw(d,M.TRIANGLES,_,v,w,cr.disabled,U,f.id,q,Y,J)}function Pr(d,r,a){if(!r.needsDEMTextureUpload)return;const f=d.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||d.getTileTexture(a.stride);const v=a.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new s.T(f,v,_.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function bn(d,r,a){const f=d.context,_=f.gl;if(!r.dem)return;const v=r.dem;if(f.activeTexture.set(_.TEXTURE1),Pr(d,r,v),!r.demTexture)return;r.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const w=v.dim;f.activeTexture.set(_.TEXTURE0);let k=r.hillshadeFBO;if(!k){const U=new s.T(f,{width:w,height:w,data:null},_.RGBA8);U.bind(_.LINEAR,_.CLAMP_TO_EDGE),k=r.hillshadeFBO=f.createFramebuffer(w,w,!0,"renderbuffer"),k.colorAttachment.set(U.texture)}f.bindFramebuffer.set(k.framebuffer),f.viewport.set([0,0,w,w]);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:B,tileBoundsSegments:z}=d.getMercatorTileBoundsBuffers(),V=[];d.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(d,_.TRIANGLES,fe.disabled,st.disabled,te.unblended,cr.disabled,((U,q)=>{const Y=q.stride,J=s.a6.mat4.create();return s.a6.mat4.ortho(J,0,s.ab,-s.ab,0,0,1),s.a6.mat4.translate(J,J,[0,-s.ab,0]),{u_matrix:J,u_image:1,u_dimension:[Y,Y],u_zoom:U.overscaledZ}})(r.tileID,v),a.id,M,B,z),r.needsHillshadePrepare=!1}class Nr{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fo extends Nr{getDefault(){return s.bz.transparent}set(r){const a=this.current;(r.r!==a.r||r.g!==a.g||r.b!==a.b||r.a!==a.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Bo extends Nr{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Xo extends Nr{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class fs extends Nr{getDefault(){return[!0,!0,!0,!0]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ko extends Nr{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Za extends Nr{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class ps extends Nr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const a=this.current;(r.func!==a.func||r.ref!==a.ref||r.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Ul extends Nr{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class xa extends Nr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=r,this.dirty=!1}}class xd extends Nr{getDefault(){return[0,1]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class ul extends Nr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=r,this.dirty=!1}}class op extends Nr{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class bv extends Nr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.BLEND):a.disable(a.BLEND),this.current=r,this.dirty=!1}}class sp extends Nr{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ap extends Nr{getDefault(){return s.bz.transparent}set(r){const a=this.current;(r.r!==a.r||r.g!==a.g||r.b!==a.b||r.a!==a.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class lp extends Nr{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class cp extends Nr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=r,this.dirty=!1}}class Wg extends Nr{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Zg extends Nr{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let xv=class extends Nr{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class ph extends Nr{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class mh extends Nr{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Xg extends Nr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class ks extends Nr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class up extends Nr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class wd extends Nr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Td extends Nr{getDefault(){return null}set(r){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class hp extends Nr{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class dp extends Nr{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Ed extends Nr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class fp extends Nr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class gh extends Nr{constructor(r,a){super(r),this.context=r,this.parent=a}getDefault(){return null}}class Id extends gh{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class pp extends gh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Kg extends gh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class nu extends pp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const wv=(d,r,a)=>({u_matrix:d,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:a}),Yg=(d,r,a,f,_,v,w,k,M,B,z,V,U,q,Y,J)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:a,u_zoom_transition:_,u_merc_center:v,u_image0:0,u_frustum_tl:w,u_frustum_tr:k,u_frustum_br:M,u_frustum_bl:B,u_globe_pos:z,u_globe_radius:V,u_viewport:U,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:Y});function Jg(d,r){return d!=null&&r!=null&&!(!d.hasData()||!r.hasData())&&d.demTexture!=null&&r.demTexture!=null&&d.tileID.key!==r.tileID.key}const iu=new class{constructor(){this.operations={}}newMorphing(d,r,a,f,_){if(d in this.operations){const v=this.operations[d];v.to.tileID.key!==a.tileID.key&&(v.queued=a)}else this.operations[d]={startTime:f,phase:0,duration:_,from:r,to:a,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const r=this.operations[d];return{from:r.from,to:r.to,phase:r.phase}}update(d){for(const r in this.operations){const a=this.operations[r];for(a.phase=(d-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,d)){delete this.operations[r];break}}}_nextOp(d,r){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=r,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Qg={0:null,1:"TERRAIN_VERTEX_MORPHING"};function e_(d,r,a){if(r===0)return 0;const f=r<1&&a===514?.25/r:1;return 6*Math.pow(1.5,22-d)*Math.max(r,1)*f}function mp(d,r){const a=1<<d.z;return!r&&(d.x===0||d.x===a-1)||d.y===0||d.y===a-1}const _h=d=>({u_matrix:d});function Ad(d,r,a,f,_){if(_>0){const v=s.q.now(),w=(v-d.timeAdded)/_,k=r?(v-r.timeAdded)/_:-1,M=a.getSource(),B=f.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),z=!r||Math.abs(r.tileID.overscaledZ-B)>Math.abs(d.tileID.overscaledZ-B),V=z&&d.refreshedUponExpiration?1:s.ap(z?w:1-k,0,1);return d.refreshedUponExpiration&&w>=1&&(d.refreshedUponExpiration=!1),r?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class ou extends $i{constructor(r){const a={type:"raster-dem",maxzoom:r.transform.maxZoom},f=new s.cd(s.ce(),null),_=$s("mock-dem",a,f,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,a){r.state="loaded",a(null)}}class t_ extends $i{constructor(r){const a=$s("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new s.cd(s.ce(),null),r.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,a,f){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,w)=>{if(v[w.key]="",!this._tiles[w.key]){const k=new jo(w,this._source.tileSize*w.overscaleFactor(),r.tileZoom);k.state="loaded",this._tiles[w.key]=k}return v},{});for(const v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){const a=this.proxyCachedFBO[r];if(a!==void 0){const f=Object.values(a);this.renderCachePool.push(...f),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class gp extends s.aA{constructor(r,a,f){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=a,this.projMatrix=f}}class _p extends s.cE{constructor(r,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,_,v]=function(M){const B=new s.a_,z=new s.aO,V=131;B.reserve(17161),z.reserve(33800);const U=s.ab/128,q=s.ab+U/2,Y=q+U;for(let ee=-U;ee<Y;ee+=U)for(let re=-U;re<Y;re+=U){const he=re<0||re>q||ee<0||ee>q?24575:0,pe=s.ap(Math.round(re),0,s.ab),ce=s.ap(Math.round(ee),0,s.ab);B.emplaceBack(pe+he,ce)}const J=(ee,re)=>{const he=re*V+ee;z.emplaceBack(he+1,he,he+V),z.emplaceBack(he+V,he+V+1,he+1)};for(let ee=1;ee<129;ee++)for(let re=1;re<129;re++)J(re,ee);return[0,129].forEach(ee=>{for(let re=0;re<130;re++)J(re,ee),J(ee,re)}),[B,z,32768]}(),w=r.context;this.gridBuffer=w.createVertexBuffer(f,s.b0.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=s.b1.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=s.b1.simpleSegment(0,0,f.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new t_(a.map),this.orthoMatrix=s.a6.mat4.create(),s.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.ab,0,s.ab,0,1);const k=w.gl;this._overlapStencilMode=new st({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ou(a.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,a,f){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const _=r.terrain.properties,v=r.terrain.drapeRenderMode===0,w=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const k=r.terrain&&r.terrain.scope,M=_.get("source"),B=v?this._mockSourceCache:r.getSourceCache(M,k);if(!B)return void s.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=B,this._exaggeration=w?this.calculateExaggeration(a):_.get("exaggeration"),!a.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(a,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),a.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(r){const a=this._previousCameraAltitude,f=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=f;const _=a!=null?f-a:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const v=r.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(v);let k=v-this._previousZoom;const M=this._previousUpdateTimestamp;let B=v;this._evaluationZoom!=null&&(B=this._evaluationZoom,Math.abs(v-B)>.5&&(k=.5*(v-B+k)),k*_<0&&(B+=k)),this._evaluationZoom=B;const z=w.getExaggeration(B),V=z===w.getExaggeration(Math.max(0,B-.1));if(V&&Math.abs(z-this._exaggeration)<.01)return z;let U=Math.min(.1,.00375*(this._updateTimestamp-M));return(V||z<.1||Math.abs(k)<1e-4)&&(U=Math.min(.2,4*U)),s.aa(this._exaggeration,z,U)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(s.a5.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=a.getIds().map(M=>{const B=a.getTileByID(M).tileID;return B.projMatrix=f.calculateProjMatrix(B.toUnwrapped()),B});(function(M,B){const z=B.transform.pointCoordinate(B.transform.getCameraPoint()),V=new s.P(z.x,z.y);M.sort((U,q)=>{if(q.overscaledZ-U.overscaledZ)return q.overscaledZ-U.overscaledZ;const Y=new s.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),J=new s.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ee=V.mult(1<<U.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(Y)-ee.distSqr(J)})})(_,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},_.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const M in w){const B=w[M];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,r[M],v),B.usedForTerrain))continue;const z=r[M];B.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[a.id]=_.map(M=>new gp(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const k={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const B=this.terrainTileForTile[M.key];if(!B)continue;const z=B.tileID.key;z in k||(this._visibleDemTiles.push(B),k[z]=z)}}_assignTerrainTiles(r){this._initializing||r.forEach(a=>{if(this.terrainTileForTile[a.key])return;const f=this._findTileCoveringTileID(a,this.sourceCache);f&&(this.terrainTileForTile[a.key]=f)})}_prepareDEMTextures(){const r=this.painter.context,a=r.gl;for(const f in this.terrainTileForTile){const _=this.terrainTileForTile[f],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(a.TEXTURE1),Pr(this.painter,_,v))}}_prepareDemTileUniforms(r,a,f,_){if(!a||a.demTexture==null)return!1;const v=r.tileID.canonical,w=Math.pow(2,a.tileID.canonical.z-v.z),k=_||"";return f[`u_dem_tl${k}`]=[v.x*w%1,v.y*w%1],f[`u_dem_scale${k}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const a=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;const v=_.dem.tree.minimums[0];return v>0&&r++,f+v},0);return r?a/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,a=r.gl;r.activeTexture.set(a.TEXTURE2);const f=this._getLoadedAreaMinimum(),_=new s.cF({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(_,{premultiply:!1}):v=this._emptyDEMTexture=new s.T(r,_,a.R32F,{premultiply:!1}),v}setupElevationDraw(r,a,f){const _=this.painter.context,v=_.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let k=null,M=null,B=1;if(f&&f.morphing&&this._useVertexMorphing){const q=f.morphing.srcDemTile,Y=f.morphing.dstDemTile;B=f.morphing.phase,q&&Y&&(this._prepareDemTileUniforms(r,q,w,"_prev")&&(M=q),this._prepareDemTileUniforms(r,Y,w)&&(k=Y))}const z=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let V=null;var U;if(this.enabled?M&&k?(V=k.demTexture,_.activeTexture.set(v.TEXTURE4),M.demTexture.bind(z(M),v.CLAMP_TO_EDGE),w.u_dem_lerp=B):(k=this.terrainTileForTile[r.tileID.key],V=this._prepareDemTileUniforms(r,k,w)?k.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,_.activeTexture.set(v.TEXTURE2),V&&(w.u_dem_size=(U=V).size[0]===1?1:U.size[0]-2,V.bind(z(k),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,a,w),f&&f.useMeterToDem&&k){const q=(1<<k.tileID.canonical.z)*s.bD(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=q}if(f&&f.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),a.setTerrainUniformValues(_,w),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,r.tileID.canonical,f&&f.useDenormalizedUpVectorScale);a.setGlobeUniformValues(_,q)}}globeUniformValues(r,a,f){const _=r.projection;return{u_tile_tl_up:_.upVector(a,0,0),u_tile_tr_up:_.upVector(a,s.ab,0),u_tile_br_up:_.upVector(a,s.ab,s.ab),u_tile_bl_up:_.upVector(a,0,s.ab),u_tile_up_scale:f?s.cG(1):_.upVectorScale(a,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const a=this.painter,f=this.painter.context;r.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,v,w,k,M){if(_.transform.projection.name==="globe")(function(B,z,V,U,q){const Y=B.context,J=Y.gl;let ee,re;const he=B.transform,pe=s.cx(B,Y,he),ce=(Xe,ht)=>{if(re===ht)return;const bt=[Qg[ht],"PROJECTION_GLOBE_VIEW"];pe&&bt.push("CUSTOM_ANTIALIASING");const ct=B.isTileAffectedByFog(Xe);ee=B.getOrCreateProgram("globeRaster",{defines:bt,overrideFog:ct}),re=ht},ye=B.colorModeForRenderPass(),ge=new fe(J.LEQUAL,fe.ReadWrite,B.depthRangeFor3D);iu.update(q);const Ae=s.cy(he),Te=[s.am(he.center.lng),s.at(he.center.lat)],Se=B.globeSharedBuffers,Oe=[he.width*s.q.devicePixelRatio,he.height*s.q.devicePixelRatio],ke=Float32Array.from(he.globeMatrix),Re={useDenormalizedUpVectorScale:!0};{const Xe=B.transform,ht=e_(Xe.zoom,z.exaggeration(),z.sourceCache._source.tileSize);re=-1;const bt=J.TRIANGLES;for(const ct of U){const Rt=V.getTile(ct),Ke=st.disabled,gt=z.prevTerrainTileForTile[ct.key],pt=z.terrainTileForTile[ct.key];Jg(gt,pt)&&iu.newMorphing(ct.key,gt,pt,q,250),Y.activeTexture.set(J.TEXTURE0),Rt.texture&&Rt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Pt=iu.getMorphValuesForProxy(ct.key),Lt=Pt?1:0;Pt&&s.C(Re,{morphing:{srcDemTile:Pt.from,dstDemTile:Pt.to,phase:s.cw(Pt.phase)}});const yt=s.cz(ct.canonical),Tt=s.cA(yt.getCenter().lat),_r=s.cB(ct.canonical,yt,Tt,Xe.worldSize/Xe._pixelsPerMercatorPixel),Nt=s.b5(s.cC(ct.canonical)),Qt=Yg(Xe.expandedFarZProjMatrix,ke,Ae,Nt,s.a9(Xe.zoom),Te,Xe.frustumCorners.TL,Xe.frustumCorners.TR,Xe.frustumCorners.BR,Xe.frustumCorners.BL,Xe.globeCenterInViewSpace,Xe.globeRadius,Oe,ht,Xe._farZ,_r);if(ce(ct,Lt),ee&&(z.setupElevationDraw(Rt,ee,Re),B.uploadCommonUniforms(Y,ee,ct.toUnwrapped()),Se)){const[kr,ar,Tr]=Se.getGridBuffers(Tt,ht!==0);ee.draw(B,bt,ge,Ke,ye,cr.backCCW,Qt,"globe_raster",kr,ar,Tr)}}}if(Se&&(B.renderDefaultNorthPole||B.renderDefaultSouthPole)){const Xe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&Xe.push("CUSTOM_ANTIALIASING"),ee=B.getOrCreateProgram("globeRaster",{defines:Xe});for(const ht of U){const{x:bt,y:ct,z:Rt}=ht.canonical,Ke=ct===0,gt=ct===(1<<Rt)-1,[pt,Pt,Lt,yt]=Se.getPoleBuffers(Rt,!1);if(yt&&(Ke||gt)){const Tt=V.getTile(ht);Y.activeTexture.set(J.TEXTURE0),Tt.texture&&Tt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let _r=s.cD(Rt,bt,he);const Nt=s.b5(s.cC(ht.canonical)),Qt=(kr,ar)=>kr.draw(B,J.TRIANGLES,ge,st.disabled,ye,cr.disabled,Yg(he.expandedFarZProjMatrix,_r,_r,Nt,0,Te,he.frustumCorners.TL,he.frustumCorners.TR,he.frustumCorners.BR,he.frustumCorners.BL,he.globeCenterInViewSpace,he.globeRadius,Oe,0,he._farZ),"globe_pole_raster",ar,Lt,yt);z.setupElevationDraw(Tt,ee,Re),B.uploadCommonUniforms(Y,ee,ht.toUnwrapped()),Ke&&B.renderDefaultNorthPole&&Qt(ee,pt),gt&&B.renderDefaultSouthPole&&(_r=s.a6.mat4.scale(s.a6.mat4.create(),_r,[1,-1,1]),Qt(ee,Pt))}}}})(_,v,w,k,M);else{const B=_.context,z=B.gl;let V,U;const q=_.shadowRenderer,Y=ba(_,_.longestCutoffRange),J=ye=>{if(U===ye)return;const ge=[];ge.push(Qg[ye]),Y.shouldRenderCutoff&&ge.push("RENDER_CUTOFF"),V=_.getOrCreateProgram("terrainRaster",{defines:ge}),U=ye},ee=_.colorModeForRenderPass(),re=new fe(z.LEQUAL,fe.ReadWrite,_.depthRangeFor3D);iu.update(M);const he=_.transform,pe=e_(he.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let ce=[0,0,0];if(q){const ye=_.style.directionalLight,ge=_.style.ambientLight;ye&&ge&&(ce=Fl(_.style,ye,ge))}{U=-1;const ye=z.TRIANGLES,[ge,Ae]=[v.gridIndexBuffer,v.gridSegments];for(const Te of k){const Se=w.getTile(Te),Oe=st.disabled,ke=v.prevTerrainTileForTile[Te.key],Re=v.terrainTileForTile[Te.key];Jg(ke,Re)&&iu.newMorphing(Te.key,ke,Re,M,250),B.activeTexture.set(z.TEXTURE0),Se.texture&&Se.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Xe=iu.getMorphValuesForProxy(Te.key),ht=Xe?1:0;let bt;Xe&&(bt={morphing:{srcDemTile:Xe.from,dstDemTile:Xe.to,phase:s.cw(Xe.phase)}});const ct=wv(Te.projMatrix,mp(Te.canonical,he.renderWorldCopies)?pe/10:pe,ce);if(J(ht),!V)continue;v.setupElevationDraw(Se,V,bt);const Rt=Te.toUnwrapped();q&&q.setupShadows(Rt,V),_.uploadCommonUniforms(B,V,Rt,null,Y),V.draw(_,ye,re,Oe,ee,cr.backCCW,ct,"terrain_raster",v.gridBuffer,ge,Ae)}}}}(a,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const a=this.painter,f=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),k=a.style.order,M=[];let B=0;for(const z of v){const V=_.getTileByID(z.proxyTileKey),U=_.proxyCachedFBO[z.key]?_.proxyCachedFBO[z.key][r]:void 0,q=U!==void 0?_.renderCache[U]:this.pool[B++],Y=U!==void 0;if(V.texture=q.tex,Y&&!q.dirty){M.push(V.tileID);continue}let J;f.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(f.clear({color:s.bz.transparent,stencil:0}),q.dirty=!1);for(let ee=w.start;ee<=w.end;++ee){const re=a.style._mergedLayers[k[ee]];if(re.isHidden(a.transform.zoom))continue;const he=a.style.getLayerSourceCache(re),pe=he?this.proxyToSource[z.key][he.id]:[z];if(!pe)continue;const ce=pe;f.viewport.set([0,0,q.fb.width,q.fb.height]),J!==(he?he.id:null)&&(this._setupStencil(q,pe,re,he),J=he?he.id:null),a.renderLayer(a,he,re,ce)}if(this._drapedRenderBatches.length===0)for(const ee of this._pendingGroundEffectLayers){const re=a.style._mergedLayers[k[ee]];if(re.isHidden(a.transform.zoom))continue;const he=a.style.getLayerSourceCache(re),pe=he?this.proxyToSource[z.key][he.id]:[z];if(!pe)continue;const ce=pe;f.viewport.set([0,0,q.fb.width,q.fb.height]),J!==(he?he.id:null)&&(this._setupStencil(q,pe,re,he),J=he?he.id:null),a.renderLayer(a,he,re,ce)}this.renderedToTile?(q.dirty=!0,M.push(V.tileID)):Y||--B,B===5&&(B=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),w.end+1}postRender(){}isLayerOrderingCorrect(r){const a=r.order.length;let f=-1,_=a;for(let v=0;v<a;++v)this._style.isLayerDraped(r._mergedLayers[r.order[v]])?f=Math.max(f,v):_=Math.min(_,v);return _>f}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{r=Math.min(r,a.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,a,f){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const w=v.tileID,k=1<<w.overscaledZ,{x:M,y:B}=w.canonical,z=M/k,V=(M+1)/k,U=B/k,q=(B+1)/k;return{minx:z,miny:U,maxx:V,maxy:q,t:v.dem.tree.raycastRoot(z,U,V,q,r,a,f),tile:v}});_.sort((v,w)=>(v.t!==null?v.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const v of _){if(v.t==null)return null;const w=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,a,f);if(w!=null)return w}return null}_createFBO(){const r=this.painter.context,a=r.gl,f=this.drapeBufferSize;r.activeTexture.set(a.TEXTURE0);const _=new s.T(r,{width:f[0],height:f[1],data:null},a.RGBA8);_.bind(a.LINEAR,a.CLAMP_TO_EDGE);const v=r.createFramebuffer(f[0],f[1],!0,null);return v.colorAttachment.set(_.texture),v.depthAttachment=new nu(r,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const a=this._style._mergedLayers[r],f=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!f&&a.shouldRedrape():!f&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const f of this._style.getSources())if(f instanceof Cs){r=!0;break}if(!r)return;const a={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(_);if(v&&!a[v.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof s.a4){a[v.id]=!0;for(const w of this.proxyCoords){const k=this.proxyToSource[w.key][v.id];if(k)for(const M of k)this._clearRenderCacheForTile(v.id,M)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof ko){r=!0;break}if(!r)return;const a={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(_);if(!v||a[v.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const w=_.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const M=this.proxyToSource[k.key][v.id];if(M)for(const B of M){const z=Ad(v.getTile(B),v.findLoadedParent(B,0),v,this.painter.transform,w);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(v.id,B)}}}}_setupDrapedRenderBatches(){const r=this._style.order,a=r.length;if(a===0)return;const f=[];this._pendingGroundEffectLayers=[];let _,v=0,w=this._style._mergedLayers[r[v]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++v<a;)w=this._style._mergedLayers[r[v]];for(;v<a;++v){const k=this._style._mergedLayers[r[v]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?_===void 0&&(_=v):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),_!==void 0&&(f.push({start:_,end:v-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:v-1}),f.length!==0){const k=f[f.length-1];this._pendingGroundEffectLayers.every(M=>M>k.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(r){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const w=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let k=0;k<w.length;++k){const M=Object.values(w[k]);a.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,_=this._tilesDirty;for(let w=f.length-1;w>=0;w--){const k=f[w];if(a.getTileByID(k.key),a.proxyCachedFBO[k.key]!==void 0){const M=r[k.key],B=this.proxyToSource[k.key];let z=0;for(const V in B){const U=B[V],q=M[V];if(!q||q.length!==U.length||U.some((Y,J)=>Y!==q[J]||_[V]&&_[V].hasOwnProperty(Y.key))){z=-1;break}++z}for(const V in a.proxyCachedFBO[k.key])a.renderCache[a.proxyCachedFBO[k.key][V]].dirty=z<0||z!==Object.values(M).length}}const v=[...this._drapedRenderBatches];v.sort((w,k)=>k.end-k.start-(w.end-w.start));for(const w of v)for(const k of f){if(a.proxyCachedFBO[k.key])continue;let M=a.renderCachePool.pop();M===void 0&&a.renderCache.length<50&&(M=a.renderCache.length,a.renderCache.push(this._createFBO())),M!==void 0&&(a.proxyCachedFBO[k.key]={},a.proxyCachedFBO[k.key][w.start]=M,a.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(r,a,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,w=v.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let k;if(f.isTileClipped())k=a.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):st.disabled}_renderTileClippingMasks(r,a){const f=this.painter,_=this.painter.context,v=_.gl;f._tileClippingMaskIDs={},_.setColorMode(te.disabled),_.setDepthMode(fe.disabled);const w=f.getOrCreateProgram("clippingMask");for(const k of r){const M=f._tileClippingMaskIDs[k.key]=--a;w.draw(f,v.TRIANGLES,fe.disabled,new st({func:v.ALWAYS,mask:0},M,255,v.KEEP,v.KEEP,v.REPLACE),te.disabled,cr.disabled,_h(k.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(r){const a=this.painter.transform;if(r.x<0||r.x>a.width||r.y<0||r.y>a.height)return null;const f=[r.x,r.y,1,1];s.a6.vec4.transformMat4(f,f,a.pixelMatrixInverse),s.a6.vec4.scale(f,f,1/f[3]),f[0]/=a.worldSize,f[1]/=a.worldSize;const _=a._camera.position,v=s.bD(1,a.center.lat),w=[_[0],_[1],_[2]/v,0],k=s.a6.vec3.subtract([],f.slice(0,3),w);s.a6.vec3.normalize(k,k);const M=this.raycast(w,k,this._exaggeration);return M!==null&&M?(s.a6.vec3.scaleAndAdd(w,w,k,M),w[3]=w[2],w[2]*=v,w):null}_setupProxiedCoordsForOrtho(r,a,f){if(r.getSource()instanceof s.aD)return this._setupProxiedCoordsForImageSource(r,a,f);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let M=0;M<v.length;M++){const B=v[M],z=this._findTileCoveringTileID(B,r);if(z){const V=this._createProxiedId(B,z,f[B.key]&&f[B.key][r.id]);_.push(V),this.proxyToSource[B.key][r.id]=[V]}}let w=!1;const k=new Set;for(let M=0;M<a.length;M++){const B=r.getTile(a[M]);if(!B||!B.hasData())continue;const z=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==B.tileID.canonical.z){const V=this.proxyToSource[z.tileID.key][r.id],U=this._createProxiedId(z.tileID,B,f[z.tileID.key]&&f[z.tileID.key][r.id]);V?V.splice(V.length-1,0,U):this.proxyToSource[z.tileID.key][r.id]=[U];const q=this.proxyToSource[z.tileID.key][r.id];k.has(q)||k.add(q),_.push(U),w=!0}}if(this._sourceTilesOverlap[r.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const M of k)M.sort((B,z)=>z.overscaledZ-B.overscaledZ)}_setupProxiedCoordsForImageSource(r,a,f){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],v=this.proxyCoords,w=r.getSource(),k=w.tileID;if(!k)return;const M=new s.P(k.x,k.y)._div(1<<k.z),B=w.coordinates.map(s.a5.fromLngLat).reduce((V,U)=>(V.min.x=Math.min(V.min.x,U.x-M.x),V.min.y=Math.min(V.min.y,U.y-M.y),V.max.x=Math.max(V.max.x,U.x-M.x),V.max.y=Math.max(V.max.y,U.y-M.y),V),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(V,U)=>{const q=V.wrap+V.canonical.x/(1<<V.canonical.z),Y=V.canonical.y/(1<<V.canonical.z),J=s.ab/(1<<V.canonical.z),ee=U.wrap+U.canonical.x/(1<<U.canonical.z),re=U.canonical.y/(1<<U.canonical.z);return q+J<ee+B.min.x||q>ee+B.max.x||Y+J<re+B.min.y||Y>re+B.max.y};for(let V=0;V<v.length;V++){const U=v[V];for(let q=0;q<a.length;q++){const Y=r.getTile(a[q]);if(!Y||!Y.hasData()||z(U,Y.tileID))continue;const J=this._createProxiedId(U,Y,f[U.key]&&f[U.key][r.id]),ee=this.proxyToSource[U.key][r.id];ee?ee.push(J):this.proxyToSource[U.key][r.id]=[J],_.push(J)}}}_createProxiedId(r,a,f){let _=this.orthoMatrix;if(f){const v=f.find(w=>w.key===a.tileID.key);if(v)return v}if(a.tileID.key!==r.key){const v=r.canonical.z-a.tileID.canonical.z;let w,k,M;_=s.a6.mat4.create();const B=a.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(w=s.ab>>v,k=w*((a.tileID.canonical.x<<v)-r.canonical.x+B),M=w*((a.tileID.canonical.y<<v)-r.canonical.y)):(w=s.ab<<-v,k=s.ab*(a.tileID.canonical.x-(r.canonical.x+B<<-v)),M=s.ab*(a.tileID.canonical.y-(r.canonical.y<<-v))),s.a6.mat4.ortho(_,0,w,0,w,0,1),s.a6.mat4.translate(_,_,[k,M,0])}return new gp(a.tileID,r.key,_)}_findTileCoveringTileID(r,a){let f=a.getTile(r);if(f&&f.hasData())return f;const _=this._findCoveringTileCache[a.id],v=_[r.key];if(f=v?a.getTileByID(v):null,f&&f.hasData()||v===null)return f;let w=f?f.tileID:r,k=w.overscaledZ;const M=a.getSource().minzoom,B=[];if(!v){const V=a.getSource().maxzoom;if(r.canonical.z>=V){const U=r.canonical.z-V;a.getSource().reparseOverscaled?(k=Math.max(r.canonical.z+2,a.transform.tileZoom),w=new s.aA(k,r.wrap,V,r.canonical.x>>U,r.canonical.y>>U)):U!==0&&(k=V,w=new s.aA(k,r.wrap,V,r.canonical.x>>U,r.canonical.y>>U))}w.key!==r.key&&(B.push(w.key),f=a.getTile(w))}const z=V=>{B.forEach(U=>{_[U]=V}),B.length=0};for(k-=1;k>=M&&(!f||!f.hasData());k--){f&&z(f.tileID.key);const V=w.calculateScaledKey(k);if(f=a.getTileByID(V),f&&f.hasData())break;const U=_[V];if(U===null)break;U===void 0?B.push(V):f=a.getTileByID(U)}return z(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,a){let f=this._tilesDirty[r];f||(f=this._tilesDirty[r]={}),f[a.key]=!0}}function yp(d,r,a){const f=function(k,M,B){const z=s.a6.vec3.dot(M,k),V=s.a6.vec3.dot(B,[.2126,.7152,.0722]),U=(Y,J,ee)=>(1-ee)*Y+ee*J,q=U(1-.3*Math.min(V,1),1,Math.min(z+1,1));return U(.92,1,Math.asin(s.ap(M[2],-1,1))/Math.PI+.5)*q}(d,[0,0,1],r),_=[0,0,0];s.a6.vec3.scale(_,a.slice(0,3),f);const v=[0,0,0];s.a6.vec3.scale(v,r.slice(0,3),d[2]);const w=[0,0,0];return s.a6.vec3.add(w,_,v),s.cb(w)}const yc=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],r_=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class jl{static cacheKey(r,a,f,_){let v=`${a}${_?_.cacheKey:""}`;for(const w of f)r.usedDefines.includes(w)&&(v+=`/${w}`);return v}constructor(r,a,f,_,v,w){const k=r.gl;this.program=k.createProgram(),this.configuration=_,this.name=a,this.fixedDefines=[...w];const M=_?_.getBinderAttributes():[],B=(f.staticAttributes||[]).concat(M);let z=_?_.defines():[];z=z.concat(w.map(ee=>`#define ${ee}`));const V=`#version 300 es
`;let U=V+z.concat("precision mediump float;",Wa,_c.fragmentSource).join(`
`);for(const ee of f.fragmentIncludes)U+=`
${Ha[ee]}`;U+=`
${f.fragmentSource}`;let q=V+z.concat("precision highp float;",Wa,_c.vertexSource).join(`
`);for(const ee of f.vertexIncludes)q+=`
${Ha[ee]}`;q+=`
${f.vertexSource}`;const Y=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(Y,U),k.compileShader(Y),k.attachShader(this.program,Y);const J=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(J,q),k.compileShader(J),k.attachShader(this.program,J),this.attributes={},this.numAttributes=B.length;for(let ee=0;ee<this.numAttributes;ee++)if(B[ee]){const re=B[ee].startsWith("a_")?B[ee]:`a_${B[ee]}`;k.bindAttribLocation(this.program,ee,re),this.attributes[re]=ee}k.linkProgram(this.program),k.deleteShader(J),k.deleteShader(Y),this.fixedUniforms=v(r),this.binderUniforms=_?_.getUniforms(r):[],(w.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(ee=>({u_dem:new s.bJ(ee),u_dem_prev:new s.bJ(ee),u_dem_tl:new s.bG(ee),u_dem_scale:new s.bI(ee),u_dem_tl_prev:new s.bG(ee),u_dem_scale_prev:new s.bI(ee),u_dem_size:new s.bI(ee),u_dem_lerp:new s.bI(ee),u_exaggeration:new s.bI(ee),u_depth:new s.bJ(ee),u_depth_size_inv:new s.bG(ee),u_depth_range_unpack:new s.bG(ee),u_occluder_half_size:new s.bI(ee),u_occlusion_depth_offset:new s.bI(ee),u_meter_to_dem:new s.bI(ee),u_label_plane_matrix_inv:new s.bF(ee)}))(r)),w.includes("GLOBE")&&(this.globeUniforms=(ee=>({u_tile_tl_up:new s.bH(ee),u_tile_tr_up:new s.bH(ee),u_tile_br_up:new s.bH(ee),u_tile_bl_up:new s.bH(ee),u_tile_up_scale:new s.bI(ee)}))(r)),w.includes("FOG")&&(this.fogUniforms=(ee=>({u_fog_matrix:new s.bF(ee),u_fog_range:new s.bG(ee),u_fog_color:new s.c6(ee),u_fog_horizon_blend:new s.bI(ee),u_fog_vertical_limit:new s.bG(ee),u_fog_temporal_offset:new s.bI(ee),u_frustum_tl:new s.bH(ee),u_frustum_tr:new s.bH(ee),u_frustum_br:new s.bH(ee),u_frustum_bl:new s.bH(ee),u_globe_pos:new s.bH(ee),u_globe_radius:new s.bI(ee),u_globe_transition:new s.bI(ee),u_is_globe:new s.bJ(ee),u_viewport:new s.bG(ee)}))(r)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ee=>({u_cutoff_params:new s.c6(ee)}))(r)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ee=>({u_lighting_ambient_color:new s.bH(ee),u_lighting_directional_dir:new s.bH(ee),u_lighting_directional_color:new s.bH(ee),u_ground_radiance:new s.bH(ee)}))(r)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ee=>({u_light_matrix_0:new s.bF(ee),u_light_matrix_1:new s.bF(ee),u_fade_range:new s.bG(ee),u_shadow_normal_offset:new s.bH(ee),u_shadow_intensity:new s.bI(ee),u_shadow_texel_size:new s.bI(ee),u_shadow_map_resolution:new s.bI(ee),u_shadow_direction:new s.bH(ee),u_shadow_bias:new s.bH(ee),u_shadowmap_0:new s.bJ(ee),u_shadowmap_1:new s.bJ(ee)}))(r))}}setTerrainUniformValues(r,a){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in a)f[_]&&f[_].set(this.program,_,a[_])}}setGlobeUniformValues(r,a){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in a)f[_]&&f[_].set(this.program,_,a[_])}}setFogUniformValues(r,a){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in a)f[_].set(this.program,_,a[_])}}setCutoffUniformValues(r,a){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in a)f[_].set(this.program,_,a[_])}}setLightsUniformValues(r,a){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in a)f[_].set(this.program,_,a[_])}}setShadowUniformValues(r,a){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;r.program.set(this.program);for(const _ in a)f[_].set(this.program,_,a[_])}_drawDebugWireframe(r,a,f,_,v,w,k,M,B,z){const V=r.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const U=r.context;if(!(!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||r._terrain&&r._terrain.renderingToTexture||!yc.includes(this.name))||!(!V.layers3D||!r_.includes(this.name))))return;const q=U.gl,Y=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,v,U);if(!Y)return;const J=[...this.fixedDefines];J.push("DEBUG_WIREFRAME");const ee=r.getOrCreateProgram(this.name,{config:this.configuration,defines:J});U.program.set(ee.program);const re=(ce,ye,ge)=>{if(ye[ce]&&ge[ce])for(const Ae in ye[ce])ge[ce][Ae]&&ge[ce][Ae].set(ge.program,Ae,ye[ce][Ae].current)};B&&B.setUniforms(ee.program,U,ee.binderUniforms,k,{zoom:M}),re("fixedUniforms",this,ee),re("terrainUniforms",this,ee),re("globeUniforms",this,ee),re("fogUniforms",this,ee),re("lightsUniforms",this,ee),re("shadowUniforms",this,ee),Y.bind(),U.setColorMode(new te([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],s.bz.transparent,[!0,!0,!0,!1])),U.setDepthMode(new fe(a.func===q.LESS?q.LEQUAL:a.func,fe.ReadOnly,a.range)),U.setStencilMode(st.disabled);const he=3*w.primitiveLength*2,pe=3*w.primitiveOffset*2*2;z&&z>1?q.drawElementsInstanced(q.LINES,he,q.UNSIGNED_SHORT,pe,z):q.drawElements(q.LINES,he,q.UNSIGNED_SHORT,pe),v.bind(),U.program.set(this.program),U.setDepthMode(a),U.setStencilMode(f),U.setColorMode(_)}draw(r,a,f,_,v,w,k,M,B,z,V,U,q,Y,J,ee){const re=r.context,he=re.gl;if(this.failedToCreate)return;re.program.set(this.program),re.setDepthMode(f),re.setStencilMode(_),re.setColorMode(v),re.setCullFace(w);for(const ye of Object.keys(this.fixedUniforms))this.fixedUniforms[ye].set(this.program,ye,k[ye]);Y&&Y.setUniforms(this.program,re,this.binderUniforms,U,{zoom:q});const pe={[he.POINTS]:1,[he.LINES]:2,[he.TRIANGLES]:3,[he.LINE_STRIP]:1}[a],ce=ee&&ee>0?1:void 0;for(const ye of V.get()){const ge=ye.vaos||(ye.vaos={});(ge[M]||(ge[M]=new Qe)).bind(re,this,B,Y?Y.getPaintVertexBuffers():[],z,ye.vertexOffset,J||[],ce),ee&&ee>1?he.drawElementsInstanced(a,ye.primitiveLength*pe,he.UNSIGNED_SHORT,ye.primitiveOffset*pe*2,ee):z?he.drawElements(a,ye.primitiveLength*pe,he.UNSIGNED_SHORT,ye.primitiveOffset*pe*2):he.drawArrays(a,ye.vertexOffset,ye.vertexLength),a===he.TRIANGLES&&z&&this._drawDebugWireframe(r,f,_,v,z,ye,U,q,Y,ee)}}}function vp(d,r){const a=Math.pow(2,r.tileID.overscaledZ),f=r.tileSize*Math.pow(2,d.transform.tileZoom)/a,_=f*(r.tileID.canonical.x+r.tileID.wrap*a),v=f*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ak(r,1,d.transform.tileZoom),u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v]}}const Sd=s.a6.mat4.create(),bp=(d,r,a,f,_,v,w,k,M,B,z,V,U,q,Y,J)=>{const ee=r.style.light,re=ee.properties.get("position"),he=[re.x,re.y,re.z],pe=s.a6.mat3.create();ee.properties.get("anchor")==="viewport"&&(s.a6.mat3.fromRotation(pe,-r.transform.angle),s.a6.vec3.transformMat3(he,he,pe));const ce=ee.properties.get("color"),ye=r.transform,ge={u_matrix:d,u_lightpos:he,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_vertical_gradient:+a,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Sd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:v,u_width_scale:w,u_flood_light_color:U,u_vertical_scale:q,u_flood_light_intensity:Y,u_ground_shadow_factor:J};return ye.projection.name==="globe"&&(ge.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],ge.u_zoom_transition=B,ge.u_inv_rot_matrix=V,ge.u_merc_center=z,ge.u_up_dir=ye.projection.upVector(new s.bP(0,0,0),z[0]*s.ab,z[1]*s.ab),ge.u_height_lift=M),ge},n_=(d,r,a,f)=>({u_matrix:d,u_edge_radius:r,u_width_scale:a,u_vertical_scale:f}),xp=(d,r,a,f,_,v,w,k,M,B,z,V,U,q,Y)=>{const J=bp(d,r,a,f,_,v,w,k,B,z,V,U,q,Y,1,[0,0,0]),ee={u_height_factor:-Math.pow(2,k.overscaledZ)/M.tileSize/8};return s.l(J,vp(r,M),ee)},Cd=(d,r)=>({u_matrix:d,u_emissive_strength:r}),i_=(d,r,a,f)=>s.l(Cd(d,r),vp(a,f)),o_=(d,r,a)=>({u_matrix:d,u_world:a,u_emissive_strength:r}),yh=(d,r,a,f,_)=>s.l(i_(d,r,a,f),{u_world:_}),Tv=(d,r,a,f)=>{const _=s.ab/a.tileSize;return{u_matrix:d,u_camera_to_center_distance:r.getCameraToCenterDistance(f),u_extrude_scale:[r.pixelsToGLUnits[0]/_,r.pixelsToGLUnits[1]/_]}},s_=(d,r,a=1)=>({u_matrix:d,u_color:r.toRenderColor(null),u_overlay:0,u_overlay_scale:a}),a_=s.a6.mat4.create(),Ev=(d,r,a,f,_,v,w)=>{const k=d.transform,M=k.projection.name==="globe",B=M?s.cI(k.zoom,r.canonical)*k._pixelsPerMercatorPixel:s.ak(a,1,v),z={u_matrix:r.projMatrix,u_extrude_scale:B,u_intensity:w,u_inv_rot_matrix:a_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){z.u_inv_rot_matrix=f,z.u_merc_center=_,z.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],z.u_zoom_transition=s.a9(k.zoom);const V=_[0]*s.ab,U=_[1]*s.ab;z.u_up_dir=k.projection.upVector(new s.bP(0,0,0),V,U)}return z};function Rd(d,[r,a,f,_],[v,w]){if(v===w)return[0,0,0,0];const k=255*(d-1)/(d*(w-v));return[r*k,a*k,f*k,_*k]}function kd(d,r,[a,f]){return a===f?0:.5/d+(r-a)*(d-1)/(d*(f-a))}const vh=(d,r,a,f,_,v,w,k,M,B,z,V,U,q,Y,J,ee,re,he,pe,ce)=>({u_matrix:d,u_normalize_matrix:r,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:B,u_fade_t:z.mix,u_opacity:z.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:s.cJ(V.paint.get("raster-saturation")),u_contrast_factor:s.cK(V.paint.get("raster-contrast")),u_spin_weights:wp(V.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:q,u_zoom_transition:w,u_merc_center:k,u_cutoff_params:M,u_colorization_mix:Rd(s.cL,J,re),u_colorization_offset:kd(s.cL,ee,re),u_color_ramp:Y,u_texture_offset:[pe/(he+2*pe),he/(he+2*pe)],u_texture_res:[he+2*pe,he+2*pe],u_emissive_strength:ce});function wp(d){d*=Math.PI/180;const r=Math.sin(d),a=Math.cos(d);return[(2*a+1)/3,(-Math.sqrt(3)*r-a+1)/3,(Math.sqrt(3)*r-a+1)/3]}const Xa=.05,l_=(d,r,a,f,_,v,w,k,M,B,z,V)=>({u_matrix:d,u_normalize_matrix:r,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:B,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:w,u_merc_center:k,u_cutoff_params:M}),Pd=(d,r,a,f,_,v,w,k,M,B)=>({u_particle_texture:d,u_particle_texture_side_len:r,u_tile_offset:a,u_velocity:f,u_color_ramp:v,u_velocity_res:_,u_max_speed:w,u_uv_offset:k,u_data_scale:[255*M[0],255*M[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[Xa,Xa]}),Md=(d,r,a,f,_,v,w,k,M,B)=>({u_particle_texture:d,u_particle_texture_side_len:r,u_velocity:a,u_velocity_res:f,u_max_speed:_,u_speed_factor:v,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:k,u_data_scale:[255*M[0],255*M[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[Xa,Xa]}),Dd=s.a6.mat4.create(),Tp=(d,r,a,f,_,v,w,k,M,B,z,V,U,q,Y,J,ee,re,he,pe,ce)=>{const ye=_.transform,ge={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:ye.getCameraToCenterDistance(he),u_rotate_symbol:+a,u_aspect_ratio:ye.width/ye.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:w,u_coord_matrix:k,u_is_text:+B,u_elevation_from_sea:M?1:0,u_pitch_with_map:+f,u_texsize:z,u_texsize_icon:V,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Dd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Dd,u_up_vector:[0,-1,0],u_color_adj_mat:pe,u_icon_transition:ce||0,u_gamma_scale:f?_.transform.getCameraToCenterDistance(he)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:+U};return he.name==="globe"&&(ge.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],ge.u_zoom_transition=Y,ge.u_inv_rot_matrix=ee,ge.u_merc_center=J,ge.u_camera_forward=ye._camera.forward(),ge.u_ecef_origin=s.cM(ye.globeMatrix,q.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(ye.globeMatrix),ge.u_up_vector=re),ge},c_=(d,r,a,f)=>({u_matrix:d,u_emissive_strength:r,u_opacity:a,u_color:f}),vc=(d,r,a,f,_,v,w,k,M)=>s.l(function(B,z,V,U,q,Y){const{width:J,height:ee}=U.imageManager.getPixelSize(z),re=Math.pow(2,Y.tileID.overscaledZ),he=Y.tileSize*Math.pow(2,U.transform.tileZoom)/re,pe=he*(Y.tileID.canonical.x+Y.tileID.wrap*re),ce=he*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[J,ee],u_pattern_size:V.displaySize,u_pattern_units_to_pixels:q?[U.transform.width,-1*U.transform.height]:[1/s.ak(Y,1,U.transform.tileZoom),1/s.ak(Y,1,U.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,ce>>16],u_pixel_coord_lower:[65535&pe,65535&ce]}}(0,v,w,f,k,M),{u_matrix:d,u_emissive_strength:r,u_opacity:a}),su=new Float32Array(s.a6.mat4.identity([])),rr=(d,r,a,f,_,v,w,k,M,B,z,V,U,q=[0,0,0],Y)=>{const J=_.style.light,ee=J.properties.get("position"),re=[-ee.x,-ee.y,ee.z],he=s.a6.mat3.create();J.properties.get("anchor")==="viewport"&&(s.a6.mat3.fromRotation(he,-_.transform.angle),s.a6.vec3.transformMat3(re,re,he));const pe=z.alphaMode==="MASK",ce=J.properties.get("color").toRenderColor(null),ye=U.paint.get("model-ambient-occlusion-intensity"),ge=U.paint.get("model-color").constantOr(s.bz.white).toRenderColor(null),Ae=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:r,u_normal_matrix:a,u_node_matrix:f||su,u_lightpos:re,u_lightintensity:J.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_camera_pos:q,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+pe,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:[w.r,w.g,w.b,w.a],u_emissiveFactor:[k[0],k[1],k[2],1],u_metallicFactor:M,u_roughnessFactor:B,u_baseColorTexture:ti.BaseColor,u_metallicRoughnessTexture:ti.MetallicRoughness,u_normalTexture:ti.Normal,u_occlusionTexture:ti.Occlusion,u_emissionTexture:ti.Emission,u_lutTexture:ti.LUT,u_color_mix:[ge.r,ge.g,ge.b,Ae],u_aoIntensity:ye,u_emissive_strength:V,u_occlusionTextureTransform:Y||[0,0,0,0]}},Ep=(d,r=su,a=su)=>({u_matrix:d,u_instance:r,u_node_matrix:a}),u_={fillExtrusion:d=>({u_matrix:new s.bF(d),u_lightpos:new s.bH(d),u_lightintensity:new s.bI(d),u_lightcolor:new s.bH(d),u_vertical_gradient:new s.bI(d),u_opacity:new s.bI(d),u_edge_radius:new s.bI(d),u_width_scale:new s.bI(d),u_ao:new s.bG(d),u_tile_id:new s.bH(d),u_zoom_transition:new s.bI(d),u_inv_rot_matrix:new s.bF(d),u_merc_center:new s.bG(d),u_up_dir:new s.bH(d),u_height_lift:new s.bI(d),u_flood_light_color:new s.bH(d),u_vertical_scale:new s.bI(d),u_flood_light_intensity:new s.bI(d),u_ground_shadow_factor:new s.bH(d)}),fillExtrusionDepth:d=>({u_matrix:new s.bF(d),u_edge_radius:new s.bI(d),u_width_scale:new s.bI(d),u_vertical_scale:new s.bI(d)}),fillExtrusionPattern:d=>({u_matrix:new s.bF(d),u_lightpos:new s.bH(d),u_lightintensity:new s.bI(d),u_lightcolor:new s.bH(d),u_vertical_gradient:new s.bI(d),u_height_factor:new s.bI(d),u_edge_radius:new s.bI(d),u_width_scale:new s.bI(d),u_ao:new s.bG(d),u_tile_id:new s.bH(d),u_zoom_transition:new s.bI(d),u_inv_rot_matrix:new s.bF(d),u_merc_center:new s.bG(d),u_up_dir:new s.bH(d),u_height_lift:new s.bI(d),u_image:new s.bJ(d),u_texsize:new s.bG(d),u_pixel_coord_upper:new s.bG(d),u_pixel_coord_lower:new s.bG(d),u_tile_units_to_pixels:new s.bI(d),u_opacity:new s.bI(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new s.bF(d),u_opacity:new s.bI(d),u_ao_pass:new s.bI(d),u_meter_to_tile:new s.bI(d),u_ao:new s.bG(d),u_flood_light_intensity:new s.bI(d),u_flood_light_color:new s.bH(d),u_attenuation:new s.bI(d),u_edge_radius:new s.bI(d),u_fb:new s.bJ(d),u_fb_size:new s.bI(d),u_dynamic_offset:new s.bI(d)}),fill:d=>({u_matrix:new s.bF(d),u_emissive_strength:new s.bI(d)}),fillPattern:d=>({u_matrix:new s.bF(d),u_emissive_strength:new s.bI(d),u_image:new s.bJ(d),u_texsize:new s.bG(d),u_pixel_coord_upper:new s.bG(d),u_pixel_coord_lower:new s.bG(d),u_tile_units_to_pixels:new s.bI(d)}),fillOutline:d=>({u_matrix:new s.bF(d),u_emissive_strength:new s.bI(d),u_world:new s.bG(d)}),fillOutlinePattern:d=>({u_matrix:new s.bF(d),u_emissive_strength:new s.bI(d),u_world:new s.bG(d),u_image:new s.bJ(d),u_texsize:new s.bG(d),u_pixel_coord_upper:new s.bG(d),u_pixel_coord_lower:new s.bG(d),u_tile_units_to_pixels:new s.bI(d)}),circle:s.cN,collisionBox:d=>({u_matrix:new s.bF(d),u_camera_to_center_distance:new s.bI(d),u_extrude_scale:new s.bG(d)}),collisionCircle:d=>({u_matrix:new s.bF(d),u_inv_matrix:new s.bF(d),u_camera_to_center_distance:new s.bI(d),u_viewport_size:new s.bG(d)}),debug:d=>({u_color:new s.cu(d),u_matrix:new s.bF(d),u_overlay:new s.bJ(d),u_overlay_scale:new s.bI(d)}),clippingMask:d=>({u_matrix:new s.bF(d)}),heatmap:d=>({u_extrude_scale:new s.bI(d),u_intensity:new s.bI(d),u_matrix:new s.bF(d),u_inv_rot_matrix:new s.bF(d),u_merc_center:new s.bG(d),u_tile_id:new s.bH(d),u_zoom_transition:new s.bI(d),u_up_dir:new s.bH(d)}),heatmapTexture:d=>({u_image:new s.bJ(d),u_color_ramp:new s.bJ(d),u_opacity:new s.bI(d)}),hillshade:d=>({u_matrix:new s.bF(d),u_image:new s.bJ(d),u_latrange:new s.bG(d),u_light:new s.bG(d),u_shadow:new s.cu(d),u_highlight:new s.cu(d),u_emissive_strength:new s.bI(d),u_accent:new s.cu(d)}),hillshadePrepare:d=>({u_matrix:new s.bF(d),u_image:new s.bJ(d),u_dimension:new s.bG(d),u_zoom:new s.bI(d)}),line:s.cO,linePattern:s.cP,raster:d=>({u_matrix:new s.bF(d),u_normalize_matrix:new s.bF(d),u_globe_matrix:new s.bF(d),u_merc_matrix:new s.bF(d),u_grid_matrix:new s.cv(d),u_tl_parent:new s.bG(d),u_scale_parent:new s.bI(d),u_fade_t:new s.bI(d),u_opacity:new s.bI(d),u_image0:new s.bJ(d),u_image1:new s.bJ(d),u_brightness_low:new s.bI(d),u_brightness_high:new s.bI(d),u_saturation_factor:new s.bI(d),u_contrast_factor:new s.bI(d),u_spin_weights:new s.bH(d),u_perspective_transform:new s.bG(d),u_raster_elevation:new s.bI(d),u_zoom_transition:new s.bI(d),u_merc_center:new s.bG(d),u_cutoff_params:new s.c6(d),u_colorization_mix:new s.c6(d),u_colorization_offset:new s.bI(d),u_color_ramp:new s.bJ(d),u_texture_offset:new s.bG(d),u_texture_res:new s.bG(d),u_emissive_strength:new s.bI(d)}),rasterParticle:d=>({u_matrix:new s.bF(d),u_normalize_matrix:new s.bF(d),u_globe_matrix:new s.bF(d),u_merc_matrix:new s.bF(d),u_grid_matrix:new s.cv(d),u_tl_parent:new s.bG(d),u_scale_parent:new s.bI(d),u_fade_t:new s.bI(d),u_opacity:new s.bI(d),u_image0:new s.bJ(d),u_image1:new s.bJ(d),u_raster_elevation:new s.bI(d),u_zoom_transition:new s.bI(d),u_merc_center:new s.bG(d),u_cutoff_params:new s.c6(d)}),rasterParticleTexture:d=>({u_texture:new s.bJ(d),u_opacity:new s.bI(d)}),rasterParticleDraw:d=>({u_particle_texture:new s.bJ(d),u_particle_texture_side_len:new s.bI(d),u_tile_offset:new s.bG(d),u_velocity:new s.bJ(d),u_color_ramp:new s.bJ(d),u_velocity_res:new s.bG(d),u_max_speed:new s.bI(d),u_uv_offset:new s.bG(d),u_data_scale:new s.bG(d),u_data_offset:new s.bI(d),u_particle_pos_scale:new s.bI(d),u_particle_pos_offset:new s.bG(d)}),rasterParticleUpdate:d=>({u_particle_texture:new s.bJ(d),u_particle_texture_side_len:new s.bI(d),u_velocity:new s.bJ(d),u_velocity_res:new s.bG(d),u_max_speed:new s.bI(d),u_speed_factor:new s.bI(d),u_reset_rate:new s.bI(d),u_rand_seed:new s.bI(d),u_uv_offset:new s.bG(d),u_data_scale:new s.bG(d),u_data_offset:new s.bI(d),u_particle_pos_scale:new s.bI(d),u_particle_pos_offset:new s.bG(d)}),symbol:d=>({u_is_size_zoom_constant:new s.bJ(d),u_is_size_feature_constant:new s.bJ(d),u_size_t:new s.bI(d),u_size:new s.bI(d),u_camera_to_center_distance:new s.bI(d),u_rotate_symbol:new s.bJ(d),u_aspect_ratio:new s.bI(d),u_fade_change:new s.bI(d),u_matrix:new s.bF(d),u_label_plane_matrix:new s.bF(d),u_coord_matrix:new s.bF(d),u_is_text:new s.bJ(d),u_elevation_from_sea:new s.bJ(d),u_pitch_with_map:new s.bJ(d),u_texsize:new s.bG(d),u_texsize_icon:new s.bG(d),u_texture:new s.bJ(d),u_texture_icon:new s.bJ(d),u_gamma_scale:new s.bI(d),u_device_pixel_ratio:new s.bI(d),u_tile_id:new s.bH(d),u_zoom_transition:new s.bI(d),u_inv_rot_matrix:new s.bF(d),u_merc_center:new s.bG(d),u_camera_forward:new s.bH(d),u_tile_matrix:new s.bF(d),u_up_vector:new s.bH(d),u_ecef_origin:new s.bH(d),u_is_halo:new s.bJ(d),u_icon_transition:new s.bI(d),u_color_adj_mat:new s.bF(d)}),background:d=>({u_matrix:new s.bF(d),u_emissive_strength:new s.bI(d),u_opacity:new s.bI(d),u_color:new s.cu(d)}),backgroundPattern:d=>({u_matrix:new s.bF(d),u_emissive_strength:new s.bI(d),u_opacity:new s.bI(d),u_image:new s.bJ(d),u_pattern_tl:new s.bG(d),u_pattern_br:new s.bG(d),u_texsize:new s.bG(d),u_pattern_size:new s.bG(d),u_pixel_coord_upper:new s.bG(d),u_pixel_coord_lower:new s.bG(d),u_pattern_units_to_pixels:new s.bG(d)}),terrainRaster:d=>({u_matrix:new s.bF(d),u_image0:new s.bJ(d),u_skirt_height:new s.bI(d),u_ground_shadow_factor:new s.bH(d)}),skybox:d=>({u_matrix:new s.bF(d),u_sun_direction:new s.bH(d),u_cubemap:new s.bJ(d),u_opacity:new s.bI(d),u_temporal_offset:new s.bI(d)}),skyboxGradient:d=>({u_matrix:new s.bF(d),u_color_ramp:new s.bJ(d),u_center_direction:new s.bH(d),u_radius:new s.bI(d),u_opacity:new s.bI(d),u_temporal_offset:new s.bI(d)}),skyboxCapture:d=>({u_matrix_3f:new s.cv(d),u_sun_direction:new s.bH(d),u_sun_intensity:new s.bI(d),u_color_tint_r:new s.c6(d),u_color_tint_m:new s.c6(d),u_luminance:new s.bI(d)}),globeRaster:d=>({u_proj_matrix:new s.bF(d),u_globe_matrix:new s.bF(d),u_normalize_matrix:new s.bF(d),u_merc_matrix:new s.bF(d),u_zoom_transition:new s.bI(d),u_merc_center:new s.bG(d),u_image0:new s.bJ(d),u_grid_matrix:new s.cv(d),u_skirt_height:new s.bI(d),u_far_z_cutoff:new s.bI(d),u_frustum_tl:new s.bH(d),u_frustum_tr:new s.bH(d),u_frustum_br:new s.bH(d),u_frustum_bl:new s.bH(d),u_globe_pos:new s.bH(d),u_globe_radius:new s.bI(d),u_viewport:new s.bG(d)}),globeAtmosphere:d=>({u_frustum_tl:new s.bH(d),u_frustum_tr:new s.bH(d),u_frustum_br:new s.bH(d),u_frustum_bl:new s.bH(d),u_horizon:new s.bI(d),u_transition:new s.bI(d),u_fadeout_range:new s.bI(d),u_color:new s.c6(d),u_high_color:new s.c6(d),u_space_color:new s.c6(d),u_temporal_offset:new s.bI(d),u_horizon_angle:new s.bI(d)}),model:d=>({u_matrix:new s.bF(d),u_lighting_matrix:new s.bF(d),u_normal_matrix:new s.bF(d),u_node_matrix:new s.bF(d),u_lightpos:new s.bH(d),u_lightintensity:new s.bI(d),u_lightcolor:new s.bH(d),u_camera_pos:new s.bH(d),u_opacity:new s.bI(d),u_baseColorFactor:new s.c6(d),u_emissiveFactor:new s.c6(d),u_metallicFactor:new s.bI(d),u_roughnessFactor:new s.bI(d),u_baseTextureIsAlpha:new s.bJ(d),u_alphaMask:new s.bJ(d),u_alphaCutoff:new s.bI(d),u_baseColorTexture:new s.bJ(d),u_metallicRoughnessTexture:new s.bJ(d),u_normalTexture:new s.bJ(d),u_occlusionTexture:new s.bJ(d),u_emissionTexture:new s.bJ(d),u_lutTexture:new s.bJ(d),u_color_mix:new s.c6(d),u_aoIntensity:new s.bI(d),u_emissive_strength:new s.bI(d),u_occlusionTextureTransform:new s.c6(d)}),modelDepth:d=>({u_matrix:new s.bF(d),u_instance:new s.bF(d),u_node_matrix:new s.bF(d)}),groundShadow:d=>({u_matrix:new s.bF(d),u_ground_shadow_factor:new s.bH(d)}),stars:d=>({u_matrix:new s.bF(d),u_up:new s.bH(d),u_right:new s.bH(d),u_intensity_multiplier:new s.bI(d)}),occlusion:d=>({u_matrix:new s.bF(d),u_anchorPos:new s.bH(d),u_screenSizePx:new s.bG(d),u_occluderSizePx:new s.bG(d),u_color:new s.c6(d)})};class ms{constructor(r,a,f,_){this.id=ms.uniqueIdxCounter,ms.uniqueIdxCounter++,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||_||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=ms.uniqueIdxCounter,ms.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ms.uniqueIdxCounter=0;const bc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class hr{constructor(r,a,f,_,v,w){this.length=a.length,this.attributes=f,this.itemSize=a.bytesPerElement,this.dynamicDraw=_,this.instanceCount=w,this.context=r;const k=r.gl;this.buffer=k.createBuffer(),r.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||v||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,a){for(let f=0;f<this.attributes.length;f++){const _=a.attributes[this.attributes[f].name];_!==void 0&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,a,f){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],w=a.attributes[v.name];w!==void 0&&r.vertexAttribPointer(w,v.components,r[bc[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(r,a,f){for(let _=0;_<this.attributes.length;_++){const v=a.attributes[this.attributes[_].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(v,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ld{constructor(r,a,f,_,v){this.context=r,this.width=a,this.height=f;const w=this.framebuffer=r.gl.createFramebuffer();_&&(this.colorAttachment=new Id(r,w)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new pp(r,w):new Kg(r,w))}destroy(){const r=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&r.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&r.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&r.deleteTexture(a)}r.deleteFramebuffer(this.framebuffer)}}class Iv{constructor(r,a){this.gl=r,this.clearColor=new fo(this),this.clearDepth=new Bo(this),this.clearStencil=new Xo(this),this.colorMask=new fs(this),this.depthMask=new Ko(this),this.stencilMask=new Za(this),this.stencilFunc=new ps(this),this.stencilOp=new Ul(this),this.stencilTest=new xa(this),this.depthRange=new xd(this),this.depthTest=new ul(this),this.depthFunc=new op(this),this.blend=new bv(this),this.blendFunc=new sp(this),this.blendColor=new ap(this),this.blendEquation=new lp(this),this.cullFace=new cp(this),this.cullFaceSide=new Wg(this),this.frontFace=new Zg(this),this.program=new xv(this),this.activeTexture=new ph(this),this.viewport=new mh(this),this.bindFramebuffer=new Xg(this),this.bindRenderbuffer=new ks(this),this.bindTexture=new up(this),this.bindVertexBuffer=new wd(this),this.bindElementBuffer=new Td(this),this.bindVertexArrayOES=new hp(this),this.pixelStoreUnpack=new dp(this),this.pixelStoreUnpackPremultiplyAlpha=new Ed(this),this.pixelStoreUnpackFlipY=new fp(this),this.options=a?{...a}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,a,f){return new ms(this,r,a,f)}createVertexBuffer(r,a,f,_,v){return new hr(this,r,a,f,_,v)}createRenderbuffer(r,a,f){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,r,a,f),this.bindRenderbuffer.set(null),v}createFramebuffer(r,a,f,_){return new Ld(this,r,a,f,_)}clear({color:r,depth:a,stencil:f,colorMask:_}){const v=this.gl;let w=0;r&&(w|=v.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(_||[!0,!0,!0,!0])),a!==void 0&&(w|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),f!==void 0&&(w|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),v.clear(w)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){s.bh(r.blendFunction,te.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Od;function Bd(d,r,a,f,_,v,w){const k=d.context,M=k.gl,B=d.transform,z=d.getOrCreateProgram("collisionBox"),V=[];let U=0,q=0;for(let ce=0;ce<f.length;ce++){const ye=f[ce],ge=r.getTile(ye),Ae=ge.getBucket(a);if(!Ae)continue;const Te=ya(ye,Ae,B);let Se=Te;_[0]===0&&_[1]===0||(Se=d.translatePosMatrix(Te,ge,_,v));const Oe=w?Ae.textCollisionBox:Ae.iconCollisionBox,ke=Ae.collisionCircleArray;if(ke.length>0){const Re=s.a6.mat4.create(),Xe=Se;s.a6.mat4.mul(Re,Ae.placementInvProjMatrix,B.glCoordMatrix),s.a6.mat4.mul(Re,Re,Ae.placementViewportMatrix),V.push({circleArray:ke,circleOffset:q,transform:Xe,invTransform:Re,projection:Ae.getProjection()}),U+=ke.length/4,q=U}Oe&&(d.terrain&&d.terrain.setupElevationDraw(ge,z),z.draw(d,M.LINES,fe.disabled,st.disabled,d.colorModeForRenderPass(),cr.disabled,Tv(Se,B,ge,Ae.getProjection()),a.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,null,B.zoom,null,[Oe.collisionVertexBuffer,Oe.collisionVertexBufferExt]))}if(!w||!V.length)return;const Y=d.getOrCreateProgram("collisionCircle"),J=new s.cQ;J.resize(4*U),J._trim();let ee=0;for(const ce of V)for(let ye=0;ye<ce.circleArray.length/4;ye++){const ge=4*ye,Ae=ce.circleArray[ge+0],Te=ce.circleArray[ge+1],Se=ce.circleArray[ge+2],Oe=ce.circleArray[ge+3];J.emplace(ee++,Ae,Te,Se,Oe,0),J.emplace(ee++,Ae,Te,Se,Oe,1),J.emplace(ee++,Ae,Te,Se,Oe,2),J.emplace(ee++,Ae,Te,Se,Oe,3)}(!Od||Od.length<2*U)&&(Od=function(ce){const ye=2*ce,ge=new s.aO;ge.resize(ye),ge._trim();for(let Ae=0;Ae<ye;Ae++){const Te=6*Ae;ge.uint16[Te+0]=4*Ae+0,ge.uint16[Te+1]=4*Ae+1,ge.uint16[Te+2]=4*Ae+2,ge.uint16[Te+3]=4*Ae+2,ge.uint16[Te+4]=4*Ae+3,ge.uint16[Te+5]=4*Ae+0}return ge}(U));const re=k.createIndexBuffer(Od,!0),he=k.createVertexBuffer(J,s.cR.members,!0);for(const ce of V){const ye={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(pe=B).getCameraToCenterDistance(ce.projection),u_viewport_size:[pe.width,pe.height]};Y.draw(d,M.TRIANGLES,fe.disabled,st.disabled,d.colorModeForRenderPass(),cr.disabled,ye,a.id,he,re,s.b1.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,B.zoom)}var pe;he.destroy(),re.destroy()}const bh=s.a6.mat4.create();function Ip(d){const r=d._camera.getWorldToCamera(d.worldSize,1),a=s.a6.mat4.multiply([],r,d.globeMatrix);s.a6.mat4.invert(a,a);const f=[0,0,0],_=[0,1,0,0];return s.a6.vec4.transformMat4(_,_,a),f[0]=_[0],f[1]=_[1],f[2]=_[2],s.a6.vec3.normalize(f,f),f}function Av({width:d,height:r,anchor:a,textOffset:f,textScale:_},v){const{horizontalAlign:w,verticalAlign:k}=s.bx(a),M=-(w-.5)*d,B=-(k-.5)*r,z=s.bw(a,f);return new s.P((M/_+z[0])*v,(B/_+z[1])*v)}function Sv(d,r,a,f,_,v,w,k,M,B,z){const V=d.text.placedSymbolArray,U=d.text.dynamicLayoutVertexArray,q=d.icon.dynamicLayoutVertexArray,Y={},J=d.getProjection(),ee=hs(k,J,v),re=v.elevation,he=J.upVectorScale(k.canonical,v.center.lat,v.worldSize).metersToTile;U.clear();for(let pe=0;pe<V.length;pe++){const ce=V.get(pe),{tileAnchorX:ye,tileAnchorY:ge,numGlyphs:Ae}=ce,Te=ce.hidden||!ce.crossTileID||d.allowVerticalPlacement&&!ce.placedOrientation?null:f[ce.crossTileID];if(Te){let Se=0,Oe=0,ke=0;if(re){const pt=re?re.getAtTileOffset(k,ye,ge):0,[Pt,Lt,yt]=J.upVector(k.canonical,ye,ge);Se=pt*Pt*he,Oe=pt*Lt*he,ke=pt*yt*he}let[Re,Xe,ht,bt]=Ai(ce.projectedAnchorX+Se,ce.projectedAnchorY+Oe,ce.projectedAnchorZ+ke,a?ee:w);const ct=Hr(v.getCameraToCenterDistance(J),bt);let Rt=_.evaluateSizeForFeature(d.textSizeData,B,ce)*ct/s.bq;a&&(Rt*=d.tilePixelRatio/M);const Ke=Av(Te,Rt);a?({x:Re,y:Xe,z:ht}=J.projectTilePoint(ye+Ke.x,ge+Ke.y,k.canonical),[Re,Xe,ht]=Ai(Re+Se,Xe+Oe,ht+ke,w)):(r&&Ke._rotate(-v.angle),Re+=Ke.x,Xe+=Ke.y,ht=0);const gt=d.allowVerticalPlacement&&ce.placedOrientation===s.bk.vertical?Math.PI/2:0;for(let pt=0;pt<Ae;pt++)s.bn(U,Re,Xe,ht,gt);z&&ce.associatedIconIndex>=0&&(Y[ce.associatedIconIndex]={x:Re,y:Xe,z:ht,angle:gt})}else ho(Ae,U)}if(z){q.clear();const pe=d.icon.placedSymbolArray;for(let ce=0;ce<pe.length;ce++){const ye=pe.get(ce),{numGlyphs:ge}=ye,Ae=Y[ce];if(ye.hidden||!Ae)ho(ge,q);else{const{x:Te,y:Se,z:Oe,angle:ke}=Ae;for(let Re=0;Re<ge;Re++)s.bn(q,Te,Se,Oe,ke)}}d.icon.dynamicLayoutVertexBuffer.updateData(q)}d.text.dynamicLayoutVertexBuffer.updateData(U)}function xh(d,r,a,f,_,v,w={}){const k=a.paint.get("icon-translate"),M=a.paint.get("text-translate"),B=a.paint.get("icon-translate-anchor"),z=a.paint.get("text-translate-anchor"),V=a.layout.get("icon-rotation-alignment"),U=a.layout.get("text-rotation-alignment"),q=a.layout.get("icon-pitch-alignment"),Y=a.layout.get("text-pitch-alignment"),J=a.layout.get("icon-keep-upright"),ee=a.layout.get("text-keep-upright"),re=a.paint.get("icon-color-saturation"),he=a.paint.get("icon-color-contrast"),pe=a.paint.get("icon-color-brightness-min"),ce=a.paint.get("icon-color-brightness-max"),ye=a.paint.get("symbol-elevation-reference")==="sea",ge=a.paint.get("text-occlusion-opacity").constantOr(0),Ae=d.context,Te=Ae.gl,Se=d.transform,Oe=V==="map",ke=U==="map",Re=q==="map",Xe=Y==="map",ht=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let bt=!1;const ct=d.depthModeForSublayer(0,fe.ReadOnly),Rt=[s.am(Se.center.lng),s.at(Se.center.lat)],Ke=a.layout.get("text-variable-anchor"),gt=Se.projection.name==="globe",pt=[],Pt=[0,-1,0];for(const Lt of f){const yt=r.getTile(Lt),Tt=yt.getBucket(a);if(!Tt||Tt.projection.name==="mercator"&&gt||Tt.fullyClipped)continue;const _r=Tt.projection.name==="globe",Nt=_r?s.a9(Se.zoom):0,Qt=hs(Lt,Tt.getProjection(),Se),kr=Se.calculatePixelsToTileUnitsMatrix(yt),ar=Ke&&Tt.hasTextData(),Tr=Tt.hasIconTextFit()&&ar&&Tt.hasIconData(),qr=Tt.getProjection().createInversionMatrix(Se,Lt.canonical),Ur=Mn=>{Se.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||d.terrain)&&(Mn.push("DEPTH_D24"),Mn.push("DEPTH_OCCLUSION"))},kn=()=>{const Mn=Oe&&a.layout.get("symbol-placement")!=="point",jr=[];Ur(jr);const fn=Mn||Tr,Cn=a.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&Re&&jr.push("PITCH_WITH_MAP_TERRAIN"),_r&&(jr.push("PROJECTION_GLOBE_VIEW"),fn&&jr.push("PROJECTED_POS_ON_VIEWPORT")),Cn>0&&jr.push("ICON_TRANSITION"),Tt.icon.zOffsetVertexBuffer&&jr.push("Z_OFFSET"),re===0&&he===0&&pe===0&&ce===1||jr.push("COLOR_ADJUSTMENT"),Tt.sdfIcons&&jr.push("RENDER_SDF");const Ei=Tt.icon.programConfigurations.get(a.id),Oi=d.getOrCreateProgram("symbol",{config:Ei,defines:jr}),ln=yt.imageAtlasTexture?yt.imageAtlasTexture.size:[0,0],Ki=Tt.iconSizeData,no=s.bj(Ki,Se.zoom),Yi=Re||Se.pitch!==0,qn=Wr(Qt,yt.tileID.canonical,Re,Oe,Se,Tt.getProjection(),kr),Jo=ro(Qt,yt.tileID.canonical,Re,Oe,Se,Tt.getProjection(),kr),Qo=d.translatePosMatrix(Jo,yt,k,B,!0),ta=d.translatePosMatrix(Qt,yt,k,B),Ms=fn?bh:qn,_s=Oe&&!Re&&!Mn;let ra=Pt;!gt&&!Se.mercatorFromTransition||Oe||(ra=Ip(Se));const ml=_r?ra:Pt,Xl=a.getColorAdjustmentMatrix(re,he,pe,ce),Qa=Tp(Ki.kind,no,_s,Re,d,ta,Ms,Qo,ye,!1,ln,[0,0],!0,Lt,Nt,Rt,qr,ml,Tt.getProjection(),Xl,Cn),_u=yt.imageAtlasTexture?yt.imageAtlasTexture:null,yu=a.layout.get("icon-size").constantOr(0)!==1||Tt.iconsNeedLinear,Qd=Tt.sdfIcons||d.options.rotating||d.options.zooming||yu||Yi?Te.LINEAR:Te.NEAREST,vu=Tt.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Gn=d.terrain&&Re&&Mn?s.a6.mat4.invert(s.a6.mat4.create(),qn):bh;if(Mn&&Tt.icon){const Ac=Se.elevation,jv=Ac?Ac.getAtTileOffsetFunc(Lt,Se.center.lat,Se.worldSize,Tt.getProjection()):null,R_=Kr(Qt,yt.tileID.canonical,Re,Oe,Se,Tt.getProjection(),kr);Hs(Tt,Qt,d,!1,R_,Jo,Re,J,jv,Lt)}return{program:Oi,buffers:Tt.icon,uniformValues:Qa,atlasTexture:_u,atlasTextureIcon:null,atlasInterpolation:Qd,atlasInterpolationIcon:null,isSDF:Tt.sdfIcons,hasHalo:vu,tile:yt,labelPlaneMatrixInv:Gn}},zn=()=>{const Mn=ke&&a.layout.get("symbol-placement")!=="point",jr=[],fn=Mn||Ke||Tr;d.terrainRenderModeElevated()&&Xe&&jr.push("PITCH_WITH_MAP_TERRAIN"),_r&&(jr.push("PROJECTION_GLOBE_VIEW"),fn&&jr.push("PROJECTED_POS_ON_VIEWPORT")),Tt.text.zOffsetVertexBuffer&&jr.push("Z_OFFSET"),Tt.iconsInText&&jr.push("RENDER_TEXT_AND_SYMBOL"),jr.push("RENDER_SDF"),Ur(jr);const Cn=Tt.text.programConfigurations.get(a.id),Ei=d.getOrCreateProgram("symbol",{config:Cn,defines:jr});let Oi,ln=[0,0],Ki=null;const no=Tt.textSizeData;Tt.iconsInText&&(ln=yt.imageAtlasTexture?yt.imageAtlasTexture.size:[0,0],Ki=yt.imageAtlasTexture?yt.imageAtlasTexture:null,Oi=Xe||Se.pitch!==0||d.options.rotating||d.options.zooming||no.kind==="composite"||no.kind==="camera"?Te.LINEAR:Te.NEAREST);const Yi=yt.glyphAtlasTexture?yt.glyphAtlasTexture.size:[0,0],qn=s.bj(no,Se.zoom),Jo=Wr(Qt,yt.tileID.canonical,Xe,ke,Se,Tt.getProjection(),kr),Qo=ro(Qt,yt.tileID.canonical,Xe,ke,Se,Tt.getProjection(),kr),ta=d.translatePosMatrix(Qo,yt,M,z,!0),Ms=d.translatePosMatrix(Qt,yt,M,z),_s=fn?bh:Jo,ra=ke&&!Xe&&!Mn;let ml=Pt;!gt&&!Se.mercatorFromTransition||ke||(ml=Ip(Se));const Xl=Tp(no.kind,qn,ra,Xe,d,Ms,_s,ta,ye,!0,Yi,ln,!0,Lt,Nt,Rt,qr,_r?ml:Pt,Tt.getProjection(),ge),Qa=yt.glyphAtlasTexture?yt.glyphAtlasTexture:null,_u=Te.LINEAR,yu=a.paint.get("text-halo-width").constantOr(1)!==0,Qd=d.terrain&&Xe&&Mn?s.a6.mat4.invert(s.a6.mat4.create(),Jo):bh;if(Mn&&Tt.text){const vu=Se.elevation,Gn=vu?vu.getAtTileOffsetFunc(Lt,Se.center.lat,Se.worldSize,Tt.getProjection()):null,Ac=Kr(Qt,yt.tileID.canonical,Xe,ke,Se,Tt.getProjection(),kr);Hs(Tt,Qt,d,!0,Ac,Qo,Xe,ee,Gn,Lt)}return{program:Ei,buffers:Tt.text,uniformValues:Xl,atlasTexture:Qa,atlasTextureIcon:Ki,atlasInterpolation:_u,atlasInterpolationIcon:Oi,isSDF:!0,hasHalo:yu,tile:yt,labelPlaneMatrixInv:Qd}},Xn=Tt.icon.segments.get().length,ea=Tt.text.segments.get().length,Li=Xn&&!w.onlyText?kn():null,Qr=ea&&!w.onlyIcons?zn():null,Ln=a.paint.get("icon-opacity").constantOr(1),ai=a.paint.get("text-opacity").constantOr(1);if(ht&&Tt.canOverlap){bt=!0;const Mn=Ln&&!w.onlyText?Tt.icon.segments.get():[],jr=ai&&!w.onlyIcons?Tt.text.segments.get():[];for(const fn of Mn)pt.push({segments:new s.b1([fn]),sortKey:fn.sortKey,state:Li});for(const fn of jr)pt.push({segments:new s.b1([fn]),sortKey:fn.sortKey,state:Qr})}else w.onlyText||pt.push({segments:Ln?Tt.icon.segments:new s.b1([]),sortKey:0,state:Li}),w.onlyIcons||pt.push({segments:ai?Tt.text.segments:new s.b1([]),sortKey:0,state:Qr})}bt&&pt.sort((Lt,yt)=>Lt.sortKey-yt.sortKey);for(const Lt of pt){const yt=Lt.state;if(yt)if(d.terrain?d.terrain.setupElevationDraw(yt.tile,yt.program,{useDepthForOcclusion:Se.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:yt.labelPlaneMatrixInv}):d.setupDepthForOcclusion(Se.depthOcclusionForSymbolsAndCircles,yt.program),Ae.activeTexture.set(Te.TEXTURE0),yt.atlasTexture&&yt.atlasTexture.bind(yt.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),yt.atlasTextureIcon&&(Ae.activeTexture.set(Te.TEXTURE1),yt.atlasTextureIcon&&yt.atlasTextureIcon.bind(yt.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,yt.program),yt.hasHalo){const Tt=yt.uniformValues;Tt.u_is_halo=1,wh(yt.buffers,Lt.segments,a,d,yt.program,ct,_,v,Tt,2),Tt.u_is_halo=0}else{if(yt.isSDF){const Tt=yt.uniformValues;yt.hasHalo&&(Tt.u_is_halo=1,wh(yt.buffers,Lt.segments,a,d,yt.program,ct,_,v,Tt,1)),Tt.u_is_halo=0}wh(yt.buffers,Lt.segments,a,d,yt.program,ct,_,v,yt.uniformValues,1)}}}function wh(d,r,a,f,_,v,w,k,M,B){const z=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,v,w,k,cr.disabled,M,a.id,d.layoutVertexBuffer,d.indexBuffer,r,a.paint,f.transform.zoom,d.programConfigurations.get(a.id),z,B)}function zd(d,r,a,f,_,v,w){const k=d.context.gl,M=a.paint.get("fill-pattern"),B=a.is3D(),z=B?d.stencilModeFor3D():st.disabled,V=M&&M.constantOr(1);let U,q,Y,J,ee;w?(q=V&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=k.LINES):(q=V?"fillPattern":"fill",U=k.TRIANGLES);for(const re of f){const he=r.getTile(re);if(V&&!he.patternsLoaded())continue;const pe=he.getBucket(a);if(!pe)continue;d.prepareDrawTile();const ce=pe.programConfigurations.get(a.id),ye=d.isTileAffectedByFog(re),ge=d.getOrCreateProgram(q,{config:ce,overrideFog:ye});V&&(d.context.activeTexture.set(k.TEXTURE0),he.imageAtlasTexture&&he.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ce.updatePaintBuffers());const Ae=M.constantOr(null);if(Ae&&he.imageAtlas){const Oe=he.imageAtlas.patternPositions[Ae.toString()];Oe&&ce.setConstantPatternPositions(Oe)}const Te=d.translatePosMatrix(re.projMatrix,he,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),Se=a.paint.get("fill-emissive-strength");if(w){J=pe.indexBuffer2,ee=pe.segments2;const Oe=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];Y=q==="fillOutlinePattern"&&V?yh(Te,Se,d,he,Oe):o_(Te,Se,Oe)}else J=pe.indexBuffer,ee=pe.segments,Y=V?i_(Te,Se,d,he):Cd(Te,Se);d.uploadCommonUniforms(d.context,ge,re.toUnwrapped()),ge.draw(d,U,_,B?z:d.stencilModeForClipping(re),v,cr.disabled,Y,a.id,pe.layoutVertexBuffer,J,ee,a.paint,d.transform.zoom,ce,void 0)}}function au(d,r,a,f,_,v,w,k){a.resetLayerRenderingStats(d);const M=d.context,B=M.gl,z=d.transform,V=a.paint.get("fill-extrusion-pattern"),U=V.constantOr(1),q=a.paint.get("fill-extrusion-opacity"),Y=d.style.enable3dLights(),J=a.paint.get(Y&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),J],re=a.layout.get("fill-extrusion-edge-radius"),he=re>0&&!a.paint.get("fill-extrusion-rounded-roof"),pe=he?0:re,ce=z.projection.name==="globe"?s.c_():0,ye=z.projection.name==="globe",ge=ye?s.a9(z.zoom):0,Ae=[s.am(z.center.lng),s.at(z.center.lat)],Te=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(a.lut).toArray01().slice(0,3),Se=a.paint.get("fill-extrusion-flood-light-intensity"),Oe=a.paint.get("fill-extrusion-vertical-scale"),ke=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Re=ba(d,a.paint.get("fill-extrusion-cutoff-fade-range")),Xe=[];let ht;ye&&Xe.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&Xe.push("FAUX_AO"),he&&Xe.push("ZERO_ROOF_RADIUS"),k&&Xe.push("HAS_CENTROID"),Se>0&&Xe.push("FLOOD_LIGHT"),Re.shouldRenderCutoff&&Xe.push("RENDER_CUTOFF"),ke&&Xe.push("RENDER_WALL_MODE");const bt=d.renderPass==="shadow",ct=d.shadowRenderer,Rt=bt&&!!ct;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let Ke=[0,0,0];if(ct){const Pt=d.style.directionalLight,Lt=d.style.ambientLight;Pt&&Lt&&(Ke=Fl(d.style,Pt,Lt)),ht=Xe.concat(["SHADOWS_SINGLE_CASCADE"])}const gt=Rt?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",pt=a.getLayerRenderingStats();for(const Pt of f){const Lt=r.getTile(Pt),yt=Lt.getBucket(a);if(!yt||yt.projection.name!==z.projection.name)continue;let Tt=!1;ct&&(Tt=ct.getMaxCascadeForTile(Pt.toUnwrapped())===0);const _r=d.isTileAffectedByFog(Pt),Nt=yt.programConfigurations.get(a.id),Qt=d.getOrCreateProgram(gt,{config:Nt,defines:Tt?ht:Xe,overrideFog:_r});if(d.terrain&&d.terrain.setupElevationDraw(Lt,Qt,{useMeterToDem:!0}),!yt.centroidVertexBuffer){const zn=Qt.attributes.a_centroid_pos;zn!==void 0&&B.vertexAttrib2f(zn,0,0)}!bt&&ct&&ct.setupShadows(Lt.tileID.toUnwrapped(),Qt,"vector-tile",Lt.tileID.overscaledZ),U&&(d.context.activeTexture.set(B.TEXTURE0),Lt.imageAtlasTexture&&Lt.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Nt.updatePaintBuffers());const kr=V.constantOr(null);if(kr&&Lt.imageAtlas){const zn=Lt.imageAtlas.patternPositions[kr.toString()];zn&&Nt.setConstantPatternPositions(zn)}const ar=a.paint.get("fill-extrusion-vertical-gradient"),Tr=1/yt.tileToMeter;let qr;if(bt&&ct){if(Cp(Lt.tileID,yt,d))continue;const zn=ct.calculateShadowPassMatrixFromTile(Lt.tileID.toUnwrapped());qr=n_(zn,pe,Tr,Oe)}else{const zn=d.translatePosMatrix(Pt.expandedProjMatrix,Lt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Xn=z.projection.createInversionMatrix(z,Pt.canonical);qr=U?xp(zn,d,ar,q,ee,pe,Tr,Pt,Lt,ce,ge,Ae,Xn,Te,Oe):bp(zn,d,ar,q,ee,pe,Tr,Pt,ce,ge,Ae,Xn,Te,Oe,Se,Ke)}d.uploadCommonUniforms(M,Qt,Pt.toUnwrapped(),null,Re);let Ur=yt.segments;if(z.projection.name==="mercator"&&!bt&&(Ur=yt.getVisibleSegments(Lt.tileID,d.terrain,d.transform.getFrustum(0)),!Ur.get().length))continue;if(pt)if(bt)for(const zn of Ur.get())pt.numRenderedVerticesInShadowPass+=zn.primitiveLength;else for(const zn of Ur.get())pt.numRenderedVerticesInTransparentPass+=zn.primitiveLength;const kn=[];(d.terrain||k)&&kn.push(yt.centroidVertexBuffer),ye&&kn.push(yt.layoutVertexExtBuffer),ke&&kn.push(yt.wallVertexBuffer),Qt.draw(d,M.gl.TRIANGLES,_,v,w,cr.backCCW,qr,a.id,yt.layoutVertexBuffer,yt.indexBuffer,Ur,a.paint,d.transform.zoom,Nt,kn)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function so(d,r,a,f,_,v,w,k,M,B,z,V,U,q,Y,J,ee,re,he){const pe=d.context,ce=pe.gl,ye=d.transform,ge=d.transform.zoom,Ae=[],Te=ba(d,a.paint.get("fill-extrusion-cutoff-fade-range"));B==="clear"?(Ae.push("CLEAR_SUBPASS"),he&&(Ae.push("CLEAR_FROM_TEXTURE"),pe.activeTexture.set(ce.TEXTURE0),he.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):B==="sdf"&&Ae.push("SDF_SUBPASS"),ee&&Ae.push("HAS_CENTROID"),Te.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF");const Se=a.layout.get("fill-extrusion-edge-radius"),Oe=(ke,Re,Xe,ht,bt)=>{const ct=Re.programConfigurations.get(a.id),Rt=d.isTileAffectedByFog(ke),Ke=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:ct,defines:Ae,overrideFog:Rt}),gt=((Pt,Lt,yt,Tt,_r,Nt,Qt,kr,ar,Tr,qr)=>({u_matrix:Lt,u_opacity:yt,u_ao_pass:Tt?1:0,u_meter_to_tile:_r,u_ao:Nt,u_flood_light_intensity:Qt,u_flood_light_color:kr,u_attenuation:ar,u_edge_radius:Tr,u_fb:0,u_fb_size:qr,u_dynamic_offset:1}))(0,ht,z,M,bt,[V,U*bt],q,Y,J,ge>=17?0:Se*bt,he?he.size[0]:0),pt=[];ee&&pt.push(Re.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(pe,Ke,ke.toUnwrapped(),null,Te),Ke.draw(d,pe.gl.TRIANGLES,_,v,w,k,gt,a.id,Re.vertexBuffer,Re.indexBuffer,Xe,a.paint,ge,ct,pt)};for(const ke of f){const Re=r.getTile(ke),Xe=Re.getBucket(a);if(!Xe||Xe.projection.name!==ye.projection.name||!Xe.groundEffect||Xe.groundEffect&&!Xe.groundEffect.hasData())continue;const ht=Xe.groundEffect,bt=1/Xe.tileToMeter;{const ct=d.translatePosMatrix(ke.projMatrix,Re,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Rt=ht.getDefaultSegment();Oe(ke,ht,Rt,ct,bt)}if(re)for(let ct=0;ct<4;ct++){const Rt=s.c$[ct](ke),Ke=r.getTile(Rt);if(!Ke)continue;const gt=Ke.getBucket(a);if(!gt||gt.projection.name!==ye.projection.name||!gt.groundEffect||gt.groundEffect&&!gt.groundEffect.hasData())continue;const pt=gt.groundEffect;let Pt,Lt;ct===0?(Pt=[-s.ab,0,0],Lt=1):ct===1?(Pt=[s.ab,0,0],Lt=0):ct===2?(Pt=[0,-s.ab,0],Lt=3):(Pt=[0,s.ab,0],Lt=2);const yt=pt.regionSegments[Lt];if(!yt)continue;const Tt=new Float32Array(16);s.a6.mat4.translate(Tt,ke.projMatrix,Pt),Oe(ke,pt,yt,d.translatePosMatrix(Tt,Re,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),bt)}}}function $l(d,r,a,f,_,v,w){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const k=v?v.findDEMTileFor(a):null;if(!(k&&k.dem||w))return;const M=re=>new s.P(Math.ceil((re+s.d2)*s.d3),0),B=re=>{const he=r.getSource().minzoom,pe=ye=>{const ge=r.getTileByID(ye);if(ge&&ge.hasData())return ge.getBucket(_)},ce=[0,-1,1];for(const ye of ce){if(re.overscaledZ+ye<he)continue;const ge=pe(re.calculateScaledKey(re.overscaledZ+ye));if(ge)return ge}},z=[0,0,0],V=(re,he)=>(z[0]=Math.min(re.min.y,he.min.y),z[1]=Math.max(re.max.y,he.max.y),z[2]=s.ab-he.min.x>re.max.x?he.min.x-s.ab:re.max.x,z),U=(re,he)=>(z[0]=Math.min(re.min.x,he.min.x),z[1]=Math.max(re.max.x,he.max.x),z[2]=s.ab-he.min.y>re.max.y?he.min.y-s.ab:re.max.y,z),q=[(re,he)=>V(re,he),(re,he)=>V(he,re),(re,he)=>U(re,he),(re,he)=>U(he,re)],Y=(re,he,pe,ce,ye,ge,Ae)=>{if(!v)return 0;const Te=[[ge?pe:re,ge?re:pe,0],[ge?pe:he,ge?he:pe,0]],Se=Ae<0?s.ab+Ae:Ae,Oe=[ge?Se:(re+he)/2,ge?(re+he)/2:Se,0];return pe===0&&Ae<0||pe!==0&&Ae>0?v.getForTilePoints(ye,[Oe],!0,ce):Te.push(Oe),v.getForTilePoints(a,Te,!0,k),Math.max(Te[0][2],Te[1][2],Oe[2])/v.exaggeration()};for(let re=0;re<4;re++){const he=f.borderFeatureIndices[re];if(he.length===0)continue;const pe=s.c$[re](a),ce=B(pe);if(!(ce&&ce instanceof s.d0)||f.borderDoneWithNeighborZ[re]===ce.canonical.z)continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const ye=v?v.findDEMTileFor(pe):null;if(!(ye&&ye.dem||w))continue;const ge=(re<2?1:5)-re,Ae=ce.borderDoneWithNeighborZ[ge]!==f.canonical.z,Te=ce.borderFeatureIndices[ge];let Se=0;if(f.canonical.z!==ce.canonical.z){for(const Oe of he)f.showCentroid(f.featuresOnBorder[Oe]);if(Ae)for(const Oe of Te)ce.showCentroid(ce.featuresOnBorder[Oe]);f.borderDoneWithNeighborZ[re]=ce.canonical.z,ce.borderDoneWithNeighborZ[ge]=f.canonical.z}for(const Oe of he){const ke=f.featuresOnBorder[Oe],Re=f.centroidData[ke.centroidDataIndex],Xe=ke.borders[re];let ht;for(;Se<Te.length;){ht=ce.featuresOnBorder[Te[Se]];const bt=ht.borders[ge];if(bt[1]>Xe[0]+3||bt[0]>Xe[0]-3)break;ce.showCentroid(ht),Se++}if(ht&&Se<Te.length){const bt=Se;let ct=0;for(;!(ht.borders[ge][0]>Xe[1]-3)&&(ct++,++Se!==Te.length);)ht=ce.featuresOnBorder[Te[Se]];ht=ce.featuresOnBorder[Te[bt]];let Rt=!1;if(ct>=1){const pt=ht.borders[ge];Math.abs(Xe[0]-pt[0])<3&&Math.abs(Xe[1]-pt[1])<3&&(ct=1,Rt=!0,Se=bt+1)}else if(ct===0){f.showCentroid(ke);continue}const Ke=ce.centroidData[ht.centroidDataIndex];w&&Rt&&(((J=Re).flags|(ee=Ke).flags)&s.d1?(J.flags|=s.d1,ee.flags|=s.d1):(J.flags&=~s.d1,ee.flags&=~s.d1));const gt=ke.intersectsCount()>1||ht.intersectsCount()>1;if(ct>1)Se=bt,Re.centroidXY=Ke.centroidXY=new s.P(0,0);else if(ye&&ye.dem&&!gt){const pt=q[re](Re,Ke),Pt=re%2?s.ab-1:0,Lt=Y(pt[0],Math.min(s.ab-1,pt[1]),Pt,ye,pe,re<2,pt[2]);Re.centroidXY=Ke.centroidXY=M(Lt)}else gt?Re.centroidXY=Ke.centroidXY=new s.P(0,0):(Re.centroidXY=f.encodeBorderCentroid(ke),Ke.centroidXY=ce.encodeBorderCentroid(ht));f.writeCentroidToBuffer(Re),ce.writeCentroidToBuffer(Ke)}else f.showCentroid(ke)}f.borderDoneWithNeighborZ[re]=ce.canonical.z,ce.borderDoneWithNeighborZ[ge]=f.canonical.z}var J,ee;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}const h_=[1,0,0],Ap=[0,1,0],Sp=[0,0,1];function Cp(d,r,a){const f=a.transform,_=a.shadowRenderer;if(!_)return!0;const v=d.toUnwrapped(),w=f.tileSize*_._cascades[a.currentShadowCascade].scale;let k=r.maxHeight;if(f.elevation){const J=f.elevation.getMinMaxForTile(d);J&&(k+=J.max)}const M=[..._.shadowDirection];M[2]=-M[2];const B=_.computeSimplifiedTileShadowVolume(v,k,w,M);if(!B)return!1;const z=[h_,Ap,Sp,M,[M[0],0,M[2]],[0,M[1],M[2]]],V=f.projection.name==="globe",U=f.scaleZoom(w),q=s.bN.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,U,!V),Y=_.getCurrentCascadeFrustum();return q.intersectsPrecise(B.vertices,B.planes,z)===0||Y.intersectsPrecise(B.vertices,B.planes,z)===0}function Rp(d){return[d[0]*s.d4,d[1]*s.d4,d[2]*s.d4,0]}function gs(d,r,a,f,_,v,w,k,M){const B=f.getSource(),z=a.globeSharedBuffers;if(!z)return;let V,U,q;if(r&&(V=f.getTile(r)),B instanceof s.aD?(U=B.texture,q=s.cD(0,0,a.transform)):V&&r&&(U=V.texture,q=s.cD(r.canonical.z,r.canonical.x,a.transform)),!U||!q)return;d||(q=s.a6.mat4.scale(s.a6.mat4.create(),q,[1,-1,1]));const Y=a.context,J=Y.gl,ee=_.paint.get("raster-resampling")==="nearest"?J.NEAREST:J.LINEAR,re=a.colorModeForDrapableLayerRenderPass(v),he=w.defines;he.push("GLOBE_POLES");const pe=new fe(J.LEQUAL,fe.ReadWrite,a.depthRangeFor3D),ce=Float32Array.from(a.transform.expandedFarZProjMatrix),ye=Float32Array.from(s.b5(s.cC(new s.bP(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),Y.activeTexture.set(J.TEXTURE0),U.bind(ee,J.CLAMP_TO_EDGE),Y.activeTexture.set(J.TEXTURE1),U.bind(ee,J.CLAMP_TO_EDGE),U.useMipmap&&Y.extTextureFilterAnisotropic&&a.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);const[ge,Ae,Te,Se]=r?z.getPoleBuffers(r.canonical.z,!1):z.getPoleBuffers(0,!0),Oe=_.paint.get("raster-elevation");let ke;d?(ke=ge,a.renderDefaultNorthPole=Oe!==0):(ke=Ae,a.renderDefaultSouthPole=Oe!==0);const Re=Rp(w.mix),Xe=((bt,ct,Rt,Ke,gt,pt,Pt,Lt,yt,Tt,_r,Nt,Qt)=>vh(bt,ct,Rt,new Float32Array(16),new Float32Array(9),[0,0],Ke,[0,0],[0,0,0,0],1,{opacity:1,mix:0},pt,[0,0],Lt,2,Tt,_r,Nt,1,0,Qt))(ce,ye,q,s.a9(a.transform.zoom),0,_,0,Oe,0,Re,w.offset,w.range,v),ht=a.getOrCreateProgram("raster",{defines:he});a.uploadCommonUniforms(Y,ht,null),ht.draw(a,J.TRIANGLES,pe,M,re,k,Xe,_.id,ke,Te,Se)}function wi(d){const r=d._nearZ,a=d.projection.farthestPixelDistance(d),f=a-r,_=.2*d.height,v=r+_;return[r,a,(v-_-r)/f,(v-r)/f]}function Fd(d,r,a,f){if(d)return r instanceof pa&&d instanceof $n?r.getTextureDescriptor(d,a,!0):{texture:d.texture,mix:Rp(f.mix),offset:f.offset,buffer:0,tileSize:1}}var kp=s.d5([{name:"a_index",type:"Int16",components:1}]);class d_{constructor(r,a,f,_){const v={width:f[0],height:f[1],data:null},w=r.gl;this.targetColorTexture=new s.T(r,v,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(r,v,w.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(a,_),this.lastInvalidatedAt=0}updateParticleTexture(r,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,_=a.width*a.height;this.particleTexture0=new s.T(this.context,a,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,a,f.RGBA8,{premultiply:!1,useMipmap:!1});const v=new s.d6;v.reserve(_);for(let w=0;w<_;w++)v.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(v,kp.members,!0),this.particleSegment=s.b1.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function f_(d,r,a){if(!d)return null;const f=r.getTextureDescriptor(d,a,!0);if(!f)return null;let{texture:_,mix:v,offset:w,tileSize:k,buffer:M,format:B}=f;if(!_||!B)return null;let z=!1;return B==="uint32"&&(z=!0,v[3]=0,v=Rd(s.d7,v,[0,a.paint.get("raster-particle-max-speed")]),w=kd(s.d7,w,[0,a.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[M/(k+2*M),k/(k+2*M)],tileSize:k,scalarData:z,scale:v,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[B]]}}function p_(d){const r=d._nearZ,a=d.projection.farthestPixelDistance(d),f=a-r,_=.2*d.height,v=r+_;return[r,a,(v-_-r)/f,(v-r)/f]}const Cv=new s.bz(1,0,0,1),lu=new s.bz(0,1,0,1),cu=new s.bz(0,0,1,1),Ot=new s.bz(1,0,1,1),pr=new s.bz(0,1,1,1);function wa(d,r,a,f,_,v,w){const k=d.context,M=d.transform,B=k.gl,z=M.projection.name==="globe",V=z?["PROJECTION_GLOBE_VIEW"]:[];let U=s.a6.mat4.clone(a.projMatrix);if(z&&s.a9(M.zoom)>0){const Re=s.b4(a.canonical,M),Xe=s.d8(Re);U=s.a6.mat4.multiply(new Float32Array(16),M.globeMatrix,Xe),s.a6.mat4.multiply(U,M.projMatrix,U)}const q=s.a6.mat4.create();q[12]+=2*_/(s.q.devicePixelRatio*M.width),q[13]+=2*v/(s.q.devicePixelRatio*M.height),s.a6.mat4.multiply(U,q,U);const Y=d.getOrCreateProgram("debug",{defines:V}),J=r.getTileByID(a.key);d.terrain&&d.terrain.setupElevationDraw(J,Y);const ee=fe.disabled,re=st.disabled,he=d.colorModeForRenderPass(),pe="$debug";k.activeTexture.set(B.TEXTURE0),d.emptyTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),z?J._makeGlobeTileDebugBuffers(d.context,M):J._makeDebugTileBoundsBuffers(d.context,M.projection);const ce=J._tileDebugBuffer||d.debugBuffer,ye=J._tileDebugIndexBuffer||d.debugIndexBuffer,ge=J._tileDebugSegments||d.debugSegments;if(Y.draw(d,B.LINE_STRIP,ee,re,he,cr.disabled,s_(U,f),pe,ce,ye,ge,null,null,null,[J._globeTileDebugBorderBuffer]),w){const Re=J.latestRawTileData,Xe=Math.floor((Re&&Re.byteLength||0)/1024);let ht=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ht+=` => ${a.overscaledZ}`),ht+=` ${J.state}`,ht+=` ${Xe}kb`,function(bt,ct){bt.initDebugOverlayCanvas();const Rt=bt.debugOverlayCanvas,Ke=bt.context.gl,gt=bt.debugOverlayCanvas.getContext("2d");gt.clearRect(0,0,Rt.width,Rt.height),gt.shadowColor="white",gt.shadowBlur=2,gt.lineWidth=1.5,gt.strokeStyle="white",gt.textBaseline="top",gt.font="bold 36px Open Sans, sans-serif",gt.fillText(ct,5,5),gt.strokeText(ct,5,5),bt.debugOverlayTexture.update(Rt),bt.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(d,ht)}const Ae=r.getTile(a).tileSize,Te=512/Math.min(Ae,512)*(a.overscaledZ/M.zoom)*.5,Se=J._tileDebugTextBuffer||d.debugBuffer,Oe=J._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,ke=J._tileDebugTextSegments||d.debugSegments;Y.draw(d,B.TRIANGLES,ee,re,te.alphaBlended,cr.disabled,s_(U,s.bz.transparent,Te),pe,Se,Oe,ke,null,null,null,[J._globeTileDebugTextBuffer])}function si(d,r,a,f){Th(d,0,r+a/2,d.transform.width,a,f)}function tt(d,r,a,f){Th(d,r-a/2,0,a,d.transform.height,f)}function Th(d,r,a,f,_,v){const w=d.context,k=w.gl;k.enable(k.SCISSOR_TEST),k.scissor(r*s.q.devicePixelRatio,a*s.q.devicePixelRatio,f*s.q.devicePixelRatio,_*s.q.devicePixelRatio),w.clear({color:v}),k.disable(k.SCISSOR_TEST)}const Nd=s.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Pp}=Nd;function Ta(d,r,a,f){d.emplaceBack(r,a,f)}class Mp{constructor(r){this.vertexArray=new s.d9,this.indices=new s.aO,Ta(this.vertexArray,-1,-1,1),Ta(this.vertexArray,1,-1,1),Ta(this.vertexArray,-1,1,1),Ta(this.vertexArray,1,1,1),Ta(this.vertexArray,-1,-1,-1),Ta(this.vertexArray,1,-1,-1),Ta(this.vertexArray,-1,1,-1),Ta(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Pp),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=s.b1.simpleSegment(0,0,36,12)}}function xc(d,r,a,f,_,v){const w=d.context.gl,k=r.paint.get("sky-atmosphere-color"),M=r.paint.get("sky-atmosphere-halo-color"),B=r.paint.get("sky-atmosphere-sun-intensity"),z=((V,U,q,Y,J)=>({u_matrix_3f:V,u_sun_direction:U,u_sun_intensity:q,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(s.a6.mat3.fromMat4(s.a6.mat3.create(),f),_,B,k,M);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),a.draw(d,w.TRIANGLES,fe.disabled,st.disabled,te.unblended,cr.frontCW,z,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const uu=s.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Rv{constructor(r){const a=new s.da;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const f=new s.aO;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(a,uu.members),this.indexBuffer=r.createIndexBuffer(f),this.segments=s.b1.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const kv=s.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class m_{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Vd{constructor(r){this.colorModeAlphaBlendedWriteRGB=new te([1,X,1,X],s.bz.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new te([1,0,1,0],s.bz.transparent,[!1,!1,!1,!0]),this.params=new m_,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const a=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Rv(a);const f=this.params.sizeRange,_=this.params.intensityRange,v=function(z){const V=s.dd(30),U=[];for(let q=0;q<z;++q){const Y=2*Math.PI*V(),J=Math.acos(1-2*V())-.5*Math.PI;U.push(s.a6.vec3.fromValues(Math.cos(J)*Math.cos(Y),Math.cos(J)*Math.sin(Y),Math.sin(J)))}return U}(this.params.starsCount),w=s.dd(300),k=new s.db,M=new s.aO;let B=0;for(let z=0;z<v.length;++z){const V=s.a6.vec3.scale([],v[z],200),U=Math.max(0,1+.01*f*(1*w()-.5)),q=Math.max(0,1+.01*_*(1*w()-.5));k.emplaceBack(V[0],V[1],V[2],-1,-1,U,q),k.emplaceBack(V[0],V[1],V[2],1,-1,U,q),k.emplaceBack(V[0],V[1],V[2],1,1,U,q),k.emplaceBack(V[0],V[1],V[2],-1,1,U,q),M.emplaceBack(B+0,B+1,B+2),M.emplaceBack(B+0,B+2,B+3),B+=4}this.starsVx=a.createVertexBuffer(k,kv.members),this.starsIdx=a.createIndexBuffer(M),this.starsSegments=s.b1.simpleSegment(0,0,k.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,a){const f=r.context,_=f.gl,v=r.transform,w=new fe(_.LEQUAL,fe.ReadOnly,[0,1]),k=s.a9(v.zoom),M=r.style.getLut(a.scope),B=a.properties.get("color").toRenderColor(M).toArray01(),z=a.properties.get("high-color").toRenderColor(M).toArray01(),V=a.properties.get("space-color").toRenderColor(M).toArray01PremultipliedAlpha(),U=5e-4,q=s.dc(a.properties.get("horizon-blend"),0,1,U,.25),Y=s.cx(r,f,v)&&q===U?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,J=r.frameCounter/1e3%1,ee=s.a6.vec3.length(v.globeCenterInViewSpace),re=Math.sqrt(Math.pow(ee,2)-Math.pow(Y,2)),he=Math.acos(re/ee),pe=ce=>{const ye=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ce&&ye.push("ALPHA_PASS");const ge=r.getOrCreateProgram("globeAtmosphere",{defines:ye}),Ae=((Se,Oe,ke,Re,Xe,ht,bt,ct,Rt,Ke,gt,pt)=>({u_frustum_tl:Se,u_frustum_tr:Oe,u_frustum_br:ke,u_frustum_bl:Re,u_horizon:Xe,u_transition:ht,u_fadeout_range:bt,u_color:ct,u_high_color:Rt,u_space_color:Ke,u_temporal_offset:gt,u_horizon_angle:pt}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,k,q,B,z,V,J,he);r.uploadCommonUniforms(f,ge);const Te=this.atmosphereBuffer;Te&&ge.draw(r,_.TRIANGLES,w,st.disabled,ce?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,cr.backCW,Ae,ce?"atmosphere_glow_alpha":"atmosphere_glow",Te.vertexBuffer,Te.indexBuffer,Te.segments)};pe(!1),pe(!0)}drawStars(r,a){const f=s.ap(a.properties.get("star-intensity"),0,1);if(f===0)return;const _=r.context,v=_.gl,w=r.transform,k=r.getOrCreateProgram("stars"),M=s.a6.quat.identity([]);s.a6.quat.rotateX(M,M,-w._pitch),s.a6.quat.rotateZ(M,M,-w.angle),s.a6.quat.rotateX(M,M,s.bB(w._center.lat)),s.a6.quat.rotateY(M,M,-s.bB(w._center.lng));const B=s.a6.mat4.fromQuat(new Float32Array(16),M),z=s.a6.mat4.multiply([],w.starsProjMatrix,B),V=s.a6.mat3.fromMat4([],B),U=s.a6.mat3.invert([],V),q=[0,1,0];s.a6.vec3.transformMat3(q,q,U),s.a6.vec3.scale(q,q,this.params.sizeMultiplier);const Y=[1,0,0];s.a6.vec3.transformMat3(Y,Y,U),s.a6.vec3.scale(Y,Y,this.params.sizeMultiplier);const J=(ee=q,re=Y,he=f,{u_matrix:Float32Array.from(z),u_up:ee,u_right:re,u_intensity_multiplier:he});var ee,re,he;r.uploadCommonUniforms(_,k),this.starsVx&&this.starsIdx&&k.draw(r,v.TRIANGLES,fe.disabled,st.disabled,this.colorModeAlphaBlendedWriteRGB,cr.disabled,J,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ud(d,r){const a=[...d],f=r.cameraWorldSizeForFog/r.worldSize,_=s.a6.mat4.identity([]);return s.a6.mat4.scale(_,_,[f,f,1]),s.a6.mat4.multiply(a,_,a),s.a6.mat4.multiply(a,r.worldToFogMatrix,a),a}function jd(d,r,a,f,_){const v=a.material,w=f.context,{baseColorTexture:k,metallicRoughnessTexture:M}=v.pbrMetallicRoughness,{normalTexture:B,occlusionTexture:z,emissionTexture:V}=v;function U(q,Y,J){if(q&&(d.push(Y),w.activeTexture.set(w.gl.TEXTURE0+J),q.gfxTexture)){const{minFilter:ee,magFilter:re,wrapS:he,wrapT:pe}=q.sampler;q.gfxTexture.bindExtraParam(ee,re,he,pe)}}U(k,"HAS_TEXTURE_u_baseColorTexture",ti.BaseColor),U(M,"HAS_TEXTURE_u_metallicRoughnessTexture",ti.MetallicRoughness),U(B,"HAS_TEXTURE_u_normalTexture",ti.Normal),U(z,"HAS_TEXTURE_u_occlusionTexture",ti.Occlusion),U(V,"HAS_TEXTURE_u_emissionTexture",ti.Emission),_&&(_.texture||(_.texture=new s.df(f.context,_.image,[_.image.height,_.image.height,_.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+ti.LUT),_.texture&&_.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(a.texcoordBuffer)),a.colorBuffer&&(d.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(a.colorBuffer)),a.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(a.normalBuffer)),a.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(a.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||d.push("DIFFUSE_SHADED"),d.push("USE_STANDARD_DERIVATIVES")}function Eh(d,r,a,f,_,v){const w=a.paint.get("model-opacity"),k=r.context,M=new fe(r.context.gl.LEQUAL,fe.ReadWrite,r.depthRangeFor3D),B=r.transform,z=d.mesh,V=z.material,U=V.pbrMetallicRoughness,q=r.style.fog;let Y;Y=r.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:s.a6.mat4.multiply([],f.zScaleMatrix,d.nodeModelMatrix),s.a6.mat4.multiply(Y,f.negCameraPosMatrix,Y);const J=s.a6.mat4.invert([],Y);s.a6.mat4.transpose(J,J);const ee=a.paint.get("model-emissive-strength").constantOr(0),re=rr(new Float32Array(d.worldViewProjection),new Float32Array(Y),new Float32Array(J),null,r,w,U.baseColorFactor.toRenderColor(null),V.emissiveFactor,U.metallicFactor,U.roughnessFactor,V,ee,a),he={defines:[]},pe=[];jd(he.defines,pe,z,r,a.lut);const ce=r.shadowRenderer;ce&&(ce.useNormalOffset=!1);let ye=null;if(q){const Te=Ud(d.nodeModelMatrix,r.transform);if(ye=new Float32Array(Te),B.projection.name!=="globe"){const Se=z.aabb.min,Oe=z.aabb.max,[ke,Re]=q.getOpacityForBounds(Te,Se[0],Se[1],Oe[0],Oe[1]);he.overrideFog=ke>=Gt||Re>=Gt}}const ge=ba(r,a.paint.get("model-cutoff-fade-range"));ge.shouldRenderCutoff&&he.defines.push("RENDER_CUTOFF");const Ae=r.getOrCreateProgram("model",he);r.uploadCommonUniforms(k,Ae,null,ye,ge),r.renderPass!=="shadow"&&ce&&ce.setupShadowsFromMatrix(d.nodeModelMatrix,Ae),Ae.draw(r,k.gl.TRIANGLES,M,_,v,z.material.doubleSided?cr.disabled:cr.backCCW,re,a.id,z.vertexBuffer,z.indexBuffer,z.segments,a.paint,r.transform.zoom,void 0,pe)}function Ih(d,r,a,f,_,v,w){let k;k=d.projection.name==="globe"?s.dg(a,d):[...a],s.a6.mat4.multiply(k,k,r.matrix);const M=s.a6.mat4.multiply([],f,k);if(r.meshes)for(const B of r.meshes){if(B.material.alphaMode!=="BLEND"){w.push({mesh:B,depth:0,modelIndex:_,worldViewProjection:M,nodeModelMatrix:k});continue}const z=s.a6.vec3.transformMat4([],B.centroid,M);z[2]>0&&v.push({mesh:B,depth:z[2],modelIndex:_,worldViewProjection:M,nodeModelMatrix:k})}if(r.children)for(const B of r.children)Ih(d,B,a,f,_,v,w)}function hu(d,r,a,f){const _=a.shadowRenderer;if(!_)return;const v=_.getShadowPassDepthMode(),w=_.getShadowPassColorMode(),k=_.calculateShadowPassMatrixFromMatrix(r),M=Ep(k);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,v,st.disabled,w,cr.backCCW,M,f.id,d.vertexBuffer,d.indexBuffer,d.segments,f.paint,a.transform.zoom,void 0,void 0)}function g_(d,r,a){const f=r.updateZoomBasedPaintProperties(),_=function(v,w,k){let M,B,z,V=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&V>0){const U=v.terrain,q=U.findDEMTileFor(k);q&&q.dem?M=s.di.create(U,k,q):V=0}if(V===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),V===w.validForExaggeration&&(V===0||M&&M._demTile&&M._demTile.tileID===w.validForDEMTile.id&&M._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const U in w.instancesPerModel){const q=w.instancesPerModel[U];for(let Y=0;Y<q.instancedDataArray.length;++Y){const J=(M?V*M.getElevationAt(0|q.instancedDataArray.float32[16*Y],0|q.instancedDataArray.float32[16*Y+1],!0,!0):0)+q.instancesEvaluatedElevation[Y];q.instancedDataArray.float32[16*Y+6]=J,B=B?Math.min(w.terrainElevationMin,J):J,z=z?Math.max(w.terrainElevationMax,J):J}}return w.terrainElevationMin=B||0,w.terrainElevationMax=z||0,w.validForExaggeration=V,w.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,r,a);(f||_)&&(r.uploaded=!1,r.upload(d.context))}const Ea={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.c9([0,0,0],[s.ab,s.ab,0])};function Pv(d,r){const a=1<<d.canonical.z,f=r.getFreeCameraOptions().position,_=r.elevation,v=d.canonical.x/a,w=(d.canonical.x+1)/a,k=d.canonical.y/a,M=(d.canonical.y+1)/a;let B=r._centerAltitude;if(_){const q=_.getMinMaxForTile(d);q&&q.max>B&&(B=q.max)}const z=s.ap(f.x,v,w)-f.x,V=s.ap(f.y,k,M)-f.y,U=s.bD(B,r.center.lat)-f.z;return r._zoomFromMercatorZ(Math.sqrt(z*z+V*V+U*U))}function zo(d,r,a,f,_,v,w){const k=d.context,M=d.renderPass==="shadow",B=d.shadowRenderer,z=M&&B?B.getShadowPassDepthMode():new fe(k.gl.LEQUAL,fe.ReadWrite,d.depthRangeFor3D),V=d.isTileAffectedByFog(v);if(a.meshes)for(const U of a.meshes){const q=["MODEL_POSITION_ON_GPU"],Y=[];let J,ee,re;f.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const he=ba(d,r.paint.get("model-cutoff-fade-range"));if(he.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),M&&B)J=d.getOrCreateProgram("modelDepth",{defines:q}),ee=Ep(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(a.matrix)),re=B.getShadowPassColorMode();else{jd(q,Y,U,d,r.lut),J=d.getOrCreateProgram("model",{defines:q,overrideFog:V});const ce=U.material,ye=ce.pbrMetallicRoughness,ge=r.paint.get("model-opacity"),Ae=r.paint.get("model-emissive-strength").constantOr(0);ee=rr(v.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,d,ge,ye.baseColorFactor.toRenderColor(null),ce.emissiveFactor,ye.metallicFactor,ye.roughnessFactor,ce,Ae,r,_),B&&(w.shadowUniformsInitialized?J.setShadowUniformValues(k,B.getShadowUniformValues()):(B.setupShadows(v.toUnwrapped(),J,"model-tile",v.overscaledZ),w.shadowUniformsInitialized=!0)),re=he.shouldRenderCutoff||ge<1||ce.alphaMode!=="OPAQUE"?te.alphaBlended:te.unblended}d.uploadCommonUniforms(k,J,v.toUnwrapped(),null,he);const pe=U.material.doubleSided?cr.disabled:cr.backCCW;if(f.instancedDataArray.length>20)Y.push(f.instancedDataBuffer),J.draw(d,k.gl.TRIANGLES,z,st.disabled,re,pe,ee,r.id,U.vertexBuffer,U.indexBuffer,U.segments,r.paint,d.transform.zoom,void 0,Y,f.instancedDataArray.length);else{const ce=M?"u_instance":"u_normal_matrix";for(let ye=0;ye<f.instancedDataArray.length;++ye)ee[ce]=new Float32Array(f.instancedDataArray.arrayBuffer,64*ye,16),J.draw(d,k.gl.TRIANGLES,z,st.disabled,re,pe,ee,r.id,U.vertexBuffer,U.indexBuffer,U.segments,r.paint,d.transform.zoom,void 0,Y)}}if(a.children)for(const U of a.children)zo(d,r,U,f,_,v,w)}const Mv=[1,-1,1];function Ah(d,r,a,f){if(!a.modelManager)return!0;const _=a.modelManager;if(!a.shadowRenderer)return!0;const v=a.shadowRenderer,w=r.aabb;let k=!0,M=d.maxHeight;if(M===0){let z=0;for(const V in d.instancesPerModel){const U=_.getModel(V,f);U?z=Math.max(z,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):k=!1}M=d.maxScale*z*1.41+d.maxVerticalOffset,k&&(d.maxHeight=M)}w.max[2]=M,w.min[2]+=d.terrainElevationMin,w.max[2]+=d.terrainElevationMax,s.a6.vec3.transformMat4(w.min,w.min,r.tileMatrix),s.a6.vec3.transformMat4(w.max,w.max,r.tileMatrix);const B=w.intersects(v.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=B===2),B===0}function Jn(d,r){const a=d.uniformValues.u_cutoff_params[0],f=d.uniformValues.u_cutoff_params[1],_=d.uniformValues.u_cutoff_params[2],v=d.uniformValues.u_cutoff_params[3];return f===a||v===_?1:s.ap(((r-a)/(f-a)-_)/(v-_),0,1)}function dn(d,r,a,f){if(r.pitch<20)return 1;const _=r.getWorldToCameraMatrix();s.a6.mat4.multiply(_,_,d);const v=s.a6.vec4.fromValues(a.min[0],a.min[1],a.min[2],1);let w=s.a6.vec4.transformMat4(s.a6.vec4.create(),v,_),k=w,M=w;v[1]=a.max[1],w=s.a6.vec4.transformMat4(s.a6.vec4.create(),v,_),k=w[1]<k[1]?w:k,M=w[1]>M[1]?w:M,v[0]=a.max[0],w=s.a6.vec4.transformMat4(s.a6.vec4.create(),v,_),k=w[1]<k[1]?w:k,M=w[1]>M[1]?w:M,v[1]=a.min[1],w=s.a6.vec4.transformMat4(s.a6.vec4.create(),v,_),k=w[1]<k[1]?w:k,M=w[1]>M[1]?w:M;const B=s.ap(f[0],0,1),z=100*r.pixelsPerMeter*s.ap(f[1],0,1),V=s.ap(f[2],0,1),U=s.a6.vec4.lerp(s.a6.vec4.create(),k,M,B),q=Math.tan(.5*r.fovX),Y=-U[2]*q;if(z===0)return U[1]<-Math.abs(Y)?V:1;const J=(-Math.abs(Y)-U[1])/z,ee=(he,pe,ce)=>(1-ce)*he+ce*pe,re=s.ap(ee(1,V,J),V,1);return ee(1,re,s.ap((r.pitch-20)/20,0,1))}class __{}class ql{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,a,f){{const V=this._storage.get(a.id);if(V)return V.lastUsedFrameIdx=r,V.buf}const _=f.gl,v=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),w=new ArrayBuffer(v),k=new Int16Array(w);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const M=new s.dk;for(let V=0;V<v/2;V+=3){const U=k[V],q=k[V+1],Y=k[V+2];M.emplaceBack(U,q),M.emplaceBack(q,Y),M.emplaceBack(Y,U)}const B=f.bindVertexArrayOES.current,z=new __;return z.buf=new ms(f,M),z.lastUsedFrameIdx=r,this._storage.set(a.id,z),f.bindVertexArrayOES.set(B),z.buf}update(r){for(const[a,f]of this._storage)r-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(a))}destroy(){for(const[r,a]of this._storage)a.buf.destroy(),this._storage.delete(r)}}class $d{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Gl={symbol:function(d,r,a,f,_){if(d.renderPass!=="translucent")return;const v=st.disabled,w=d.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(B,z,V,U,q,Y,J){const ee=z.transform,re=q==="map",he=Y==="map";for(const pe of B){const ce=U.getTile(pe),ye=ce.getBucket(V);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const ge=s.bj(ye.textSizeData,ee.zoom),Ae=hs(pe,ye.getProjection(),ee),Te=ee.calculatePixelsToTileUnitsMatrix(ce),Se=Wr(Ae,ce.tileID.canonical,he,re,ee,ye.getProjection(),Te),Oe=ye.hasIconTextFit()&&ye.hasIconData();if(ge){const ke=Math.pow(2,ee.zoom-ce.tileID.overscaledZ);Sv(ye,re,he,J,s.cS,ee,Se,pe,ke,ge,Oe)}}}(f,d,a,r,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),_);const k=a.paint.get("icon-opacity").constantOr(1)!==0,M=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||M)?xh(d,r,a,f,v,w):(k&&xh(d,r,a,f,v,w,{onlyIcons:!0}),M&&xh(d,r,a,f,v,w,{onlyText:!0})),r.map.showCollisionBoxes&&(Bd(d,r,a,f,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Bd(d,r,a,f,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(d,r,a,f){if(d.renderPass!=="translucent")return;const _=a.paint.get("circle-opacity"),v=a.paint.get("circle-stroke-width"),w=a.paint.get("circle-stroke-opacity"),k=a.layout.get("circle-sort-key").constantOr(1)!==void 0,M=a.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(v.constantOr(1)===0||w.constantOr(1)===0))return;const B=d.context,z=B.gl,V=d.transform,U=d.depthModeForSublayer(0,fe.ReadOnly),q=st.disabled,Y=d.colorModeForDrapableLayerRenderPass(M),J=V.projection.name==="globe",ee=[s.am(V.center.lng),s.at(V.center.lat)],re=[];for(let pe=0;pe<f.length;pe++){const ce=f[pe],ye=r.getTile(ce),ge=ye.getBucket(a);if(!ge||ge.projection.name!==V.projection.name)continue;const Ae=ge.programConfigurations.get(a.id),Te=s.cT(a),Se=d.isTileAffectedByFog(ce);J&&Te.push("PROJECTION_GLOBE_VIEW"),Te.push("DEPTH_D24"),d.terrain&&V.depthOcclusionForSymbolsAndCircles&&Te.push("DEPTH_OCCLUSION");const Oe=d.getOrCreateProgram("circle",{config:Ae,defines:Te,overrideFog:Se}),ke=ge.layoutVertexBuffer,Re=ge.globeExtVertexBuffer,Xe=ge.indexBuffer,ht=V.projection.createInversionMatrix(V,ce.canonical),bt={programConfiguration:Ae,program:Oe,layoutVertexBuffer:ke,globeExtVertexBuffer:Re,indexBuffer:Xe,uniformValues:s.cU(d,ce,ye,ht,ee,a),tile:ye};if(k){const ct=ge.segments.get();for(const Rt of ct)re.push({segments:new s.b1([Rt]),sortKey:Rt.sortKey,state:bt})}else re.push({segments:ge.segments,sortKey:0,state:bt})}k&&re.sort((pe,ce)=>pe.sortKey-ce.sortKey);const he={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const pe of re){const{programConfiguration:ce,program:ye,layoutVertexBuffer:ge,globeExtVertexBuffer:Ae,indexBuffer:Te,uniformValues:Se,tile:Oe}=pe.state,ke=pe.segments;d.terrain&&d.terrain.setupElevationDraw(Oe,ye,he),d.uploadCommonUniforms(B,ye,Oe.tileID.toUnwrapped()),ye.draw(d,z.TRIANGLES,U,q,Y,cr.disabled,Se,a.id,ge,Te,ke,a.paint,V.zoom,ce,[Ae])}},heatmap:function(d,r,a,f){if(a.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const _=d.context,v=_.gl,w=st.disabled,k=new te([v.ONE,v.ONE,v.ONE,v.ONE],s.bz.transparent,[!0,!0,!0,!0]);(function(q,Y,J,ee){const re=q.gl,he=Y.width*ee,pe=Y.height*ee;q.activeTexture.set(re.TEXTURE1),q.viewport.set([0,0,he,pe]);let ce=J.heatmapFbo;if(!ce||ce&&(ce.width!==he||ce.height!==pe)){ce&&ce.destroy();const ye=re.createTexture();re.bindTexture(re.TEXTURE_2D,ye),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),ce=J.heatmapFbo=q.createFramebuffer(he,pe,!0,null),function(ge,Ae,Te,Se,Oe,ke){const Re=ge.gl;Re.texImage2D(Re.TEXTURE_2D,0,ge.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,Oe,ke,0,Re.RGBA,ge.extRenderToTextureHalfFloat?Re.HALF_FLOAT:Re.UNSIGNED_BYTE,null),Se.colorAttachment.set(Te)}(q,0,ye,ce,he,pe)}else re.bindTexture(re.TEXTURE_2D,ce.colorAttachment.get()),q.bindFramebuffer.set(ce.framebuffer)})(_,d,a,d.transform.projection.name==="globe"?.5:.25),_.clear({color:s.bz.transparent});const M=d.transform,B=M.projection.name==="globe",z=B?["PROJECTION_GLOBE_VIEW"]:[],V=B?cr.frontCCW:cr.disabled,U=[s.am(M.center.lng),s.at(M.center.lat)];for(let q=0;q<f.length;q++){const Y=f[q];if(r.hasRenderableParent(Y))continue;const J=r.getTile(Y),ee=J.getBucket(a);if(!ee||ee.projection.name!==M.projection.name)continue;const re=d.isTileAffectedByFog(Y),he=ee.programConfigurations.get(a.id),pe=d.getOrCreateProgram("heatmap",{config:he,defines:z,overrideFog:re}),{zoom:ce}=d.transform;d.terrain&&d.terrain.setupElevationDraw(J,pe),d.uploadCommonUniforms(_,pe,Y.toUnwrapped());const ye=M.projection.createInversionMatrix(M,Y.canonical);pe.draw(d,v.TRIANGLES,fe.disabled,w,k,V,Ev(d,Y,J,ye,U,ce,a.paint.get("heatmap-intensity")),a.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,a.paint,d.transform.zoom,he,B?[ee.globeExtVertexBuffer]:null)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,v){const w=_.context,k=w.gl,M=v.heatmapFbo;if(!M)return;w.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,M.colorAttachment.get()),w.activeTexture.set(k.TEXTURE1);let B=v.colorRampTexture;B||(B=v.colorRampTexture=new s.T(w,v.colorRamp,k.RGBA8)),B.bind(k.LINEAR,k.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,k.TRIANGLES,fe.disabled,st.disabled,_.colorModeForRenderPass(),cr.disabled,((z,V,U,q)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,v),v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(d,a))},line:function(d,r,a,f){if(d.renderPass!=="translucent")return;const _=a.paint.get("line-opacity"),v=a.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;const w=a.paint.get("line-emissive-strength"),k=a.paint.get("line-occlusion-opacity"),M=d.context,B=M.gl,z=a.layout.get("line-z-offset"),V=!z.isConstant()||!!z.constantOr(0),U=V?new fe(d.depthOcclusion?B.GREATER:B.LEQUAL,fe.ReadOnly,d.depthRangeFor3D):d.depthModeForSublayer(0,fe.ReadOnly),q=d.colorModeForDrapableLayerRenderPass(w),Y=d.terrain&&d.terrain.renderingToTexture,J=Y?1:s.q.devicePixelRatio,ee=a.paint.get("line-dasharray"),re=ee.constantOr(1),he=a.layout.get("line-cap"),pe=ee.constantOr(null),ce=he.constantOr(null),ye=a.paint.get("line-pattern"),ge=ye.constantOr(1),Ae=ye.constantOr(null),Te=a.paint.get("line-opacity").constantOr(1);let Se=!ge&&Te!==1||d.depthOcclusion&&k>0&&k<1;const Oe=a.paint.get("line-gradient"),ke=ge?"linePattern":"line",Re=s.cV(a);let Xe;if(Y&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Se=!1),k!==0&&d.depthOcclusion){const bt=a.paint._values["line-opacity"];bt&&bt.value&&bt.value.kind==="constant"?Xe=bt.value:s.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}if(V&&(d.forceTerrainMode=!0),!V&&k!==0&&d.terrain&&!Y)return void s.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const ht=Se&&V?d.stencilModeFor3D():st.disabled;for(const bt of f){const ct=r.getTile(bt);if(ge&&!ct.patternsLoaded())continue;const Rt=ct.getBucket(a);if(!Rt)continue;d.prepareDrawTile();const Ke=Rt.programConfigurations.get(a.id),gt=d.isTileAffectedByFog(bt),pt=d.getOrCreateProgram(ke,{config:Ke,defines:V?[...Re,"ELEVATED"]:Re,overrideFog:gt});if(Ae&&ct.imageAtlas){const Nt=ct.imageAtlas.patternPositions[Ae.toString()];Nt&&Ke.setConstantPatternPositions(Nt)}if(!ge&&pe&&ce&&ct.lineAtlas){const Nt=ct.lineAtlas.getDash(pe,ce);Nt&&Ke.setConstantPatternPositions(Nt)}let[Pt,Lt]=a.paint.get("line-trim-offset");(ce==="round"||ce==="square")&&Pt!==Lt&&(Pt===0&&(Pt-=1),Lt===1&&(Lt+=1));const yt=Y?bt.projMatrix:null,Tt=ge?s.cW(d,ct,a,yt,J,[Pt,Lt]):s.cX(d,ct,a,yt,Rt.lineClipsArray.length,J,[Pt,Lt]);if(Oe){const Nt=Rt.gradients[a.id];let Qt=Nt.texture;if(a.gradientVersion!==Nt.version){let kr=256;if(a.stepInterpolant){const ar=r.getSource().maxzoom,Tr=bt.canonical.z===ar?Math.ceil(1<<d.transform.maxZoom-bt.canonical.z):1;kr=s.ap(s.cY(Rt.maxLineLength/s.ab*1024*Tr),256,M.maxTextureSize)}Nt.gradient=s.cZ({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:kr,image:Nt.gradient||void 0,clips:Rt.lineClipsArray}),Nt.texture?Nt.texture.update(Nt.gradient):Nt.texture=new s.T(M,Nt.gradient,B.RGBA8),Nt.version=a.gradientVersion,Qt=Nt.texture}M.activeTexture.set(B.TEXTURE1),Qt.bind(a.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}re&&(M.activeTexture.set(B.TEXTURE0),ct.lineAtlasTexture&&ct.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),Ke.updatePaintBuffers()),ge&&(M.activeTexture.set(B.TEXTURE0),ct.imageAtlasTexture&&ct.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ke.updatePaintBuffers()),V&&d.terrain.setupElevationDraw(ct,pt),d.uploadCommonUniforms(M,pt,bt.toUnwrapped());const _r=Nt=>{Xe!=null&&(Xe.value=Te*k),pt.draw(d,B.TRIANGLES,U,Nt,q,cr.disabled,Tt,a.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,a.paint,d.transform.zoom,Ke,[Rt.layoutVertexBuffer2,Rt.patternVertexBuffer,Rt.zOffsetVertexBuffer]),Xe!=null&&(Xe.value=Te)};if(Se&&!V){const Nt=d.stencilModeForClipping(bt).ref;Nt===0&&Y&&M.clear({stencil:0});const Qt={func:B.EQUAL,mask:255};Tt.u_alpha_discard_threshold=.8,_r(new st(Qt,Nt,255,B.KEEP,B.KEEP,B.INVERT)),Tt.u_alpha_discard_threshold=0,_r(new st(Qt,Nt,255,B.KEEP,B.KEEP,B.KEEP))}else Se&&V&&(Tt.u_alpha_discard_threshold=.001),_r(V?ht:d.stencilModeForClipping(bt))}Se&&(d.resetStencilClippingMasks(),Y&&M.clear({stencil:0})),k===0||d.depthOcclusion||Y||d.layersWithOcclusionOpacity.push(d.currentLayer),V&&(d.forceTerrainMode=!1)},fill:function(d,r,a,f){const _=a.paint.get("fill-color"),v=a.paint.get("fill-opacity"),w=a.is3D(),k=new fe(d.context.gl.LEQUAL,fe.ReadWrite,d.depthRangeFor3D);if(v.constantOr(1)===0)return;const M=a.paint.get("fill-emissive-strength"),B=d.colorModeForDrapableLayerRenderPass(M),z=a.paint.get("fill-pattern"),V=d.opaquePassEnabledForLayer()&&!z.constantOr(1)&&_.constantOr(s.bz.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===V){const U=w?k:d.depthModeForSublayer(1,d.renderPass==="opaque"?fe.ReadWrite:fe.ReadOnly);zd(d,r,a,f,U,B,!1)}if(!w&&d.renderPass==="translucent"&&a.paint.get("fill-antialias")){const U=w?k:d.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,fe.ReadOnly);zd(d,r,a,f,U,B,!0)}},"fill-extrusion":function(d,r,a,f){const _=a.paint.get("fill-extrusion-opacity"),v=d.context,w=v.gl,k=d.terrain,M=k&&k.renderingToTexture;if(_===0)return;const B=d.conflationActive&&d.style.isLayerClipped(a,r.getSource()),z=d.style.order.indexOf(a.fqid);if(B&&function(V,U,q,Y,J){for(const ee of Y){const re=U.getTile(ee).getBucket(q);re&&(re.updateReplacement(ee,V.replacementSource,J),re.uploadCentroid(V.context))}}(d,r,a,f,z),k||B)for(const V of f){const U=r.getTile(V).getBucket(a);U&&$l(d.context,r,V,U,a,k,B)}if(d.renderPass==="shadow"&&d.shadowRenderer){const V=d.shadowRenderer;if(k&&_<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.a4)return;const U=V.getShadowPassDepthMode(),q=V.getShadowPassColorMode();au(d,r,a,f,U,st.disabled,q,B)}else if(d.renderPass==="translucent"){const V=!a.paint.get("fill-extrusion-pattern").constantOr(1),U=a.paint.get("fill-extrusion-color").constantOr(s.bz.white);if(!M&&U.a!==0){const q=new fe(d.context.gl.LEQUAL,fe.ReadWrite,d.depthRangeFor3D);_===1&&V?au(d,r,a,f,q,st.disabled,te.unblended,B):(au(d,r,a,f,q,st.disabled,te.disabled,B),au(d,r,a,f,q,d.stencilModeFor3D(),d.colorModeForRenderPass(),B),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&V&&(!k&&d.transform.projection.name!=="globe"||M)){const q=a.paint.get("fill-extrusion-opacity"),Y=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),J=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ee=a.paint.get("fill-extrusion-flood-light-intensity"),re=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(a.lut).toArray01().slice(0,3),he=Y>0&&J>0,pe=ee>0,ce=(ge,Ae,Te)=>(1-Te)*ge+Te*Ae,ye=ge=>{const Ae=d.depthModeForSublayer(1,fe.ReadOnly,w.LEQUAL,!0),Te=a.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Se=ce(.1,3,Te),Oe=d._showOverdrawInspector;if(!Oe){const ke=new st({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Re=new te([w.ONE,w.ONE,w.ONE,w.ONE],s.bz.transparent,[!1,!1,!1,!0],w.MIN);so(d,r,a,f,Ae,ke,Re,cr.disabled,ge,"sdf",q,Y,J,ee,re,Se,B,!1)}{const ke=Oe?st.disabled:new st({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Re=Oe?d.colorModeForRenderPass():new te([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],s.bz.transparent,[!0,!0,!0,!0]);so(d,r,a,f,Ae,ke,Re,cr.disabled,ge,"color",q,Y,J,ee,re,Se,B,!1)}};if(M){const ge=(Ae,Te,Se)=>{const Oe=d.depthModeForSublayer(1,fe.ReadOnly,w.LEQUAL,!1),ke=a.paint.get(Ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=ce(.1,3,ke);{const Xe=new te([w.ONE,w.ONE,w.ONE,w.ONE],s.bz.transparent,[!1,!1,!1,!0]);so(d,r,a,f,Oe,st.disabled,Xe,cr.disabled,Ae,"clear",q,Y,J,ee,re,Re,B,Te)}{const Xe=new st({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),ht=new te([w.ONE,w.ONE,w.ONE,w.ONE],s.bz.transparent,[!1,!1,!1,!0],w.MIN);so(d,r,a,f,Oe,Xe,ht,cr.disabled,Ae,"sdf",q,Y,J,ee,re,Re,B,Te)}{const Xe=Ae?w.ZERO:w.ONE_MINUS_DST_ALPHA,ht=new st({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),bt=new te([Xe,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],s.bz.transparent,[!0,!0,!0,!0]);so(d,r,a,f,Oe,ht,bt,cr.disabled,Ae,"color",q,Y,J,ee,re,Re,B,Te)}{const Xe=new te([w.ONE,w.ONE,w.ONE,Ae?w.ZERO:w.ONE],s.bz.transparent,[!1,!1,!1,!0],Ae?w.FUNC_ADD:w.MAX);so(d,r,a,f,Oe,st.disabled,Xe,cr.disabled,Ae,"clear",q,Y,J,ee,re,Re,B,Te,Se)}};if(he||pe){let Ae;if(d.prepareDrawTile(),k){const Te=k.drapeBufferSize[0],Se=k.drapeBufferSize[1];Ae=k.framebufferCopyTexture,Ae&&(!Ae||Ae.size[0]===Te&&Ae.size[1]===Se)||(Ae&&Ae.destroy(),Ae=k.framebufferCopyTexture=new s.T(v,new s.r({width:Te,height:Se}),w.RGBA8)),Ae.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexImage2D(w.TEXTURE_2D,0,w.RGBA,0,0,Te,Se,0)}he&&ge(!0,!1,Ae),pe&&ge(!1,!0,Ae)}}else he&&ye(!0),pe&&ye(!1),(he||pe)&&d.resetStencilClippingMasks()}}},hillshade:function(d,r,a,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const _=d.context,v=d.terrain&&d.terrain.renderingToTexture,[w,k]=d.renderPass!=="translucent"||v?[{},f]:d.stencilConfigForOverlap(f);for(const M of k){const B=r.getTile(M);if(B.needsHillshadePrepare&&d.renderPass==="offscreen")bn(d,B,a);else if(d.renderPass==="translucent"){const z=d.depthModeForSublayer(0,fe.ReadOnly),V=a.paint.get("hillshade-emissive-strength"),U=d.colorModeForDrapableLayerRenderPass(V),q=v&&d.terrain?d.terrain.stencilModeForRTTOverlap(M):w[M.overscaledZ];gr(d,M,B,a,z,q,U)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,r,a,f,_,v){if(d.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const w=d.transform.projection.name==="globe",k=a.paint.get("raster-elevation")!==0,M=k&&w;if(d.renderElevatedRasterBackface&&!M)return;const B=d.context,z=B.gl,V=r.getSource(),U=function(ge,Ae,Te,Se){const Oe=Ae.paint.get("raster-color"),ke=ge.type==="raster-array",Re=[],Xe=Ae.paint.get("raster-resampling"),ht=Ae.paint.get("raster-color-mix");let bt=Ae.paint.get("raster-color-range");const ct=[ht[0],ht[1],ht[2],0],Rt=ht[3];let Ke=Xe==="nearest"?Se.NEAREST:Se.LINEAR;if(ke&&(Re.push("RASTER_ARRAY"),Oe||Re.push("RASTER_COLOR"),Xe==="linear"&&Re.push("RASTER_ARRAY_LINEAR"),Ke=Se.NEAREST,!bt&&ge.rasterLayers)){const gt=ge.rasterLayers.find(({id:pt})=>pt===Ae.sourceLayer);gt&&gt.fields&&gt.fields.range&&(bt=gt.fields.range)}if(bt=bt||[0,1],Oe){Re.push("RASTER_COLOR"),Te.activeTexture.set(Se.TEXTURE2),Ae.updateColorRamp(bt);let gt=Ae.colorRampTexture;gt||(gt=Ae.colorRampTexture=new s.T(Te,Ae.colorRamp,Se.RGBA8)),gt.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}return{mix:ct,range:bt,offset:Rt,defines:Re,resampling:Ke}}(V,a,B,z);if(V instanceof s.aD&&!f.length&&!w)return;const q=a.paint.get("raster-emissive-strength"),Y=d.colorModeForDrapableLayerRenderPass(q),J=d.terrain&&d.terrain.renderingToTexture,ee=!d.options.moving,re=a.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(V instanceof s.aD&&!f.length&&(V.onNorthPole||V.onSouthPole)){const ge=k?d.stencilModeFor3D():st.disabled;return void gs(!!V.onNorthPole,null,d,r,a,q,U,cr.disabled,ge)}if(!f.length)return;const[he,pe]=V instanceof s.aD||J?[{},f]:d.stencilConfigForOverlap(f),ce=pe[pe.length-1].overscaledZ;M&&U.defines.push("PROJECTION_GLOBE_VIEW"),k&&U.defines.push("RENDER_CUTOFF");const ye=(ge,Ae,Te)=>{for(const Se of ge){const Oe=Se.toUnwrapped(),ke=r.getTile(Se);if(J&&(!ke||!ke.hasData()))continue;B.activeTexture.set(z.TEXTURE0);const Re=Fd(ke,V,a,U);if(!Re||!Re.texture)continue;const{texture:Xe,mix:ht,offset:bt,tileSize:ct,buffer:Rt}=Re;let Ke,gt;J?(Ke=fe.disabled,gt=Se.projMatrix):k?(Ke=new fe(z.LEQUAL,fe.ReadWrite,d.depthRangeFor3D),gt=w?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(Oe,ee)):(Ke=d.depthModeForSublayer(Se.overscaledZ-ce,a.paint.get("raster-opacity")===1?fe.ReadWrite:fe.ReadOnly,z.LESS),gt=d.transform.calculateProjMatrix(Oe,ee));const pt=d.terrain&&J?d.terrain.stencilModeForRTTOverlap(Se):he[Se.overscaledZ],Pt=v?0:a.paint.get("raster-fade-duration");ke.registerFadeDuration(Pt);const Lt=r.findLoadedParent(Se,0),yt=Ad(ke,Lt,r,d.transform,Pt);let Tt,_r;d.terrain&&d.terrain.prepareDrawTile(),B.activeTexture.set(z.TEXTURE0),Xe.bind(re,z.CLAMP_TO_EDGE),B.activeTexture.set(z.TEXTURE1),Lt?(Lt.texture&&Lt.texture.bind(re,z.CLAMP_TO_EDGE),Tt=Math.pow(2,Lt.tileID.overscaledZ-ke.tileID.overscaledZ),_r=[ke.tileID.canonical.x*Tt%1,ke.tileID.canonical.y*Tt%1]):Xe.bind(re,z.CLAMP_TO_EDGE),Xe.useMipmap&&B.extTextureFilterAnisotropic&&d.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const Nt=d.transform;let Qt;const kr=k?wi(Nt):[0,0,0,0];let ar,Tr,qr,Ur,kn,zn=0;if(M&&V instanceof s.aD&&V.coordinates.length>3)ar=Float32Array.from(s.b5(s.cC(new s.bP(0,0,0)))),Tr=Float32Array.from(Nt.globeMatrix),qr=Float32Array.from(s.cy(Nt)),Ur=[s.am(Nt.center.lng),s.at(Nt.center.lat)],Qt=V.elevatedGlobePerspectiveTransform,kn=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){const Qr=s.cz(Se.canonical);zn=s.cA(Qr.getCenter().lat),ar=Float32Array.from(s.b5(s.cC(Se.canonical))),Tr=Float32Array.from(Nt.globeMatrix),qr=Float32Array.from(s.cy(Nt)),Ur=[s.am(Nt.center.lng),s.at(Nt.center.lat)],Qt=[0,0],kn=Float32Array.from(s.cB(Se.canonical,Qr,zn,Nt.worldSize/Nt._pixelsPerMercatorPixel))}else Qt=V instanceof s.aD?V.perspectiveTransform:[0,0],ar=new Float32Array(16),Tr=new Float32Array(9),qr=new Float32Array(16),Ur=[0,0],kn=new Float32Array(9);const Xn=vh(gt,ar,Tr,qr,kn,_r||[0,0],s.a9(d.transform.zoom),Ur,kr,Tt||1,yt,a,Qt,k?a.paint.get("raster-elevation"):0,2,ht,bt,U.range,ct,Rt,q),ea=d.isTileAffectedByFog(Se),Li=d.getOrCreateProgram("raster",{defines:U.defines,overrideFog:ea});if(d.uploadCommonUniforms(B,Li,Oe),V instanceof s.aD){const Qr=V.elevatedGlobeVertexBuffer,Ln=V.elevatedGlobeIndexBuffer;if(J||!w)V.boundsBuffer&&V.boundsSegments&&Li.draw(d,z.TRIANGLES,Ke,st.disabled,Y,cr.disabled,Xn,a.id,V.boundsBuffer,d.quadTriangleIndexBuffer,V.boundsSegments);else if(Qr&&Ln){const ai=Nt.zoom<=s.c2?V.elevatedGlobeSegments:V.getSegmentsForLongitude(Nt.center.lng);ai&&Li.draw(d,z.TRIANGLES,Ke,st.disabled,Y,Ae,Xn,a.id,Qr,Ln,ai)}}else if(M){Ke=new fe(z.LEQUAL,fe.ReadOnly,d.depthRangeFor3D);const Qr=d.globeSharedBuffers;if(Qr){const[Ln,ai,Mn]=Qr.getGridBuffers(zn,!1);Li.draw(d,z.TRIANGLES,Ke,Te||pt,d.colorModeForRenderPass(),Ae,Xn,a.id,Ln,ai,Mn)}}else{const{tileBoundsBuffer:Qr,tileBoundsIndexBuffer:Ln,tileBoundsSegments:ai}=d.getTileBoundsBuffers(ke);Li.draw(d,z.TRIANGLES,Ke,pt,Y,cr.disabled,Xn,a.id,Qr,Ln,ai)}}if(!(V instanceof s.aD)&&M)for(const Se of ge){const Oe=Se.canonical.y===(1<<Se.canonical.z)-1;Se.canonical.y===0&&gs(!0,Se,d,r,a,q,U,Ae,Te||st.disabled),Oe&&gs(!1,Se,d,r,a,q,U,Ae===cr.frontCW?cr.backCW:cr.frontCW,Te||st.disabled)}};M?ye(pe,d.renderElevatedRasterBackface?cr.backCW:cr.frontCW,d.stencilModeFor3D()):ye(pe,cr.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,r,a,f,_,v){d.renderPass==="offscreen"&&function(w,k,M,B){if(!B.length)return;const z=w.context,V=z.gl,U=k.getSource();if(!(U instanceof pa))return;const q=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count")));let Y=M.particlePositionRGBAImage;if(!Y||Y.width!==q){const pe=function(ce){const ye=ce*ce,ge=new Uint8Array(4*ye),Ae=function(Se){return Se|=0,Se=Math.imul(2747636419^Se,2654435769),Se=Math.imul(Se^Se>>>16,2654435769),((Se=Math.imul(Se^Se>>>16,2654435769))>>>0)/4294967296},Te=1/1.1;for(let Se=0;Se<ye;Se++){const Oe=Te*(Ae(2*Se+0)+Xa),ke=Te*(Ae(2*Se+1)+Xa),Re=255*Oe%1,Xe=255*ke%1,ht=Re,bt=ke-Xe/255,ct=Xe;ge[4*Se+0]=255*(Oe-Re/255),ge[4*Se+1]=255*ht,ge[4*Se+2]=255*bt,ge[4*Se+3]=255*ct}return ge}(q);Y=M.particlePositionRGBAImage=new s.r({width:q,height:q},pe)}let J=M.particleFramebuffer;J?J.width!==q&&(J.destroy(),J=M.particleFramebuffer=z.createFramebuffer(q,q,!0,null)):J=M.particleFramebuffer=z.createFramebuffer(q,q,!0,null);const ee=[];for(const pe of B){const ce=k.getTile(pe);if(!(ce instanceof $n))continue;const ye=f_(ce,U,M);if(!ye)continue;const ge=[ce.tileSize,ce.tileSize];let Ae=M.tileFramebuffer;Ae||(Ae=M.tileFramebuffer=z.createFramebuffer(ge[0],ge[1],!0,null));let Te=ce.rasterParticleState;Te||(Te=ce.rasterParticleState=new d_(z,pe,ge,Y));const Se=Te.update(M.lastInvalidatedAt);Te.particleTextureDimension!==q&&Te.updateParticleTexture(pe,Y);const Oe=Te.targetColorTexture;Te.targetColorTexture=Te.backgroundColorTexture,Te.backgroundColorTexture=Oe;const ke=Te.particleTexture0;Te.particleTexture0=Te.particleTexture1,Te.particleTexture1=ke,ee.push([pe,ye,Te,Se])}if(ee.length===0)return;const re=s.q.now(),he=M.previousDrawTimestamp?.001*(re-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=re,M.hasColorMap()){z.activeTexture.set(V.TEXTURE0+2);let pe=M.colorRampTexture;pe||(pe=M.colorRampTexture=new s.T(z,M.colorRamp,V.RGBA8)),pe.bind(V.LINEAR,V.CLAMP_TO_EDGE)}z.bindFramebuffer.set(M.tileFramebuffer.framebuffer),function(pe,ce,ye){const ge=pe.context,Ae=ge.gl,Te=ce.tileFramebuffer;ge.activeTexture.set(Ae.TEXTURE0);const Se={u_texture:0,u_opacity:1.05*(ke=ce.paint.get("raster-particle-fade-opacity-factor"))/(ke+.05)},Oe=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ke;for(const Re of ye){const[,,Xe,ht]=Re;Te.colorAttachment.set(Xe.targetColorTexture.texture),ge.viewport.set([0,0,Te.width,Te.height]),ge.clear({color:s.bz.transparent}),ht&&(Xe.backgroundColorTexture.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE),Oe.draw(pe,Ae.TRIANGLES,fe.disabled,st.disabled,te.alphaBlended,cr.disabled,Se,ce.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}}(w,M,ee),function(pe,ce,ye,ge){const Ae=pe.context,Te=Ae.gl,Se=ye.tileFramebuffer,Oe=pe.transform.projection.name==="globe",ke=ye.paint.get("raster-particle-max-speed");for(const Re of ge){const[Xe,ht,bt]=Re;Ae.activeTexture.set(Te.TEXTURE0+0),ht.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Se.colorAttachment.set(bt.targetColorTexture.texture);const ct=pe.getOrCreateProgram("rasterParticleDraw",{defines:ht.defines,overrideFog:!1});Ae.activeTexture.set(Te.TEXTURE0+1);const Rt=ht.scalarData?[]:[0,1,2,3].map(pt=>s.c$[pt](Xe));Rt.push(Xe);const Ke=Xe.canonical.x,gt=Xe.canonical.y;for(const pt of Rt){const Pt=ce.getTile(Oe?pt.wrapped():pt);if(!Pt)continue;const Lt=Pt.rasterParticleState;if(!Lt)continue;const yt=pt.canonical.x+(1<<pt.canonical.z)*(pt.wrap-Xe.wrap),Tt=pt.canonical.y;Lt.particleTexture0.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const _r=Pd(1,Lt.particleTexture0.size[0],[yt-Ke,Tt-gt],0,ht.texture.size,2,ke,ht.textureOffset,ht.scale,ht.offset);ct.draw(pe,Te.POINTS,fe.disabled,st.disabled,te.alphaBlended,cr.disabled,_r,ye.id,Lt.particleIndexBuffer,void 0,Lt.particleSegment)}}}(w,k,M,ee),z.bindFramebuffer.set(M.particleFramebuffer.framebuffer),function(pe,ce,ye,ge){const Ae=pe.context,Te=Ae.gl,Se=ce.paint.get("raster-particle-max-speed"),Oe=ge*ce.paint.get("raster-particle-speed-factor")*.15,ke=function(Xe){return Math.pow(Xe,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),Re=ce.particleFramebuffer;Ae.viewport.set([0,0,Re.width,Re.height]);for(const Xe of ye){const[,ht,bt]=Xe;Ae.activeTexture.set(Te.TEXTURE0+0),ht.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Ae.activeTexture.set(Te.TEXTURE0+1);const ct=bt.particleTexture0;ct.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const Rt=Md(1,ct.size[0],0,ht.texture.size,Se,Oe,ke,ht.textureOffset,ht.scale,ht.offset);Re.colorAttachment.set(bt.particleTexture1.texture),Ae.clear({color:s.bz.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:ht.defines}).draw(pe,Te.TRIANGLES,fe.disabled,st.disabled,te.unblended,cr.disabled,Rt,ce.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}}(w,M,ee,he)}(d,r,a,f),d.renderPass==="translucent"&&(function(w,k,M,B,z){const V=w.context,U=V.gl,q=k.getSource().tileSize,Y=5*(1-s.a7(s.bU,s.bU+1,w.transform.zoom))*q+M.paint.get("raster-particle-elevation"),J=!w.options.moving,ee=w.transform.projection.name==="globe";if(!B.length)return;const[re,he]=w.stencilConfigForOverlap(B),pe=[];ee&&pe.push("PROJECTION_GLOBE_VIEW");const ce=w.stencilModeFor3D();for(const ye of he){const ge=ye.toUnwrapped(),Ae=k.getTile(ye);if(!Ae.rasterParticleState)continue;const Te=Ae.rasterParticleState,Se=100;Ae.registerFadeDuration(Se);const Oe=k.findLoadedParent(ye,0),ke=Ad(Ae,Oe,k,w.transform,Se);let Re,Xe;w.terrain&&w.terrain.prepareDrawTile(),V.activeTexture.set(U.TEXTURE0),Te.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),V.activeTexture.set(U.TEXTURE1),Oe&&Oe.rasterParticleState?(Oe.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Re=Math.pow(2,Oe.tileID.overscaledZ-Ae.tileID.overscaledZ),Xe=[Ae.tileID.canonical.x*Re%1,Ae.tileID.canonical.y*Re%1]):Te.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const ht=ee?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(ge,J),bt=w.transform,ct=p_(bt),Rt=s.cz(ye.canonical),Ke=s.cA(Rt.getCenter().lat);let gt,pt,Pt,Lt,yt;ee?(gt=Float32Array.from(s.b5(s.cC(ye.canonical))),pt=Float32Array.from(bt.globeMatrix),Pt=Float32Array.from(s.cy(bt)),Lt=[s.am(bt.center.lng),s.at(bt.center.lat)],yt=Float32Array.from(s.cB(ye.canonical,Rt,Ke,bt.worldSize/bt._pixelsPerMercatorPixel))):(gt=new Float32Array(16),pt=new Float32Array(9),Pt=new Float32Array(16),Lt=[0,0],yt=new Float32Array(9));const Tt=l_(ht,gt,pt,Pt,yt,Xe||[0,0],s.a9(w.transform.zoom),Lt,ct,Re||1,ke,Y),_r=w.isTileAffectedByFog(ye),Nt=w.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:_r});if(w.uploadCommonUniforms(V,Nt,ge),ee){const Qt=new fe(U.LEQUAL,fe.ReadOnly,w.depthRangeFor3D),kr=0,ar=w.globeSharedBuffers;if(ar){const[Tr,qr,Ur]=ar.getGridBuffers(Ke,kr!==0);Nt.draw(w,U.TRIANGLES,Qt,ce,te.alphaBlended,w.renderElevatedRasterBackface?cr.frontCCW:cr.backCCW,Tt,M.id,Tr,qr,Ur)}}else{const Qt=w.depthModeForSublayer(0,fe.ReadOnly),kr=re[ye.overscaledZ],{tileBoundsBuffer:ar,tileBoundsIndexBuffer:Tr,tileBoundsSegments:qr}=w.getTileBoundsBuffers(Ae);Nt.draw(w,U.TRIANGLES,Qt,kr,te.alphaBlended,cr.disabled,Tt,M.id,ar,Tr,qr)}}w.resetStencilClippingMasks()}(d,r,a,f),d.style.map.triggerRepaint())},background:function(d,r,a,f){const _=a.paint.get("background-color"),v=a.paint.get("background-opacity"),w=a.paint.get("background-emissive-strength"),k=a.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;const M=d.context,B=M.gl,z=d.transform,V=z.tileSize,U=a.paint.get("background-pattern");let q;if(U!==void 0&&(U===null||(q=d.imageManager.getPattern(U.toString(),a.scope,d.style.getLut(a.scope)),!q)))return;const Y=!U&&_.a===1&&v===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==Y)return;const J=st.disabled,ee=d.depthModeForSublayer(0,Y==="opaque"?fe.ReadWrite:fe.ReadOnly),re=d.colorModeForDrapableLayerRenderPass(w),he=U?"backgroundPattern":"background";let pe,ce=f;if(ce||(pe=d.getBackgroundTiles(),ce=Object.values(pe).map(ye=>ye.tileID)),U&&(M.activeTexture.set(B.TEXTURE0),d.imageManager.bind(d.context,a.scope)),k){const ye=d.getOrCreateProgram(he,{overrideFog:!1,overrideRtt:!0}),ge=new Float32Array(s.a6.mat4.identity([])),Ae=new s.aA(0,0,0,0,0),Te=U?vc(ge,w,v,d,0,a.scope,q,k,{tileID:Ae,tileSize:V}):c_(ge,w,v,_.toRenderColor(a.lut));ye.draw(d,B.TRIANGLES,ee,J,re,cr.disabled,Te,a.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const ye of ce){const ge=d.isTileAffectedByFog(ye),Ae=d.getOrCreateProgram(he,{overrideFog:ge}),Te=ye.toUnwrapped(),Se=f?ye.projMatrix:d.transform.calculateProjMatrix(Te);d.prepareDrawTile();const Oe=r?r.getTile(ye):pe?pe[ye.key]:new jo(ye,V,z.zoom,d),ke=U?vc(Se,w,v,d,0,a.scope,q,k,{tileID:ye,tileSize:V}):c_(Se,w,v,_.toRenderColor(a.lut));d.uploadCommonUniforms(M,Ae,Te);const{tileBoundsBuffer:Re,tileBoundsIndexBuffer:Xe,tileBoundsSegments:ht}=d.getTileBoundsBuffers(Oe);Ae.draw(d,B.TRIANGLES,ee,J,re,cr.disabled,ke,a.id,Re,Xe,ht)}},sky:function(d,r,a){const f=d._atmosphere?s.a9(d.transform.zoom):1,_=a.paint.get("sky-opacity")*f;if(_===0)return;const v=d.context,w=a.paint.get("sky-type"),k=new fe(v.gl.LEQUAL,fe.ReadOnly,[0,1]),M=d.frameCounter/1e3%1;w==="atmosphere"?d.renderPass==="offscreen"?a.needsSkyboxCapture(d)&&(function(B,z,V,U){const q=B.context,Y=q.gl;let J=z.skyboxFbo;if(!J){J=z.skyboxFbo=q.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new Mp(q),z.skyboxTexture=q.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,z.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let pe=0;pe<6;++pe)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(J.framebuffer),q.viewport.set([0,0,32,32]);const ee=z.getCenter(B,!0),re=B.getOrCreateProgram("skyboxCapture"),he=new Float64Array(16);s.a6.mat4.identity(he),s.a6.mat4.rotateY(he,he,.5*-Math.PI),xc(B,z,re,he,ee,0),s.a6.mat4.identity(he),s.a6.mat4.rotateY(he,he,.5*Math.PI),xc(B,z,re,he,ee,1),s.a6.mat4.identity(he),s.a6.mat4.rotateX(he,he,.5*-Math.PI),xc(B,z,re,he,ee,2),s.a6.mat4.identity(he),s.a6.mat4.rotateX(he,he,.5*Math.PI),xc(B,z,re,he,ee,3),s.a6.mat4.identity(he),xc(B,z,re,he,ee,4),s.a6.mat4.identity(he),s.a6.mat4.rotateY(he,he,Math.PI),xc(B,z,re,he,ee,5),q.viewport.set([0,0,B.width,B.height])}(d,a),a.markSkyboxValid(d)):d.renderPass==="sky"&&function(B,z,V,U,q){const Y=B.context,J=Y.gl,ee=B.transform,re=B.getOrCreateProgram("skybox");Y.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,z.skyboxTexture);const he=((pe,ce,ye,ge,Ae)=>({u_matrix:pe,u_sun_direction:ce,u_cubemap:0,u_opacity:ge,u_temporal_offset:Ae}))(ee.skyboxMatrix,z.getCenter(B,!1),0,U,q);B.uploadCommonUniforms(Y,re),re.draw(B,J.TRIANGLES,V,st.disabled,B.colorModeForRenderPass(),cr.backCW,he,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(d,a,k,_,M):w==="gradient"&&d.renderPass==="sky"&&function(B,z,V,U,q){const Y=B.context,J=Y.gl,ee=B.transform,re=B.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Mp(Y)),Y.activeTexture.set(J.TEXTURE0);let he=z.colorRampTexture;he||(he=z.colorRampTexture=new s.T(Y,z.colorRamp,J.RGBA8)),he.bind(J.LINEAR,J.CLAMP_TO_EDGE);const pe=((ce,ye,ge,Ae,Te)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:ye,u_radius:s.bB(ge),u_opacity:Ae,u_temporal_offset:Te}))(ee.skyboxMatrix,z.getCenter(B,!1),z.paint.get("sky-gradient-radius"),U,q);B.uploadCommonUniforms(Y,re),re.draw(B,J.TRIANGLES,V,st.disabled,B.colorModeForRenderPass(),cr.backCW,pe,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(d,a,k,_,M)},debug:function(d,r,a,f,_,v){for(let w=0;w<a.length;w++)if(_){const B=new s.bz(f.r*.8,f.g*.8,f.b*.8,1);wa(d,r,a[w],f,-1,-1,v),wa(d,r,a[w],f,-1,1,v),wa(d,r,a[w],f,1,1,v),wa(d,r,a[w],f,1,-1,v),wa(d,r,a[w],B,0,0,v)}else wa(d,r,a[w],f,0,0,v)},custom:function(d,r,a,f){const _=d.context,v=a.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&a.isDraped(r)){if(d.renderPass==="offscreen"){const w=v.prerender;if(w){if(d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const k=d.transform.pointMerc;w.call(v,_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.a9(d.transform.zoom),[k.x,k.y],d.transform.pixelsPerMeterRatio)}else w.call(v,_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const k=v.renderToTile;if(k){const M=f[0].canonical,B=new s.a5(M.x+f[0].wrap*(1<<M.z),M.y,M.z);_.setDepthMode(fe.disabled),_.setStencilMode(st.disabled),_.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),k.call(v,_.gl,B),_.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),_.setStencilMode(st.disabled);const w=v.renderingMode==="3d"?new fe(d.context.gl.LEQUAL,fe.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,fe.ReadOnly);if(_.setDepthMode(w),d.transform.projection.name==="globe"){const k=d.transform.pointMerc;v.render(_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.a9(d.transform.zoom),[k.x,k.y],d.transform.pixelsPerMeterRatio)}else v.render(_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState(),_.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,r,a,f){if(d.renderPass==="opaque")return;const _=a.paint.get("model-opacity");if(_===0)return;const v=a.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!v||d.terrain&&_<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof s.a4))return;const w=d.shadowRenderer,k=a.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,k||(w.enabled=!1));const M=()=>{w&&(w.useNormalOffset=!0,k||(w.enabled=!0))},B=r.getSource();if(d.renderPass==="light-beam"&&B.type!=="batched-model")return;if(B.type==="vector"||B.type==="geojson")return function(re,he,pe,ce,ye){const ge=re.transform;if(ge.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${ge.projection.name} projection is not yet implemented`);const Ae=ge.getFreeCameraOptions().position;if(!re.modelManager)return;const Te=re.modelManager;pe.modelManager=Te;const Se=re.shadowRenderer;if(!pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Oe=pe._unevaluatedLayout._values["model-id"],ke={...pe.layout.get("model-id").parameters},Re=re.style.order.indexOf(pe.fqid);for(const Xe of ce){const ht=he.getTile(Xe).getBucket(pe);if(!ht||ht.projection.name!==ge.projection.name)continue;const bt=ht.getModelUris();bt&&!ht.modelsRequested&&(Te.addModelsFromBucket(bt,ye),ht.modelsRequested=!0);const ct=Pv(Xe,ge);ke.zoom=ct;const Rt=Oe.possiblyEvaluate(ke);if(g_(re,ht,Xe),Ea.shadowUniformsInitialized=!1,Ea.useSingleShadowCascade=!!Se&&Se.getMaxCascadeForTile(Xe.toUnwrapped())===0,re.renderPass==="shadow"&&Se){if(re.currentShadowCascade===1&&ht.isInsideFirstShadowMapFrustum)continue;const pt=ge.calculatePosMatrix(Xe.toUnwrapped(),ge.worldSize);if(Ea.tileMatrix.set(pt),Ea.shadowTileMatrix=Float32Array.from(Se.calculateShadowPassMatrixFromMatrix(pt)),Ea.aabb.min.fill(0),Ea.aabb.max[0]=Ea.aabb.max[1]=s.ab,Ea.aabb.max[2]=0,Ah(ht,Ea,re,pe.scope))continue}const Ke=1<<Xe.canonical.z,gt=[((Ae.x-Xe.wrap)*Ke-Xe.canonical.x)*s.ab,(Ae.y*Ke-Xe.canonical.y)*s.ab,Ae.z*Ke*s.ab];re.conflationActive&&Object.keys(ht.instancesPerModel).length>0&&re.style.isLayerClipped(pe,he.getSource())&&ht.updateReplacement(Xe,re.replacementSource,Re,ye)&&(ht.uploaded=!1,ht.upload(re.context));for(let pt in ht.instancesPerModel){const Pt=ht.instancesPerModel[pt];Pt.features.length>0&&(pt=Rt.evaluate(Pt.features[0].feature,{}));const Lt=Te.getModel(pt,ye);if(Lt&&Lt.uploaded)for(const yt of Lt.nodes)zo(re,pe,yt,Pt,gt,Xe,Ea)}}}(d,r,a,f,B.type==="vector"?a.scope:""),void M();if(!B.loaded())return;if(B.type==="batched-model")return function(re,he,pe,ce){pe.resetLayerRenderingStats(re);const ye=re.context,ge=re.transform,Ae=re.style.fog,Te=re.shadowRenderer;if(ge.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${ge.projection.name} projection is not yet implemented`);const Se=re.transform.getFreeCameraOptions().position,Oe=s.a6.vec3.scale([],[Se.x,Se.y,Se.z],re.transform.worldSize),ke=s.a6.vec3.negate([],Oe),Re=s.a6.mat4.identity([]),Xe=s.de(ge.center.lat,ge.zoom),ht=s.a6.mat4.fromScaling([],[1,1,1/Xe]);s.a6.mat4.translate(Re,Re,ke);const bt=pe.paint.get("model-opacity"),ct=new fe(ye.gl.LEQUAL,fe.ReadWrite,re.depthRangeFor3D),Rt=new fe(ye.gl.LEQUAL,fe.ReadOnly,re.depthRangeFor3D),Ke=new s.c9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),gt=re.renderPass==="shadow",pt=gt&&Te?Te.getCurrentCascadeFrustum():ge.getFrustum(ge.scaleZoom(ge.worldSize)),Pt=pe.paint.get("model-front-cutoff"),Lt=Pt[2]<1,yt=ba(re,pe.paint.get("model-cutoff-fade-range")),Tt=pe.getLayerRenderingStats();(function(_r,Nt,Qt,kr){const ar=_r.terrain?_r.terrain.exaggeration():0,Tr=_r.transform.zoom;for(const qr of kr){const Ur=Nt.getTile(qr).getBucket(Qt);Ur&&(_r.conflationActive&&Ur.updateReplacement(qr,_r.replacementSource),Ur.evaluateScale(_r,Qt),_r.terrain&&ar>0&&Ur.elevationUpdate(_r.terrain,ar,qr,Qt.source),Ur.needsReEvaluation(_r,Tr,Qt)&&Ur.evaluate(Qt))}})(re,he,pe,ce),function(){let _r,Nt,Qt;Lt?(_r=ce.length-1,Nt=-1,Qt=-1):(_r=0,Nt=ce.length,Qt=1);const kr=new Float64Array(16),ar=s.a6.vec3.create(),Tr=new s.P(0,0);for(let qr=_r;qr!==Nt;qr+=Qt){const Ur=ce[qr],kn=he.getTile(Ur).getBucket(pe);if(!kn||!kn.uploaded)continue;let zn=!1;Te&&(zn=Te.getMaxCascadeForTile(Ur.toUnwrapped())===0);const Xn=ge.calculatePosMatrix(Ur.toUnwrapped(),ge.worldSize),ea=kn.modelTraits;!gt&&Lt&&(s.a6.mat4.invert(kr,Xn),s.a6.vec3.transformMat4(ar,Oe,kr),Tr.x=ar[0],Tr.y=ar[1]);const Li=[];for(const Qr of kn.getNodesInfo()){if(Qr.hiddenByReplacement||!Qr.node.meshes)continue;const Ln=Qr.node;let ai=0;re.terrain&&Ln.elevation&&(ai=Ln.elevation*re.terrain.exaggeration());const Mn=(()=>{const qn=Qr.aabb;return Ke.min=[...qn.min],Ke.max=[...qn.max],Ke.min[2]+=ai,Ke.max[2]+=ai,s.a6.vec3.transformMat4(Ke.min,Ke.min,Xn),s.a6.vec3.transformMat4(Ke.max,Ke.max,Xn),Ke})(),jr=Qr.evaluatedScale;if(jr[0]<=1&&jr[1]<=1&&jr[2]<=1&&Mn.intersects(pt)===0)continue;if(!gt&&Lt){const qn=.16666666666666666;Qr.cameraCollisionOpacity=Oe[0]>Mn.min[0]&&Oe[0]<Mn.max[0]&&Oe[1]>Mn.min[1]&&Oe[1]<Mn.max[1]&&Oe[2]*Xe<Mn.max[2]&&Ln.footprint&&s.bu(Tr,Ln.footprint)?Math.max(Qr.cameraCollisionOpacity-qn,0):Math.min(1,Qr.cameraCollisionOpacity+qn)}const fn=[...Xn],Cn=Ln.anchor?Ln.anchor[0]:0,Ei=Ln.anchor?Ln.anchor[1]:0;s.a6.mat4.translate(fn,fn,[Cn*(jr[0]-1),Ei*(jr[1]-1),ai]),s.a6.vec3.exactEquals(jr,s.dh)||s.a6.mat4.scale(fn,fn,jr);const Oi=s.a6.mat4.multiply([],fn,Ln.matrix),ln=s.a6.mat4.multiply([],ge.expandedFarZProjMatrix,Oi),Ki=s.a6.mat4.multiply([],ge.expandedFarZProjMatrix,fn),no=s.a6.vec4.transformMat4([],[Cn,Ei,ai,1],ln)[2];Ln.hidden=!1;let Yi=bt;gt||(Lt&&(Yi*=Qr.cameraCollisionOpacity,Yi*=dn(fn,ge,Qr.aabb,Pt)),Yi*=Jn(yt,no)),Yi!==0?Li.push({nodeInfo:Qr,depth:no,opacity:Yi,wvpForNode:ln,wvpForTile:Ki,nodeModelMatrix:Oi,tileModelMatrix:fn}):Ln.hidden=!0}gt||Li.sort((Qr,Ln)=>!Lt||Qr.opacity===1&&Ln.opacity===1?Qr.depth<Ln.depth?-1:1:Qr.opacity===1?-1:Ln.opacity===1?1:Qr.depth>Ln.depth?-1:1);for(const Qr of Li){const Ln=Qr.nodeInfo,ai=Ln.node;let Mn=s.a6.mat4.multiply([],ht,Qr.tileModelMatrix);s.a6.mat4.multiply(Mn,Re,Mn);const jr=s.a6.mat4.invert([],Mn);s.a6.mat4.transpose(jr,jr),s.a6.mat4.scale(jr,jr,Mv),Mn=s.a6.mat4.multiply(Mn,Mn,ai.matrix);const fn=re.renderPass==="light-beam",Cn=ea&s.dj.HasMapboxMeshFeatures,Ei=Cn?0:Ln.evaluatedRMEA[0][2];for(let Oi=0;Oi<ai.meshes.length;++Oi){const ln=ai.meshes[Oi],Ki=Oi===ai.lightMeshIndex;let no=Qr.wvpForNode;if(Ki){if(!fn&&!re.terrain&&re.shadowRenderer){re.currentLayer<re.firstLightBeamLayer&&(re.firstLightBeamLayer=re.currentLayer);continue}no=Qr.wvpForTile}else if(fn)continue;const Yi={defines:[]},qn=[];if(jd(Yi.defines,qn,ln,re,pe.lut),Cn||Yi.defines.push("DIFFUSE_SHADED"),zn&&Yi.defines.push("SHADOWS_SINGLE_CASCADE"),Tt&&(gt?Tt.numRenderedVerticesInShadowPass+=ln.vertexArray.length:Tt.numRenderedVerticesInTransparentPass+=ln.vertexArray.length),gt){hu(ln,Qr.nodeModelMatrix,re,pe);continue}let Jo=null;if(Ae){const ml=Ud(Qr.nodeModelMatrix,re.transform);if(Jo=new Float32Array(ml),ge.projection.name!=="globe"){const Xl=ln.aabb.min,Qa=ln.aabb.max,[_u,yu]=Ae.getOpacityForBounds(ml,Xl[0],Xl[1],Qa[0],Qa[1]);Yi.overrideFog=_u>=Gt||yu>=Gt}}const Qo=ln.material;let ta;Qo.occlusionTexture&&Qo.occlusionTexture.offsetScale&&(ta=Qo.occlusionTexture.offsetScale,Yi.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!gt&&Te&&(Te.useNormalOffset=!!ln.normalBuffer);const Ms=re.getOrCreateProgram("model",Yi);!gt&&Te&&Te.setupShadowsFromMatrix(Qr.tileModelMatrix,Ms,Te.useNormalOffset),re.uploadCommonUniforms(ye,Ms,null,Jo);const _s=Qo.pbrMetallicRoughness;_s.metallicFactor=.9,_s.roughnessFactor=.5;const ra=rr(new Float32Array(no),new Float32Array(Mn),new Float32Array(jr),new Float32Array(ai.matrix),re,Qr.opacity,_s.baseColorFactor.toRenderColor(null),Qo.emissiveFactor,_s.metallicFactor,_s.roughnessFactor,Qo,Ei,pe,[0,0,0],ta);!Ki&&(Ln.hasTranslucentParts||Qr.opacity<1)&&Ms.draw(re,ye.gl.TRIANGLES,ct,st.disabled,te.disabled,cr.backCCW,ra,pe.id,ln.vertexBuffer,ln.indexBuffer,ln.segments,pe.paint,re.transform.zoom,void 0,qn),Ms.draw(re,ye.gl.TRIANGLES,Ki?Rt:ct,st.disabled,Ki||Qr.opacity<1||Ln.hasTranslucentParts?te.alphaBlended:te.unblended,cr.backCCW,ra,pe.id,ln.vertexBuffer,ln.indexBuffer,ln.segments,pe.paint,re.transform.zoom,void 0,qn)}}}}()}(d,r,a,f),void M();if(B.type!=="model")return;const z=B.getModels(),V=[],U=d.transform.getFreeCameraOptions().position,q=s.a6.vec3.scale([],[U.x,U.y,U.z],d.transform.worldSize);s.a6.vec3.negate(q,q);const Y=[],J=[];let ee=0;for(const re of z){const he=a.paint.get("model-rotation").constantOr(null),pe=a.paint.get("model-scale").constantOr(null),ce=a.paint.get("model-translation").constantOr(null);re.computeModelMatrix(d,he,pe,ce,!0,!0,!1);const ye=s.a6.mat4.identity([]),ge=s.de(re.position.lat,d.transform.zoom),Ae=s.a6.mat4.fromScaling([],[1,1,1/ge]);s.a6.mat4.translate(ye,ye,q),V.push({zScaleMatrix:Ae,negCameraPosMatrix:ye});for(const Te of re.nodes)Ih(d.transform,Te,re.matrix,d.transform.expandedFarZProjMatrix,ee,Y,J);ee++}if(Y.sort((re,he)=>he.depth-re.depth),d.renderPass!=="shadow"){if(_===1)for(const re of J)Eh(re,d,a,V[re.modelIndex],st.disabled,d.colorModeForRenderPass());else{for(const re of J)Eh(re,d,a,V[re.modelIndex],st.disabled,te.disabled);for(const re of J)Eh(re,d,a,V[re.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const re of Y)Eh(re,d,a,V[re.modelIndex],st.disabled,d.colorModeForRenderPass());M()}else{for(const re of J)hu(re.mesh,re.nodeModelMatrix,d,a);for(const re of Y)hu(re.mesh,re.nodeModelMatrix,d,a);M()}}},qd={model:function(d,r,a){const f=r.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,f.type==="vector"?d.scope:""));if(f.type==="batched-model"||f.type!=="model")return;const _=f.getModels();for(const v of _)v.upload(a.context)},raster:function(d,r,a){const f=r.getSource();if(!(f instanceof pa&&f.loaded()))return;const _=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const v=d.paint.get("raster-array-band")||f.getInitialBand(_);if(v==null)return;const w=r.getIds().map(k=>r.getTileByID(k));for(const k of w)k.updateNeeded(_,v)&&f.prepareTile(k,_,v)},"raster-particle":function(d,r,a){const f=r.getSource();if(!(f instanceof pa&&f.loaded()))return;const _=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const v=d.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(v==null)return;const w=r.getIds().map(k=>r.getTileByID(k));for(const k of w)k.updateNeeded(_,v)&&f.prepareTile(k,_,v)}};class Dp{constructor(r,a,f,_){this.context=new Iv(r,a),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const v=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const k of v)this._debugParams.enabledLayers[k]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const k of v)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],k);this.occlusionParams=new $d(_),this.setup(),this.numSublayers=$i.maxUnderzooming+$i.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new uh(this),this._wireframeDebugCache=new ql,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const w=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,w,r.RGBA8),this._clippingActiveLastFrame=!1}updateTerrain(r,a){const f=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new _p(this,r));const _=this._terrain;this.transform.elevation=f?_:null,_.update(r,this.transform,a),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(r){const a=r.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,_]=a.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);const v=f+.78*(_-f);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new _p(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,a){if(this.width=r*s.q.devicePixelRatio,this.height=a*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const r=this.context,a=new s.a_;a.emplaceBack(0,0),a.emplaceBack(s.ab,0),a.emplaceBack(0,s.ab),a.emplaceBack(s.ab,s.ab),this.tileExtentBuffer=r.createVertexBuffer(a,s.b0.members),this.tileExtentSegments=s.b1.simpleSegment(0,0,4,2);const f=new s.a_;f.emplaceBack(0,0),f.emplaceBack(s.ab,0),f.emplaceBack(0,s.ab),f.emplaceBack(s.ab,s.ab),this.debugBuffer=r.createVertexBuffer(f,s.b0.members),this.debugSegments=s.b1.simpleSegment(0,0,4,5);const _=new s.a_;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,s.b0.members),this.viewportSegments=s.b1.simpleSegment(0,0,4,2);const v=new s.aN;v.emplaceBack(0,0,0,0),v.emplaceBack(s.ab,0,s.ab,0),v.emplaceBack(0,s.ab,0,s.ab),v.emplaceBack(s.ab,s.ab,s.ab,s.ab),this.mercatorBoundsBuffer=r.createVertexBuffer(v,s.b3.members),this.mercatorBoundsSegments=s.b1.simpleSegment(0,0,4,2);const w=new s.aO;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(w);const k=new s.a$;for(const B of[0,1,3,2,0])k.emplaceBack(B);this.debugIndexBuffer=r.createIndexBuffer(k),this.emptyTexture=new s.T(r,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=s.a6.mat4.create();const M=this.context.gl;this.stencilClearMode=new st({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,fe.disabled,this.stencilClearMode,te.disabled,cr.disabled,_h(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,a,f){if(!a||this.currentStencilSource===a.id||!r.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const M of f)if(this._tileClippingMaskIDs[M.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=a.id;const _=this.context,v=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(te.disabled),_.setDepthMode(fe.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of f){const M=a.getTile(k),B=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:V,tileBoundsSegments:U}=this.getTileBoundsBuffers(M);w.draw(this,v.TRIANGLES,fe.disabled,new st({func:v.ALWAYS,mask:0},B,255,v.KEEP,v.KEEP,v.REPLACE),te.disabled,cr.disabled,_h(k.projMatrix),"$clipping",z,V,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,a=this.context.gl;return new st({func:a.NOTEQUAL,mask:255},r,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const a=this.context.gl;return new st({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(r){const a=this.context.gl,f=r.sort((w,k)=>k.overscaledZ-w.overscaledZ),_=f[f.length-1].overscaledZ,v=f[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let k=0;k<v;k++)w[k+_]=new st({func:a.GEQUAL,mask:255},k+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[w,f]}return[{[_]:st.disabled},f]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new te([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new s.bz(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?te.unblended:te.alphaBlended}colorModeForDrapableLayerRenderPass(r){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new te([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new s.bz(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,a,f,_=!1){if(this.depthOcclusion)return new fe(this.context.gl.GREATER,fe.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return fe.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new fe(f||this.context.gl.LEQUAL,a,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,a=Math.ceil(this.width),f=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),v=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&f!==0&&(this.depthFBO=new Ld(this.context,a,f,!1,"texture"),this.depthTexture=new s.T(this.context,{width:a,height:f,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),r.bindTexture(r.TEXTURE_2D,v),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,a,f,0,0,a,f,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,a)=>r+a/this._fpsHistory.length,0))}render(r,a){const f=s.q.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=a;const _=this.style._mergedLayers,v=this.style.order.filter(ke=>{const Re=_[ke];return!(Re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Re.type]});let w=!1,k=!1;for(const ke of v){const Re=_[ke];Re.type==="circle"&&(w=!0),Re.type==="symbol"&&(Re.hasInitialOcclusionOpacityProperties?k=!0:w=!0)}const M=v.map(ke=>_[ke]),B=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let z=0,V=!1;for(const ke in B){const Re=B[ke];Re.used&&(Re.prepare(this.context),Re.getSource().usedInConflation&&++z)}let U=!1;for(const ke of M)ke.isHidden(this.transform.zoom)||(ke.type==="clip"&&(U=!0),this.prepareLayer(ke));const q={},Y={},J={},ee={},re={};for(const ke in B){const Re=B[ke];q[ke]=Re.getVisibleCoordinates(),Y[ke]=q[ke].slice().reverse(),J[ke]=Re.getVisibleCoordinates(!0).reverse(),ee[ke]=Re.getShadowCasterCoordinates(),re[ke]=Re.sortCoordinatesByDistance(q[ke])}const he=ke=>{const Re=this.style.getLayerSourceCache(ke);return Re&&Re.used?Re.getSource():null};if(z||U||this._clippingActiveLastFrame){const ke=[],Re=[];let Xe=0;for(const ht of M)this.isSourceForClippingOrConflation(ht,he(ht))&&(ke.push(ht),Re.push(Xe)),Xe++;if(ke&&(U||ke.length>1)||this._clippingActiveLastFrame){U=!1;const ht=[];for(let bt=0;bt<ke.length;bt++){const ct=ke[bt],Rt=Re[bt],Ke=this.style.getLayerSourceCache(ct);if(!Ke||!Ke.used||!Ke.getSource().usedInConflation&&ct.type!=="clip")continue;let gt=s.dn,pt=s.bs.None;const Pt=[];let Lt=!0;if(ct.type==="clip"){gt=Rt;for(const yt of ct.layout.get("clip-layer-types"))pt|=yt==="model"?s.bs.Model:yt==="symbol"?s.bs.Symbol:s.bs.FillExtrusion;for(const yt of ct.layout.get("clip-layer-scope"))Pt.push(yt);ct.isHidden(this.transform.zoom)?Lt=!1:U=!0}Lt&&ht.push({layer:ct.fqid,cache:Ke,order:gt,clipMask:pt,clipScope:Pt})}this.replacementSource.setSources(ht),V=!0}}this._clippingActiveLastFrame=U,V||this.replacementSource.clear(),this.conflationActive=V,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ke=0;ke<M.length;ke++){const Re=M[ke],Xe=Re.cutoffRange();if(this.longestCutoffRange=Math.max(Xe,this.longestCutoffRange),Xe>0){const ht=he(Re);ht&&(this.minCutoffZoom=Math.max(ht.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}Re.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ke),this._lastOcclusionLayer=ke)}const pe=this.style&&this.style.fog;pe?(this._fogVisible=pe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=pe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(J),this.opaquePassCutoff=0);const ce=this._shadowRenderer;if(ce){ce.updateShadowParameters(this.transform,this.style.directionalLight);for(const ke in B)for(const Re of q[ke]){let Xe={min:0,max:0};this.terrain&&(Xe=this.terrain.getMinMaxForTile(Re)||Xe),ce.addShadowReceiver(Re.toUnwrapped(),Xe.min,Xe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Vd(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!un.has(this.context.gl))return;this.renderPass="offscreen";for(const ke of M){const Re=r.getLayerSourceCache(ke);if(!ke.hasOffscreenPass()||ke.isHidden(this.transform.zoom))continue;const Xe=Re?Y[Re.id]:void 0;(ke.type==="custom"||ke.type==="raster"||ke.type==="raster-particle"||ke.isSky()||Xe&&Xe.length)&&this.renderLayer(this,Re,ke,Xe)}this.depthRangeFor3D=[0,1-(M.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ee)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ye=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ge=(()=>{if(a.showOverdrawInspector)return s.bz.black;const ke=this.style.fog;if(ke&&this.transform.projection.supportsFog){const Re=this.style.getLut(ke.scope);if(!ye){const Xe=ke.properties.get("color").toRenderColor(Re).toArray01();return new s.bz(...Xe)}if(ye){const Xe=ke.properties.get("space-color").toRenderColor(Re).toArray01();return new s.bz(...Xe)}}return s.bz.transparent})();if(this.context.clear({color:ge,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ye&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const ke=M[this.currentLayer],Re=r.getLayerSourceCache(ke);if(ke.isSky())continue;const Xe=Re?(ke.is3D()?re:Y)[Re.id]:void 0;this._renderTileClippingMasks(ke,Re,Xe),this.renderLayer(this,Re,ke,Xe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ye&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const ke=M[this.currentLayer],Re=r.getLayerSourceCache(ke);ke.isSky()&&this.renderLayer(this,Re,ke,Re?Y[Re.id]:void 0)}function Ae(ke,Re){let Xe;return Re&&(Xe=(ke.type==="symbol"?J:ke.is3D()?re:Y)[Re.id]),Xe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){const ke=M[this.currentLayer];if(ke.type==="raster"||ke.type==="raster-particle"){const Re=r.getLayerSourceCache(ke);this.renderLayer(this,Re,ke,Ae(ke,Re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Te=0;ce&&(Te=ce.getShadowCastingLayerCount());let Se=!1,Oe=-1;for(let ke=0;ke<v.length;++ke){const Re=M[ke];Re.isHidden(this.transform.zoom)||Re.is3D()&&(Oe=ke)}for(k&&Oe===-1&&(w=!0);this.currentLayer<v.length;){const ke=M[this.currentLayer],Re=r.getLayerSourceCache(ke);if(ke.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ke)){if(ke.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(w&&!Se&&this.terrain&&!this.transform.isOrthographic&&(Se=!0,this.blitDepth()),k&&Oe!==-1&&this.currentLayer===Oe+1&&!this.transform.isOrthographic&&this.blitDepth(),ke.is3D()||this.terrain||this._renderTileClippingMasks(ke,Re,Re?q[Re.id]:void 0),this.renderLayer(this,Re,ke,Ae(ke,Re)),!this.terrain&&ce&&Te>0&&ke.hasShadowPass()&&--Te==0&&(ce.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Xe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Xe;this.currentLayer++){const ht=M[this.currentLayer];if(!ht.hasLightBeamPass())continue;const bt=r.getLayerSourceCache(ht);this.renderLayer(this,bt,ht,bt?Y[bt.id]:void 0)}this.currentLayer=Xe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Xe=this.currentLayer;this.depthOcclusion=!0;for(const ht of this.layersWithOcclusionOpacity){this.currentLayer=ht;const bt=M[this.currentLayer],ct=r.getLayerSourceCache(bt),Rt=ct?Y[ct.id]:void 0;bt.is3D()||this.terrain||this._renderTileClippingMasks(bt,ct,ct?q[ct.id]:void 0),this.renderLayer(this,ct,bt,Rt)}this.depthOcclusion=!1,this.currentLayer=Xe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ke=null;M.forEach(Re=>{const Xe=r.getLayerSourceCache(Re);Xe&&!Re.isHidden(this.transform.zoom)&&Xe.getVisibleCoordinates().length&&(!ke||ke.getSource().maxzoom<Xe.getSource().maxzoom)&&(ke=Xe)}),ke&&this.options.showTileBoundaries&&Gl.debug(this,ke,ke.getVisibleCoordinates(),s.bz.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Gl.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.bz(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ke){const Re=ke.transform.padding;si(ke,ke.transform.height-(Re.top||0),3,Cv),si(ke,Re.bottom||0,3,lu),tt(ke,Re.left||0,3,cu),tt(ke,ke.transform.width-(Re.right||0),3,Ot);const Xe=ke.transform.centerPoint;(function(ht,bt,ct,Rt){Th(ht,bt-1,ct-10,2,20,Rt),Th(ht,bt-10,ct-1,20,2,Rt)})(ke,Xe.x,ke.transform.height-Xe.y,pr)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),V||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:a}=this.transform.projection,f=!a||!a.includes(r.type);if(qd[r.type]&&(f||this.terrain&&r.type==="custom")){const _=this.style.getLayerSourceCache(r);qd[r.type](r,_,this)}this.gpuTimingEnd()}renderLayer(r,a,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(f.type)&&(!r.terrain||f.type!=="custom")||f.type==="clip"||Gl[f.type](r,a,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,f=this.context.gl;let _=this.gpuTimers[r.id];_||(_=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(a.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,a=this.context.gl,f=a.createQuery();this.deferredRenderGpuTimeQueries.push(f),a.beginQuery(r.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const a={};for(const f in r){const _=r[f],v=this.context.extTimerQuery,w=v.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(_.query),a[f]=w}return a}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery,f=this.context.gl;let _=0;for(const v of r)_+=a.getQueryParameter(v,f.QUERY_RESULT)/1e6,a.deleteQueryEXT(v);return _}translatePosMatrix(r,a,f,_,v){if(!f[0]&&!f[1])return r;const w=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const B=Math.sin(w),z=Math.cos(w);f=[f[0]*z-f[1]*B,f[0]*B+f[1]*z]}const k=[v?f[0]:s.ak(a,f[0],this.transform.zoom),v?f[1]:s.ak(a,f[1],this.transform.zoom),0],M=new Float32Array(16);return s.a6.mat4.translate(M,r,k),M}saveTileTexture(r){const a=r.size[0],f=this._tileTextures[a];f?f.push(r):this._tileTextures[a]=[r]}getTileTexture(r){const a=this._tileTextures[r];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,a,f){const _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,v=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||v.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?v.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):v.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||_||a!==void 0&&!a||v.push("FOG","FOG_DITHERING"),_&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(r,a){this.cache=this.cache||{};const f=a&&a.defines||[],_=a&&a.config,v=this.currentGlobalDefines(r,a&&a.overrideFog,a&&a.overrideRtt).concat(f),w=jl.cacheKey(et[r],r,v,_);return this.cache[w]||(this.cache[w]=new jl(this.context,r,et[r],_,u_[r],v)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,a){if(this.style.enable3dLights()){const f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){const v=((w,k,M)=>{const B=w.properties.get("direction"),z=w.properties.get("color").toRenderColor(M.getLut(w.scope)).toArray01(),V=w.properties.get("intensity"),U=k.properties.get("color").toRenderColor(M.getLut(k.scope)).toArray01(),q=k.properties.get("intensity"),Y=[B.x,B.y,B.z],J=s.cH(U,q),ee=s.cH(z,V);return{u_lighting_ambient_color:J,u_lighting_directional_dir:Y,u_lighting_directional_color:ee,u_ground_radiance:yp(Y,ee,J)}})(f,_,this.style);a.setLightsUniformValues(r,v)}}}uploadCommonUniforms(r,a,f,_,v){if(this.uploadCommonLightUniforms(r,a),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const k=w.getOpacity(this.transform.pitch),M=((B,z,V,U,q,Y,J,ee,re,he,pe,ce)=>{const ye=B.transform,ge=z.properties.get("color").toRenderColor(B.style.getLut(z.scope)).toArray01();ge[3]=U;const Ae=B.frameCounter/1e3%1,[Te,Se]=z.properties.get("vertical-range");return{u_fog_matrix:V?ye.calculateFogTileMatrix(V):ce||B.identityMat,u_fog_range:z.getFovAdjustedRange(ye._fov),u_fog_color:ge,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Te,Se),Se],u_fog_temporal_offset:Ae,u_frustum_tl:q,u_frustum_tr:Y,u_frustum_br:J,u_frustum_bl:ee,u_globe_pos:re,u_globe_radius:he,u_viewport:pe,u_globe_transition:s.a9(ye.zoom),u_is_globe:+(ye.projection.name==="globe")}})(this,w,f,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],_);a.setFogUniformValues(r,M)}v&&a.setCutoffUniformValues(r,v.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,a=r.createTexture();return r.bindTexture(r.TEXTURE_2D,a),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,a=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const _ of f)a[_.key]=r[_.key]||new jo(_,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,a){return!(!r.is3D()||r.type!=="clip"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[r.key];return a||(this._cachedTileFogOpacities[r.key]=a=this.style.fog.getOpacityForTile(r)),a[0]>=Gt||a[1]>=Gt}setupDepthForOcclusion(r,a,f){const _=this.context,v=_.gl,w=!!f;var k;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(v.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((k=this.depthRangeFor3D)[1]-k[0]),-1-2*k[0]/(k[1]-k[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),_.activeTexture.set(v.TEXTURE0),w||a.setTerrainUniformValues(_,f)}}function hl(d,r){let a=!1,f=null;const _=()=>{f=null,a&&(d(),f=setTimeout(_,r),a=!1)};return()=>(a=!0,f||_(),f)}class Hl{constructor(r){this._hashName=r&&encodeURIComponent(r),s.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=hl(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const a=dl(r);if(this._hashName){const f=this._hashName;let _=!1;const v=location.hash.slice(1).split("&").map(w=>{const k=w.split("=")[0];return k===f?(_=!0,`${k}=${a}`):w}).filter(w=>w);return _||v.push(`${f}=${a}`),`#${v.join("&")}`}return`#${a}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let a;return r.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(a=f)}),(a&&a[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(f=>isNaN(f))){const f=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(a[3]||0):r.getBearing();return r.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:f,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function dl(d,r){const a=d.getCenter(),f=Math.round(100*d.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),w=Math.round(a.lng*v)/v,k=Math.round(a.lat*v)/v,M=d.getBearing(),B=d.getPitch();let z=r?`/${w}/${k}/${f}`:`${f}/${k}/${w}`;return(M||B)&&(z+="/"+Math.round(10*M)/10),B&&(z+=`/${Math.round(B)}`),z}const wc={linearity:.3,easing:s.dp(0,0,.3,1)},Gd=s.l({deceleration:2500,maxSpeed:1400},wc),Lp=s.l({deceleration:20,maxSpeed:1400},wc),Op=s.l({deceleration:1e3,maxSpeed:360},wc),Bp=s.l({deceleration:1e3,maxSpeed:90},wc);class Wl{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,a=s.q.now();for(;r.length>0&&a-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(a.pan.mag()){const v=Tc(a.pan.mag(),f,s.l({},Gd,r||{}));_.offset=a.pan.mult(v.amount/a.pan.mag()),_.center=this._map.transform.center,du(_,v)}if(a.zoom){const v=Tc(a.zoom,f,Lp);_.zoom=this._map.transform.zoom+v.amount,du(_,v)}if(a.bearing){const v=Tc(a.bearing,f,Op);_.bearing=this._map.transform.bearing+s.ap(v.amount,-179,179),du(_,v)}if(a.pitch){const v=Tc(a.pitch,f,Bp);_.pitch=this._map.transform.pitch+v.amount,du(_,v)}if(_.zoom||_.bearing){const v=a.pinchAround===void 0?a.around:a.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function du(d,r){(!d.duration||d.duration<r.duration)&&(d.duration=r.duration,d.easing=r.easing)}function Tc(d,r,a){const{maxSpeed:f,linearity:_,deceleration:v}=a,w=s.ap(d*_/(r/1e3),-f,f),k=Math.abs(w)/(v*_);return{easing:a.easing,duration:1e3*k,amount:w*(k/2)}}class Yo extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a,f,_={}){const v=Fe(a.getCanvasContainer(),f),w=a.unproject(v);super(r,s.l({point:v,lngLat:w,originalEvent:f},_)),this._defaultPrevented=!1,this.target=a}}class fu extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a,f){const _=r==="touchend"?f.changedTouches:f.touches,v=Je(a.getCanvasContainer(),_),w=v.map(M=>a.unproject(M)),k=v.reduce((M,B,z,V)=>M.add(B.div(V.length)),new s.P(0,0));super(r,{points:v,point:k,lngLats:w,lngLat:a.unproject(k),originalEvent:f}),this._defaultPrevented=!1}}class po extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class zp{constructor(r,a){this._map=r,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new po(this._map,r))}mousedown(r,a){return this._mousedownPos=a,this._firePreventable(new Yo(r.type,this._map,r))}mouseup(r){this._map.fire(new Yo(r.type,this._map,r))}preclick(r){const a=s.l({},r);a.type="preclick",this._map.fire(new Yo(a.type,this._map,a))}click(r,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Yo(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Yo(r.type,this._map,r))}mouseover(r){this._map.fire(new Yo(r.type,this._map,r))}mouseout(r){this._map.fire(new Yo(r.type,this._map,r))}touchstart(r){return this._firePreventable(new fu(r.type,this._map,r))}touchmove(r){this._map.fire(new fu(r.type,this._map,r))}touchend(r){this._map.fire(new fu(r.type,this._map,r))}touchcancel(r){this._map.fire(new fu(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fp{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Yo(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Yo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Yo(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pu{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,a){this.isEnabled()&&r.shiftKey&&r.button===0&&(Ct(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(r,a){if(!this._active)return;const f=a,_=this._startPos,v=this._lastPos;if(!_||!v||v.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=Ne("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const w=Math.min(_.x,f.x),k=Math.max(_.x,f.x),M=Math.min(_.y,f.y),B=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${M}px)`,this._box.style.width=k-w+"px",this._box.style.height=B-M+"px")})}mouseupWindow(r,a){if(!this._active)return;const f=this._startPos,_=a;if(f&&r.button===0){if(this.reset(),be(),f.x!==_.x||f.y!==_.y)return this._map.fire(new s.x("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),qt(),delete this._startPos,delete this._lastPos}_fireEvent(r,a){return this._map.fire(new s.x(r,{originalEvent:a}))}}function fl(d,r){const a={};for(let f=0;f<d.length;f++)a[d[f].identifier]=r[f];return a}class Np{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,a,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const v=new s.P(0,0);for(const w of _)v._add(w);return v.div(_.length)}(a),this.touches=fl(f,a)))}touchmove(r,a,f){if(this.aborted||!this.centroid)return;const _=fl(f,a);for(const v in this.touches){const w=_[v];(!w||w.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(r,a,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Sh{constructor(r){this.singleTap=new Np(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,a,f){this.singleTap.touchstart(r,a,f)}touchmove(r,a,f){this.singleTap.touchmove(r,a,f)}touchend(r,a,f){const _=this.singleTap.touchend(r,a,f);if(_){const v=r.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(v&&w||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Vp{constructor(){this._zoomIn=new Sh({numTouches:1,numTaps:2}),this._zoomOut=new Sh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,a,f){this._zoomIn.touchstart(r,a,f),this._zoomOut.touchstart(r,a,f)}touchmove(r,a,f){this._zoomIn.touchmove(r,a,f),this._zoomOut.touchmove(r,a,f)}touchend(r,a,f){const _=this._zoomIn.touchend(r,a,f),v=this._zoomOut.touchend(r,a,f);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ch={0:1,2:2};class Rh{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,a){return!1}_move(r,a){return{}}mousedown(r,a){if(this._lastPoint)return;const f=Me(r);this._correctButton(r,f)&&(this._lastPoint=a,this._eventButton=f)}mousemoveWindow(r,a){const f=this._lastPoint;if(f){if(r.preventDefault(),this._eventButton!=null&&function(_,v){const w=Ch[v];return _.buttons===void 0||(_.buttons&w)!==w}(r,this._eventButton))this.reset();else if(this._moved||!(a.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(f,a)}}mouseupWindow(r){this._lastPoint&&Me(r)===this._eventButton&&(this._moved&&be(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hd extends Rh{mousedown(r,a){super.mousedown(r,a),this._lastPoint&&(this._active=!0)}_correctButton(r,a){return a===0&&!r.ctrlKey}_move(r,a){return{around:a,panDelta:a.sub(r)}}}class Wd extends Rh{_correctButton(r,a){return a===0&&r.ctrlKey||a===2}_move(r,a){const f=.8*(a.x-r.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(r){r.preventDefault()}}class Zd extends Rh{_correctButton(r,a){return a===0&&r.ctrlKey||a===2}_move(r,a){const f=-.5*(a.y-r.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(r){r.preventDefault()}}class y_{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(r,a,f){return this._calculateTransform(r,a,f)}touchmove(r,a,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!s.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,a,f)}}touchend(r,a,f){this._calculateTransform(r,a,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,a,f){f.length>0&&(this._active=!0);const _=fl(f,a),v=new s.P(0,0),w=new s.P(0,0);let k=0;for(const B in _){const z=_[B],V=this._touches[B];V&&(v._add(z),w._add(z.sub(V)),k++,_[B]=z)}if(this._touches=_,k<this._minTouches||!w.mag())return;const M=w.div(k);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(k),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ne("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Xd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,a,f){return{}}touchstart(r,a,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([a[0],a[1]]))}touchmove(r,a,f){const _=this._firstTwoTouches;if(!_)return;r.preventDefault();const[v,w]=_,k=kh(f,a,v),M=kh(f,a,w);if(!k||!M)return;const B=this._aroundCenter?null:k.add(M).div(2);return this._move([k,M],B,r)}touchend(r,a,f){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,w=kh(f,a,_),k=kh(f,a,v);w&&k||(this._active&&be(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function kh(d,r,a){for(let f=0;f<d.length;f++)if(d[f].identifier===a)return r[f]}function Up(d,r){return Math.log(d/r)/Math.LN2}class v_ extends Xd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,a){const f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Up(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Up(this._distance,f),pinchAround:a}}}function jp(d,r){return 180*d.angleWith(r)/Math.PI}class b_ extends Xd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,a){const f=this._vector;if(this._vector=r[0].sub(r[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:jp(this._vector,f),pinchAround:a}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const a=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const _=jp(r,f);return Math.abs(_)<a}}function Kd(d){return Math.abs(d.y)>Math.abs(d.x)}class x_ extends Xd{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Kd(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,a,f){const _=this._lastPoints;if(!_)return;const v=r[0].sub(_[0]),w=r[1].sub(_[1]);return this._map._cooperativeGestures&&!s.dq()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(v,w,f.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+w.y)/2*-.5})}gestureBeginsVertically(r,a,f){if(this._valid!==void 0)return this._valid;const _=r.mag()>=2,v=a.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const w=r.y>0==a.y>0;return Kd(r)&&Kd(a)&&w}}const w_={panStep:100,bearingStep:15,pitchStep:10};class T_{constructor(){const r=w_;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let a=0,f=0,_=0,v=0,w=0;switch(r.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),w=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:k=>{const M=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:E_,zoom:a?Math.round(M)+a*(r.shiftKey?2:1):M,bearing:k.getBearing()+f*this._bearingStep,pitch:k.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:k.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function E_(d){return d*(2-d)}const $p=4.000244140625,Dv=1/450;class Lv{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Dv,s.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||s.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const f=s.q.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,a!==0&&a%$p==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),r.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=r,this._delta-=a,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Fe(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>$p?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&z!==0&&(z=1/z);const V=a(),U=Math.pow(2,V),q=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(q*z))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:a(),_=this._startZoom,v=this._easing;let w,k=!1;if(this._type==="wheel"&&_&&v){const B=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),z=v(B);w=s.aa(_,f,z),B<1?this._frameId||(this._frameId=!0):k=!0}else w=f,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=w-a();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let a=s.dr;if(this._prevEase){const f=this._prevEase,_=(s.q.now()-f.start)/f.duration,v=f.easing(_+.01)-f.easing(_),w=.27/Math.sqrt(v*v+1e-4)*.01,k=Math.sqrt(.0729-w*w);a=s.dp(w,k,.25,1)}return this._prevEase={start:s.q.now(),duration:r,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ne("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ti{constructor(r,a){this._clickZoom=r,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class I_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,a){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(r.shiftKey?-1:1),around:f.unproject(a)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ov{constructor(){this._tap=new Sh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,a,f){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=a[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(r,a,f))}touchmove(r,a,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=a[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,a,f)}touchend(r,a,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(r,a,f)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bv{constructor(r,a,f){this._el=r,this._mousePan=a,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ph{constructor(r,a,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=a,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class A_{constructor(r,a,f,_){this._el=r,this._touchZoom=a,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const mu=d=>d.zoom||d.drag||d.pitch||d.rotate;class Yd extends s.x{}class pl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,a){const f=s.a6.vec3.sub([],a,r);this.radius=s.a6.vec3.length(f[2]<0?s.a6.vec3.div([],f,this.constants):[f[0],f[1],0])}projectRay(r){s.a6.vec3.div(r,r,this.constants),s.a6.vec3.normalize(r,r),s.a6.vec3.mul(r,r,this.constants);const a=s.a6.vec3.scale([],r,this.radius);if(a[2]>0){const f=s.a6.vec3.scale([],[0,0,1],s.a6.vec3.dot(a,[0,0,1])),_=s.a6.vec3.scale([],s.a6.vec3.normalize([],[a[0],a[1],0]),this.radius),v=s.a6.vec3.add([],a,s.a6.vec3.scale([],s.a6.vec3.sub([],s.a6.vec3.add([],_,f),a),2));a[0]=v[0],a[1]=v[1]}return a}}function Ec(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Fo{constructor(r,a){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wl(r),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new pl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.aJ(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,v,w]of this._listeners){const k=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(v,k,w)}}destroy(){for(const[r,a,f]of this._listeners){const _=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(a,_,f)}}_addDefaultHandlers(r){const a=this._map,f=a.getCanvasContainer();this._add("mapEvent",new zp(a,r));const _=a.boxZoom=new pu(a,r);this._add("boxZoom",_);const v=new Vp,w=new I_;a.doubleClickZoom=new Ti(w,v),this._add("tapZoom",v),this._add("clickZoom",w);const k=new Ov;this._add("tapDragZoom",k);const M=a.touchPitch=new x_(a);this._add("touchPitch",M);const B=new Wd(r),z=new Zd(r);a.dragRotate=new Ph(r,B,z),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const V=new Hd(r),U=new y_(a,r);a.dragPan=new Bv(f,V,U),this._add("mousePan",V),this._add("touchPan",U,["touchZoom","touchRotate"]);const q=new b_,Y=new v_;a.touchZoomRotate=new A_(f,Y,q,k),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fp(a));const J=a.scrollZoom=new Lv(a,this);this._add("scrollZoom",J,["mousePan"]);const ee=a.keyboard=new T_;this._add("keyboard",ee);for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[re]&&a[re].enable(r[re])}_add(r,a,f){this._handlers.push({handlerName:r,handler:a,allowed:f}),this._handlersById[r]=a}stop(r){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!mu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,a,f){for(const _ in r)if(_!==f&&(!a||a.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const a=[];for(const f of r)this._el.contains(f.target)&&a.push(f);return a}handleEvent(r,a){this._updatingCamera=!0;const f=r.type==="renderFrame",_=f?void 0:r,v={needsRenderFrame:!1},w={},k={},M=r.touches?this._getMapTouches(r.touches):void 0,B=M?Je(this._el,M):f?void 0:Fe(this._el,r);for(const{handlerName:U,handler:q,allowed:Y}of this._handlers){if(!q.isEnabled())continue;let J;this._blockedByActive(k,Y,U)?q.reset():q[a||r.type]&&(J=q[a||r.type](r,B,M),this.mergeHandlerResult(v,w,J,U,_),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||q.isActive())&&(k[U]=q)}const z={};for(const U in this._previousActiveHandlers)k[U]||(z[U]=_);this._previousActiveHandlers=k,(Object.keys(z).length||Ec(v))&&(this._changes.push([v,w,z]),this._triggerRenderFrame()),(Object.keys(k).length||Ec(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=v;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(r,a,f,_,v){if(!f)return;s.l(r,f);const w={handlerName:_,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(a.zoom=w),f.panDelta!==void 0&&(a.drag=w),f.pitchDelta!==void 0&&(a.pitch=w),f.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const r={},a={},f={};for(const[_,v,w]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new s.P(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.aroundCoord!==void 0&&(r.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),s.l(a,v),s.l(f,w);this._updateMapTransform(r,a,f),this._changes=[]}_updateMapTransform(r,a,f){const _=this._map,v=_.transform,w=he=>[he.x,he.y,he.z];if((he=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!Ec(r)){const he=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),he!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&_._stop(!0),!Ec(r))return void this._fireEvents(a,f,!0);let{panDelta:k,zoomDelta:M,bearingDelta:B,pitchDelta:z,around:V,aroundCoord:U,pinchAround:q}=r;v._isCameraConstrained&&(M>0&&(M=0),v._isCameraConstrained=!1),q!==void 0&&(V=q),(M||(he=>a[he]&&!this._eventsInProgress[he])("drag"))&&V&&(this._dragOrigin=w(v.pointCoordinate3D(V)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),V=V||_.transform.centerPoint,B&&(v.bearing+=B),z&&(v.pitch+=z),v._updateCameraState();const Y=[0,0,0];if(k)if(v.projection.name==="mercator"){const he=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(V).dir),pe=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(V.sub(k)).dir);Y[0]=pe[0]-he[0],Y[1]=pe[1]-he[1]}else{const he=v.pointCoordinate(V);if(v.projection.name==="globe"){k=k.rotate(-v.angle);const pe=v._pixelsPerMercatorPixel/v.worldSize;Y[0]=-k.x*s.ds(s.aM(he.y))*pe,Y[1]=-k.y*s.ds(v.center.lat)*pe}else{const pe=v.pointCoordinate(V.sub(k));he&&pe&&(Y[0]=pe.x-he.x,Y[1]=pe.y-he.y)}}const J=v.zoom,ee=[0,0,0];if(M){const he=w(U||v.pointCoordinate3D(V)),pe={dir:s.a6.vec3.normalize([],s.a6.vec3.sub([],he,v._camera.position))};if(pe.dir[2]<0){const ce=v.zoomDeltaToMovement(he,M);s.a6.vec3.scale(ee,pe.dir,ce)}}const re=s.a6.vec3.add(Y,Y,ee);v._translateCameraConstrained(re),M&&Math.abs(v.zoom-J)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(a,f,!0)}_fireEvents(r,a,f){const _=mu(this._eventsInProgress),v=mu(r),w={};for(const z in r){const{originalEvent:V}=r[z];this._eventsInProgress[z]||(w[`${z}start`]=V),this._eventsInProgress[z]=r[z]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const z in w)this._fireEvent(z,w[z]);v&&this._fireEvent("move",v.originalEvent);for(const z in r){const{originalEvent:V}=r[z];this._fireEvent(z,V)}const k={};let M;for(const z in this._eventsInProgress){const{handlerName:V,originalEvent:U}=this._eventsInProgress[z];this._handlersById[V].isActive()||(delete this._eventsInProgress[z],M=a[V]||U,k[`${z}end`]=M)}for(const z in k)this._fireEvent(z,k[z]);const B=mu(this._eventsInProgress);if(f&&(_||v)&&!B){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;z?(V(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:M})):(this._map.fire(new s.x("moveend",{originalEvent:M})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,a){this._map.fire(new s.x(r,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Yd("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ka="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qp extends s.E{constructor(r,a){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,s.aJ(["_renderFrameCallback"],this)}getCenter(){return new s.bK(this.transform.center.lng,this.transform.center.lat)}setCenter(r,a){return this.jumpTo({center:r},a)}panBy(r,a,f){return r=s.P.convert(r).mult(-1),this.panTo(this.transform.center,s.l({offset:r},a),f)}panTo(r,a,f){return this.easeTo(s.l({center:r},a),f)}getZoom(){return this.transform.zoom}setZoom(r,a){return this.jumpTo({zoom:r},a),this}zoomTo(r,a,f){return this.easeTo(s.l({zoom:r},a),f)}zoomIn(r,a){return this.zoomTo(this.getZoom()+1,r,a),this}zoomOut(r,a){return this.zoomTo(this.getZoom()-1,r,a),this}getBearing(){return this.transform.bearing}setBearing(r,a){return this.jumpTo({bearing:r},a),this}getPadding(){return this.transform.padding}setPadding(r,a){return this.jumpTo({padding:r},a),this}rotateTo(r,a,f){return this.easeTo(s.l({bearing:r},a),f)}resetNorth(r,a){return this.rotateTo(0,s.l({duration:1e3},r),a),this}resetNorthPitch(r,a){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},r),a),this}snapToNorth(r,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,a):this}getPitch(){return this.transform.pitch}setPitch(r,a){return this.jumpTo({pitch:r},a),this}cameraForBounds(r,a){r=s.as.convert(r);const f=a&&a.bearing||0,_=a&&a.pitch||0,v=r.getNorthWest(),w=r.getSouthEast();return this._cameraForBounds(this.transform,v,w,f,_,a)}_extendPadding(r){const a={top:0,right:0,bottom:0,left:0};return r==null?s.l({},a,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:s.l({},a,r)}_extendCameraOptions(r){return(r=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,a){const f=a.max[0]-a.min[0],_=a.max[1]-a.min[1];return f/_>r.aspect?f/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,a,f,_,v,w){const k=r.clone(),M=this._extendCameraOptions(w);k.bearing=_,k.pitch=v;const B=s.bK.convert(a),z=s.bK.convert(f),V=.5*(B.lat+z.lat),U=.5*(B.lng+z.lng),q=s.dt(V,U),Y=s.a6.vec3.normalize([],q),J=s.a6.vec3.normalize([],s.a6.vec3.cross([],Y,[0,1,0])),ee=s.a6.vec3.cross([],J,Y),re=[J[0],J[1],J[2],0,ee[0],ee[1],ee[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],he=[q,s.dt(B.lat,B.lng),s.dt(z.lat,B.lng),s.dt(z.lat,z.lng),s.dt(B.lat,z.lng),s.dt(V,B.lng),s.dt(V,z.lng),s.dt(B.lat,U),s.dt(z.lat,U)];let pe=s.c9.fromPoints(he.map(pt=>[s.a6.vec3.dot(J,pt),s.a6.vec3.dot(ee,pt),s.a6.vec3.dot(Y,pt)]));const ce=s.a6.vec3.transformMat4([],pe.center,re);s.a6.vec3.squaredLength(ce)===0&&s.a6.vec3.set(ce,0,0,1),s.a6.vec3.normalize(ce,ce),s.a6.vec3.scale(ce,ce,s.aq),k.center=s.du(ce);const ye=k.getWorldToCameraMatrix(),ge=s.a6.mat4.invert(new Float64Array(16),ye);pe=s.c9.applyTransform(pe,s.a6.mat4.multiply([],ye,re));const Ae=this._extendAABB(pe,k,M,_);if(!Ae)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=Ae,s.a6.vec3.transformMat4(ce,ce,ye);const Te=.5*(pe.max[2]-pe.min[2]),Se=this._minimumAABBFrustumDistance(k,pe),Oe=s.a6.vec3.scale([],[0,0,1],Te),ke=s.a6.vec3.add(Oe,ce,Oe),Re=Se+(k.pitch===0?0:s.a6.vec3.distance(ce,ke)),Xe=k.globeCenterInViewSpace,ht=s.a6.vec3.sub([],ce,[Xe[0],Xe[1],Xe[2]]);s.a6.vec3.normalize(ht,ht),s.a6.vec3.scale(ht,ht,Re);const bt=s.a6.vec3.add([],ce,ht);s.a6.vec3.transformMat4(bt,bt,ge);const ct=s.dw/s.aq,Rt=s.a6.vec3.length(bt),Ke=s.bD(Math.max(Rt*ct-s.dw,Number.EPSILON),0),gt=Math.min(k.zoomFromMercatorZAdjusted(Ke),M.maxZoom);return gt>.5*(s.c2+s.bU)?(k.setProjection({name:"mercator"}),k.zoom=gt,this._cameraForBounds(k,a,f,_,v,w)):{center:k.center,zoom:gt,bearing:_,pitch:v}}_extendAABB(r,a,f,_){const v=.5*((f.padding.left||0)+(f.padding.right||0)),w=.5*((f.padding.top||0)+(f.padding.bottom||0)),k=w,M=v,B=v,z=w,V=a.width-(M+B),U=a.height-(k+z),q=s.a6.vec3.sub([],r.max,r.min),Y=Math.min(V/q[0],U/q[1]),J=Math.min(a.scaleZoom(a.scale*Y),f.maxZoom);if(isNaN(J))return null;const ee=a.scale/a.zoomScale(J),re=new s.c9([r.min[0]-M*ee,r.min[1]-z*ee,r.min[2]],[r.max[0]+B*ee,r.max[1]+k*ee,r.max[2]]),he=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new s.P(f.offset.x,f.offset.y):s.P.convert(f.offset)).rotate(-s.bB(_));return re.center[0]-=he.x*ee,re.center[1]+=he.y*ee,re}queryTerrainElevation(r,a){const f=this.transform.elevation;return f?(a=s.l({},{exaggerated:!0},a),f.getAtPoint(s.a5.fromLngLat(r),null,a.exaggerated)):null}_cameraForBounds(r,a,f,_,v,w){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,a,f,_,v,w);const k=r.clone(),M=this._extendCameraOptions(w);k.bearing=_,k.pitch=v;const B=s.bK.convert(a),z=s.bK.convert(f),V=new s.bK(B.lng,z.lat),U=new s.bK(z.lng,B.lat),q=k.project(B),Y=k.project(z),J=this.queryTerrainElevation(B),ee=this.queryTerrainElevation(z),re=this.queryTerrainElevation(V),he=this.queryTerrainElevation(U),pe=[[q.x,q.y,Math.min(J||0,ee||0,re||0,he||0)],[Y.x,Y.y,Math.max(J||0,ee||0,re||0,he||0)]];let ce=s.c9.fromPoints(pe);const ye=k.getWorldToCameraMatrix(),ge=s.a6.mat4.invert(new Float64Array(16),ye);ce=s.c9.applyTransform(ce,ye);const Ae=this._extendAABB(ce,k,M,_);if(!Ae)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=Ae;const Te=.5*s.a6.vec3.sub([],ce.max,ce.min)[2],Se=this._minimumAABBFrustumDistance(k,ce),Oe=[0,0,1,0];s.a6.vec4.transformMat4(Oe,Oe,ye),s.a6.vec4.normalize(Oe,Oe);const ke=s.a6.vec3.scale([],Oe,Se+Te),Re=s.a6.vec3.add([],ce.center,ke);s.a6.vec3.transformMat4(ce.center,ce.center,ge),s.a6.vec3.transformMat4(Re,Re,ge);const Xe=k.unproject(new s.P(ce.center[0],ce.center[1])),ht=s.dv(k.projection,Xe),bt=Math.pow(2,ht),ct=Math.min(k._zoomFromMercatorZ(Re[2]*k.pixelsPerMeter*bt/k.worldSize),M.maxZoom);return k.mercatorFromTransition&&ct<.5*(s.c2+s.bU)?(k.setProjection({name:"globe"}),k.zoom=ct,this._cameraForBounds(k,a,f,_,v,w)):{center:Xe,zoom:ct,bearing:_,pitch:v}}fitBounds(r,a,f){const _=this.cameraForBounds(r,a);return this._fitInternal(_,a,f)}fitScreenCoordinates(r,a,f,_,v){const w=s.P.convert(r),k=s.P.convert(a),M=new s.P(Math.min(w.x,k.x),Math.min(w.y,k.y)),B=new s.P(Math.max(w.x,k.x),Math.max(w.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,k))return this;const z=this.transform.pointLocation3D(M),V=this.transform.pointLocation3D(B),U=this.transform.pointLocation3D(new s.P(M.x,B.y)),q=this.transform.pointLocation3D(new s.P(B.x,M.y)),Y=[Math.min(z.lng,V.lng,U.lng,q.lng),Math.min(z.lat,V.lat,U.lat,q.lat)],J=[Math.max(z.lng,V.lng,U.lng,q.lng),Math.max(z.lat,V.lat,U.lat,q.lat)],ee=_&&_.pitch?_.pitch:this.getPitch(),re=this._cameraForBounds(this.transform,Y,J,f,ee,_);return this._fitInternal(re,_,v)}_fitInternal(r,a,f){return r?(a=s.l(r,a)).linear?this.easeTo(a,f):this.flyTo(a,f):this}jumpTo(r,a){this.stop();const f=r.preloadOnly?this.transform.clone():this.transform;let _=!1,v=!1,w=!1;"zoom"in r&&f.zoom!==+r.zoom&&(_=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=s.bK.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(v=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(w=!0,f.pitch=+r.pitch);const k=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!f.isPaddingEqual(k))if(r.retainPadding===!1){const M=f.clone();M.padding=k,f.setLocationAtPoint(f.center,M.centerPoint)}else f.padding=k;return r.preloadOnly?(this._preloadTiles(f),this):(this.fire(new s.x("movestart",a)).fire(new s.x("move",a)),_&&this.fire(new s.x("zoomstart",a)).fire(new s.x("zoom",a)).fire(new s.x("zoomend",a)),v&&this.fire(new s.x("rotatestart",a)).fire(new s.x("rotate",a)).fire(new s.x("rotateend",a)),w&&this.fire(new s.x("pitchstart",a)).fire(new s.x("pitch",a)).fire(new s.x("pitchend",a)),this.fire(new s.x("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Ka),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,a){const f=this.transform;if(!f.projection.supportsFreeCamera)return s.w(Ka),this;this.stop();const _=f.zoom,v=f.pitch,w=f.bearing;f.setFreeCameraOptions(r);const k=_!==f.zoom,M=v!==f.pitch,B=w!==f.bearing;return this.fire(new s.x("movestart",a)).fire(new s.x("move",a)),k&&this.fire(new s.x("zoomstart",a)).fire(new s.x("zoom",a)).fire(new s.x("zoomend",a)),B&&this.fire(new s.x("rotatestart",a)).fire(new s.x("rotate",a)).fire(new s.x("rotateend",a)),M&&this.fire(new s.x("pitchstart",a)).fire(new s.x("pitch",a)).fire(new s.x("pitchend",a)),this.fire(new s.x("moveend",a)),this}easeTo(r,a){this._stop(!1,r.easeId),((r=s.l({offset:[0,0],duration:500,easing:s.dr},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const f=this.transform,_=this.getZoom(),v=this.getBearing(),w=this.getPitch(),k=this.getPadding(),M="zoom"in r?+r.zoom:_,B="bearing"in r?this._normalizeBearing(r.bearing,v):v,z="pitch"in r?+r.pitch:w,V=this._extendPadding(r.padding),U=s.P.convert(r.offset);let q,Y,J;if(f.projection.name==="globe"){const Oe=s.a5.fromLngLat(f.center),ke=U.rotate(-f.angle);Oe.x+=ke.x/f.worldSize,Oe.y+=ke.y/f.worldSize;const Re=Oe.toLngLat(),Xe=s.bK.convert(r.center||Re);this._normalizeCenter(Xe),q=f.centerPoint.add(ke),Y=new s.P(Oe.x,Oe.y).mult(f.worldSize),J=new s.P(s.am(Xe.lng),s.at(Xe.lat)).mult(f.worldSize).sub(Y)}else{q=f.centerPoint.add(U);const Oe=f.pointLocation(q),ke=s.bK.convert(r.center||Oe);this._normalizeCenter(ke),Y=f.project(Oe),J=f.project(ke).sub(Y)}const ee=f.zoomScale(M-_);let re,he;r.around&&(re=s.bK.convert(r.around),he=f.locationPoint(re));const pe=this._zooming||M!==_,ce=this._rotating||v!==B,ye=this._pitching||z!==w,ge=!f.isPaddingEqual(V),Ae=r.retainPadding===!1?f.clone():f,Te=Oe=>ke=>{if(pe&&(Oe.zoom=s.aa(_,M,ke)),ce&&(Oe.bearing=s.aa(v,B,ke)),ye&&(Oe.pitch=s.aa(w,z,ke)),ge&&(Ae.interpolatePadding(k,V,ke),q=Ae.centerPoint.add(U)),re)Oe.setLocationAtPoint(re,he);else{const Re=Oe.zoomScale(Oe.zoom-_),Xe=M>_?Math.min(2,ee):Math.max(.5,ee),ht=Math.pow(Xe,1-ke),bt=Oe.unproject(Y.add(J.mult(ke*ht)).mult(Re));Oe.setLocationAtPoint(Oe.renderWorldCopies?bt.wrap():bt,q)}return r.preloadOnly||this._fireMoveEvents(a),Oe};if(r.preloadOnly){const Oe=this._emulate(Te,r.duration,f);return this._preloadTiles(Oe),this}const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=ce,this._pitching=ye,this._padding=ge,this._easeId=r.easeId,this._prepareEase(a,r.noMoveStart,Se),this._ease(Te(f),Oe=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(a,Oe)},r),this}_prepareEase(r,a,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||f.moving||this.fire(new s.x("movestart",r)),this._zooming&&!f.zooming&&this.fire(new s.x("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new s.x("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new s.x("pitchstart",r))}_fireMoveEvents(r){this.fire(new s.x("move",r)),this._zooming&&this.fire(new s.x("zoom",r)),this._rotating&&this.fire(new s.x("rotate",r)),this._pitching&&this.fire(new s.x("pitch",r))}_afterEase(r,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new s.x("zoomend",r)),_&&this.fire(new s.x("rotateend",r)),v&&this.fire(new s.x("pitchend",r)),this.fire(new s.x("moveend",r))}flyTo(r,a){if(this._prefersReducedMotion(r)){const pt=s.ar(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(pt,a)}this.stop(),r=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.dr},r);const f=this.transform,_=this.getZoom(),v=this.getBearing(),w=this.getPitch(),k=this.getPadding(),M="zoom"in r?s.ap(+r.zoom,f.minZoom,f.maxZoom):_,B="bearing"in r?this._normalizeBearing(r.bearing,v):v,z="pitch"in r?+r.pitch:w,V=this._extendPadding(r.padding),U=f.zoomScale(M-_),q=s.P.convert(r.offset);let Y=f.centerPoint.add(q);const J=f.pointLocation(Y),ee=s.bK.convert(r.center||J);this._normalizeCenter(ee);const re=f.project(J),he=f.project(ee).sub(re);let pe=r.curve;const ce=Math.max(f.width,f.height),ye=ce/U,ge=he.mag();if("minZoom"in r){const pt=s.ap(Math.min(r.minZoom,_,M),f.minZoom,f.maxZoom),Pt=ce/f.zoomScale(pt-_);pe=Math.sqrt(Pt/ge*2)}const Ae=pe*pe;function Te(pt){const Pt=(ye*ye-ce*ce+(pt?-1:1)*Ae*Ae*ge*ge)/(2*(pt?ye:ce)*Ae*ge);return Math.log(Math.sqrt(Pt*Pt+1)-Pt)}function Se(pt){return(Math.exp(pt)-Math.exp(-pt))/2}function Oe(pt){return(Math.exp(pt)+Math.exp(-pt))/2}const ke=Te(0);let Re=function(pt){return Oe(ke)/Oe(ke+pe*pt)},Xe=function(pt){return ce*((Oe(ke)*(Se(Pt=ke+pe*pt)/Oe(Pt))-Se(ke))/Ae)/ge;var Pt},ht=(Te(1)-ke)/pe;if(Math.abs(ge)<1e-6||!isFinite(ht)){if(Math.abs(ce-ye)<1e-6)return this.easeTo(r,a);const pt=ye<ce?-1:1;ht=Math.abs(Math.log(ye/ce))/pe,Xe=function(){return 0},Re=function(Pt){return Math.exp(pt*pe*Pt)}}r.duration="duration"in r?+r.duration:1e3*ht/("screenSpeed"in r?+r.screenSpeed/pe:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const bt=v!==B,ct=z!==w,Rt=!f.isPaddingEqual(V),Ke=r.retainPadding===!1?f.clone():f,gt=pt=>Pt=>{const Lt=Pt*ht,yt=1/Re(Lt);pt.zoom=Pt===1?M:_+pt.scaleZoom(yt),bt&&(pt.bearing=s.aa(v,B,Pt)),ct&&(pt.pitch=s.aa(w,z,Pt)),Rt&&(Ke.interpolatePadding(k,V,Pt),Y=Ke.centerPoint.add(q));const Tt=Pt===1?ee:pt.unproject(re.add(he.mult(Xe(Lt))).mult(yt));return pt.setLocationAtPoint(pt.renderWorldCopies?Tt.wrap():Tt,Y),pt._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(a),pt};if(r.preloadOnly){const pt=this._emulate(gt,r.duration,f);return this._preloadTiles(pt),this}return this._zooming=!0,this._rotating=bt,this._pitching=ct,this._padding=Rt,this._prepareEase(a,!1),this._ease(gt(f),()=>this._afterEase(a),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,a)}if(!r){const f=this.handlers;f&&f.stop(!1)}return this}_ease(r,a,f){f.animate===!1||f.duration===0?(r(1),a()):(this._easeStart=s.q.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,a){r=s.bA(r,-180,180);const f=Math.abs(r-a);return Math.abs(r-360-a)<f&&(r-=360),Math.abs(r+360-a)<f&&(r+=360),r}_normalizeCenter(r){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const f=r.lng-a.center.lng;r.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,a,f){const _=Math.ceil(15*a/1e3),v=[],w=r(f.clone());for(let k=0;k<=_;k++){const M=w(k/_);v.push(M.clone())}return v}_preloadTiles(r,a){}}class Jd{constructor(r={}){this.options=r,s.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const a=this.options&&this.options.compact,f=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=Ne("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ne("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);const _=Ne("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",f),this._innerContainer=Ne("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(r){const f=a.reduce((_,v,w)=>(v.value&&(_+=`${v.key}=${v.value}${w<a.length-1?"&":""}`),_),"?");r.href=`${s.e.FEEDBACK_URL}/${f}#${dl(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const a=this._map.style._mergedSourceCaches;for(const _ in a){const v=a[_];if(v.used){const w=v.getSource();w.attribution&&r.indexOf(w.attribution)<0&&r.push(w.attribution)}}r.sort((_,v)=>_.length-v.length),r=r.filter((_,v)=>{for(let w=v+1;w<r.length;w++)if(r[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Gp{constructor(){s.aJ(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=Ne("div","mapboxgl-ctrl");const a=Ne("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const a in r){const f=r[a].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const a=r[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class S_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const a=++this._id;return this._queue.push({callback:r,id:a,cancelled:!1}),a}remove(r){const a=this._currentlyRunning,f=a?this._queue.concat(a):this._queue;for(const _ of f)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const f of a)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Mh{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const a=s.cw((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,a,f){this._start=this.getValue(a),this._end=r,this._startTime=a,this._endTime=a+f}}const zv={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Fv{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Hp{constructor(r){this.map=r,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(r,a){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const{type:f,filter:_}=a;if(_){const w=s.M(_,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(w.result==="error")throw new Error(w.value.map(k=>`${k.key}: ${k.message}`).join(", "));this.filters.set(r,w.value)}const v=this.interactionsByType.get(f)||new Map;v.size===0&&(this.map.on(f,this.handleType),this.interactionsByType.set(f,v)),v.set(r,a),this.typeById.set(r,f)}remove(r){const a=this.typeById.get(r);if(!a)return;this.typeById.delete(r),this.filters.delete(r);const f=this.interactionsByType.get(a);f&&(f.delete(r),f.size===0&&this.map.off(a,this.handleType))}handleType(r){const a=r.features||this.map.queryRenderedFeatures(r.point);if(!a)return;const f=this.interactionsByType.get(r.type),_={zoom:0};for(const[v,w]of f){const k=this.filters.get(v),{handler:M,layers:B}=w;for(const z of a)if((!B||B.includes(z.layer.id))&&(!k||k.evaluate(_,z))&&M({id:v,feature:z,interaction:w})!==!1)break}}}const Wp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Dh={showCompass:!0,showZoom:!0,visualizePitch:!1};class gu{constructor(r,a,f=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Wd({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,f&&(this.mousePitch=new Zd({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),s.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(r,a){this.mouseRotate.mousedown(r,a),this.mousePitch&&this.mousePitch.mousedown(r,a),Ct()}move(r,a){const f=this.map,_=this.mouseRotate.mousemoveWindow(r,a),v=_&&_.bearingDelta;if(v&&f.setBearing(f.getBearing()+v),this.mousePitch){const w=this.mousePitch.mousemoveWindow(r,a),k=w&&w.pitchDelta;k&&f.setPitch(f.getPitch()+k)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){qt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(s.l({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Fe(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Fe(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Je(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=Je(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ya(d,r,a){if(d=new s.bK(d.lng,d.lat),r){const f=new s.bK(d.lng-360,d.lat),_=new s.bK(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-a.center.lng)/360),w=a.locationPoint(d).distSqr(r),k=r.x<0||r.y<0||r.x>a.width||r.y>a.height;a.locationPoint(f).distSqr(r)<w&&(k||Math.abs(f.lng-a.center.lng)<v)?d=f:a.locationPoint(_).distSqr(r)<w&&(k||Math.abs(_.lng-a.center.lng)<v)&&(d=_)}for(;Math.abs(d.lng-a.center.lng)>180;){const f=a.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=a.width&&f.y<=a.height)break;d.lng>a.center.lng?d.lng-=360:d.lng+=360}return d}const Ps={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ja extends s.E{constructor(r,a){if(super(),(r instanceof HTMLElement||a)&&(r=s.l({element:r},a)),s.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=s.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ne("div");const v=41,w=27,k=wt("svg",{display:"block",height:v*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${v}`},this._element),M=wt("radialGradient",{id:"shadowGradient"},wt("defs",{},k));wt("stop",{offset:"10%","stop-opacity":.4},M),wt("stop",{offset:"100%","stop-opacity":.05},M),wt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),wt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),wt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),wt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=s.P.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const f=this._element.classList;for(const v in Ps)f.remove(`mapboxgl-marker-anchor-${v}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);const _=r&&r.className?r.className.trim().split(/\s+/):[];f.add(..._),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=s.bK.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const a=r.code,f=r.charCode||r.keyCode;a!=="Space"&&a!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(r){const a=r.originalEvent.target,f=this._element;this._popup&&(a===f||f.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,a=this._pos;if(!r||!a)return!1;const f=r.unproject(a),_=r.getFreeCameraOptions();if(!_.position)return!1;const v=_.position.toLngLat();return v.distanceTo(f)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const a=this._pos;if(!a||a.x<0||a.x>r.transform.width||a.y<0||a.y>r.transform.height)return void this._clearFadeTimer();const f=r.unproject(a);let _;r._showingGlobe()&&s.dz(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(f),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Ps[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const r=this._pos,a=this._map,f=this.getPitchAlignment();if(!a||!r||f!=="map")return"";if(!a._showingGlobe()){const M=a.getPitch();return M?`rotateX(${M}deg)`:""}const _=s.c0(s.dA(a.transform,this._lngLat)),v=r.sub(s.dB(a.transform)),w=Math.abs(v.x)+Math.abs(v.y);if(w===0)return"";const k=_/w;return`rotateX(${-v.y*k}deg) rotateY(${v.x*k}deg)`}_calculateZTransform(){const r=this._pos,a=this._map;if(!a||!r)return"";let f=0;const _=this.getRotationAlignment();if(_==="map")if(a._showingGlobe()){const v=a.project(new s.bK(this._lngLat.lng,this._lngLat.lat+.001)),w=a.project(new s.bK(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);f=s.c0(Math.atan2(w.y,w.x))-90}else f=-a.getBearing();else if(_==="horizon"){const v=s.a7(4,6,a.getZoom()),w=s.dB(a.transform);w.y+=v*a.transform.height;const k=r.sub(w),M=s.c0(Math.atan2(k.y,k.x));f=(M>90?M-270:M+90)*(1-v)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Ya(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=s.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const a=this._map;if(!a)return;const f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){const v=this._clickTolerance||a._clickTolerance;if(r.point.dist(f)<v)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.x("dragstart"))),this.fire(new s.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.x("dragend")),this._state="inactive"}_addDragHandler(r){const a=this._map,f=this._pos;a&&f&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(f),this._pointerdownPos=r.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const a=this._map;return a&&(r?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ic={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Zl={maxWidth:100,unit:"metric"},Nv={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Vv={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Uv=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function C_(d=new s.P(0,0),r="bottom"){if(typeof d=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(r){case"top":return new s.P(0,d);case"top-left":return new s.P(a,a);case"top-right":return new s.P(-a,a);case"bottom":return new s.P(0,-d);case"bottom-left":return new s.P(a,-a);case"bottom-right":return new s.P(-a,-a);case"left":return new s.P(d,0);case"right":return new s.P(-d,0)}return new s.P(0,0)}return d instanceof s.P||Array.isArray(d)?s.P.convert(d):s.P.convert(d[r]||[0,0])}return{version:$,supported:$e.supported,setRTLTextPlugin:s.dC,getRTLTextPluginStatus:s.dD,Map:class extends qp{constructor(d){Q.mark(W.create);const r=d;if((d=s.l({},Wp,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&s.dx(window)&&(d.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Qc(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new S_,this._domRenderTaskQueue=new S_,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aP(),this._locale=s.l({},zv,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Mh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new jn(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?{...d.contextCreateOptions}:{},typeof d.container=="string"){const a=document.getElementById(d.container);if(!a)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=a}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),s.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Fv),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Fo(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||s.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new Hl(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const a=d.bounds;a&&(this.resize(),this.fitBounds(a,s.l({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new Jd({customAttribution:d.customAttribution})),this._logoControl=new Gp,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new s.x(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new s.x(`${a.dataType}dataloading`,a))}),this._interactions=new Hp(this)}_getMapId(){return this._mapId}addControl(d,r){if(r===void 0&&(r=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new s.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(a,f.firstChild):f.appendChild(a),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new s.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(d);return r>-1&&this._controls.splice(r,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new s.x("movestart",d)).fire(new s.x("move",d)),this.fire(new s.x("resize",d)),r&&this.fire(new s.x("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(s.as.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new s.x("zoomstart")).fire(new s.x("zoom")).fire(new s.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new s.x("zoomstart")).fire(new s.x("zoom")).fire(new s.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new s.x("pitchstart")).fire(new s.x("pitch")).fire(new s.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new s.x("pitchstart")).fire(new s.x("pitch")).fire(new s.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(r=>r==="auto"?navigator.language:r):d}setLanguage(d){const r=this._parseLanguage(d);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,r=d.projection.name;let a;r==="globe"&&d.zoom>=s.bU?(d.setMercatorFromTransition(),a=!0):r==="mercator"&&d.zoom<s.bU&&(d.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,r){return this._updateProjection(d||r||{name:"mercator"})}_updateProjection(d){let r;return r=d.name==="globe"&&this.transform.zoom>=s.bU?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(s.bK.convert(d))}unproject(d){return this.transform.pointLocation3D(s.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,r,a){if(d==="mouseenter"||d==="mouseover"){let f=!1;const _=w=>{const k=r.filter(B=>this.getLayer(B)),M=k.length?this.queryRenderedFeatures(w.point,{layers:k}):[];M.length?f||(f=!0,a.call(this,new Yo(d,this,w.originalEvent,{features:M}))):f=!1},v=()=>{f=!1};return{layers:new Set(r),listener:a,delegates:{mousemove:_,mouseout:v}}}if(d==="mouseleave"||d==="mouseout"){let f=!1;const _=w=>{const k=r.filter(M=>this.getLayer(M));(k.length?this.queryRenderedFeatures(w.point,{layers:k}):[]).length?f=!0:f&&(f=!1,a.call(this,new Yo(d,this,w.originalEvent)))},v=w=>{f&&(f=!1,a.call(this,new Yo(d,this,w.originalEvent)))};return{layers:new Set(r),listener:a,delegates:{mousemove:_,mouseout:v}}}{const f=_=>{const v=r.filter(k=>this.getLayer(k)),w=v.length?this.queryRenderedFeatures(_.point,{layers:v}):[];w.length&&(_.features=w,a.call(this,_),delete _.features)};return{layers:new Set(r),listener:a,delegates:{[d]:f}}}}on(d,r,a){if(typeof r=="function"||a===void 0)return super.on(d,r);if(Array.isArray(r)||(r=[r]),r){for(const _ of r)if(!this._isValidId(_))return this}const f=this._createDelegatedListener(d,r,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(d,r,a){if(typeof r=="function"||a===void 0)return super.once(d,r);if(Array.isArray(r)||(r=[r]),r){for(const _ of r)if(!this._isValidId(_))return this}const f=this._createDelegatedListener(d,r,a);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(d,r,a){if(typeof r=="function"||a===void 0)return super.off(d,r);const f=new Set(Array.isArray(r)?r:[r]);for(const w of f)if(!this._isValidId(w))return this;const _=(w,k)=>{if(w.size!==k.size)return!1;for(const M of w)if(!k.has(M))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[d]:void 0;return v&&(w=>{for(let k=0;k<w.length;k++){const M=w[k];if(M.listener===a&&_(M.layers,f)){for(const B in M.delegates)this.off(B,M.delegates[B]);return w.splice(k,1),this}}})(v),this}queryRenderedFeatures(d,r){if(!this.style)return[];if(r!==void 0||d===void 0||d instanceof s.P||Array.isArray(d)||(r=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],(r=r||{}).layers&&Array.isArray(r.layers)){for(const a of r.layers)if(!this._isValidId(a))return[]}return this.style.queryRenderedFeatures(d,r,this.transform)}querySourceFeatures(d,r){return this._isValidId(d)?this.style.querySourceFeatures(d,r):[]}isPointOnSurface(d){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&s.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(d))}addInteraction(d,r){return this._interactions.add(d,r),this}removeInteraction(d){return this._interactions.remove(d),this}setStyle(d,r){return r=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&d&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(d,(a,f)=>{a?(s.w(`Unable to perform style diff: ${String(a.message||a.error||a)}. Rebuilding the style from scratch.`),this._updateStyle(d,r)):f&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(d,r))}_getUIString(d){const r=this._locale[d];if(r==null)throw new Error(`Missing UI string '${d}'`);return r}_updateStyle(d,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const a=s.l({},r);r&&r.config&&(a.initialConfig=r.config,delete a.config),this.style=new Zo(this,a).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Zo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new s.t(new Error("IDs can't be empty."))),!1):!s.cn(d)||(this.fire(new s.t(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}addSource(d,r){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,r),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,r,a){this._lazyInitEmptyStyle(),this.style.addSourceType(d,r,a)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,r,{pixelRatio:a=1,sdf:f=!1,stretchX:_,stretchY:v,content:w}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:k,height:M,data:B}=s.q.getImageData(r);this.style.addImage(d,{data:new s.r({width:k,height:M},B),pixelRatio:a,stretchX:_,stretchY:v,content:w,sdf:f,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new s.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:M}=r,B=r;this.style.addImage(d,{data:new s.r({width:k,height:M},new Uint8Array(B.data)),pixelRatio:a,stretchX:_,stretchY:v,content:w,sdf:f,version:0,userImage:B}),B.onAdd&&B.onAdd(this,d)}}updateImage(d,r){this._lazyInitEmptyStyle();const a=this.style.getImage(d);if(!a)return void this.fire(new s.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?s.q.getImageData(r):r,{width:_,height:v,data:w}=f;if(_===void 0||v===void 0)return void this.fire(new s.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==a.data.width||v!==a.data.height)return void this.fire(new s.t(new Error(`The width and height of the updated image (${_}, ${v})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));const k=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);a.data.replace(w,k),this.style.updateImage(d,a)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new s.t(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,r){s.o(this._requestManager.transformRequest(d,s.R.Image),(a,f)=>{r(a,f instanceof HTMLImageElement?s.q.getImageData(f):f)})}listImages(){return this.style.listImages()}addModel(d,r){this._lazyInitEmptyStyle(),this.style.addModel(d,r)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new s.t(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,r){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,r),this._update(!0)):this}getSlot(d){const r=this.getLayer(d);return r&&r.slot||null}setSlot(d,r){return this.style.setSlot(d,r),this.style.mergeLayers(),this._update(!0)}addImport(d,r){return this.style.addImport(d,r),this}updateImport(d,r){return typeof r!="string"&&r.id!==d?(this.removeImport(d),this.addImport(r)):(this.style.updateImport(d,r),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,r){return this.style.moveImport(d,r),this._update(!0)}moveLayer(d,r){return this._isValidId(d)?(this.style.moveLayer(d,r),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const r=this.style.getOwnLayer(d);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,r,a){return this._isValidId(d)?(this.style.setLayerZoomRange(d,r,a),this._update(!0)):this}setFilter(d,r,a={}){return this._isValidId(d)?(this.style.setFilter(d,r,a),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,r,a,f={}){return this._isValidId(d)?(this.style.setPaintProperty(d,r,a,f),this._update(!0)):this}getPaintProperty(d,r){return this._isValidId(d)?this.style.getPaintProperty(d,r):null}setLayoutProperty(d,r,a,f={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,r,a,f),this._update(!0)):this}getLayoutProperty(d,r){return this._isValidId(d)?this.style.getLayoutProperty(d,r):null}getSchema(d){return this.style.getSchema(d)}setSchema(d,r){return this.style.setSchema(d,r),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,r){return this.style.setConfig(d,r),this._update(!0)}getConfigProperty(d,r){return this.style.getConfigProperty(d,r)}setConfigProperty(d,r,a){return this.style.setConfigProperty(d,r,a),this._update(!0)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const r=d[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bK.convert(d),this.transform):0}setFeatureState(d,r){return this._isValidId(d.source)?(this.style.setFeatureState(d,r),this._update()):this}removeFeatureState(d,r){return this._isValidId(d.source)?(this.style.removeFeatureState(d,r),this._update()):this}getFeatureState(d){return this._isValidId(d.source)?this.style.getFeatureState(d):null}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let a,f,_,v=this._container;for(;v&&(!f||!_);){const w=window.getComputedStyle(v).transform;w&&w!=="none"&&(a=w.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(f=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(_=a[3])),v=v.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ne("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=Ne("div","mapboxgl-canvas-container",d);this._canvas=Ne("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=Ne("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{f[_]=Ne("div",`mapboxgl-ctrl-${_}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,r){const a=s.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(d),this._canvas.height=a*Math.ceil(r),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${r}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const r=this._markers.indexOf(d);r!==-1&&this._markers.splice(r,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const r=this._popups.indexOf(d);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const d=s.l({},$e.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",d);r?(Le(r,!0),this.painter=new Dp(r,this._contextCreateOptions,this.transform,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(r)):this.fire(new s.t(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.x("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new s.x("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let r;this.fire(new s.x("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,f=s.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=_.createQuery(),_.beginQuery(a.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,z=this.transform.pitch,V=s.q.now(),U=new s.a3(B,{now:V,fadeDuration:v,pitch:z,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(f),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(f);const k=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource);if(k&&(this._placementDirty=k.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Q.mark(W.load),this.fire(new s.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const B=s.q.now()-f;_.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const z=_.getQueryParameter(r,_.QUERY_RESULT)/1e6;_.deleteQuery(r),this.fire(new s.x("gpu-timing-frame",{cpuTime:B,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const B=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(B);this.fire(new s.x("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const B=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(B);this.fire(new s.x("gpu-timing-deferred-render",{gpuTime:z}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(M||this._repaint)this.triggerRepaint();else{const B=this.idle();if(B&&(w=this._updateAverageElevation(f,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),B&&(this.fire(new s.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new s.x("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,Q.mark(W.fullLoad),this._performanceMetricsCollection&&sr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const r of this._markers)d&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!d||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(d,r=!1){const a=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(r||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const _=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=d;const w=Math.abs(_-v);if(w>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(v),a(v);this._averageElevation.easeTo(v,d,300)}else if(w>1e-4)return this._averageElevation.jumpTo(v),a(v)}return!!this._averageElevation.isEasing(d)&&a(this._averageElevation.getValue(d))}_authenticate(){_e(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===An||d.status===401)){const r=this.painter.context.gl;Le(r,!1),this._logoControl instanceof Gp&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),li(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&It(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const a=this.painter.context.gl,f=a.createFramebuffer();function _(v){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,v,0);const w=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,w),w}return a.bindFramebuffer(a.FRAMEBUFFER,f),this._canvasPixelComparison(_(d),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(d,r,a){let f=a[1]-a[0];const _=d.length/4;for(let v=0;v<r.length;v++){const w=r[v];let k=0;for(let M=0;M<w.length;M+=4)w[M]===d[M]&&w[M+1]===d[M+1]&&w[M+2]===d[M+2]&&w[M+3]===d[M+3]&&(k+=1);f+=(a[v+2]-a[v+1])*(1-k/_)}return f}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),un.delete(this.painter.context.gl),wr.remove(),fr.remove(),this._removed=!0,this.fire(new s.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=s.q.frame(r=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(r)}))}_preloadTiles(d){const r=this.style?this.style.getSourceCaches():[];return s.bf(r,(a,f)=>a._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,r){s.dy(d,r)}get version(){return $}},NavigationControl:class{constructor(d={}){this.options=s.l({},Dh,d),this._container=Ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(s.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),Ne("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),Ne("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:r}):a.resetNorth({},{originalEvent:r}))}),this._compassIcon=Ne("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const r=d.getZoom(),a=r===d.getMaxZoom(),f=r===d.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gu(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,r){const a=Ne("button",d,this._container);return a.type="button",a.addEventListener("click",r),a}_setButtonTitle(d,r){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${r}`);d.setAttribute("aria-label",a),d.firstElementChild&&d.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.E{constructor(d={}){super();const r=navigator.geolocation;this.options=s.l({geolocation:r},Ic,d),s.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=hl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=Ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const r=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,d(a)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>r(a.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(d){const r=this._map.getMaxBounds(),a=d.coords;return!!r&&(a.longitude<r.getWest()||a.longitude>r.getEast()||a.latitude<r.getSouth()||a.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new s.x("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.x("geolocate",d)),this._finish()}}_updateCamera(d){const r=new s.bK(d.coords.longitude,d.coords.latitude),a=d.coords.accuracy,f=this._map.getBearing(),_=s.l({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(a),_,{geolocateSource:!0})}_updateMarker(d){if(d){const r=new s.bK(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,r=s.bD(1,d._center.lat)*d.worldSize,a=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.x("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Ne("button","mapboxgl-ctrl-geolocate",this._container),Ne("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ne("div","mapboxgl-user-location"),this._dotElement.appendChild(Ne("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ne("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ja({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ne("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ja({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.x("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Jd,ScaleControl:class{constructor(d={}){this.options=s.l({},Zl,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,r=this._map,a=r._containerHeight/2,f=r._containerWidth/2-d/2,_=r.unproject([f,a]),v=r.unproject([f+d,a]),w=_.distanceTo(v);if(this.options.unit==="imperial"){const k=3.2808*w;k>5280?this._setScale(d,k/5280,"mile"):this._setScale(d,k,"foot")}else this.options.unit==="nautical"?this._setScale(d,w/1852,"nautical-mile"):w>=1e3?this._setScale(d,w/1e3,"kilometer"):this._setScale(d,w,"meter")}_setScale(d,r,a){this._map._requestDomTask(()=>{const f=function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let k=v/w;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(M){const B=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*B)/B}(k),w*k}(r),_=f/r;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(f):`${f}&nbsp;${Nv[a]}`,this._container.style.width=d*_+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=Ne("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:s.w("Full screen control 'container' must be a DOM element.")),s.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=Ne("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ne("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(d){super(),this.options=s.l(Object.create(Vv),d),s.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new s.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new s.x("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=s.bK.convert(d),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const r=document.createDocumentFragment(),a=document.createElement("body");let f;for(a.innerHTML=d;f=a.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=Ne("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(d),this.options.closeButton){const a=this._closeButton=Ne("button","mapboxgl-popup-close-button",r);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let r;return this._classList.delete(d)?r=!1:(this._classList.add(d),r=!0),this._updateClassList(),r}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const r=this._map,a=this._container,f=this._pos;if(!r||!a||!f)return"bottom";const _=a.offsetWidth,v=a.offsetHeight,w=f.x<_/2,k=f.x>r.transform.width-_/2;if(f.y+d<v)return w?"top-left":k?"top-right":"top";if(f.y>r.transform.height-v){if(w)return"bottom-left";if(k)return"bottom-right"}return w?"left":k?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),d.className=r.join(" ")}_update(d){const r=this._map,a=this._content;if(!r||!this._lngLat&&!this._trackPointer||!a)return;let f=this._container;if(f||(f=this._container=Ne("div","mapboxgl-popup",r.getContainer()),this._tip=Ne("div","mapboxgl-popup-tip",f),f.appendChild(a)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ya(this._lngLat,this._pos,r.transform)),!this._trackPointer||d){const _=this._pos=this._trackPointer&&d instanceof s.P?d:r.project(this._lngLat),v=C_(this.options.offset),w=this._anchor=this._getAnchor(v.y),k=C_(this.options.offset,w),M=_.add(k).round();r._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Ps[w]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&r._showingGlobe()){const _=s.dz(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Uv);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Ja,Style:Zo,LngLat:s.bK,LngLatBounds:s.as,Point:s.P,MercatorCoordinate:s.a5,FreeCameraOptions:xo,Evented:s.E,config:s.e,prewarm:s.dE,clearPrewarmedResources:s.dF,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(d){s.e.ACCESS_TOKEN=d},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(d){s.e.API_URL=d},get workerCount(){return s.dG.workerCount},set workerCount(d){s.dG.workerCount=d},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){s.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){s.dH(d)},get workerUrl(){return s.dI.workerUrl},set workerUrl(d){s.dI.workerUrl=d},get workerClass(){return s.dI.workerClass},set workerClass(d){s.dI.workerClass=d},get workerParams(){return s.dI.workerParams},set workerParams(d){s.dI.workerParams=d},get dracoUrl(){return s.dJ()},set dracoUrl(d){s.dK(d)},get meshoptUrl(){return s.dL()},set meshoptUrl(d){s.dM(d)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var L=b;return L})})(WD);var AG=WD.exports;const qu=FB(AG),SG={data(){return{map:null,markers:[],query:"",mapboxToken:"pk.eyJ1IjoieXVwZW5nbGl1IiwiYSI6ImNtMjF2a2lpNDAwa28ybXEwNzByeHZkdjEifQ.eJuvRXNJcqKUbAFBwu5xJg"}},mounted(){this.initializeMap()},methods:{initializeMap(){qu.accessToken=this.mapboxToken,this.map=new qu.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[144.9634,-37.813],zoom:10}),this.map.addControl(new qu.NavigationControl)},async searchPlaces(){if(!this.query)return;const n=`https://api.mapbox.com/geocoding/v5/mapbox.places/${this.query}.json?access_token=${this.mapboxToken}&limit=10`;try{const i=(await ni.get(n)).data.features;if(this.clearMarkers(),i.forEach(u=>{const[g,b]=u.geometry.coordinates,I=new qu.Marker().setLngLat([g,b]).addTo(this.map);this.markers.push(I)}),i.length>0){const[u,g]=i[0].geometry.coordinates;this.map.flyTo({center:[u,g],zoom:14})}}catch(e){console.error("Error fetching places:",e)}},clearMarkers(){this.markers.forEach(n=>n.remove()),this.markers=[]}}},CG={class:"container"},RG={class:"row col-12"},kG=dt("h1",{class:"text-center"},"Searching Places of Interest",-1),PG={class:"row row-cols-lg align-items-center justify-content-center",action:"#",style:{"margin-bottom":"20px"}},MG={class:"row col-10"},DG=dt("label",{for:"colFormLabelLg",class:"col-sm-2 col-form-label col-form-label-lg"},"Place Name",-1),LG={class:"col-sm-10"},OG={class:"col-2"},BG=dt("div",{id:"map",style:{width:"100%","min-height":"600px",height:"100%"}},null,-1);function zG(n,e,i,u,g,b){return en(),rn("div",CG,[dt("div",RG,[kG,dt("form",PG,[dt("div",MG,[DG,dt("div",LG,[_o(dt("input",{type:"text",class:"form-control form-control-lg",id:"colFormLabelLg",onKeyup:e[0]||(e[0]=i0((...I)=>b.searchPlaces&&b.searchPlaces(...I),["enter"])),"onUpdate:modelValue":e[1]||(e[1]=I=>g.query=I),placeholder:"Place Name",required:""},null,544),[[Is,g.query]])])]),dt("div",OG,[dt("button",{type:"button",class:"btn btn-success",onClick:e[2]||(e[2]=(...I)=>b.searchPlaces&&b.searchPlaces(...I))},"Search This Place")])])]),BG])}const FG=zs(SG,[["render",zG]]),NG={data(){return{map:null,start:"",end:"",travelMode:"driving",mapboxToken:"pk.eyJ1IjoieXVwZW5nbGl1IiwiYSI6ImNtMjF2a2lpNDAwa28ybXEwNzByeHZkdjEifQ.eJuvRXNJcqKUbAFBwu5xJg"}},mounted(){this.initializeMap()},methods:{initializeMap(){qu.accessToken=this.mapboxToken,this.map=new qu.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[144.9634,-37.813],zoom:10}),this.map.addControl(new qu.NavigationControl)},async getCoordinates(n){const e=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(n)}.json?access_token=${this.mapboxToken}`;try{return(await ni.get(e)).data.features[0].center}catch(i){return console.error("Error fetching coordinates:",i),null}},async getDirections(){if(!this.start||!this.end)return;const n=await this.getCoordinates(this.start),e=await this.getCoordinates(this.end);if(!n||!e)return;const i=`https://api.mapbox.com/directions/v5/mapbox/${this.travelMode}/${n};${e}?geometries=geojson&access_token=${this.mapboxToken}`;try{const g=(await ni.get(i)).data.routes[0].geometry;this.map.getSource("route")&&(this.map.removeLayer("route"),this.map.removeSource("route")),this.map.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:g}}),this.map.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b9ddd","line-width":5}});const b=new qu.LngLatBounds;g.coordinates.forEach(I=>b.extend(I)),this.map.fitBounds(b,{padding:50})}catch(u){console.error("Error fetching directions:",u)}}}},VG={class:"container"},UG={class:"row col-12"},jG=dt("h1",{class:"text-center"},"Navigate Between Places",-1),$G={class:"row row-cols-lg align-items-center justify-content-center",action:"#",style:{"margin-bottom":"20px"}},qG={class:"row col-3"},GG=dt("label",{for:"colFormLabelLg",class:"col-sm-2 col-form-label col-form-label-lg"},"From",-1),HG={class:"col-sm-10"},WG={class:"row col-3"},ZG=dt("label",{for:"colFormLabelLg",class:"col-sm-2 col-form-label col-form-label-lg"},"To",-1),XG={class:"col-sm-10"},KG={class:"row col-4"},YG=dt("label",{for:"colFormLabelLg",class:"col-sm-5 col-form-label col-form-label-lg"},"Travel Mode",-1),JG={class:"col-sm-7"},QG=dt("option",{value:"driving"},"Driving",-1),e7=dt("option",{value:"walking"},"Walking",-1),t7=dt("option",{value:"cycling"},"Cycling",-1),r7=[QG,e7,t7],n7={class:"col-2"},i7=dt("div",{id:"map",style:{width:"100%","min-height":"600px",height:"100%"}},null,-1);function o7(n,e,i,u,g,b){return en(),rn("div",VG,[dt("div",UG,[jG,dt("form",$G,[dt("div",qG,[GG,dt("div",HG,[_o(dt("input",{type:"text",class:"form-control form-control-lg","onUpdate:modelValue":e[0]||(e[0]=I=>g.start=I),placeholder:"Start Place",onKeyup:e[1]||(e[1]=i0((...I)=>b.getDirections&&b.getDirections(...I),["enter"])),required:""},null,544),[[Is,g.start]])])]),dt("div",WG,[ZG,dt("div",XG,[_o(dt("input",{type:"text",class:"form-control form-control-lg","onUpdate:modelValue":e[2]||(e[2]=I=>g.end=I),placeholder:"End Place",onKeyup:e[3]||(e[3]=i0((...I)=>b.getDirections&&b.getDirections(...I),["enter"])),required:""},null,544),[[Is,g.end]])])]),dt("div",KG,[YG,dt("div",JG,[_o(dt("select",{"onUpdate:modelValue":e[4]||(e[4]=I=>g.travelMode=I),class:"form-control"},r7,512),[[G0,g.travelMode]])])]),dt("div",n7,[dt("button",{type:"button",class:"btn btn-success",onClick:e[5]||(e[5]=(...I)=>b.getDirections&&b.getDirections(...I))},"Search")])])]),i7])}const s7=zs(NG,[["render",o7]]),a7={data(){return{messages:[],userInput:"",apiUrl:"https://chat-fqquxhhbva-uc.a.run.app/"}},methods:{async sendMessage(){if(this.userInput.trim()==="")return;this.messages.push({sender:"user",content:this.userInput});const n=this.userInput;this.userInput="";try{const e=await ni.post(this.apiUrl,{question:n});this.messages.push({sender:"ai",content:e.data})}catch(e){console.error("Error:",e),this.messages.push({sender:"ai",content:"Sorry, something went wrong."})}}}},l7=n=>(z0("data-v-78169354"),n=n(),F0(),n),c7={class:"conatiner"},u7=l7(()=>dt("h1",{class:"text-center"},"You Can Ask Me Any Questions",-1)),h7={class:"chat-container"},d7={class:"messages"},f7={class:"input-container"};function p7(n,e,i,u,g,b){return en(),rn("div",c7,[u7,dt("div",h7,[dt("div",d7,[(en(!0),rn(ws,null,Qy(g.messages,(I,L)=>(en(),rn("div",{key:L,class:Cg({"user-message":I.sender==="user","ai-message":I.sender==="ai"})},[dt("strong",null,Vn(I.sender==="user"?"You":"AI")+":",1),ts(" "+Vn(I.content),1)],2))),128))]),dt("div",f7,[_o(dt("input",{"onUpdate:modelValue":e[0]||(e[0]=I=>g.userInput=I),placeholder:"Ask something...",onKeyup:e[1]||(e[1]=i0((...I)=>b.sendMessage&&b.sendMessage(...I),["enter"]))},null,544),[[Is,g.userInput]]),dt("button",{onClick:e[2]||(e[2]=(...I)=>b.sendMessage&&b.sendMessage(...I))},"Send")])])])}const m7=zs(a7,[["render",p7],["__scopeId","data-v-78169354"]]),g7={data(){return{books:[],users:[],admin:0,customer:0}},created(){this.fetchBooks()},methods:{async fetchBooks(){try{const n=await ni.get("https://getbooks-fqquxhhbva-uc.a.run.app");this.books=n.data;const e=await ni.get("https://getusers-fqquxhhbva-uc.a.run.app");this.users=e.data;const i=await ni.get("https://countusers-fqquxhhbva-uc.a.run.app");this.admin=i.data.admin,this.customer=i.data.customer}catch(n){console.error("Error fetching books:",n)}}}},_7={class:"container"},y7={class:"row"},v7=dt("h1",{class:"text-center"},"Books List",-1),b7={class:"table table-striped table-bordered table-hover",style:{"margin-top":"20px"}},x7=dt("thead",null,[dt("tr",null,[dt("th",{scope:"col"},"#"),dt("th",{scope:"col"},"ISBN"),dt("th",{scope:"col"},"Book Name"),dt("th",{scope:"col"},"Category"),dt("th",{scope:"col"},"Creator")])],-1),w7={scope:"row"},T7=dt("hr",null,null,-1),E7=dt("h1",{class:"text-center"},"Users List",-1),I7={class:"table table-striped table-bordered table-hover",style:{"margin-top":"20px"}},A7=dt("thead",null,[dt("tr",null,[dt("th",{scope:"col"},"#"),dt("th",{scope:"col"},"Email"),dt("th",{scope:"col"},"Gender"),dt("th",{scope:"col"},"Role")])],-1),S7={scope:"row"};function C7(n,e,i,u,g,b){return en(),rn("div",_7,[dt("div",y7,[v7,dt("table",b7,[x7,dt("tbody",null,[(en(!0),rn(ws,null,Qy(g.books,(I,L)=>(en(),rn("tr",{key:I.id},[dt("th",w7,Vn(L+1),1),dt("td",null,Vn(I.isbn),1),dt("td",null,Vn(I.name),1),dt("td",null,Vn(I.category),1),dt("td",null,Vn(I.creator),1)]))),128))])]),T7,E7,dt("h3",null,"Admin: "+Vn(g.admin)+", Customer: "+Vn(g.customer),1),dt("table",I7,[A7,dt("tbody",null,[(en(!0),rn(ws,null,Qy(g.users,(I,L)=>(en(),rn("tr",{key:I.id},[dt("th",S7,Vn(L+1),1),dt("td",null,Vn(I.email),1),dt("td",null,Vn(I.gender),1),dt("td",{class:Cg(I.role==="admin"?"text-danger":"text-primary")},Vn(I.role),3)]))),128))])])])])}const R7=zs(g7,[["render",C7]]),k7={class:"container mt-5 mb-5"},P7={class:"row"},M7=dt("h1",{class:"text-center"},"User Profile",-1),D7={class:"text-center"},L7={class:"text-center"},O7={class:"text-center"},B7={__name:"LogoutView",setup(n){const e=nw(),i=_w(),u=sessionStorage.getItem("user"),g=sessionStorage.getItem("role"),b=sessionStorage.getItem("gender"),I=()=>{sessionStorage.removeItem("user"),sessionStorage.removeItem("role"),sessionStorage.removeItem("gender"),console.log(i.currentUser),S2(i),e.push("/").then(()=>{location.reload()})};return(L,s)=>(en(),rn("div",k7,[dt("div",P7,[M7,dt("h4",D7,"Username: "+Vn(Nn(u)),1),dt("h4",L7,"Role: "+Vn(Nn(g)),1),dt("h4",O7,"Gender: "+Vn(Nn(b)),1),dt("button",{type:"submit",class:"btn btn-primary me-2",onClick:I},"Logout")])]))}};var z7={};const F7=[{path:"/home",name:"Home",component:KN},{path:"/register",name:"Register",component:M8},{path:"/login",name:"Login",component:l8},{path:"/GetAllBookAPI",name:"GetAllBookAPI",component:lG},{path:"/UserAPI",name:"UserAPI",component:dG},{path:"/week12/admin",name:"Admin",component:K8,meta:{requiresAuth:!0}},{path:"/sendMail",name:"SendMail",component:$q,meta:{requiresAuth:!0}},{path:"/addBook",name:"AddBook",component:iG,meta:{requiresAuth:!0}},{path:"/logout",name:"Logout",component:B7,meta:{requiresAuth:!0}},{path:"/WeatherCheck",name:"WeatherCheck",component:IG,meta:{requiresAuth:!0}},{path:"/map",name:"Map",component:FG,meta:{requiresAuth:!0}},{path:"/pathNav",name:"PathNav",component:s7,meta:{requiresAuth:!0}},{path:"/ai",name:"GenAI",component:m7,meta:{requiresAuth:!0}},{path:"/dashboard",name:"Dashboard",component:R7,meta:{requiresAuth:!0,admin:!0}}],XD=NN({history:fN(z7.BASE_URL),routes:F7});XD.beforeEach((n,e,i)=>{if(n.matched.some(u=>u.meta.requiresAuth)){const u=sessionStorage.getItem("user"),g=sessionStorage.getItem("role");u==null||u==""?i("/login"):(n.matched.some(b=>b.meta.admin)?g=="admin"?i():i("/admin"):i(),i())}else i()});var N7=Object.defineProperty,lR=Object.getOwnPropertySymbols,V7=Object.prototype.hasOwnProperty,U7=Object.prototype.propertyIsEnumerable,cR=(n,e,i)=>e in n?N7(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,j7=(n,e)=>{for(var i in e||(e={}))V7.call(e,i)&&cR(n,i,e[i]);if(lR)for(var i of lR(e))U7.call(e,i)&&cR(n,i,e[i]);return n};function KD(n){return n==null||n===""||Array.isArray(n)&&n.length===0||!(n instanceof Date)&&typeof n=="object"&&Object.keys(n).length===0}function $7(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Sa(n){return!KD(n)}function dd(n,e=!0){return n instanceof Object&&n.constructor===Object&&(e||Object.keys(n).length!==0)}function rg(n,...e){return $7(n)?n(...e):n}function Zf(n,e=!0){return typeof n=="string"&&(e||n!=="")}function q7(n,e=!0){return Array.isArray(n)&&(e||n.length!==0)}function YD(n){return Sa(n)&&!isNaN(n)}function Bc(n,e){if(e){const i=e.test(n);return e.lastIndex=0,i}return!1}function G7(...n){const e=(i={},u={})=>{const g=j7({},i);return Object.keys(u).forEach(b=>{dd(u[b])&&b in i&&dd(i[b])?g[b]=e(i[b],u[b]):g[b]=u[b]}),g};return n.reduce((i,u,g)=>g===0?u:e(i,u),{})}function ng(n){return n&&n.replace(/\/\*(?:(?!\*\/)[\s\S])*\*\/|[\r\n\t]+/g,"").replace(/ {2,}/g," ").replace(/ ([{:}]) /g,"$1").replace(/([;,]) /g,"$1").replace(/ !/g,"!").replace(/: /g,":")}function JD(n){return Zf(n)?n.replace(/(_)/g,"-").replace(/[A-Z]/g,(e,i)=>i===0?e:"-"+e.toLowerCase()).toLowerCase():n}function uR(n){return Zf(n)?n.replace(/[A-Z]/g,(e,i)=>i===0?e:"."+e.toLowerCase()).toLowerCase():n}function QD(){const n=new Map;return{on(e,i){let u=n.get(e);return u?u.push(i):u=[i],n.set(e,u),this},off(e,i){let u=n.get(e);return u&&u.splice(u.indexOf(i)>>>0,1),this},emit(e,i){let u=n.get(e);u&&u.slice().map(g=>{g(i)})},clear(){n.clear()}}}var H7=Object.defineProperty,W7=Object.defineProperties,Z7=Object.getOwnPropertyDescriptors,E0=Object.getOwnPropertySymbols,eL=Object.prototype.hasOwnProperty,tL=Object.prototype.propertyIsEnumerable,hR=(n,e,i)=>e in n?H7(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Pm=(n,e)=>{for(var i in e||(e={}))eL.call(e,i)&&hR(n,i,e[i]);if(E0)for(var i of E0(e))tL.call(e,i)&&hR(n,i,e[i]);return n},Ax=(n,e)=>W7(n,Z7(e)),Mm=(n,e)=>{var i={};for(var u in n)eL.call(n,u)&&e.indexOf(u)<0&&(i[u]=n[u]);if(n!=null&&E0)for(var u of E0(n))e.indexOf(u)<0&&tL.call(n,u)&&(i[u]=n[u]);return i},X7=QD(),Pc=X7;function dR(n,e){q7(n)?n.push(...e||[]):dd(n)&&Object.assign(n,e)}function K7(n){return dd(n)&&n.hasOwnProperty("value")&&n.hasOwnProperty("type")?n.value:n}function fR(n,e=""){return["opacity","z-index","line-height","font-weight","flex","flex-grow","flex-shrink","order"].some(u=>e.endsWith(u))?n:`${n}`.trim().split(" ").map(b=>YD(b)?`${b}px`:b).join(" ")}function Y7(n){return n.replaceAll(/ /g,"").replace(/[^\w]/g,"-")}function E1(n="",e=""){return Y7(`${Zf(n,!1)&&Zf(e,!1)?`${n}-`:n}${e}`)}function rL(n="",e=""){return`--${E1(n,e)}`}function nL(n,e="",i="",u=[],g){if(Zf(n)){const b=/{([^}]*)}/g,I=n.trim();if(Bc(I,b)){const L=I.replaceAll(b,W=>{const ae=W.replace(/{|}/g,"").split(".").filter(we=>!u.some(He=>Bc(we,He)));return`var(${rL(i,JD(ae.join("-")))}${Sa(g)?`, ${g}`:""})`}),s=/(\d+\s+[\+\-\*\/]\s+\d+)/g,$=/var\([^)]+\)/g;return Bc(L.replace($,"0"),s)?`calc(${L})`:L}return fR(I,e)}else if(YD(n))return fR(n,e)}function J7(n,e,i){Zf(e,!1)&&n.push(`${e}:${i};`)}function Um(n,e){return n?`${n}{${e}}`:""}var Sx=(...n)=>Q7(bs.getTheme(),...n),Q7=(n={},e,i,u="variable")=>{if(e){const{variable:g,options:b}=bs.defaults||{},{prefix:I,transform:L}=(n==null?void 0:n.options)||b||{},$=Bc(e,/{([^}]*)}/g)?e:`{${e}}`;return u==="value"||L==="strict"?bs.getTokenValue(e):nL($,void 0,I,[g.excludedKeyRegex],i)}return""};function eH(n,e={}){const i=bs.defaults.variable,{prefix:u=i.prefix,selector:g=i.selector,excludedKeyRegex:b=i.excludedKeyRegex}=e,I=($,W="")=>Object.entries($).reduce((Q,[ae,we])=>{const He=Bc(ae,b)?E1(W):E1(W,JD(ae)),$e=K7(we);if(dd($e)){const{variables:Ne,tokens:wt}=I($e,He);dR(Q.tokens,wt),dR(Q.variables,Ne)}else Q.tokens.push((u?He.replace(`${u}-`,""):He).replaceAll("-",".")),J7(Q.variables,rL(He),nL($e,He,u,[b]));return Q},{variables:[],tokens:[]}),{variables:L,tokens:s}=I(n,u);return{value:L,tokens:s,declarations:L.join(""),css:Um(g,L.join(""))}}var wl={regex:{rules:{class:{pattern:/^\.([a-zA-Z][\w-]*)$/,resolve(n){return{type:"class",selector:n,matched:this.pattern.test(n.trim())}}},attr:{pattern:/^\[(.*)\]$/,resolve(n){return{type:"attr",selector:`:root${n}`,matched:this.pattern.test(n.trim())}}},media:{pattern:/^@media (.*)$/,resolve(n){return{type:"media",selector:`${n}{:root{[CSS]}}`,matched:this.pattern.test(n.trim())}}},system:{pattern:/^system$/,resolve(n){return{type:"system",selector:"@media (prefers-color-scheme: dark){:root{[CSS]}}",matched:this.pattern.test(n.trim())}}},custom:{resolve(n){return{type:"custom",selector:n,matched:!0}}}},resolve(n){const e=Object.keys(this.rules).filter(i=>i!=="custom").map(i=>this.rules[i]);return[n].flat().map(i=>{var u;return(u=e.map(g=>g.resolve(i)).find(g=>g.matched))!=null?u:this.rules.custom.resolve(i)})}},_toVariables(n,e){return eH(n,{prefix:e==null?void 0:e.prefix})},getCommon({name:n="",theme:e={},params:i,set:u,defaults:g}){var b,I,L,s;const{preset:$,options:W}=e;let Q,ae,we,He;if(Sa($)){const{primitive:$e,semantic:Ne}=$,wt=Ne||{},{colorScheme:mt}=wt,vt=Mm(wt,["colorScheme"]),zt=mt||{},{dark:Ct}=zt,qt=Mm(zt,["dark"]),qe=Sa($e)?this._toVariables({primitive:$e},W):{},be=Sa(vt)?this._toVariables({semantic:vt},W):{},Fe=Sa(qt)?this._toVariables({light:qt},W):{},Je=Sa(Ct)?this._toVariables({dark:Ct},W):{},[Me,je]=[(b=qe.declarations)!=null?b:"",qe.tokens],[Ve,An]=[(I=be.declarations)!=null?I:"",be.tokens||[]],[jn,or]=[(L=Fe.declarations)!=null?L:"",Fe.tokens||[]],[Cr,Vr]=[(s=Je.declarations)!=null?s:"",Je.tokens||[]];Q=this.transformCSS(n,Me,"light","variable",W,u,g),ae=je;const On=this.transformCSS(n,`${Ve}${jn}color-scheme:light`,"light","variable",W,u,g),dr=this.transformCSS(n,`${Cr}color-scheme:dark`,"dark","variable",W,u,g);we=`${On}${dr}`,He=[...new Set([...An,...or,...Vr])]}return{primitive:{css:Q,tokens:ae},semantic:{css:we,tokens:He}}},getPreset({name:n="",preset:e={},options:i,params:u,set:g,defaults:b,selector:I}){var L,s,$;const W=n.replace("-directive",""),Q=e,{colorScheme:ae}=Q,we=Mm(Q,["colorScheme"]),He=ae||{},{dark:$e}=He,Ne=Mm(He,["dark"]),wt=Sa(we)?this._toVariables({[W]:we},i):{},mt=Sa(Ne)?this._toVariables({[W]:Ne},i):{},vt=Sa($e)?this._toVariables({[W]:$e},i):{},[zt,Ct]=[(L=wt.declarations)!=null?L:"",wt.tokens||[]],[qt,qe]=[(s=mt.declarations)!=null?s:"",mt.tokens||[]],[be,Fe]=[($=vt.declarations)!=null?$:"",vt.tokens||[]],Je=[...new Set([...Ct,...qe,...Fe])],Me=this.transformCSS(W,`${zt}${qt}`,"light","variable",i,g,b,I),je=this.transformCSS(W,be,"dark","variable",i,g,b,I);return{css:`${Me}${je}`,tokens:Je}},getPresetC({name:n="",theme:e={},params:i,set:u,defaults:g}){var b;const{preset:I,options:L}=e,s=(b=I==null?void 0:I.components)==null?void 0:b[n];return this.getPreset({name:n,preset:s,options:L,params:i,set:u,defaults:g})},getPresetD({name:n="",theme:e={},params:i,set:u,defaults:g}){var b;const I=n.replace("-directive",""),{preset:L,options:s}=e,$=(b=L==null?void 0:L.directives)==null?void 0:b[I];return this.getPreset({name:I,preset:$,options:s,params:i,set:u,defaults:g})},getColorSchemeOption(n,e){var i;return this.regex.resolve((i=n.darkModeSelector)!=null?i:e.options.darkModeSelector)},getLayerOrder(n,e={},i,u){const{cssLayer:g}=e;return g?`@layer ${rg(g.order||"primeui",i)}`:""},getCommonStyleSheet({name:n="",theme:e={},params:i,props:u={},set:g,defaults:b}){const I=this.getCommon({name:n,theme:e,params:i,set:g,defaults:b}),L=Object.entries(u).reduce((s,[$,W])=>s.push(`${$}="${W}"`)&&s,[]).join(" ");return Object.entries(I||{}).reduce((s,[$,W])=>{if(W!=null&&W.css){const Q=ng(W==null?void 0:W.css),ae=`${$}-variables`;s.push(`<style type="text/css" data-primevue-style-id="${ae}" ${L}>${Q}</style>`)}return s},[]).join("")},getStyleSheet({name:n="",theme:e={},params:i,props:u={},set:g,defaults:b}){var I;const L={name:n,theme:e,params:i,set:g,defaults:b},s=(I=n.includes("-directive")?this.getPresetD(L):this.getPresetC(L))==null?void 0:I.css,$=Object.entries(u).reduce((W,[Q,ae])=>W.push(`${Q}="${ae}"`)&&W,[]).join(" ");return s?`<style type="text/css" data-primevue-style-id="${n}-variables" ${$}>${ng(s)}</style>`:""},createTokens(n={},e,i="",u="",g={}){return Object.entries(n).forEach(([b,I])=>{const L=Bc(b,e.variable.excludedKeyRegex)?i:i?`${i}.${uR(b)}`:uR(b),s=u?`${u}.${b}`:b;dd(I)?this.createTokens(I,e,L,s,g):(g[L]||(g[L]={paths:[],computed($,W={}){if($){const Q=this.paths.find(ae=>ae.scheme===$)||this.paths.find(ae=>ae.scheme==="none");return Q==null?void 0:Q.computed($,W.binding)}return this.paths.map(Q=>Q.computed(Q.scheme,W[Q.scheme]))}}),g[L].paths.push({path:s,value:I,scheme:s.includes("colorScheme.light")?"light":s.includes("colorScheme.dark")?"dark":"none",computed($,W={}){const Q=/{([^}]*)}/g;let ae=I;if(W.name=this.path,W.binding||(W.binding={}),Bc(I,Q)){const He=I.trim().replaceAll(Q,wt=>{var mt,vt;const zt=wt.replace(/{|}/g,"");return(vt=(mt=g[zt])==null?void 0:mt.computed($,W))==null?void 0:vt.value}),$e=/(\d+\w*\s+[\+\-\*\/]\s+\d+\w*)/g,Ne=/var\([^)]+\)/g;ae=Bc(He.replace(Ne,"0"),$e)?`calc(${He})`:He}return KD(W.binding)&&delete W.binding,{colorScheme:$,path:this.path,paths:W,value:ae.includes("undefined")?void 0:ae}}}))}),g},getTokenValue(n,e,i){var u;const b=(s=>s.split(".").filter(W=>!Bc(W.toLowerCase(),i.variable.excludedKeyRegex)).join("."))(e),I=e.includes("colorScheme.light")?"light":e.includes("colorScheme.dark")?"dark":void 0,L=[(u=n[b])==null?void 0:u.computed(I)].flat().filter(s=>s);return L.length===1?L[0].value:L.reduce((s={},$)=>{const W=$,{colorScheme:Q}=W,ae=Mm(W,["colorScheme"]);return s[Q]=ae,s},void 0)},transformCSS(n,e,i,u,g={},b,I,L){if(Sa(e)){const{cssLayer:s}=g;if(u!=="style"){const $=this.getColorSchemeOption(g,I),W=L?Um(L,e):e;e=i==="dark"?$.reduce((Q,{selector:ae})=>(Sa(ae)&&(Q+=ae.includes("[CSS]")?ae.replace("[CSS]",W):Um(ae,W)),Q),""):Um(L??":root",e)}if(s){const $={name:"primeui",order:"primeui"};dd(s)&&($.name=rg(s.name,{name:n,type:u})),Sa($.name)&&(e=Um(`@layer ${$.name}`,e),b==null||b.layerNames($.name))}return e}return""}},bs={defaults:{variable:{prefix:"p",selector:":root",excludedKeyRegex:/^(primitive|semantic|components|directives|variables|colorscheme|light|dark|common|root|states)$/gi},options:{prefix:"p",darkModeSelector:"system",cssLayer:!1}},_theme:void 0,_layerNames:new Set,_loadedStyleNames:new Set,_loadingStyles:new Set,_tokens:{},update(n={}){const{theme:e}=n;e&&(this._theme=Ax(Pm({},e),{options:Pm(Pm({},this.defaults.options),e.options)}),this._tokens=wl.createTokens(this.preset,this.defaults),this.clearLoadedStyleNames())},get theme(){return this._theme},get preset(){var n;return((n=this.theme)==null?void 0:n.preset)||{}},get options(){var n;return((n=this.theme)==null?void 0:n.options)||{}},get tokens(){return this._tokens},getTheme(){return this.theme},setTheme(n){this.update({theme:n}),Pc.emit("theme:change",n)},getPreset(){return this.preset},setPreset(n){this._theme=Ax(Pm({},this.theme),{preset:n}),this._tokens=wl.createTokens(n,this.defaults),this.clearLoadedStyleNames(),Pc.emit("preset:change",n),Pc.emit("theme:change",this.theme)},getOptions(){return this.options},setOptions(n){this._theme=Ax(Pm({},this.theme),{options:n}),this.clearLoadedStyleNames(),Pc.emit("options:change",n),Pc.emit("theme:change",this.theme)},getLayerNames(){return[...this._layerNames]},setLayerNames(n){this._layerNames.add(n)},getLoadedStyleNames(){return this._loadedStyleNames},isStyleNameLoaded(n){return this._loadedStyleNames.has(n)},setLoadedStyleName(n){this._loadedStyleNames.add(n)},deleteLoadedStyleName(n){this._loadedStyleNames.delete(n)},clearLoadedStyleNames(){this._loadedStyleNames.clear()},getTokenValue(n){return wl.getTokenValue(this.tokens,n,this.defaults)},getCommon(n="",e){return wl.getCommon({name:n,theme:this.theme,params:e,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}})},getComponent(n="",e){const i={name:n,theme:this.theme,params:e,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}};return wl.getPresetC(i)},getDirective(n="",e){const i={name:n,theme:this.theme,params:e,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}};return wl.getPresetD(i)},getCustomPreset(n="",e,i,u){const g={name:n,preset:e,options:this.options,selector:i,params:u,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}};return wl.getPreset(g)},getLayerOrderCSS(n=""){return wl.getLayerOrder(n,this.options,{names:this.getLayerNames()},this.defaults)},transformCSS(n="",e,i="style",u){return wl.transformCSS(n,e,u,i,this.options,{layerNames:this.setLayerNames.bind(this)},this.defaults)},getCommonStyleSheet(n="",e,i={}){return wl.getCommonStyleSheet({name:n,theme:this.theme,params:e,props:i,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}})},getStyleSheet(n,e,i={}){return wl.getStyleSheet({name:n,theme:this.theme,params:e,props:i,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}})},onStyleMounted(n){this._loadingStyles.add(n)},onStyleUpdated(n){this._loadingStyles.add(n)},onStyleLoaded(n,{name:e}){this._loadingStyles.size&&(this._loadingStyles.delete(e),Pc.emit(`theme:${e}:load`,n),!this._loadingStyles.size&&Pc.emit("theme:load"))}},vs={STARTS_WITH:"startsWith",CONTAINS:"contains",NOT_CONTAINS:"notContains",ENDS_WITH:"endsWith",EQUALS:"equals",NOT_EQUALS:"notEquals",IN:"in",LESS_THAN:"lt",LESS_THAN_OR_EQUAL_TO:"lte",GREATER_THAN:"gt",GREATER_THAN_OR_EQUAL_TO:"gte",BETWEEN:"between",DATE_IS:"dateIs",DATE_IS_NOT:"dateIsNot",DATE_BEFORE:"dateBefore",DATE_AFTER:"dateAfter"};function iL(n){return typeof HTMLElement=="object"?n instanceof HTMLElement:n&&typeof n=="object"&&n!==null&&n.nodeType===1&&typeof n.nodeName=="string"}function I1(n,e={}){if(iL(n)){const i=(u,g)=>{var b,I;const L=(b=n==null?void 0:n.$attrs)!=null&&b[u]?[(I=n==null?void 0:n.$attrs)==null?void 0:I[u]]:[];return[g].flat().reduce((s,$)=>{if($!=null){const W=typeof $;if(W==="string"||W==="number")s.push($);else if(W==="object"){const Q=Array.isArray($)?i(u,$):Object.entries($).map(([ae,we])=>u==="style"&&(we||we===0)?`${ae.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}:${we}`:we?ae:void 0);s=Q.length?s.concat(Q.filter(ae=>!!ae)):s}}return s},L)};Object.entries(e).forEach(([u,g])=>{if(g!=null){const b=u.match(/^on(.+)/);b?n.addEventListener(b[1].toLowerCase(),g):u==="p-bind"?I1(n,g):(g=u==="class"?[...new Set(i("class",g))].join(" ").trim():u==="style"?i("style",g).join(";").trim():g,(n.$attrs=n.$attrs||{})&&(n.$attrs[u]=g),n.setAttribute(u,g))}})}}function tH(n){if(n){let e=n.parentNode;return e&&e instanceof ShadowRoot&&e.host&&(e=e.host),e}return null}function rH(n){return!!(n!==null&&typeof n<"u"&&n.nodeName&&tH(n))}function nH(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function iH(n,e="",i){iL(n)&&i!==null&&i!==void 0&&n.setAttribute(e,i)}function Tg(n){"@babel/helpers - typeof";return Tg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tg(n)}function pR(n,e){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(n);e&&(u=u.filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable})),i.push.apply(i,u)}return i}function mR(n){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?pR(Object(i),!0).forEach(function(u){oH(n,u,i[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):pR(Object(i)).forEach(function(u){Object.defineProperty(n,u,Object.getOwnPropertyDescriptor(i,u))})}return n}function oH(n,e,i){return(e=sH(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function sH(n){var e=aH(n,"string");return Tg(e)=="symbol"?e:e+""}function aH(n,e){if(Tg(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var u=i.call(n,e||"default");if(Tg(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function lH(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;v5()?Ek(n):e?n():O0(n)}var cH=0;function uH(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Fc(!1),u=Fc(n),g=Fc(null),b=nH()?window.document:void 0,I=e.document,L=I===void 0?b:I,s=e.immediate,$=s===void 0?!0:s,W=e.manual,Q=W===void 0?!1:W,ae=e.name,we=ae===void 0?"style_".concat(++cH):ae,He=e.id,$e=He===void 0?void 0:He,Ne=e.media,wt=Ne===void 0?void 0:Ne,mt=e.nonce,vt=mt===void 0?void 0:mt,zt=e.first,Ct=zt===void 0?!1:zt,qt=e.onMounted,qe=qt===void 0?void 0:qt,be=e.onUpdated,Fe=be===void 0?void 0:be,Je=e.onLoad,Me=Je===void 0?void 0:Je,je=e.props,Ve=je===void 0?{}:je,An=function(){},jn=function(Vr){var On=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(L){var dr=mR(mR({},Ve),On),Zn=dr.name||we,yn=dr.id||$e,kt=dr.nonce||vt;g.value=L.querySelector('style[data-primevue-style-id="'.concat(Zn,'"]'))||L.getElementById(yn)||L.createElement("style"),g.value.isConnected||(u.value=Vr||n,I1(g.value,{type:"text/css",id:yn,media:wt,nonce:kt}),Ct?L.head.prepend(g.value):L.head.appendChild(g.value),iH(g.value,"data-primevue-style-id",Zn),I1(g.value,dr),g.value.onload=function(fr){return Me==null?void 0:Me(fr,{name:Zn})},qe==null||qe(Zn)),!i.value&&(An=Mc(u,function(fr){g.value.textContent=fr,Fe==null||Fe(Zn)},{immediate:!0}),i.value=!0)}},or=function(){!L||!i.value||(An(),rH(g.value)&&L.head.removeChild(g.value),i.value=!1)};return $&&!Q&&lH(jn),{id:$e,name:we,el:g,css:u,unload:or,load:jn,isLoaded:Z1(i)}}function Eg(n){"@babel/helpers - typeof";return Eg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Eg(n)}function gR(n,e){return pH(n)||fH(n,e)||dH(n,e)||hH()}function hH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dH(n,e){if(n){if(typeof n=="string")return _R(n,e);var i={}.toString.call(n).slice(8,-1);return i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set"?Array.from(n):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_R(n,e):void 0}}function _R(n,e){(e==null||e>n.length)&&(e=n.length);for(var i=0,u=Array(e);i<e;i++)u[i]=n[i];return u}function fH(n,e){var i=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(i!=null){var u,g,b,I,L=[],s=!0,$=!1;try{if(b=(i=i.call(n)).next,e!==0)for(;!(s=(u=b.call(i)).done)&&(L.push(u.value),L.length!==e);s=!0);}catch(W){$=!0,g=W}finally{try{if(!s&&i.return!=null&&(I=i.return(),Object(I)!==I))return}finally{if($)throw g}}return L}}function pH(n){if(Array.isArray(n))return n}function yR(n,e){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(n);e&&(u=u.filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable})),i.push.apply(i,u)}return i}function Cx(n){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?yR(Object(i),!0).forEach(function(u){mH(n,u,i[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):yR(Object(i)).forEach(function(u){Object.defineProperty(n,u,Object.getOwnPropertyDescriptor(i,u))})}return n}function mH(n,e,i){return(e=gH(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function gH(n){var e=_H(n,"string");return Eg(e)=="symbol"?e:e+""}function _H(n,e){if(Eg(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var u=i.call(n,e||"default");if(Eg(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}var yH=function(e){var i=e.dt;return`
* {
    box-sizing: border-box;
}

/* Non vue overlay animations */
.p-connected-overlay {
    opacity: 0;
    transform: scaleY(0.8);
    transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1),
        opacity 0.12s cubic-bezier(0, 0, 0.2, 1);
}

.p-connected-overlay-visible {
    opacity: 1;
    transform: scaleY(1);
}

.p-connected-overlay-hidden {
    opacity: 0;
    transform: scaleY(1);
    transition: opacity 0.1s linear;
}

/* Vue based overlay animations */
.p-connected-overlay-enter-from {
    opacity: 0;
    transform: scaleY(0.8);
}

.p-connected-overlay-leave-to {
    opacity: 0;
}

.p-connected-overlay-enter-active {
    transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1),
        opacity 0.12s cubic-bezier(0, 0, 0.2, 1);
}

.p-connected-overlay-leave-active {
    transition: opacity 0.1s linear;
}

/* Toggleable Content */
.p-toggleable-content-enter-from,
.p-toggleable-content-leave-to {
    max-height: 0;
}

.p-toggleable-content-enter-to,
.p-toggleable-content-leave-from {
    max-height: 1000px;
}

.p-toggleable-content-leave-active {
    overflow: hidden;
    transition: max-height 0.45s cubic-bezier(0, 1, 0, 1);
}

.p-toggleable-content-enter-active {
    overflow: hidden;
    transition: max-height 1s ease-in-out;
}

.p-disabled,
.p-disabled * {
    cursor: default;
    pointer-events: none;
    user-select: none;
}

.p-disabled,
.p-component:disabled {
    opacity: `.concat(i("disabled.opacity"),`;
}

.pi {
    font-size: `).concat(i("icon.size"),`;
}

.p-icon {
    width: `).concat(i("icon.size"),`;
    height: `).concat(i("icon.size"),`;
}

.p-overlay-mask {
    background: `).concat(i("mask.background"),`;
    color: `).concat(i("mask.color"),`;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.p-overlay-mask-enter {
    animation: p-overlay-mask-enter-animation `).concat(i("mask.transition.duration"),` forwards;
}

.p-overlay-mask-leave {
    animation: p-overlay-mask-leave-animation `).concat(i("mask.transition.duration"),` forwards;
}

@keyframes p-overlay-mask-enter-animation {
    from {
        background: transparent;
    }
    to {
        background: `).concat(i("mask.background"),`;
    }
}
@keyframes p-overlay-mask-leave-animation {
    from {
        background: `).concat(i("mask.background"),`;
    }
    to {
        background: transparent;
    }
}
`)},vH=function(e){var i=e.dt;return`
.p-hidden-accessible {
    border: 0;
    clip: rect(0 0 0 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
}

.p-hidden-accessible input,
.p-hidden-accessible select {
    transform: scale(0);
}

.p-overflow-hidden {
    overflow: hidden;
    padding-right: `.concat(i("scrollbar.width"),`;
}
`)},bH={},xH={},Dm={name:"base",css:vH,theme:yH,classes:bH,inlineStyles:xH,load:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(b){return b},g=u(rg(e,{dt:Sx}));return g?uH(ng(g),Cx({name:this.name},i)):{}},loadCSS:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.load(this.css,e)},loadTheme:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.load(this.theme,i,function(u){return bs.transformCSS(i.name||e.name,u)})},getCommonTheme:function(e){return bs.getCommon(this.name,e)},getComponentTheme:function(e){return bs.getComponent(this.name,e)},getDirectiveTheme:function(e){return bs.getDirective(this.name,e)},getPresetTheme:function(e,i,u){return bs.getCustomPreset(this.name,e,i,u)},getLayerOrderThemeCSS:function(){return bs.getLayerOrderCSS(this.name)},getStyleSheet:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.css){var u=rg(this.css,{dt:Sx}),g=ng("".concat(u).concat(e)),b=Object.entries(i).reduce(function(I,L){var s=gR(L,2),$=s[0],W=s[1];return I.push("".concat($,'="').concat(W,'"'))&&I},[]).join(" ");return'<style type="text/css" data-primevue-style-id="'.concat(this.name,'" ').concat(b,">").concat(g,"</style>")}return""},getCommonThemeStyleSheet:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return bs.getCommonStyleSheet(this.name,e,i)},getThemeStyleSheet:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=[bs.getStyleSheet(this.name,e,i)];if(this.theme){var g=this.name==="base"?"global-style":"".concat(this.name,"-style"),b=rg(this.theme,{dt:Sx}),I=ng(bs.transformCSS(g,b)),L=Object.entries(i).reduce(function(s,$){var W=gR($,2),Q=W[0],ae=W[1];return s.push("".concat(Q,'="').concat(ae,'"'))&&s},[]).join(" ");u.push('<style type="text/css" data-primevue-style-id="'.concat(g,'" ').concat(L,">").concat(I,"</style>"))}return u.join("")},extend:function(e){return Cx(Cx({},this),{},{css:void 0,theme:void 0},e)}},Cy=QD();function Ig(n){"@babel/helpers - typeof";return Ig=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ig(n)}function vR(n,e){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(n);e&&(u=u.filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable})),i.push.apply(i,u)}return i}function Rx(n){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?vR(Object(i),!0).forEach(function(u){wH(n,u,i[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):vR(Object(i)).forEach(function(u){Object.defineProperty(n,u,Object.getOwnPropertyDescriptor(i,u))})}return n}function wH(n,e,i){return(e=TH(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function TH(n){var e=EH(n,"string");return Ig(e)=="symbol"?e:e+""}function EH(n,e){if(Ig(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var u=i.call(n,e||"default");if(Ig(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}var IH={ripple:!1,inputStyle:null,inputVariant:null,locale:{startsWith:"Starts with",contains:"Contains",notContains:"Not contains",endsWith:"Ends with",equals:"Equals",notEquals:"Not equals",noFilter:"No Filter",lt:"Less than",lte:"Less than or equal to",gt:"Greater than",gte:"Greater than or equal to",dateIs:"Date is",dateIsNot:"Date is not",dateBefore:"Date is before",dateAfter:"Date is after",clear:"Clear",apply:"Apply",matchAll:"Match All",matchAny:"Match Any",addRule:"Add Rule",removeRule:"Remove Rule",accept:"Yes",reject:"No",choose:"Choose",upload:"Upload",cancel:"Cancel",completed:"Completed",pending:"Pending",fileSizeTypes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],chooseYear:"Choose Year",chooseMonth:"Choose Month",chooseDate:"Choose Date",prevDecade:"Previous Decade",nextDecade:"Next Decade",prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",prevHour:"Previous Hour",nextHour:"Next Hour",prevMinute:"Previous Minute",nextMinute:"Next Minute",prevSecond:"Previous Second",nextSecond:"Next Second",am:"am",pm:"pm",today:"Today",weekHeader:"Wk",firstDayOfWeek:0,showMonthAfterYear:!1,dateFormat:"mm/dd/yy",weak:"Weak",medium:"Medium",strong:"Strong",passwordPrompt:"Enter a password",emptyFilterMessage:"No results found",searchMessage:"{0} results are available",selectionMessage:"{0} items selected",emptySelectionMessage:"No selected item",emptySearchMessage:"No results found",fileChosenMessage:"{0} files",noFileChosenMessage:"No file chosen",emptyMessage:"No available options",aria:{trueLabel:"True",falseLabel:"False",nullLabel:"Not Selected",star:"1 star",stars:"{star} stars",selectAll:"All items selected",unselectAll:"All items unselected",close:"Close",previous:"Previous",next:"Next",navigation:"Navigation",scrollTop:"Scroll Top",moveTop:"Move Top",moveUp:"Move Up",moveDown:"Move Down",moveBottom:"Move Bottom",moveToTarget:"Move to Target",moveToSource:"Move to Source",moveAllToTarget:"Move All to Target",moveAllToSource:"Move All to Source",pageLabel:"Page {page}",firstPageLabel:"First Page",lastPageLabel:"Last Page",nextPageLabel:"Next Page",prevPageLabel:"Previous Page",rowsPerPageLabel:"Rows per page",jumpToPageDropdownLabel:"Jump to Page Dropdown",jumpToPageInputLabel:"Jump to Page Input",selectRow:"Row Selected",unselectRow:"Row Unselected",expandRow:"Row Expanded",collapseRow:"Row Collapsed",showFilterMenu:"Show Filter Menu",hideFilterMenu:"Hide Filter Menu",filterOperator:"Filter Operator",filterConstraint:"Filter Constraint",editRow:"Row Edit",saveEdit:"Save Edit",cancelEdit:"Cancel Edit",listView:"List View",gridView:"Grid View",slide:"Slide",slideNumber:"{slideNumber}",zoomImage:"Zoom Image",zoomIn:"Zoom In",zoomOut:"Zoom Out",rotateRight:"Rotate Right",rotateLeft:"Rotate Left",listLabel:"Option List"}},filterMatchModeOptions:{text:[vs.STARTS_WITH,vs.CONTAINS,vs.NOT_CONTAINS,vs.ENDS_WITH,vs.EQUALS,vs.NOT_EQUALS],numeric:[vs.EQUALS,vs.NOT_EQUALS,vs.LESS_THAN,vs.LESS_THAN_OR_EQUAL_TO,vs.GREATER_THAN,vs.GREATER_THAN_OR_EQUAL_TO],date:[vs.DATE_IS,vs.DATE_IS_NOT,vs.DATE_BEFORE,vs.DATE_AFTER]},zIndex:{modal:1100,overlay:1e3,menu:1e3,tooltip:1100},theme:void 0,unstyled:!1,pt:void 0,ptOptions:{mergeSections:!0,mergeProps:!1},csp:{nonce:void 0}},AH=Symbol();function SH(n,e){var i={config:Rg(e)};return n.config.globalProperties.$primevue=i,n.provide(AH,i),CH(),RH(n,i),i}var xf=[];function CH(){Pc.clear(),xf.forEach(function(n){return n==null?void 0:n()}),xf=[]}function RH(n,e){var i=Fc(!1),u=function(){if(!bs.isStyleNameLoaded("common")){var $,W,Q=(($=Dm.getCommonTheme)===null||$===void 0?void 0:$.call(Dm))||{},ae=Q.primitive,we=Q.semantic,He={nonce:(W=e.config)===null||W===void 0||(W=W.csp)===null||W===void 0?void 0:W.nonce};Dm.load(ae==null?void 0:ae.css,Rx({name:"primitive-variables"},He)),Dm.load(we==null?void 0:we.css,Rx({name:"semantic-variables"},He)),Dm.loadTheme(Rx({name:"global-style"},He)),bs.setLoadedStyleName("common")}};Pc.on("theme:change",function(s){i.value||(n.config.globalProperties.$primevue.config.theme=s,i.value=!0)});var g=Mc(e.config,function(s,$){Cy.emit("config:change",{newValue:s,oldValue:$})},{immediate:!0,deep:!0}),b=Mc(function(){return e.config.ripple},function(s,$){Cy.emit("config:ripple:change",{newValue:s,oldValue:$})},{immediate:!0,deep:!0}),I=Mc(function(){return e.config.theme},function(s,$){i.value||bs.setTheme(s),e.config.unstyled||u(),i.value=!1,Cy.emit("config:theme:change",{newValue:s,oldValue:$})},{immediate:!0,deep:!0}),L=Mc(function(){return e.config.unstyled},function(s,$){!s&&e.config.theme&&u(),Cy.emit("config:unstyled:change",{newValue:s,oldValue:$})},{immediate:!0,deep:!0});xf.push(g),xf.push(b),xf.push(I),xf.push(L)}var kH={install:function(e,i){var u=G7(IH,i);SH(e,u)}},PH={root:{transitionDuration:"{transition.duration}"},panel:{borderWidth:"0 0 1px 0",borderColor:"{content.border.color}"},header:{color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{text.color}",padding:"1.125rem",fontWeight:"600",borderRadius:"0",borderWidth:"0",borderColor:"{content.border.color}",background:"{content.background}",hoverBackground:"{content.background}",activeBackground:"{content.background}",activeHoverBackground:"{content.background}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},toggleIcon:{color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{text.color}",activeHoverColor:"{text.color}"},first:{topBorderRadius:"{content.border.radius}",borderWidth:"0"},last:{bottomBorderRadius:"{content.border.radius}",activeBottomBorderRadius:"0"}},content:{borderWidth:"0",borderColor:"{content.border.color}",background:"{content.background}",color:"{text.color}",padding:"0 1.125rem 1.125rem 1.125rem"}},MH={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},list:{padding:"{list.padding}",gap:"{list.gap}"},option:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},optionGroup:{background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},dropdown:{width:"2.5rem",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},chip:{borderRadius:"{border.radius.sm}"},emptyMessage:{padding:"{list.option.padding}"},colorScheme:{light:{dropdown:{background:"{surface.100}",hoverBackground:"{surface.200}",activeBackground:"{surface.300}",color:"{surface.600}",hoverColor:"{surface.700}",activeColor:"{surface.800}"}},dark:{dropdown:{background:"{surface.800}",hoverBackground:"{surface.700}",activeBackground:"{surface.600}",color:"{surface.300}",hoverColor:"{surface.200}",activeColor:"{surface.100}"}}}},DH={root:{width:"2rem",height:"2rem",fontSize:"1rem",background:"{content.border.color}",borderRadius:"{content.border.radius}"},group:{borderColor:"{content.background}",offset:"-1rem"},lg:{width:"3rem",height:"3rem",fontSize:"1.5rem"},xl:{width:"4rem",height:"4rem",fontSize:"2rem"}},LH={root:{borderRadius:"{border.radius.md}",padding:"0 0.5rem",fontSize:"0.75rem",fontWeight:"700",minWidth:"1.5rem",height:"1.5rem"},dot:{size:"0.5rem"},sm:{fontSize:"0.625rem",minWidth:"1.25rem",height:"1.25rem"},lg:{fontSize:"0.875rem",minWidth:"1.75rem",height:"1.75rem"},xl:{fontSize:"1rem",minWidth:"2rem",height:"2rem"},colorScheme:{light:{primary:{background:"{primary.color}",color:"{primary.contrast.color}"},secondary:{background:"{surface.100}",color:"{surface.600}"},success:{background:"{green.500}",color:"{surface.0}"},info:{background:"{sky.500}",color:"{surface.0}"},warn:{background:"{orange.500}",color:"{surface.0}"},danger:{background:"{red.500}",color:"{surface.0}"},contrast:{background:"{surface.950}",color:"{surface.0}"}},dark:{primary:{background:"{primary.color}",color:"{primary.contrast.color}"},secondary:{background:"{surface.800}",color:"{surface.300}"},success:{background:"{green.400}",color:"{green.950}"},info:{background:"{sky.400}",color:"{sky.950}"},warn:{background:"{orange.400}",color:"{orange.950}"},danger:{background:"{red.400}",color:"{red.950}"},contrast:{background:"{surface.0}",color:"{surface.950}"}}}},OH={root:{borderRadius:"{content.border.radius}"}},BH={root:{padding:"1rem",background:"{content.background}",gap:"0.5rem",transitionDuration:"{transition.duration}"},item:{color:"{text.muted.color}",hoverColor:"{text.color}",borderRadius:"{content.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",hoverColor:"{navigation.item.icon.focus.color}"},focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},separator:{color:"{navigation.item.icon.color}"}},zH={root:{borderRadius:"{form.field.border.radius}",roundedBorderRadius:"2rem",gap:"0.5rem",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",iconOnlyWidth:"2.5rem",sm:{fontSize:"0.875rem",paddingX:"0.625rem",paddingY:"0.375rem"},lg:{fontSize:"1.125rem",paddingX:"0.875rem",paddingY:"0.625rem"},label:{fontWeight:"500"},raisedShadow:"0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12)",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",offset:"{focus.ring.offset}"},badgeSize:"1rem",transitionDuration:"{form.field.transition.duration}"},colorScheme:{light:{root:{primary:{background:"{primary.color}",hoverBackground:"{primary.hover.color}",activeBackground:"{primary.active.color}",borderColor:"{primary.color}",hoverBorderColor:"{primary.hover.color}",activeBorderColor:"{primary.active.color}",color:"{primary.contrast.color}",hoverColor:"{primary.contrast.color}",activeColor:"{primary.contrast.color}",focusRing:{color:"{primary.color}",shadow:"none"}},secondary:{background:"{surface.100}",hoverBackground:"{surface.200}",activeBackground:"{surface.300}",borderColor:"{surface.100}",hoverBorderColor:"{surface.200}",activeBorderColor:"{surface.300}",color:"{surface.600}",hoverColor:"{surface.700}",activeColor:"{surface.800}",focusRing:{color:"{surface.600}",shadow:"none"}},info:{background:"{sky.500}",hoverBackground:"{sky.600}",activeBackground:"{sky.700}",borderColor:"{sky.500}",hoverBorderColor:"{sky.600}",activeBorderColor:"{sky.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{sky.500}",shadow:"none"}},success:{background:"{green.500}",hoverBackground:"{green.600}",activeBackground:"{green.700}",borderColor:"{green.500}",hoverBorderColor:"{green.600}",activeBorderColor:"{green.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{green.500}",shadow:"none"}},warn:{background:"{orange.500}",hoverBackground:"{orange.600}",activeBackground:"{orange.700}",borderColor:"{orange.500}",hoverBorderColor:"{orange.600}",activeBorderColor:"{orange.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{orange.500}",shadow:"none"}},help:{background:"{purple.500}",hoverBackground:"{purple.600}",activeBackground:"{purple.700}",borderColor:"{purple.500}",hoverBorderColor:"{purple.600}",activeBorderColor:"{purple.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{purple.500}",shadow:"none"}},danger:{background:"{red.500}",hoverBackground:"{red.600}",activeBackground:"{red.700}",borderColor:"{red.500}",hoverBorderColor:"{red.600}",activeBorderColor:"{red.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{red.500}",shadow:"none"}},contrast:{background:"{surface.950}",hoverBackground:"{surface.900}",activeBackground:"{surface.800}",borderColor:"{surface.950}",hoverBorderColor:"{surface.900}",activeBorderColor:"{surface.800}",color:"{surface.0}",hoverColor:"{surface.0}",activeColor:"{surface.0}",focusRing:{color:"{surface.950}",shadow:"none"}}},outlined:{primary:{hoverBackground:"{primary.50}",activeBackground:"{primary.100}",borderColor:"{primary.200}",color:"{primary.color}"},secondary:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",borderColor:"{surface.200}",color:"{surface.500}"},success:{hoverBackground:"{green.50}",activeBackground:"{green.100}",borderColor:"{green.200}",color:"{green.500}"},info:{hoverBackground:"{sky.50}",activeBackground:"{sky.100}",borderColor:"{sky.200}",color:"{sky.500}"},warn:{hoverBackground:"{orange.50}",activeBackground:"{orange.100}",borderColor:"{orange.200}",color:"{orange.500}"},help:{hoverBackground:"{purple.50}",activeBackground:"{purple.100}",borderColor:"{purple.200}",color:"{purple.500}"},danger:{hoverBackground:"{red.50}",activeBackground:"{red.100}",borderColor:"{red.200}",color:"{red.500}"},contrast:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",borderColor:"{surface.700}",color:"{surface.950}"},plain:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",borderColor:"{surface.200}",color:"{surface.700}"}},text:{primary:{hoverBackground:"{primary.50}",activeBackground:"{primary.100}",color:"{primary.color}"},secondary:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",color:"{surface.500}"},success:{hoverBackground:"{green.50}",activeBackground:"{green.100}",color:"{green.500}"},info:{hoverBackground:"{sky.50}",activeBackground:"{sky.100}",color:"{sky.500}"},warn:{hoverBackground:"{orange.50}",activeBackground:"{orange.100}",color:"{orange.500}"},help:{hoverBackground:"{purple.50}",activeBackground:"{purple.100}",color:"{purple.500}"},danger:{hoverBackground:"{red.50}",activeBackground:"{red.100}",color:"{red.500}"},plain:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",color:"{surface.700}"}},link:{color:"{primary.color}",hoverColor:"{primary.color}",activeColor:"{primary.color}"}},dark:{root:{primary:{background:"{primary.color}",hoverBackground:"{primary.hover.color}",activeBackground:"{primary.active.color}",borderColor:"{primary.color}",hoverBorderColor:"{primary.hover.color}",activeBorderColor:"{primary.active.color}",color:"{primary.contrast.color}",hoverColor:"{primary.contrast.color}",activeColor:"{primary.contrast.color}",focusRing:{color:"{primary.color}",shadow:"none"}},secondary:{background:"{surface.800}",hoverBackground:"{surface.700}",activeBackground:"{surface.600}",borderColor:"{surface.800}",hoverBorderColor:"{surface.700}",activeBorderColor:"{surface.600}",color:"{surface.300}",hoverColor:"{surface.200}",activeColor:"{surface.100}",focusRing:{color:"{surface.300}",shadow:"none"}},info:{background:"{sky.400}",hoverBackground:"{sky.300}",activeBackground:"{sky.200}",borderColor:"{sky.400}",hoverBorderColor:"{sky.300}",activeBorderColor:"{sky.200}",color:"{sky.950}",hoverColor:"{sky.950}",activeColor:"{sky.950}",focusRing:{color:"{sky.400}",shadow:"none"}},success:{background:"{green.400}",hoverBackground:"{green.300}",activeBackground:"{green.200}",borderColor:"{green.400}",hoverBorderColor:"{green.300}",activeBorderColor:"{green.200}",color:"{green.950}",hoverColor:"{green.950}",activeColor:"{green.950}",focusRing:{color:"{green.400}",shadow:"none"}},warn:{background:"{orange.400}",hoverBackground:"{orange.300}",activeBackground:"{orange.200}",borderColor:"{orange.400}",hoverBorderColor:"{orange.300}",activeBorderColor:"{orange.200}",color:"{orange.950}",hoverColor:"{orange.950}",activeColor:"{orange.950}",focusRing:{color:"{orange.400}",shadow:"none"}},help:{background:"{purple.400}",hoverBackground:"{purple.300}",activeBackground:"{purple.200}",borderColor:"{purple.400}",hoverBorderColor:"{purple.300}",activeBorderColor:"{purple.200}",color:"{purple.950}",hoverColor:"{purple.950}",activeColor:"{purple.950}",focusRing:{color:"{purple.400}",shadow:"none"}},danger:{background:"{red.400}",hoverBackground:"{red.300}",activeBackground:"{red.200}",borderColor:"{red.400}",hoverBorderColor:"{red.300}",activeBorderColor:"{red.200}",color:"{red.950}",hoverColor:"{red.950}",activeColor:"{red.950}",focusRing:{color:"{red.400}",shadow:"none"}},contrast:{background:"{surface.0}",hoverBackground:"{surface.100}",activeBackground:"{surface.200}",borderColor:"{surface.0}",hoverBorderColor:"{surface.100}",activeBorderColor:"{surface.200}",color:"{surface.950}",hoverColor:"{surface.950}",activeColor:"{surface.950}",focusRing:{color:"{surface.0}",shadow:"none"}}},outlined:{primary:{hoverBackground:"color-mix(in srgb, {primary.color}, transparent 96%)",activeBackground:"color-mix(in srgb, {primary.color}, transparent 84%)",borderColor:"{primary.700}",color:"{primary.color}"},secondary:{hoverBackground:"rgba(255,255,255,0.04)",activeBackground:"rgba(255,255,255,0.16)",borderColor:"{surface.700}",color:"{surface.400}"},success:{hoverBackground:"color-mix(in srgb, {green.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {green.400}, transparent 84%)",borderColor:"{green.700}",color:"{green.400}"},info:{hoverBackground:"color-mix(in srgb, {sky.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {sky.400}, transparent 84%)",borderColor:"{sky.700}",color:"{sky.400}"},warn:{hoverBackground:"color-mix(in srgb, {orange.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {orange.400}, transparent 84%)",borderColor:"{orange.700}",color:"{orange.400}"},help:{hoverBackground:"color-mix(in srgb, {purple.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {purple.400}, transparent 84%)",borderColor:"{purple.700}",color:"{purple.400}"},danger:{hoverBackground:"color-mix(in srgb, {red.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {red.400}, transparent 84%)",borderColor:"{red.700}",color:"{red.400}"},contrast:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",borderColor:"{surface.500}",color:"{surface.0}"},plain:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",borderColor:"{surface.600}",color:"{surface.0}"}},text:{primary:{hoverBackground:"color-mix(in srgb, {primary.color}, transparent 96%)",activeBackground:"color-mix(in srgb, {primary.color}, transparent 84%)",color:"{primary.color}"},secondary:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",color:"{surface.400}"},success:{hoverBackground:"color-mix(in srgb, {green.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {green.400}, transparent 84%)",color:"{green.400}"},info:{hoverBackground:"color-mix(in srgb, {sky.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {sky.400}, transparent 84%)",color:"{sky.400}"},warn:{hoverBackground:"color-mix(in srgb, {orange.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {orange.400}, transparent 84%)",color:"{orange.400}"},help:{hoverBackground:"color-mix(in srgb, {purple.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {purple.400}, transparent 84%)",color:"{purple.400}"},danger:{hoverBackground:"color-mix(in srgb, {red.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {red.400}, transparent 84%)",color:"{red.400}"},plain:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",color:"{surface.0}"}},link:{color:"{primary.color}",hoverColor:"{primary.color}",activeColor:"{primary.color}"}}}},FH={root:{background:"{content.background}",borderRadius:"{border.radius.xl}",color:"{content.color}",shadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)"},body:{padding:"1.25rem",gap:"0.5rem"},caption:{gap:"0.5rem"},title:{fontSize:"1.25rem",fontWeight:"500"},subtitle:{color:"{text.muted.color}"}},NH={root:{transitionDuration:"{transition.duration}"},content:{gap:"0.25rem"},indicatorList:{padding:"1rem",gap:"0.5rem"},indicator:{width:"2rem",height:"0.5rem",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},colorScheme:{light:{indicator:{background:"{surface.200}",hoverBackground:"{surface.300}",activeBackground:"{primary.color}"}},dark:{indicator:{background:"{surface.700}",hoverBackground:"{surface.600}",activeBackground:"{primary.color}"}}}},VH={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},dropdown:{width:"2.5rem",color:"{form.field.icon.color}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},list:{padding:"{list.padding}",gap:"{list.gap}"},option:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}",icon:{color:"{list.option.icon.color}",focusColor:"{list.option.icon.focus.color}",size:"0.875rem"}}},UH={root:{borderRadius:"{border.radius.sm}",width:"1.25rem",height:"1.25rem",background:"{form.field.background}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.border.color}",checkedBorderColor:"{primary.color}",checkedHoverBorderColor:"{primary.hover.color}",checkedFocusBorderColor:"{primary.color}",checkedDisabledBorderColor:"{form.field.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",shadow:"{form.field.shadow}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},icon:{size:"0.875rem",color:"{form.field.color}",checkedColor:"{primary.contrast.color}",checkedHoverColor:"{primary.contrast.color}",disabledColor:"{form.field.disabled.color}"}},jH={root:{borderRadius:"16px",paddingX:"0.75rem",paddingY:"0.5rem",gap:"0.5rem",transitionDuration:"{transition.duration}"},image:{width:"2rem",height:"2rem"},icon:{size:"1rem"},removeIcon:{size:"1rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"}},colorScheme:{light:{root:{background:"{surface.100}",color:"{surface.800}"},icon:{color:"{surface.800}"},removeIcon:{color:"{surface.800}"}},dark:{root:{background:"{surface.800}",color:"{surface.0}"},icon:{color:"{surface.0}"},removeIcon:{color:"{surface.0}"}}}},$H={root:{transitionDuration:"{transition.duration}"},preview:{width:"1.5rem",height:"1.5rem",borderRadius:"{form.field.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},panel:{shadow:"{overlay.popover.shadow}",borderRadius:"{overlay.popover.borderRadius}"},colorScheme:{light:{panel:{background:"{surface.800}",borderColor:"{surface.900}"},handle:{color:"{surface.0}"}},dark:{panel:{background:"{surface.900}",borderColor:"{surface.700}"},handle:{color:"{surface.0}"}}}},qH={icon:{size:"2rem",color:"{overlay.modal.color}"},content:{gap:"1rem"}},GH={root:{background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",color:"{overlay.popover.color}",borderRadius:"{overlay.popover.border.radius}",shadow:"{overlay.popover.shadow}",gutter:"10px",arrowOffset:"1.25rem"},content:{padding:"{overlay.popover.padding}",gap:"1rem"},icon:{size:"1.5rem",color:"{overlay.popover.color}"},footer:{gap:"0.5rem",padding:"0 {overlay.popover.padding} {overlay.popover.padding} {overlay.popover.padding}"}},HH={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",transitionDuration:"{transition.duration}"},list:{padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},item:{focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},submenuIcon:{size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"},separator:{borderColor:"{content.border.color}"}},WH={root:{transitionDuration:"{transition.duration}"},header:{background:"{content.background}",borderColor:"{datatable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem"},headerCell:{background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",borderColor:"{datatable.border.color}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",gap:"0.5rem",padding:"0.75rem 1rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},columnTitle:{fontWeight:"600"},row:{background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},bodyCell:{borderColor:"{datatable.border.color}",padding:"0.75rem 1rem"},footerCell:{background:"{content.background}",borderColor:"{datatable.border.color}",color:"{content.color}",padding:"0.75rem 1rem"},columnFooter:{fontWeight:"600"},footer:{background:"{content.background}",borderColor:"{datatable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem"},dropPointColor:"{primary.color}",columnResizerWidth:"0.5rem",resizeIndicator:{width:"1px",color:"{primary.color}"},sortIcon:{color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}"},loadingIcon:{size:"2rem"},rowToggleButton:{hoverBackground:"{content.hover.background}",selectedHoverBackground:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}",selectedHoverColor:"{primary.color}",size:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},filter:{inlineGap:"0.5rem",overlaySelect:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},overlayPopover:{background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",borderRadius:"{overlay.popover.border.radius}",color:"{overlay.popover.color}",shadow:"{overlay.popover.shadow}",padding:"{overlay.popover.padding}",gap:"0.5rem"},rule:{borderColor:"{content.border.color}"},constraintList:{padding:"{list.padding}",gap:"{list.gap}"},constraint:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",separator:{borderColor:"{content.border.color}"},padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"}},paginatorTop:{borderColor:"{datatable.border.color}",borderWidth:"0 0 1px 0"},paginatorBottom:{borderColor:"{datatable.border.color}",borderWidth:"0 0 1px 0"},colorScheme:{light:{root:{borderColor:"{content.border.color}"},row:{stripedBackground:"{surface.50}"},bodyCell:{selectedBorderColor:"{primary.100}"}},dark:{root:{borderColor:"{surface.800}"},row:{stripedBackground:"{surface.950}"},bodyCell:{selectedBorderColor:"{primary.900}"}}}},ZH={root:{borderColor:"transparent",borderWidth:"0",borderRadius:"0",padding:"0"},header:{background:"{content.background}",color:"{content.color}",borderColor:"{content.border.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem",borderRadius:"0"},content:{background:"{content.background}",color:"{content.color}",borderColor:"transparent",borderWidth:"0",padding:"0",borderRadius:"0"},footer:{background:"{content.background}",color:"{content.color}",borderColor:"{content.border.color}",borderWidth:"1px 0 0 0",padding:"0.75rem 1rem",borderRadius:"0"},paginatorTop:{borderColor:"{content.border.color}",borderWidth:"0 0 1px 0"},paginatorBottom:{borderColor:"{content.border.color}",borderWidth:"1px 0 0 0"}},XH={root:{transitionDuration:"{transition.duration}"},panel:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.popover.shadow}",padding:"{overlay.popover.padding}"},header:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",padding:"0 0 0.5rem 0",fontWeight:"500",gap:"0.5rem"},title:{gap:"0.5rem",fontWeight:"500"},dropdown:{width:"2.5rem",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},inputIcon:{color:"{form.field.icon.color}"},selectMonth:{hoverBackground:"{content.hover.background}",color:"{content.color}",hoverColor:"{content.hover.color}",padding:"0.25rem 0.5rem",borderRadius:"{content.border.radius}"},selectYear:{hoverBackground:"{content.hover.background}",color:"{content.color}",hoverColor:"{content.hover.color}",padding:"0.25rem 0.5rem",borderRadius:"{content.border.radius}"},group:{borderColor:"{content.border.color}",gap:"{overlay.popover.padding}"},dayView:{margin:"0.5rem 0 0 0"},weekDay:{padding:"0.25rem",fontWeight:"500",color:"{content.color}"},date:{hoverBackground:"{content.hover.background}",selectedBackground:"{primary.color}",rangeSelectedBackground:"{highlight.background}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{primary.contrast.color}",rangeSelectedColor:"{highlight.color}",width:"2rem",height:"2rem",borderRadius:"50%",padding:"0.25rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},monthView:{margin:"0.5rem 0 0 0"},month:{borderRadius:"{content.border.radius}"},yearView:{margin:"0.5rem 0 0 0"},year:{borderRadius:"{content.border.radius}"},buttonbar:{padding:"0.5rem 0 0 0",borderColor:"{content.border.color}"},timePicker:{padding:"0.5rem 0 0 0",borderColor:"{content.border.color}",gap:"0.5rem",buttonGap:"0.25rem"},colorScheme:{light:{dropdown:{background:"{surface.100}",hoverBackground:"{surface.200}",activeBackground:"{surface.300}",color:"{surface.600}",hoverColor:"{surface.700}",activeColor:"{surface.800}"},today:{background:"{surface.200}",color:"{surface.900}"}},dark:{dropdown:{background:"{surface.800}",hoverBackground:"{surface.700}",activeBackground:"{surface.600}",color:"{surface.300}",hoverColor:"{surface.200}",activeColor:"{surface.100}"},today:{background:"{surface.700}",color:"{surface.0}"}}}},KH={root:{background:"{overlay.modal.background}",borderColor:"{overlay.modal.border.color}",color:"{overlay.modal.color}",borderRadius:"{overlay.modal.border.radius}",shadow:"{overlay.modal.shadow}"},header:{padding:"{overlay.modal.padding}",gap:"0.5rem"},title:{fontSize:"1.25rem",fontWeight:"600"},content:{padding:"0 {overlay.modal.padding} {overlay.modal.padding} {overlay.modal.padding}"},footer:{padding:"0 {overlay.modal.padding} {overlay.modal.padding} {overlay.modal.padding}",gap:"0.5rem"}},YH={root:{borderColor:"{content.border.color}"},content:{background:"{content.background}",color:"{text.color}"},horizontal:{margin:"1rem 0",padding:"0 1rem",content:{padding:"0 0.5rem"}},vertical:{margin:"0 1rem",padding:"0.5rem 0",content:{padding:"0.5rem 0"}}},JH={root:{background:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)",padding:"0.5rem",borderRadius:"{border.radius.xl}"},item:{borderRadius:"{content.border.radius}",padding:"0.5rem",size:"3rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}}},QH={root:{background:"{overlay.modal.background}",borderColor:"{overlay.modal.border.color}",color:"{overlay.modal.color}",borderRadius:"{overlay.modal.border.radius}",shadow:"{overlay.modal.shadow}"},header:{padding:"{overlay.modal.padding}"},title:{fontSize:"1.5rem",fontWeight:"600"},content:{padding:"0 {overlay.modal.padding} {overlay.modal.padding} {overlay.modal.padding}"}},eW={toolbar:{background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}"},toolbarItem:{color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}",padding:"{list.padding}"},overlayOption:{focusBackground:"{list.option.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},content:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}"}},tW={root:{background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",padding:"0 1.125rem 1.125rem 1.125rem",transitionDuration:"{transition.duration}"},legend:{background:"{content.background}",hoverBackground:"{content.hover.background}",color:"{content.color}",hoverColor:"{content.hover.color}",borderRadius:"{content.border.radius}",borderWidth:"1px",borderColor:"transparent",padding:"0.5rem 0.75rem",gap:"0.5rem",fontWeight:"600",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},toggleIcon:{color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}"},content:{padding:"0"}},rW={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",transitionDuration:"{transition.duration}"},header:{background:"transparent",color:"{text.color}",padding:"1.125rem",borderWidth:"0",borderRadius:"0",gap:"0.5rem"},content:{highlightBorderColor:"{primary.color}",padding:"0 1.125rem 1.125rem 1.125rem"},file:{padding:"1rem",gap:"1rem",borderColor:"{content.border.color}",info:{gap:"0.5rem"}},progressbar:{height:"0.25rem"},basic:{gap:"0.5rem"}},nW={root:{color:"{form.field.float.label.color}",focusColor:"{form.field.float.label.focus.color}",invalidColor:"{form.field.float.label.invalid.color}",transitionDuration:"0.2s"}},iW={root:{borderWidth:"1px",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",transitionDuration:"{transition.duration}"},navButton:{background:"rgba(255, 255, 255, 0.1)",hoverBackground:"rgba(255, 255, 255, 0.2)",color:"{surface.100}",hoverColor:"{surface.0}",size:"3rem",gutter:"0.5rem",prev:{borderRadius:"50%"},next:{borderRadius:"50%"},focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},navIcon:{size:"1.5rem"},thumbnailsContent:{background:"{content.background}",padding:"1rem 0.25rem"},thumbnailNavButton:{size:"2rem",borderRadius:"{content.border.radius}",gutter:"0.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},thumbnailNavButtonIcon:{size:"1rem"},caption:{background:"rgba(0, 0, 0, 0.5)",color:"{surface.100}",padding:"1rem"},indicatorList:{gap:"0.5rem",padding:"1rem"},indicatorButton:{width:"1rem",height:"1rem",activeBackground:"{primary.color}",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},insetIndicatorList:{background:"rgba(0, 0, 0, 0.5)"},insetIndicatorButton:{background:"rgba(255, 255, 255, 0.4)",hoverBackground:"rgba(255, 255, 255, 0.6)",activeBackground:"rgba(255, 255, 255, 0.9)"},mask:{background:"{mask.background}",color:"{mask.color}"},closeButton:{size:"3rem",gutter:"0.5rem",background:"rgba(255, 255, 255, 0.1)",hoverBackground:"rgba(255, 255, 255, 0.2)",color:"{surface.50}",hoverColor:"{surface.0}",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},closeButtonIcon:{size:"1.5rem"},colorScheme:{light:{thumbnailNavButton:{hoverBackground:"{surface.100}",color:"{surface.600}",hoverColor:"{surface.700}"},indicatorButton:{background:"{surface.200}",hoverBackground:"{surface.300}"}},dark:{thumbnailNavButton:{hoverBackground:"{surface.700}",color:"{surface.400}",hoverColor:"{surface.0}"},indicatorButton:{background:"{surface.700}",hoverBackground:"{surface.600}"}}}},oW={icon:{color:"{form.field.icon.color}"}},sW={root:{transitionDuration:"{transition.duration}"},preview:{icon:{size:"1.5rem"},mask:{background:"{mask.background}",color:"{mask.color}"}},toolbar:{position:{left:"auto",right:"1rem",top:"1rem",bottom:"auto"},blur:"8px",background:"rgba(255,255,255,0.1)",borderColor:"rgba(255,255,255,0.2)",borderWidth:"1px",borderRadius:"30px",padding:".5rem",gap:"0.5rem"},action:{hoverBackground:"rgba(255,255,255,0.1)",color:"{surface.50}",hoverColor:"{surface.0}",size:"3rem",iconSize:"1.5rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}}},aW={root:{padding:"{form.field.padding.y} {form.field.padding.x}",borderRadius:"{content.border.radius}",gap:"0.5rem"},text:{fontWeight:"500"},icon:{size:"1rem"},colorScheme:{light:{info:{background:"color-mix(in srgb, {blue.50}, transparent 5%)",borderColor:"{blue.200}",color:"{blue.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)"},success:{background:"color-mix(in srgb, {green.50}, transparent 5%)",borderColor:"{green.200}",color:"{green.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)"},warn:{background:"color-mix(in srgb,{yellow.50}, transparent 5%)",borderColor:"{yellow.200}",color:"{yellow.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)"},error:{background:"color-mix(in srgb, {red.50}, transparent 5%)",borderColor:"{red.200}",color:"{red.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)"},secondary:{background:"{surface.100}",borderColor:"{surface.200}",color:"{surface.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)"},contrast:{background:"{surface.900}",borderColor:"{surface.950}",color:"{surface.50}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)"}},dark:{info:{background:"color-mix(in srgb, {blue.500}, transparent 84%)",borderColor:"color-mix(in srgb, {blue.700}, transparent 64%)",color:"{blue.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)"},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",borderColor:"color-mix(in srgb, {green.700}, transparent 64%)",color:"{green.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)"},warn:{background:"color-mix(in srgb, {yellow.500}, transparent 84%)",borderColor:"color-mix(in srgb, {yellow.700}, transparent 64%)",color:"{yellow.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)"},error:{background:"color-mix(in srgb, {red.500}, transparent 84%)",borderColor:"color-mix(in srgb, {red.700}, transparent 64%)",color:"{red.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)"},secondary:{background:"{surface.800}",borderColor:"{surface.700}",color:"{surface.300}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)"},contrast:{background:"{surface.0}",borderColor:"{surface.100}",color:"{surface.950}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)"}}}},lW={root:{padding:"{form.field.padding.y} {form.field.padding.x}",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{transition.duration}"},display:{hoverBackground:"{content.hover.background}",hoverColor:"{content.hover.color}"}},cW={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},chip:{borderRadius:"{border.radius.sm}"},colorScheme:{light:{chip:{focusBackground:"{surface.200}",color:"{surface.800}"}},dark:{chip:{focusBackground:"{surface.700}",color:"{surface.0}"}}}},uW={addon:{background:"{form.field.background}",borderColor:"{form.field.border.color}",color:"{form.field.icon.color}",borderRadius:"{form.field.border.radius}"}},hW={root:{transitionDuration:"{transition.duration}"},button:{width:"2.5rem",borderRadius:"{form.field.border.radius}",verticalPadding:"{form.field.padding.y}"},colorScheme:{light:{button:{background:"transparent",hoverBackground:"{surface.100}",activeBackground:"{surface.200}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",color:"{surface.400}",hoverColor:"{surface.500}",activeColor:"{surface.600}"}},dark:{button:{background:"transparent",hoverBackground:"{surface.800}",activeBackground:"{surface.700}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",color:"{surface.400}",hoverColor:"{surface.300}",activeColor:"{surface.200}"}}}},dW={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}",sm:{fontSize:"0.875rem",paddingX:"0.625rem",paddingY:"0.375rem"},lg:{fontSize:"1.125rem",paddingX:"0.875rem",paddingY:"0.625rem"}}},fW={root:{transitionDuration:"{transition.duration}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},value:{background:"{primary.color}"},range:{background:"{content.border.color}"},text:{color:"{text.muted.color}"}},pW={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",shadow:"{form.field.shadow}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},list:{padding:"{list.padding}",gap:"{list.gap}",header:{padding:"{list.header.padding}"}},option:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},optionGroup:{background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},checkmark:{color:"{list.option.color}",gutterStart:"-0.375rem",gutterEnd:"0.375rem"},emptyMessage:{padding:"{list.option.padding}"},colorScheme:{light:{option:{stripedBackground:"{surface.50}"}},dark:{option:{stripedBackground:"{surface.900}"}}}},mW={root:{background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",gap:"0.5rem",verticalOrientation:{padding:"{navigation.list.padding}",gap:"0"},horizontalOrientation:{padding:"0.5rem 0.75rem"},transitionDuration:"{transition.duration}"},baseItem:{borderRadius:"{content.border.radius}",padding:"{navigation.item.padding}"},item:{focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},overlay:{padding:"0",background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",shadow:"{overlay.navigation.shadow}",gap:"0.5rem"},submenu:{padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},submenuLabel:{padding:"{navigation.submenu.label.padding}",fontWeight:"{navigation.submenu.label.font.weight}",background:"{navigation.submenu.label.background.}",color:"{navigation.submenu.label.color}"},submenuIcon:{size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"},separator:{borderColor:"{content.border.color}"},mobileButton:{borderRadius:"50%",size:"1.75rem",color:"{text.muted.color}",hoverColor:"{text.muted.hover.color}",hoverBackground:"{content.hover.background}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}}},gW={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",transitionDuration:"{transition.duration}"},list:{padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},item:{focusBackground:"{navigation.item.focus.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}"}},submenuLabel:{padding:"{navigation.submenu.label.padding}",fontWeight:"{navigation.submenu.label.font.weight}",background:"{navigation.submenu.label.background}",color:"{navigation.submenu.label.color}"},separator:{borderColor:"{content.border.color}"}},_W={root:{background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",gap:"0.5rem",padding:"0.5rem 0.75rem",transitionDuration:"{transition.duration}"},baseItem:{borderRadius:"{content.border.radius}",padding:"{navigation.item.padding}"},item:{focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},submenu:{padding:"{navigation.list.padding}",gap:"{navigation.list.gap}",background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",mobileIndent:"1rem"},submenuIcon:{size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"},separator:{borderColor:"{content.border.color}"},mobileButton:{borderRadius:"50%",size:"1.75rem",color:"{text.muted.color}",hoverColor:"{text.muted.hover.color}",hoverBackground:"{content.hover.background}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}}},yW={root:{borderRadius:"{content.border.radius}",borderWidth:"1px",transitionDuration:"{transition.duration}"},content:{padding:"0.5rem 0.75rem",gap:"0.5rem"},text:{fontSize:"1rem",fontWeight:"500"},icon:{size:"1.125rem"},closeButton:{width:"1.75rem",height:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",offset:"{focus.ring.offset}"}},closeIcon:{size:"1rem"},colorScheme:{light:{info:{background:"color-mix(in srgb, {blue.50}, transparent 5%)",borderColor:"{blue.200}",color:"{blue.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"{blue.100}",focusRing:{color:"{blue.600}",shadow:"none"}}},success:{background:"color-mix(in srgb, {green.50}, transparent 5%)",borderColor:"{green.200}",color:"{green.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"{green.100}",focusRing:{color:"{green.600}",shadow:"none"}}},warn:{background:"color-mix(in srgb,{yellow.50}, transparent 5%)",borderColor:"{yellow.200}",color:"{yellow.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"{yellow.100}",focusRing:{color:"{yellow.600}",shadow:"none"}}},error:{background:"color-mix(in srgb, {red.50}, transparent 5%)",borderColor:"{red.200}",color:"{red.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"{red.100}",focusRing:{color:"{red.600}",shadow:"none"}}},secondary:{background:"{surface.100}",borderColor:"{surface.200}",color:"{surface.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.200}",focusRing:{color:"{surface.600}",shadow:"none"}}},contrast:{background:"{surface.900}",borderColor:"{surface.950}",color:"{surface.50}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.800}",focusRing:{color:"{surface.50}",shadow:"none"}}}},dark:{info:{background:"color-mix(in srgb, {blue.500}, transparent 84%)",borderColor:"color-mix(in srgb, {blue.700}, transparent 64%)",color:"{blue.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{blue.500}",shadow:"none"}}},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",borderColor:"color-mix(in srgb, {green.700}, transparent 64%)",color:"{green.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{green.500}",shadow:"none"}}},warn:{background:"color-mix(in srgb, {yellow.500}, transparent 84%)",borderColor:"color-mix(in srgb, {yellow.700}, transparent 64%)",color:"{yellow.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{yellow.500}",shadow:"none"}}},error:{background:"color-mix(in srgb, {red.500}, transparent 84%)",borderColor:"color-mix(in srgb, {red.700}, transparent 64%)",color:"{red.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{red.500}",shadow:"none"}}},secondary:{background:"{surface.800}",borderColor:"{surface.700}",color:"{surface.300}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.700}",focusRing:{color:"{surface.300}",shadow:"none"}}},contrast:{background:"{surface.0}",borderColor:"{surface.100}",color:"{surface.950}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.100}",focusRing:{color:"{surface.950}",shadow:"none"}}}}}},vW={root:{borderRadius:"{content.border.radius}",gap:"1rem"},meters:{background:"{content.border.color}",size:"0.5rem"},label:{gap:"0.5rem"},labelMarker:{size:"0.5rem"},labelIcon:{size:"1rem"},labelList:{verticalGap:"0.5rem",horizontalGap:"1rem"}},bW={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},dropdown:{width:"2.5rem",color:"{form.field.icon.color}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},list:{padding:"{list.padding}",gap:"{list.gap}",header:{padding:"{list.header.padding}"}},option:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}",gap:"0.5rem"},optionGroup:{background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},chip:{borderRadius:"{border.radius.sm}"},emptyMessage:{padding:"{list.option.padding}"}},xW={root:{gap:"1.125rem"},controls:{gap:"0.5rem"}},wW={root:{gutter:"0.75rem",transitionDuration:"{transition.duration}"},node:{background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",borderColor:"{content.border.color}",color:"{content.color}",selectedColor:"{highlight.color}",hoverColor:"{content.hover.color}",padding:"0.75rem 1rem",toggleablePadding:"0.75rem 1rem 1.25rem 1rem",borderRadius:"{content.border.radius}"},nodeToggleButton:{background:"{content.background}",hoverBackground:"{content.hover.background}",borderColor:"{content.border.color}",color:"{text.muted.color}",hoverColor:"{text.color}",size:"1.5rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},connector:{color:"{content.border.color}",borderRadius:"{content.border.radius}",height:"24px"}},TW={root:{outline:{width:"2px",color:"{content.background}"}}},EW={root:{padding:"0.5rem 1rem",gap:"0.25rem",borderRadius:"{content.border.radius}",background:"{content.background}",color:"{content.color}",transitionDuration:"{transition.duration}"},navButton:{background:"transparent",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",selectedColor:"{highlight.color}",width:"2.5rem",height:"2.5rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},currentPageReport:{color:"{text.muted.color}"},jumpToPageInput:{maxWidth:"2.5rem"}},IW={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}"},header:{background:"transparent",color:"{text.color}",padding:"1.125rem",borderColor:"{content.border.color}",borderWidth:"0",borderRadius:"0"},toggleableHeader:{padding:"0.375rem 1.125rem"},title:{fontWeight:"600"},content:{padding:"0 1.125rem 1.125rem 1.125rem"},footer:{padding:"0 1.125rem 1.125rem 1.125rem"}},AW={root:{gap:"0.5rem",transitionDuration:"{transition.duration}"},panel:{background:"{content.background}",borderColor:"{content.border.color}",borderWidth:"1px",color:"{content.color}",padding:"0.25rem 0.25rem",borderRadius:"{content.border.radius}",first:{borderWidth:"1px",topBorderRadius:"{content.border.radius}"},last:{borderWidth:"1px",bottomBorderRadius:"{content.border.radius}"}},item:{focusBackground:"{navigation.item.focus.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",gap:"0.5rem",padding:"{navigation.item.padding}",borderRadius:"{content.border.radius}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}"}},submenu:{indent:"1rem"},submenuIcon:{color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}"}},SW={meter:{background:"{content.border.color}",borderRadius:"{content.border.radius}",height:".75rem"},icon:{color:"{form.field.icon.color}"},overlay:{background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",borderRadius:"{overlay.popover.border.radius}",color:"{overlay.popover.color}",padding:"{overlay.popover.padding}",shadow:"{overlay.popover.shadow}"},content:{gap:"0.5rem"},colorScheme:{light:{strength:{weakBackground:"{red.500}",mediumBackground:"{amber.500}",strongBackground:"{green.500}"}},dark:{strength:{weakBackground:"{red.400}",mediumBackground:"{amber.400}",strongBackground:"{green.400}"}}}},CW={root:{gap:"1.125rem"},controls:{gap:"0.5rem"}},RW={root:{background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",color:"{overlay.popover.color}",borderRadius:"{overlay.popover.border.radius}",shadow:"{overlay.popover.shadow}",gutter:"10px",arrowOffset:"1.25rem"},content:{padding:"{overlay.popover.padding}"}},kW={root:{background:"{content.border.color}",borderRadius:"{content.border.radius}",height:"1.25rem"},value:{background:"{primary.color}"},label:{color:"{primary.contrast.color}",fontSize:"0.75rem",fontWeight:"600"}},PW={colorScheme:{light:{root:{"color.1":"{red.500}","color.2":"{blue.500}","color.3":"{green.500}","color.4":"{yellow.500}"}},dark:{root:{"color.1":"{red.400}","color.2":"{blue.400}","color.3":"{green.400}","color.4":"{yellow.400}"}}}},MW={root:{width:"1.25rem",height:"1.25rem",background:"{form.field.background}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.border.color}",checkedBorderColor:"{primary.color}",checkedHoverBorderColor:"{primary.hover.color}",checkedFocusBorderColor:"{primary.color}",checkedDisabledBorderColor:"{form.field.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",shadow:"{form.field.shadow}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},icon:{size:"0.75rem",checkedColor:"{primary.contrast.color}",checkedHoverColor:"{primary.contrast.color}",disabledColor:"{form.field.disabled.color}"}},DW={root:{gap:"0.25rem",transitionDuration:"{transition.duration}"},icon:{size:"1rem",color:"{text.muted.color}",hoverColor:"{primary.color}",activeColor:"{primary.color}"}},LW={colorScheme:{light:{root:{background:"rgba(0,0,0,0.1)"}},dark:{root:{background:"rgba(255,255,255,0.3)"}}}},OW={root:{transitionDuration:"{transition.duration}"},bar:{size:"9px",borderRadius:"{border.radius.sm}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},colorScheme:{light:{bar:{background:"{surface.100}"}},dark:{bar:{background:"{surface.800}"}}}},BW={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},dropdown:{width:"2.5rem",color:"{form.field.icon.color}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},list:{padding:"{list.padding}",gap:"{list.gap}",header:{padding:"{list.header.padding}"}},option:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},optionGroup:{background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},clearIcon:{color:"{form.field.icon.color}"},checkmark:{color:"{list.option.color}",gutterStart:"-0.375rem",gutterEnd:"0.375rem"},emptyMessage:{padding:"{list.option.padding}"}},zW={root:{borderRadius:"{form.field.border.radius}"},colorScheme:{light:{root:{invalidBorderColor:"{form.field.invalid.border.color}"}},dark:{root:{invalidBorderColor:"{form.field.invalid.border.color}"}}}},FW={root:{borderRadius:"{content.border.radius}"},colorScheme:{light:{root:{background:"{surface.200}",animationBackground:"rgba(255,255,255,0.4)"}},dark:{root:{background:"rgba(255, 255, 255, 0.06)",animationBackground:"rgba(255, 255, 255, 0.04)"}}}},NW={root:{transitionDuration:"{transition.duration}"},track:{background:"{content.border.color}",borderRadius:"{content.border.radius}",size:"3px"},range:{background:"{primary.color}"},handle:{width:"20px",height:"20px",borderRadius:"50%",background:"{content.border.color}",hoverBackground:"{content.border.color}",content:{borderRadius:"50%",hoverBackground:"{content.background}",width:"16px",height:"16px",shadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.08), 0px 1px 1px 0px rgba(0, 0, 0, 0.14)"},focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},colorScheme:{light:{handle:{contentBackground:"{surface.0}"}},dark:{handle:{contentBackground:"{surface.950}"}}}},VW={root:{gap:"0.5rem",transitionDuration:"{transition.duration}"}},UW={root:{borderRadius:"{form.field.border.radius}",roundedBorderRadius:"2rem",raisedShadow:"0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12)"}},jW={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",transitionDuration:"{transition.duration}"},gutter:{background:"{content.border.color}"},handle:{size:"24px",background:"transparent",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}}},$W={root:{transitionDuration:"{transition.duration}"},separator:{background:"{content.border.color}",activeBackground:"{primary.color}",margin:"0 0 0 1.625rem",size:"2px"},step:{padding:"0.5rem",gap:"1rem"},stepHeader:{padding:"0",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},gap:"0.5rem"},stepTitle:{color:"{text.muted.color}",activeColor:"{primary.color}",fontWeight:"500"},stepNumber:{background:"{content.background}",activeBackground:"{content.background}",borderColor:"{content.border.color}",activeBorderColor:"{content.border.color}",color:"{text.muted.color}",activeColor:"{primary.color}",size:"2rem",fontSize:"1.143rem",fontWeight:"500",borderRadius:"50%",shadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.06), 0px 1px 1px 0px rgba(0, 0, 0, 0.12)"},steppanels:{padding:"0.875rem 0.5rem 1.125rem 0.5rem"},steppanel:{background:"{content.background}",color:"{content.color}",padding:"0 0 0 1rem"}},qW={root:{transitionDuration:"{transition.duration}"},separator:{background:"{content.border.color}"},itemLink:{borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},gap:"0.5rem"},itemLabel:{color:"{text.muted.color}",activeColor:"{primary.color}",fontWeight:"500"},itemNumber:{background:"{content.background}",activeBackground:"{content.background}",borderColor:"{content.border.color}",activeBorderColor:"{content.border.color}",color:"{text.muted.color}",activeColor:"{primary.color}",size:"2rem",fontSize:"1.143rem",fontWeight:"500",borderRadius:"50%",shadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.06), 0px 1px 1px 0px rgba(0, 0, 0, 0.12)"}},GW={root:{transitionDuration:"{transition.duration}"},tablist:{borderWidth:"0 0 1px 0",background:"{content.background}",borderColor:"{content.border.color}"},item:{background:"transparent",hoverBackground:"transparent",activeBackground:"transparent",borderWidth:"0 0 1px 0",borderColor:"{content.border.color}",hoverBorderColor:"{content.border.color}",activeBorderColor:"{primary.color}",color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}",padding:"1rem 1.125rem",fontWeight:"600",margin:"0 0 -1px 0",gap:"0.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},itemIcon:{color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}"},activeBar:{height:"1px",bottom:"-1px",background:"{primary.color}"}},HW={root:{transitionDuration:"{transition.duration}"},tablist:{borderWidth:"0 0 1px 0",background:"{content.background}",borderColor:"{content.border.color}"},tab:{background:"transparent",hoverBackground:"transparent",activeBackground:"transparent",borderWidth:"0 0 1px 0",borderColor:"{content.border.color}",hoverBorderColor:"{content.border.color}",activeBorderColor:"{primary.color}",color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}",padding:"1rem 1.125rem",fontWeight:"600",margin:"0 0 -1px 0",gap:"0.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},tabpanel:{background:"{content.background}",color:"{content.color}",padding:"0.875rem 1.125rem 1.125rem 1.125rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"inset {focus.ring.shadow}"}},navButton:{background:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}",width:"2.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},activeBar:{height:"1px",bottom:"-1px",background:"{primary.color}"},colorScheme:{light:{navButton:{shadow:"0px 0px 10px 50px rgba(255, 255, 255, 0.6)"}},dark:{navButton:{shadow:"0px 0px 10px 50px color-mix(in srgb, {content.background}, transparent 50%)"}}}},WW={root:{transitionDuration:"{transition.duration}"},tabList:{background:"{content.background}",borderColor:"{content.border.color}"},tab:{borderColor:"{content.border.color}",activeBorderColor:"{primary.color}",color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}"},tabPanel:{background:"{content.background}",color:"{content.color}"},navButton:{background:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}"},colorScheme:{light:{navButton:{shadow:"0px 0px 10px 50px rgba(255, 255, 255, 0.6)"}},dark:{navButton:{shadow:"0px 0px 10px 50px color-mix(in srgb, {content.background}, transparent 50%)"}}}},ZW={root:{fontSize:"0.875rem",fontWeight:"700",padding:"0.25rem 0.5rem",gap:"0.25rem",borderRadius:"{content.border.radius}",roundedBorderRadius:"{border.radius.xl}"},icon:{size:"0.75rem"},colorScheme:{light:{primary:{background:"{primary.100}",color:"{primary.700}"},secondary:{background:"{surface.100}",color:"{surface.600}"},success:{background:"{green.100}",color:"{green.700}"},info:{background:"{sky.100}",color:"{sky.700}"},warn:{background:"{orange.100}",color:"{orange.700}"},danger:{background:"{red.100}",color:"{red.700}"},contrast:{background:"{surface.950}",color:"{surface.0}"}},dark:{primary:{background:"color-mix(in srgb, {primary.500}, transparent 84%)",color:"{primary.300}"},secondary:{background:"{surface.800}",color:"{surface.300}"},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",color:"{green.300}"},info:{background:"color-mix(in srgb, {sky.500}, transparent 84%)",color:"{sky.300}"},warn:{background:"color-mix(in srgb, {orange.500}, transparent 84%)",color:"{orange.300}"},danger:{background:"color-mix(in srgb, {red.500}, transparent 84%)",color:"{red.300}"},contrast:{background:"{surface.0}",color:"{surface.950}"}}}},XW={root:{background:"{form.field.background}",borderColor:"{form.field.border.color}",color:"{form.field.color}",height:"18rem",padding:"{form.field.padding.y} {form.field.padding.x}",borderRadius:"{form.field.border.radius}"},prompt:{gap:"0.25rem"},commandResponse:{margin:"2px 0"}},KW={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"}},YW={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",transitionDuration:"{transition.duration}"},list:{padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},item:{focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},submenuLabel:{padding:"{navigation.submenu.label.padding}",fontWeight:"{navigation.submenu.label.font.weight}",background:"{navigation.submenu.label.background.}",color:"{navigation.submenu.label.color}"},submenuIcon:{size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"},separator:{borderColor:"{content.border.color}"}},JW={event:{minHeight:"5rem"},horizontal:{eventContent:{padding:"1rem 0"}},vertical:{eventContent:{padding:"0 1rem"}},eventMarker:{size:"1.125rem",borderRadius:"50%",borderWidth:"2px",background:"{content.background}",borderColor:"{content.border.color}",content:{borderRadius:"50%",size:"0.375rem",background:"{primary.color}",insetShadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.06), 0px 1px 1px 0px rgba(0, 0, 0, 0.12)"}},eventConnector:{color:"{content.border.color}",size:"2px"}},QW={root:{width:"25rem",borderRadius:"{content.border.radius}",borderWidth:"1px",transitionDuration:"{transition.duration}"},icon:{size:"1.125rem"},content:{padding:"{overlay.popover.padding}",gap:"0.5rem"},text:{gap:"0.5rem"},summary:{fontWeight:"500",fontSize:"1rem"},detail:{fontWeight:"500",fontSize:"0.875rem"},closeButton:{width:"1.75rem",height:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",offset:"{focus.ring.offset}"}},closeIcon:{size:"1rem"},colorScheme:{light:{blur:"1.5px",info:{background:"color-mix(in srgb, {blue.50}, transparent 5%)",borderColor:"{blue.200}",color:"{blue.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"{blue.100}",focusRing:{color:"{blue.600}",shadow:"none"}}},success:{background:"color-mix(in srgb, {green.50}, transparent 5%)",borderColor:"{green.200}",color:"{green.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"{green.100}",focusRing:{color:"{green.600}",shadow:"none"}}},warn:{background:"color-mix(in srgb,{yellow.50}, transparent 5%)",borderColor:"{yellow.200}",color:"{yellow.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"{yellow.100}",focusRing:{color:"{yellow.600}",shadow:"none"}}},error:{background:"color-mix(in srgb, {red.50}, transparent 5%)",borderColor:"{red.200}",color:"{red.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"{red.100}",focusRing:{color:"{red.600}",shadow:"none"}}},secondary:{background:"{surface.100}",borderColor:"{surface.200}",color:"{surface.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.200}",focusRing:{color:"{surface.600}",shadow:"none"}}},contrast:{background:"{surface.900}",borderColor:"{surface.950}",color:"{surface.50}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.800}",focusRing:{color:"{surface.50}",shadow:"none"}}}},dark:{blur:"10px",info:{background:"color-mix(in srgb, {blue.500}, transparent 84%)",borderColor:"color-mix(in srgb, {blue.700}, transparent 64%)",color:"{blue.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{blue.500}",shadow:"none"}}},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",borderColor:"color-mix(in srgb, {green.700}, transparent 64%)",color:"{green.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{green.500}",shadow:"none"}}},warn:{background:"color-mix(in srgb, {yellow.500}, transparent 84%)",borderColor:"color-mix(in srgb, {yellow.700}, transparent 64%)",color:"{yellow.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{yellow.500}",shadow:"none"}}},error:{background:"color-mix(in srgb, {red.500}, transparent 84%)",borderColor:"color-mix(in srgb, {red.700}, transparent 64%)",color:"{red.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{red.500}",shadow:"none"}}},secondary:{background:"{surface.800}",borderColor:"{surface.700}",color:"{surface.300}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.700}",focusRing:{color:"{surface.300}",shadow:"none"}}},contrast:{background:"{surface.0}",borderColor:"{surface.100}",color:"{surface.950}",detailColor:"{surface.950}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.100}",focusRing:{color:"{surface.950}",shadow:"none"}}}}}},eZ={root:{padding:"0.5rem 1rem",borderRadius:"{content.border.radius}",gap:"0.5rem",fontWeight:"500",disabledBackground:"{form.field.disabled.background}",disabledBorderColor:"{form.field.disabled.background}",disabledColor:"{form.field.disabled.color}",invalidBorderColor:"{form.field.invalid.border.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},icon:{disabledColor:"{form.field.disabled.color}"},content:{left:"0.25rem",top:"0.25rem",checkedShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.02), 0px 1px 2px 0px rgba(0, 0, 0, 0.04)"},colorScheme:{light:{root:{background:"{surface.100}",checkedBackground:"{surface.100}",hoverBackground:"{surface.100}",borderColor:"{surface.100}",color:"{surface.500}",hoverColor:"{surface.700}",checkedColor:"{surface.900}",checkedBorderColor:"{surface.100}"},content:{checkedBackground:"{surface.0}"},icon:{color:"{surface.500}",hoverColor:"{surface.700}",checkedColor:"{surface.900}"}},dark:{root:{background:"{surface.950}",checkedBackground:"{surface.950}",hoverBackground:"{surface.950}",borderColor:"{surface.950}",color:"{surface.400}",hoverColor:"{surface.300}",checkedColor:"{surface.0}",checkedBorderColor:"{surface.950}"},content:{checkedBackground:"{surface.800}"},icon:{color:"{surface.400}",hoverColor:"{surface.300}",checkedColor:"{surface.0}"}}}},tZ={root:{width:"2.5rem",height:"1.5rem",borderRadius:"30px",gap:"0.25rem",shadow:"{form.field.shadow}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},borderWidth:"1px",borderColor:"transparent",hoverBorderColor:"transparent",checkedBorderColor:"transparent",checkedHoverBorderColor:"transparent",invalidBorderColor:"{form.field.invalid.border.color}",transitionDuration:"{form.field.transition.duration}",slideDuration:"0.2s",disabledBackground:"{form.field.disabled.background}"},handle:{borderRadius:"50%",size:"1rem",disabledBackground:"{form.field.disabled.color}"},colorScheme:{light:{root:{background:"{surface.300}",hoverBackground:"{surface.400}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}"},handle:{background:"{surface.0}",hoverBackground:"{surface.0}",checkedBackground:"{surface.0}",checkedHoverBackground:"{surface.0}"}},dark:{root:{background:"{surface.700}",hoverBackground:"{surface.600}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}"},handle:{background:"{surface.400}",hoverBackground:"{surface.300}",checkedBackground:"{surface.900}",checkedHoverBackground:"{surface.900}"}}}},rZ={root:{background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",gap:"0.5rem",padding:"0.75rem"}},nZ={root:{maxWidth:"12.5rem",gutter:"0.25rem",shadow:"{overlay.popover.shadow}",padding:"0.5rem 0.75rem",borderRadius:"{overlay.popover.border.radius}"},colorScheme:{light:{root:{background:"{surface.700}",color:"{surface.0}"}},dark:{root:{background:"{surface.700}",color:"{surface.0}"}}}},iZ={root:{background:"{content.background}",color:"{content.color}",padding:"1rem",gap:"2px",indent:"1rem",transitionDuration:"{transition.duration}"},node:{padding:"0.25rem 0.5rem",borderRadius:"{content.border.radius}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{text.color}",hoverColor:"{text.hover.color}",selectedColor:"{highlight.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"},gap:"0.25rem"},nodeIcon:{color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",selectedColor:"{highlight.color}"},nodeToggleButton:{borderRadius:"50%",size:"1.75rem",hoverBackground:"{content.hover.background}",selectedHoverBackground:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",selectedHoverColor:"{primary.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},loadingIcon:{size:"2rem"}},oZ={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},dropdown:{width:"2.5rem",color:"{form.field.icon.color}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},tree:{padding:"{list.padding}"},emptyMessage:{padding:"{list.option.padding}"},chip:{borderRadius:"{border.radius.sm}"}},sZ={root:{transitionDuration:"{transition.duration}"},header:{background:"{content.background}",borderColor:"{treetable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem"},headerCell:{background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",borderColor:"{treetable.border.color}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",gap:"0.5rem",padding:"0.75rem 1rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},columnTitle:{fontWeight:"600"},row:{background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},bodyCell:{borderColor:"{treetable.border.color}",padding:"0.75rem 1rem",gap:"0.5rem"},footerCell:{background:"{content.background}",borderColor:"{treetable.border.color}",color:"{content.color}",padding:"0.75rem 1rem"},columnFooter:{fontWeight:"600"},footer:{background:"{content.background}",borderColor:"{treetable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem"},columnResizerWidth:"0.5rem",resizeIndicator:{width:"1px",color:"{primary.color}"},sortIcon:{color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}"},loadingIcon:{size:"2rem"},nodeToggleButton:{hoverBackground:"{content.hover.background}",selectedHoverBackground:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}",selectedHoverColor:"{primary.color}",size:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},paginatorTop:{borderColor:"{content.border.color}",borderWidth:"0 0 1px 0"},paginatorBottom:{borderColor:"{content.border.color}",borderWidth:"0 0 1px 0"},colorScheme:{light:{root:{borderColor:"{content.border.color}"},bodyCell:{selectedBorderColor:"{primary.100}"}},dark:{root:{borderColor:"{surface.800}"},bodyCell:{selectedBorderColor:"{primary.900}"}}}},aZ={loader:{mask:{background:"{content.background}",color:"{text.muted.color}"},icon:{size:"2rem"}}},lZ={primitive:{borderRadius:{none:"0",xs:"2px",sm:"4px",md:"6px",lg:"8px",xl:"12px"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b",950:"#022c22"},green:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d",950:"#052e16"},lime:{50:"#f7fee7",100:"#ecfccb",200:"#d9f99d",300:"#bef264",400:"#a3e635",500:"#84cc16",600:"#65a30d",700:"#4d7c0f",800:"#3f6212",900:"#365314",950:"#1a2e05"},red:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d",950:"#450a0a"},orange:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12",950:"#431407"},amber:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f",950:"#451a03"},yellow:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12",950:"#422006"},teal:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a",950:"#042f2e"},cyan:{50:"#ecfeff",100:"#cffafe",200:"#a5f3fc",300:"#67e8f9",400:"#22d3ee",500:"#06b6d4",600:"#0891b2",700:"#0e7490",800:"#155e75",900:"#164e63",950:"#083344"},sky:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e",950:"#082f49"},blue:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a",950:"#172554"},indigo:{50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",800:"#3730a3",900:"#312e81",950:"#1e1b4b"},violet:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95",950:"#2e1065"},purple:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7e22ce",800:"#6b21a8",900:"#581c87",950:"#3b0764"},fuchsia:{50:"#fdf4ff",100:"#fae8ff",200:"#f5d0fe",300:"#f0abfc",400:"#e879f9",500:"#d946ef",600:"#c026d3",700:"#a21caf",800:"#86198f",900:"#701a75",950:"#4a044e"},pink:{50:"#fdf2f8",100:"#fce7f3",200:"#fbcfe8",300:"#f9a8d4",400:"#f472b6",500:"#ec4899",600:"#db2777",700:"#be185d",800:"#9d174d",900:"#831843",950:"#500724"},rose:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337",950:"#4c0519"},slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a",950:"#020617"},gray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827",950:"#030712"},zinc:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717a",600:"#52525b",700:"#3f3f46",800:"#27272a",900:"#18181b",950:"#09090b"},neutral:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717",950:"#0a0a0a"},stone:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716c",600:"#57534e",700:"#44403c",800:"#292524",900:"#1c1917",950:"#0c0a09"}},semantic:{transitionDuration:"0.2s",focusRing:{width:"1px",style:"solid",color:"{primary.color}",offset:"2px",shadow:"none"},disabledOpacity:"0.6",iconSize:"1rem",anchorGutter:"2px",primary:{50:"{emerald.50}",100:"{emerald.100}",200:"{emerald.200}",300:"{emerald.300}",400:"{emerald.400}",500:"{emerald.500}",600:"{emerald.600}",700:"{emerald.700}",800:"{emerald.800}",900:"{emerald.900}",950:"{emerald.950}"},formField:{paddingX:"0.75rem",paddingY:"0.5rem",borderRadius:"{border.radius.md}",focusRing:{width:"0",style:"none",color:"transparent",offset:"0",shadow:"none"},transitionDuration:"{transition.duration}"},list:{padding:"0.25rem 0.25rem",gap:"2px",header:{padding:"0.5rem 1rem 0.25rem 1rem"},option:{padding:"0.5rem 0.75rem",borderRadius:"{border.radius.sm}"},optionGroup:{padding:"0.5rem 0.75rem",fontWeight:"600"}},content:{borderRadius:"{border.radius.md}"},mask:{transitionDuration:"0.15s"},navigation:{list:{padding:"0.25rem 0.25rem",gap:"2px"},item:{padding:"0.5rem 0.75rem",borderRadius:"{border.radius.sm}",gap:"0.5rem"},submenuLabel:{padding:"0.5rem 0.75rem",fontWeight:"600"},submenuIcon:{size:"0.875rem"}},overlay:{select:{borderRadius:"{border.radius.md}",shadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)"},popover:{borderRadius:"{border.radius.md}",padding:"0.75rem",shadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)"},modal:{borderRadius:"{border.radius.xl}",padding:"1.25rem",shadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)"},navigation:{shadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)"}},colorScheme:{light:{surface:{0:"#ffffff",50:"{slate.50}",100:"{slate.100}",200:"{slate.200}",300:"{slate.300}",400:"{slate.400}",500:"{slate.500}",600:"{slate.600}",700:"{slate.700}",800:"{slate.800}",900:"{slate.900}",950:"{slate.950}"},primary:{color:"{primary.500}",contrastColor:"#ffffff",hoverColor:"{primary.600}",activeColor:"{primary.700}"},highlight:{background:"{primary.50}",focusBackground:"{primary.100}",color:"{primary.700}",focusColor:"{primary.800}"},mask:{background:"rgba(0,0,0,0.4)",color:"{surface.200}"},formField:{background:"{surface.0}",disabledBackground:"{surface.200}",filledBackground:"{surface.50}",filledFocusBackground:"{surface.50}",borderColor:"{surface.300}",hoverBorderColor:"{surface.400}",focusBorderColor:"{primary.color}",invalidBorderColor:"{red.400}",color:"{surface.700}",disabledColor:"{surface.500}",placeholderColor:"{surface.500}",floatLabelColor:"{surface.500}",floatLabelFocusColor:"{surface.500}",floatLabelInvalidColor:"{red.400}",iconColor:"{surface.400}",shadow:"0 0 #0000, 0 0 #0000, 0 1px 2px 0 rgba(18, 18, 23, 0.05)"},text:{color:"{surface.700}",hoverColor:"{surface.800}",mutedColor:"{surface.500}",hoverMutedColor:"{surface.600}"},content:{background:"{surface.0}",hoverBackground:"{surface.100}",borderColor:"{surface.200}",color:"{text.color}",hoverColor:"{text.hover.color}"},overlay:{select:{background:"{surface.0}",borderColor:"{surface.200}",color:"{text.color}"},popover:{background:"{surface.0}",borderColor:"{surface.200}",color:"{text.color}"},modal:{background:"{surface.0}",borderColor:"{surface.200}",color:"{text.color}"}},list:{option:{focusBackground:"{surface.100}",selectedBackground:"{highlight.background}",selectedFocusBackground:"{highlight.focus.background}",color:"{text.color}",focusColor:"{text.hover.color}",selectedColor:"{highlight.color}",selectedFocusColor:"{highlight.focus.color}",icon:{color:"{surface.400}",focusColor:"{surface.500}"}},optionGroup:{background:"transparent",color:"{text.muted.color}"}},navigation:{item:{focusBackground:"{surface.100}",activeBackground:"{surface.100}",color:"{text.color}",focusColor:"{text.hover.color}",activeColor:"{text.hover.color}",icon:{color:"{surface.400}",focusColor:"{surface.500}",activeColor:"{surface.500}"}},submenuLabel:{background:"transparent",color:"{text.muted.color}"},submenuIcon:{color:"{surface.400}",focusColor:"{surface.500}",activeColor:"{surface.500}"}}},dark:{surface:{0:"#ffffff",50:"{zinc.50}",100:"{zinc.100}",200:"{zinc.200}",300:"{zinc.300}",400:"{zinc.400}",500:"{zinc.500}",600:"{zinc.600}",700:"{zinc.700}",800:"{zinc.800}",900:"{zinc.900}",950:"{zinc.950}"},primary:{color:"{primary.400}",contrastColor:"{surface.900}",hoverColor:"{primary.300}",activeColor:"{primary.200}"},highlight:{background:"color-mix(in srgb, {primary.400}, transparent 84%)",focusBackground:"color-mix(in srgb, {primary.400}, transparent 76%)",color:"rgba(255,255,255,.87)",focusColor:"rgba(255,255,255,.87)"},mask:{background:"rgba(0,0,0,0.6)",color:"{surface.200}"},formField:{background:"{surface.950}",disabledBackground:"{surface.700}",filledBackground:"{surface.800}",filledFocusBackground:"{surface.800}",borderColor:"{surface.700}",hoverBorderColor:"{surface.600}",focusBorderColor:"{primary.color}",invalidBorderColor:"{red.300}",color:"{surface.0}",disabledColor:"{surface.400}",placeholderColor:"{surface.400}",floatLabelColor:"{surface.400}",floatLabelFocusColor:"{surface.400}",floatLabelInvalidColor:"{red.300}",iconColor:"{surface.400}",shadow:"0 0 #0000, 0 0 #0000, 0 1px 2px 0 rgba(18, 18, 23, 0.05)"},text:{color:"{surface.0}",hoverColor:"{surface.0}",mutedColor:"{surface.400}",hoverMutedColor:"{surface.300}"},content:{background:"{surface.900}",hoverBackground:"{surface.800}",borderColor:"{surface.700}",color:"{text.color}",hoverColor:"{text.hover.color}"},overlay:{select:{background:"{surface.900}",borderColor:"{surface.700}",color:"{text.color}"},popover:{background:"{surface.900}",borderColor:"{surface.700}",color:"{text.color}"},modal:{background:"{surface.900}",borderColor:"{surface.700}",color:"{text.color}"}},list:{option:{focusBackground:"{surface.800}",selectedBackground:"{highlight.background}",selectedFocusBackground:"{highlight.focus.background}",color:"{text.color}",focusColor:"{text.hover.color}",selectedColor:"{highlight.color}",selectedFocusColor:"{highlight.focus.color}",icon:{color:"{surface.500}",focusColor:"{surface.400}"}},optionGroup:{background:"transparent",color:"{text.muted.color}"}},navigation:{item:{focusBackground:"{surface.800}",activeBackground:"{surface.800}",color:"{text.color}",focusColor:"{text.hover.color}",activeColor:"{text.hover.color}",icon:{color:"{surface.500}",focusColor:"{surface.400}",activeColor:"{surface.400}"}},submenuLabel:{background:"transparent",color:"{text.muted.color}"},submenuIcon:{color:"{surface.500}",focusColor:"{surface.400}",activeColor:"{surface.400}"}}}}},components:{accordion:PH,autocomplete:MH,avatar:DH,badge:LH,blockui:OH,breadcrumb:BH,button:zH,datepicker:XH,card:FH,carousel:NH,cascadeselect:VH,checkbox:UH,chip:jH,colorpicker:$H,confirmdialog:qH,confirmpopup:GH,contextmenu:HH,dataview:ZH,datatable:WH,dialog:KH,divider:YH,dock:JH,drawer:QH,editor:eW,fieldset:tW,fileupload:rW,floatlabel:nW,galleria:iW,iconfield:oW,image:sW,inlinemessage:aW,inplace:lW,inputchips:cW,inputgroup:uW,inputnumber:hW,inputtext:dW,knob:fW,listbox:pW,megamenu:mW,menu:gW,menubar:_W,message:yW,metergroup:vW,multiselect:bW,orderlist:xW,organizationchart:wW,overlaybadge:TW,popover:RW,paginator:EW,password:SW,panel:IW,panelmenu:AW,picklist:CW,progressbar:kW,progressspinner:PW,radiobutton:MW,rating:DW,scrollpanel:OW,select:BW,selectbutton:zW,skeleton:FW,slider:NW,speeddial:VW,splitter:jW,splitbutton:UW,stepper:$W,steps:qW,tabmenu:GW,tabs:HW,tabview:WW,textarea:KW,tieredmenu:YW,tag:ZW,terminal:XW,timeline:JW,togglebutton:eZ,toggleswitch:tZ,tree:iZ,treeselect:oZ,treetable:sZ,toast:QW,toolbar:rZ,virtualscroller:aZ},directives:{tooltip:nZ,ripple:LW}};const cZ={apiKey:"AIzaSyAqyLCGo__iRXwuP_G9UUrCCKgZ8ebBHA0",authDomain:"week7-yupeng.firebaseapp.com",projectId:"week7-yupeng",storageBucket:"week7-yupeng.appspot.com",messagingSenderId:"54988424660",appId:"1:54988424660:web:cd87bf59030c04c6a58241",measurementId:"G-W73JGXXZSZ"};aw(cZ);const aT=Q5(BF);aT.use(kH,{theme:{preset:lZ}});aT.use(XD);aT.mount("#app");
